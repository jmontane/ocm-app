(self.webpackChunkapp=self.webpackChunkapp||[]).push([[179],{2726:(zn,wt,S)=>{"use strict";S.d(wt,{Uw:()=>Ce,fo:()=>De});var h=S(5861);typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"&&global;var oe=function(Se){return Se.Unimplemented="UNIMPLEMENTED",Se.Unavailable="UNAVAILABLE",Se}(oe||{});class _e extends Error{constructor(Ve,Xe,Ht){super(Ve),this.message=Ve,this.code=Xe,this.data=Ht}}const ee=Se=>{var Ve,Xe,Ht,cn,xn;const $t=Se.CapacitorCustomPlatform||null,ke=Se.Capacitor||{},pe=ke.Plugins=ke.Plugins||{},Oe=Se.CapacitorPlatforms,it=(null===(Ve=Oe?.currentPlatform)||void 0===Ve?void 0:Ve.getPlatform)||(()=>null!==$t?$t.name:(Se=>{var Ve,Xe;return Se?.androidBridge?"android":null!==(Xe=null===(Ve=Se?.webkit)||void 0===Ve?void 0:Ve.messageHandlers)&&void 0!==Xe&&Xe.bridge?"ios":"web"})(Se)),Kt=(null===(Xe=Oe?.currentPlatform)||void 0===Xe?void 0:Xe.isNativePlatform)||(()=>"web"!==it()),fn=(null===(Ht=Oe?.currentPlatform)||void 0===Ht?void 0:Ht.isPluginAvailable)||(Rn=>{const Vn=Ie.get(Rn);return!(!Vn?.platforms.has(it())&&!li(Rn))}),li=(null===(cn=Oe?.currentPlatform)||void 0===cn?void 0:cn.getPluginHeader)||(Rn=>{var Vn;return null===(Vn=ke.PluginHeaders)||void 0===Vn?void 0:Vn.find(Ut=>Ut.name===Rn)}),Ie=new Map,on=(null===(xn=Oe?.currentPlatform)||void 0===xn?void 0:xn.registerPlugin)||((Rn,Vn={})=>{const Ut=Ie.get(Rn);if(Ut)return console.warn(`Capacitor plugin "${Rn}" already registered. Cannot register plugins twice.`),Ut.proxy;const Hn=it(),qe=li(Rn);let Nt;const Xt=function(){var Wi=(0,h.Z)(function*(){return!Nt&&Hn in Vn?Nt=Nt="function"==typeof Vn[Hn]?yield Vn[Hn]():Vn[Hn]:null!==$t&&!Nt&&"web"in Vn&&(Nt=Nt="function"==typeof Vn.web?yield Vn.web():Vn.web),Nt});return function(){return Wi.apply(this,arguments)}}(),oi=Wi=>{let _n;const Bi=(...pn)=>{const sn=Xt().then(Cn=>{const $i=((Wi,_n)=>{var Bi,pn;if(!qe){if(Wi)return null===(pn=Wi[_n])||void 0===pn?void 0:pn.bind(Wi);throw new _e(`"${Rn}" plugin is not implemented on ${Hn}`,oe.Unimplemented)}{const sn=qe?.methods.find(Cn=>_n===Cn.name);if(sn)return"promise"===sn.rtype?Cn=>ke.nativePromise(Rn,_n.toString(),Cn):(Cn,$i)=>ke.nativeCallback(Rn,_n.toString(),Cn,$i);if(Wi)return null===(Bi=Wi[_n])||void 0===Bi?void 0:Bi.bind(Wi)}})(Cn,Wi);if($i){const ct=$i(...pn);return _n=ct?.remove,ct}throw new _e(`"${Rn}.${Wi}()" is not implemented on ${Hn}`,oe.Unimplemented)});return"addListener"===Wi&&(sn.remove=(0,h.Z)(function*(){return _n()})),sn};return Bi.toString=()=>`${Wi.toString()}() { [capacitor code] }`,Object.defineProperty(Bi,"name",{value:Wi,writable:!1,configurable:!1}),Bi},xi=oi("addListener"),Oi=oi("removeListener"),gr=(Wi,_n)=>{const Bi=xi({eventName:Wi},_n),pn=function(){var Cn=(0,h.Z)(function*(){const $i=yield Bi;Oi({eventName:Wi,callbackId:$i},_n)});return function(){return Cn.apply(this,arguments)}}(),sn=new Promise(Cn=>Bi.then(()=>Cn({remove:pn})));return sn.remove=(0,h.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield pn()}),sn},ki=new Proxy({},{get(Wi,_n){switch(_n){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return qe?gr:xi;case"removeListener":return Oi;default:return oi(_n)}}});return pe[Rn]=ki,Ie.set(Rn,{name:Rn,proxy:ki,platforms:new Set([...Object.keys(Vn),...qe?[Hn]:[]])}),ki});return ke.convertFileSrc||(ke.convertFileSrc=Rn=>Rn),ke.getPlatform=it,ke.handleError=Rn=>Se.console.error(Rn),ke.isNativePlatform=Kt,ke.isPluginAvailable=fn,ke.pluginMethodNoop=(Rn,Vn,Ut)=>Promise.reject(`${Ut} does not have an implementation of "${Vn}".`),ke.registerPlugin=on,ke.Exception=_e,ke.DEBUG=!!ke.DEBUG,ke.isLoggingEnabled=!!ke.isLoggingEnabled,ke.platform=ke.getPlatform(),ke.isNative=ke.isNativePlatform(),ke},ye=(Se=>Se.Capacitor=ee(Se))(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),De=ye.registerPlugin;class Ce{constructor(Ve){this.listeners={},this.windowListeners={},Ve&&(console.warn(`Capacitor WebPlugin "${Ve.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=Ve)}addListener(Ve,Xe){var Ht=this;this.listeners[Ve]||(this.listeners[Ve]=[]),this.listeners[Ve].push(Xe);const xn=this.windowListeners[Ve];xn&&!xn.registered&&this.addWindowListener(xn);const $t=function(){var pe=(0,h.Z)(function*(){return Ht.removeListener(Ve,Xe)});return function(){return pe.apply(this,arguments)}}(),ke=Promise.resolve({remove:$t});return Object.defineProperty(ke,"remove",{value:(pe=(0,h.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield $t()}),function(){return pe.apply(this,arguments)})}),ke;var pe}removeAllListeners(){var Ve=this;return(0,h.Z)(function*(){Ve.listeners={};for(const Xe in Ve.windowListeners)Ve.removeWindowListener(Ve.windowListeners[Xe]);Ve.windowListeners={}})()}notifyListeners(Ve,Xe){const Ht=this.listeners[Ve];Ht&&Ht.forEach(cn=>cn(Xe))}hasListeners(Ve){return!!this.listeners[Ve].length}registerWindowListener(Ve,Xe){this.windowListeners[Xe]={registered:!1,windowEventName:Ve,pluginEventName:Xe,handler:Ht=>{this.notifyListeners(Xe,Ht)}}}unimplemented(Ve="not implemented"){return new ye.Exception(Ve,oe.Unimplemented)}unavailable(Ve="not available"){return new ye.Exception(Ve,oe.Unavailable)}removeListener(Ve,Xe){var Ht=this;return(0,h.Z)(function*(){const cn=Ht.listeners[Ve];if(!cn)return;const xn=cn.indexOf(Xe);Ht.listeners[Ve].splice(xn,1),Ht.listeners[Ve].length||Ht.removeWindowListener(Ht.windowListeners[Ve])})()}addWindowListener(Ve){window.addEventListener(Ve.windowEventName,Ve.handler),Ve.registered=!0}removeWindowListener(Ve){Ve&&(window.removeEventListener(Ve.windowEventName,Ve.handler),Ve.registered=!1)}}const Pe=Se=>encodeURIComponent(Se).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Be=Se=>Se.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Ne extends Ce{getCookies(){return(0,h.Z)(function*(){const Ve=document.cookie,Xe={};return Ve.split(";").forEach(Ht=>{if(Ht.length<=0)return;let[cn,xn]=Ht.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");cn=Be(cn).trim(),xn=Be(xn).trim(),Xe[cn]=xn}),Xe})()}setCookie(Ve){return(0,h.Z)(function*(){try{const Xe=Pe(Ve.key),Ht=Pe(Ve.value),cn=`; expires=${(Ve.expires||"").replace("expires=","")}`,xn=(Ve.path||"/").replace("path=",""),$t=null!=Ve.url&&Ve.url.length>0?`domain=${Ve.url}`:"";document.cookie=`${Xe}=${Ht||""}${cn}; path=${xn}; ${$t};`}catch(Xe){return Promise.reject(Xe)}})()}deleteCookie(Ve){return(0,h.Z)(function*(){try{document.cookie=`${Ve.key}=; Max-Age=0`}catch(Xe){return Promise.reject(Xe)}})()}clearCookies(){return(0,h.Z)(function*(){try{const Ve=document.cookie.split(";")||[];for(const Xe of Ve)document.cookie=Xe.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(Ve){return Promise.reject(Ve)}})()}clearAllCookies(){var Ve=this;return(0,h.Z)(function*(){try{yield Ve.clearCookies()}catch(Xe){return Promise.reject(Xe)}})()}}De("CapacitorCookies",{web:()=>new Ne});const Ge=function(){var Se=(0,h.Z)(function*(Ve){return new Promise((Xe,Ht)=>{const cn=new FileReader;cn.onload=()=>{const xn=cn.result;Xe(xn.indexOf(",")>=0?xn.split(",")[1]:xn)},cn.onerror=xn=>Ht(xn),cn.readAsDataURL(Ve)})});return function(Xe){return Se.apply(this,arguments)}}();class xe extends Ce{request(Ve){return(0,h.Z)(function*(){const Xe=((Se,Ve={})=>{const Xe=Object.assign({method:Se.method||"GET",headers:Se.headers},Ve),cn=((Se={})=>{const Ve=Object.keys(Se);return Object.keys(Se).map(cn=>cn.toLocaleLowerCase()).reduce((cn,xn,$t)=>(cn[xn]=Se[Ve[$t]],cn),{})})(Se.headers)["content-type"]||"";if("string"==typeof Se.data)Xe.body=Se.data;else if(cn.includes("application/x-www-form-urlencoded")){const xn=new URLSearchParams;for(const[$t,ke]of Object.entries(Se.data||{}))xn.set($t,ke);Xe.body=xn.toString()}else if(cn.includes("multipart/form-data")){const xn=new FormData;if(Se.data instanceof FormData)Se.data.forEach((ke,pe)=>{xn.append(pe,ke)});else for(const ke of Object.keys(Se.data))xn.append(ke,Se.data[ke]);Xe.body=xn;const $t=new Headers(Xe.headers);$t.delete("content-type"),Xe.headers=$t}else(cn.includes("application/json")||"object"==typeof Se.data)&&(Xe.body=JSON.stringify(Se.data));return Xe})(Ve,Ve.webFetchExtra),Ht=((Se,Ve=!0)=>Se?Object.entries(Se).reduce((Ht,cn)=>{const[xn,$t]=cn;let ke,pe;return Array.isArray($t)?(pe="",$t.forEach(Oe=>{ke=Ve?encodeURIComponent(Oe):Oe,pe+=`${xn}=${ke}&`}),pe.slice(0,-1)):(ke=Ve?encodeURIComponent($t):$t,pe=`${xn}=${ke}`),`${Ht}&${pe}`},"").substr(1):null)(Ve.params,Ve.shouldEncodeUrlParams),cn=Ht?`${Ve.url}?${Ht}`:Ve.url,xn=yield fetch(cn,Xe),$t=xn.headers.get("content-type")||"";let pe,Oe,{responseType:ke="text"}=xn.ok?Ve:{};switch($t.includes("application/json")&&(ke="json"),ke){case"arraybuffer":case"blob":Oe=yield xn.blob(),pe=yield Ge(Oe);break;case"json":pe=yield xn.json();break;default:pe=yield xn.text()}const ie={};return xn.headers.forEach((it,_t)=>{ie[_t]=it}),{data:pe,headers:ie,status:xn.status,url:xn.url}})()}get(Ve){var Xe=this;return(0,h.Z)(function*(){return Xe.request(Object.assign(Object.assign({},Ve),{method:"GET"}))})()}post(Ve){var Xe=this;return(0,h.Z)(function*(){return Xe.request(Object.assign(Object.assign({},Ve),{method:"POST"}))})()}put(Ve){var Xe=this;return(0,h.Z)(function*(){return Xe.request(Object.assign(Object.assign({},Ve),{method:"PUT"}))})()}patch(Ve){var Xe=this;return(0,h.Z)(function*(){return Xe.request(Object.assign(Object.assign({},Ve),{method:"PATCH"}))})()}delete(Ve){var Xe=this;return(0,h.Z)(function*(){return Xe.request(Object.assign(Object.assign({},Ve),{method:"DELETE"}))})()}}De("CapacitorHttp",{web:()=>new xe})},3630:(zn,wt,S)=>{"use strict";S.d(wt,{c:()=>X,r:()=>ee});const X=(ne,Ee)=>{ne.componentOnReady?ne.componentOnReady().then(xe=>Ee(xe)):ee(()=>Ee(ne))},ee=ne=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(ne):"function"==typeof requestAnimationFrame?requestAnimationFrame(ne):setTimeout(ne)},191:(zn,wt,S)=>{"use strict";S.d(wt,{L:()=>h,a:()=>p,b:()=>X,c:()=>a,d:()=>j,g:()=>ne});const h="ionViewWillEnter",p="ionViewDidEnter",X="ionViewWillLeave",a="ionViewDidLeave",j="ionViewWillUnload",ne=Ee=>Ee.classList.contains("ion-page")?Ee:Ee.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")||Ee},6410:(zn,wt,S)=>{"use strict";S.d(wt,{c:()=>Ye});var h=S(6225),p=S(839);let X;const j=Ce=>Ce.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),K=Ce=>(void 0===X&&(X=void 0===Ce.style.animationName&&void 0!==Ce.style.webkitAnimationName?"-webkit-":""),X),C=(Ce,de,Pe)=>{const Be=de.startsWith("animation")?K(Ce):"";Ce.style.setProperty(Be+de,Pe)},oe=(Ce,de)=>{const Pe=de.startsWith("animation")?K(Ce):"";Ce.style.removeProperty(Pe+de)},ee=[],me=(Ce=[],de)=>{if(void 0!==de){const Pe=Array.isArray(de)?de:[de];return[...Ce,...Pe]}return Ce},Ye=Ce=>{let de,Pe,Be,Ne,Ae,Ge,je,ke,pe,Oe,ie,Mn,fn,lt=[],ne=[],Ee=[],xe=!1,Se={},Ve=[],Xe=[],Ht={},cn=0,xn=!1,$t=!1,it=!0,_t=!1,Kt=!0,qn=!1;const li=Ce,en=[],Dt=[],Ie=[],Ct=[],on=[],Rn=[],Vn=[],Ut=[],Hn=[],qe=[],Nt=[],Xt="function"==typeof AnimationEffect||void 0!==h.w&&"function"==typeof h.w.AnimationEffect,Tn="function"==typeof Element&&"function"==typeof Element.prototype.animate&&Xt,xi=()=>Nt,_n=(J,be)=>{const ft=be.findIndex(mt=>mt.c===J);ft>-1&&be.splice(ft,1)},pn=(J,be)=>((be?.oneTimeCallback?Dt:en).push({c:J,o:be}),fn),Cn=()=>{if(Tn)Nt.forEach(J=>{J.cancel()}),Nt.length=0;else{const J=Ct.slice();(0,p.r)(()=>{J.forEach(be=>{oe(be,"animation-name"),oe(be,"animation-duration"),oe(be,"animation-timing-function"),oe(be,"animation-iteration-count"),oe(be,"animation-delay"),oe(be,"animation-play-state"),oe(be,"animation-fill-mode"),oe(be,"animation-direction")})})}},$i=()=>{Rn.forEach(J=>{J?.parentNode&&J.parentNode.removeChild(J)}),Rn.length=0},ae=()=>void 0!==Ae?Ae:je?je.getFill():"both",ht=()=>void 0!==pe?pe:void 0!==Ge?Ge:je?je.getDirection():"normal",G=()=>xn?"linear":void 0!==Be?Be:je?je.getEasing():"linear",ze=()=>$t?0:void 0!==Oe?Oe:void 0!==Pe?Pe:je?je.getDuration():0,at=()=>void 0!==Ne?Ne:je?je.getIterations():1,rn=()=>void 0!==ie?ie:void 0!==de?de:je?je.getDelay():0,qi=()=>{0!==cn&&(cn--,0===cn&&((()=>{rt(),Hn.forEach(yn=>yn()),qe.forEach(yn=>yn());const J=it?1:0,be=Ve,ft=Xe,mt=Ht;Ct.forEach(yn=>{const jt=yn.classList;be.forEach(Fn=>jt.add(Fn)),ft.forEach(Fn=>jt.remove(Fn));for(const Fn in mt)mt.hasOwnProperty(Fn)&&C(yn,Fn,mt[Fn])}),en.forEach(yn=>yn.c(J,fn)),Dt.forEach(yn=>yn.c(J,fn)),Dt.length=0,Kt=!0,it&&(_t=!0),it=!0})(),je&&je.animationFinish()))},Ci=(J=!0)=>{$i();const be=(Ce=>(Ce.forEach(de=>{for(const Pe in de)if(de.hasOwnProperty(Pe)){const Be=de[Pe];if("easing"===Pe)de["animation-timing-function"]=Be,delete de[Pe];else{const Ne=j(Pe);Ne!==Pe&&(de[Ne]=Be,delete de[Pe])}}}),Ce))(lt);Ct.forEach(ft=>{if(be.length>0){const mt=((Ce=[])=>Ce.map(de=>{const Pe=de.offset,Be=[];for(const Ne in de)de.hasOwnProperty(Ne)&&"offset"!==Ne&&Be.push(`${Ne}: ${de[Ne]};`);return`${100*Pe}% { ${Be.join(" ")} }`}).join(" "))(be);Mn=void 0!==Ce?Ce:(Ce=>{let de=ee.indexOf(Ce);return de<0&&(de=ee.push(Ce)-1),`ion-animation-${de}`})(mt);const yn=((Ce,de,Pe)=>{var Be;const Ne=(Ce=>{const de=void 0!==Ce.getRootNode?Ce.getRootNode():Ce;return de.head||de})(Pe),Ae=K(Pe),Ge=Ne.querySelector("#"+Ce);if(Ge)return Ge;const lt=(null!==(Be=Pe.ownerDocument)&&void 0!==Be?Be:document).createElement("style");return lt.id=Ce,lt.textContent=`@${Ae}keyframes ${Ce} { ${de} } @${Ae}keyframes ${Ce}-alt { ${de} }`,Ne.appendChild(lt),lt})(Mn,mt,ft);Rn.push(yn),C(ft,"animation-duration",`${ze()}ms`),C(ft,"animation-timing-function",G()),C(ft,"animation-delay",`${rn()}ms`),C(ft,"animation-fill-mode",ae()),C(ft,"animation-direction",ht());const jt=at()===1/0?"infinite":at().toString();C(ft,"animation-iteration-count",jt),C(ft,"animation-play-state","paused"),J&&C(ft,"animation-name",`${yn.id}-alt`),(0,p.r)(()=>{C(ft,"animation-name",yn.id||null)})}})},Yt=(J=!0)=>{(()=>{Vn.forEach(mt=>mt()),Ut.forEach(mt=>mt());const J=ne,be=Ee,ft=Se;Ct.forEach(mt=>{const yn=mt.classList;J.forEach(jt=>yn.add(jt)),be.forEach(jt=>yn.remove(jt));for(const jt in ft)ft.hasOwnProperty(jt)&&C(mt,jt,ft[jt])})})(),lt.length>0&&(Tn?(Ct.forEach(J=>{const be=J.animate(lt,{id:li,delay:rn(),duration:ze(),easing:G(),iterations:at(),fill:ae(),direction:ht()});be.pause(),Nt.push(be)}),Nt.length>0&&(Nt[0].onfinish=()=>{qi()})):Ci(J)),xe=!0},Tt=J=>{if(J=Math.min(Math.max(J,0),.9999),Tn)Nt.forEach(be=>{be.currentTime=be.effect.getComputedTiming().delay+ze()*J,be.pause()});else{const be=`-${ze()*J}ms`;Ct.forEach(ft=>{lt.length>0&&(C(ft,"animation-delay",be),C(ft,"animation-play-state","paused"))})}},Mt=J=>{Nt.forEach(be=>{be.effect.updateTiming({delay:rn(),duration:ze(),easing:G(),iterations:at(),fill:ae(),direction:ht()})}),void 0!==J&&Tt(J)},Qt=(J=!0,be)=>{(0,p.r)(()=>{Ct.forEach(ft=>{C(ft,"animation-name",Mn||null),C(ft,"animation-duration",`${ze()}ms`),C(ft,"animation-timing-function",G()),C(ft,"animation-delay",void 0!==be?`-${be*ze()}ms`:`${rn()}ms`),C(ft,"animation-fill-mode",ae()||null),C(ft,"animation-direction",ht()||null);const mt=at()===1/0?"infinite":at().toString();C(ft,"animation-iteration-count",mt),J&&C(ft,"animation-name",`${Mn}-alt`),(0,p.r)(()=>{C(ft,"animation-name",Mn||null)})})})},wn=(J=!1,be=!0,ft)=>(J&&on.forEach(mt=>{mt.update(J,be,ft)}),Tn?Mt(ft):Qt(be,ft),fn),Wn=()=>{xe&&(Tn?Nt.forEach(J=>{J.pause()}):Ct.forEach(J=>{C(J,"animation-play-state","paused")}),qn=!0)},Je=()=>{ke=void 0,qi()},rt=()=>{ke&&clearTimeout(ke)},gn=J=>new Promise(be=>{J?.sync&&($t=!0,pn(()=>$t=!1,{oneTimeCallback:!0})),xe||Yt(),_t&&(Tn?(Tt(0),Mt()):Qt(),_t=!1),Kt&&(cn=on.length+1,Kt=!1);const ft=()=>{_n(mt,Dt),be()},mt=()=>{_n(ft,Ie),be()};pn(mt,{oneTimeCallback:!0}),((J,be)=>{Ie.push({c:J,o:{oneTimeCallback:!0}})})(ft),on.forEach(yn=>{yn.play()}),Tn?(Nt.forEach(J=>{J.play()}),(0===lt.length||0===Ct.length)&&qi()):(()=>{if(rt(),(0,p.r)(()=>{Ct.forEach(J=>{lt.length>0&&C(J,"animation-play-state","running")})}),0===lt.length||0===Ct.length)qi();else{const J=rn()||0,be=ze()||0,ft=at()||1;isFinite(ft)&&(ke=setTimeout(Je,J+be*ft+100)),((Ce,de)=>{let Pe;const Be={passive:!0},Ae=Ge=>{Ce===Ge.target&&(Pe&&Pe(),rt(),(0,p.r)(()=>{Ct.forEach(J=>{oe(J,"animation-duration"),oe(J,"animation-delay"),oe(J,"animation-play-state")}),(0,p.r)(qi)}))};Ce&&(Ce.addEventListener("webkitAnimationEnd",Ae,Be),Ce.addEventListener("animationend",Ae,Be),Pe=()=>{Ce.removeEventListener("webkitAnimationEnd",Ae,Be),Ce.removeEventListener("animationend",Ae,Be)})})(Ct[0])}})(),qn=!1}),di=(J,be)=>{const ft=lt[0];return void 0===ft||void 0!==ft.offset&&0!==ft.offset?lt=[{offset:0,[J]:be},...lt]:ft[J]=be,fn};return fn={parentAnimation:je,elements:Ct,childAnimations:on,id:li,animationFinish:qi,from:di,to:(J,be)=>{const ft=lt[lt.length-1];return void 0===ft||void 0!==ft.offset&&1!==ft.offset?lt=[...lt,{offset:1,[J]:be}]:ft[J]=be,fn},fromTo:(J,be,ft)=>di(J,be).to(J,ft),parent:J=>(je=J,fn),play:gn,pause:()=>(on.forEach(J=>{J.pause()}),Wn(),fn),stop:()=>{on.forEach(J=>{J.stop()}),xe&&(Cn(),xe=!1),xn=!1,$t=!1,Kt=!0,pe=void 0,Oe=void 0,ie=void 0,cn=0,_t=!1,it=!0,qn=!1,Ie.forEach(J=>J.c(0,fn)),Ie.length=0},destroy:J=>(on.forEach(be=>{be.destroy(J)}),(J=>{Cn(),J&&$i()})(J),Ct.length=0,on.length=0,lt.length=0,en.length=0,Dt.length=0,xe=!1,Kt=!0,fn),keyframes:J=>{const be=lt!==J;return lt=J,be&&(J=>{Tn?xi().forEach(be=>{const ft=be.effect;if(ft.setKeyframes)ft.setKeyframes(J);else{const mt=new KeyframeEffect(ft.target,J,ft.getTiming());be.effect=mt}}):Ci()})(lt),fn},addAnimation:J=>{if(null!=J)if(Array.isArray(J))for(const be of J)be.parent(fn),on.push(be);else J.parent(fn),on.push(J);return fn},addElement:J=>{if(null!=J)if(1===J.nodeType)Ct.push(J);else if(J.length>=0)for(let be=0;be<J.length;be++)Ct.push(J[be]);else console.error("Invalid addElement value");return fn},update:wn,fill:J=>(Ae=J,wn(!0),fn),direction:J=>(Ge=J,wn(!0),fn),iterations:J=>(Ne=J,wn(!0),fn),duration:J=>(!Tn&&0===J&&(J=1),Pe=J,wn(!0),fn),easing:J=>(Be=J,wn(!0),fn),delay:J=>(de=J,wn(!0),fn),getWebAnimations:xi,getKeyframes:()=>lt,getFill:ae,getDirection:ht,getDelay:rn,getIterations:at,getEasing:G,getDuration:ze,afterAddRead:J=>(Hn.push(J),fn),afterAddWrite:J=>(qe.push(J),fn),afterClearStyles:(J=[])=>{for(const be of J)Ht[be]="";return fn},afterStyles:(J={})=>(Ht=J,fn),afterRemoveClass:J=>(Xe=me(Xe,J),fn),afterAddClass:J=>(Ve=me(Ve,J),fn),beforeAddRead:J=>(Vn.push(J),fn),beforeAddWrite:J=>(Ut.push(J),fn),beforeClearStyles:(J=[])=>{for(const be of J)Se[be]="";return fn},beforeStyles:(J={})=>(Se=J,fn),beforeRemoveClass:J=>(Ee=me(Ee,J),fn),beforeAddClass:J=>(ne=me(ne,J),fn),onFinish:pn,isRunning:()=>0!==cn&&!qn,progressStart:(J=!1,be)=>(on.forEach(ft=>{ft.progressStart(J,be)}),Wn(),xn=J,xe||Yt(),wn(!1,!0,be),fn),progressStep:J=>(on.forEach(be=>{be.progressStep(J)}),Tt(J),fn),progressEnd:(J,be,ft)=>(xn=!1,on.forEach(mt=>{mt.progressEnd(J,be,ft)}),void 0!==ft&&(Oe=ft),_t=!1,it=!0,0===J?(pe="reverse"===ht()?"normal":"reverse","reverse"===pe&&(it=!1),Tn?(wn(),Tt(1-be)):(ie=(1-be)*ze()*-1,wn(!1,!1))):1===J&&(Tn?(wn(),Tt(be)):(ie=be*ze()*-1,wn(!1,!1))),void 0!==J&&(pn(()=>{Oe=void 0,pe=void 0,ie=void 0},{oneTimeCallback:!0}),je||gn()),fn)}}},3365:(zn,wt,S)=>{"use strict";S.d(wt,{E:()=>Le,a:()=>h,s:()=>oe});const h=ee=>{try{if(ee instanceof C)return ee.value;if(!a()||"string"!=typeof ee||""===ee)return ee;if(ee.includes("onload="))return"";const Te=document.createDocumentFragment(),ye=document.createElement("div");Te.appendChild(ye),ye.innerHTML=ee,K.forEach(Ce=>{const de=Te.querySelectorAll(Ce);for(let Pe=de.length-1;Pe>=0;Pe--){const Be=de[Pe];Be.parentNode?Be.parentNode.removeChild(Be):Te.removeChild(Be);const Ne=X(Be);for(let Ae=0;Ae<Ne.length;Ae++)p(Ne[Ae])}});const De=X(Te);for(let Ce=0;Ce<De.length;Ce++)p(De[Ce]);const me=document.createElement("div");me.appendChild(Te);const Ye=me.querySelector("div");return null!==Ye?Ye.innerHTML:me.innerHTML}catch(Te){return console.error(Te),""}},p=ee=>{if(ee.nodeType&&1!==ee.nodeType)return;if(typeof NamedNodeMap<"u"&&!(ee.attributes instanceof NamedNodeMap))return void ee.remove();for(let ye=ee.attributes.length-1;ye>=0;ye--){const De=ee.attributes.item(ye),me=De.name;if(!j.includes(me.toLowerCase())){ee.removeAttribute(me);continue}const Ye=De.value,Ce=ee[me];(null!=Ye&&Ye.toLowerCase().includes("javascript:")||null!=Ce&&Ce.toLowerCase().includes("javascript:"))&&ee.removeAttribute(me)}const Te=X(ee);for(let ye=0;ye<Te.length;ye++)p(Te[ye])},X=ee=>null!=ee.children?ee.children:ee.childNodes,a=()=>{var ee;const Te=window,ye=null===(ee=Te?.Ionic)||void 0===ee?void 0:ee.config;return!ye||(ye.get?ye.get("sanitizerEnabled",!0):!0===ye.sanitizerEnabled||void 0===ye.sanitizerEnabled)},j=["class","id","href","src","name","slot"],K=["script","style","iframe","meta","link","object","embed"];class C{constructor(Te){this.value=Te}}const oe=ee=>{const Te=window,ye=Te.Ionic;if(!ye||!ye.config||"Object"===ye.config.constructor.name)return Te.Ionic=Te.Ionic||{},Te.Ionic.config=Object.assign(Object.assign({},Te.Ionic.config),ee),Te.Ionic.config},Le=!1},6559:(zn,wt,S)=>{"use strict";S.d(wt,{C:()=>j,a:()=>X,d:()=>a});var h=S(5861),p=S(839);const X=function(){var K=(0,h.Z)(function*(C,oe,_e,Le,ee,Te){var ye;if(C)return C.attachViewToDom(oe,_e,ee,Le);if(!(Te||"string"==typeof _e||_e instanceof HTMLElement))throw new Error("framework delegate is missing");const De="string"==typeof _e?null===(ye=oe.ownerDocument)||void 0===ye?void 0:ye.createElement(_e):_e;return Le&&Le.forEach(me=>De.classList.add(me)),ee&&Object.assign(De,ee),oe.appendChild(De),yield new Promise(me=>(0,p.c)(De,me)),De});return function(oe,_e,Le,ee,Te,ye){return K.apply(this,arguments)}}(),a=(K,C)=>{if(C){if(K)return K.removeViewFromDom(C.parentElement,C);C.remove()}return Promise.resolve()},j=()=>{let K,C;return{attachViewToDom:function(){var Le=(0,h.Z)(function*(ee,Te,ye={},De=[]){var me,Ye;let Ce;if(K=ee,Te){const Pe="string"==typeof Te?null===(me=K.ownerDocument)||void 0===me?void 0:me.createElement(Te):Te;De.forEach(Be=>Pe.classList.add(Be)),Object.assign(Pe,ye),K.appendChild(Pe),Ce=Pe,yield new Promise(Be=>(0,p.c)(Pe,Be))}else if(K.children.length>0&&("ION-MODAL"===K.tagName||"ION-POPOVER"===K.tagName)&&!(Ce=K.children[0]).classList.contains("ion-delegate-host")){const Be=null===(Ye=K.ownerDocument)||void 0===Ye?void 0:Ye.createElement("div");Be.classList.add("ion-delegate-host"),De.forEach(Ne=>Be.classList.add(Ne)),Be.append(...K.children),K.appendChild(Be),Ce=Be}const de=document.querySelector("ion-app")||document.body;return C=document.createComment("ionic teleport"),K.parentNode.insertBefore(C,K),de.appendChild(K),Ce??K});return function(Te,ye){return Le.apply(this,arguments)}}(),removeViewFromDom:()=>(K&&C&&(C.parentNode.insertBefore(K,C),C.remove()),Promise.resolve())}}},619:(zn,wt,S)=>{"use strict";S.d(wt,{G:()=>j});class p{constructor(C,oe,_e,Le,ee){this.id=oe,this.name=_e,this.disableScroll=ee,this.priority=1e6*Le+oe,this.ctrl=C}canStart(){return!!this.ctrl&&this.ctrl.canStart(this.name)}start(){return!!this.ctrl&&this.ctrl.start(this.name,this.id,this.priority)}capture(){if(!this.ctrl)return!1;const C=this.ctrl.capture(this.name,this.id,this.priority);return C&&this.disableScroll&&this.ctrl.disableScroll(this.id),C}release(){this.ctrl&&(this.ctrl.release(this.id),this.disableScroll&&this.ctrl.enableScroll(this.id))}destroy(){this.release(),this.ctrl=void 0}}class X{constructor(C,oe,_e,Le){this.id=oe,this.disable=_e,this.disableScroll=Le,this.ctrl=C}block(){if(this.ctrl){if(this.disable)for(const C of this.disable)this.ctrl.disableGesture(C,this.id);this.disableScroll&&this.ctrl.disableScroll(this.id)}}unblock(){if(this.ctrl){if(this.disable)for(const C of this.disable)this.ctrl.enableGesture(C,this.id);this.disableScroll&&this.ctrl.enableScroll(this.id)}}destroy(){this.unblock(),this.ctrl=void 0}}const a="backdrop-no-scroll",j=new class h{constructor(){this.gestureId=0,this.requestedStart=new Map,this.disabledGestures=new Map,this.disabledScroll=new Set}createGesture(C){var oe;return new p(this,this.newID(),C.name,null!==(oe=C.priority)&&void 0!==oe?oe:0,!!C.disableScroll)}createBlocker(C={}){return new X(this,this.newID(),C.disable,!!C.disableScroll)}start(C,oe,_e){return this.canStart(C)?(this.requestedStart.set(oe,_e),!0):(this.requestedStart.delete(oe),!1)}capture(C,oe,_e){if(!this.start(C,oe,_e))return!1;const Le=this.requestedStart;let ee=-1e4;if(Le.forEach(Te=>{ee=Math.max(ee,Te)}),ee===_e){this.capturedId=oe,Le.clear();const Te=new CustomEvent("ionGestureCaptured",{detail:{gestureName:C}});return document.dispatchEvent(Te),!0}return Le.delete(oe),!1}release(C){this.requestedStart.delete(C),this.capturedId===C&&(this.capturedId=void 0)}disableGesture(C,oe){let _e=this.disabledGestures.get(C);void 0===_e&&(_e=new Set,this.disabledGestures.set(C,_e)),_e.add(oe)}enableGesture(C,oe){const _e=this.disabledGestures.get(C);void 0!==_e&&_e.delete(oe)}disableScroll(C){this.disabledScroll.add(C),1===this.disabledScroll.size&&document.body.classList.add(a)}enableScroll(C){this.disabledScroll.delete(C),0===this.disabledScroll.size&&document.body.classList.remove(a)}canStart(C){return!(void 0!==this.capturedId||this.isDisabled(C))}isCaptured(){return void 0!==this.capturedId}isScrollDisabled(){return this.disabledScroll.size>0}isDisabled(C){const oe=this.disabledGestures.get(C);return!!(oe&&oe.size>0)}newID(){return this.gestureId++,this.gestureId}}},2124:(zn,wt,S)=>{"use strict";S.r(wt),S.d(wt,{MENU_BACK_BUTTON_PRIORITY:()=>j,OVERLAY_BACK_BUTTON_PRIORITY:()=>a,blockHardwareBackButton:()=>p,startHardwareBackButton:()=>X});var h=S(5861);const p=()=>{document.addEventListener("backbutton",()=>{})},X=()=>{const K=document;let C=!1;K.addEventListener("backbutton",()=>{if(C)return;let oe=0,_e=[];const Le=new CustomEvent("ionBackButton",{bubbles:!1,detail:{register(ye,De){_e.push({priority:ye,handler:De,id:oe++})}}});K.dispatchEvent(Le);const ee=function(){var ye=(0,h.Z)(function*(De){try{if(De?.handler){const me=De.handler(Te);null!=me&&(yield me)}}catch(me){console.error(me)}});return function(me){return ye.apply(this,arguments)}}(),Te=()=>{if(_e.length>0){let ye={priority:Number.MIN_SAFE_INTEGER,handler:()=>{},id:-1};_e.forEach(De=>{De.priority>=ye.priority&&(ye=De)}),C=!0,_e=_e.filter(De=>De.id!==ye.id),ee(ye).then(()=>C=!1)}};Te()})},a=100,j=99},839:(zn,wt,S)=>{"use strict";S.d(wt,{a:()=>oe,b:()=>_e,c:()=>X,d:()=>Ye,e:()=>me,f:()=>De,g:()=>Le,h:()=>ye,i:()=>C,j:()=>Ae,k:()=>j,l:()=>Ce,m:()=>a,n:()=>Te,o:()=>de,p:()=>Ne,q:()=>Ge,r:()=>ee,s:()=>lt,t:()=>h,u:()=>Pe,v:()=>Be});const h=(ne,Ee=0)=>new Promise(xe=>{p(ne,Ee,xe)}),p=(ne,Ee=0,xe)=>{let je,Se;const Ve={passive:!0},Ht=()=>{je&&je()},cn=xn=>{(void 0===xn||ne===xn.target)&&(Ht(),xe(xn))};return ne&&(ne.addEventListener("webkitTransitionEnd",cn,Ve),ne.addEventListener("transitionend",cn,Ve),Se=setTimeout(cn,Ee+500),je=()=>{Se&&(clearTimeout(Se),Se=void 0),ne.removeEventListener("webkitTransitionEnd",cn,Ve),ne.removeEventListener("transitionend",cn,Ve)}),Ht},X=(ne,Ee)=>{ne.componentOnReady?ne.componentOnReady().then(xe=>Ee(xe)):ee(()=>Ee(ne))},a=ne=>void 0!==ne.componentOnReady,j=(ne,Ee=[])=>{const xe={};return Ee.forEach(je=>{ne.hasAttribute(je)&&(null!==ne.getAttribute(je)&&(xe[je]=ne.getAttribute(je)),ne.removeAttribute(je))}),xe},K=["role","aria-activedescendant","aria-atomic","aria-autocomplete","aria-braillelabel","aria-brailleroledescription","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colindextext","aria-colspan","aria-controls","aria-current","aria-describedby","aria-description","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowindextext","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext"],C=(ne,Ee)=>{let xe=K;return Ee&&Ee.length>0&&(xe=xe.filter(je=>!Ee.includes(je))),j(ne,xe)},oe=(ne,Ee,xe,je)=>{var Se;if(typeof window<"u"){const Ve=window,Xe=null===(Se=Ve?.Ionic)||void 0===Se?void 0:Se.config;if(Xe){const Ht=Xe.get("_ael");if(Ht)return Ht(ne,Ee,xe,je);if(Xe._ael)return Xe._ael(ne,Ee,xe,je)}}return ne.addEventListener(Ee,xe,je)},_e=(ne,Ee,xe,je)=>{var Se;if(typeof window<"u"){const Ve=window,Xe=null===(Se=Ve?.Ionic)||void 0===Se?void 0:Se.config;if(Xe){const Ht=Xe.get("_rel");if(Ht)return Ht(ne,Ee,xe,je);if(Xe._rel)return Xe._rel(ne,Ee,xe,je)}}return ne.removeEventListener(Ee,xe,je)},Le=(ne,Ee=ne)=>ne.shadowRoot||Ee,ee=ne=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(ne):"function"==typeof requestAnimationFrame?requestAnimationFrame(ne):setTimeout(ne),Te=ne=>!!ne.shadowRoot&&!!ne.attachShadow,ye=ne=>{const Ee=ne.closest("ion-item");return Ee?Ee.querySelector("ion-label"):null},De=ne=>{if(ne.focus(),ne.classList.contains("ion-focusable")){const Ee=ne.closest("ion-app");Ee&&Ee.setFocus([ne])}},me=(ne,Ee)=>{let xe;const je=ne.getAttribute("aria-labelledby"),Se=ne.id;let Ve=null!==je&&""!==je.trim()?je:Ee+"-lbl",Xe=null!==je&&""!==je.trim()?document.getElementById(je):ye(ne);return Xe?(null===je&&(Xe.id=Ve),xe=Xe.textContent,Xe.setAttribute("aria-hidden","true")):""!==Se.trim()&&(Xe=document.querySelector(`label[for="${Se}"]`),Xe&&(""!==Xe.id?Ve=Xe.id:Xe.id=Ve=`${Se}-lbl`,xe=Xe.textContent)),{label:Xe,labelId:Ve,labelText:xe}},Ye=(ne,Ee,xe,je,Se)=>{if(ne||Te(Ee)){let Ve=Ee.querySelector("input.aux-input");Ve||(Ve=Ee.ownerDocument.createElement("input"),Ve.type="hidden",Ve.classList.add("aux-input"),Ee.appendChild(Ve)),Ve.disabled=Se,Ve.name=xe,Ve.value=je||""}},Ce=(ne,Ee,xe)=>Math.max(ne,Math.min(Ee,xe)),de=(ne,Ee)=>{if(!ne){const xe="ASSERT: "+Ee;throw console.error(xe),new Error(xe)}},Pe=ne=>ne.timeStamp||Date.now(),Be=ne=>{if(ne){const Ee=ne.changedTouches;if(Ee&&Ee.length>0){const xe=Ee[0];return{x:xe.clientX,y:xe.clientY}}if(void 0!==ne.pageX)return{x:ne.pageX,y:ne.pageY}}return{x:0,y:0}},Ne=ne=>{const Ee="rtl"===document.dir;switch(ne){case"start":return Ee;case"end":return!Ee;default:throw new Error(`"${ne}" is not a valid value for [side]. Use "start" or "end" instead.`)}},Ae=(ne,Ee)=>{const xe=ne._original||ne;return{_original:ne,emit:Ge(xe.emit.bind(xe),Ee)}},Ge=(ne,Ee=0)=>{let xe;return(...je)=>{clearTimeout(xe),xe=setTimeout(ne,Ee,...je)}},lt=(ne,Ee)=>{if(ne??(ne={}),Ee??(Ee={}),ne===Ee)return!0;const xe=Object.keys(ne);if(xe.length!==Object.keys(Ee).length)return!1;for(const je of xe)if(!(je in Ee)||ne[je]!==Ee[je])return!1;return!0}},1783:(zn,wt,S)=>{"use strict";S.d(wt,{m:()=>Te});var h=S(5861),p=S(6710),X=S(2124),a=S(839),j=S(3882),K=S(6410);const C=ye=>(0,K.c)().duration(ye?400:300),oe=ye=>{let De,me;const Ye=ye.width+8,Ce=(0,K.c)(),de=(0,K.c)();ye.isEndSide?(De=Ye+"px",me="0px"):(De=-Ye+"px",me="0px"),Ce.addElement(ye.menuInnerEl).fromTo("transform",`translateX(${De})`,`translateX(${me})`);const Be="ios"===(0,j.b)(ye),Ne=Be?.2:.25;return de.addElement(ye.backdropEl).fromTo("opacity",.01,Ne),C(Be).addAnimation([Ce,de])},_e=ye=>{let De,me;const Ye=(0,j.b)(ye),Ce=ye.width;ye.isEndSide?(De=-Ce+"px",me=Ce+"px"):(De=Ce+"px",me=-Ce+"px");const de=(0,K.c)().addElement(ye.menuInnerEl).fromTo("transform",`translateX(${me})`,"translateX(0px)"),Pe=(0,K.c)().addElement(ye.contentEl).fromTo("transform","translateX(0px)",`translateX(${De})`),Be=(0,K.c)().addElement(ye.backdropEl).fromTo("opacity",.01,.32);return C("ios"===Ye).addAnimation([de,Pe,Be])},Le=ye=>{const De=(0,j.b)(ye),me=ye.width*(ye.isEndSide?-1:1)+"px",Ye=(0,K.c)().addElement(ye.contentEl).fromTo("transform","translateX(0px)",`translateX(${me})`);return C("ios"===De).addAnimation(Ye)},Te=(()=>{const ye=new Map,De=[],me=function(){var ke=(0,h.Z)(function*(pe){const Oe=yield Ae(pe,!0);return!!Oe&&Oe.open()});return function(Oe){return ke.apply(this,arguments)}}(),Ye=function(){var ke=(0,h.Z)(function*(pe){const Oe=yield void 0!==pe?Ae(pe,!0):Ge();return void 0!==Oe&&Oe.close()});return function(Oe){return ke.apply(this,arguments)}}(),Ce=function(){var ke=(0,h.Z)(function*(pe){const Oe=yield Ae(pe,!0);return!!Oe&&Oe.toggle()});return function(Oe){return ke.apply(this,arguments)}}(),de=function(){var ke=(0,h.Z)(function*(pe,Oe){const ie=yield Ae(Oe);return ie&&(ie.disabled=!pe),ie});return function(Oe,ie){return ke.apply(this,arguments)}}(),Pe=function(){var ke=(0,h.Z)(function*(pe,Oe){const ie=yield Ae(Oe);return ie&&(ie.swipeGesture=pe),ie});return function(Oe,ie){return ke.apply(this,arguments)}}(),Be=function(){var ke=(0,h.Z)(function*(pe){if(null!=pe){const Oe=yield Ae(pe);return void 0!==Oe&&Oe.isOpen()}return void 0!==(yield Ge())});return function(Oe){return ke.apply(this,arguments)}}(),Ne=function(){var ke=(0,h.Z)(function*(pe){const Oe=yield Ae(pe);return!!Oe&&!Oe.disabled});return function(Oe){return ke.apply(this,arguments)}}(),Ae=function(){var ke=(0,h.Z)(function*(pe,Oe=!1){if(yield $t(),"start"===pe||"end"===pe){const it=De.filter(Kt=>Kt.side===pe&&!Kt.disabled);if(it.length>=1)return it.length>1&&Oe&&(0,p.p)(`menuController queried for a menu on the "${pe}" side, but ${it.length} menus were found. The first menu reference will be used. If this is not the behavior you want then pass the ID of the menu instead of its side.`,it.map(Kt=>Kt.el)),it[0].el;const _t=De.filter(Kt=>Kt.side===pe);if(_t.length>=1)return _t.length>1&&Oe&&(0,p.p)(`menuController queried for a menu on the "${pe}" side, but ${_t.length} menus were found. The first menu reference will be used. If this is not the behavior you want then pass the ID of the menu instead of its side.`,_t.map(Kt=>Kt.el)),_t[0].el}else if(null!=pe)return xn(it=>it.menuId===pe);return xn(it=>!it.disabled)||(De.length>0?De[0].el:void 0)});return function(Oe){return ke.apply(this,arguments)}}(),Ge=function(){var ke=(0,h.Z)(function*(){return yield $t(),Xe()});return function(){return ke.apply(this,arguments)}}(),lt=function(){var ke=(0,h.Z)(function*(){return yield $t(),Ht()});return function(){return ke.apply(this,arguments)}}(),ne=function(){var ke=(0,h.Z)(function*(){return yield $t(),cn()});return function(){return ke.apply(this,arguments)}}(),Ee=(ke,pe)=>{ye.set(ke,pe)},Se=function(){var ke=(0,h.Z)(function*(pe,Oe,ie){if(cn())return!1;if(Oe){const it=yield Ge();it&&pe.el!==it&&(yield it.setOpen(!1,!1))}return pe._setOpen(Oe,ie)});return function(Oe,ie,it){return ke.apply(this,arguments)}}(),Xe=()=>xn(ke=>ke._isOpen),Ht=()=>De.map(ke=>ke.el),cn=()=>De.some(ke=>ke.isAnimating),xn=ke=>{const pe=De.find(ke);if(void 0!==pe)return pe.el},$t=()=>Promise.all(Array.from(document.querySelectorAll("ion-menu")).map(ke=>new Promise(pe=>(0,a.c)(ke,pe))));return Ee("reveal",Le),Ee("push",_e),Ee("overlay",oe),typeof document<"u"&&document.addEventListener("ionBackButton",ke=>{const pe=Xe();pe&&ke.detail.register(X.MENU_BACK_BUTTON_PRIORITY,()=>pe.close())}),{registerAnimation:Ee,get:Ae,getMenus:lt,getOpen:Ge,isEnabled:Ne,swipeGesture:Pe,isAnimating:ne,isOpen:Be,enable:de,toggle:Ce,close:Ye,open:me,_getOpenSync:Xe,_createAnimation:(ke,pe)=>{const Oe=ye.get(ke);if(!Oe)throw new Error("animation not registered");return Oe(pe)},_register:ke=>{De.indexOf(ke)<0&&De.push(ke)},_unregister:ke=>{const pe=De.indexOf(ke);pe>-1&&De.splice(pe,1)},_setOpen:Se}})()},6710:(zn,wt,S)=>{"use strict";S.d(wt,{a:()=>p,b:()=>X,p:()=>h});const h=(a,...j)=>console.warn(`[Ionic Warning]: ${a}`,...j),p=(a,...j)=>console.error(`[Ionic Error]: ${a}`,...j),X=(a,...j)=>console.error(`<${a.tagName.toLowerCase()}> must be used inside ${j.join(" or ")}.`)},448:(zn,wt,S)=>{"use strict";S.d(wt,{b:()=>K,c:()=>C,d:()=>oe,e:()=>ne,g:()=>je,l:()=>Ge,s:()=>Ee,t:()=>ee,w:()=>lt});var h=S(5861),p=S(5349),X=S(839);const K="ionViewWillLeave",C="ionViewDidLeave",oe="ionViewWillUnload",ee=Se=>new Promise((Ve,Xe)=>{(0,p.w)(()=>{Te(Se),ye(Se).then(Ht=>{Ht.animation&&Ht.animation.destroy(),De(Se),Ve(Ht)},Ht=>{De(Se),Xe(Ht)})})}),Te=Se=>{const Ve=Se.enteringEl,Xe=Se.leavingEl;xe(Ve,Xe,Se.direction),Se.showGoBack?Ve.classList.add("can-go-back"):Ve.classList.remove("can-go-back"),Ee(Ve,!1),Ve.style.setProperty("pointer-events","none"),Xe&&(Ee(Xe,!1),Xe.style.setProperty("pointer-events","none"))},ye=function(){var Se=(0,h.Z)(function*(Ve){const Xe=yield me(Ve);return Xe&&p.B.isBrowser?Ye(Xe,Ve):Ce(Ve)});return function(Xe){return Se.apply(this,arguments)}}(),De=Se=>{const Ve=Se.enteringEl,Xe=Se.leavingEl;Ve.classList.remove("ion-page-invisible"),Ve.style.removeProperty("pointer-events"),void 0!==Xe&&(Xe.classList.remove("ion-page-invisible"),Xe.style.removeProperty("pointer-events"))},me=function(){var Se=(0,h.Z)(function*(Ve){return Ve.leavingEl&&Ve.animated&&0!==Ve.duration?Ve.animationBuilder?Ve.animationBuilder:"ios"===Ve.mode?(yield Promise.resolve().then(S.bind(S,2619))).iosTransitionAnimation:(yield Promise.resolve().then(S.bind(S,9023))).mdTransitionAnimation:void 0});return function(Xe){return Se.apply(this,arguments)}}(),Ye=function(){var Se=(0,h.Z)(function*(Ve,Xe){yield de(Xe,!0);const Ht=Ve(Xe.baseEl,Xe);Ne(Xe.enteringEl,Xe.leavingEl);const cn=yield Be(Ht,Xe);return Xe.progressCallback&&Xe.progressCallback(void 0),cn&&Ae(Xe.enteringEl,Xe.leavingEl),{hasCompleted:cn,animation:Ht}});return function(Xe,Ht){return Se.apply(this,arguments)}}(),Ce=function(){var Se=(0,h.Z)(function*(Ve){const Xe=Ve.enteringEl,Ht=Ve.leavingEl;return yield de(Ve,!1),Ne(Xe,Ht),Ae(Xe,Ht),{hasCompleted:!0}});return function(Xe){return Se.apply(this,arguments)}}(),de=function(){var Se=(0,h.Z)(function*(Ve,Xe){(void 0!==Ve.deepWait?Ve.deepWait:Xe)&&(yield Promise.all([ne(Ve.enteringEl),ne(Ve.leavingEl)])),yield Pe(Ve.viewIsReady,Ve.enteringEl)});return function(Xe,Ht){return Se.apply(this,arguments)}}(),Pe=function(){var Se=(0,h.Z)(function*(Ve,Xe){Ve&&(yield Ve(Xe))});return function(Xe,Ht){return Se.apply(this,arguments)}}(),Be=(Se,Ve)=>{const Xe=Ve.progressCallback,Ht=new Promise(cn=>{Se.onFinish(xn=>cn(1===xn))});return Xe?(Se.progressStart(!0),Xe(Se)):Se.play(),Ht},Ne=(Se,Ve)=>{Ge(Ve,K),Ge(Se,"ionViewWillEnter")},Ae=(Se,Ve)=>{Ge(Se,"ionViewDidEnter"),Ge(Ve,C)},Ge=(Se,Ve)=>{if(Se){const Xe=new CustomEvent(Ve,{bubbles:!1,cancelable:!1});Se.dispatchEvent(Xe)}},lt=()=>new Promise(Se=>(0,X.r)(()=>(0,X.r)(()=>Se()))),ne=function(){var Se=(0,h.Z)(function*(Ve){const Xe=Ve;if(Xe){if(null!=Xe.componentOnReady){if(null!=(yield Xe.componentOnReady()))return}else if(null!=Xe.__registerHost)return void(yield new Promise(cn=>(0,X.r)(cn)));yield Promise.all(Array.from(Xe.children).map(ne))}});return function(Xe){return Se.apply(this,arguments)}}(),Ee=(Se,Ve)=>{Ve?(Se.setAttribute("aria-hidden","true"),Se.classList.add("ion-page-hidden")):(Se.hidden=!1,Se.removeAttribute("aria-hidden"),Se.classList.remove("ion-page-hidden"))},xe=(Se,Ve,Xe)=>{void 0!==Se&&(Se.style.zIndex="back"===Xe?"99":"101"),void 0!==Ve&&(Ve.style.zIndex="100")},je=Se=>Se.classList.contains("ion-page")?Se:Se.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")||Se},6225:(zn,wt,S)=>{"use strict";S.d(wt,{d:()=>p,w:()=>h});const h=typeof window<"u"?window:void 0,p=typeof document<"u"?document:void 0},5349:(zn,wt,S)=>{"use strict";S.d(wt,{B:()=>Te,H:()=>xn,a:()=>lr,b:()=>ho,c:()=>Mn,d:()=>en,e:()=>Kn,f:()=>li,g:()=>fn,h:()=>Ht,i:()=>ae,j:()=>ye,r:()=>Ci,w:()=>Xi});var h=S(5861);let a,j,K,C=!1,oe=!1,_e=!1,Le=!1,ee=!1;const Te={isDev:!1,isBrowser:!0,isServer:!1,isTesting:!1},ye=J=>{const be=new URL(J,Wn.$resourcesUrl$);return be.origin!==Xn.location.origin?be.href:be.pathname},Be="s-id",Ne="sty-id",lt="slot-fb{display:contents}slot-fb[hidden]{display:none}",ne="http://www.w3.org/1999/xlink",Ee={},Ve=J=>"object"==(J=typeof J)||"function"===J;function Xe(J){var be,ft,mt;return null!==(mt=null===(ft=null===(be=J.head)||void 0===be?void 0:be.querySelector('meta[name="csp-nonce"]'))||void 0===ft?void 0:ft.getAttribute("content"))&&void 0!==mt?mt:void 0}const Ht=(J,be,...ft)=>{let mt=null,yn=null,jt=null,Fn=!1,$n=!1;const Un=[],Ln=Ri=>{for(let Gi=0;Gi<Ri.length;Gi++)mt=Ri[Gi],Array.isArray(mt)?Ln(mt):null!=mt&&"boolean"!=typeof mt&&((Fn="function"!=typeof J&&!Ve(mt))&&(mt=String(mt)),Fn&&$n?Un[Un.length-1].$text$+=mt:Un.push(Fn?cn(null,mt):mt),$n=Fn)};if(Ln(ft),be){be.key&&(yn=be.key),be.name&&(jt=be.name);{const Ri=be.className||be.class;Ri&&(be.class="object"!=typeof Ri?Ri:Object.keys(Ri).filter(Gi=>Ri[Gi]).join(" "))}}if("function"==typeof J)return J(null===be?{}:be,Un,ke);const ci=cn(J,null);return ci.$attrs$=be,Un.length>0&&(ci.$children$=Un),ci.$key$=yn,ci.$name$=jt,ci},cn=(J,be)=>({$flags$:0,$tag$:J,$text$:be,$elm$:null,$children$:null,$attrs$:null,$key$:null,$name$:null}),xn={},ke={forEach:(J,be)=>J.map(pe).forEach(be),map:(J,be)=>J.map(pe).map(be).map(Oe)},pe=J=>({vattrs:J.$attrs$,vchildren:J.$children$,vkey:J.$key$,vname:J.$name$,vtag:J.$tag$,vtext:J.$text$}),Oe=J=>{if("function"==typeof J.vtag){const ft=Object.assign({},J.vattrs);return J.vkey&&(ft.key=J.vkey),J.vname&&(ft.name=J.vname),Ht(J.vtag,ft,...J.vchildren||[])}const be=cn(J.vtag,J.vtext);return be.$attrs$=J.vattrs,be.$children$=J.vchildren,be.$key$=J.vkey,be.$name$=J.vname,be},it=(J,be,ft,mt,yn,jt,Fn)=>{let $n,Un,Ln,ci;if(1===jt.nodeType){for($n=jt.getAttribute("c-id"),$n&&(Un=$n.split("."),(Un[0]===Fn||"0"===Un[0])&&(Ln={$flags$:0,$hostId$:Un[0],$nodeId$:Un[1],$depth$:Un[2],$index$:Un[3],$tag$:jt.tagName.toLowerCase(),$elm$:jt,$attrs$:null,$children$:null,$key$:null,$name$:null,$text$:null},be.push(Ln),jt.removeAttribute("c-id"),J.$children$||(J.$children$=[]),J.$children$[Ln.$index$]=Ln,J=Ln,mt&&"0"===Ln.$depth$&&(mt[Ln.$index$]=Ln.$elm$))),ci=jt.childNodes.length-1;ci>=0;ci--)it(J,be,ft,mt,yn,jt.childNodes[ci],Fn);if(jt.shadowRoot)for(ci=jt.shadowRoot.childNodes.length-1;ci>=0;ci--)it(J,be,ft,mt,yn,jt.shadowRoot.childNodes[ci],Fn)}else if(8===jt.nodeType)Un=jt.nodeValue.split("."),(Un[1]===Fn||"0"===Un[1])&&($n=Un[0],Ln={$flags$:0,$hostId$:Un[1],$nodeId$:Un[2],$depth$:Un[3],$index$:Un[4],$elm$:jt,$attrs$:null,$children$:null,$key$:null,$name$:null,$tag$:null,$text$:null},"t"===$n?(Ln.$elm$=jt.nextSibling,Ln.$elm$&&3===Ln.$elm$.nodeType&&(Ln.$text$=Ln.$elm$.textContent,be.push(Ln),jt.remove(),J.$children$||(J.$children$=[]),J.$children$[Ln.$index$]=Ln,mt&&"0"===Ln.$depth$&&(mt[Ln.$index$]=Ln.$elm$))):Ln.$hostId$===Fn&&("s"===$n?(Ln.$tag$="slot",jt["s-sn"]=Un[5]?Ln.$name$=Un[5]:"",jt["s-sr"]=!0,mt&&(Ln.$elm$=ui.createElement(Ln.$tag$),Ln.$name$&&Ln.$elm$.setAttribute("name",Ln.$name$),jt.parentNode.insertBefore(Ln.$elm$,jt),jt.remove(),"0"===Ln.$depth$&&(mt[Ln.$index$]=Ln.$elm$)),ft.push(Ln),J.$children$||(J.$children$=[]),J.$children$[Ln.$index$]=Ln):"r"===$n&&(mt?jt.remove():(yn["s-cr"]=jt,jt["s-cn"]=!0))));else if(J&&"style"===J.$tag$){const Ri=cn(null,jt.textContent);Ri.$elm$=jt,Ri.$index$="0",J.$children$=[Ri]}},_t=(J,be)=>{if(1===J.nodeType){let ft=0;for(;ft<J.childNodes.length;ft++)_t(J.childNodes[ft],be);if(J.shadowRoot)for(ft=0;ft<J.shadowRoot.childNodes.length;ft++)_t(J.shadowRoot.childNodes[ft],be)}else if(8===J.nodeType){const ft=J.nodeValue.split(".");"o"===ft[0]&&(be.set(ft[1]+"."+ft[2],J),J.nodeValue="",J["s-en"]=ft[3])}},Mn=J=>It.push(J),fn=J=>qi(J).$modeName$,li=J=>qi(J).$hostElement$,en=(J,be,ft)=>{const mt=li(J);return{emit:yn=>Dt(mt,be,{bubbles:!!(4&ft),composed:!!(2&ft),cancelable:!!(1&ft),detail:yn})}},Dt=(J,be,ft)=>{const mt=Wn.ce(be,ft);return J.dispatchEvent(mt),mt},Ie=new WeakMap,Ct=(J,be,ft)=>{let mt=wn.get(J);we&&ft?(mt=mt||new CSSStyleSheet,"string"==typeof mt?mt=be:mt.replaceSync(be)):mt=be,wn.set(J,mt)},on=(J,be,ft)=>{var mt;const yn=Vn(be,ft),jt=wn.get(yn);if(J=11===J.nodeType?J:ui,jt)if("string"==typeof jt){let $n,Fn=Ie.get(J=J.head||J);if(Fn||Ie.set(J,Fn=new Set),!Fn.has(yn)){if(J.host&&($n=J.querySelector(`[${Ne}="${yn}"]`)))$n.innerHTML=jt;else{$n=ui.createElement("style"),$n.innerHTML=jt;const Un=null!==(mt=Wn.$nonce$)&&void 0!==mt?mt:Xe(ui);null!=Un&&$n.setAttribute("nonce",Un),J.insertBefore($n,J.querySelector("link"))}4&be.$flags$&&($n.innerHTML+=lt),Fn&&Fn.add(yn)}}else J.adoptedStyleSheets.includes(jt)||(J.adoptedStyleSheets=[...J.adoptedStyleSheets,jt]);return yn},Vn=(J,be)=>"sc-"+(be&&32&J.$flags$?J.$tagName$+"-"+be:J.$tagName$),Ut=J=>J.replace(/\/\*!@([^\/]+)\*\/[^\{]+\{/g,"$1{"),Hn=(J,be,ft,mt,yn,jt)=>{if(ft!==mt){let Fn=Yt(J,be),$n=be.toLowerCase();if("class"===be){const Un=J.classList,Ln=Nt(ft),ci=Nt(mt);Un.remove(...Ln.filter(Ri=>Ri&&!ci.includes(Ri))),Un.add(...ci.filter(Ri=>Ri&&!Ln.includes(Ri)))}else if("style"===be){for(const Un in ft)(!mt||null==mt[Un])&&(Un.includes("-")?J.style.removeProperty(Un):J.style[Un]="");for(const Un in mt)(!ft||mt[Un]!==ft[Un])&&(Un.includes("-")?J.style.setProperty(Un,mt[Un]):J.style[Un]=mt[Un])}else if("key"!==be)if("ref"===be)mt&&mt(J);else if(Fn||"o"!==be[0]||"n"!==be[1]){const Un=Ve(mt);if((Fn||Un&&null!==mt)&&!yn)try{if(J.tagName.includes("-"))J[be]=mt;else{const ci=mt??"";"list"===be?Fn=!1:(null==ft||J[be]!=ci)&&(J[be]=ci)}}catch{}let Ln=!1;$n!==($n=$n.replace(/^xlink\:?/,""))&&(be=$n,Ln=!0),null==mt||!1===mt?(!1!==mt||""===J.getAttribute(be))&&(Ln?J.removeAttributeNS(ne,be):J.removeAttribute(be)):(!Fn||4&jt||yn)&&!Un&&(mt=!0===mt?"":mt,Ln?J.setAttributeNS(ne,be,mt):J.setAttribute(be,mt))}else if(be="-"===be[2]?be.slice(3):Yt(Xn,$n)?$n.slice(2):$n[2]+be.slice(3),ft||mt){const Un=be.endsWith(Xt);be=be.replace(Tn,""),ft&&Wn.rel(J,be,ft,Un),mt&&Wn.ael(J,be,mt,Un)}}},qe=/\s/,Nt=J=>J?J.split(qe):[],Xt="Capture",Tn=new RegExp(Xt+"$"),oi=(J,be,ft,mt)=>{const yn=11===be.$elm$.nodeType&&be.$elm$.host?be.$elm$.host:be.$elm$,jt=J&&J.$attrs$||Ee,Fn=be.$attrs$||Ee;for(mt in jt)mt in Fn||Hn(yn,mt,jt[mt],void 0,ft,be.$flags$);for(mt in Fn)Hn(yn,mt,jt[mt],Fn[mt],ft,be.$flags$)},xi=(J,be,ft,mt)=>{var yn;const jt=be.$children$[ft];let $n,Un,Ln,Fn=0;if(C||(_e=!0,"slot"===jt.$tag$&&(a&&mt.classList.add(a+"-s"),jt.$flags$|=jt.$children$?2:1)),null!==jt.$text$)$n=jt.$elm$=ui.createTextNode(jt.$text$);else if(1&jt.$flags$)$n=jt.$elm$=ui.createTextNode("");else{if(Le||(Le="svg"===jt.$tag$),$n=jt.$elm$=ui.createElementNS(Le?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",2&jt.$flags$?"slot-fb":jt.$tag$),Le&&"foreignObject"===jt.$tag$&&(Le=!1),oi(null,jt,Le),(J=>null!=J)(a)&&$n["s-si"]!==a&&$n.classList.add($n["s-si"]=a),jt.$children$)for(Fn=0;Fn<jt.$children$.length;++Fn)Un=xi(J,jt,Fn,$n),Un&&$n.appendChild(Un);"svg"===jt.$tag$?Le=!1:"foreignObject"===$n.tagName&&(Le=!0)}return $n["s-hn"]=K,3&jt.$flags$&&($n["s-sr"]=!0,$n["s-fs"]=null===(yn=jt.$attrs$)||void 0===yn?void 0:yn.slot,$n["s-cr"]=j,$n["s-sn"]=jt.$name$||"",Ln=J&&J.$children$&&J.$children$[ft],Ln&&Ln.$tag$===jt.$tag$&&J.$elm$&&Oi(J.$elm$,!1)),$n},Oi=(J,be)=>{var ft;Wn.$flags$|=1;const mt=J.childNodes;for(let yn=mt.length-1;yn>=0;yn--){const jt=mt[yn];jt["s-hn"]!==K&&jt["s-ol"]&&(pn(jt).insertBefore(jt,Bi(jt)),jt["s-ol"].remove(),jt["s-ol"]=void 0,jt["s-sh"]=void 0,1===jt.nodeType&&jt.setAttribute("slot",null!==(ft=jt["s-sn"])&&void 0!==ft?ft:""),_e=!0),be&&Oi(jt,be)}Wn.$flags$&=-2},gr=(J,be,ft,mt,yn,jt)=>{let $n,Fn=J["s-cr"]&&J["s-cr"].parentNode||J;for(Fn.shadowRoot&&Fn.tagName===K&&(Fn=Fn.shadowRoot);yn<=jt;++yn)mt[yn]&&($n=xi(null,ft,yn,J),$n&&(mt[yn].$elm$=$n,Fn.insertBefore($n,Bi(be))))},ki=(J,be,ft)=>{for(let mt=be;mt<=ft;++mt){const yn=J[mt];if(yn){const jt=yn.$elm$;se(yn),jt&&(oe=!0,jt["s-ol"]?jt["s-ol"].remove():Oi(jt,!0),jt.remove())}}},_n=(J,be)=>J.$tag$===be.$tag$&&("slot"===J.$tag$?J.$name$===be.$name$:J.$key$===be.$key$),Bi=J=>J&&J["s-ol"]||J,pn=J=>(J["s-ol"]?J["s-ol"]:J).parentNode,sn=(J,be)=>{const ft=be.$elm$=J.$elm$,mt=J.$children$,yn=be.$children$,jt=be.$tag$,Fn=be.$text$;let $n;null===Fn?(Le="svg"===jt||"foreignObject"!==jt&&Le,"slot"===jt||oi(J,be,Le),null!==mt&&null!==yn?((J,be,ft,mt)=>{let ur,R,yn=0,jt=0,Fn=0,$n=0,Un=be.length-1,Ln=be[0],ci=be[Un],Ri=mt.length-1,Gi=mt[0],or=mt[Ri];for(;yn<=Un&&jt<=Ri;)if(null==Ln)Ln=be[++yn];else if(null==ci)ci=be[--Un];else if(null==Gi)Gi=mt[++jt];else if(null==or)or=mt[--Ri];else if(_n(Ln,Gi))sn(Ln,Gi),Ln=be[++yn],Gi=mt[++jt];else if(_n(ci,or))sn(ci,or),ci=be[--Un],or=mt[--Ri];else if(_n(Ln,or))("slot"===Ln.$tag$||"slot"===or.$tag$)&&Oi(Ln.$elm$.parentNode,!1),sn(Ln,or),J.insertBefore(Ln.$elm$,ci.$elm$.nextSibling),Ln=be[++yn],or=mt[--Ri];else if(_n(ci,Gi))("slot"===Ln.$tag$||"slot"===or.$tag$)&&Oi(ci.$elm$.parentNode,!1),sn(ci,Gi),J.insertBefore(ci.$elm$,Ln.$elm$),ci=be[--Un],Gi=mt[++jt];else{for(Fn=-1,$n=yn;$n<=Un;++$n)if(be[$n]&&null!==be[$n].$key$&&be[$n].$key$===Gi.$key$){Fn=$n;break}Fn>=0?(R=be[Fn],R.$tag$!==Gi.$tag$?ur=xi(be&&be[jt],ft,Fn,J):(sn(R,Gi),be[Fn]=void 0,ur=R.$elm$),Gi=mt[++jt]):(ur=xi(be&&be[jt],ft,jt,J),Gi=mt[++jt]),ur&&pn(Ln.$elm$).insertBefore(ur,Bi(Ln.$elm$))}yn>Un?gr(J,null==mt[Ri+1]?null:mt[Ri+1].$elm$,ft,mt,jt,Ri):jt>Ri&&ki(be,yn,Un)})(ft,mt,be,yn):null!==yn?(null!==J.$text$&&(ft.textContent=""),gr(ft,null,be,yn,0,yn.length-1)):null!==mt&&ki(mt,0,mt.length-1),Le&&"svg"===jt&&(Le=!1)):($n=ft["s-cr"])?$n.parentNode.textContent=Fn:J.$text$!==Fn&&(ft.data=Fn)},Cn=J=>{const be=J.childNodes;for(const ft of be)if(1===ft.nodeType){if(ft["s-sr"]){const mt=ft["s-sn"];ft.hidden=!1;for(const yn of be)if(yn!==ft)if(yn["s-hn"]!==ft["s-hn"]||""!==mt){if(1===yn.nodeType&&(mt===yn.getAttribute("slot")||mt===yn["s-sn"])){ft.hidden=!0;break}}else if(1===yn.nodeType||3===yn.nodeType&&""!==yn.textContent.trim()){ft.hidden=!0;break}}Cn(ft)}},$i=[],ct=J=>{let be,ft,mt;for(const yn of J.childNodes){if(yn["s-sr"]&&(be=yn["s-cr"])&&be.parentNode){ft=be.parentNode.childNodes;const jt=yn["s-sn"];for(mt=ft.length-1;mt>=0;mt--)if(be=ft[mt],!be["s-cn"]&&!be["s-nr"]&&be["s-hn"]!==yn["s-hn"])if(ge(be,jt)){let Fn=$i.find($n=>$n.$nodeToRelocate$===be);oe=!0,be["s-sn"]=be["s-sn"]||jt,Fn?(Fn.$nodeToRelocate$["s-sh"]=yn["s-hn"],Fn.$slotRefNode$=yn):(be["s-sh"]=yn["s-hn"],$i.push({$slotRefNode$:yn,$nodeToRelocate$:be})),be["s-sr"]&&$i.map($n=>{ge($n.$nodeToRelocate$,be["s-sn"])&&(Fn=$i.find(Un=>Un.$nodeToRelocate$===be),Fn&&!$n.$slotRefNode$&&($n.$slotRefNode$=Fn.$slotRefNode$))})}else $i.some(Fn=>Fn.$nodeToRelocate$===be)||$i.push({$nodeToRelocate$:be})}1===yn.nodeType&&ct(yn)}},ge=(J,be)=>1===J.nodeType?null===J.getAttribute("slot")&&""===be||J.getAttribute("slot")===be:J["s-sn"]===be||""===be,se=J=>{J.$attrs$&&J.$attrs$.ref&&J.$attrs$.ref(null),J.$children$&&J.$children$.map(se)},yt=(J,be)=>{be&&!J.$onRenderResolve$&&be["s-p"]&&be["s-p"].push(new Promise(ft=>J.$onRenderResolve$=ft))},Ot=(J,be)=>{if(J.$flags$|=16,!(4&J.$flags$))return yt(J,J.$ancestorComponent$),Xi(()=>Gt(J,be));J.$flags$|=512},Gt=(J,be)=>{const mt=J.$lazyInstance$;let yn;return be&&(J.$flags$|=256,J.$queuedListeners$&&(J.$queuedListeners$.map(([jt,Fn])=>G(mt,jt,Fn)),J.$queuedListeners$=void 0),yn=G(mt,"componentWillLoad")),yn=Vt(yn,()=>G(mt,"componentWillRender")),Vt(yn,()=>Jt(J,mt,be))},Vt=(J,be)=>Et(J)?J.then(be):be(),Et=J=>J instanceof Promise||J&&J.then&&"function"==typeof J.then,Jt=function(){var J=(0,h.Z)(function*(be,ft,mt){var yn;const jt=be.$hostElement$,$n=jt["s-rc"];mt&&(J=>{const be=J.$cmpMeta$,ft=J.$hostElement$,mt=be.$flags$,jt=on(ft.shadowRoot?ft.shadowRoot:ft.getRootNode(),be,J.$modeName$);10&mt&&(ft["s-sc"]=jt,ft.classList.add(jt+"-h"),2&mt&&ft.classList.add(jt+"-s"))})(be);Bn(be,ft,jt,mt),$n&&($n.map(Ln=>Ln()),jt["s-rc"]=void 0);{const Ln=null!==(yn=jt["s-p"])&&void 0!==yn?yn:[],ci=()=>mn(be);0===Ln.length?ci():(Promise.all(Ln).then(ci),be.$flags$|=4,Ln.length=0)}});return function(ft,mt,yn){return J.apply(this,arguments)}}(),Bn=(J,be,ft,mt)=>{try{be=be.render&&be.render(),J.$flags$&=-17,J.$flags$|=2,((J,be,ft=!1)=>{var mt,yn;const jt=J.$hostElement$,Fn=J.$cmpMeta$,$n=J.$vnode$||cn(null,null),Un=(J=>J&&J.$tag$===xn)(be)?be:Ht(null,null,be);if(K=jt.tagName,Fn.$attrsToReflect$&&(Un.$attrs$=Un.$attrs$||{},Fn.$attrsToReflect$.map(([Ln,ci])=>Un.$attrs$[ci]=jt[Ln])),ft&&Un.$attrs$)for(const Ln of Object.keys(Un.$attrs$))jt.hasAttribute(Ln)&&!["key","ref","style","class"].includes(Ln)&&(Un.$attrs$[Ln]=jt[Ln]);if(Un.$tag$=null,Un.$flags$|=4,J.$vnode$=Un,Un.$elm$=$n.$elm$=jt.shadowRoot||jt,a=jt["s-sc"],j=jt["s-cr"],C=0!=(1&Fn.$flags$),oe=!1,sn($n,Un),Wn.$flags$|=1,_e){ct(Un.$elm$);for(const Ln of $i){const ci=Ln.$nodeToRelocate$;if(!ci["s-ol"]){const Ri=ui.createTextNode("");Ri["s-nr"]=ci,ci.parentNode.insertBefore(ci["s-ol"]=Ri,ci)}}for(const Ln of $i){const ci=Ln.$nodeToRelocate$,Ri=Ln.$slotRefNode$;if(Ri){const Gi=Ri.parentNode;let or=Ri.nextSibling;{let ur=null===(mt=ci["s-ol"])||void 0===mt?void 0:mt.previousSibling;for(;ur;){let R=null!==(yn=ur["s-nr"])&&void 0!==yn?yn:null;if(R&&R["s-sn"]===ci["s-sn"]&&Gi===R.parentNode&&(R=R.nextSibling,!R||!R["s-nr"])){or=R;break}ur=ur.previousSibling}}(!or&&Gi!==ci.parentNode||ci.nextSibling!==or)&&ci!==or&&(!ci["s-hn"]&&ci["s-ol"]&&(ci["s-hn"]=ci["s-ol"].parentNode.nodeName),Gi.insertBefore(ci,or))}else 1===ci.nodeType&&(ci.hidden=!0)}}oe&&Cn(Un.$elm$),Wn.$flags$&=-2,$i.length=0})(J,be,mt)}catch(yn){Tt(yn,J.$hostElement$)}return null},mn=J=>{const ft=J.$hostElement$,yn=J.$lazyInstance$,jt=J.$ancestorComponent$;G(yn,"componentDidRender"),64&J.$flags$?G(yn,"componentDidUpdate"):(J.$flags$|=64,ze(ft),G(yn,"componentDidLoad"),J.$onReadyResolve$(ft),jt||ht()),J.$onInstanceResolve$(ft),J.$onRenderResolve$&&(J.$onRenderResolve$(),J.$onRenderResolve$=void 0),512&J.$flags$&&di(()=>Ot(J,!1)),J.$flags$&=-517},ae=J=>{{const be=qi(J),ft=be.$hostElement$.isConnected;return ft&&2==(18&be.$flags$)&&Ot(be,!1),ft}},ht=J=>{ze(ui.documentElement),di(()=>Dt(Xn,"appload",{detail:{namespace:"ionic"}}))},G=(J,be,ft)=>{if(J&&J[be])try{return J[be](ft)}catch(mt){Tt(mt)}},ze=J=>J.classList.add("hydrated"),Dn=(J,be,ft)=>{var mt;if(be.$members$){J.watchers&&(be.$watchers$=J.watchers);const yn=Object.entries(be.$members$),jt=J.prototype;if(yn.map(([Fn,[$n]])=>{31&$n||2&ft&&32&$n?Object.defineProperty(jt,Fn,{get(){return((J,be)=>qi(this).$instanceValues$.get(be))(0,Fn)},set(Un){((J,be,ft,mt)=>{const yn=qi(J),jt=yn.$hostElement$,Fn=yn.$instanceValues$.get(be),$n=yn.$flags$,Un=yn.$lazyInstance$;ft=((J,be)=>null==J||Ve(J)?J:4&be?"false"!==J&&(""===J||!!J):2&be?parseFloat(J):1&be?String(J):J)(ft,mt.$members$[be][0]);const Ln=Number.isNaN(Fn)&&Number.isNaN(ft);if((!(8&$n)||void 0===Fn)&&ft!==Fn&&!Ln&&(yn.$instanceValues$.set(be,ft),Un)){if(mt.$watchers$&&128&$n){const Ri=mt.$watchers$[be];Ri&&Ri.map(Gi=>{try{Un[Gi](ft,Fn,be)}catch(or){Tt(or,jt)}})}2==(18&$n)&&Ot(yn,!1)}})(this,Fn,Un,be)},configurable:!0,enumerable:!0}):1&ft&&64&$n&&Object.defineProperty(jt,Fn,{value(...Un){const Ln=qi(this);return Ln.$onInstancePromise$.then(()=>Ln.$lazyInstance$[Fn](...Un))}})}),1&ft){const Fn=new Map;jt.attributeChangedCallback=function($n,Un,Ln){Wn.jmp(()=>{const ci=Fn.get($n);if(this.hasOwnProperty(ci))Ln=this[ci],delete this[ci];else{if(jt.hasOwnProperty(ci)&&"number"==typeof this[ci]&&this[ci]==Ln)return;if(null==ci){const Ri=qi(this),Gi=Ri?.$flags$;if(!(8&Gi)&&128&Gi&&Ln!==Un){const or=Ri.$lazyInstance$,ur=be.$watchers$[$n];ur?.forEach(R=>{null!=or[R]&&or[R].call(or,Ln,Un,$n)})}return}}this[ci]=(null!==Ln||"boolean"!=typeof this[ci])&&Ln})},J.observedAttributes=Array.from(new Set([...Object.keys(null!==(mt=be.$watchers$)&&void 0!==mt?mt:{}),...yn.filter(([$n,Un])=>15&Un[0]).map(([$n,Un])=>{const Ln=Un[1]||$n;return Fn.set(Ln,$n),512&Un[0]&&be.$attrsToReflect$.push([$n,Ln]),Ln})]))}}return J},gi=function(){var J=(0,h.Z)(function*(be,ft,mt,yn){let jt;if(!(32&ft.$flags$)){ft.$flags$|=32;{if(jt=Qt(mt),jt.then){const Ln=()=>{};jt=yield jt,Ln()}jt.isProxied||(mt.$watchers$=jt.watchers,Dn(jt,mt,2),jt.isProxied=!0);const Un=()=>{};ft.$flags$|=8;try{new jt(ft)}catch(Ln){Tt(Ln)}ft.$flags$&=-9,ft.$flags$|=128,Un(),Mi(ft.$lazyInstance$)}if(jt.style){let Un=jt.style;"string"!=typeof Un&&(Un=Un[ft.$modeName$=(J=>It.map(be=>be(J)).find(be=>!!be))(be)]);const Ln=Vn(mt,ft.$modeName$);if(!wn.has(Ln)){const ci=()=>{};Ct(Ln,Un,!!(1&mt.$flags$)),ci()}}}const Fn=ft.$ancestorComponent$,$n=()=>Ot(ft,!0);Fn&&Fn["s-rc"]?Fn["s-rc"].push($n):$n()});return function(ft,mt,yn,jt){return J.apply(this,arguments)}}(),Mi=J=>{G(J,"connectedCallback")},yr=J=>{const be=J["s-cr"]=ui.createComment("");be["s-cn"]=!0,J.insertBefore(be,J.firstChild)},Ui=J=>{G(J,"disconnectedCallback")},Fr=function(){var J=(0,h.Z)(function*(be){if(!(1&Wn.$flags$)){const ft=qi(be);ft.$rmListeners$&&(ft.$rmListeners$.map(mt=>mt()),ft.$rmListeners$=void 0),ft?.$lazyInstance$?Ui(ft.$lazyInstance$):ft?.$onReadyPromise$&&ft.$onReadyPromise$.then(()=>Ui(ft.$lazyInstance$))}});return function(ft){return J.apply(this,arguments)}}(),ho=(J,be={})=>{var ft;const yn=[],jt=be.exclude||[],Fn=Xn.customElements,$n=ui.head,Un=$n.querySelector("meta[charset]"),Ln=ui.createElement("style"),ci=[],Ri=ui.querySelectorAll(`[${Ne}]`);let Gi,or=!0,ur=0;for(Object.assign(Wn,be),Wn.$resourcesUrl$=new URL(be.resourcesUrl||"./",ui.baseURI).href,Wn.$flags$|=2;ur<Ri.length;ur++)Ct(Ri[ur].getAttribute(Ne),Ut(Ri[ur].innerHTML),!0);let R=!1;if(J.map($e=>{$e[1].map(H=>{var Ze;const Bt={$flags$:H[0],$tagName$:H[1],$members$:H[2],$listeners$:H[3]};4&Bt.$flags$&&(R=!0),Bt.$members$=H[2],Bt.$listeners$=H[3],Bt.$attrsToReflect$=[],Bt.$watchers$=null!==(Ze=H[4])&&void 0!==Ze?Ze:{};const Vi=Bt.$tagName$,Tr=class extends HTMLElement{constructor(ji){super(ji),Kr(ji=this,Bt),1&Bt.$flags$&&ji.attachShadow({mode:"open",delegatesFocus:!!(16&Bt.$flags$)})}connectedCallback(){Gi&&(clearTimeout(Gi),Gi=null),or?ci.push(this):Wn.jmp(()=>(J=>{if(!(1&Wn.$flags$)){const be=qi(J),ft=be.$cmpMeta$,mt=()=>{};if(1&be.$flags$)Do(J,be,ft.$listeners$),be?.$lazyInstance$?Mi(be.$lazyInstance$):be?.$onReadyPromise$&&be.$onReadyPromise$.then(()=>Mi(be.$lazyInstance$));else{let yn;if(be.$flags$|=1,yn=J.getAttribute(Be),yn){if(1&ft.$flags$){const jt=on(J.shadowRoot,ft,J.getAttribute("s-mode"));J.classList.remove(jt+"-h",jt+"-s")}((J,be,ft,mt)=>{const jt=J.shadowRoot,Fn=[],Un=jt?[]:null,Ln=mt.$vnode$=cn(be,null);Wn.$orgLocNodes$||_t(ui.body,Wn.$orgLocNodes$=new Map),J[Be]=ft,J.removeAttribute(Be),it(Ln,Fn,[],Un,J,J,ft),Fn.map(ci=>{const Ri=ci.$hostId$+"."+ci.$nodeId$,Gi=Wn.$orgLocNodes$.get(Ri),or=ci.$elm$;Gi&&Je&&""===Gi["s-en"]&&Gi.parentNode.insertBefore(or,Gi.nextSibling),jt||(or["s-hn"]=be,Gi&&(or["s-ol"]=Gi,or["s-ol"]["s-nr"]=or)),Wn.$orgLocNodes$.delete(Ri)}),jt&&Un.map(ci=>{ci&&jt.appendChild(ci)})})(J,ft.$tagName$,yn,be)}yn||12&ft.$flags$&&yr(J);{let jt=J;for(;jt=jt.parentNode||jt.host;)if(1===jt.nodeType&&jt.hasAttribute("s-id")&&jt["s-p"]||jt["s-p"]){yt(be,be.$ancestorComponent$=jt);break}}ft.$members$&&Object.entries(ft.$members$).map(([jt,[Fn]])=>{if(31&Fn&&J.hasOwnProperty(jt)){const $n=J[jt];delete J[jt],J[jt]=$n}}),gi(J,be,ft)}mt()}})(this))}disconnectedCallback(){Wn.jmp(()=>Fr(this))}componentOnReady(){return qi(this).$onReadyPromise$}};Bt.$lazyBundleId$=$e[0],!jt.includes(Vi)&&!Fn.get(Vi)&&(yn.push(Vi),Fn.define(Vi,Dn(Tr,Bt,1)))})}),R&&(Ln.innerHTML+=lt),Ln.innerHTML+=yn+"{visibility:hidden}.hydrated{visibility:inherit}",Ln.innerHTML.length){Ln.setAttribute("data-styles",""),$n.insertBefore(Ln,Un?Un.nextSibling:$n.firstChild);const $e=null!==(ft=Wn.$nonce$)&&void 0!==ft?ft:Xe(ui);null!=$e&&Ln.setAttribute("nonce",$e)}or=!1,ci.length?ci.map($e=>$e.connectedCallback()):Wn.jmp(()=>Gi=setTimeout(ht,30))},Do=(J,be,ft,mt)=>{ft&&ft.map(([yn,jt,Fn])=>{const $n=Zi(J,yn),Un=Io(be,Fn),Ln=ao(yn);Wn.ael($n,jt,Un,Ln),(be.$rmListeners$=be.$rmListeners$||[]).push(()=>Wn.rel($n,jt,Un,Ln))})},Io=(J,be)=>ft=>{try{256&J.$flags$?J.$lazyInstance$[be](ft):(J.$queuedListeners$=J.$queuedListeners$||[]).push([be,ft])}catch(mt){Tt(mt)}},Zi=(J,be)=>4&be?ui:8&be?Xn:16&be?ui.body:J,ao=J=>0!=(2&J),xo=new WeakMap,qi=J=>xo.get(J),Ci=(J,be)=>xo.set(be.$lazyInstance$=J,be),Kr=(J,be)=>{const ft={$flags$:0,$hostElement$:J,$cmpMeta$:be,$instanceValues$:new Map};return ft.$onInstancePromise$=new Promise(mt=>ft.$onInstanceResolve$=mt),ft.$onReadyPromise$=new Promise(mt=>ft.$onReadyResolve$=mt),J["s-p"]=[],J["s-rc"]=[],Do(J,ft,be.$listeners$),xo.set(J,ft)},Yt=(J,be)=>be in J,Tt=(J,be)=>(0,console.error)(J,be),Mt=new Map,Qt=(J,be,ft)=>{const mt=J.$tagName$.replace(/-/g,"_"),yn=J.$lazyBundleId$,jt=Mt.get(yn);return jt?jt[mt]:S(863)(`./${yn}.entry.js`).then(Fn=>(Mt.set(yn,Fn),Fn[mt]),Tt)},wn=new Map,It=[],Xn=typeof window<"u"?window:{},ui=Xn.document||{head:{}},Wn={$flags$:0,$resourcesUrl$:"",jmp:J=>J(),raf:J=>requestAnimationFrame(J),ael:(J,be,ft,mt)=>J.addEventListener(be,ft,mt),rel:(J,be,ft,mt)=>J.removeEventListener(be,ft,mt),ce:(J,be)=>new CustomEvent(J,be)},lr=J=>{Object.assign(Wn,J)},Je=!0,we=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replaceSync}catch{}return!1})(),ut=[],dt=[],Lt=(J,be)=>ft=>{J.push(ft),ee||(ee=!0,be&&4&Wn.$flags$?di(ti):Wn.raf(ti))},gn=J=>{for(let be=0;be<J.length;be++)try{J[be](performance.now())}catch(ft){Tt(ft)}J.length=0},ti=()=>{gn(ut),gn(dt),(ee=ut.length>0)&&Wn.raf(ti)},di=J=>Promise.resolve(void 0).then(J),Kn=Lt(ut,!1),Xi=Lt(dt,!0)},9203:(zn,wt,S)=>{"use strict";S.r(wt),S.d(wt,{GESTURE_CONTROLLER:()=>h.G,createGesture:()=>_e});var h=S(619);const p=(ye,De,me,Ye)=>{const Ce=X(ye)?{capture:!!Ye.capture,passive:!!Ye.passive}:!!Ye.capture;let de,Pe;return ye.__zone_symbol__addEventListener?(de="__zone_symbol__addEventListener",Pe="__zone_symbol__removeEventListener"):(de="addEventListener",Pe="removeEventListener"),ye[de](De,me,Ce),()=>{ye[Pe](De,me,Ce)}},X=ye=>{if(void 0===a)try{const De=Object.defineProperty({},"passive",{get:()=>{a=!0}});ye.addEventListener("optsTest",()=>{},De)}catch{a=!1}return!!a};let a;const C=ye=>ye instanceof Document?ye:ye.ownerDocument,_e=ye=>{let De=!1,me=!1,Ye=!0,Ce=!1;const de=Object.assign({disableScroll:!1,direction:"x",gesturePriority:0,passive:!0,maxAngle:40,threshold:10},ye),Pe=de.canStart,Be=de.onWillStart,Ne=de.onStart,Ae=de.onEnd,Ge=de.notCaptured,lt=de.onMove,ne=de.threshold,Ee=de.passive,xe=de.blurOnStart,je={type:"pan",startX:0,startY:0,startTime:0,currentX:0,currentY:0,velocityX:0,velocityY:0,deltaX:0,deltaY:0,currentTime:0,event:void 0,data:void 0},Se=((ye,De,me)=>{const Ye=me*(Math.PI/180),Ce="x"===ye,de=Math.cos(Ye),Pe=De*De;let Be=0,Ne=0,Ae=!1,Ge=0;return{start(lt,ne){Be=lt,Ne=ne,Ge=0,Ae=!0},detect(lt,ne){if(!Ae)return!1;const Ee=lt-Be,xe=ne-Ne,je=Ee*Ee+xe*xe;if(je<Pe)return!1;const Se=Math.sqrt(je),Ve=(Ce?Ee:xe)/Se;return Ge=Ve>de?1:Ve<-de?-1:0,Ae=!1,!0},isGesture:()=>0!==Ge,getDirection:()=>Ge}})(de.direction,de.threshold,de.maxAngle),Ve=h.G.createGesture({name:ye.gestureName,priority:ye.gesturePriority,disableScroll:ye.disableScroll}),cn=()=>{De&&(Ce=!1,lt&&lt(je))},xn=()=>!!Ve.capture()&&(De=!0,Ye=!1,je.startX=je.currentX,je.startY=je.currentY,je.startTime=je.currentTime,Be?Be(je).then(ke):ke(),!0),ke=()=>{xe&&(()=>{if(typeof document<"u"){const _t=document.activeElement;_t?.blur&&_t.blur()}})(),Ne&&Ne(je),Ye=!0},pe=()=>{De=!1,me=!1,Ce=!1,Ye=!0,Ve.release()},Oe=_t=>{const Kt=De,Mn=Ye;if(pe(),Mn){if(Le(je,_t),Kt)return void(Ae&&Ae(je));Ge&&Ge(je)}},ie=((ye,De,me,Ye,Ce)=>{let de,Pe,Be,Ne,Ae,Ge,lt,ne=0;const Ee=$t=>{ne=Date.now()+2e3,De($t)&&(!Pe&&me&&(Pe=p(ye,"touchmove",me,Ce)),Be||(Be=p($t.target,"touchend",je,Ce)),Ne||(Ne=p($t.target,"touchcancel",je,Ce)))},xe=$t=>{ne>Date.now()||De($t)&&(!Ge&&me&&(Ge=p(C(ye),"mousemove",me,Ce)),lt||(lt=p(C(ye),"mouseup",Se,Ce)))},je=$t=>{Ve(),Ye&&Ye($t)},Se=$t=>{Xe(),Ye&&Ye($t)},Ve=()=>{Pe&&Pe(),Be&&Be(),Ne&&Ne(),Pe=Be=Ne=void 0},Xe=()=>{Ge&&Ge(),lt&&lt(),Ge=lt=void 0},Ht=()=>{Ve(),Xe()},cn=($t=!0)=>{$t?(de||(de=p(ye,"touchstart",Ee,Ce)),Ae||(Ae=p(ye,"mousedown",xe,Ce))):(de&&de(),Ae&&Ae(),de=Ae=void 0,Ht())};return{enable:cn,stop:Ht,destroy:()=>{cn(!1),Ye=me=De=void 0}}})(de.el,_t=>{const Kt=Te(_t);return!(me||!Ye||(ee(_t,je),je.startX=je.currentX,je.startY=je.currentY,je.startTime=je.currentTime=Kt,je.velocityX=je.velocityY=je.deltaX=je.deltaY=0,je.event=_t,Pe&&!1===Pe(je))||(Ve.release(),!Ve.start()))&&(me=!0,0===ne?xn():(Se.start(je.startX,je.startY),!0))},_t=>{De?!Ce&&Ye&&(Ce=!0,Le(je,_t),requestAnimationFrame(cn)):(Le(je,_t),Se.detect(je.currentX,je.currentY)&&(!Se.isGesture()||!xn())&&it())},Oe,{capture:!1,passive:Ee}),it=()=>{pe(),ie.stop(),Ge&&Ge(je)};return{enable(_t=!0){_t||(De&&Oe(void 0),pe()),ie.enable(_t)},destroy(){Ve.destroy(),ie.destroy()}}},Le=(ye,De)=>{if(!De)return;const me=ye.currentX,Ye=ye.currentY,Ce=ye.currentTime;ee(De,ye);const de=ye.currentX,Pe=ye.currentY,Ne=(ye.currentTime=Te(De))-Ce;if(Ne>0&&Ne<100){const Ge=(Pe-Ye)/Ne;ye.velocityX=(de-me)/Ne*.7+.3*ye.velocityX,ye.velocityY=.7*Ge+.3*ye.velocityY}ye.deltaX=de-ye.startX,ye.deltaY=Pe-ye.startY,ye.event=De},ee=(ye,De)=>{let me=0,Ye=0;if(ye){const Ce=ye.changedTouches;if(Ce&&Ce.length>0){const de=Ce[0];me=de.clientX,Ye=de.clientY}else void 0!==ye.pageX&&(me=ye.pageX,Ye=ye.pageY)}De.currentX=me,De.currentY=Ye},Te=ye=>ye.timeStamp||Date.now()},3882:(zn,wt,S)=>{"use strict";S.d(wt,{a:()=>ee,b:()=>cn,c:()=>X,i:()=>xn});var h=S(5349);class p{constructor(){this.m=new Map}reset(ke){this.m=new Map(Object.entries(ke))}get(ke,pe){const Oe=this.m.get(ke);return void 0!==Oe?Oe:pe}getBoolean(ke,pe=!1){const Oe=this.m.get(ke);return void 0===Oe?pe:"string"==typeof Oe?"true"===Oe:!!Oe}getNumber(ke,pe){const Oe=parseFloat(this.m.get(ke));return isNaN(Oe)?void 0!==pe?pe:NaN:Oe}set(ke,pe){this.m.set(ke,pe)}}const X=new p,_e="ionic-persist-config",ee=($t,ke)=>("string"==typeof $t&&(ke=$t,$t=void 0),($t=>Te($t))($t).includes(ke)),Te=($t=window)=>{if(typeof $t>"u")return[];$t.Ionic=$t.Ionic||{};let ke=$t.Ionic.platforms;return null==ke&&(ke=$t.Ionic.platforms=ye($t),ke.forEach(pe=>$t.document.documentElement.classList.add(`plt-${pe}`))),ke},ye=$t=>{const ke=X.get("platform");return Object.keys(Xe).filter(pe=>{const Oe=ke?.[pe];return"function"==typeof Oe?Oe($t):Xe[pe]($t)})},me=$t=>!!(Se($t,/iPad/i)||Se($t,/Macintosh/i)&&Ae($t)),de=$t=>Se($t,/android|sink/i),Ae=$t=>Ve($t,"(any-pointer:coarse)"),lt=$t=>ne($t)||Ee($t),ne=$t=>!!($t.cordova||$t.phonegap||$t.PhoneGap),Ee=$t=>{const ke=$t.Capacitor;return!!ke?.isNative},Se=($t,ke)=>ke.test($t.navigator.userAgent),Ve=($t,ke)=>{var pe;return null===(pe=$t.matchMedia)||void 0===pe?void 0:pe.call($t,ke).matches},Xe={ipad:me,iphone:$t=>Se($t,/iPhone/i),ios:$t=>Se($t,/iPhone|iPod/i)||me($t),android:de,phablet:$t=>{const ke=$t.innerWidth,pe=$t.innerHeight,Oe=Math.min(ke,pe),ie=Math.max(ke,pe);return Oe>390&&Oe<520&&ie>620&&ie<800},tablet:$t=>{const ke=$t.innerWidth,pe=$t.innerHeight,Oe=Math.min(ke,pe),ie=Math.max(ke,pe);return me($t)||($t=>de($t)&&!Se($t,/mobile/i))($t)||Oe>460&&Oe<820&&ie>780&&ie<1400},cordova:ne,capacitor:Ee,electron:$t=>Se($t,/electron/i),pwa:$t=>{var ke;return!!(null!==(ke=$t.matchMedia)&&void 0!==ke&&ke.call($t,"(display-mode: standalone)").matches||$t.navigator.standalone)},mobile:Ae,mobileweb:$t=>Ae($t)&&!lt($t),desktop:$t=>!Ae($t),hybrid:lt};let Ht;const cn=$t=>$t&&(0,h.g)($t)||Ht,xn=($t={})=>{if(typeof window>"u")return;const ke=window.document,pe=window,Oe=pe.Ionic=pe.Ionic||{},ie={};$t._ael&&(ie.ael=$t._ael),$t._rel&&(ie.rel=$t._rel),$t._ce&&(ie.ce=$t._ce),(0,h.a)(ie);const it=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},($t=>{try{const ke=$t.sessionStorage.getItem(_e);return null!==ke?JSON.parse(ke):{}}catch{return{}}})(pe)),{persistConfig:!1}),Oe.config),($t=>{const ke={};return $t.location.search.slice(1).split("&").map(pe=>pe.split("=")).map(([pe,Oe])=>[decodeURIComponent(pe),decodeURIComponent(Oe)]).filter(([pe])=>(($t,ke)=>$t.substr(0,ke.length)===ke)(pe,"ionic:")).map(([pe,Oe])=>[pe.slice(6),Oe]).forEach(([pe,Oe])=>{ke[pe]=Oe}),ke})(pe)),$t);X.reset(it),X.getBoolean("persistConfig")&&(($t,ke)=>{try{$t.sessionStorage.setItem(_e,JSON.stringify(ke))}catch{return}})(pe,it),Te(pe),Oe.config=X,Oe.mode=Ht=X.get("mode",ke.documentElement.getAttribute("mode")||(ee(pe,"ios")?"ios":"md")),X.set("mode",Ht),ke.documentElement.setAttribute("mode",Ht),ke.documentElement.classList.add(Ht),X.getBoolean("_testing")&&X.set("animated",!1);const _t=Mn=>{var fn;return null===(fn=Mn.tagName)||void 0===fn?void 0:fn.startsWith("ION-")},Kt=Mn=>["ios","md"].includes(Mn);(0,h.c)(Mn=>{for(;Mn;){const fn=Mn.mode||Mn.getAttribute("mode");if(fn){if(Kt(fn))return fn;_t(Mn)&&console.warn('Invalid ionic mode: "'+fn+'", expected: "ios" or "md"')}Mn=Mn.parentElement}return Ht})}},2619:(zn,wt,S)=>{"use strict";S.r(wt),S.d(wt,{iosTransitionAnimation:()=>ye,shadow:()=>C});var h=S(6410),p=S(448);S(6225),S(5349);const K=me=>document.querySelector(`${me}.ion-cloned-element`),C=me=>me.shadowRoot||me,oe=me=>{const Ye="ION-TABS"===me.tagName?me:me.querySelector("ion-tabs"),Ce="ion-content ion-header:not(.header-collapse-condense-inactive) ion-title.title-large";if(null!=Ye){const de=Ye.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");return null!=de?de.querySelector(Ce):null}return me.querySelector(Ce)},_e=(me,Ye)=>{const Ce="ION-TABS"===me.tagName?me:me.querySelector("ion-tabs");let de=[];if(null!=Ce){const Pe=Ce.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");null!=Pe&&(de=Pe.querySelectorAll("ion-buttons"))}else de=me.querySelectorAll("ion-buttons");for(const Pe of de){const Be=Pe.closest("ion-header"),Ne=Be&&!Be.classList.contains("header-collapse-condense-inactive"),Ae=Pe.querySelector("ion-back-button"),Ge=Pe.classList.contains("buttons-collapse");if(null!==Ae&&("start"===Pe.slot||""===Pe.slot)&&(Ge&&Ne&&Ye||!Ge))return Ae}return null},ee=(me,Ye,Ce,de,Pe,Be,Ne,Ae,Ge)=>{var lt,ne;const Ee=Ye?`calc(100% - ${Pe.right+4}px)`:Pe.left-4+"px",xe=Ye?"right":"left",je=Ye?"left":"right",Se=Ye?"right":"left",Ve=(null===(lt=Be.textContent)||void 0===lt?void 0:lt.trim())===(null===(ne=Ae.textContent)||void 0===ne?void 0:ne.trim()),Ht=(Ge.height-De)/Ne.height,cn=Ve?`scale(${Ge.width/Ne.width}, ${Ht})`:`scale(${Ht})`,xn="scale(1)",ke=C(de).querySelector("ion-icon").getBoundingClientRect(),pe=Ye?ke.width/2-(ke.right-Pe.right)+"px":Pe.left-ke.width/2+"px",Oe=Ye?`-${window.innerWidth-Pe.right}px`:`${Pe.left}px`,ie=`${Ge.top}px`,it=`${Pe.top}px`,Mn=Ce?[{offset:0,transform:`translate3d(${Oe}, ${it}, 0)`},{offset:1,transform:`translate3d(${pe}, ${ie}, 0)`}]:[{offset:0,transform:`translate3d(${pe}, ${ie}, 0)`},{offset:1,transform:`translate3d(${Oe}, ${it}, 0)`}],li=Ce?[{offset:0,opacity:1,transform:xn},{offset:1,opacity:0,transform:cn}]:[{offset:0,opacity:0,transform:cn},{offset:1,opacity:1,transform:xn}],Ie=Ce?[{offset:0,opacity:1,transform:"scale(1)"},{offset:.2,opacity:0,transform:"scale(0.6)"},{offset:1,opacity:0,transform:"scale(0.6)"}]:[{offset:0,opacity:0,transform:"scale(0.6)"},{offset:.6,opacity:0,transform:"scale(0.6)"},{offset:1,opacity:1,transform:"scale(1)"}],Ct=(0,h.c)(),on=(0,h.c)(),Rn=(0,h.c)(),Vn=K("ion-back-button"),Ut=C(Vn).querySelector(".button-text"),Hn=C(Vn).querySelector("ion-icon");Vn.text=de.text,Vn.mode=de.mode,Vn.icon=de.icon,Vn.color=de.color,Vn.disabled=de.disabled,Vn.style.setProperty("display","block"),Vn.style.setProperty("position","fixed"),on.addElement(Hn),Ct.addElement(Ut),Rn.addElement(Vn),Rn.beforeStyles({position:"absolute",top:"0px",[Se]:"0px"}).keyframes(Mn),Ct.beforeStyles({"transform-origin":`${xe} top`}).beforeAddWrite(()=>{de.style.setProperty("display","none"),Vn.style.setProperty(xe,Ee)}).afterAddWrite(()=>{de.style.setProperty("display",""),Vn.style.setProperty("display","none"),Vn.style.removeProperty(xe)}).keyframes(li),on.beforeStyles({"transform-origin":`${je} center`}).keyframes(Ie),me.addAnimation([Ct,on,Rn])},Te=(me,Ye,Ce,de,Pe,Be,Ne,Ae)=>{var Ge,lt;const ne=Ye?"right":"left",Ee=Ye?`calc(100% - ${Pe.right}px)`:`${Pe.left}px`,je=`${Pe.top}px`,Ve=Ye?`-${window.innerWidth-Ae.right-8}px`:Ae.x-8+"px",Ht=Ae.y-2+"px",cn=(null===(Ge=Ne.textContent)||void 0===Ge?void 0:Ge.trim())===(null===(lt=de.textContent)||void 0===lt?void 0:lt.trim()),$t=Ae.height/(Be.height-De),ke="scale(1)",pe=cn?`scale(${Ae.width/Be.width}, ${$t})`:`scale(${$t})`,it=Ce?[{offset:0,opacity:0,transform:`translate3d(${Ve}, ${Ht}, 0) ${pe}`},{offset:.1,opacity:0},{offset:1,opacity:1,transform:`translate3d(0px, ${je}, 0) ${ke}`}]:[{offset:0,opacity:.99,transform:`translate3d(0px, ${je}, 0) ${ke}`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${Ve}, ${Ht}, 0) ${pe}`}],_t=K("ion-title"),Kt=(0,h.c)();_t.innerText=de.innerText,_t.size=de.size,_t.color=de.color,Kt.addElement(_t),Kt.beforeStyles({"transform-origin":`${ne} top`,height:`${Pe.height}px`,display:"",position:"relative",[ne]:Ee}).beforeAddWrite(()=>{de.style.setProperty("opacity","0")}).afterAddWrite(()=>{de.style.setProperty("opacity",""),_t.style.setProperty("display","none")}).keyframes(it),me.addAnimation(Kt)},ye=(me,Ye)=>{var Ce;try{const de="cubic-bezier(0.32,0.72,0,1)",Pe="opacity",Be="transform",Ne="0%",Ge="rtl"===me.ownerDocument.dir,lt=Ge?"-99.5%":"99.5%",ne=Ge?"33%":"-33%",Ee=Ye.enteringEl,xe=Ye.leavingEl,je="back"===Ye.direction,Se=Ee.querySelector(":scope > ion-content"),Ve=Ee.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *"),Xe=Ee.querySelectorAll(":scope > ion-header > ion-toolbar"),Ht=(0,h.c)(),cn=(0,h.c)();if(Ht.addElement(Ee).duration((null!==(Ce=Ye.duration)&&void 0!==Ce?Ce:0)||540).easing(Ye.easing||de).fill("both").beforeRemoveClass("ion-page-invisible"),xe&&null!=me){const pe=(0,h.c)();pe.addElement(me),Ht.addAnimation(pe)}if(Se||0!==Xe.length||0!==Ve.length?(cn.addElement(Se),cn.addElement(Ve)):cn.addElement(Ee.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),Ht.addAnimation(cn),je?cn.beforeClearStyles([Pe]).fromTo("transform",`translateX(${ne})`,`translateX(${Ne})`).fromTo(Pe,.8,1):cn.beforeClearStyles([Pe]).fromTo("transform",`translateX(${lt})`,`translateX(${Ne})`),Se){const pe=C(Se).querySelector(".transition-effect");if(pe){const Oe=pe.querySelector(".transition-cover"),ie=pe.querySelector(".transition-shadow"),it=(0,h.c)(),_t=(0,h.c)(),Kt=(0,h.c)();it.addElement(pe).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),_t.addElement(Oe).beforeClearStyles([Pe]).fromTo(Pe,0,.1),Kt.addElement(ie).beforeClearStyles([Pe]).fromTo(Pe,.03,.7),it.addAnimation([_t,Kt]),cn.addAnimation([it])}}const xn=Ee.querySelector("ion-header.header-collapse-condense"),{forward:$t,backward:ke}=((me,Ye,Ce,de,Pe)=>{const Be=_e(de,Ce),Ne=oe(Pe),Ae=oe(de),Ge=_e(Pe,Ce),lt=null!==Be&&null!==Ne&&!Ce,ne=null!==Ae&&null!==Ge&&Ce;if(lt){const Ee=Ne.getBoundingClientRect(),xe=Be.getBoundingClientRect(),je=C(Be).querySelector(".button-text"),Se=je.getBoundingClientRect(),Xe=C(Ne).querySelector(".toolbar-title").getBoundingClientRect();Te(me,Ye,Ce,Ne,Ee,Xe,je,Se),ee(me,Ye,Ce,Be,xe,je,Se,Ne,Xe)}else if(ne){const Ee=Ae.getBoundingClientRect(),xe=Ge.getBoundingClientRect(),je=C(Ge).querySelector(".button-text"),Se=je.getBoundingClientRect(),Xe=C(Ae).querySelector(".toolbar-title").getBoundingClientRect();Te(me,Ye,Ce,Ae,Ee,Xe,je,Se),ee(me,Ye,Ce,Ge,xe,je,Se,Ae,Xe)}return{forward:lt,backward:ne}})(Ht,Ge,je,Ee,xe);if(Xe.forEach(pe=>{const Oe=(0,h.c)();Oe.addElement(pe),Ht.addAnimation(Oe);const ie=(0,h.c)();ie.addElement(pe.querySelector("ion-title"));const it=(0,h.c)(),_t=Array.from(pe.querySelectorAll("ion-buttons,[menuToggle]")),Kt=pe.closest("ion-header"),Mn=Kt?.classList.contains("header-collapse-condense-inactive");let fn;fn=_t.filter(je?Ie=>{const Ct=Ie.classList.contains("buttons-collapse");return Ct&&!Mn||!Ct}:Ie=>!Ie.classList.contains("buttons-collapse")),it.addElement(fn);const qn=(0,h.c)();qn.addElement(pe.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])"));const li=(0,h.c)();li.addElement(C(pe).querySelector(".toolbar-background"));const en=(0,h.c)(),Dt=pe.querySelector("ion-back-button");if(Dt&&en.addElement(Dt),Oe.addAnimation([ie,it,qn,li,en]),it.fromTo(Pe,.01,1),qn.fromTo(Pe,.01,1),je)Mn||ie.fromTo("transform",`translateX(${ne})`,`translateX(${Ne})`).fromTo(Pe,.01,1),qn.fromTo("transform",`translateX(${ne})`,`translateX(${Ne})`),en.fromTo(Pe,.01,1);else if(xn||ie.fromTo("transform",`translateX(${lt})`,`translateX(${Ne})`).fromTo(Pe,.01,1),qn.fromTo("transform",`translateX(${lt})`,`translateX(${Ne})`),li.beforeClearStyles([Pe,"transform"]),Kt?.translucent?li.fromTo("transform",Ge?"translateX(-100%)":"translateX(100%)","translateX(0px)"):li.fromTo(Pe,.01,"var(--opacity)"),$t||en.fromTo(Pe,.01,1),Dt&&!$t){const Ct=(0,h.c)();Ct.addElement(C(Dt).querySelector(".button-text")).fromTo("transform",Ge?"translateX(-100px)":"translateX(100px)","translateX(0px)"),Oe.addAnimation(Ct)}}),xe){const pe=(0,h.c)(),Oe=xe.querySelector(":scope > ion-content"),ie=xe.querySelectorAll(":scope > ion-header > ion-toolbar"),it=xe.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *");if(Oe||0!==ie.length||0!==it.length?(pe.addElement(Oe),pe.addElement(it)):pe.addElement(xe.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),Ht.addAnimation(pe),je){pe.beforeClearStyles([Pe]).fromTo("transform",`translateX(${Ne})`,Ge?"translateX(-100%)":"translateX(100%)");const _t=(0,p.g)(xe);Ht.afterAddWrite(()=>{"normal"===Ht.getDirection()&&_t.style.setProperty("display","none")})}else pe.fromTo("transform",`translateX(${Ne})`,`translateX(${ne})`).fromTo(Pe,1,.8);if(Oe){const _t=C(Oe).querySelector(".transition-effect");if(_t){const Kt=_t.querySelector(".transition-cover"),Mn=_t.querySelector(".transition-shadow"),fn=(0,h.c)(),qn=(0,h.c)(),li=(0,h.c)();fn.addElement(_t).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),qn.addElement(Kt).beforeClearStyles([Pe]).fromTo(Pe,.1,0),li.addElement(Mn).beforeClearStyles([Pe]).fromTo(Pe,.7,.03),fn.addAnimation([qn,li]),pe.addAnimation([fn])}}ie.forEach(_t=>{const Kt=(0,h.c)();Kt.addElement(_t);const Mn=(0,h.c)();Mn.addElement(_t.querySelector("ion-title"));const fn=(0,h.c)(),qn=_t.querySelectorAll("ion-buttons,[menuToggle]"),li=_t.closest("ion-header"),en=li?.classList.contains("header-collapse-condense-inactive"),Dt=Array.from(qn).filter(Ut=>{const Hn=Ut.classList.contains("buttons-collapse");return Hn&&!en||!Hn});fn.addElement(Dt);const Ie=(0,h.c)(),Ct=_t.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])");Ct.length>0&&Ie.addElement(Ct);const on=(0,h.c)();on.addElement(C(_t).querySelector(".toolbar-background"));const Rn=(0,h.c)(),Vn=_t.querySelector("ion-back-button");if(Vn&&Rn.addElement(Vn),Kt.addAnimation([Mn,fn,Ie,Rn,on]),Ht.addAnimation(Kt),Rn.fromTo(Pe,.99,0),fn.fromTo(Pe,.99,0),Ie.fromTo(Pe,.99,0),je){if(en||Mn.fromTo("transform",`translateX(${Ne})`,Ge?"translateX(-100%)":"translateX(100%)").fromTo(Pe,.99,0),Ie.fromTo("transform",`translateX(${Ne})`,Ge?"translateX(-100%)":"translateX(100%)"),on.beforeClearStyles([Pe,"transform"]),li?.translucent?on.fromTo("transform","translateX(0px)",Ge?"translateX(-100%)":"translateX(100%)"):on.fromTo(Pe,"var(--opacity)",0),Vn&&!ke){const Hn=(0,h.c)();Hn.addElement(C(Vn).querySelector(".button-text")).fromTo("transform",`translateX(${Ne})`,`translateX(${(Ge?-124:124)+"px"})`),Kt.addAnimation(Hn)}}else en||Mn.fromTo("transform",`translateX(${Ne})`,`translateX(${ne})`).fromTo(Pe,.99,0).afterClearStyles([Be,Pe]),Ie.fromTo("transform",`translateX(${Ne})`,`translateX(${ne})`).afterClearStyles([Be,Pe]),Rn.afterClearStyles([Pe]),Mn.afterClearStyles([Pe]),fn.afterClearStyles([Pe])})}return Ht}catch(de){throw de}},De=10},9023:(zn,wt,S)=>{"use strict";S.r(wt),S.d(wt,{mdTransitionAnimation:()=>j});var h=S(6410),p=S(448);S(6225),S(5349);const j=(K,C)=>{var oe,_e,Le;const ye="back"===C.direction,me=C.leavingEl,Ye=(0,p.g)(C.enteringEl),Ce=Ye.querySelector("ion-toolbar"),de=(0,h.c)();if(de.addElement(Ye).fill("both").beforeRemoveClass("ion-page-invisible"),ye?de.duration((null!==(oe=C.duration)&&void 0!==oe?oe:0)||200).easing("cubic-bezier(0.47,0,0.745,0.715)"):de.duration((null!==(_e=C.duration)&&void 0!==_e?_e:0)||280).easing("cubic-bezier(0.36,0.66,0.04,1)").fromTo("transform","translateY(40px)","translateY(0px)").fromTo("opacity",.01,1),Ce){const Pe=(0,h.c)();Pe.addElement(Ce),de.addAnimation(Pe)}if(me&&ye){de.duration((null!==(Le=C.duration)&&void 0!==Le?Le:0)||200).easing("cubic-bezier(0.47,0,0.745,0.715)");const Pe=(0,h.c)();Pe.addElement((0,p.g)(me)).onFinish(Be=>{1===Be&&Pe.elements.length>0&&Pe.elements[0].style.setProperty("display","none")}).fromTo("transform","translateY(0px)","translateY(40px)").fromTo("opacity",1,0),de.addAnimation(Pe)}return de}},7612:(zn,wt,S)=>{"use strict";S.d(wt,{B:()=>Mn,G:()=>fn,a:()=>Te,b:()=>ye,c:()=>Ce,d:()=>qn,e:()=>li,f:()=>cn,g:()=>$t,h:()=>Oe,i:()=>it,j:()=>Pe,k:()=>Be,l:()=>De,m:()=>me,n:()=>Le,o:()=>Ge,q:()=>Xe,s:()=>Kt,t:()=>de});var h=S(5861),p=S(6225),X=S(3882),a=S(6559),j=S(2124),K=S(839),C=S(6710);let oe=0,_e=0;const Le=new WeakMap,ee=en=>({create:Dt=>Ne(en,Dt),dismiss:(Dt,Ie,Ct)=>je(document,Dt,Ie,en,Ct),getTop:()=>(0,h.Z)(function*(){return Xe(document,en)})()}),Te=ee("ion-alert"),ye=ee("ion-action-sheet"),De=ee("ion-loading"),me=ee("ion-modal"),Ce=ee("ion-popover"),de=ee("ion-toast"),Pe=en=>{typeof document<"u"&&xe(document);const Dt=oe++;en.overlayIndex=Dt},Be=en=>(en.hasAttribute("id")||(en.id="ion-overlay-"+ ++_e),en.id),Ne=(en,Dt)=>typeof window<"u"&&typeof window.customElements<"u"?window.customElements.whenDefined(en).then(()=>{const Ie=document.createElement(en);return Ie.classList.add("overlay-hidden"),Object.assign(Ie,Object.assign(Object.assign({},Dt),{hasController:!0})),ke(document).appendChild(Ie),new Promise(Ct=>(0,K.c)(Ie,Ct))}):Promise.resolve(),Ae='[tabindex]:not([tabindex^="-"]):not([hidden]):not([disabled]), input:not([type=hidden]):not([tabindex^="-"]):not([hidden]):not([disabled]), textarea:not([tabindex^="-"]):not([hidden]):not([disabled]), button:not([tabindex^="-"]):not([hidden]):not([disabled]), select:not([tabindex^="-"]):not([hidden]):not([disabled]), .ion-focusable:not([tabindex^="-"]):not([hidden]):not([disabled]), .ion-focusable[disabled="false"]:not([tabindex^="-"]):not([hidden])',Ge=(en,Dt)=>{let Ie=en.querySelector(Ae);const Ct=Ie?.shadowRoot;Ct&&(Ie=Ct.querySelector(Ae)||Ie),Ie?(0,K.f)(Ie):Dt.focus()},ne=(en,Dt)=>{const Ie=Array.from(en.querySelectorAll(Ae));let Ct=Ie.length>0?Ie[Ie.length-1]:null;const on=Ct?.shadowRoot;on&&(Ct=on.querySelector(Ae)||Ct),Ct?Ct.focus():Dt.focus()},xe=en=>{0===oe&&(oe=1,en.addEventListener("focus",Dt=>{((en,Dt)=>{const Ie=Xe(Dt,"ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker,ion-popover"),Ct=en.target;Ie&&Ct&&!Ie.classList.contains("ion-disable-focus-trap")&&(Ie.shadowRoot?(()=>{if(Ie.contains(Ct))Ie.lastFocus=Ct;else{const Vn=Ie.lastFocus;Ge(Ie,Ie),Vn===Dt.activeElement&&ne(Ie,Ie),Ie.lastFocus=Dt.activeElement}})():(()=>{if(Ie===Ct)Ie.lastFocus=void 0;else{const Vn=(0,K.g)(Ie);if(!Vn.contains(Ct))return;const Ut=Vn.querySelector(".ion-overlay-wrapper");if(!Ut)return;if(Ut.contains(Ct)||Ct===Vn.querySelector("ion-backdrop"))Ie.lastFocus=Ct;else{const Hn=Ie.lastFocus;Ge(Ut,Ie),Hn===Dt.activeElement&&ne(Ut,Ie),Ie.lastFocus=Dt.activeElement}}})())})(Dt,en)},!0),en.addEventListener("ionBackButton",Dt=>{const Ie=Xe(en);Ie?.backdropDismiss&&Dt.detail.register(j.OVERLAY_BACK_BUTTON_PRIORITY,()=>Ie.dismiss(void 0,Mn))}),en.addEventListener("keydown",Dt=>{if("Escape"===Dt.key){const Ie=Xe(en);Ie?.backdropDismiss&&Ie.dismiss(void 0,Mn)}}))},je=(en,Dt,Ie,Ct,on)=>{const Rn=Xe(en,Ct,on);return Rn?Rn.dismiss(Dt,Ie):Promise.reject("overlay does not exist")},Ve=(en,Dt)=>((en,Dt)=>(void 0===Dt&&(Dt="ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker,ion-popover,ion-toast"),Array.from(en.querySelectorAll(Dt)).filter(Ie=>Ie.overlayIndex>0)))(en,Dt).filter(Ie=>!(en=>en.classList.contains("overlay-hidden"))(Ie)),Xe=(en,Dt,Ie)=>{const Ct=Ve(en,Dt);return void 0===Ie?Ct[Ct.length-1]:Ct.find(on=>on.id===Ie)},Ht=(en=!1)=>{const Ie=ke(document).querySelector("ion-router-outlet, ion-nav, #ion-view-container-root");Ie&&(en?Ie.setAttribute("aria-hidden","true"):Ie.removeAttribute("aria-hidden"))},cn=function(){var en=(0,h.Z)(function*(Dt,Ie,Ct,on,Rn){var Vn,Ut;if(Dt.presented)return;Ht(!0),Dt.presented=!0,Dt.willPresent.emit(),null===(Vn=Dt.willPresentShorthand)||void 0===Vn||Vn.emit();const Hn=(0,X.b)(Dt),qe=Dt.enterAnimation?Dt.enterAnimation:X.c.get(Ie,"ios"===Hn?Ct:on);(yield pe(Dt,qe,Dt.el,Rn))&&(Dt.didPresent.emit(),null===(Ut=Dt.didPresentShorthand)||void 0===Ut||Ut.emit()),"ION-TOAST"!==Dt.el.tagName&&xn(Dt.el),Dt.keyboardClose&&(null===document.activeElement||!Dt.el.contains(document.activeElement))&&Dt.el.focus()});return function(Ie,Ct,on,Rn,Vn){return en.apply(this,arguments)}}(),xn=function(){var en=(0,h.Z)(function*(Dt){let Ie=document.activeElement;if(!Ie)return;const Ct=Ie?.shadowRoot;Ct&&(Ie=Ct.querySelector(Ae)||Ie),yield Dt.onDidDismiss(),Ie.focus()});return function(Ie){return en.apply(this,arguments)}}(),$t=function(){var en=(0,h.Z)(function*(Dt,Ie,Ct,on,Rn,Vn,Ut){var Hn,qe;if(!Dt.presented)return!1;void 0!==p.d&&1===Ve(p.d).length&&Ht(!1),Dt.presented=!1;try{Dt.el.style.setProperty("pointer-events","none"),Dt.willDismiss.emit({data:Ie,role:Ct}),null===(Hn=Dt.willDismissShorthand)||void 0===Hn||Hn.emit({data:Ie,role:Ct});const Nt=(0,X.b)(Dt),Xt=Dt.leaveAnimation?Dt.leaveAnimation:X.c.get(on,"ios"===Nt?Rn:Vn);Ct!==fn&&(yield pe(Dt,Xt,Dt.el,Ut)),Dt.didDismiss.emit({data:Ie,role:Ct}),null===(qe=Dt.didDismissShorthand)||void 0===qe||qe.emit({data:Ie,role:Ct}),Le.delete(Dt),Dt.el.classList.add("overlay-hidden"),Dt.el.style.removeProperty("pointer-events"),void 0!==Dt.el.lastFocus&&(Dt.el.lastFocus=void 0)}catch(Nt){console.error(Nt)}return Dt.el.remove(),!0});return function(Ie,Ct,on,Rn,Vn,Ut,Hn){return en.apply(this,arguments)}}(),ke=en=>en.querySelector("ion-app")||en.body,pe=function(){var en=(0,h.Z)(function*(Dt,Ie,Ct,on){Ct.classList.remove("overlay-hidden");const Vn=Ie(Dt.el,on);(!Dt.animated||!X.c.getBoolean("animated",!0))&&Vn.duration(0),Dt.keyboardClose&&Vn.beforeAddWrite(()=>{const Hn=Ct.ownerDocument.activeElement;Hn?.matches("input,ion-input, ion-textarea")&&Hn.blur()});const Ut=Le.get(Dt)||[];return Le.set(Dt,[...Ut,Vn]),yield Vn.play(),!0});return function(Ie,Ct,on,Rn){return en.apply(this,arguments)}}(),Oe=(en,Dt)=>{let Ie;const Ct=new Promise(on=>Ie=on);return ie(en,Dt,on=>{Ie(on.detail)}),Ct},ie=(en,Dt,Ie)=>{const Ct=on=>{(0,K.b)(en,Dt,Ct),Ie(on)};(0,K.a)(en,Dt,Ct)},it=en=>"cancel"===en||en===Mn,_t=en=>en(),Kt=(en,Dt)=>{if("function"==typeof en)return X.c.get("_zoneGate",_t)(()=>{try{return en(Dt)}catch(Ct){throw Ct}})},Mn="backdrop",fn="gesture",qn=en=>{let Ie,Dt=!1;const Ct=(0,a.C)(),on=(Ut=!1)=>{if(Ie&&!Ut)return{delegate:Ie,inline:Dt};const{el:Hn,hasController:qe,delegate:Nt}=en;return Dt=null!==Hn.parentNode&&!qe,Ie=Dt?Nt||Ct:Nt,{inline:Dt,delegate:Ie}};return{attachViewToDom:function(){var Ut=(0,h.Z)(function*(Hn){const{delegate:qe}=on(!0);if(qe)return yield qe.attachViewToDom(en.el,Hn);const{hasController:Nt}=en;if(Nt&&void 0!==Hn)throw new Error("framework delegate is missing");return null});return function(qe){return Ut.apply(this,arguments)}}(),removeViewFromDom:()=>{const{delegate:Ut}=on();Ut&&void 0!==en.el&&Ut.removeViewFromDom(en.el.parentElement,en.el)}}},li=()=>{let en;const Dt=()=>{en&&(en(),en=void 0)};return{addClickListener:(Ct,on)=>{Dt();const Rn=void 0!==on?document.getElementById(on):null;Rn?en=((Ut,Hn)=>{const qe=()=>{Hn.present()};return Ut.addEventListener("click",qe),()=>{Ut.removeEventListener("click",qe)}})(Rn,Ct):(0,C.p)(`A trigger element with the ID "${on}" was not found in the DOM. The trigger element must be in the DOM when the "trigger" property is set on an overlay component.`,Ct)},removeClickListener:Dt}}},1163:(zn,wt,S)=>{"use strict";S.d(wt,{B:()=>Te});var h=S(8564),p=S(866),X=S(6814),a=S(6728);function j(ye,De){if(1&ye&&(h.TgZ(0,"ion-badge",7),h._uU(1),h.qZA()),2&ye){const me=h.oxw().$implicit;h.xp6(1),h.hij("",me.Quantity," x")}}function K(ye,De){if(1&ye&&(h.TgZ(0,"strong"),h._uU(1),h.qZA()),2&ye){const me=h.oxw().$implicit;h.xp6(1),h.hij("",me.PowerKW," kW ")}}function C(ye,De){if(1&ye&&(h.TgZ(0,"div"),h._uU(1),h.qZA()),2&ye){const me=h.oxw().$implicit;h.xp6(1),h.hij("",null==me.CurrentType?null:me.CurrentType.Title," ")}}function oe(ye,De){if(1&ye&&(h.TgZ(0,"span"),h._uU(1),h.qZA()),2&ye){const me=h.oxw().$implicit;h.xp6(1),h.hij("",me.Amps,"A ")}}function _e(ye,De){if(1&ye&&(h.TgZ(0,"span"),h._uU(1),h.qZA()),2&ye){const me=h.oxw().$implicit;h.xp6(1),h.hij("",me.Voltage,"V ")}}function Le(ye,De){if(1&ye){const me=h.EpF();h.TgZ(0,"ion-col")(1,"ion-button",8),h.NdJ("click",function(){h.CHM(me);const Ce=h.oxw().$implicit,de=h.oxw();return h.KtG(de.editConnection(Ce))}),h._UZ(2,"ion-icon",9),h.qZA(),h._UZ(3,"br"),h.TgZ(4,"ion-button",10),h.NdJ("click",function(){h.CHM(me);const Ce=h.oxw().$implicit,de=h.oxw();return h.KtG(de.deleteConnection(Ce))}),h._UZ(5,"ion-icon",11),h.qZA()()}}function ee(ye,De){if(1&ye&&(h.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-row")(3,"ion-col",1),h._UZ(4,"img",2),h.YNc(5,j,2,1,"ion-badge",3),h.TgZ(6,"div",4),h._uU(7),h.qZA()(),h.TgZ(8,"ion-col")(9,"ion-row")(10,"ion-col")(11,"ion-note")(12,"div")(13,"strong",5),h._uU(14),h.qZA()(),h.YNc(15,K,2,1,"strong",6)(16,C,2,1,"div",6),h.qZA(),h.TgZ(17,"ion-note"),h.YNc(18,oe,2,1,"span",6)(19,_e,2,1,"span",6),h.qZA()()(),h.TgZ(20,"ion-row")(21,"ion-col",4),h._uU(22),h.qZA(),h.TgZ(23,"ion-col",4),h._uU(24),h.qZA()()(),h.YNc(25,Le,6,0,"ion-col",6),h.qZA()()()),2&ye){const me=De.$implicit,Ye=h.oxw();h.xp6(4),h.Q6J("src",Ye.getConnectorTypeIcon(me.ConnectionTypeID),h.LSH),h.xp6(1),h.Q6J("ngIf",me.Quantity),h.xp6(2),h.Oqu(null==me.StatusType?null:me.StatusType.Title),h.xp6(6),h.s9C("title",null==me.ConnectionType?null:me.ConnectionType.FormalName),h.xp6(1),h.hij("",null==me.ConnectionType?null:me.ConnectionType.Title," "),h.xp6(1),h.Q6J("ngIf",me.PowerKW),h.xp6(1),h.Q6J("ngIf",me.CurrentTypeID),h.xp6(2),h.Q6J("ngIf",me.Amps),h.xp6(1),h.Q6J("ngIf",me.Voltage),h.xp6(3),h.Oqu(me.Reference),h.xp6(2),h.Oqu(me.Comments),h.xp6(1),h.Q6J("ngIf",Ye.enableEdit)}}let Te=(()=>{class ye{item;enableEdit=!1;onEdit=new h.vpe;onDelete=new h.vpe;constructor(){}ngOnInit(){}editConnection(me){this.onEdit.emit(me)}deleteConnection(me){this.onDelete.emit(me)}getConnectorTypeIcon(me){return p.c.getIconForConnector(me)}static \u0275fac=function(Ye){return new(Ye||ye)};static \u0275cmp=h.Xpm({type:ye,selectors:[["app-equipment-details"]],inputs:{item:"item",enableEdit:"enableEdit"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],["size","3"],[2,"max-width","64px",3,"src"],["color","primary",4,"ngIf"],[1,"info"],[3,"title"],[4,"ngIf"],["color","primary"],["size","small","color","secondary",3,"click"],["name","create","slot","icon-only"],["size","small","color","danger",3,"click"],["name","trash","slot","icon-only"]],template:function(Ye,Ce){1&Ye&&(h.TgZ(0,"ion-grid"),h.YNc(1,ee,26,12,"ion-row",0),h.qZA()),2&Ye&&(h.xp6(1),h.Q6J("ngForOf",Ce.item.Connections))},dependencies:[X.sg,X.O5,a.yp,a.YG,a.wI,a.jY,a.gu,a.uN,a.Nd]})}return ye})()},6086:(zn,wt,S)=>{"use strict";S.d(wt,{z:()=>Ye});var h=S(5861),p=S(8564),X=S(9159),a=S(6814),j=S(6728),K=S(6223);function C(Ce,de){if(1&Ce&&(p.TgZ(0,"ion-select-option",5),p._uU(1),p.qZA()),2&Ce){const Pe=de.$implicit;p.Q6J("value",Pe.ID),p.xp6(1),p.Oqu(Pe.Title)}}function oe(Ce,de){1&Ce&&(p.TgZ(0,"ion-select-option",6),p._uU(1,"Other..."),p.qZA())}function _e(Ce,de){if(1&Ce){const Pe=p.EpF();p.TgZ(0,"ion-item")(1,"ion-label",1),p._uU(2,"Network Operator"),p.qZA(),p.TgZ(3,"ion-select",2),p.NdJ("ngModelChange",function(Ne){p.CHM(Pe);const Ae=p.oxw();return p.KtG(Ae.operatorId=Ne)})("ionChange",function(){p.CHM(Pe);const Ne=p.oxw();return p.KtG(Ne.onOperatorChange())}),p.YNc(4,C,2,2,"ion-select-option",3)(5,oe,2,0,"ion-select-option",4),p.qZA()()}if(2&Ce){const Pe=p.oxw();p.xp6(3),p.Q6J("ngModel",Pe.operatorId),p.xp6(1),p.Q6J("ngForOf",Pe.operators),p.xp6(1),p.Q6J("ngIf",Pe.useFilteredOperators)}}function Le(Ce,de){if(1&Ce){const Pe=p.EpF();p.TgZ(0,"ion-item")(1,"ion-searchbar",7),p.NdJ("ionCancel",function(){p.CHM(Pe);const Ne=p.oxw();return p.KtG(Ne.cancelOperatorLookup())})("ngModelChange",function(Ne){p.CHM(Pe);const Ae=p.oxw();return p.KtG(Ae.operatorSearchKeyword=Ne)})("ionInput",function(Ne){p.CHM(Pe);const Ae=p.oxw();return p.KtG(Ae.searchOperators(Ne))}),p.qZA()()}if(2&Ce){const Pe=p.oxw();p.xp6(1),p.Q6J("ngModel",Pe.operatorSearchKeyword)}}function ee(Ce,de){if(1&Ce){const Pe=p.EpF();p.TgZ(0,"ion-item",9),p.NdJ("click",function(){const Ae=p.CHM(Pe).$implicit,Ge=p.oxw(2);return p.KtG(Ge.onOperatorChange(Ae))}),p.TgZ(1,"ion-avatar",10),p._UZ(2,"ion-icon",11),p.qZA(),p.TgZ(3,"ion-label")(4,"p"),p._uU(5),p.qZA(),p.TgZ(6,"p"),p._uU(7),p.qZA()()()}if(2&Ce){const Pe=de.$implicit;p.xp6(5),p.Oqu(Pe.Title),p.xp6(2),p.Oqu(Pe.WebsiteURL)}}function Te(Ce,de){if(1&Ce&&(p.ynx(0),p.TgZ(1,"ion-list"),p.YNc(2,ee,8,2,"ion-item",8),p.qZA(),p.BQk()),2&Ce){const Pe=p.oxw();p.xp6(2),p.Q6J("ngForOf",Pe.operatorSearchResults)}}function ye(Ce,de){if(1&Ce){const Pe=p.EpF();p.ynx(0),p.TgZ(1,"ion-item")(2,"ion-avatar",10),p._UZ(3,"ion-icon",12),p.qZA(),p.TgZ(4,"ion-label")(5,"p"),p._uU(6),p.qZA(),p.TgZ(7,"p"),p._uU(8),p.qZA(),p.TgZ(9,"ion-button",9),p.NdJ("click",function(){p.CHM(Pe);const Ne=p.oxw();return p.KtG(Ne.selectedOperator=null)}),p._uU(10,"Change"),p.qZA()()(),p.BQk()}if(2&Ce){const Pe=p.oxw();p.xp6(6),p.Oqu(Pe.selectedOperator.Title),p.xp6(2),p.Oqu(Pe.selectedOperator.WebsiteURL)}}function De(Ce,de){if(1&Ce){const Pe=p.EpF();p.TgZ(0,"ion-chip")(1,"ion-label"),p._uU(2),p.qZA(),p.TgZ(3,"ion-icon",14),p.NdJ("click",function(){const Ae=p.CHM(Pe).$implicit,Ge=p.oxw(2);return p.KtG(Ge.removeOperator(Ae))}),p.qZA()()}if(2&Ce){const Pe=de.$implicit,Be=p.oxw(2);p.xp6(2),p.Oqu(Be.getOperatorInfo(Pe).Title)}}function me(Ce,de){if(1&Ce&&(p.ynx(0),p.YNc(1,De,4,1,"ion-chip",13),p.BQk()),2&Ce){const Pe=p.oxw();p.xp6(1),p.Q6J("ngForOf",Pe.operatorList)}}let Ye=(()=>{class Ce{referenceDataManager;changeDetector;operatorId=null;operatorList=null;mode="single";useFilteredOperators=null;operatorChanged=new p.vpe;operatorRemoved=new p.vpe;operatorCache=[];operatorSearchResults=[];operatorSearchKeyword="";selectedOperator=null;get operators(){return this.referenceDataManager.getNetworkOperators(this.useFilteredOperators)}constructor(Pe,Be){this.referenceDataManager=Pe,this.changeDetector=Be}ngOnInit(){this.operatorCache=this.referenceDataManager.getNetworkOperators(!1),null!=this.operatorId&&(this.selectedOperator=this.operatorCache.find(Pe=>Pe.ID==this.operatorId))}searchOperators(){this.operatorSearchResults=[],0!=this.operatorSearchKeyword.length&&(this.operatorSearchResults=this.operatorCache?this.operatorCache.filter(Pe=>Pe.Title.toLowerCase().startsWith(this.operatorSearchKeyword.toLowerCase())||Pe.Title.toLowerCase().startsWith("("+this.operatorSearchKeyword.toLowerCase())).slice(0,10):[])}getOperatorInfo(Pe){if(this.operatorCache)return this.operatorCache.find(Be=>Be.ID==Pe)}onOperatorChange(Pe=null){var Be=this;return(0,h.Z)(function*(){null==Pe&&Be.operatorId&&(Pe=Be.operatorCache.find(Ne=>Ne.ID==Be.operatorId)),null!=Pe&&(Be.operatorSearchResults=[],Be.selectedOperator=Pe,Be.operatorId=Pe.ID),Be.operatorId?(Be.operatorChanged.emit(Be.selectedOperator),"single"!=Be.mode&&(Be.selectedOperator=null,Be.operatorSearchKeyword="")):Be.useFilteredOperators=!1})()}removeOperator(Pe){var Be=this;return(0,h.Z)(function*(){Be.operatorId=null,Be.operatorRemoved.emit(Pe)})()}cancelOperatorLookup(){this.selectedOperator=null}static \u0275fac=function(Be){return new(Be||Ce)(p.Y36(X.W),p.Y36(p.sBO))};static \u0275cmp=p.Xpm({type:Ce,selectors:[["app-operator-lookup"]],inputs:{operatorId:"operatorId",operatorList:"operatorList",mode:"mode",useFilteredOperators:"useFilteredOperators"},outputs:{operatorChanged:"operatorChanged",operatorRemoved:"operatorRemoved"},decls:5,vars:5,consts:[[4,"ngIf"],["position","floating"],[3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["value","",4,"ngIf"],[3,"value"],["value",""],["placeholder","Search network operators","showCancelButton","focus","autocomplete","on",3,"ngModel","ionCancel","ngModelChange","ionInput"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["item-left",""],["name","card"],["name","locate"],[4,"ngFor","ngForOf"],["name","close-circle",3,"click"]],template:function(Be,Ne){1&Be&&p.YNc(0,_e,6,3,"ion-item",0)(1,Le,2,1,"ion-item",0)(2,Te,3,1,"ng-container",0)(3,ye,11,2,"ng-container",0)(4,me,2,1,"ng-container",0),2&Be&&(p.Q6J("ngIf",Ne.useFilteredOperators&&!Ne.selectedOperator),p.xp6(1),p.Q6J("ngIf",!Ne.useFilteredOperators&&!Ne.selectedOperator),p.xp6(1),p.Q6J("ngIf",Ne.operatorSearchResults.length>0),p.xp6(1),p.Q6J("ngIf",null!=Ne.selectedOperator),p.xp6(1),p.Q6J("ngIf",(null==Ne.operatorList?null:Ne.operatorList.length)>0))},dependencies:[a.sg,a.O5,j.BJ,j.YG,j.hM,j.gu,j.Ie,j.Q$,j.q_,j.VI,j.t9,j.n0,j.QI,j.j9,K.JJ,K.On]})}return Ce})()},5460:(zn,wt,S)=>{"use strict";S.d(wt,{v:()=>ye});var h=S(5861),p=S(9127),X=S(8564),a=S(9903),j=S(5472),K=S(6728),C=S(9862),oe=S(5957),_e=S(6814);function Le(De,me){1&De&&(X.TgZ(0,"div"),X._UZ(1,"ion-spinner"),X.qZA())}function ee(De,me){if(1&De){const Ye=X.EpF();X.TgZ(0,"ion-item",5),X.NdJ("click",function(){const Pe=X.CHM(Ye).$implicit,Be=X.oxw(2);return X.KtG(Be.placeSelected(Pe))}),X.TgZ(1,"ion-avatar",6),X._UZ(2,"ion-icon",7),X.qZA(),X.TgZ(3,"ion-label")(4,"p"),X._uU(5),X.qZA()()()}if(2&De){const Ye=me.$implicit;X.xp6(5),X.Oqu(Ye.Address)}}function Te(De,me){if(1&De&&(X.TgZ(0,"div",1),X.YNc(1,Le,2,0,"div",2),X.TgZ(2,"ion-list"),X.YNc(3,ee,6,1,"ion-item",3),X.TgZ(4,"ion-item")(5,"p",4),X._uU(6),X.qZA()()()()),2&De){const Ye=X.oxw();X.xp6(1),X.Q6J("ngIf",Ye.searchInProgress),X.xp6(2),X.Q6J("ngForOf",Ye.placeList),X.xp6(3),X.hij(" ",Ye.placeAttribution," ")}}let ye=(()=>{class De{logging;changeDetector;platform;http;events;placeSearchType;placeList;searchInProgress=!1;searchKeyword;placeSearchFocused;placeSearchActive=!1;placeAttribution="";selectedPlace;placeChanged=new X.vpe;mapService;constructor(Ye,Ce,de,Pe,Be){this.logging=Ye,this.changeDetector=Ce,this.platform=de,this.http=Pe,this.events=Be,this.searchKeyword="",this.searchInProgress=!1,this.mapService=new a.k(Be,Ye,Pe)}ngOnInit(){var Ye=this;return(0,h.Z)(function*(){yield Ye.platform.ready(),Ye.mapService.initAPI()})()}onSearchFocus(){this.placeSearchFocused=!0}onSearchBlur(){this.placeSearchFocused=!1}onSearchCancel(){}getPlacesAutoComplete(Ye,Ce){var de=this;return(0,h.Z)(function*(){de.placeSearchType=Ce;let Pe=Ye.target.value;if(Pe&&Pe.length>3){de.logging.log("Starting place lookup for:"+Pe),de.placeSearchActive=!0,de.searchInProgress=!0,de.searchInProgress=!1,de.placeSearchActive=!0;try{de.placeList=yield de.mapService.placeSearch(Pe),de.placeList&&de.placeList.length>0&&(de.placeAttribution=de.placeList[0].Attribution)}catch{}de.searchInProgress=!1,de.placeSearchActive=!0}else de.searchInProgress=!1,de.placeSearchActive=!1})()}placeSelected(Ye){this.logging.log("Looking up place details:"+Ye.Title+"::"+Ye.ReferenceID),this.selectedPlace=Ye,this.placeChanged.emit(Ye),this.placeSearchActive=!1}static \u0275fac=function(Ce){return new(Ce||De)(X.Y36(p.z),X.Y36(X.sBO),X.Y36(j.t4),X.Y36(C.eN),X.Y36(oe.z))};static \u0275cmp=X.Xpm({type:De,selectors:[["place-search"]],inputs:{searchKeyword:"searchKeyword"},outputs:{selectedPlace:"selectedPlace",placeChanged:"placeChanged"},decls:1,vars:1,consts:[["class","place-search",4,"ngIf"],[1,"place-search"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],[1,"place-attribution"],[3,"click"],["item-left",""],["name","locate"]],template:function(Ce,de){1&Ce&&X.YNc(0,Te,7,3,"div",0),2&Ce&&X.Q6J("ngIf",de.placeSearchActive)},dependencies:[_e.sg,_e.O5,K.BJ,K.gu,K.Ie,K.Q$,K.q_,K.PQ],styles:[".place-search[_ngcontent-%COMP%]{position:absolute;z-index:1000}.place-attribution[_ngcontent-%COMP%]{font-size:9px;color:#dcdcdc;max-width:100%}"]})}return De})()},8696:(zn,wt,S)=>{"use strict";S.d(wt,{o:()=>oe});var h=S(8564),p=S(866),X=S(6814),a=S(6728);function j(_e,Le){if(1&_e){const ee=h.EpF();h.TgZ(0,"ion-button",5),h.NdJ("click",function(){h.CHM(ee);const ye=h.oxw().$implicit,De=h.oxw();return h.KtG(De.onCopyCommand(ye))}),h._uU(1,"Copy"),h.qZA()}}function K(_e,Le){if(1&_e){const ee=h.EpF();h.TgZ(0,"ion-button",5),h.NdJ("click",function(){h.CHM(ee);const ye=h.oxw().$implicit,De=h.oxw();return h.KtG(De.onEditCommand(ye))}),h._uU(1,"Edit"),h.qZA()}}function C(_e,Le){if(1&_e&&(h.TgZ(0,"ion-item",1)(1,"ion-grid")(2,"ion-row")(3,"ion-col"),h._uU(4),h.qZA()(),h.TgZ(5,"ion-row")(6,"ion-col",2)(7,"p"),h._UZ(8,"img",3),h.qZA(),h.TgZ(9,"ion-note"),h._uU(10),h.qZA(),h.YNc(11,j,2,0,"ion-button",4)(12,K,2,0,"ion-button",4),h.qZA(),h.TgZ(13,"ion-col")(14,"ion-row")(15,"ion-col")(16,"p"),h._uU(17),h.qZA(),h.TgZ(18,"ion-note"),h._uU(19),h.qZA()()(),h.TgZ(20,"ion-row")(21,"ion-col"),h._uU(22),h.qZA(),h.TgZ(23,"ion-col"),h._uU(24),h.qZA()()()()()()),2&_e){const ee=Le.$implicit,Te=h.oxw();h.xp6(4),h.hij(" ",ee.AddressInfo.Title," "),h.xp6(4),h.Q6J("src",Te.getIconForPOI(ee),h.LSH),h.xp6(2),h.hij(" ",Te.getFormattedDistance(ee)," "),h.xp6(1),h.Q6J("ngIf",Te.enableCopyOption),h.xp6(1),h.Q6J("ngIf",Te.enableEditOption),h.xp6(5),h.hij(" ",Te.getFormattedAddress(ee)," "),h.xp6(2),h.hij(" ",Te.getFormattedConnectorList(ee)," "),h.xp6(3),h.hij(" ",null==ee.UsageType?null:ee.UsageType.Title," "),h.xp6(2),h.hij(" ",null==ee.OperatorInfo?null:ee.OperatorInfo.Title," ")}}let oe=(()=>{class _e{enableCopyOption=!1;enableEditOption=!1;poiList=[];onCopy=new h.vpe;onEdit=new h.vpe;constructor(){}ngOnInit(){}onCopyCommand(ee){this.onCopy.emit(ee)}onEditCommand(ee){this.onEdit.emit(ee)}getFormattedAddress(ee){let Te="";return Te+=ee.AddressInfo.Title!=ee.AddressInfo.AddressLine1?ee.AddressInfo.Title:ee.AddressInfo.Town,Te}getFormattedConnectorList(ee){if(!ee.Connections)return;let Te=[];for(let ye of ee.Connections)null!=ye.ConnectionType&&(Te.find(De=>De==ye.ConnectionType.Title)||Te.push(ye.ConnectionType.Title));return Te.join(", ")}getIconForPOI(ee){return p.c.getIconForPOI(ee)}getFormattedDistance(ee){return p.c.getFormattedDistance(ee)}static \u0275fac=function(Te){return new(Te||_e)};static \u0275cmp=h.Xpm({type:_e,selectors:[["app-poi-list"]],inputs:{enableCopyOption:"enableCopyOption",enableEditOption:"enableEditOption",poiList:"poiList"},outputs:{onCopy:"onCopy",onEdit:"onEdit"},decls:2,vars:1,consts:[["style","max-width:400px;",4,"ngFor","ngForOf"],[2,"max-width","400px"],["size","3"],[2,"width","24px",3,"src"],["size","small",3,"click",4,"ngIf"],["size","small",3,"click"]],template:function(Te,ye){1&Te&&(h.TgZ(0,"ion-list"),h.YNc(1,C,25,9,"ion-item",0),h.qZA()),2&Te&&(h.xp6(1),h.Q6J("ngForOf",ye.poiList))},dependencies:[X.sg,X.O5,a.YG,a.wI,a.jY,a.Ie,a.q_,a.uN,a.Nd]})}return _e})()},5086:(zn,wt,S)=>{"use strict";S.d(wt,{e:()=>K});var h=S(6814),p=S(6728),X=S(6223),a=S(3999),j=S(8564);let K=(()=>{class C{static \u0275fac=function(Le){return new(Le||C)};static \u0275mod=j.oAB({type:C});static \u0275inj=j.cJS({providers:[h.JJ],imports:[h.ez,p.Pc,X.u5,a.aw]})}return C})()},7777:(zn,wt,S)=>{"use strict";S.d(wt,{X:()=>p});var h=S(553);class p{baseURL;loginProviderRedirectBaseURL;loginProviderRedirectURL;enableLiveMapQuerying;googleMapsAPIKey;enableStaticMaps;constructor(){this.baseURL="https://map.openchargemap.io",this.loginProviderRedirectBaseURL="https://openchargemap.org/site/loginprovider/?_mode=silent&_forceLogin=true&_redirectURL=",this.loginProviderRedirectURL=this.loginProviderRedirectBaseURL+this.baseURL,this.enableLiveMapQuerying=!0,this.googleMapsAPIKey=h.N.googleMapsKey,this.enableStaticMaps=h.N.enableStaticMaps}}},866:(zn,wt,S)=>{"use strict";S.d(wt,{c:()=>p});var h=S(553);let p=(()=>{class X{static isFeatureEnabled(j){return!!h.N.enabledFeatures.find(K=>K===j)}static getClientHeight(){const j=document.body,K=document.documentElement;return Math.max(j.scrollHeight,j.offsetHeight,K.clientHeight,K.scrollHeight,K.offsetHeight)}static getClientWidth(){const j=document.body,K=document.documentElement;return Math.max(j.scrollWidth,j.offsetWidth,K.clientWidth,K.scrollWidth,K.offsetWidth)}static getMaxLevelOfPOI(j){let K=0;if(null!=j.Connections)for(let C=0;C<j.Connections.length;C++)null!=j.Connections[C].Level&&j.Connections[C].Level.ID>K&&(K=j.Connections[C].Level.ID);return 4===K&&(K=2),K>4&&(K=3),K}static getIconForPOI(j){let C="assets/images/icons/map/level"+X.getMaxLevelOfPOI(j);return null!=j.UsageType&&j.UsageType.Title.indexOf("Private")>-1?C+="_private":C+=null!=j.StatusType&&!0!==j.StatusType.IsOperational?"_nonoperational":"_operational",C+="_icon.png",C}static getColorForPOI(j){const K=X.getMaxLevelOfPOI(j);let C="#c0c0c0";return null!=j.UsageType&&j.UsageType.Title.indexOf("Private")>-1?C="#FF0000":null!=j.StatusType&&!0!==j.StatusType.IsOperational?C="#a0a0a0":2==K?C="#72EB0D":3==K&&(C="#EB800D"),C}static getIconForConnector(j){let K="assets/images/icons/connectors/";return K+=1===j?"Type1_J1772.svg":2===j?"Chademo_type4.svg":25===j?"Type2_socket.svg":32===j?"Type1_CCS.svg":33===j?"Type2_CCS.svg":1036===j?"Type2_tethered.svg":26===j?"Type3c.svg":28===j?"schuko.svg":"Unknown.svg",K}static getFormattedDistance(j){return j&&j.AddressInfo&&j.AddressInfo.Distance?j.AddressInfo.Distance.toFixed(1)+" "+(1===j.AddressInfo.DistanceUnit?"km":"miles"):""}static fixJSONDate(j){if(null==j)return null;if(0==j.indexOf("/")){let C=/Date\(([^)]+)\)/.exec(j);j=new Date(parseFloat(C[1]))}else j=new Date(j);return j}static formatMapLinkFromPosition(j,K,C,oe,_e){return'<a href="https://maps.google.com/maps?saddr='+K+","+C+"&daddr="+j.AddressInfo.Latitude+","+j.AddressInfo.Longitude+'">Map ('+Math.ceil(oe)+" "+_e+")</a>"}static formatSystemWebLink(j,K){return"<a href='#' onclick=\"window.open('"+j+"', '_system');return false;\">"+K+"</a>"}static formatMapLink(j,K,C){return C?device&&"WinCE"==device.platform?this.formatSystemWebLink("maps:"+j.AddressInfo.Latitude+","+j.AddressInfo.Longitude,K):device&&"iOS"===device.platform?this.formatSystemWebLink("https://maps.apple.com/?q="+j.AddressInfo.Latitude+","+j.AddressInfo.Longitude,K):this.formatSystemWebLink("https://maps.google.com/maps?q="+j.AddressInfo.Latitude+","+j.AddressInfo.Longitude,K):'<a target="_blank"  href="https://maps.google.com/maps?q='+j.AddressInfo.Latitude+","+j.AddressInfo.Longitude+'">'+K+"</a>"}static formatURL(j,K=null){return null==j||""==j?"":(-1==j.indexOf("http")&&(j="https://"+j),'<a target="_blank" href="'+j+'">'+(K??j)+"</a>")}static formatPOIAddress=function(j,K=!0){let C="";return C=K?""+this.formatTextField(j.AddressInfo.AddressLine1)+this.formatTextField(j.AddressInfo.AddressLine2)+this.formatTextField(j.AddressInfo.Town)+this.formatTextField(j.AddressInfo.StateOrProvince)+this.formatTextField(j.AddressInfo.Postcode)+(null!=j.AddressInfo.Country?this.formatTextField(j.AddressInfo.Country.Title):""):this.formatStringArray([j.AddressInfo.AddressLine1,j.AddressInfo.AddressLine2,j.AddressInfo.Town,j.AddressInfo.StateOrProvince,j.AddressInfo.Postcode,null!=j.AddressInfo.Country?j.AddressInfo.Country.Title:""]),C};static formatStringArray=function(j,K=", "){if(null==j)return"";let C="";for(let oe=0;oe<j.length;oe++)null!=j[oe]&&""!=j[oe].trim()&&(C+=oe==j.length-1?j[oe]:j[oe]+K);return C};static formatString(j){return null==j?"":j.toString()}static formatTextField(j,K=null,C=!1,oe=!1,_e=null){if(null==j||""==j||null==j)return"";let Le=(null!=K?"<strong class='ocm-label' "+(null!=_e?"data-localize='"+_e+"' ":"")+">"+K+"</strong>: ":"")+(C?"<br/>":"")+j.toString().replace("\n","<br/>")+"<br/>";return 1==oe&&(Le="<p>"+Le+"</p>"),Le}static formatEmailAddress(j){return null!=j&&null!=j&&""!=j?"<i class='fa fa-envelope fa-fw'></i> <a href=\"mailto:"+j+'">'+j+"</a><br/>":""}static formatPhone(j,K=null){return null!=j&&null!=j&&""!=j?(null==K?K="<i class='fa fa-phone fa-fw '></i> ":K+=": ",K+'<a href="tel:'+j+'">'+j+"</a><br/>"):""}static formatPOIDetails(j,K){let oe=new Date;null==K&&(K=!1);let _e=this.formatPOIAddress(j,!1),Le="";Le+=this.formatPhone(j.AddressInfo.ContactTelephone1),Le+=this.formatPhone(j.AddressInfo.ContactTelephone2),Le+=this.formatEmailAddress(j.AddressInfo.ContactEmail);let ee="";if(null!=j.AddressInfo.Distance){let Ce="https://maps.google.com/maps?saddr=&daddr="+j.AddressInfo.Latitude+","+j.AddressInfo.Longitude;ee+="<strong id='addr_distance'><span data-localize='details.approxDistance'>Distance</span>: "+j.AddressInfo.Distance.toFixed(1)+" "+(2==j.AddressInfo.DistanceUnit?"Miles":"KM")+"</strong>",ee+="<p>"+this.formatSystemWebLink(Ce,"Get Directions")+"</p>"}if(null!=j.AddressInfo.RelatedURL&&""!=j.AddressInfo.RelatedURL){let Ce=j.AddressInfo.RelatedURL;Ce=Ce.replace(/.*?:\/\//g,""),Ce.length>40&&(Ce=Ce.substr(0,40)+".."),Le+="<i class='fa fa-fw fa-external-link'></i>  "+this.formatSystemWebLink(j.AddressInfo.RelatedURL,"<span data-localize='details.addressRelatedURL'>"+Ce+"</span>")}Le+="</p>";const Te=this.formatTextField(j.GeneralComments,null,!1,!0)+this.formatTextField(j.AddressInfo.AccessComments,"Access",!0,!0,"details.accessComments");let ye="";null!=j.NumberOfPoints&&(ye+=this.formatTextField(j.NumberOfPoints,"Bays",!1,!0,"details.numberOfPoints")),null!=j.UsageType&&(ye+=this.formatTextField(j.UsageType.Title,"Usage",!1,!0,"details.usageType")),null!=j.UsageCost&&(ye+=this.formatTextField(j.UsageCost,"Usage Cost",!1,!0,"details.usageCost")),null!=j.OperatorInfo&&1!=j.OperatorInfo.ID&&(ye+=this.formatTextField(j.OperatorInfo.Title,"Operator",!1,!0,"details.operatorTitle"),null!=j.OperatorInfo.WebsiteURL&&(ye+=this.formatTextField(this.formatURL(j.OperatorInfo.WebsiteURL),"Operator Website",!0,!0,"details.operatorWebsite")));let De="";if(null!=j.StatusType&&(De+=this.formatTextField(j.StatusType.Title,"Status",!1,!0,"details.operationalStatus"),null!=j.DateLastStatusUpdate&&(De+=this.formatTextField(Math.round((oe-this.fixJSONDate(j.DateLastStatusUpdate))/864e5)+" days ago","Last Updated",!1,!0,"details.lastUpdated"))),null!=j.Connections&&j.Connections.length>0){De+="<table class='table table-striped'>",De+="<tr><th data-localize='details.equipment.connectionType'>Connection</th><th data-localize='details.equipment.powerLevel'>Power Level</th><th data-localize='details.operationalStatus'>Status</th></tr>";for(let Ce=0;Ce<j.Connections.length;Ce++){let de=j.Connections[Ce];""==de.Amps&&(de.Amps=null),""==de.Voltage&&(de.Voltage=null),""==de.Quantity&&(de.Quantity=null),""==de.PowerKW&&(de.PowerKW=null),De+="<tr><td>"+(null!=de.ConnectionType?de.ConnectionType.Title:"")+"</td><td>"+(null!=de.Level?"<strong>"+de.Level.Title+"</strong><br/>":"")+(null!=de.Amps?this.formatString(de.Amps)+"A/ ":"")+(null!=de.Voltage?this.formatString(de.Voltage)+"V/ ":"")+(null!=de.PowerKW?this.formatString(de.PowerKW)+"kW <br/>":"")+(null!=de.CurrentType?de.CurrentType.Title:"")+"<br/>"+(null!=de.Quantity?this.formatString(de.Quantity):"1")+" Present</td><td>"+(null!=de.StatusType?de.StatusType.Title:"-")+"</td></tr>"}De+="</table>"}let me="";return me+=this.formatTextField("<a target='_blank' href='https://openchargemap.org/site/poi/details/"+j.ID+"'>OCM-"+j.ID+"</a>","OpenChargeMap Ref",!1,!0,"details.refNumber"),null!=j.DataProvider&&(me+=this.formatTextField(j.DataProvider.Title,"Data Provider",!1,!0,"details.dataProviderTitle"),null!=j.DataProvider.WebsiteURL&&(me+=this.formatTextField(this.formatURL(j.DataProvider.WebsiteURL),"Website",!1,!0,"details.dataProviderWebsite")),me+=this.formatTextField(j.AddressInfo.Latitude,"Latitude",!1,!0,null),me+=this.formatTextField(j.AddressInfo.Longitude,"Longitude",!1,!0,null)),{address:_e,drivingInfo:ee,contactInfo:Le,additionalInfo:Te+ye+De,advancedInfo:me}}static debounce(j,K,C){let oe;return function(){let _e=this,Le=arguments,Te=C&&!oe;clearTimeout(oe),oe=setTimeout(function(){oe=null,C||j.apply(_e,Le)},K),Te&&j.apply(_e,Le)}}static getRandomInt(j){return Math.floor(Math.random()*Math.floor(j))}}return X})()},7518:(zn,wt,S)=>{"use strict";S.d(wt,{Qp:()=>X.Qp,wC:()=>j.wC,jR:()=>j.jR,fw:()=>X.fw,vw:()=>X.vw,be:()=>C.b,nS:()=>a,Nm:()=>K.N,aX:()=>h,qO:()=>p,kA:()=>X.kA});class h{ID;SubmissionType;Data;Attempts;DateQueued;IsSubmitted;IsInProgress;IsCancelled;IsFailure;FailureReason;constructor(_e,Le){this.SubmissionType=_e,this.Data=Le,this.DateQueued=new Date,this.IsSubmitted=!1,this.IsInProgress=!1,this.IsCancelled=!1,this.IsFailure=!1,this.Attempts=0,this.ID=new Date+"_"+100*Math.random()}}var p=function(oe){return oe[oe.POI=0]="POI",oe[oe.Comment=1]="Comment",oe[oe.Media=2]="Media",oe}(p||{}),X=S(7430);class a{Location;Title;Address;Type;ReferenceID;Attribution;AddressInfo}var j=S(3052),K=S(4783),C=S(4677)},3052:(zn,wt,S)=>{"use strict";S.d(wt,{LL:()=>X,jR:()=>p,wC:()=>h});class h{altitudeAccuracy;longitude;latitude;speed;heading;altitude;accuracy;constructor(j=null,K=null){this.latitude=j,this.longitude=K}}class p{coords;timestamp;attribution;constructor(j=null,K=null){this.coords=new h,this.coords.latitude=j,this.coords.longitude=K}static fromPosition(j){return new p(j.coords.latitude,j.coords.longitude)}}class X{northEast;southWest;constructor(j,K){this.northEast=j,this.southWest=K}}},7430:(zn,wt,S)=>{"use strict";S.d(wt,{Qp:()=>X,fw:()=>K,JJ:()=>oe,eN:()=>C,vw:()=>j,kA:()=>a});class h{itemType;itemId;version;schemaVersion;syncTimeStamp;constructor(Le,ee){this.itemType=Le,this.itemId=h.getNewItemId(),this.version=1,this.schemaVersion=ee,this.syncTimeStamp=h.getNewSyncTimeStamp()}static getNewSyncTimeStamp(){return Date.now().toString()}static getNewItemId(){return"_syncitem_"+Date.now().toString()}}class p{Title;Notes;_sync;constructor(Le,ee){this._sync=new h(Le,ee)}}class X extends p{PoiID;Type;Poi;Photos}class a extends p{Stage;Position;PoiIDs;PoiList;constructor(){super("waypoint",1)}}class j extends p{WayPoints;constructor(){super("journey_stage",1),this.WayPoints=[]}}class K extends p{ID;Stages;constructor(){super("journey",1),this.ID=""+Date.now(),this.Stages=[]}}class C{Title;DistanceKM;DurationMinutes;StartElevation;EndElevation;EnergyConsumptionkWh}class oe{Title;JourneyRouteLegs;TotalDistanceKM;TotalDurationMinutes;TotalEnergykWh}},4677:(zn,wt,S)=>{"use strict";S.d(wt,{b:()=>h});class h{poiIdList=null;countryCode=null;latitude=null;longitude=null;locationTitle=null;distance=null;distanceUnit=null;connectionTypeIdList=null;operatorIdList=null;levelIdList=null;countryIdList=null;usageTypeIdList=null;statusTypeIdList=null;minPowerKW=null;maxPowerKW=null;submissionStatusTypeIdList=null;maxResults=500;additionalParams=null;includeComments=!1;compact=!0;enableCaching=!0;levelOfDetail=1;polyline=null;boundingbox=null}},4783:(zn,wt,S)=>{"use strict";S.d(wt,{N:()=>p,U:()=>h});const h=1e3;class p{OperatorList;ConnectionTypeList;CountryList;UsageTypeList;StatusTypeList;MinPowerKW;MaxPowerKW;UseDistanceInKM;HasActiveFilters;LastSearchPosition;StartSearchPosition;StartViewPoiId;Language;FilterOptionsByCountryId;MapType;EnableAdvancedEditorFeatures;EnablePOIPendingApproval;MaxResults;constructor(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MaxPowerKW=null,this.MinPowerKW=null,this.HasActiveFilters=!1,this.FilterOptionsByCountryId=null,this.UseDistanceInKM=!0,this.MapType="ROADMAP",this.EnableAdvancedEditorFeatures=!1,this.EnablePOIPendingApproval=!1,this.MaxResults=500}LoadSettings(){}SaveSettings(){}ClearActiveFilters(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MinPowerKW=null,this.MaxPowerKW=null}CheckForActiveFilters(){return this.HasActiveFilters=this.OperatorList.length>0||this.ConnectionTypeList.length>0||this.CountryList.length>0||this.UsageTypeList.length>0||this.StatusTypeList.length>0||this.MinPowerKW>0||this.MaxPowerKW>0||null!=this.MaxPowerKW&&this.MaxPowerKW<h,this.HasActiveFilters}}},7425:(zn,wt,S)=>{"use strict";S.r(wt),S.d(wt,{AboutPageModule:()=>Le});var h=S(6814),p=S(6223),X=S(6728),a=S(6800),j=S(9236),K=S(8564);const C=[{path:"",component:j.t}];let oe=(()=>{class ee{static \u0275fac=function(De){return new(De||ee)};static \u0275mod=K.oAB({type:ee});static \u0275inj=K.cJS({imports:[a.Bz.forChild(C),a.Bz]})}return ee})();var _e=S(3999);let Le=(()=>{class ee{static \u0275fac=function(De){return new(De||ee)};static \u0275mod=K.oAB({type:ee});static \u0275inj=K.cJS({imports:[h.ez,p.u5,X.Pc,_e.aw,oe]})}return ee})()},9236:(zn,wt,S)=>{"use strict";S.d(wt,{t:()=>j});var h=S(553),p=S(8564),X=S(6728),a=S(3999);let j=(()=>{class K{modalController;constructor(oe){this.modalController=oe}get appVersion(){return h.N.version}get apiUrl(){return h.N.apiBase}ngOnInit(){}close(){this.modalController.dismiss()}static \u0275fac=function(_e){return new(_e||K)(p.Y36(X.IN))};static \u0275cmp=p.Xpm({type:K,selectors:[["app-about"]],decls:46,vars:5,consts:[[1,"ion-padding"],["size","2"],["src","assets/images/icons/branding/AppIcon_128x128.png"],["href","https://openchargemap.org","target","_blank"],["href","https://community.openchargemap.org","target","_blank"],["href","https://webprofusion.com","target","_blank"],["href","https://openchargemap.org/site/about/datasharing","target","_blank"],["slot","end"],[3,"click"],["name","close","slot","start"]],template:function(_e,Le){1&_e&&(p.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),p._uU(3),p.ALo(4,"translate"),p.qZA()()(),p.TgZ(5,"ion-content",0)(6,"ion-grid")(7,"ion-row")(8,"ion-col",1),p._UZ(9,"img",2),p.qZA(),p.TgZ(10,"ion-col")(11,"h1"),p._uU(12,"Open Charge Map"),p.qZA()()()(),p.TgZ(13,"p")(14,"strong"),p._uU(15,"Open Charge Map is the worlds largest Open Data registry of electric vehicle charging locations."),p.qZA(),p._uU(16," By adding and editing the information within Open Charge Map you are improving the data for an unlimited amount of other apps and services which can use the data for free. "),p.qZA(),p.TgZ(17,"p")(18,"a",3),p._uU(19,"openchargemap.org"),p.qZA()(),p.TgZ(20,"p"),p._uU(21,"Join our community discussions: "),p.TgZ(22,"a",4),p._uU(23,"community.openchargemap.org"),p.qZA()(),p.TgZ(24,"p"),p._uU(25,"Software development and service hosting by "),p.TgZ(26,"a",5),p._uU(27,"webprofusion.com"),p.qZA()(),p.TgZ(28,"p"),p._uU(29,"Our service is run by volunteers, our data is largely crowdsourced by you. Some data is imported from public Open Data sources."),p.qZA(),p.TgZ(30,"p"),p._uU(31,"Network operators can "),p.TgZ(32,"a",6),p._uU(33,"provide us with an OCPI data feed"),p.qZA(),p._uU(34," to freely promote their network and ensure information accuracy. "),p.qZA(),p.TgZ(35,"ion-note")(36,"p"),p._uU(37),p.qZA(),p.TgZ(38,"p"),p._uU(39),p.qZA()()(),p.TgZ(40,"ion-footer")(41,"ion-toolbar")(42,"ion-buttons",7)(43,"ion-button",8),p.NdJ("click",function(){return Le.close()}),p._UZ(44,"ion-icon",9),p._uU(45," Close "),p.qZA()()()()),2&_e&&(p.xp6(3),p.hij("",p.lcZ(4,3,"ocm.general.about")," Open Charge Map"),p.xp6(34),p.hij("App Version: ",Le.appVersion,""),p.xp6(2),p.hij("API: ",Le.apiUrl,""))},dependencies:[X.YG,X.Sm,X.wI,X.W2,X.fr,X.jY,X.Gu,X.gu,X.uN,X.Nd,X.wd,X.sr,a.X$]})}return K})()},9192:(zn,wt,S)=>{"use strict";S.r(wt),S.d(wt,{JourneysModule:()=>_e});var h=S(4292),p=S(5086),X=S(3999),a=S(6814),j=S(6223),K=S(6728),C=S(6800),oe=S(8564);let _e=(()=>{class Le{static \u0275fac=function(ye){return new(ye||Le)};static \u0275mod=oe.oAB({type:Le});static \u0275inj=oe.cJS({imports:[a.ez,j.u5,K.Pc,X.aw,p.e,C.Bz.forChild([{path:"",component:h.g}])]})}return Le})()},4292:(zn,wt,S)=>{"use strict";S.d(wt,{g:()=>Be});var h=S(989),p=S(439),X=S(6470),a=S(7518),j=S(9723),K=S(8564),C=S(6728),oe=S(6814);function _e(Ne,Ae){1&Ne&&(K.TgZ(0,"p"),K._uU(1," You have no journeys yet. Start by browsing to a charging location, then add it as Favourite to start a new Journey. "),K.qZA())}function Le(Ne,Ae){if(1&Ne&&(K.TgZ(0,"p"),K._uU(1),K.qZA()),2&Ne){const Ge=K.oxw(2).$implicit;K.xp6(1),K.hij(" ",Ge.Poi.AddressInfo.AddressLine1,"")}}function ee(Ne,Ae){if(1&Ne&&(K.TgZ(0,"p"),K._uU(1),K.qZA()),2&Ne){const Ge=K.oxw(2).$implicit;K.xp6(1),K.hij(" ",Ge.Poi.AddressInfo.AddressLine2,"")}}function Te(Ne,Ae){if(1&Ne&&(K.TgZ(0,"p"),K._uU(1),K.qZA()),2&Ne){const Ge=K.oxw(2).$implicit;K.xp6(1),K.hij(" ",Ge.Poi.AddressInfo.Town,"")}}function ye(Ne,Ae){if(1&Ne&&(K.TgZ(0,"p"),K._uU(1),K.qZA()),2&Ne){const Ge=K.oxw(2).$implicit;K.xp6(1),K.hij(" ",Ge.Poi.AddressInfo.StateOrProvince,"")}}function De(Ne,Ae){if(1&Ne&&(K.TgZ(0,"p"),K._uU(1),K.qZA()),2&Ne){const Ge=K.oxw(2).$implicit;K.xp6(1),K.hij(" ",Ge.Poi.AddressInfo.Postcode,"")}}function me(Ne,Ae){if(1&Ne){const Ge=K.EpF();K.TgZ(0,"div")(1,"div",18),K.NdJ("click",function(){K.CHM(Ge);const ne=K.oxw().$implicit,Ee=K.oxw(4);return K.KtG(Ee.viewPOIDetails(ne.Poi))}),K.YNc(2,Le,2,1,"p",4)(3,ee,2,1,"p",4)(4,Te,2,1,"p",4)(5,ye,2,1,"p",4)(6,De,2,1,"p",4),K.qZA(),K.TgZ(7,"ion-button",19),K.NdJ("click",function(){K.CHM(Ge);const ne=K.oxw().$implicit,Ee=K.oxw(4);return K.KtG(Ee.launchNavigation(ne.Poi))}),K._UZ(8,"ion-icon",20),K._uU(9," Navigate "),K.qZA()()}if(2&Ne){const Ge=K.oxw().$implicit;K.xp6(2),K.Q6J("ngIf",Ge.Poi.AddressInfo.AddressLine1),K.xp6(1),K.Q6J("ngIf",Ge.Poi.AddressInfo.AddressLine2),K.xp6(1),K.Q6J("ngIf",Ge.Poi.AddressInfo.Town),K.xp6(1),K.Q6J("ngIf",Ge.Poi.AddressInfo.StateOrProvince),K.xp6(1),K.Q6J("ngIf",Ge.Poi.AddressInfo.Postcode)}}function Ye(Ne,Ae){if(1&Ne&&(K.TgZ(0,"div",17),K.YNc(1,me,10,5,"div",4),K.qZA()),2&Ne){const Ge=Ae.$implicit;K.xp6(1),K.Q6J("ngIf",Ge.Poi)}}function Ce(Ne,Ae){if(1&Ne&&(K.TgZ(0,"ion-item")(1,"h2"),K._uU(2),K.qZA(),K.TgZ(3,"ion-thumbnail",0),K._UZ(4,"ion-icon",15),K.qZA(),K.TgZ(5,"p"),K._uU(6),K.qZA(),K.YNc(7,Ye,2,1,"div",16),K.qZA()),2&Ne){const Ge=Ae.$implicit;K.xp6(2),K.Oqu(Ge.Title),K.xp6(4),K.Oqu(Ge.Notes),K.xp6(1),K.Q6J("ngForOf",Ge.PoiList)}}function de(Ne,Ae){if(1&Ne&&(K.TgZ(0,"ion-list")(1,"ion-list-header",11),K._uU(2),K._UZ(3,"ion-icon",12),K._uU(4," -- "),K._UZ(5,"ion-icon",13),K._uU(6," -- "),K._UZ(7,"ion-icon",14),K._uU(8," -- "),K.qZA(),K.YNc(9,Ce,8,3,"ion-item",5),K.qZA()),2&Ne){const Ge=Ae.$implicit;K.xp6(2),K.hij(" ",Ge.Title," "),K.xp6(7),K.Q6J("ngForOf",Ge.WayPoints)}}function Pe(Ne,Ae){if(1&Ne){const Ge=K.EpF();K.TgZ(0,"ion-card")(1,"ion-card-content")(2,"ion-toolbar",8)(3,"ion-title"),K._uU(4),K.qZA(),K.TgZ(5,"ion-buttons",9)(6,"ion-button",1),K.NdJ("click",function(){const Ee=K.CHM(Ge).$implicit,xe=K.oxw();return K.KtG(xe.deleteJourney(Ee.ID))}),K._UZ(7,"ion-icon",10),K.qZA()()(),K.TgZ(8,"p"),K._uU(9),K.qZA(),K.YNc(10,de,10,2,"ion-list",5),K.qZA()()}if(2&Ne){const Ge=Ae.$implicit;K.xp6(4),K.hij(" ",Ge.Title,""),K.xp6(5),K.Oqu(Ge.Notes),K.xp6(1),K.Q6J("ngForOf",Ge.Stages)}}let Be=(()=>{class Ne{appManager;journeyManager;api;modalController;alertController;constructor(Ge,lt,ne,Ee,xe){this.appManager=Ge,this.journeyManager=lt,this.api=ne,this.modalController=Ee,this.alertController=xe}dismiss(){this.modalController.dismiss()}discoverImages(){this.journeyManager.journeys.forEach(Ge=>{Ge.Stages.forEach(lt=>{lt.WayPoints.forEach(ne=>{null!=ne.PoiList&&ne.PoiList.forEach(Ee=>{Ee.Poi&&this.api.getPanoramioLocationPhotos(new a.wC(Ee.Poi.AddressInfo.Latitude,Ee.Poi.AddressInfo.Longitude)).then(xe=>{Ee.Photos=xe})})})})})}getJson(Ge){return JSON.stringify(Ge,null,4)}viewPOIDetails(Ge){this.modalController.create({component:j.H,componentProps:{item:Ge}}).then(lt=>lt.present())}get staticMapSize(){return"60x60"}getStaticMapURL(Ge){return"https://maps.googleapis.com/maps/api/staticmap?center="+Ge.AddressInfo.Latitude+","+Ge.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+Ge.AddressInfo.Latitude+","+Ge.AddressInfo.Longitude}deleteJourney(Ge){this.alertController.create({header:"Delete this Journey?",message:"Are you sure you want to delete this Journey?",buttons:[{text:"No",handler:()=>{}},{text:"Delete",handler:()=>{this.journeyManager.deleteJourney(Ge)}}]}).then(lt=>lt.present())}launchNavigation(Ge){let lt="https://maps.google.com/?q="+Ge.AddressInfo.Latitude+","+Ge.AddressInfo.Longitude;this.appManager.platform.is("ios")&&(lt="https://maps.apple.com?q="+Ge.AddressInfo.Latitude+","+Ge.AddressInfo.Longitude),window.open(lt,"_system")}static \u0275fac=function(lt){return new(lt||Ne)(K.Y36(X.c),K.Y36(h.i),K.Y36(p.l),K.Y36(C.IN),K.Y36(C.Br))};static \u0275cmp=K.Xpm({type:Ne,selectors:[["ng-component"]],decls:18,vars:2,consts:[["slot","start"],[3,"click"],[1,"journeys-page"],[1,"ion-padding"],[4,"ngIf"],[4,"ngFor","ngForOf"],["slot","end"],["name","close","slot","start"],["primary",""],["slot","primary"],["name","close","slot","icon-only"],[2,"font-size","1.5rem"],["name","car"],["name","time"],["name","flash"],["name","caret-down",2,"font-size","4rem"],["style","text-align:right;width:100%;",4,"ngFor","ngForOf"],[2,"text-align","right","width","100%"],["tappable","",3,"click"],["clear","","item-right","",3,"click"],["name","navigate","slot","start"]],template:function(lt,ne){1&lt&&(K.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-back-button",1),K.NdJ("click",function(){return ne.dismiss()}),K.qZA()(),K.TgZ(4,"ion-title"),K._uU(5," Journeys "),K.qZA()()(),K.TgZ(6,"ion-content",2)(7,"div",3)(8,"p"),K._uU(9," You can create and plan journeys to group your favourite charging routes together. "),K.qZA(),K.YNc(10,_e,2,0,"p",4),K.qZA(),K.YNc(11,Pe,11,3,"ion-card",5),K.qZA(),K.TgZ(12,"ion-footer")(13,"ion-toolbar")(14,"ion-buttons",6)(15,"ion-button",1),K.NdJ("click",function(){return ne.dismiss()}),K._UZ(16,"ion-icon",7),K._uU(17," Close "),K.qZA()()()()),2&lt&&(K.xp6(10),K.Q6J("ngIf",null==ne.journeyManager.journeys||0==ne.journeyManager.journeys.length),K.xp6(1),K.Q6J("ngForOf",ne.journeyManager.journeys))},dependencies:[oe.sg,oe.O5,C.YG,C.Sm,C.PM,C.FN,C.W2,C.fr,C.Gu,C.gu,C.Ie,C.q_,C.yh,C.Bs,C.wd,C.sr,C.oU],encapsulation:2})}return Ne})()},2309:(zn,wt,S)=>{"use strict";S.r(wt),S.d(wt,{LayerEditorPageModule:()=>Le});var h=S(6814),p=S(6223),X=S(6728),a=S(6800),j=S(8062),K=S(8564);const C=[{path:"",component:j.A}];let oe=(()=>{class ee{static \u0275fac=function(De){return new(De||ee)};static \u0275mod=K.oAB({type:ee});static \u0275inj=K.cJS({imports:[a.Bz.forChild(C),a.Bz]})}return ee})();var _e=S(5086);let Le=(()=>{class ee{static \u0275fac=function(De){return new(De||ee)};static \u0275mod=K.oAB({type:ee});static \u0275inj=K.cJS({imports:[h.ez,p.u5,X.Pc,oe,_e.e]})}return ee})()},8062:(zn,wt,S)=>{"use strict";S.d(wt,{A:()=>oe});var h=S(5861),p=S(9159),X=S(8564),a=S(6728),j=S(6814),K=S(8696);function C(_e,Le){if(1&_e&&(X.TgZ(0,"div"),X._uU(1),X._UZ(2,"app-poi-list",10),X.qZA()),2&_e){const ee=X.oxw();X.xp6(1),X.hij(" Items Parsed: ",ee.fileData.length," "),X.xp6(1),X.Q6J("poiList",ee.fileData)}}let oe=(()=>{class _e{modalController;refData;fileData;constructor(ee,Te){this.modalController=ee,this.refData=Te}ngOnInit(){}previewFile(){var ee=this;return(0,h.Z)(function*(){yield ee.loadFile(!1)})()}cancel(){var ee=this;return(0,h.Z)(function*(){yield ee.modalController.dismiss(ee.fileData)})()}loadFile(ee=!0){var Te=this;return(0,h.Z)(function*(){const ye=new FileReader;ye.onload=()=>{let me=JSON.parse(ye.result),Ye=5e6;for(let Ce of me)(null==Ce.ID||""==Ce.ID)&&(Ce.ID=Ye.toString()),Ce.ID="imp_"+Ce.ID,Ye++;Te.fileData=Te.refData.hydrateCompactPOIList(me),ee&&Te.modalController.dismiss(Te.fileData)},ye.onerror=()=>{},ye.readAsText(document.getElementById("file-upload").files[0])})()}add(){var ee=this;return(0,h.Z)(function*(){ee.modalController.dismiss(ee.fileData)})()}static \u0275fac=function(Te){return new(Te||_e)(X.Y36(a.IN),X.Y36(p.W))};static \u0275cmp=X.Xpm({type:_e,selectors:[["app-layer-editor"]],decls:27,vars:1,consts:[[1,"ion-padding"],[1,"upload"],["name","file","aria-label","file","slot","start"],["type","file","required","","id","file-upload",3,"change"],[4,"ngIf"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","checkmark-circle-outline","slot","end"],[3,"poiList"]],template:function(Te,ye){1&Te&&(X.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),X._uU(3," Edit Layer "),X.qZA()()(),X.TgZ(4,"ion-content",0)(5,"p"),X._uU(6,"POI layers are used to preview data from other Open Data sources. "),X.qZA(),X.TgZ(7,"p"),X._uU(8,"Select a POI layer JSON file: "),X.qZA(),X.TgZ(9,"div")(10,"label",1)(11,"ion-button"),X._UZ(12,"ion-icon",2),X.TgZ(13,"ion-label"),X._uU(14,"Choose File.."),X.qZA()(),X.TgZ(15,"input",3),X.NdJ("change",function(){return ye.previewFile()}),X.qZA()()(),X.YNc(16,C,3,2,"div",4),X.qZA(),X.TgZ(17,"ion-footer")(18,"ion-toolbar")(19,"ion-buttons",5)(20,"ion-button",6),X.NdJ("click",function(){return ye.cancel()}),X._UZ(21,"ion-icon",7),X._uU(22," Cancel "),X.qZA()(),X.TgZ(23,"ion-buttons",8)(24,"ion-button",6),X.NdJ("click",function(){return ye.add()}),X._uU(25," Add "),X._UZ(26,"ion-icon",9),X.qZA()()()()),2&Te&&(X.xp6(16),X.Q6J("ngIf",ye.fileData&&ye.fileData.length>0))},dependencies:[j.O5,a.YG,a.Sm,a.W2,a.fr,a.Gu,a.gu,a.Q$,a.wd,a.sr,K.o],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]})}return _e})()},9723:(zn,wt,S)=>{"use strict";S.d(wt,{H:()=>mn});var h=S(6470),p=S(8564),X=S(6728),a=S(5472),j=S(5861),K=S(989),C=S(7430),oe=S(6814),_e=S(6223);function Le(ae,ht){if(1&ae&&(p.TgZ(0,"ion-select-option",13),p._uU(1),p.qZA()),2&ae){const G=ht.$implicit;p.Q6J("value",G.ID),p.xp6(1),p.Oqu(G.Title)}}function ee(ae,ht){if(1&ae&&(p.TgZ(0,"ion-select-option",16),p._uU(1),p.qZA()),2&ae){const G=ht.$implicit;p.Q6J("value",ht.index),p.xp6(1),p.Oqu(G.Title)}}function Te(ae,ht){if(1&ae){const G=p.EpF();p.TgZ(0,"ion-item")(1,"ion-label",2),p._uU(2,"Journey Stage"),p.qZA(),p.TgZ(3,"ion-select",3),p.NdJ("ngModelChange",function(at){p.CHM(G);const rn=p.oxw();return p.KtG(rn.selectedStageIndex=at)}),p.TgZ(4,"ion-select-option",14),p._uU(5,"Create a Journey Stage"),p.qZA(),p.YNc(6,ee,2,2,"ion-select-option",15),p.qZA()()}if(2&ae){const G=p.oxw();p.xp6(3),p.Q6J("ngModel",G.selectedStageIndex),p.xp6(3),p.Q6J("ngForOf",G.journeyManager.getJourneyStages(G.selectedJourneyID))}}function ye(ae,ht){if(1&ae){const G=p.EpF();p.TgZ(0,"ion-item")(1,"ion-label",2),p._uU(2,"New Journey Name"),p.qZA(),p.TgZ(3,"ion-input",7),p.NdJ("ngModelChange",function(at){p.CHM(G);const rn=p.oxw();return p.KtG(rn.newJourneyName=at)}),p.qZA()()}if(2&ae){const G=p.oxw();p.xp6(3),p.Q6J("ngModel",G.newJourneyName)}}let De=(()=>{class ae{appManager;navParams;journeyManager;modalController;selectedJourneyID;selectedStageIndex;newJourneyName;waypoint;poi;constructor(G,ze,at,rn){this.appManager=G,this.navParams=ze,this.journeyManager=at,this.modalController=rn,this.poi=this.navParams.get("poi"),this.waypoint=new C.kA,this.waypoint.Title=this.poi.AddressInfo.Title,this.waypoint.PoiIDs=[this.poi.ID],this.waypoint.PoiList=[];const Dn=new C.Qp("charging",1);Dn.Poi=this.poi,Dn.PoiID=this.poi.ID,this.waypoint.PoiList.push(Dn),this.newJourneyName="Trip to "+this.poi.AddressInfo.Title}cancel(){this.modalController.dismiss()}add(){if(null!=this.selectedJourneyID&&""!==this.selectedJourneyID)this.journeyManager.addJourneyWaypoint(this.selectedJourneyID,this.selectedStageIndex,this.waypoint);else{const G=new C.fw;G.ID=Date.now().toString(),""===this.newJourneyName&&(this.newJourneyName="New Journey"),G.Title=this.newJourneyName,this.journeyManager.addJourney(G,this.waypoint)}this.journeyManager.saveJourneys(),this.modalController.dismiss()}static \u0275fac=function(ze){return new(ze||ae)(p.Y36(h.c),p.Y36(a.X1),p.Y36(K.i),p.Y36(X.IN))};static \u0275cmp=p.Xpm({type:ae,selectors:[["ng-component"]],decls:39,vars:8,consts:[[1,"journeys-page","ion-padding"],[1,"banner"],["position","stacked"],[3,"ngModel","ngModelChange"],["value","","checked",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","text",3,"ngModel","ngModelChange"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","add","slot","end"],[3,"value"],["value",""],["checked","",3,"value",4,"ngFor","ngForOf"],["checked","",3,"value"]],template:function(ze,at){1&ze&&(p.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),p._uU(3," Edit Favourite "),p.qZA()()(),p.TgZ(4,"ion-content",0)(5,"div",1)(6,"h1"),p._uU(7),p.qZA(),p.TgZ(8,"p"),p._uU(9),p.qZA()(),p.TgZ(10,"p"),p._uU(11," Add Charging Location as a Journey Waypoint "),p.qZA(),p.TgZ(12,"ion-item")(13,"ion-label",2),p._uU(14,"Add to a Journey"),p.qZA(),p.TgZ(15,"ion-select",3),p.NdJ("ngModelChange",function(Dn){return at.selectedJourneyID=Dn}),p.TgZ(16,"ion-select-option",4),p._uU(17,"Create a New Journey"),p.qZA(),p.YNc(18,Le,2,2,"ion-select-option",5),p.qZA()(),p.YNc(19,Te,7,2,"ion-item",6)(20,ye,4,1,"ion-item",6),p.TgZ(21,"ion-item")(22,"ion-label",2),p._uU(23,"Name for this step of your journey"),p.qZA(),p.TgZ(24,"ion-input",7),p.NdJ("ngModelChange",function(Dn){return at.waypoint.Title=Dn}),p.qZA()(),p.TgZ(25,"ion-item")(26,"ion-label",2),p._uU(27,"Other Notes"),p.qZA(),p.TgZ(28,"ion-textarea",3),p.NdJ("ngModelChange",function(Dn){return at.waypoint.Notes=Dn}),p.qZA()()(),p.TgZ(29,"ion-footer")(30,"ion-toolbar")(31,"ion-buttons",8)(32,"ion-button",9),p.NdJ("click",function(){return at.cancel()}),p._UZ(33,"ion-icon",10),p._uU(34," Cancel "),p.qZA()(),p.TgZ(35,"ion-buttons",11)(36,"ion-button",9),p.NdJ("click",function(){return at.add()}),p._uU(37," Add "),p._UZ(38,"ion-icon",12),p.qZA()()()()),2&ze&&(p.xp6(7),p.Oqu(at.poi.AddressInfo.Title),p.xp6(2),p.Oqu(at.poi.AddressInfo.AddressLine1),p.xp6(6),p.Q6J("ngModel",at.selectedJourneyID),p.xp6(3),p.Q6J("ngForOf",at.journeyManager.journeys),p.xp6(1),p.Q6J("ngIf",at.selectedJourneyID),p.xp6(1),p.Q6J("ngIf",!at.selectedJourneyID),p.xp6(4),p.Q6J("ngModel",at.waypoint.Title),p.xp6(4),p.Q6J("ngModel",at.waypoint.Notes))},dependencies:[oe.sg,oe.O5,_e.JJ,_e.On,X.YG,X.Sm,X.W2,X.fr,X.Gu,X.gu,X.pK,X.Ie,X.Q$,X.t9,X.n0,X.g2,X.wd,X.sr,X.QI,X.j9],encapsulation:2})}return ae})();var me=S(9127);function Ye(ae,ht){if(1&ae){const G=p.EpF();p.TgZ(0,"ion-card")(1,"ion-toolbar")(2,"ion-title",14),p._uU(3,"Preview"),p.qZA(),p.TgZ(4,"ion-buttons",15)(5,"ion-button",4),p.NdJ("click",function(){p.CHM(G);const at=p.oxw();return p.KtG(at.rotateImage())}),p._UZ(6,"ion-icon",16),p.TgZ(7,"ion-label"),p._uU(8,"Rotate"),p.qZA()()()(),p.TgZ(9,"ion-card-content")(10,"ion-list")(11,"ion-item")(12,"ion-label",17),p._uU(13,"Comment"),p.qZA(),p.TgZ(14,"ion-input",18),p.NdJ("ngModelChange",function(at){p.CHM(G);const rn=p.oxw();return p.KtG(rn.comment=at)}),p.qZA()()(),p._UZ(15,"img",19),p.qZA()()}if(2&ae){const G=p.oxw();p.xp6(14),p.Q6J("ngModel",G.comment)}}let Ce=(()=>{class ae{navParams;appManager;nav;modalController;logging;mode;processingQuality;imgData;targetWidth;targetHeight;comment;chargePointId;poi;constructor(G,ze,at,rn,Dn){this.navParams=G,this.appManager=ze,this.nav=at,this.modalController=rn,this.logging=Dn,this.processingQuality=.8,this.targetWidth=1024,this.targetHeight=800,this.mode=ze.platformMode,this.chargePointId=this.navParams.get("id"),this.poi=this.navParams.get("poi"),this.comment=""}processNativeImageSource(G){let ze=G;const at=document.getElementById("img-upload-canvas"),rn=at.getContext("2d"),Dn=new Image;Dn.onload=()=>{this.logging.log("img load:"+Dn.width),at.width=Dn.width,at.height=Dn.height,rn.fillStyle="rgb(0,0,0)",rn.fillRect(0,0,at.width,at.height),rn.drawImage(Dn,0,0,at.width,at.height),this.imgData=at.toDataURL("image/png"),this.processImage()},Dn.src=ze}loadCameraOrLibraryImage(G=!1){this.logging.log("PWA mode: fetching image");const ze=new FileReader;ze.onload=()=>{this.imgData=ze.result,this.processImage()},ze.onerror=()=>{},ze.readAsDataURL(document.getElementById("img-upload-media").files[0])}isBrowserMode(){return this.appManager.isPlatform("desktop")||this.appManager.isPlatform("hybrid")}processImage(){if(null!=this.imgData){const ze=document.getElementById("img-upload-canvas"),at=ze.getContext("2d"),rn=new Image;rn.onload=()=>{ze.width=rn.width,ze.height=rn.height,at.fillStyle="rgb(0,0,0)",at.fillRect(0,0,ze.width,ze.height),at.drawImage(rn,0,0,ze.width,ze.height),this.refreshImageFromCanvas()},rn.src=this.imgData}else this.logging.log("processImage: nothing to process.")}refreshImageFromCanvas(){const G=document.getElementById("img-upload-canvas");this.imgData=G.toDataURL("image/jpeg",.8),document.getElementById("preview").src=this.imgData}rotateImage(){const G=document.getElementById("img-upload-canvas");let ze=new Image;ze.src=G.toDataURL(),ze.onload=()=>{let at=G.height,rn=G.width;G.width=at,G.height=rn,at=G.height,rn=G.width;const Dn=G.getContext("2d");Dn.save(),Dn.translate(rn,at/rn),Dn.rotate(Math.PI/2),Dn.drawImage(ze,0,0),Dn.restore(),ze=null,this.refreshImageFromCanvas()}}performUpload(){var G=this;return(0,j.Z)(function*(){if(!G.imgData)return void(yield G.appManager.showToastNotification("Select an image to upload."));const ze={chargePointID:G.chargePointId,comment:G.comment,imageDataBase64:G.imgData};yield G.appManager.showLoadingProgress("Uploading photo..");try{yield G.appManager.submitMediaItem(ze),G.appManager.dismissLoadingProgress().then(()=>{G.appManager.showToastNotification("Upload completed"),G.modalController.dismiss()}),G.appManager.analytics.appEvent("MediaUpload","Completed")}catch{yield G.appManager.dismissLoadingProgress(),yield G.appManager.showToastNotification("Upload failed, please try again."),G.appManager.analytics.appEvent("MediaUpload","Failed")}})()}cancel(){var G=this;return(0,j.Z)(function*(){yield G.modalController.dismiss()})()}static \u0275fac=function(ze){return new(ze||ae)(p.Y36(a.X1),p.Y36(h.c),p.Y36(a.SH),p.Y36(X.IN),p.Y36(me.z))};static \u0275cmp=p.Xpm({type:ae,selectors:[["ng-component"]],decls:32,vars:3,consts:[[1,"media-upload"],[1,"ion-padding"],[1,"banner"],[1,"upload"],[3,"click"],["name","camera","aria-label","camera","slot","start"],["type","file","required","","id","img-upload-media",3,"change"],["inputFile",""],["id","img-upload-canvas",2,"display","none","width","500","height","500","border","1px solid red"],[4,"ngIf"],["slot","secondary"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],["slot","start"],["slot","end"],["name","refresh","slot","start"],["position","floating"],["type","text","placeholder","(optional comment)",3,"ngModel","ngModelChange"],["id","preview",2,"max-width","500px"]],template:function(ze,at){if(1&ze){const rn=p.EpF();p.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),p._uU(3," Share Photo "),p.qZA()()(),p.TgZ(4,"ion-content",0)(5,"div",1)(6,"div",2)(7,"h1"),p._uU(8),p.qZA(),p.TgZ(9,"p"),p._uU(10),p.qZA()(),p.TgZ(11,"p"),p._uU(12,"You can upload a photo from your device or take a new photo: "),p.qZA(),p.TgZ(13,"div",3)(14,"ion-button",4),p.NdJ("click",function(){p.CHM(rn);const gi=p.MAs(19);return p.KtG(gi.click())}),p._UZ(15,"ion-icon",5),p.TgZ(16,"ion-label"),p._uU(17,"Choose Photo.."),p.qZA()(),p.TgZ(18,"input",6,7),p.NdJ("change",function(){return at.loadCameraOrLibraryImage()}),p.qZA()(),p._UZ(20,"canvas",8),p.YNc(21,Ye,16,1,"ion-card",9),p.qZA()(),p.TgZ(22,"ion-footer")(23,"ion-toolbar")(24,"ion-buttons",10)(25,"ion-button",4),p.NdJ("click",function(){return at.cancel()}),p._UZ(26,"ion-icon",11),p._uU(27," Cancel "),p.qZA()(),p.TgZ(28,"ion-buttons",12)(29,"ion-button",4),p.NdJ("click",function(){return at.performUpload()}),p._uU(30," Upload "),p._UZ(31,"ion-icon",13),p.qZA()()()()}2&ze&&(p.xp6(8),p.Oqu(at.poi.AddressInfo.Title),p.xp6(2),p.Oqu(at.poi.AddressInfo.AddressLine1),p.xp6(11),p.Q6J("ngIf",null!=at.imgData))},dependencies:[oe.O5,_e.JJ,_e.On,X.YG,X.Sm,X.PM,X.FN,X.W2,X.fr,X.Gu,X.gu,X.pK,X.Ie,X.Q$,X.q_,X.wd,X.sr,X.j9],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]})}return ae})();var de=S(6800);function Pe(ae,ht){if(1&ae&&(p.TgZ(0,"ion-select-option",19),p._uU(1),p.qZA()),2&ae){const G=ht.$implicit;p.Q6J("value",G.ID),p.xp6(1),p.Oqu(G.Title)}}function Be(ae,ht){if(1&ae&&(p.TgZ(0,"ion-select-option",19),p._uU(1),p.qZA()),2&ae){const G=ht.$implicit;p.Q6J("value",G.ID),p.xp6(1),p.Oqu(G.Title)}}let Ne=(()=>{class ae{navParams;appManager;nav;zone;loadingController;modalController;logging;router;commentModel;poi;commentTypes;checkinTypes;constructor(G,ze,at,rn,Dn,gi,Mi,Li){this.navParams=G,this.appManager=ze,this.nav=at,this.zone=rn,this.loadingController=Dn,this.modalController=gi,this.logging=Mi,this.router=Li,this.commentModel={ChargePointID:this.navParams.get("id"),Comment:"",CheckinStatusTypeID:10,CommentTypeID:10,Rating:null},this.poi=this.navParams.get("poi"),this.commentTypes=ze.referenceDataManager.getCommentTypes(!0,!0),this.checkinTypes=ze.referenceDataManager.getCheckinStatusTypes(!0,!0)}onPageWillEnter(){}cancel(){this.modalController.dismiss()}add(){var G=this;return(0,j.Z)(function*(){const ze=yield G.loadingController.create({message:"Sending .."});yield ze.present(),(yield G.appManager.submitComment(G.commentModel).catch(rn=>{G.appManager.showToastNotification("There was a problem submitting your comment."),G.loadingController.dismiss(),G.appManager.analytics.appEvent("Comment","Failed")}))&&(G.logging.log("Comment submitted"),yield ze.dismiss(),yield G.modalController.dismiss(),G.appManager.analytics.appEvent("Comment","Submitted"))})()}static \u0275fac=function(ze){return new(ze||ae)(p.Y36(a.X1),p.Y36(h.c),p.Y36(a.SH),p.Y36(p.R0b),p.Y36(X.HT),p.Y36(X.IN),p.Y36(me.z),p.Y36(de.F0))};static \u0275cmp=p.Xpm({type:ae,selectors:[["ng-component"]],decls:53,vars:8,consts:[["color","primary"],[1,"comment-page","ion-padding"],[1,"banner"],[1,"ion-padding"],["position","stacked"],[3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","(optional comment)",3,"ngModel","ngModelChange"],["value","5"],["value","4"],["value","3"],["value","2"],["value","1"],["value",""],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],[3,"value"]],template:function(ze,at){1&ze&&(p.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),p._uU(3," Add Comment "),p.qZA()()(),p.TgZ(4,"ion-content",1)(5,"div",2)(6,"h1"),p._uU(7),p.qZA(),p.TgZ(8,"p"),p._uU(9),p.qZA()(),p.TgZ(10,"p",3),p._uU(11,"Recent Check-ins are a big help to other drivers when planning their journey. Tell everyone what you thought about this charging location. "),p.qZA(),p.TgZ(12,"ion-list")(13,"ion-item")(14,"ion-label",4),p._uU(15,"Comment Type"),p.qZA(),p.TgZ(16,"ion-select",5),p.NdJ("ngModelChange",function(Dn){return at.commentModel.CommentTypeID=Dn}),p.YNc(17,Pe,2,2,"ion-select-option",6),p.qZA()(),p.TgZ(18,"ion-item")(19,"ion-label",4),p._uU(20,"What Did You Think?"),p.qZA(),p.TgZ(21,"ion-input",7),p.NdJ("ngModelChange",function(Dn){return at.commentModel.Comment=Dn}),p.qZA()(),p.TgZ(22,"ion-item")(23,"ion-label",4),p._uU(24,"Did You Successfully Charge?"),p.qZA(),p.TgZ(25,"ion-select",5),p.NdJ("ngModelChange",function(Dn){return at.commentModel.CheckinStatusTypeID=Dn}),p.YNc(26,Be,2,2,"ion-select-option",6),p.qZA()(),p.TgZ(27,"ion-item")(28,"ion-label",4),p._uU(29,"Your Rating"),p.qZA(),p.TgZ(30,"ion-select",5),p.NdJ("ngModelChange",function(Dn){return at.commentModel.Rating=Dn}),p.TgZ(31,"ion-select-option",8),p._uU(32,"5 - Excellent"),p.qZA(),p.TgZ(33,"ion-select-option",9),p._uU(34,"4 - Good"),p.qZA(),p.TgZ(35,"ion-select-option",10),p._uU(36,"3 - Average"),p.qZA(),p.TgZ(37,"ion-select-option",11),p._uU(38,"2 - Not Good"),p.qZA(),p.TgZ(39,"ion-select-option",12),p._uU(40,"1 - Bad"),p.qZA(),p.TgZ(41,"ion-select-option",13),p._uU(42,"Not Rated"),p.qZA()()()()(),p.TgZ(43,"ion-footer")(44,"ion-toolbar")(45,"ion-buttons",14)(46,"ion-button",15),p.NdJ("click",function(){return at.cancel()}),p._UZ(47,"ion-icon",16),p._uU(48," Cancel "),p.qZA()(),p.TgZ(49,"ion-buttons",17)(50,"ion-button",15),p.NdJ("click",function(){return at.add()}),p._uU(51," Submit "),p._UZ(52,"ion-icon",18),p.qZA()()()()),2&ze&&(p.xp6(7),p.Oqu(at.poi.AddressInfo.Title),p.xp6(2),p.Oqu(at.poi.AddressInfo.AddressLine1),p.xp6(7),p.Q6J("ngModel",at.commentModel.CommentTypeID),p.xp6(1),p.Q6J("ngForOf",at.commentTypes),p.xp6(4),p.Q6J("ngModel",at.commentModel.Comment),p.xp6(4),p.Q6J("ngModel",at.commentModel.CheckinStatusTypeID),p.xp6(1),p.Q6J("ngForOf",at.checkinTypes),p.xp6(4),p.Q6J("ngModel",at.commentModel.Rating))},dependencies:[oe.sg,_e.JJ,_e.On,X.YG,X.Sm,X.W2,X.fr,X.Gu,X.gu,X.pK,X.Ie,X.Q$,X.q_,X.t9,X.n0,X.wd,X.sr,X.QI,X.j9],encapsulation:2})}return ae})();var Ae=S(7777),Ge=S(4669),lt=S(8767),ne=S(6662),Ee=S(866),xe=S(3999),je=S(1163);function Se(ae,ht){if(1&ae&&(p.TgZ(0,"div")(1,"small"),p._uU(2),p.qZA()()),2&ae){const G=p.oxw(2);p.xp6(2),p.Oqu(G.connectionSummary)}}function Ve(ae,ht){if(1&ae&&(p.TgZ(0,"div")(1,"small"),p._uU(2),p.qZA()()),2&ae){const G=p.oxw(2);p.xp6(2),p.Oqu(G.poi.OperatorInfo.Title)}}function Xe(ae,ht){1&ae&&(p.TgZ(0,"div")(1,"small"),p._uU(2,"[Submission Awaiting Review]"),p.qZA()())}function Ht(ae,ht){if(1&ae){const G=p.EpF();p.ynx(0),p.TgZ(1,"ion-button",26),p.NdJ("click",function(){p.CHM(G);const at=p.oxw(2);return p.KtG(at.addFavourite())}),p._UZ(2,"ion-icon",27),p.TgZ(3,"ion-label"),p._uU(4,"Favourite"),p.qZA()(),p.TgZ(5,"ion-button",28),p.NdJ("click",function(){p.CHM(G);const at=p.oxw(2);return p.KtG(at.edit())}),p._UZ(6,"ion-icon",29),p.TgZ(7,"ion-label"),p._uU(8,"Edit"),p.qZA()(),p.BQk()}}function cn(ae,ht){if(1&ae){const G=p.EpF();p.ynx(0),p.TgZ(1,"ion-button",30),p.NdJ("click",function(){p.CHM(G);const at=p.oxw(2);return p.KtG(at.launchNavigation())}),p._UZ(2,"ion-icon",31),p.TgZ(3,"ion-label"),p._uU(4,"Navigate"),p.qZA()(),p.BQk()}}function xn(ae,ht){if(1&ae){const G=p.EpF();p.ynx(0),p.TgZ(1,"ion-button",32),p.NdJ("click",function(){p.CHM(G);const at=p.oxw(2);return p.KtG(at.addComment())}),p._UZ(2,"ion-icon",33),p.TgZ(3,"ion-label"),p._uU(4,"Add Comment"),p.qZA()(),p.BQk()}}function $t(ae,ht){if(1&ae){const G=p.EpF();p.ynx(0),p.TgZ(1,"ion-button",34),p.NdJ("click",function(){p.CHM(G);const at=p.oxw(2);return p.KtG(at.addMedia())}),p._UZ(2,"ion-icon",35),p.TgZ(3,"ion-label"),p._uU(4," Add Photo"),p.qZA()(),p.BQk()}}function ke(ae,ht){if(1&ae&&(p.TgZ(0,"div"),p._uU(1),p.qZA()),2&ae){const G=p.oxw(4);p.xp6(1),p.hij(" ",G.poi.AddressInfo.AddressLine1,"")}}function pe(ae,ht){if(1&ae&&(p.TgZ(0,"div"),p._uU(1),p.qZA()),2&ae){const G=p.oxw(4);p.xp6(1),p.hij(" ",G.poi.AddressInfo.AddressLine2,"")}}function Oe(ae,ht){if(1&ae&&(p.TgZ(0,"div"),p._uU(1),p.qZA()),2&ae){const G=p.oxw(4);p.xp6(1),p.hij(" ",G.poi.AddressInfo.Town,"")}}function ie(ae,ht){if(1&ae&&(p.TgZ(0,"div"),p._uU(1),p.qZA()),2&ae){const G=p.oxw(4);p.xp6(1),p.hij(" ",G.poi.AddressInfo.StateOrProvince,"")}}function it(ae,ht){if(1&ae&&(p.TgZ(0,"div"),p._uU(1),p.qZA()),2&ae){const G=p.oxw(4);p.xp6(1),p.hij(" ",G.poi.AddressInfo.Postcode,"")}}function _t(ae,ht){if(1&ae&&(p.TgZ(0,"div"),p._uU(1),p.qZA()),2&ae){const G=p.oxw(4);p.xp6(1),p.hij(" ",G.poi.AddressInfo.Country.Title,"")}}function Kt(ae,ht){if(1&ae&&(p.TgZ(0,"p"),p._uU(1),p.qZA()),2&ae){const G=p.oxw(4);p.xp6(1),p.hij(" ",G.poi.AddressInfo.AccessComments," ")}}function Mn(ae,ht){if(1&ae&&(p.TgZ(0,"p"),p._UZ(1,"ion-icon",40),p.TgZ(2,"span",38),p._uU(3),p.qZA()()),2&ae){const G=p.oxw(4);p.xp6(3),p.Oqu(G.poi.AddressInfo.ContactTelephone1)}}function fn(ae,ht){if(1&ae&&(p.TgZ(0,"p"),p._UZ(1,"ion-icon",40),p.TgZ(2,"span",38),p._uU(3),p.qZA()()),2&ae){const G=p.oxw(4);p.xp6(3),p.Oqu(G.poi.AddressInfo.ContactTelephone2)}}function qn(ae,ht){if(1&ae&&(p.TgZ(0,"p"),p._UZ(1,"ion-icon",41),p.TgZ(2,"span",38),p._uU(3),p.qZA()()),2&ae){const G=p.oxw(4);p.xp6(3),p.Oqu(G.poi.AddressInfo.ContactEmail)}}function li(ae,ht){if(1&ae&&(p.TgZ(0,"p"),p._UZ(1,"ion-icon",42),p.TgZ(2,"span",38)(3,"a",43),p._uU(4),p.qZA()()()),2&ae){const G=p.oxw(4);p.xp6(3),p.s9C("href",G.poi.AddressInfo.RelatedURL,p.LSH),p.xp6(1),p.Oqu(G.poi.AddressInfo.RelatedURL)}}function en(ae,ht){if(1&ae&&(p.TgZ(0,"ion-card")(1,"ion-card-header")(2,"ion-card-subtitle"),p._uU(3),p.ALo(4,"translate"),p.qZA()(),p.TgZ(5,"ion-card-content")(6,"ion-grid")(7,"ion-row")(8,"ion-col")(9,"ion-label"),p._uU(10),p.ALo(11,"translate"),p.qZA(),p.TgZ(12,"div",38),p.YNc(13,ke,2,1,"div",0)(14,pe,2,1,"div",0)(15,Oe,2,1,"div",0)(16,ie,2,1,"div",0)(17,it,2,1,"div",0)(18,_t,2,1,"div",0),p.qZA()(),p.TgZ(19,"ion-col"),p.YNc(20,Kt,2,1,"p",0)(21,Mn,4,1,"p",0)(22,fn,4,1,"p",0)(23,qn,4,1,"p",0)(24,li,5,2,"p",0),p.qZA()(),p.TgZ(25,"ion-row")(26,"ion-col")(27,"ion-label",39),p._uU(28),p.ALo(29,"number"),p.ALo(30,"number"),p.qZA()()()()()()),2&ae){const G=p.oxw(3);p.xp6(3),p.hij(" ",p.lcZ(4,15,"ocm.details.location.sectionTitle")," "),p.xp6(7),p.hij(" ",p.lcZ(11,17,"ocm.details.location.address"),""),p.xp6(3),p.Q6J("ngIf",G.poi.AddressInfo.AddressLine1),p.xp6(1),p.Q6J("ngIf",G.poi.AddressInfo.AddressLine2),p.xp6(1),p.Q6J("ngIf",G.poi.AddressInfo.Town),p.xp6(1),p.Q6J("ngIf",G.poi.AddressInfo.StateOrProvince),p.xp6(1),p.Q6J("ngIf",G.poi.AddressInfo.Postcode),p.xp6(1),p.Q6J("ngIf",G.poi.AddressInfo.Country),p.xp6(2),p.Q6J("ngIf",G.poi.AddressInfo.AccessComments),p.xp6(1),p.Q6J("ngIf",G.poi.AddressInfo.ContactTelephone1),p.xp6(1),p.Q6J("ngIf",G.poi.AddressInfo.ContactTelephone2),p.xp6(1),p.Q6J("ngIf",G.poi.AddressInfo.ContactEmail),p.xp6(1),p.Q6J("ngIf",G.poi.AddressInfo.RelatedURL),p.xp6(4),p.AsE(" Lat/Long: ",p.xi3(29,19,G.poi.AddressInfo.Latitude,"1.1-6")," , ",p.xi3(30,22,G.poi.AddressInfo.Longitude,"1.1-6")," ")}}function Dt(ae,ht){if(1&ae&&(p.TgZ(0,"p")(1,"span",44),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"span",38),p._uU(5),p.qZA()()),2&ae){const G=p.oxw(3);p.xp6(2),p.hij("",p.lcZ(3,2,"ocm.details.numberOfPoints"),":"),p.xp6(3),p.Oqu(G.poi.NumberOfPoints)}}function Ie(ae,ht){if(1&ae&&(p.TgZ(0,"p")(1,"span",44),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"span",38),p._uU(5),p.qZA()()),2&ae){const G=p.oxw(3);p.xp6(2),p.hij("",p.lcZ(3,2,"ocm.details.operationalStatus"),":"),p.xp6(3),p.hij(" ",G.poi.StatusType.Title," ")}}function Ct(ae,ht){if(1&ae&&(p.TgZ(0,"p")(1,"span",44),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"span",38),p._uU(5),p.qZA()()),2&ae){const G=p.oxw(3);p.xp6(2),p.hij("",p.lcZ(3,2,"ocm.details.usageType"),":"),p.xp6(3),p.Oqu(G.poi.UsageType.Title)}}function on(ae,ht){if(1&ae&&(p.TgZ(0,"p")(1,"span",44),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"span",38),p._uU(5),p.qZA()()),2&ae){const G=p.oxw(3);p.xp6(2),p.hij("",p.lcZ(3,2,"ocm.details.usageCost"),":"),p.xp6(3),p.hij(" ",G.poi.UsageCost,"")}}function Rn(ae,ht){if(1&ae&&(p.TgZ(0,"p"),p._UZ(1,"br"),p._uU(2),p.ALo(3,"translate"),p._UZ(4,"br"),p.TgZ(5,"span",38),p._uU(6),p.qZA()()),2&ae){const G=p.oxw(3);p.xp6(2),p.hij("",p.lcZ(3,2,"ocm.details.generalComments"),": "),p.xp6(4),p.Oqu(G.poi.GeneralComments)}}function Vn(ae,ht){if(1&ae&&(p.TgZ(0,"p"),p._UZ(1,"ion-icon",46),p._uU(2),p.qZA()),2&ae){const G=p.oxw(4);p.xp6(2),p.hij(" ",G.poi.OperatorInfo.WebsiteURL," ")}}function Ut(ae,ht){if(1&ae&&(p.TgZ(0,"p"),p._UZ(1,"ion-icon",41),p._uU(2),p.qZA()),2&ae){const G=p.oxw(4);p.xp6(2),p.hij(" ",G.poi.OperatorInfo.ContactEmail," ")}}function Hn(ae,ht){if(1&ae&&(p.TgZ(0,"p"),p._UZ(1,"ion-icon",41),p._uU(2),p.qZA()),2&ae){const G=p.oxw(4);p.xp6(2),p.hij(" ",G.poi.OperatorInfo.FaultReportEmail," ")}}function qe(ae,ht){if(1&ae&&(p.TgZ(0,"ion-card")(1,"ion-card-header")(2,"ion-card-subtitle"),p._uU(3),p.ALo(4,"translate"),p.qZA()(),p.TgZ(5,"ion-card-content")(6,"div",38)(7,"p",45),p._uU(8),p.qZA(),p.YNc(9,Vn,3,1,"p",0)(10,Ut,3,1,"p",0)(11,Hn,3,1,"p",0),p.qZA()()()),2&ae){const G=p.oxw(3);p.xp6(3),p.hij(" ",p.lcZ(4,5,"ocm.details.operator.sectionTitle")," "),p.xp6(5),p.hij(" ",G.poi.OperatorInfo.Title," "),p.xp6(1),p.Q6J("ngIf",G.poi.OperatorInfo.WebsiteURL),p.xp6(1),p.Q6J("ngIf",null!=G.poi.OperatorInfo.ContactEmail),p.xp6(1),p.Q6J("ngIf",null!=G.poi.OperatorInfo.FaultReportEmail&&G.poi.OperatorInfo.FaultReportEmail!=G.poi.OperatorInfo.ContactEmail)}}function Nt(ae,ht){if(1&ae){const G=p.EpF();p.TgZ(0,"a",48),p.NdJ("click",function(){p.CHM(G);const at=p.oxw(4);return p.KtG(at.launchURL(at.poi.DataProvider.WebsiteURL))}),p._uU(1),p.qZA()}if(2&ae){const G=p.oxw(4);p.xp6(1),p.Oqu(G.poi.DataProvider.WebsiteURL)}}function Xt(ae,ht){if(1&ae&&(p.TgZ(0,"div",38)(1,"h3"),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"p"),p._uU(5),p.qZA(),p.YNc(6,Nt,2,1,"a",47),p.TgZ(7,"p"),p._uU(8),p.qZA()()),2&ae){const G=p.oxw(3);p.xp6(2),p.hij(" ",p.lcZ(3,4,"ocm.details.dataProvider.sectionTitle")," "),p.xp6(3),p.Oqu(null==G.poi.DataProvider?null:G.poi.DataProvider.Title),p.xp6(1),p.Q6J("ngIf",G.poi.DataProvider.WebsiteURL),p.xp6(2),p.Oqu(null==G.poi.DataProvider?null:G.poi.DataProvider.License)}}function Tn(ae,ht){if(1&ae&&(p.TgZ(0,"div"),p.YNc(1,en,31,25,"ion-card",0),p.TgZ(2,"ion-card")(3,"ion-card-header")(4,"ion-card-subtitle"),p._uU(5),p.ALo(6,"translate"),p.qZA()(),p.TgZ(7,"ion-card-content"),p.YNc(8,Dt,6,4,"p",0),p._UZ(9,"app-equipment-details",36),p.qZA()(),p.TgZ(10,"ion-card")(11,"ion-card-header")(12,"ion-card-subtitle"),p._uU(13,"Usage Restrictions"),p.qZA()(),p.TgZ(14,"ion-card-content"),p.YNc(15,Ie,6,4,"p",0)(16,Ct,6,4,"p",0)(17,on,6,4,"p",0)(18,Rn,7,4,"p",0),p.qZA()(),p.YNc(19,qe,12,7,"ion-card",0),p.TgZ(20,"ion-card")(21,"ion-card-header"),p._uU(22),p.ALo(23,"translate"),p.qZA(),p.TgZ(24,"ion-card-content"),p.YNc(25,Xt,9,6,"div",37),p.qZA()()()),2&ae){const G=p.oxw(2);p.xp6(1),p.Q6J("ngIf",G.poi.AddressInfo),p.xp6(4),p.hij(" ",p.lcZ(6,11,"ocm.details.equipment.sectionTitle")," "),p.xp6(3),p.Q6J("ngIf",null!=G.poi.NumberOfPoints),p.xp6(1),p.Q6J("item",G.poi),p.xp6(6),p.Q6J("ngIf",null!=G.poi.StatusType),p.xp6(1),p.Q6J("ngIf",null!=G.poi.UsageType),p.xp6(1),p.Q6J("ngIf",null!=G.poi.UsageCost),p.xp6(1),p.Q6J("ngIf",null!=G.poi.GeneralComments),p.xp6(1),p.Q6J("ngIf",G.poi.OperatorInfo),p.xp6(3),p.hij(" ",p.lcZ(23,13,"ocm.details.advancedDetails")," "),p.xp6(3),p.Q6J("ngIf",G.poi.DataProvider)}}function oi(ae,ht){if(1&ae&&p._UZ(0,"img",51),2&ae){const G=p.oxw().$implicit;p.s9C("src",null==G.User?null:G.User.ProfileImageURL,p.LSH)}}function xi(ae,ht){if(1&ae&&(p.TgZ(0,"span"),p._uU(1),p.qZA()),2&ae){const G=p.oxw().$implicit;p.xp6(1),p.Oqu(G.User.Username)}}function Oi(ae,ht){if(1&ae&&(p.TgZ(0,"span"),p._uU(1),p.qZA()),2&ae){const G=p.oxw().$implicit;p.xp6(1),p.Oqu(G.Username)}}function gr(ae,ht){if(1&ae&&(p.TgZ(0,"p",38),p._uU(1),p.qZA()),2&ae){const G=p.oxw().$implicit;p.xp6(1),p.hij(" ",null==G.CommentType?null:G.CommentType.Title," ")}}function ki(ae,ht){if(1&ae&&(p.TgZ(0,"p")(1,"span",44),p._uU(2,"Rating:"),p.qZA(),p.TgZ(3,"span",38),p._uU(4),p.qZA()()),2&ae){const G=p.oxw().$implicit;p.xp6(4),p.hij("",G.Rating," out of 5")}}function Wi(ae,ht){1&ae&&(p.ynx(0),p._UZ(1,"ion-icon",52),p.BQk())}function _n(ae,ht){1&ae&&(p.ynx(0),p._UZ(1,"ion-icon",53),p.BQk())}function Bi(ae,ht){if(1&ae&&(p.TgZ(0,"p"),p.YNc(1,Wi,2,0,"ng-container",0)(2,_n,2,0,"ng-container",0),p._uU(3),p.qZA()),2&ae){const G=p.oxw().$implicit;p.xp6(1),p.Q6J("ngIf",!0===G.CheckinStatusType.IsPositive),p.xp6(1),p.Q6J("ngIf",!1===G.CheckinStatusType.IsPositive),p.xp6(1),p.hij(" ",G.CheckinStatusType.Title," ")}}function pn(ae,ht){if(1&ae&&(p.TgZ(0,"ion-card")(1,"ion-item")(2,"ion-avatar",19),p.YNc(3,oi,1,1,"img",50),p.qZA(),p.TgZ(4,"ion-label"),p.YNc(5,xi,2,1,"span",0)(6,Oi,2,1,"span",0),p.qZA(),p.TgZ(7,"ion-label",20),p._uU(8),p.ALo(9,"date"),p.qZA()(),p.TgZ(10,"ion-card-content")(11,"p"),p._uU(12),p.qZA(),p.YNc(13,gr,2,1,"p",37)(14,ki,5,1,"p",0)(15,Bi,4,3,"p",0),p.qZA()()),2&ae){const G=ht.$implicit;p.xp6(3),p.Q6J("ngIf",G.User&&G.User.ProfileImageURL),p.xp6(2),p.Q6J("ngIf",G.User),p.xp6(1),p.Q6J("ngIf",!G.User),p.xp6(2),p.hij(" ",p.lcZ(9,8,G.DateCreated)," "),p.xp6(4),p.Oqu(G.Comment),p.xp6(1),p.Q6J("ngIf",10!=G.CommentTypeID),p.xp6(1),p.Q6J("ngIf",G.Rating),p.xp6(1),p.Q6J("ngIf",G.CheckinStatusType)}}function sn(ae,ht){if(1&ae&&(p.ynx(0),p.YNc(1,pn,16,10,"ion-card",49),p.BQk()),2&ae){const G=p.oxw(3);p.xp6(1),p.Q6J("ngForOf",G.poi.UserComments)}}function Cn(ae,ht){1&ae&&(p.ynx(0),p.TgZ(1,"ion-card")(2,"ion-card-content")(3,"p"),p._uU(4),p.ALo(5,"translate"),p.qZA()()(),p.BQk()),2&ae&&(p.xp6(4),p.hij(" ",p.lcZ(5,1,"ocm.details.commentsAndRatings.addPrompt")," "))}function $i(ae,ht){if(1&ae&&(p.TgZ(0,"div"),p.YNc(1,sn,2,1,"ng-container",0)(2,Cn,6,3,"ng-container",0),p.qZA()),2&ae){const G=p.oxw(2);p.xp6(1),p.Q6J("ngIf",1==G.poi._hasComments),p.xp6(1),p.Q6J("ngIf",0==G.poi._hasComments)}}function ct(ae,ht){if(1&ae&&p._UZ(0,"img",51),2&ae){const G=p.oxw().$implicit;p.s9C("src",null==G.User?null:G.User.ProfileImageURL,p.LSH)}}function ge(ae,ht){if(1&ae&&(p.TgZ(0,"span"),p._uU(1),p.qZA()),2&ae){const G=p.oxw().$implicit;p.xp6(1),p.Oqu(G.User.Username)}}function se(ae,ht){if(1&ae&&(p.TgZ(0,"span"),p._uU(1),p.qZA()),2&ae){const G=p.oxw().$implicit;p.xp6(1),p.Oqu(G.Username)}}function tt(ae,ht){if(1&ae&&(p.TgZ(0,"ion-card"),p._UZ(1,"img",51),p.TgZ(2,"ion-item")(3,"ion-avatar",19),p.YNc(4,ct,1,1,"img",50),p.qZA(),p.TgZ(5,"ion-label"),p.YNc(6,ge,2,1,"span",0)(7,se,2,1,"span",0),p.qZA(),p.TgZ(8,"ion-label",20),p._uU(9),p.ALo(10,"date"),p.qZA()(),p.TgZ(11,"ion-card-content")(12,"p"),p._uU(13),p.qZA()()()),2&ae){const G=ht.$implicit;p.xp6(1),p.s9C("src",G.ItemMediumURL,p.LSH),p.xp6(3),p.Q6J("ngIf",G.User&&G.User.ProfileImageURL),p.xp6(2),p.Q6J("ngIf",G.User),p.xp6(1),p.Q6J("ngIf",!G.User),p.xp6(2),p.hij(" ",p.lcZ(10,6,G.DateCreated)," "),p.xp6(4),p.Oqu(G.Comment)}}function yt(ae,ht){if(1&ae&&(p.TgZ(0,"div"),p.YNc(1,tt,14,8,"ion-card",49),p.qZA()),2&ae){const G=p.oxw(3);p.xp6(1),p.Q6J("ngForOf",G.poi.MediaItems)}}function Ot(ae,ht){1&ae&&(p.ynx(0),p.TgZ(1,"ion-card")(2,"ion-card-content")(3,"p"),p._uU(4),p.ALo(5,"translate"),p.qZA()()(),p.BQk()),2&ae&&(p.xp6(4),p.hij(" ",p.lcZ(5,1,"ocm.details.mediaItems.addPrompt")," "))}function Gt(ae,ht){if(1&ae&&(p.TgZ(0,"div"),p.YNc(1,yt,2,1,"div",0)(2,Ot,6,3,"ng-container",0),p.qZA()),2&ae){const G=p.oxw(2);p.xp6(1),p.Q6J("ngIf",G.poi._hasPhotos),p.xp6(1),p.Q6J("ngIf",0==G.poi._hasPhotos)}}function Vt(ae,ht){if(1&ae&&(p.TgZ(0,"p",54),p._uU(1),p.qZA()),2&ae){const G=p.oxw(2);p.xp6(1),p.hij(" ",G.json,"")}}function Et(ae,ht){if(1&ae){const G=p.EpF();p.TgZ(0,"div")(1,"div",1)(2,"div",2)(3,"h2"),p._uU(4),p.qZA(),p.TgZ(5,"div")(6,"small"),p._uU(7),p.qZA()(),p.YNc(8,Se,3,1,"div",0)(9,Ve,3,1,"div",0)(10,Xe,3,0,"div",0),p.TgZ(11,"ion-badge",3),p._uU(12),p.ALo(13,"number"),p.qZA()(),p.TgZ(14,"ion-fab",4)(15,"ion-fab-button"),p._UZ(16,"ion-icon",5),p.qZA(),p.TgZ(17,"ion-fab-list",6)(18,"ion-fab-button",7),p.NdJ("click",function(){p.CHM(G);const at=p.oxw();return p.KtG(at.addComment())}),p._UZ(19,"ion-icon",8),p.qZA(),p.TgZ(20,"ion-fab-button",9),p.NdJ("click",function(){p.CHM(G);const at=p.oxw();return p.KtG(at.addMedia())}),p._UZ(21,"ion-icon",10),p.qZA(),p.TgZ(22,"ion-fab-button",11),p.NdJ("click",function(){p.CHM(G);const at=p.oxw();return p.KtG(at.addFavourite())}),p._UZ(23,"ion-icon",12),p.qZA(),p.TgZ(24,"ion-fab-button",13),p.NdJ("click",function(){p.CHM(G);const at=p.oxw();return p.KtG(at.edit())}),p._UZ(25,"ion-icon",14),p.qZA(),p.TgZ(26,"ion-fab-button",15),p.NdJ("click",function(){p.CHM(G);const at=p.oxw();return p.KtG(at.refresh())}),p._UZ(27,"ion-icon",16),p.qZA()()()(),p.TgZ(28,"ion-refresher",17),p.NdJ("ionRefresh",function(at){p.CHM(G);const rn=p.oxw();return p.KtG(rn.refresh(at))}),p._UZ(29,"ion-refresher-content",18),p.qZA(),p.TgZ(30,"ion-toolbar")(31,"ion-buttons",19),p.YNc(32,Ht,9,0,"ng-container",0),p.qZA(),p.TgZ(33,"ion-buttons",20),p.YNc(34,cn,5,0,"ng-container",0)(35,xn,5,0,"ng-container",0)(36,$t,5,0,"ng-container",0),p.qZA()(),p.TgZ(37,"ion-segment",21),p.NdJ("ngModelChange",function(at){p.CHM(G);const rn=p.oxw();return p.KtG(rn.selectedTab=at)}),p.TgZ(38,"ion-segment-button",22)(39,"ion-label"),p._uU(40," Details "),p.qZA()(),p.TgZ(41,"ion-segment-button",23)(42,"ion-label"),p._uU(43),p.qZA()(),p.TgZ(44,"ion-segment-button",24)(45,"ion-label"),p._uU(46),p.qZA()()(),p.YNc(47,Tn,26,15,"div",0)(48,$i,3,2,"div",0)(49,Gt,3,2,"div",0)(50,Vt,2,1,"p",25),p.qZA()}if(2&ae){const G=p.oxw();p.xp6(1),p.Udp("background-image",G.backdropImage?"url("+G.backdropImage+")":""),p.xp6(3),p.hij(" ",G.poi.AddressInfo.Title," "),p.xp6(3),p.hij("OCM-",G.poi.ID,""),p.xp6(1),p.Q6J("ngIf",G.connectionSummary),p.xp6(1),p.Q6J("ngIf",G.poi.OperatorInfo),p.xp6(1),p.Q6J("ngIf",1==G.poi.SubmissionStatusTypeID),p.xp6(2),p.Oqu(p.xi3(13,19,G.avgRating,"1.1-1")),p.xp6(20),p.Q6J("ngIf","location"==G.selectedTab),p.xp6(2),p.Q6J("ngIf","location"==G.selectedTab),p.xp6(1),p.Q6J("ngIf","comments"==G.selectedTab),p.xp6(1),p.Q6J("ngIf","media"==G.selectedTab),p.xp6(1),p.Q6J("ngModel",G.selectedTab),p.xp6(6),p.hij("Comments (",G.poi.UserComments?G.poi.UserComments.length:0,")"),p.xp6(3),p.hij(" Photos (",G.poi.MediaItems?G.poi.MediaItems.length:0,")"),p.xp6(1),p.Q6J("ngIf","location"==G.selectedTab),p.xp6(1),p.Q6J("ngIf","comments"==G.selectedTab),p.xp6(1),p.Q6J("ngIf","media"==G.selectedTab),p.xp6(1),p.Q6J("ngIf",1==G.appManager.isDebugMode)}}function Jt(ae,ht){1&ae&&(p.TgZ(0,"div")(1,"h2"),p._uU(2,"POI Not Found"),p.qZA(),p.TgZ(3,"p"),p._uU(4,"The POI details could not be loaded."),p.qZA()())}let Bn=(()=>{class ae{appManager;nav;translate;logging;modalController;actionSheetController;poiManager;router;poi;selectedTab;json;hasNavBar=!1;backdropImage;avgRating;connectionSummary;constructor(G,ze,at,rn,Dn,gi,Mi,Li){this.appManager=G,this.nav=ze,this.translate=at,this.logging=rn,this.modalController=Dn,this.actionSheetController=gi,this.poiManager=Mi,this.router=Li}ngOnChanges(G){if(this.logging.log("In ngOnChanges of POI Details"),null!=this.poi&&null!=this.poi.AddressInfo){if(this.selectedTab="location",null!=this.poi.MediaItems&&this.poi.MediaItems.length>0){this.poi._hasPhotos=!0;for(let ze of this.poi.MediaItems)ze.ItemMediumURL=ze.ItemThumbnailURL.replace(".thmb.",".medi.");this.backdropImage=this.poi.MediaItems[this.poi.MediaItems.length-1].ItemThumbnailURL.replace(".thmb.",".medi.")}else this.poi._hasPhotos=!1,this.backdropImage=null;if(null!=this.poi.UserComments&&this.poi.UserComments.length>0){this.poi._hasComments=!0;try{let ze=this.poi.UserComments.filter(at=>at.Rating>0);if(ze.length>0){let at=0;for(let rn of ze)at+=rn.Rating;this.avgRating=at/ze.length}else this.avgRating=null}catch{}}else this.poi._hasComments=!1;if(this.poi.Connections&&this.poi.Connections.length>0){let ze="";for(let at of this.poi.Connections)-1==ze.indexOf(at.ConnectionType.Title)&&(ze+=(""!=ze?", ":"")+at.ConnectionType.Title);this.connectionSummary=ze}}}ngOnInit(){this.logging.log("In ngInit of POI Details")}get staticMapURL(){return"https://maps.googleapis.com/maps/api/staticmap?key="+(new Ae.X).googleMapsAPIKey+"&center="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude}get staticMapSize(){return 0===this.appManager.clientWidth?"240x100":this.appManager.clientWidth>=800?"640x100":this.appManager.clientWidth>=400?"400x100":"240x100"}continueAddComment(){var G=this;return(0,j.Z)(function*(){const ze=yield G.modalController.create({component:Ne,componentProps:{id:G.poi.ID,poi:G.poi}});setTimeout(()=>{G.refresh()},1e3),yield ze.present()})()}addComment(){var G=this;return(0,j.Z)(function*(){if(G.appManager.isUserAuthenticated(!0))yield G.continueAddComment();else{const ze=yield G.modalController.create({component:lt.F});ze.onDidDismiss().then((0,j.Z)(function*(){G.appManager.isUserAuthenticated(!0)&&(yield G.continueAddComment())})),yield ze.present()}})()}continueAddMedia(){var G=this;return(0,j.Z)(function*(){const ze=yield G.modalController.create({component:Ce,componentProps:{id:G.poi.ID,poi:G.poi}});ze.onDidDismiss().then(()=>{setTimeout(()=>{G.refresh()},1e3)}),yield ze.present()})()}addMedia(){var G=this;return(0,j.Z)(function*(){if(G.appManager.isUserAuthenticated(!0))yield G.continueAddMedia();else{const ze=yield G.modalController.create({component:lt.F});ze.onDidDismiss().then((0,j.Z)(function*(){G.appManager.isUserAuthenticated(!0)&&(yield G.continueAddMedia())})),yield ze.present()}})()}addFavourite(){var G=this;return(0,j.Z)(function*(){yield(yield G.actionSheetController.create({header:"Add Favourite",buttons:[{text:"Add to Journey",handler:()=>{G.modalController.create({component:De,componentProps:{poi:G.poi}}).then(at=>at.present())}},{text:"Cancel",role:"cancel",handler:()=>{}}]})).present()})()}launchNavigation(){this.appManager.isPlatform("ios")?this.appManager.launchWebPage("https://maps.apple.com/?ll="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude):this.appManager.launchWebPage("https://maps.google.com/?q="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude)}launchURL(G){this.appManager.launchWebPage(G)}continueEdit(){var G=this;return(0,j.Z)(function*(){const ze=yield G.modalController.create({component:ne.Y,componentProps:{id:G.poi.ID}});return ze.onDidDismiss().then(at=>{G.refresh()}),yield ze.present()})()}edit(){var G=this;return(0,j.Z)(function*(){if(Ee.c.isFeatureEnabled("EDIT_POI"))if(G.appManager.isUserAuthenticated(!0))yield G.continueEdit();else{const ze=yield G.modalController.create({component:lt.F});ze.onDidDismiss().then((0,j.Z)(function*(){G.appManager.isUserAuthenticated(!0)&&(yield G.continueEdit())})),yield ze.present()}else G.appManager.launchOCMWebPage("/poi/edit/"+G.poi.ID)})()}refresh(G=null){this.poi&&this.poiManager.getPOIById(this.poi.ID,!0,!0).then(ze=>{ze&&(this.poi=ze,this.ngOnChanges(null)),G&&G.target.complete()})}static \u0275fac=function(ze){return new(ze||ae)(p.Y36(h.c),p.Y36(a.SH),p.Y36(xe.sK),p.Y36(me.z),p.Y36(X.IN),p.Y36(X.BX),p.Y36(Ge.R),p.Y36(de.F0))};static \u0275cmp=p.Xpm({type:ae,selectors:[["poi-details"]],inputs:{poi:"poi"},features:[p.TTD],decls:2,vars:2,consts:[[4,"ngIf"],[1,"banner"],[1,"banner-content"],["color","primary","title","Average User Rating"],["vertical","top","horizontal","end","slot","fixed"],["name","add"],["side","bottom"],["title","Add a comment or charging check-in",3,"click"],["name","chatbubbles"],["title","Add a Photo",3,"click"],["name","camera"],["title","Add to Favourites",3,"click"],["name","star"],["title","Submit an Edit",3,"click"],["name","create"],["title","Refresh",3,"click"],["name","refresh"],["slot","fixed",3,"ionRefresh"],["pullingIcon","caret-down","pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refreshing..."],["slot","start"],["slot","end"],[3,"ngModel","ngModelChange"],["value","location","selected",""],["value","comments"],["value","media"],["style","white-space: pre-wrap;",4,"ngIf"],["size","small","title","Add to Favourites",3,"click"],["name","star","slot","start"],["size","small","title","Submit an Edit",3,"click"],["name","create","slot","start"],["size","small","title","Navigate to this location",3,"click"],["name","navigate","slot","start"],["size","small","title","Add a comment or charging check-in",3,"click"],["name","chatbubbles","slot","start"],["size","small","title","Add a Photo",3,"click"],["name","camera","slot","start"],[3,"item"],["class","details",4,"ngIf"],[1,"details"],[1,"details-minor"],["name","call"],["name","mail"],["name","globe"],["target","_system",3,"href"],[1,"label"],[1,"ion-padding-left"],["name","link"],["href","javascript:void(0)",3,"click",4,"ngIf"],["href","javascript:void(0)",3,"click"],[4,"ngFor","ngForOf"],[3,"src",4,"ngIf"],[3,"src"],["name","checkmark-circle","color","success",2,"font-size","2em"],["name","close-circle","color","danger"],[2,"white-space","pre-wrap"]],template:function(ze,at){1&ze&&p.YNc(0,Et,51,22,"div",0)(1,Jt,5,0,"div",0),2&ze&&(p.Q6J("ngIf",null!=at.poi&&null!=at.poi.AddressInfo),p.xp6(1),p.Q6J("ngIf",null==at.poi||null==at.poi.AddressInfo))},dependencies:[oe.sg,oe.O5,X.BJ,X.yp,X.YG,X.Sm,X.PM,X.FN,X.Zi,X.tO,X.wI,X.IJ,X.W4,X.zq,X.jY,X.gu,X.Ie,X.Q$,X.nJ,X.Wo,X.Nd,X.cJ,X.GO,X.sr,X.QI,_e.JJ,_e.On,je.B,oe.JJ,oe.uU,xe.X$],styles:[".banner[_ngcontent-%COMP%]{background-color:#4f712f;color:#ffffffec;padding:1em;text-shadow:#000 1px 1px 1px;min-height:180px;background-size:cover}.banner[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.banner-content[_ngcontent-%COMP%]{padding-right:48px}h3[_ngcontent-%COMP%]{font-weight:700}.label[_ngcontent-%COMP%]{color:#000;font-weight:700;font-size:12px}.details[_ngcontent-%COMP%]{color:#707d61;margin-left:1em;font-size:12px}.details-minor[_ngcontent-%COMP%]{color:#707d61;font-size:12px}p[_ngcontent-%COMP%]{display:block;padding:4px}"]})}return ae})(),mn=(()=>{class ae{modalController;navParams;appManager;poi;hasNavbar=!1;constructor(G,ze,at){this.modalController=G,this.navParams=ze,this.appManager=at,this.poi=this.navParams.get("item"),this.appManager.analytics.viewEvent("POIDetails")}close(){this.modalController.dismiss()}static \u0275fac=function(ze){return new(ze||ae)(p.Y36(X.IN),p.Y36(a.X1),p.Y36(h.c))};static \u0275cmp=p.Xpm({type:ae,selectors:[["ng-component"]],decls:11,vars:3,consts:[["color","primary"],["slot","start"],[3,"click"],["name","close","slot","icon-only"],[1,"poi-details"],[3,"poi"]],template:function(ze,at){1&ze&&(p.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),p._uU(3),p.TgZ(4,"small"),p._uU(5),p.qZA()(),p.TgZ(6,"ion-buttons",1)(7,"ion-button",2),p.NdJ("click",function(){return at.close()}),p._UZ(8,"ion-icon",3),p.qZA()()()(),p.TgZ(9,"ion-content",4),p._UZ(10,"poi-details",5),p.qZA()),2&ze&&(p.xp6(3),p.hij(" ",at.poi.AddressInfo.Title," "),p.xp6(2),p.hij("OCM-",at.poi.ID,""),p.xp6(5),p.Q6J("poi",at.poi))},dependencies:[X.YG,X.Sm,X.W2,X.Gu,X.gu,X.wd,X.sr,Bn],styles:['.left-col[_ngcontent-%COMP%]{float:left;width:50%;overflow:auto}.right-col[_ngcontent-%COMP%]{float:right;width:50%;overflow:auto}.row[_ngcontent-%COMP%]:after{content:"";display:table;clear:both;overflow:auto}.row[_ngcontent-%COMP%]{margin-bottom:1em}.subtle[_ngcontent-%COMP%]{color:silver}@media screen and (max-width: 768px){.left-col[_ngcontent-%COMP%]{float:none;width:100%}.right-col[_ngcontent-%COMP%]{margin-top:1em;float:none;width:100%}}.address-details[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:200px;width:auto}ion-label[_ngcontent-%COMP%]{overflow:inherit}ion-title[_ngcontent-%COMP%] > small[_ngcontent-%COMP%]{color:#ffffffbf}']})}return ae})()},5722:(zn,wt,S)=>{"use strict";S.r(wt),S.d(wt,{PoiEditorPageModule:()=>Le});var h=S(6814),p=S(6223),X=S(6800),a=S(6728),j=S(6662),K=S(3999),C=S(5086),oe=S(8564);const _e=[{path:"",component:j.Y}];let Le=(()=>{class ee{static \u0275fac=function(De){return new(De||ee)};static \u0275mod=oe.oAB({type:ee});static \u0275inj=oe.cJS({imports:[h.ez,p.u5,a.Pc,K.aw,C.e,X.Bz.forChild(_e)]})}return ee})()},6662:(zn,wt,S)=>{"use strict";S.d(wt,{Y:()=>Vn});var h=S(5861),p=S(6470),X=S(7518),a=S(866),j=S(4669),K=S(1847),C=S(8564),oe=S(3955),_e=S(9903),Le=S(9127),ee=S(5957),Te=S(9862),ye=S(6814),De=S(6728);function me(Ut,Hn){if(1&Ut){const qe=C.EpF();C.ynx(0),C.TgZ(1,"ion-note")(2,"p"),C._uU(3," The closest address to this position is: "),C.qZA(),C.TgZ(4,"p")(5,"strong"),C._uU(6),C.qZA(),C._UZ(7,"br"),C._uU(8),C._UZ(9,"br"),C.TgZ(10,"ion-button",3),C.NdJ("click",function(){C.CHM(qe);const Xt=C.oxw();return C.KtG(Xt.useAddressSelection())}),C._uU(11,"Use this address below "),C._UZ(12,"ion-icon",4),C.qZA()()(),C.BQk()}if(2&Ut){const qe=C.oxw();C.xp6(6),C.Oqu(qe.suggestedAddress.AddressLine1),C.xp6(2),C.HOy(" ",qe.suggestedAddress.AddressLine2," ",qe.suggestedAddress.Town," ",qe.suggestedAddress.StateOrProvince," ",qe.suggestedAddress.Postcode," ")}}let Ye=(()=>{class Ut{mapping;events;logging;http;appManager;latitude;latitudeChange=new C.vpe;longitude;longitudeChange=new C.vpe;suggestedAddress=null;suggestedAddressChange=new C.vpe;onUseSuggestedAddress=new C.vpe;suggestedAddressAttribution=null;suggestedAddressAttributionChange=new C.vpe;originalMarkerPos;mapService;mapOptions;debouncedGecode;isMapInitialised=!1;constructor(qe,Nt,Xt,Tn,oi){this.mapping=qe,this.events=Nt,this.logging=Xt,this.http=Tn,this.appManager=oi}ngOnInit(){this.mapService=new _e.k(this.events,this.logging,this.http),this.mapService.initAPI(),this.mapOptions=new oe._,this.mapOptions.mapType=this.appManager.searchSettings.MapType,this.mapOptions.onMapMoveCompleted=()=>{let qe;qe=this.mapService.getMapCenter(),qe.subscribe(Nt=>{Nt&&(this.latitude=Nt.coords.latitude,this.longitude=Nt.coords.longitude,this.latitudeChange.emit(this.latitude),this.longitudeChange.emit(this.longitude),this.getAddressForCurrentLatLng())})}}ngAfterContentInit(){this.focusMap()}ngOnDestroy(){this.mapService.disposeMap()}focusMap(){0==this.isMapInitialised&&this.mapService&&0!=this.latitude&&0!=this.longitude&&(this.isMapInitialised=!0,this.mapService.initMap("editor-map",this.mapOptions,null),this.mapService.setMapCenter(new X.jR(this.latitude,this.longitude)),this.originalMarkerPos=new X.wC(this.latitude,this.longitude))}ngOnChanges(qe){this.focusMap()}getAddressForCurrentLatLng(){var qe=this;return(0,h.Z)(function*(){qe.latitude&&qe.longitude&&qe.appManager.api.fetchReverseGeocodeResult(qe.latitude,qe.longitude).then(Nt=>{Nt.AddressInfo&&(qe.suggestedAddress=Nt.AddressInfo)})})()}useAddressSelection(){this.onUseSuggestedAddress.emit({suggestedAddress:this.suggestedAddress,attribution:this.suggestedAddressAttribution}),this.suggestedAddress=null,this.suggestedAddressAttribution=null}static \u0275fac=function(Nt){return new(Nt||Ut)(C.Y36(K.v),C.Y36(ee.z),C.Y36(Le.z),C.Y36(Te.eN),C.Y36(p.c))};static \u0275cmp=C.Xpm({type:Ut,selectors:[["app-poi-location-editor"]],inputs:{latitude:"latitude",longitude:"longitude"},outputs:{latitudeChange:"latitudeChange",longitudeChange:"longitudeChange",suggestedAddressChange:"suggestedAddressChange",onUseSuggestedAddress:"onUseSuggestedAddress",suggestedAddressAttributionChange:"suggestedAddressAttributionChange"},features:[C.TTD],decls:4,vars:1,consts:[[1,"instruction"],["id","editor-map"],[4,"ngIf"],["size","small",3,"click"],["slot","end","name","copy"]],template:function(Nt,Xt){1&Nt&&(C.TgZ(0,"p",0),C._uU(1,"Drag the map to center the marker on the charging location:"),C.qZA(),C._UZ(2,"div",1),C.YNc(3,me,13,5,"ng-container",2)),2&Nt&&(C.xp6(3),C.Q6J("ngIf",Xt.suggestedAddress))},dependencies:[ye.O5,De.YG,De.gu,De.uN],styles:["#editor-map[_ngcontent-%COMP%]{border:1px solid gainsboro;background-color:gray;width:100%;height:128px}"]})}return Ut})();var Ce=S(9159),de=S(6223);function Pe(Ut,Hn){if(1&Ut&&(C.TgZ(0,"ion-select-option",14),C._uU(1),C.qZA()),2&Ut){const qe=Hn.$implicit;C.Q6J("value",qe.ID),C.xp6(1),C.Oqu(qe.Title)}}function Be(Ut,Hn){if(1&Ut&&(C.TgZ(0,"ion-select-option",14),C._uU(1),C.qZA()),2&Ut){const qe=Hn.$implicit;C.Q6J("value",qe.ID),C.xp6(1),C.Oqu(qe.Title)}}function Ne(Ut,Hn){if(1&Ut&&(C.TgZ(0,"ion-select-option",14),C._uU(1),C.qZA()),2&Ut){const qe=Hn.$implicit;C.Q6J("value",qe.ID),C.xp6(1),C.Oqu(qe.Title)}}let Ae=(()=>{class Ut{modalController;referenceDataManager;conn;useFilteredConnectionTypes=!0;useFilteredOperators=!0;constructor(qe,Nt){this.modalController=qe,this.referenceDataManager=Nt}get isAddMode(){return!(null!=this.conn&&this.conn.ID>0)}get connectionTypes(){return this.referenceDataManager.getConnectionTypes(this.useFilteredConnectionTypes)}get currentTypes(){return this.referenceDataManager.getOutputCurrentTypes()}get statusTypes(){return this.referenceDataManager.getStatusTypes().filter(qe=>1==qe.IsUserSelectable)}ngOnInit(){}save(){var qe=!0;null!=this.conn.Quantity&&(this.conn.Quantity<0||this.conn.Quantity>100||!Number.isInteger(this.conn.Quantity))&&(alert("Quantity must be a whole number, or leave it blank."),qe=!1),qe&&this.modalController.dismiss({item:this.conn})}cancel(){this.modalController.dismiss()}static \u0275fac=function(Nt){return new(Nt||Ut)(C.Y36(De.IN),C.Y36(Ce.W))};static \u0275cmp=C.Xpm({type:Ut,selectors:[["app-poi-equipment-editor"]],decls:60,vars:13,consts:[[1,"ion-padding"],["position","floating"],[3,"ngModel","ngModelChange"],["value","0"],[3,"value",4,"ngFor","ngForOf"],["type","number",3,"ngModel","ngModelChange"],["type","text","placeholder","(optional) other comments",3,"ngModel","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],["slot","start"],[3,"click"],["name","close","slot","start"],["slot","end"],["color","success",3,"click"],["name","send","slot","end"],[3,"value"]],template:function(Nt,Xt){1&Nt&&(C.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),C._uU(3),C.qZA()()(),C.TgZ(4,"ion-content",0)(5,"p"),C._uU(6,"Please provide as much information as you can about the equipment. If you don't know then leave the field blank. At a minimum you should include the Connection Type and approximate Power kW (max)."),C.qZA(),C.TgZ(7,"ion-item")(8,"ion-label",1),C._uU(9,"Connection Type"),C.qZA(),C.TgZ(10,"ion-select",2),C.NdJ("ngModelChange",function(oi){return Xt.conn.ConnectionTypeID=oi}),C.TgZ(11,"ion-select-option",3),C._uU(12,"Unknown"),C.qZA(),C.YNc(13,Pe,2,2,"ion-select-option",4),C.qZA()(),C.TgZ(14,"ion-item")(15,"ion-label",1),C._uU(16,"Supply Type"),C.qZA(),C.TgZ(17,"ion-select",2),C.NdJ("ngModelChange",function(oi){return Xt.conn.CurrentTypeID=oi}),C.TgZ(18,"ion-select-option",3),C._uU(19,"Unknown"),C.qZA(),C.YNc(20,Be,2,2,"ion-select-option",4),C.qZA()(),C.TgZ(21,"ion-item")(22,"ion-label",1),C._uU(23,"Power (kW)"),C.qZA(),C.TgZ(24,"ion-input",5),C.NdJ("ngModelChange",function(oi){return Xt.conn.PowerKW=oi}),C.qZA()(),C.TgZ(25,"ion-item")(26,"ion-label",1),C._uU(27,"Amps"),C.qZA(),C.TgZ(28,"ion-input",5),C.NdJ("ngModelChange",function(oi){return Xt.conn.Amps=oi}),C.qZA()(),C.TgZ(29,"ion-item")(30,"ion-label",1),C._uU(31,"Voltage"),C.qZA(),C.TgZ(32,"ion-input",5),C.NdJ("ngModelChange",function(oi){return Xt.conn.Voltage=oi}),C.qZA()(),C.TgZ(33,"ion-item")(34,"ion-label",1),C._uU(35,"Status"),C.qZA(),C.TgZ(36,"ion-select",2),C.NdJ("ngModelChange",function(oi){return Xt.conn.StatusTypeID=oi}),C.YNc(37,Ne,2,2,"ion-select-option",4),C.qZA()(),C.TgZ(38,"ion-item")(39,"ion-label",1),C._uU(40,"Quantity Available"),C.qZA(),C.TgZ(41,"ion-input",5),C.NdJ("ngModelChange",function(oi){return Xt.conn.Quantity=oi}),C.qZA()(),C.TgZ(42,"ion-item")(43,"ion-label",1),C._uU(44,"Comment"),C.qZA(),C.TgZ(45,"ion-input",6),C.NdJ("ngModelChange",function(oi){return Xt.conn.Comments=oi}),C.qZA()(),C.TgZ(46,"ion-item")(47,"ion-label",1),C._uU(48,"Operators Reference"),C.qZA(),C.TgZ(49,"ion-input",7),C.NdJ("ngModelChange",function(oi){return Xt.conn.Reference=oi}),C.qZA()()(),C.TgZ(50,"ion-footer")(51,"ion-toolbar")(52,"ion-buttons",8)(53,"ion-button",9),C.NdJ("click",function(){return Xt.cancel()}),C._UZ(54,"ion-icon",10),C._uU(55," Cancel "),C.qZA()(),C.TgZ(56,"ion-buttons",11)(57,"ion-button",12),C.NdJ("click",function(){return Xt.save()}),C._uU(58," OK "),C._UZ(59,"ion-icon",13),C.qZA()()()()),2&Nt&&(C.xp6(3),C.Oqu(Xt.isAddMode?"Add Equipment":"Edit Equipment"),C.xp6(7),C.Q6J("ngModel",Xt.conn.ConnectionTypeID),C.xp6(3),C.Q6J("ngForOf",Xt.connectionTypes),C.xp6(4),C.Q6J("ngModel",Xt.conn.CurrentTypeID),C.xp6(3),C.Q6J("ngForOf",Xt.currentTypes),C.xp6(4),C.Q6J("ngModel",Xt.conn.PowerKW),C.xp6(4),C.Q6J("ngModel",Xt.conn.Amps),C.xp6(4),C.Q6J("ngModel",Xt.conn.Voltage),C.xp6(4),C.Q6J("ngModel",Xt.conn.StatusTypeID),C.xp6(1),C.Q6J("ngForOf",Xt.statusTypes),C.xp6(4),C.Q6J("ngModel",Xt.conn.Quantity),C.xp6(4),C.Q6J("ngModel",Xt.conn.Comments),C.xp6(4),C.Q6J("ngModel",Xt.conn.Reference))},dependencies:[ye.sg,De.YG,De.Sm,De.W2,De.fr,De.Gu,De.gu,De.pK,De.Ie,De.Q$,De.t9,De.n0,De.wd,De.sr,De.as,De.QI,De.j9,de.JJ,de.On]})}return Ut})();var Ge=function(Ut){return Ut[Ut.Unknown=0]="Unknown",Ut[Ut.CurrentlyAvailable=10]="CurrentlyAvailable",Ut[Ut.CurrentlyInUse=20]="CurrentlyInUse",Ut[Ut.TemporarilyUnavailable=30]="TemporarilyUnavailable",Ut[Ut.Operational=50]="Operational",Ut[Ut.PartlyOperational=75]="PartlyOperational",Ut[Ut.NotOperational=100]="NotOperational",Ut[Ut.PlannedForFutureDate=150]="PlannedForFutureDate",Ut[Ut.RemovedDecomissioned=200]="RemovedDecomissioned",Ut}(Ge||{}),lt=function(Ut){return Ut[Ut.UnknownOperator=1]="UnknownOperator",Ut[Ut.SiteOwner=45]="SiteOwner",Ut}(lt||{}),xe=S(8696),je=S(1163),Se=S(6086);function Ve(Ut,Hn){1&Ut&&C._UZ(0,"ion-icon",13)}function Xe(Ut,Hn){1&Ut&&C._UZ(0,"ion-icon",13)}function Ht(Ut,Hn){1&Ut&&C._UZ(0,"ion-icon",13)}function cn(Ut,Hn){if(1&Ut&&(C.TgZ(0,"ion-select-option",27),C._uU(1),C.qZA()),2&Ut){const qe=Hn.$implicit;C.Q6J("value",qe.ID),C.xp6(1),C.Oqu(qe.Title)}}function xn(Ut,Hn){if(1&Ut){const qe=C.EpF();C.ynx(0),C.TgZ(1,"app-poi-location-editor",14,15),C.NdJ("latitudeChange",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.item.AddressInfo.Latitude=Xt)})("longitudeChange",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.item.AddressInfo.Longitude=Xt)})("onUseSuggestedAddress",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.useSuggestedAddress(Xt))}),C.qZA(),C.TgZ(3,"ion-list")(4,"ion-item")(5,"ion-label",16),C._uU(6,"Location Name"),C.qZA(),C.TgZ(7,"ion-input",17),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.item.AddressInfo.Title=Xt)}),C.qZA()(),C.TgZ(8,"ion-item")(9,"ion-label",16),C._uU(10,"Address Line 1"),C.qZA(),C.TgZ(11,"ion-input",18),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.item.AddressInfo.AddressLine1=Xt)}),C.qZA()(),C.TgZ(12,"ion-item")(13,"ion-label",16),C._uU(14,"Address Line 2"),C.qZA(),C.TgZ(15,"ion-input",19),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.item.AddressInfo.AddressLine2=Xt)}),C.qZA()(),C.TgZ(16,"ion-item")(17,"ion-label",16),C._uU(18,"Town"),C.qZA(),C.TgZ(19,"ion-input",20),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.item.AddressInfo.Town=Xt)}),C.qZA()(),C.TgZ(20,"ion-item")(21,"ion-label",16),C._uU(22,"State or Province"),C.qZA(),C.TgZ(23,"ion-input",21),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.item.AddressInfo.StateOrProvince=Xt)}),C.qZA()(),C.TgZ(24,"ion-item")(25,"ion-label",16),C._uU(26,"Postal Code"),C.qZA(),C.TgZ(27,"ion-input",22),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.item.AddressInfo.Postcode=Xt)}),C.qZA()(),C.TgZ(28,"ion-item")(29,"ion-label",16),C._uU(30,"Country"),C.qZA(),C.TgZ(31,"ion-select",23),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.item.AddressInfo.CountryID=Xt)})("ionChange",function(){C.CHM(qe);const Xt=C.oxw(2);return C.KtG(Xt.onCountryChange())}),C.YNc(32,cn,2,2,"ion-select-option",24),C.qZA()(),C.TgZ(33,"ion-item")(34,"ion-input",25),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.item.AddressInfo.Latitude=Xt)}),C.qZA()(),C.TgZ(35,"ion-item")(36,"ion-input",26),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.item.AddressInfo.Longitude=Xt)}),C.qZA()()(),C.BQk()}if(2&Ut){const qe=C.oxw(2);C.xp6(1),C.Q6J("latitude",qe.item.AddressInfo.Latitude)("longitude",qe.item.AddressInfo.Longitude),C.xp6(6),C.Q6J("ngModel",qe.item.AddressInfo.Title),C.xp6(4),C.Q6J("ngModel",qe.item.AddressInfo.AddressLine1),C.xp6(4),C.Q6J("ngModel",qe.item.AddressInfo.AddressLine2),C.xp6(4),C.Q6J("ngModel",qe.item.AddressInfo.Town),C.xp6(4),C.Q6J("ngModel",qe.item.AddressInfo.StateOrProvince),C.xp6(4),C.Q6J("ngModel",qe.item.AddressInfo.Postcode),C.xp6(4),C.Q6J("ngModel",qe.item.AddressInfo.CountryID),C.xp6(1),C.Q6J("ngForOf",qe.countries),C.xp6(2),C.Q6J("ngModel",qe.item.AddressInfo.Latitude),C.xp6(2),C.Q6J("ngModel",qe.item.AddressInfo.Longitude)}}function $t(Ut,Hn){if(1&Ut){const qe=C.EpF();C.ynx(0),C.TgZ(1,"h3"),C._uU(2,"Locations Nearby"),C.qZA(),C.TgZ(3,"p")(4,"strong"),C._uU(5,"The following locations already exist nearby."),C.qZA()(),C.TgZ(6,"div",28)(7,"p"),C._uU(8,"Ensure you are not adding a duplicate site unless it is for different equipment from another network operator."),C.qZA(),C.TgZ(9,"p"),C._uU(10,"You can edit any of these listings if required instead:"),C.qZA()(),C.TgZ(11,"app-poi-list",29),C.NdJ("onEdit",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.editPOI(Xt))}),C.qZA(),C.BQk()}if(2&Ut){const qe=C.oxw(2);C.xp6(11),C.Q6J("poiList",qe.nearbySites)("enableEditOption",!0)}}function ke(Ut,Hn){if(1&Ut&&(C.ynx(0),C.YNc(1,xn,37,12,"ng-container",9)(2,$t,12,2,"ng-container",9),C.BQk()),2&Ut){const qe=C.oxw();C.xp6(1),C.Q6J("ngIf","location"==qe.step),C.xp6(1),C.Q6J("ngIf","poi-nearby"==qe.step)}}function pe(Ut,Hn){if(1&Ut){const qe=C.EpF();C.ynx(0),C.TgZ(1,"p"),C._uU(2,"Copied the equipment configuration from:"),C.qZA(),C.TgZ(3,"ion-item")(4,"ion-label"),C._uU(5),C._UZ(6,"br"),C._uU(7),C._UZ(8,"br"),C._uU(9),C._UZ(10,"br"),C._uU(11),C._UZ(12,"br"),C._uU(13),C.qZA(),C.TgZ(14,"ion-button",31),C.NdJ("click",function(){C.CHM(qe);const Xt=C.oxw(5);return C.KtG(Xt.changeTemplatePOI())}),C._uU(15,"Change.."),C.qZA()(),C.BQk()}if(2&Ut){const qe=C.oxw(5);C.xp6(5),C.hij(" ",qe.selectedTemplatePOI.AddressInfo.Title," "),C.xp6(2),C.hij(" ",qe.selectedTemplatePOI.AddressInfo.AddressLine1," "),C.xp6(2),C.hij(" ",null==qe.selectedTemplatePOI.Connections[0].ConnectionType?null:qe.selectedTemplatePOI.Connections[0].ConnectionType.Title," "),C.xp6(2),C.hij(" ",qe.selectedTemplatePOI.Connections[0].PowerKW," "),C.xp6(2),C.hij(" ",qe.selectedTemplatePOI.DateCreated," ")}}function Oe(Ut,Hn){if(1&Ut){const qe=C.EpF();C.ynx(0),C.TgZ(1,"h4"),C._uU(2,"Similar Sites"),C.qZA(),C.TgZ(3,"app-poi-list",32),C.NdJ("onCopy",function(Xt){C.CHM(qe);const Tn=C.oxw(6);return C.KtG(Tn.useTemplatePOI(Xt))}),C.qZA(),C.BQk()}if(2&Ut){const qe=C.oxw(6);C.xp6(3),C.Q6J("enableCopyOption",!0)("poiList",qe.templateSites)}}function ie(Ut,Hn){1&Ut&&(C.ynx(0),C.TgZ(1,"p"),C._uU(2," There are no suggested sites to copy for this network operator. "),C.qZA(),C.BQk())}function it(Ut,Hn){if(1&Ut&&(C.ynx(0),C.YNc(1,Oe,4,2,"ng-container",9)(2,ie,3,0,"ng-container",9),C.BQk()),2&Ut){const qe=C.oxw(5);C.xp6(1),C.Q6J("ngIf",qe.templateSites.length>0),C.xp6(1),C.Q6J("ngIf",0==qe.templateSites.length)}}function _t(Ut,Hn){if(1&Ut&&(C.ynx(0),C.YNc(1,pe,16,5,"ng-container",9)(2,it,3,2,"ng-container",9),C.BQk()),2&Ut){const qe=C.oxw(4);C.xp6(1),C.Q6J("ngIf",qe.selectedTemplatePOI),C.xp6(1),C.Q6J("ngIf",!qe.selectedTemplatePOI)}}function Kt(Ut,Hn){if(1&Ut){const qe=C.EpF();C.ynx(0),C.TgZ(1,"p",28),C._uU(2,"You can copy the equipment settings from other sites operated by the same network operator or choose 'Next' to skip this step: "),C.qZA(),C.TgZ(3,"app-operator-lookup",30),C.NdJ("operatorChanged",function(Xt){C.CHM(qe);const Tn=C.oxw(3);return C.KtG(Tn.onOperatorChange(Xt))}),C.qZA(),C.YNc(4,_t,3,2,"ng-container",9),C.BQk()}if(2&Ut){const qe=C.oxw(3);C.xp6(3),C.Q6J("operatorId",qe.item.OperatorID),C.xp6(1),C.Q6J("ngIf",qe.item.AddressInfo.CountryID&&qe.item.OperatorID)}}function Mn(Ut,Hn){if(1&Ut&&(C.ynx(0),C.YNc(1,Kt,5,2,"ng-container",9),C.BQk()),2&Ut){const qe=C.oxw(2);C.xp6(1),C.Q6J("ngIf",!qe.skipPOICopy)}}function fn(Ut,Hn){if(1&Ut){const qe=C.EpF();C.ynx(0),C.TgZ(1,"app-operator-lookup",33),C.NdJ("operatorChanged",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.onOperatorChange(Xt))}),C.qZA(),C.TgZ(2,"ion-item")(3,"ion-input",34),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.item.NumberOfPoints=Xt)}),C.qZA()(),C.TgZ(4,"h4"),C._uU(5,"Equipment"),C.qZA(),C.TgZ(6,"ion-button",35),C.NdJ("click",function(){C.CHM(qe);const Xt=C.oxw(2);return C.KtG(Xt.addConnection())}),C._UZ(7,"ion-icon",36),C.qZA(),C.TgZ(8,"app-equipment-details",37),C.NdJ("onEdit",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.editConnection(Xt))})("onDelete",function(Xt){C.CHM(qe);const Tn=C.oxw(2);return C.KtG(Tn.deleteConnection(Xt))}),C.qZA(),C.BQk()}if(2&Ut){const qe=C.oxw(2);C.xp6(1),C.Q6J("operatorId",qe.item.OperatorID)("useFilteredOperators",!1),C.xp6(2),C.Q6J("ngModel",qe.item.NumberOfPoints),C.xp6(5),C.Q6J("item",qe.item)("enableEdit",!0)}}function qn(Ut,Hn){if(1&Ut&&(C.ynx(0),C.YNc(1,Mn,2,1,"ng-container",9)(2,fn,9,5,"ng-container",9),C.BQk()),2&Ut){const qe=C.oxw();C.xp6(1),C.Q6J("ngIf","copy-equipment"==qe.step),C.xp6(1),C.Q6J("ngIf","edit-equipment"==qe.step)}}function li(Ut,Hn){if(1&Ut&&(C.TgZ(0,"p",44)(1,"strong"),C._uU(2,"Your changes cannot be saved until the following issues are resolved:"),C.qZA(),C.TgZ(3,"ion-label",45),C._uU(4),C.qZA()()),2&Ut){const qe=C.oxw(2);C.xp6(4),C.hij(" ",qe.validationMsg,"")}}function en(Ut,Hn){if(1&Ut&&(C.TgZ(0,"ion-select-option",27),C._uU(1),C.qZA()),2&Ut){const qe=Hn.$implicit;C.Q6J("value",qe.ID),C.xp6(1),C.Oqu(qe.Title)}}function Dt(Ut,Hn){if(1&Ut&&(C.TgZ(0,"ion-select-option",27),C._uU(1),C.qZA()),2&Ut){const qe=Hn.$implicit;C.Q6J("value",qe.ID),C.xp6(1),C.Oqu(qe.Title)}}function Ie(Ut,Hn){if(1&Ut){const qe=C.EpF();C.ynx(0),C.YNc(1,li,5,1,"p",38),C.TgZ(2,"p"),C._uU(3,"Please provide any other facts related to this site. Additional comments (your charging experiences etc) can be added as check-in comments once the site is listed."),C.qZA(),C.TgZ(4,"ion-item")(5,"ion-label",16),C._uU(6,"Operational Status (All Equipment))"),C.qZA(),C.TgZ(7,"ion-select",39),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw();return C.KtG(Tn.item.StatusTypeID=Xt)}),C.YNc(8,en,2,2,"ion-select-option",24),C.qZA()(),C.TgZ(9,"ion-item")(10,"ion-label",16),C._uU(11,"Usage Type"),C.qZA(),C.TgZ(12,"ion-select",39),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw();return C.KtG(Tn.item.UsageTypeID=Xt)}),C.YNc(13,Dt,2,2,"ion-select-option",24),C.qZA()(),C.TgZ(14,"ion-item")(15,"ion-label",16),C._uU(16,"Usage Cost"),C.qZA(),C.TgZ(17,"ion-input",21),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw();return C.KtG(Tn.item.UsageCost=Xt)}),C.qZA()(),C.TgZ(18,"ion-item")(19,"ion-label",16),C._uU(20,"General Comments"),C.qZA(),C.TgZ(21,"ion-input",40),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw();return C.KtG(Tn.item.GeneralComments=Xt)}),C.qZA()(),C.TgZ(22,"ion-item")(23,"ion-label",16),C._uU(24,"Main Telephone Number "),C.qZA(),C.TgZ(25,"ion-input",41),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw();return C.KtG(Tn.item.AddressInfo.ContactTelephone1=Xt)}),C.qZA()(),C.TgZ(26,"ion-item")(27,"ion-label",16),C._uU(28,"Other Telephone Number "),C.qZA(),C.TgZ(29,"ion-input",41),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw();return C.KtG(Tn.item.AddressInfo.ContactTelephone2=Xt)}),C.qZA()(),C.TgZ(30,"ion-item")(31,"ion-label",16),C._uU(32,"Access Comments"),C.qZA(),C.TgZ(33,"ion-input",42),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw();return C.KtG(Tn.item.AddressInfo.AccessComments=Xt)}),C.qZA()(),C.TgZ(34,"ion-item")(35,"ion-label",16),C._uU(36,"Related Website"),C.qZA(),C.TgZ(37,"ion-input",43),C.NdJ("ngModelChange",function(Xt){C.CHM(qe);const Tn=C.oxw();return C.KtG(Tn.item.AddressInfo.RelatedURL=Xt)}),C.qZA()(),C.BQk()}if(2&Ut){const qe=C.oxw();C.xp6(1),C.Q6J("ngIf",qe.validationMsg),C.xp6(6),C.Q6J("ngModel",qe.item.StatusTypeID),C.xp6(1),C.Q6J("ngForOf",qe.statusTypes),C.xp6(4),C.Q6J("ngModel",qe.item.UsageTypeID),C.xp6(1),C.Q6J("ngForOf",qe.usageTypes),C.xp6(4),C.Q6J("ngModel",qe.item.UsageCost),C.xp6(4),C.Q6J("ngModel",qe.item.GeneralComments),C.xp6(4),C.Q6J("ngModel",qe.item.AddressInfo.ContactTelephone1),C.xp6(4),C.Q6J("ngModel",qe.item.AddressInfo.ContactTelephone2),C.xp6(4),C.Q6J("ngModel",qe.item.AddressInfo.AccessComments),C.xp6(4),C.Q6J("ngModel",qe.item.AddressInfo.RelatedURL)}}function Ct(Ut,Hn){if(1&Ut){const qe=C.EpF();C.TgZ(0,"ion-button",1),C.NdJ("click",function(){C.CHM(qe);const Xt=C.oxw();return C.KtG(Xt.previous())}),C._uU(1," Previous "),C._UZ(2,"ion-icon",46),C.qZA()}}function on(Ut,Hn){if(1&Ut){const qe=C.EpF();C.TgZ(0,"ion-button",1),C.NdJ("click",function(){C.CHM(qe);const Xt=C.oxw();return C.KtG(Xt.next())}),C._uU(1," Next "),C._UZ(2,"ion-icon",47),C.qZA()}}function Rn(Ut,Hn){if(1&Ut){const qe=C.EpF();C.TgZ(0,"ion-button",48),C.NdJ("click",function(){C.CHM(qe);const Xt=C.oxw();return C.KtG(Xt.save())}),C._uU(1," Submit "),C._UZ(2,"ion-icon",49),C.qZA()}}let Vn=(()=>{class Ut{appManager;modalController;poiManager;mapping;loadingController;alertController;id;item;step;selectedTab;startPos;useFilteredConnectionTypes=!0;templateSites=[];nearbySites=[];selectedTemplatePOI=null;suggestedAddress=null;suggestedAddressAttribution=null;isNonDuplicateConfirmed=!1;skipPOICopy=!1;validationMsg=null;loading;editorMap;get countries(){return this.appManager.referenceDataManager.getCountries()}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes()}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes().filter(qe=>1==qe.IsUserSelectable)}get isAddMode(){return this.item.ID<=0}constructor(qe,Nt,Xt,Tn,oi,xi){this.appManager=qe,this.modalController=Nt,this.poiManager=Xt,this.mapping=Tn,this.loadingController=oi,this.alertController=xi,this.initNewItem()}initNewItem(){this.item={ID:-1,DataProviderID:1,DataProvidersReference:null,OperatorsReference:null,OperatorID:1,UsageCost:null,UsageTypeID:4,NumberOfPoints:1,GeneralComments:null,DatePlanned:null,StatusTypeID:50,SubmissionStatusTypeID:null,Connections:[],MetadataValues:[],AddressInfo:{ID:-1,CountryID:18,Title:"",AddressLine1:"",Latitude:0,Longitude:0}},this.step="location",this.selectedTab="location"}get isReadyToSubmit(){return this.validate().isValid&&"info"==this.step}ngOnInit(){}presentLoadingUI(){var qe=this;return(0,h.Z)(function*(){qe.loading=yield qe.loadingController.create({message:"Please Wait.."}),yield qe.loading.present()})()}dismissLoadingUI(){var qe=this;return(0,h.Z)(function*(){qe.loading&&(yield qe.loading.dismiss())})()}ionViewDidEnter(){if(null!=this.id)this.editExistingPOI(this.id);else{let qe=localStorage.getItem("_editor-operatorid");qe&&(this.item.OperatorID=parseInt(qe,10)),this.startPos?(this.item.AddressInfo.Latitude=this.startPos.latitude,this.item.AddressInfo.Longitude=this.startPos.longitude):this.mapping&&this.mapping.getMapCenter().subscribe(Nt=>{Nt&&(this.item.AddressInfo.Latitude=Nt.coords.latitude,this.item.AddressInfo.Longitude=Nt.coords.longitude)})}this.refreshFilteredReferenceData()}previous(){var qe=this;return(0,h.Z)(function*(){switch(qe.step){case"info":qe.step="edit-equipment";break;case"edit-equipment":qe.step=qe.isAddMode?"copy-equipment":"location";break;case"copy-equipment":case"poi-nearby":qe.step="location"}yield qe.initCurrentStep(!1)})()}next(){var qe=this;return(0,h.Z)(function*(){if("poi-nearby"==qe.step&&qe.nearbySites.length>0&&!qe.isNonDuplicateConfirmed)return void(yield qe.alertController.create({header:"Confirm",message:"Please confirm you are not adding a duplicate site.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:Tn=>{}},{text:"Confirm",handler:()=>{qe.isNonDuplicateConfirmed=!0,qe.next()}}]})).present();const Nt=qe.validate(qe.step);if(Nt.isValid){switch(qe.step){case"location":qe.step=qe.isAddMode?"poi-nearby":"edit-equipment";break;case"poi-nearby":qe.step=qe.isAddMode?"copy-equipment":"edit-equipment";break;case"copy-equipment":qe.step="edit-equipment";break;case"edit-equipment":qe.step="info"}yield qe.initCurrentStep(!0)}else(yield qe.alertController.create({message:Nt.msg})).present()})()}initCurrentStep(qe){var Nt=this;return(0,h.Z)(function*(){"poi-nearby"==Nt.step?(Nt.selectedTab="location",0==(yield Nt.refreshNearbySites())&&(qe?yield Nt.next():yield Nt.previous())):"location"==Nt.step?Nt.selectedTab="location":"copy-equipment"==Nt.step?(Nt.selectedTab="equipment",yield Nt.refreshTemplateSites()):"edit-equipment"==Nt.step?Nt.selectedTab="equipment":"info"==Nt.step&&(Nt.selectedTab="info")})()}onCountryChange(){var qe=this;return(0,h.Z)(function*(){qe.refreshFilteredReferenceData()})()}onOperatorChange(qe=null){var Nt=this;return(0,h.Z)(function*(){null!=qe&&Nt.item.OperatorID!=qe.ID&&(Nt.item.OperatorID=qe.ID,localStorage.setItem("_editor-operatorid",Nt.item.OperatorID.toString()),yield Nt.refreshTemplateSites())})()}useSuggestedAddress(qe=null){qe&&(this.suggestedAddress=qe.suggestedAddress,this.suggestedAddressAttribution=qe.suggestedAddressAttribution),Object.assign(this.item.AddressInfo,this.suggestedAddress),this.suggestedAddressAttribution&&(this.item.MetadataValues.find(Nt=>4==Nt.MetadataFieldID)||this.item.MetadataValues.push({ID:-1,MetadataFieldID:4,ItemValue:this.suggestedAddressAttribution,MetadataFieldOptionID:null,MetadataFieldOption:null}))}editConnection(qe){var Nt=this;return(0,h.Z)(function*(){const Xt=Nt.item.Connections.find(xi=>xi.ID==qe.ID),Tn=Object.assign({},Xt),oi=yield Nt.modalController.create({component:Ae,componentProps:{conn:Tn}});return oi.onWillDismiss().then(xi=>{xi&&xi.data&&xi.data.item&&Nt.updateConnection(xi.data.item)}),yield oi.present()})()}deleteConnection(qe){var Nt=this;return(0,h.Z)(function*(){const Xt=Nt.item.Connections.find(oi=>oi.ID==qe.ID);(yield Nt.alertController.create({header:"Confirm Delete",message:"Are you sure you want to delete this connection information?",buttons:[{text:"No",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Yes",handler:()=>{Nt.item.Connections=Nt.item.Connections.filter(oi=>oi.ID!=Xt.ID),Nt.appManager.referenceDataManager.hydrateCompactPOI(Nt.item,!0)}}]})).present()})()}addConnection(){var qe=this;return(0,h.Z)(function*(){const Nt={ID:-a.c.getRandomInt(1e4),ConnectionTypeID:null,StatusTypeID:50,PowerKW:null,Quantity:1},Xt=yield qe.modalController.create({component:Ae,componentProps:{conn:Nt}});return Xt.onWillDismiss().then(Tn=>{Tn&&Tn.data&&Tn.data.item&&qe.updateConnection(Tn.data.item)}),yield Xt.present()})()}refreshFilteredReferenceData(){this.appManager.referenceDataManager.refreshFilteredReferenceData(this.appManager.api,{CountryIds:[this.item.AddressInfo.CountryID]})}updateConnection(qe){if(qe){let Nt=this.item.Connections.find(Xt=>Xt.ID==qe.ID);Nt?Object.assign(Nt,qe):this.item.Connections.push(qe)}this.appManager.referenceDataManager.hydrateCompactPOI(this.item,!0)}validate(qe="all"){let Nt=null;return("all"==qe||"location"==qe)&&((!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(Nt="Location is required"),""==this.item.AddressInfo.Title&&(Nt="A location title is required"),!this.item.AddressInfo.AddressLine1&&!this.item.AddressInfo.AddressLine2&&(Nt="An approximate address is required."),this.item.AddressInfo.CountryID||(Nt="A country selection is required"),(!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(Nt="A location latitude and longitude is required")),("all"==qe||"poi-nearby"==qe)&&this.nearbySites.length>0&&!this.isNonDuplicateConfirmed&&(Nt="Please confirm that the site is not a duplicate"),("all"==qe||"equipment"==qe)&&(this.item.OperatorID||(Nt="Please confirm the charging network or equipment operator."),0==this.item.Connections.length&&(Nt="Equipment information is required")),Nt?(this.validationMsg=Nt,{isValid:!1,msg:Nt}):(this.validationMsg=null,{isValid:!0,msg:null})}save(){var qe=this;return(0,h.Z)(function*(){let Nt=qe.validate();if(Nt.isValid){yield qe.presentLoadingUI();try{yield qe.appManager.submitPOI(qe.item),yield qe.dismissLoadingUI(),qe.appManager.showToastNotification("You submission will be reviewed (if required) and published shortly."),qe.modalController.dismiss()}catch(Xt){yield qe.dismissLoadingUI(),Xt.error&&alert("Sorry, your submission could not be completed at this time. Please try again later.")}}else alert(Nt.msg)})()}cancel(){var qe=this;return(0,h.Z)(function*(){qe.modalController.dismiss()})()}refreshTemplateSites(){var qe=this;return(0,h.Z)(function*(){if(qe.item.AddressInfo.CountryID&&qe.item.OperatorID){yield qe.presentLoadingUI(),qe.templateSites=[];let Nt=new X.be;Nt.countryIdList=[qe.item.AddressInfo.CountryID],Nt.minPowerKW=1,Nt.operatorIdList=[qe.item.OperatorID],Nt.maxResults=10;let Xt=yield qe.poiManager.fetchPOIList(Nt);Xt.sort((Tn,oi)=>new Date(Tn.DateCreated).getTime()-new Date(oi.DateCreated).getTime()),qe.templateSites=Xt,qe.dismissLoadingUI()}})()}refreshNearbySites(){var qe=this;return(0,h.Z)(function*(){if(qe.item.AddressInfo.Latitude&&qe.item.AddressInfo.Longitude){yield qe.presentLoadingUI(),qe.nearbySites=[];let Nt=new X.be;Nt.latitude=qe.item.AddressInfo.Latitude,Nt.longitude=qe.item.AddressInfo.Longitude,Nt.distance=5,Nt.distanceUnit="km",Nt.maxResults=10;let Xt=yield qe.poiManager.fetchPOIList(Nt);return Xt.sort((Tn,oi)=>Tn.Distance-oi.Distance),qe.nearbySites=Xt,qe.dismissLoadingUI(),Xt.length}return 0})()}confirmNonDuplicate(){this.isNonDuplicateConfirmed=!0,this.next()}changeTemplatePOI(){this.selectedTemplatePOI=null}editPOI(qe){this.editExistingPOI(qe.ID)}editExistingPOI(qe){var Nt=this;return(0,h.Z)(function*(){Nt.skipPOICopy=!0,Nt.isNonDuplicateConfirmed=!0,yield Nt.presentLoadingUI(),Nt.poiManager.getPOIById(qe,!0,!0).then(Xt=>{Nt.item=Object.assign({},Xt),null==Nt.item.OperatorID&&(Nt.item.OperatorID=lt.UnknownOperator),Nt.refreshFilteredReferenceData(),Nt.dismissLoadingUI()})})()}useTemplatePOI(qe){this.selectedTemplatePOI=qe,Object.assign(this.item.Connections,qe.Connections);for(let Nt of this.item.Connections)Nt.ID=-a.c.getRandomInt(1e4),Nt.Reference=null,Nt.Comments=null,Nt.StatusTypeID=Ge.Operational;this.item.UsageCost=qe.UsageCost,this.item.UsageTypeID=qe.UsageTypeID,this.appManager.referenceDataManager.hydrateCompactPOI(this.item)}skipCopyingPOI(){this.skipPOICopy=!0}static \u0275fac=function(Nt){return new(Nt||Ut)(C.Y36(p.c),C.Y36(De.IN),C.Y36(j.R),C.Y36(K.v),C.Y36(De.HT),C.Y36(De.Br))};static \u0275cmp=C.Xpm({type:Ut,selectors:[["app-poi-editor"]],viewQuery:function(Nt,Xt){if(1&Nt&&C.Gf(Ye,5),2&Nt){let Tn;C.iGM(Tn=C.CRH())&&(Xt.editorMap=Tn.first)}},decls:33,vars:14,consts:[["slot","end"],[3,"click"],["name","close","slot","start"],[1,"ion-padding"],[3,"ngModel"],["value","location","layout","icon-start",3,"disabled"],["name","caret-forward",4,"ngIf"],["value","equipment","layout","icon-start",3,"disabled"],["value","info","layout","icon-start",3,"disabled"],[4,"ngIf"],["slot","start"],[3,"click",4,"ngIf"],["color","success",3,"click",4,"ngIf"],["name","caret-forward"],[3,"latitude","longitude","latitudeChange","longitudeChange","onUseSuggestedAddress"],["editorMap",""],["position","floating"],["type","text","autocapitalize","words","placeholder","A title for this location",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","The nearest street address",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Optional",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Town or City",3,"ngModel","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Optional Postal Code",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["label","Latitude","labelPlacement","floating","type","number","placeholder","Latitude (if entering manually)",3,"ngModel","ngModelChange"],["label","Longitude","labelPlacement","floating","type","number","placeholder","Longitude (if entering manually)",3,"ngModel","ngModelChange"],[3,"value"],[1,"instruction"],[3,"poiList","enableEditOption","onEdit"],[3,"operatorId","operatorChanged"],["slot","start","size","small",3,"click"],[3,"enableCopyOption","poiList","onCopy"],[3,"operatorId","useFilteredOperators","operatorChanged"],["label","Number of Stations or Parking Bays","labelPlacement","floating","min","1","type","number",3,"ngModel","ngModelChange"],["size","small",3,"click"],["name","add","slot","icon-only"],[3,"item","enableEdit","onEdit","onDelete"],["color","warning",4,"ngIf"],[3,"ngModel","ngModelChange"],["type","text","autocapitalize","sentences",3,"ngModel","ngModelChange"],["type","tel","placeholder","",3,"ngModel","ngModelChange"],["type","text","autocapitalize","sentences","placeholder","Instructions for access or tips for finding charging location",3,"ngModel","ngModelChange"],["type","url","placeholder","Website related to this site",3,"ngModel","ngModelChange"],["color","warning"],["color","danger"],["name","caret-back","slot","start"],["name","caret-forward","slot","end"],["color","success",3,"click"],["name","send","slot","end"]],template:function(Nt,Xt){1&Nt&&(C.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),C._uU(3),C.qZA(),C.TgZ(4,"ion-buttons",0)(5,"ion-button",1),C.NdJ("click",function(){return Xt.cancel()}),C._UZ(6,"ion-icon",2),C._uU(7," Cancel "),C.qZA()()()(),C.TgZ(8,"ion-content",3),C.ynx(9),C.TgZ(10,"ion-segment",4)(11,"ion-segment-button",5),C.YNc(12,Ve,1,0,"ion-icon",6),C.TgZ(13,"ion-label"),C._uU(14,"Location"),C.qZA()(),C.TgZ(15,"ion-segment-button",7),C.YNc(16,Xe,1,0,"ion-icon",6),C.TgZ(17,"ion-label"),C._uU(18,"Equipment"),C.qZA()(),C.TgZ(19,"ion-segment-button",8),C.YNc(20,Ht,1,0,"ion-icon",6),C.TgZ(21,"ion-label"),C._uU(22,"Info"),C.qZA()()(),C.YNc(23,ke,3,2,"ng-container",9)(24,qn,3,2,"ng-container",9)(25,Ie,38,11,"ng-container",9),C.BQk(),C.qZA(),C.TgZ(26,"ion-footer")(27,"ion-toolbar")(28,"ion-buttons",10),C.YNc(29,Ct,3,0,"ion-button",11),C.qZA(),C.TgZ(30,"ion-buttons",0),C.YNc(31,on,3,0,"ion-button",11)(32,Rn,3,0,"ion-button",12),C.qZA()()()),2&Nt&&(C.xp6(3),C.Oqu(Xt.isAddMode?"Add Location":"Edit Location"),C.xp6(7),C.Q6J("ngModel",Xt.selectedTab),C.xp6(1),C.Q6J("disabled",!0),C.xp6(1),C.Q6J("ngIf","location"==Xt.selectedTab),C.xp6(3),C.Q6J("disabled",!0),C.xp6(1),C.Q6J("ngIf","equipment"==Xt.selectedTab),C.xp6(3),C.Q6J("disabled",!0),C.xp6(1),C.Q6J("ngIf","info"==Xt.selectedTab),C.xp6(3),C.Q6J("ngIf","location"==Xt.selectedTab),C.xp6(1),C.Q6J("ngIf","equipment"==Xt.selectedTab),C.xp6(1),C.Q6J("ngIf","info"==Xt.selectedTab),C.xp6(4),C.Q6J("ngIf","location"!=Xt.step),C.xp6(2),C.Q6J("ngIf",!Xt.isReadyToSubmit&&"info"!=Xt.step),C.xp6(1),C.Q6J("ngIf",Xt.isReadyToSubmit))},dependencies:[ye.sg,ye.O5,de.JJ,de.On,De.YG,De.Sm,De.W2,De.fr,De.Gu,De.gu,De.pK,De.Ie,De.Q$,De.q_,De.cJ,De.GO,De.t9,De.n0,De.wd,De.sr,De.as,De.QI,De.j9,De.yf,xe.o,je.B,Ye,Se.z],styles:['ul.breadcrumb[_ngcontent-%COMP%]{display:inline-flex;margin:0;padding:0}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-flex;margin-right:6px;color:var(--ion-color-light-shade);font-size:10px}ul.breadcrumb[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{color:var(--ion-color-dark-shade)}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:">";padding-right:4px}']})}return Ut})()},3247:(zn,wt,S)=>{"use strict";S.d(wt,{u:()=>lt});var h=S(8564),p=S(6728),X=S(3052),a=S(989),j=S(9127),K=S(7430),C=S(9862);let oe=(()=>{class ne{http;journeyManager;constructor(xe,je){this.http=xe,this.journeyManager=je}getDirections(xe,je){return new Promise((Se,Ve)=>{(new google.maps.DirectionsService).route({origin:xe,destination:je,travelMode:google.maps.TravelMode.DRIVING},(Ht,cn)=>{cn===google.maps.DirectionsStatus.OK?Se(Ht):Ve(cn)})})}analyseRoutes(xe,je){const Se=new Array;return xe.routes.forEach(Ve=>{const Xe=new K.JJ;Xe.Title=""+Se.length+1,Xe.JourneyRouteLegs=new Array,Xe.TotalDistanceKM=0,Xe.TotalDurationMinutes=0,Xe.TotalEnergykWh=0,Ve.legs.forEach(Ht=>{const cn=Ht.duration.value,xn=Ht.distance.value/1e3,$t=this.journeyManager.calculateEnergyConsumptionkWh(xn,0,null,je),ke=new K.eN;ke.DistanceKM=xn,ke.DurationMinutes=cn/60,ke.EnergyConsumptionkWh=$t,Xe.JourneyRouteLegs.push(ke),Xe.TotalDistanceKM+=ke.DistanceKM,Xe.TotalDurationMinutes+=ke.DurationMinutes,Xe.TotalEnergykWh=ke.EnergyConsumptionkWh}),Se.push(Xe)}),Se}static \u0275fac=function(je){return new(je||ne)(h.LFG(C.eN),h.LFG(a.i))};static \u0275prov=h.Yz7({token:ne,factory:ne.\u0275fac,providedIn:"root"})}return ne})();var _e=S(1847),Le=S(6814),ee=S(6223),Te=S(5460);function ye(ne,Ee){if(1&ne){const xe=h.EpF();h.TgZ(0,"ion-item"),h._UZ(1,"ion-icon",12),h.TgZ(2,"ion-searchbar",13),h.NdJ("ngModelChange",function(Se){h.CHM(xe);const Ve=h.oxw();return h.KtG(Ve.routeStart=Se)})("ionInput",function(Se){h.CHM(xe),h.oxw();const Ve=h.MAs(18);return h.KtG(Ve.getPlacesAutoComplete(Se,"routeStart"))})("ionCancel",function(Se){h.CHM(xe);const Ve=h.oxw();return h.KtG(Ve.onPlaceSearchCancel(Se))}),h.qZA()()}if(2&ne){const xe=h.oxw();h.xp6(2),h.Q6J("ngModel",xe.routeStart)("debounce",500)}}function De(ne,Ee){if(1&ne){const xe=h.EpF();h.TgZ(0,"ion-item",14),h.NdJ("click",function(){h.CHM(xe);const Se=h.oxw();return h.KtG(Se.clearRouteStart())}),h._UZ(1,"ion-icon",12),h.TgZ(2,"h2"),h._uU(3),h.qZA()()}if(2&ne){h.oxw();const xe=h.MAs(18);h.xp6(3),h.Oqu(null==xe.selectedPlace?null:xe.selectedPlace.name)}}function me(ne,Ee){if(1&ne){const xe=h.EpF();h.TgZ(0,"ion-item"),h._UZ(1,"ion-icon",15),h.TgZ(2,"ion-searchbar",16),h.NdJ("ngModelChange",function(Se){h.CHM(xe);const Ve=h.oxw();return h.KtG(Ve.routeDestination=Se)})("ionInput",function(Se){h.CHM(xe),h.oxw();const Ve=h.MAs(20);return h.KtG(Ve.getPlacesAutoComplete(Se,"routeDestination"))})("ionCancel",function(Se){h.CHM(xe);const Ve=h.oxw();return h.KtG(Ve.onPlaceSearchCancel(Se))}),h.qZA()()}if(2&ne){const xe=h.oxw();h.xp6(2),h.Q6J("ngModel",xe.routeDestination)("debounce",500)}}function Ye(ne,Ee){if(1&ne){const xe=h.EpF();h.TgZ(0,"ion-item",14),h.NdJ("click",function(){h.CHM(xe);const Se=h.oxw();return h.KtG(Se.clearRouteDestination())}),h._UZ(1,"ion-icon",15),h.TgZ(2,"h2"),h._uU(3),h.qZA()()}if(2&ne){h.oxw();const xe=h.MAs(20);h.xp6(3),h.Oqu(null==xe.selectedPlace?null:xe.selectedPlace.name)}}function Ce(ne,Ee){if(1&ne){const xe=h.EpF();h.TgZ(0,"ion-button",14),h.NdJ("click",function(){h.CHM(xe);const Se=h.oxw();return h.KtG(Se.clearRoute())}),h._UZ(1,"ion-icon",17),h._uU(2," Clear Route "),h.qZA()}}function de(ne,Ee){if(1&ne){const xe=h.EpF();h.TgZ(0,"ion-button",14),h.NdJ("click",function(){h.CHM(xe);const Se=h.oxw();return h.KtG(Se.showSettings())}),h._uU(1," Show Settings "),h._UZ(2,"ion-icon",18),h.qZA()}}function Pe(ne,Ee){if(1&ne){const xe=h.EpF();h.TgZ(0,"ion-button",14),h.NdJ("click",function(){h.CHM(xe);const Se=h.oxw();return h.KtG(Se.hideSettings())}),h._uU(1," Hide Settings "),h._UZ(2,"ion-icon",18),h.qZA()}}function Be(ne,Ee){1&ne&&(h.TgZ(0,"p",19),h._UZ(1,"ion-spinner",19),h._uU(2," Calculating Route.. "),h.qZA())}function Ne(ne,Ee){if(1&ne&&(h.TgZ(0,"ion-list")(1,"ion-list-header"),h._uU(2),h.ALo(3,"number"),h.ALo(4,"number"),h.qZA()()),2&ne){const xe=h.oxw();h.xp6(2),h.lnq(" Total Distance ",h.xi3(3,3,xe.selectedJourneyRoute.TotalDistanceKM,"1.0-2")," km, ",xe.formatDuration(xe.selectedJourneyRoute.TotalDurationMinutes),", ",h.xi3(4,6,xe.selectedJourneyRoute.TotalEnergykWh,"1.0-2")," kWh ")}}function Ae(ne,Ee){if(1&ne){const xe=h.EpF();h.TgZ(0,"div")(1,"ion-list")(2,"ion-list-header"),h._UZ(3,"ion-icon",20),h._uU(4," Route Settings "),h.qZA(),h.TgZ(5,"ion-item")(6,"ion-label",21),h._uU(7),h.qZA(),h.TgZ(8,"ion-range",22),h.NdJ("ngModelChange",function(Se){h.CHM(xe);const Ve=h.oxw();return h.KtG(Ve.routeSearchDistance=Se)}),h._UZ(9,"ion-icon",23)(10,"ion-icon",24),h.qZA()(),h.TgZ(11,"ion-item")(12,"ion-label",21),h._uU(13,"Energy Efficiency (kWh Per km)"),h.qZA(),h.TgZ(14,"ion-input",25),h.NdJ("ngModelChange",function(Se){h.CHM(xe);const Ve=h.oxw();return h.KtG(Ve.kWhPerKM=Se)}),h.qZA()()()()}if(2&ne){const xe=h.oxw();h.xp6(7),h.hij("Search Distance (",xe.routeSearchDistance,")"),h.xp6(1),h.Q6J("ngModel",xe.routeSearchDistance),h.xp6(6),h.Q6J("ngModel",xe.kWhPerKM)}}let Ge=(()=>{class ne{mapping;logging;directions;journeyManager;changeDetector;numberPipe;routeSearchDistance=5;journeyRoutes;selectedJourneyRoute;routePolyline;kWhPerKM;routeStartPlace;routeDestinationPlace;routeCalcInProgress=!1;advancedSettingsMode=!1;routeStart="";routeDestination="";constructor(xe,je,Se,Ve,Xe,Ht){this.mapping=xe,this.logging=je,this.directions=Se,this.journeyManager=Ve,this.changeDetector=Xe,this.numberPipe=Ht,this.kWhPerKM=.212}get isRouteSet(){return null!=this.routeStartPlace&&null!=this.routeDestinationPlace}showSettings(){this.advancedSettingsMode=!0}hideSettings(){this.advancedSettingsMode=!1}routeStartSelected(xe){this.routeStartPlace=xe,this.calculateRoute(),this.changeDetector.detectChanges()}routeDestinationSelected(xe){this.routeDestinationPlace=xe,this.calculateRoute(),this.changeDetector.detectChanges()}clearRouteStart(){this.routeStartPlace=null,this.changeDetector.detectChanges()}clearRouteDestination(){this.routeDestinationPlace=null,this.changeDetector.detectChanges()}clearRoute(){this.routeStartPlace=null,this.routeDestinationPlace=null,this.journeyManager.setRoutePolyline(null),this.mapping.clearPolyline()}formatDuration(xe){if(xe<=60)return this.numberPipe.transform(xe,"1.0-2")+" mins";{const je=Math.round(xe/60),Se=Math.floor(xe-60*je);return je+" hours "+(Se>0?Se+" mins":"")}}calculateRoute(){null!=this.routeStartPlace&&null!=this.routeDestinationPlace&&(this.logging.log("Fetching route directions.."),this.routeCalcInProgress=!0,this.directions.getDirections(this.routeStartPlace.Location.latitude+","+this.routeStartPlace.Location.longitude,this.routeDestinationPlace.Location.latitude+","+this.routeDestinationPlace.Location.longitude).then(xe=>{if(null!=xe.routes&&xe.routes.length>0){this.logging.log("Got route directions, analysing.."),this.routePolyline=xe.routes[0].overview_polyline;const je=xe.routes[0].bounds.getSouthWest(),Se=xe.routes[0].bounds.getNorthEast(),Ve=new X.wC(Se.lat(),Se.lng()),Xe=new X.wC(je.lat(),je.lng()),Ht=new X.LL(Ve,Xe);this.journeyRoutes=this.directions.analyseRoutes(xe,this.kWhPerKM),this.journeyRoutes.length>0&&(this.selectedJourneyRoute=this.journeyRoutes[0]),this.journeyManager.setRoutePolyline(this.routePolyline),this.mapping.renderPolyline(this.routePolyline),this.mapping.moveToMapBounds(Ht)}else this.logging.log("No route returned..");this.routeCalcInProgress=!1}))}static \u0275fac=function(je){return new(je||ne)(h.Y36(_e.v),h.Y36(j.z),h.Y36(oe),h.Y36(a.i),h.Y36(h.sBO),h.Y36(Le.JJ))};static \u0275cmp=h.Xpm({type:ne,selectors:[["route-planner"]],decls:24,vars:10,consts:[[1,"route"],[1,"route-places"],["name","map","slot","start"],[4,"ngIf"],[3,"click",4,"ngIf"],["primary",""],["slot","secondary"],["slot","primary"],[3,"placeChanged"],["placeSearchRouteStart",""],["placeSearchRouteDestination",""],["class","ion-padding",4,"ngIf"],["name","ionic","item-left",""],["placeholder","Starting Point",3,"ngModel","debounce","ngModelChange","ionInput","ionCancel"],[3,"click"],["name","pin","item-left",""],["placeholder","Destination",3,"ngModel","debounce","ngModelChange","ionInput","ionCancel"],["name","close","slot","start"],["name","cog","slot","end"],[1,"ion-padding"],["name","cog"],["position","stacked"],["min","1","max","200","step","5","snaps","true","pin","true","light","",3,"ngModel","ngModelChange"],["slot","start","small","","name","map"],["slot","end","large","","name","map"],["type","number","min","0.1","max","1",3,"ngModel","ngModelChange"]],template:function(je,Se){1&je&&(h.TgZ(0,"div",0)(1,"div",1)(2,"ion-list")(3,"ion-list-header"),h._UZ(4,"ion-icon",2),h.TgZ(5,"ion-label"),h._uU(6,"Plan Your Journey"),h.qZA()(),h.YNc(7,ye,3,2,"ion-item",3)(8,De,4,1,"ion-item",4)(9,me,3,2,"ion-item",3)(10,Ye,4,1,"ion-item",4),h.qZA(),h.TgZ(11,"ion-toolbar",5)(12,"ion-buttons",6),h.YNc(13,Ce,3,0,"ion-button",4),h.qZA(),h.TgZ(14,"ion-buttons",7),h.YNc(15,de,3,0,"ion-button",4)(16,Pe,3,0,"ion-button",4),h.qZA()()(),h.TgZ(17,"place-search",8,9),h.NdJ("placeChanged",function(Xe){return Se.routeStartSelected(Xe)}),h.qZA(),h.TgZ(19,"place-search",8,10),h.NdJ("placeChanged",function(Xe){return Se.routeDestinationSelected(Xe)}),h.qZA(),h.YNc(21,Be,3,0,"p",11)(22,Ne,5,9,"ion-list",3)(23,Ae,15,3,"div",3),h.qZA()),2&je&&(h.xp6(7),h.Q6J("ngIf",null==Se.routeStartPlace),h.xp6(1),h.Q6J("ngIf",null!=Se.routeStartPlace),h.xp6(1),h.Q6J("ngIf",null==Se.routeDestinationPlace),h.xp6(1),h.Q6J("ngIf",null!=Se.routeDestinationPlace),h.xp6(3),h.Q6J("ngIf",Se.isRouteSet),h.xp6(2),h.Q6J("ngIf",!Se.advancedSettingsMode),h.xp6(1),h.Q6J("ngIf",Se.advancedSettingsMode),h.xp6(5),h.Q6J("ngIf",Se.routeCalcInProgress),h.xp6(1),h.Q6J("ngIf",null!=Se.selectedJourneyRoute),h.xp6(1),h.Q6J("ngIf",Se.advancedSettingsMode))},dependencies:[Le.O5,p.YG,p.Sm,p.gu,p.pK,p.Ie,p.Q$,p.q_,p.yh,p.I_,p.VI,p.PQ,p.sr,p.as,p.QI,p.j9,p.yf,p.Uj,ee.JJ,ee.On,Te.v,Le.JJ],encapsulation:2})}return ne})(),lt=(()=>{class ne{modalController;hasNavbar=!1;constructor(xe){this.modalController=xe}close(){this.modalController.dismiss()}static \u0275fac=function(je){return new(je||ne)(h.Y36(p.IN))};static \u0275cmp=h.Xpm({type:ne,selectors:[["ng-component"]],decls:10,vars:0,consts:[["slot","end"],[3,"click"],["name","close","slot","end"],[1,"route-planner","ion-padding"]],template:function(je,Se){1&je&&(h.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),h._uU(3," Route Planner "),h.qZA(),h.TgZ(4,"ion-buttons",0)(5,"ion-button",1),h.NdJ("click",function(){return Se.close()}),h._UZ(6,"ion-icon",2),h._uU(7," Close "),h.qZA()()()(),h.TgZ(8,"ion-content",3),h._UZ(9,"route-planner"),h.qZA())},dependencies:[p.YG,p.Sm,p.W2,p.Gu,p.gu,p.wd,p.sr,Ge],encapsulation:2})}return ne})()},4606:(zn,wt,S)=>{"use strict";S.r(wt),S.d(wt,{SearchPageModule:()=>li});var h=S(5086),p=S(3999),X=S(6814),a=S(6223),j=S(6728),K=S(6800),C=S(5861),oe=S(553),_e=S(7777),Le=S(4119),ee=S(3247),Te=S(9723),ye=S(3052),De=S(4677),me=S(866),Ye=S(9127),Ce=S(989),de=S(1847),Pe=S(4669),Be=S(6470),Ne=S(5460),Ae=S(2438),Ge=S(7394);class lt extends Ge.w0{constructor(Dt,Ie){super()}schedule(Dt,Ie=0){return this}}const ne={setInterval(en,Dt,...Ie){const{delegate:Ct}=ne;return Ct?.setInterval?Ct.setInterval(en,Dt,...Ie):setInterval(en,Dt,...Ie)},clearInterval(en){const{delegate:Dt}=ne;return(Dt?.clearInterval||clearInterval)(en)},delegate:void 0};var Ee=S(9039),je=S(4552);class Se{constructor(Dt,Ie=Se.now){this.schedulerActionCtor=Dt,this.now=Ie}schedule(Dt,Ie=0,Ct){return new this.schedulerActionCtor(this,Dt).schedule(Ct,Ie)}}Se.now=je.l.now;const Xe=new class Ve extends Se{constructor(Dt,Ie=Se.now){super(Dt,Ie),this.actions=[],this._active=!1}flush(Dt){const{actions:Ie}=this;if(this._active)return void Ie.push(Dt);let Ct;this._active=!0;do{if(Ct=Dt.execute(Dt.state,Dt.delay))break}while(Dt=Ie.shift());if(this._active=!1,Ct){for(;Dt=Ie.shift();)Dt.unsubscribe();throw Ct}}}(class xe extends lt{constructor(Dt,Ie){super(Dt,Ie),this.scheduler=Dt,this.work=Ie,this.pending=!1}schedule(Dt,Ie=0){var Ct;if(this.closed)return this;this.state=Dt;const on=this.id,Rn=this.scheduler;return null!=on&&(this.id=this.recycleAsyncId(Rn,on,Ie)),this.pending=!0,this.delay=Ie,this.id=null!==(Ct=this.id)&&void 0!==Ct?Ct:this.requestAsyncId(Rn,this.id,Ie),this}requestAsyncId(Dt,Ie,Ct=0){return ne.setInterval(Dt.flush.bind(Dt,this),Ct)}recycleAsyncId(Dt,Ie,Ct=0){if(null!=Ct&&this.delay===Ct&&!1===this.pending)return Ie;null!=Ie&&ne.clearInterval(Ie)}execute(Dt,Ie){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const Ct=this._execute(Dt,Ie);if(Ct)return Ct;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(Dt,Ie){let on,Ct=!1;try{this.work(Dt)}catch(Rn){Ct=!0,on=Rn||new Error("Scheduled action threw falsy error")}if(Ct)return this.unsubscribe(),on}unsubscribe(){if(!this.closed){const{id:Dt,scheduler:Ie}=this,{actions:Ct}=Ie;this.work=this.state=this.scheduler=null,this.pending=!1,(0,Ee.P)(Ct,this),null!=Dt&&(this.id=this.recycleAsyncId(Ie,Dt,null)),this.delay=null,super.unsubscribe()}}});var cn=S(9360),xn=S(8251);const pe=(0,S(2726).fo)("Geolocation",{web:()=>S.e(579).then(S.bind(S,579)).then(en=>new en.GeolocationWeb)});var Oe=S(8564),ie=S(5472),it=S(5957);function _t(en,Dt){1&en&&Oe._UZ(0,"ion-icon",13)}function Kt(en,Dt){1&en&&Oe._UZ(0,"ion-spinner")}function Mn(en,Dt){if(1&en){const Ie=Oe.EpF();Oe.TgZ(0,"ion-button",3),Oe.NdJ("click",function(){Oe.CHM(Ie);const on=Oe.oxw();return Oe.KtG(on.openSideView())}),Oe._UZ(1,"ion-icon",14),Oe.qZA()}}function fn(en,Dt){1&en&&(Oe.ynx(0),Oe.TgZ(1,"div",15)(2,"p"),Oe._uU(3,"There was a problem communicating with Open Charge Map. Please check your data connection."),Oe.qZA()(),Oe.BQk())}let qn=(()=>{class en{appManager;nav;events;translate;platform;poiManager;mapping;journeyManager;zone;modalController;alertController;logging;mapDisplayed=!1;debouncedRefreshMapResults;mapCanvasID;initialResultsShown=!1;searchOnDemand=!1;poiViewMode="modal";sideViewAvailable=!1;searchPolyline;routePlanningMode=!0;searchKeyword="";selectedPOI;appConfig=new _e.X;defaultMapZoom=15;defaultStartPos=new ye.wC(37.415328,-122.076575);placeSearchMapPOI;constructor(Ie,Ct,on,Rn,Vn,Ut,Hn,qe,Nt,Xt,Tn,oi){this.appManager=Ie,this.nav=Ct,this.events=on,this.translate=Rn,this.platform=Vn,this.poiManager=Ut,this.mapping=Hn,this.journeyManager=qe,this.zone=Nt,this.modalController=Xt,this.alertController=Tn,this.logging=oi,this.mapCanvasID="map-canvas",this.mapping.setMapType(Ie.searchSettings.MapType),this.mapping.setMapAPI(oe.N.defaultMapProvider),(0,Ae.R)(window,"resize").pipe(function $t(en,Dt=Xe){return(0,cn.e)((Ie,Ct)=>{let on=null,Rn=null,Vn=null;const Ut=()=>{if(on){on.unsubscribe(),on=null;const qe=Rn;Rn=null,Ct.next(qe)}};function Hn(){const qe=Vn+en,Nt=Dt.now();if(Nt<qe)return on=this.schedule(void 0,qe-Nt),void Ct.add(on);Ut()}Ie.subscribe((0,xn.x)(Ct,qe=>{Rn=qe,Vn=Dt.now(),on||(on=Dt.schedule(Hn,en),Ct.add(on))},()=>{Ut(),Ct.complete()},void 0,()=>{Rn=on=null}))})}(500)).subscribe(Oi=>{let gr={width:me.c.getClientHeight(),height:me.c.getClientWidth()};this.events.publish("ocm:window:resized",[gr])})}ionViewDidEnter(){this.logging.log("Entered search page.",Ye.i.VERBOSE),this.mapping.focusMap(),this.mapping.updateMapSize()}ionViewWillLeave(){this.logging.log("Leaving search page.",Ye.i.VERBOSE),this.mapping.unfocusMap()}getPreferredMapHeight(Ie){return null==Ie&&(Ie=me.c.getClientHeight()),Ie-56}enforceMapHeight(Ie){this.logging.log("Would resize map:"+Ie.width+" "+Ie.height,Ye.i.VERBOSE);const Ct=this.getPreferredMapHeight(Ie[0]);document.getElementById(this.mapCanvasID).offsetHeight!==Ct&&(document.getElementById(this.mapCanvasID).style.height=Ct+"px"),this.mapping&&(this.logging.log("Map height:"+Ct,Ye.i.VERBOSE),this.mapping.updateMapSize())}initialiseMapping(){var Ie=this;return(0,C.Z)(function*(){yield Ie.platform.ready(),Ie.debouncedRefreshMapResults=me.c.debounce(Ie.refreshMapResults,1e3,!1),Ie.events.subscribe("ocm:mapping:ready",(0,C.Z)(function*(){if(Ie.logging.log("init map: mapping ready"),Ie.mapping&&Ie.mapping.updateMapSize(),!Ie.initialResultsShown)if(Ie.appManager.searchSettings.StartSearchPosition&&!Ie.appManager.searchSettings.StartViewPoiId)Ie.searchOnDemand=!0,Ie.mapping.updateMapCentrePos(Ie.appManager.searchSettings.StartSearchPosition.latitude,Ie.appManager.searchSettings.StartSearchPosition.longitude,!0,Ie.defaultMapZoom);else{let Ct=localStorage.getItem("_locationEnabled");1==Ie.appManager.isEmbeddedMode&&"true"!=Ct?yield(yield Ie.alertController.create({header:"Search using your location?",message:"Select OK to continue.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:(Rn=(0,C.Z)(function*(Vn){yield Ie.useFallbackPosition()}),function(Ut){return Rn.apply(this,arguments)})},{text:"OK",handler:function(){var Rn=(0,C.Z)(function*(){yield Ie.locateUser()});return function(){return Rn.apply(this,arguments)}}()}]})).present():(yield Ie.locateUser(),Ie.mapping&&Ie.mapping.updateMapSize())}var Rn})),Ie.events.subscribe("ocm:mapping:zoom",()=>{Ie.debouncedRefreshMapResults()}),Ie.events.subscribe("ocm:mapping:dragend",()=>{Ie.debouncedRefreshMapResults()}),Ie.events.subscribe("ocm:poiList:updated",Ct=>{Ie.showPOIListOnMap(Ct)}),Ie.events.subscribe("ocm:poiList:cleared",()=>{Ie.mapping.clearMarkers(),setTimeout(()=>{Ie.debouncedRefreshMapResults()},500)}),Ie.events.subscribe("ocm:window:resized",Ct=>{null!=Ct&&Ct.length>0&&Ie.enforceMapHeight(Ct[0])}),Ie.events.subscribe("ocm:poi:selected",Ct=>{if(Ct.poi)Ie.viewPOIDetails(Ct,Ct.poi);else{let on=Ie.getPOIByID(Ct.poiId);Ie.viewPOIDetails(Ct,on)}}),Ie.mapping.initMap(Ie.mapCanvasID)})()}ngAfterViewInit(){var Ie=this;return(0,C.Z)(function*(){yield Ie.initialiseMapping()})()}ngOnInit(){var Ie=this;return(0,C.Z)(function*(){Ie.logging.log("Refreshing reference data ..",Ye.i.VERBOSE),(yield Ie.appManager.referenceDataManager.refreshReferenceData(Ie.appManager.api))||(Ie.appManager.isOffline=!0)})()}showPOIListOnMap(Ie){const Ct=this.getPreferredMapHeight(null);this.mapping.refreshMapView(Ct,this.poiManager.poiList,null),this.mapDisplayed||(this.mapDisplayed=!0)}getIconForPOI(Ie){return me.c.getIconForPOI(Ie)}getPOIByID(Ie){const Ct=this.poiManager.poiList;for(let on=0;on<Ct.length;on++)if(Ct[on].ID===Ie)return Ct[on];return null}refreshMapResults(){var Ie=this;return(0,C.Z)(function*(){if(!Ie.searchOnDemand)return void Ie.logging.log("Skipping refresh, search on demand disabled..",Ye.i.VERBOSE);Ie.logging.log("Refreshing Results..",Ye.i.VERBOSE);const Ct=new De.b;let on=null;if(Ie.appManager.searchSettings.StartViewPoiId){let Vn=Ie.appManager.searchSettings.StartViewPoiId;Ie.appManager.searchSettings.StartViewPoiId=null;let Ut=yield Ie.poiManager.getPOIById(Vn);Ut&&(Ie.events.publish("ocm:poi:selected",{poiId:Ut.ID,poi:Ut}),Ie.mapping.updateMapCentrePos(Ut.AddressInfo.Latitude,Ut.AddressInfo.Longitude,!0,Ie.defaultMapZoom))}if(Ie.appManager.searchSettings.StartSearchPosition&&(on=new ye.jR(Ie.appManager.searchSettings.StartSearchPosition.latitude,Ie.appManager.searchSettings.StartSearchPosition.longitude),Ie.appManager.searchSettings.StartSearchPosition=null),on&&0==on.coords.latitude&&0==on.coords.longitude)return void Ie.logging.log("Map center is zero. No query will be performed",Ye.i.WARNING);if(null!=on)Ct.latitude=on.coords.latitude,Ct.longitude=on.coords.longitude,Ct.distance=25,Ct.boundingbox=null,Ie.appManager.searchSettings.LastSearchPosition=new ye.wC(on.coords.latitude,on.coords.longitude);else{Ct.latitude=null,Ct.longitude=null;let Vn=yield Ie.mapping.getMapBounds().toPromise();Ct.boundingbox="("+Vn[0].latitude+","+Vn[0].longitude+"),("+Vn[1].latitude+","+Vn[1].longitude+")",Ie.logging.log(JSON.stringify(Vn),Ye.i.VERBOSE)}Ct.includeComments=!0,Ct.enableCaching=!0,null!=Ie.appManager.searchSettings&&(null!=Ie.appManager.searchSettings.ConnectionTypeList&&(Ct.connectionTypeIdList=Ie.appManager.searchSettings.ConnectionTypeList),null!=Ie.appManager.searchSettings.UsageTypeList&&(Ct.usageTypeIdList=Ie.appManager.searchSettings.UsageTypeList),null!=Ie.appManager.searchSettings.StatusTypeList&&(Ct.statusTypeIdList=Ie.appManager.searchSettings.StatusTypeList),null!=Ie.appManager.searchSettings.OperatorList&&(Ct.operatorIdList=Ie.appManager.searchSettings.OperatorList),null!=Ie.appManager.searchSettings.MinPowerKW&&Ie.appManager.searchSettings.MinPowerKW>0&&(Ct.minPowerKW=Ie.appManager.searchSettings.MinPowerKW),null!=Ie.appManager.searchSettings.MaxPowerKW&&Ie.appManager.searchSettings.MaxPowerKW>0&&(Ct.maxPowerKW=Ie.appManager.searchSettings.MaxPowerKW),null!=Ie.appManager.searchSettings.MaxResults&&Ie.appManager.searchSettings.MaxResults>0&&Ie.appManager.searchSettings.MaxResults<=1e4&&(Ct.maxResults=Ie.appManager.searchSettings.MaxResults),null!=Ie.journeyManager.getRoutePolyline()&&(Ct.polyline=Ie.journeyManager.getRoutePolyline(),Ct.boundingbox=null,Ct.levelOfDetail=null,Ct.latitude=null,Ct.longitude=null)),Ie.appManager.searchSettings.EnablePOIPendingApproval&&(Ct.submissionStatusTypeIdList=[1,100,200]),Ie.appManager.isRequestInProgress=!0;let Rn=yield Ie.poiManager.refreshPOIList(Ct);Ie.appManager.isRequestInProgress=!1,Ie.initialResultsShown=!0,Rn>=Ct.maxResults&&Ie.appManager.showToastNotification("A maximum of "+Rn+" results are returned per search. Zoom in for details.")})()}viewPOIDetails(Ie,Ct){this.logging.log("Viewing/fetching ["+this.poiViewMode+"] POI Details "+Ie.poiId),null!=Ct?(this.mapping.unfocusMap(),this.modalController.create({component:Te.H,componentProps:{item:Ct}}).then(on=>{on.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),on.present()})):this.poiManager.getPOIById(Ie.poiId,!0).then(on=>{this.logging.log("Got POI Details "+on.ID),"modal"===this.poiViewMode&&(this.searchOnDemand=!1,this.modalController.create({component:Te.H,componentProps:{item:on}}).then(Rn=>{Rn.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),Rn.present()}),this.mapping.unfocusMap()),"side"===this.poiViewMode&&(this.selectedPOI=on)},on=>{this.appManager.showToastNotification("POI Details not available")})}closePOIDetails(){this.selectedPOI=null}openRoutePlannerModal(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:ee.u}).then(Ie=>{Ie.onDidDismiss().then(Ct=>{this.logging.log("Dismissing Route Planner Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),Ie.present()})}openSearchOptions(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:Le.N}).then(Ie=>{Ie.onDidDismiss().then(Ct=>{this.mapping.focusMap(),this.searchOnDemand=!0}),Ie.present()})}openSideView(){this.poiViewMode="side",this.mapping.updateMapSize()}closeSideView(){this.poiViewMode="modal",this.mapping.updateMapSize()}planRoute(){this.routePlanningMode=!0}search(Ie){this.placeSearchMapPOI.getPlacesAutoComplete(Ie,"poiSearch")}useFallbackPosition(){let Ie=this.defaultStartPos;null!=this.appManager.searchSettings.LastSearchPosition&&(Ie=this.appManager.searchSettings.LastSearchPosition),this.appManager.searchSettings.StartSearchPosition=Ie,this.appManager.searchSettings.LastSearchPosition=null,this.searchOnDemand=!0,this.mapping.updateMapCentrePos(Ie.latitude,Ie.longitude,!0,this.defaultMapZoom)}_watchId=null;getPosition(Ie={}){var Ct=this;return(0,C.Z)(function*(){return new Promise((on,Rn)=>{Ct._watchId=pe.watchPosition(Ie,(Vn,Ut)=>{Ct._watchId&&pe.clearWatch({id:Ct._watchId}),Ut?Rn(Ut):on(Vn)})})})()}locateUser(){var Ie=this;return(0,C.Z)(function*(){Ie.useFallbackPosition();try{Ie.logging.log("Attempting to locate user..");const Ct=yield Ie.getPosition({timeout:1e4});if(!Ct)throw"Failed to get user location.";return Ie.logging.log("Got user location."),Ie.appManager.searchSettings.StartSearchPosition=new ye.wC(Ct.coords.latitude,Ct.coords.longitude),Ie.searchOnDemand=!0,Ie.mapping.updateMapCentrePos(Ct.coords.latitude,Ct.coords.longitude,!0,Ie.defaultMapZoom),localStorage.setItem("_locationEnabled","true"),!0}catch(Ct){return Ie.logging.log("Failed to get user location. Searching using default or last position."+Ct),Ie.appManager.showToastNotification("Your location could not be determined."),Ie.useFallbackPosition(),!1}})()}placeSelected(Ie){this.searchKeyword=Ie.Address,this.logging.log("Got place details:"+Ie.Address),this.mapping.focusMap(),this.mapping.updateMapCentrePos(Ie.Location.latitude,Ie.Location.longitude,!0),this.debouncedRefreshMapResults()}static \u0275fac=function(Ct){return new(Ct||en)(Oe.Y36(Be.c),Oe.Y36(ie.SH),Oe.Y36(it.z),Oe.Y36(p.sK),Oe.Y36(ie.t4),Oe.Y36(Pe.R),Oe.Y36(de.v),Oe.Y36(Ce.i),Oe.Y36(Oe.R0b),Oe.Y36(j.IN),Oe.Y36(j.Br),Oe.Y36(Ye.z))};static \u0275cmp=Oe.Xpm({type:en,selectors:[["ng-component"]],viewQuery:function(Ct,on){if(1&Ct&&Oe.Gf(Ne.v,7),2&Ct){let Rn;Oe.iGM(Rn=Oe.CRH())&&(on.placeSearchMapPOI=Rn.first)}},decls:18,vars:10,consts:[["slot","start"],["autocapitalize","on","autocomplete","on",3,"ngModel","placeholder","debounce","ngModelChange","ionInput"],["slot","end"],[3,"click"],["name","locate","slot","start",4,"ngIf"],[4,"ngIf"],[3,"color","click"],["name","options","slot","end"],[3,"click",4,"ngIf"],[1,"search-page"],[3,"placeChanged"],["placeSearchMapPOI",""],["id","map-canvas",2,"height","100%","width","100%","min-height","300px"],["name","locate","slot","start"],["name","car","title","Route","slot","end"],[2,"position","absolute"]],template:function(Ct,on){1&Ct&&(Oe.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),Oe._UZ(3,"ion-menu-button"),Oe.qZA(),Oe.TgZ(4,"ion-searchbar",1),Oe.NdJ("ngModelChange",function(Vn){return on.searchKeyword=Vn})("ionInput",function(Vn){return on.search(Vn)}),Oe.ALo(5,"translate"),Oe.qZA(),Oe.TgZ(6,"ion-buttons",2)(7,"ion-button",3),Oe.NdJ("click",function(){return on.locateUser()}),Oe.YNc(8,_t,1,0,"ion-icon",4)(9,Kt,1,0,"ion-spinner",5),Oe.qZA(),Oe.TgZ(10,"ion-button",6),Oe.NdJ("click",function(){return on.openSearchOptions()}),Oe._UZ(11,"ion-icon",7),Oe.qZA(),Oe.YNc(12,Mn,2,0,"ion-button",8),Oe.qZA()()(),Oe.TgZ(13,"ion-content",9)(14,"place-search",10,11),Oe.NdJ("placeChanged",function(Vn){return on.placeSelected(Vn)}),Oe.qZA(),Oe.YNc(16,fn,4,0,"ng-container",5),Oe._UZ(17,"div",12),Oe.qZA()),2&Ct&&(Oe.xp6(4),Oe.Q6J("ngModel",on.searchKeyword)("placeholder",Oe.lcZ(5,8,"ocm.search.performSearch"))("debounce",500),Oe.xp6(4),Oe.Q6J("ngIf",!on.appManager.isRequestInProgress),Oe.xp6(1),Oe.Q6J("ngIf",on.appManager.isRequestInProgress),Oe.xp6(1),Oe.Q6J("color",on.appManager.searchSettings.HasActiveFilters?"danger":"default"),Oe.xp6(2),Oe.Q6J("ngIf",1==on.sideViewAvailable&&"modal"==on.poiViewMode),Oe.xp6(4),Oe.Q6J("ngIf",on.appManager.isOffline))},dependencies:[X.O5,a.JJ,a.On,j.YG,j.Sm,j.W2,j.Gu,j.gu,j.fG,j.VI,j.PQ,j.sr,j.j9,Ne.v,p.X$],styles:[".search-page[_ngcontent-%COMP%]   #map-canvas[_ngcontent-%COMP%]{width:100%;height:98%}.search-page[_ngcontent-%COMP%]   #place-search[_ngcontent-%COMP%]{min-height:300px;background-color:#f0f0f0;position:absolute;z-index:100;width:100%}.search-page[_ngcontent-%COMP%]   scroll-content[_ngcontent-%COMP%]{overflow-y:hidden}.search-page[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]{padding-left:2em}.search-page[_ngcontent-%COMP%]   .sideview[_ngcontent-%COMP%]{background:rgb(238,238,238);background:linear-gradient(to bottom,rgb(238,238,238) 0%,rgb(255,255,255) 100%)}"]})}return en})(),li=(()=>{class en{static \u0275fac=function(Ct){return new(Ct||en)};static \u0275mod=Oe.oAB({type:en});static \u0275inj=Oe.cJS({imports:[X.ez,a.u5,j.Pc,p.aw,h.e,K.Bz.forChild([{path:"",component:qn}])]})}return en})()},4119:(zn,wt,S)=>{"use strict";S.d(wt,{N:()=>Ae});var h=S(5861),p=S(4669),X=S(6470),a=S(4783),j=S(866),K=S(1847),C=S(8564),oe=S(6728),_e=S(5957),Le=S(6814),ee=S(6223),Te=S(6086),ye=S(3999);let De=(()=>{class Ge extends ye.X${constructor(ne,Ee){super(ne,Ee)}transform(ne,...Ee){let xe=super.transform(ne,...Ee);return xe==ne?null!=Ee&&Ee[0].default?Ee[0].default:Ee[0].Title?Ee[0].Title:xe:xe}static \u0275fac=function(Ee){return new(Ee||Ge)(C.Y36(ye.sK,16),C.Y36(C.sBO,16))};static \u0275pipe=C.Yjl({name:"nullableTranslate",type:Ge,pure:!0});static \u0275prov=C.Yz7({token:Ge,factory:Ge.\u0275fac})}return Ge})();function me(Ge,lt){if(1&Ge){const ne=C.EpF();C.TgZ(0,"p",23),C._UZ(1,"ion-icon",24),C._uU(2," One or more filters are currently being applied. "),C.TgZ(3,"ion-button",25),C.NdJ("click",function(){C.CHM(ne);const xe=C.oxw();return C.KtG(xe.clearFilters())}),C._UZ(4,"ion-icon",26),C.TgZ(5,"ion-label"),C._uU(6,"Clear"),C.qZA()()()}}function Ye(Ge,lt){if(1&Ge&&(C.TgZ(0,"ion-select-option",28),C._uU(1),C.qZA()),2&Ge){const ne=lt.$implicit;C.Q6J("value",ne.ID),C.xp6(1),C.Oqu(ne.Title)}}function Ce(Ge,lt){if(1&Ge){const ne=C.EpF();C.TgZ(0,"ion-item")(1,"ion-select",15),C.NdJ("ngModelChange",function(xe){C.CHM(ne);const je=C.oxw();return C.KtG(je.searchSettings.FilterOptionsByCountryId=xe)})("ionChange",function(){C.CHM(ne);const xe=C.oxw();return C.KtG(xe.onCountryChange())}),C.ALo(2,"translate"),C.TgZ(3,"ion-select",27),C._uU(4,"(All Countries)"),C.qZA(),C.YNc(5,Ye,2,2,"ion-select-option",5),C.qZA()()}if(2&Ge){const ne=C.oxw();C.xp6(1),C.Q6J("label",C.lcZ(2,3,"ocm.search.countries"))("ngModel",ne.searchSettings.FilterOptionsByCountryId),C.xp6(4),C.Q6J("ngForOf",ne.countries)}}function de(Ge,lt){if(1&Ge&&(C.TgZ(0,"ion-select-option",28),C._uU(1),C.ALo(2,"nullableTranslate"),C.qZA()),2&Ge){const ne=lt.$implicit;C.Q6J("value",ne.ID),C.xp6(1),C.Oqu(C.xi3(2,2,"ocm.reference.usageType.value_"+ne.ID,ne))}}function Pe(Ge,lt){if(1&Ge&&(C.TgZ(0,"ion-select-option",28),C._uU(1),C.ALo(2,"nullableTranslate"),C.qZA()),2&Ge){const ne=lt.$implicit;C.Q6J("value",ne.ID),C.xp6(1),C.Oqu(C.xi3(2,2,"ocm.reference.statusType.value_"+ne.ID,ne))}}function Be(Ge,lt){if(1&Ge&&(C.TgZ(0,"ion-select-option",28),C._uU(1),C.ALo(2,"nullableTranslate"),C.qZA()),2&Ge){const ne=lt.$implicit;C.Q6J("value",ne.ID),C.xp6(1),C.Oqu(C.xi3(2,2,"ocm.reference.connectionType.value_"+ne.ID,ne))}}function Ne(Ge,lt){if(1&Ge&&(C.TgZ(0,"ion-select-option",28),C._uU(1),C.qZA()),2&Ge){const ne=lt.$implicit;C.Q6J("value",ne.code),C.xp6(1),C.Oqu(ne.title)}}let Ae=(()=>{class Ge{appManager;poiManager;mapping;modalController;events;searchSettings;maxPower=a.U;powerRange={lower:0,upper:this.maxPower};constructor(ne,Ee,xe,je,Se){this.appManager=ne,this.poiManager=Ee,this.mapping=xe,this.modalController=je,this.events=Se,this.searchSettings=ne.searchSettings}ngOnInit(){var ne=this;return(0,h.Z)(function*(){null!=ne.searchSettings.MinPowerKW&&(ne.powerRange.lower=ne.searchSettings.MinPowerKW),null!=ne.searchSettings.MaxPowerKW&&(ne.powerRange.upper=ne.searchSettings.MaxPowerKW),0==ne.powerRange.upper&&(ne.powerRange.upper=ne.maxPower),ne.appManager.analytics.viewEvent("Settings"),ne.useFilteredOptions&&(yield ne.onCountryChange())})()}get useFilteredOptions(){return this.searchSettings.FilterOptionsByCountryId>0}clearFilters(){this.searchSettings.ClearActiveFilters(),this.powerRange={lower:0,upper:this.maxPower},this.searchSettings.CheckForActiveFilters()}get operators(){return this.appManager.referenceDataManager.getNetworkOperators(this.useFilteredOptions)}get connectionTypes(){return this.appManager.referenceDataManager.getConnectionTypes(this.useFilteredOptions)}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes(this.useFilteredOptions)}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes(this.useFilteredOptions)}get countries(){return this.appManager.referenceDataManager.getCountries(this.useFilteredOptions)}get isCountryFilterFeatureEnabled(){return j.c.isFeatureEnabled("FILTER_OPTIONS_BY_COUNTRY")}_languages=[];get languages(){return this._languages.length>0||(this._languages=this.appManager.getLanguages()),this._languages}ionViewWillLeave(){null!=this.searchSettings.Language&&this.appManager.setLanguage(this.searchSettings.Language),this.searchSettings.MinPowerKW=this.powerRange.lower,this.searchSettings.MaxPowerKW=this.powerRange.upper,1==this.searchSettings.MinPowerKW&&(this.searchSettings.MinPowerKW=null),this.searchSettings.MaxPowerKW==this.maxPower&&(this.searchSettings.MaxPowerKW=null),this.appManager.searchSettings=this.searchSettings,this.appManager.saveSearchSettings(),this.events.publish("ocm:poiList:cleared")}onLanguageChange(){null!=this.searchSettings.Language&&""!=this.searchSettings.Language&&this.appManager.setLanguage(this.searchSettings.Language)}onCountryChange(){var ne=this;return(0,h.Z)(function*(){ne.appManager.referenceDataManager.refreshFilteredReferenceData(ne.appManager.api,{CountryIds:[ne.searchSettings.FilterOptionsByCountryId]})})()}onMapTypeChange(){var ne=this;return(0,h.Z)(function*(){ne.mapping.setMapType(ne.searchSettings.MapType)})()}onOperatorSelected(ne=null){var Ee=this;return(0,h.Z)(function*(){null!=ne&&(Ee.searchSettings.OperatorList.find(xe=>xe==ne.ID)||Ee.searchSettings.OperatorList.push(ne.ID))})()}onOperatorRemoved(ne){var Ee=this;return(0,h.Z)(function*(){Ee.searchSettings.OperatorList=Ee.searchSettings.OperatorList.filter(xe=>xe!=ne)})()}close(){this.modalController.dismiss()}static \u0275fac=function(Ee){return new(Ee||Ge)(C.Y36(X.c),C.Y36(p.R),C.Y36(K.v),C.Y36(oe.IN),C.Y36(_e.z))};static \u0275cmp=C.Xpm({type:Ge,selectors:[["ng-component"]],decls:66,vars:41,consts:[[1,"settings-page","ion-padding"],["danger","",4,"ngIf"],[4,"ngIf"],["mode","multi",3,"operatorList","useFilteredOperators","operatorRemoved","operatorChanged"],["multiple","true","cancelText","Cancel","okText","OK",3,"label","ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["lines","none"],["dualKnobs","true","min","0","max","650","pin","true",3,"ngModel","ticks","snaps","min","max","ngModelChange"],["slot","start","size","small","name","flash"],["slot","end","name","flash"],["slot","start",2,"padding-top","0"],["type","number","min","0",2,"width","3em","border","none",3,"ngModel","max","ngModelChange"],["slot","end",2,"padding-top","0"],["type","number",2,"width","3em","border","none",3,"ngModel","max","min","ngModelChange"],["label","Language","multiple","false",3,"ngModel","ngModelChange","ionChange"],["multiple","false","cancelText","Cancel","okText","OK",3,"label","ngModel","ngModelChange","ionChange"],["value","ROADMAP"],["value","SATELLITE"],[3,"ngModel","ngModelChange"],["label","Max Results","type","number","placeholder","500","min","100","max","10000",3,"ngModel","ngModelChange"],["slot","end"],[3,"click"],["name","close","slot","start"],["danger",""],["name","alert"],["size","small","color","light",3,"click"],["slot","start","name","close"],["value",""],[3,"value"]],template:function(Ee,xe){1&Ee&&(C.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),C._uU(3),C.ALo(4,"translate"),C.qZA()()(),C.TgZ(5,"ion-content",0)(6,"h2"),C._uU(7,"Search Filters"),C.qZA(),C.TgZ(8,"p"),C._uU(9,"Note: Filters will remove usable charging locations from your search results if we do not have complete data (i.e Operator or Power Levels)."),C.qZA(),C.YNc(10,me,7,0,"p",1),C.TgZ(11,"ion-list"),C.YNc(12,Ce,6,5,"ion-item",2),C.TgZ(13,"app-operator-lookup",3),C.NdJ("operatorRemoved",function(Se){return xe.onOperatorRemoved(Se)})("operatorChanged",function(Se){return xe.onOperatorSelected(Se)}),C.qZA(),C.TgZ(14,"ion-item")(15,"ion-select",4),C.NdJ("ngModelChange",function(Se){return xe.searchSettings.UsageTypeList=Se}),C.ALo(16,"translate"),C.YNc(17,de,3,5,"ion-select-option",5),C.qZA()(),C.TgZ(18,"ion-item")(19,"ion-select",4),C.NdJ("ngModelChange",function(Se){return xe.searchSettings.StatusTypeList=Se}),C.ALo(20,"translate"),C.YNc(21,Pe,3,5,"ion-select-option",5),C.qZA()(),C.TgZ(22,"ion-item")(23,"ion-select",4),C.NdJ("ngModelChange",function(Se){return xe.searchSettings.ConnectionTypeList=Se}),C.ALo(24,"translate"),C.YNc(25,Be,3,5,"ion-select-option",5),C.qZA()(),C.TgZ(26,"ion-item",6)(27,"ion-range",7),C.NdJ("ngModelChange",function(Se){return xe.powerRange=Se}),C.TgZ(28,"ion-icon",8),C._uU(29,"0"),C.qZA(),C._UZ(30,"ion-icon",9),C.qZA()(),C.TgZ(31,"ion-item",6)(32,"ion-note",10),C._uU(33,"Min. Power (kW)"),C._UZ(34,"br"),C.TgZ(35,"input",11),C.NdJ("ngModelChange",function(Se){return xe.powerRange.lower=Se}),C.qZA()(),C.TgZ(36,"ion-note",12),C._uU(37,"Max. Power (kW)"),C._UZ(38,"br"),C.TgZ(39,"input",13),C.NdJ("ngModelChange",function(Se){return xe.powerRange.upper=Se}),C.qZA()()()(),C.TgZ(40,"h2"),C._uU(41," General Settings "),C.qZA(),C.TgZ(42,"ion-item")(43,"ion-select",14),C.NdJ("ngModelChange",function(Se){return xe.searchSettings.Language=Se})("ionChange",function(){return xe.onLanguageChange()}),C.YNc(44,Ne,2,2,"ion-select-option",5),C.qZA()(),C.TgZ(45,"ion-item")(46,"ion-select",15),C.NdJ("ngModelChange",function(Se){return xe.searchSettings.MapType=Se})("ionChange",function(){return xe.onMapTypeChange()}),C.ALo(47,"translate"),C.TgZ(48,"ion-select-option",16),C._uU(49,"Road Map"),C.qZA(),C.TgZ(50,"ion-select-option",17),C._uU(51,"Satellite"),C.qZA()()(),C.TgZ(52,"ion-item")(53,"ion-toggle",18),C.NdJ("ngModelChange",function(Se){return xe.searchSettings.EnableAdvancedEditorFeatures=Se}),C._uU(54,"Enable Advanced Editor Options"),C.qZA()(),C.TgZ(55,"ion-item")(56,"ion-toggle",18),C.NdJ("ngModelChange",function(Se){return xe.searchSettings.EnablePOIPendingApproval=Se}),C._uU(57,"Show POIs Pending Approval"),C.qZA()(),C.TgZ(58,"ion-item")(59,"ion-input",19),C.NdJ("ngModelChange",function(Se){return xe.searchSettings.MaxResults=Se}),C.qZA()()(),C.TgZ(60,"ion-footer")(61,"ion-toolbar")(62,"ion-buttons",20)(63,"ion-button",21),C.NdJ("click",function(){return xe.close()}),C._UZ(64,"ion-icon",22),C._uU(65," Close "),C.qZA()()()()),2&Ee&&(C.xp6(3),C.hij(" ",C.lcZ(4,31,"ocm.general.settings")," "),C.xp6(7),C.Q6J("ngIf",1==xe.searchSettings.HasActiveFilters),C.xp6(2),C.Q6J("ngIf",xe.isCountryFilterFeatureEnabled),C.xp6(1),C.Q6J("operatorList",xe.searchSettings.OperatorList)("useFilteredOperators",!1),C.xp6(2),C.Q6J("label",C.lcZ(16,33,"ocm.search.usageTypes"))("ngModel",xe.searchSettings.UsageTypeList),C.xp6(2),C.Q6J("ngForOf",xe.usageTypes),C.xp6(2),C.Q6J("label",C.lcZ(20,35,"ocm.search.operationalStatusTypes"))("ngModel",xe.searchSettings.StatusTypeList),C.xp6(2),C.Q6J("ngForOf",xe.statusTypes),C.xp6(2),C.Q6J("label",C.lcZ(24,37,"ocm.search.connectionTypes"))("ngModel",xe.searchSettings.ConnectionTypeList),C.xp6(2),C.Q6J("ngForOf",xe.connectionTypes),C.xp6(2),C.Q6J("ngModel",xe.powerRange)("ticks",!0)("snaps",!0)("min",xe.powerRange.lower)("max",xe.powerRange.upper),C.xp6(8),C.Q6J("ngModel",xe.powerRange.lower)("max",xe.powerRange.upper),C.xp6(4),C.Q6J("ngModel",xe.powerRange.upper)("max",xe.maxPower)("min",xe.powerRange.lower),C.xp6(4),C.Q6J("ngModel",xe.searchSettings.Language),C.xp6(1),C.Q6J("ngForOf",xe.languages),C.xp6(2),C.Q6J("label",C.lcZ(47,39,"ocm.details.location.map"))("ngModel",xe.searchSettings.MapType),C.xp6(7),C.Q6J("ngModel",xe.searchSettings.EnableAdvancedEditorFeatures),C.xp6(3),C.Q6J("ngModel",xe.searchSettings.EnablePOIPendingApproval),C.xp6(3),C.Q6J("ngModel",xe.searchSettings.MaxResults))},dependencies:[Le.sg,Le.O5,ee.Fj,ee.wV,ee.JJ,ee.qQ,ee.Fd,ee.On,oe.YG,oe.Sm,oe.W2,oe.fr,oe.Gu,oe.gu,oe.pK,oe.Ie,oe.Q$,oe.q_,oe.uN,oe.I_,oe.t9,oe.n0,oe.wd,oe.ho,oe.sr,oe.w,oe.as,oe.QI,oe.yf,oe.Uj,Te.z,ye.X$,De],encapsulation:2})}return Ge})()},9472:(zn,wt,S)=>{"use strict";S.r(wt),S.d(wt,{SignInModule:()=>_e});var h=S(8767),p=S(5086),X=S(3999),a=S(6814),j=S(6223),K=S(6728),C=S(6800),oe=S(8564);let _e=(()=>{class Le{static \u0275fac=function(ye){return new(ye||Le)};static \u0275mod=oe.oAB({type:Le});static \u0275inj=oe.cJS({imports:[a.ez,j.u5,K.Pc,X.aw,p.e,C.Bz.forChild([{path:"",component:h.F}])]})}return Le})()},8767:(zn,wt,S)=>{"use strict";S.d(wt,{F:()=>Te});var h=S(5861),p=S(9127),X=S(6470),a=S(8564),j=S(6728),K=S(3999),C=S(6800),oe=S(6814),_e=S(6223);function Le(ye,De){if(1&ye){const me=a.EpF();a.ynx(0),a.TgZ(1,"p",13),a._uU(2," Sign in using your Open Charge Map account. "),a.qZA(),a.TgZ(3,"ion-list")(4,"ion-item")(5,"ion-label",14),a._uU(6,"Email"),a.qZA(),a.TgZ(7,"ion-input",15),a.NdJ("ngModelChange",function(Ce){a.CHM(me);const de=a.oxw();return a.KtG(de.email=Ce)}),a.qZA()(),a.TgZ(8,"ion-item")(9,"ion-label",14),a._uU(10,"Password"),a.qZA(),a.TgZ(11,"ion-input",16),a.NdJ("ngModelChange",function(Ce){a.CHM(me);const de=a.oxw();return a.KtG(de.password=Ce)}),a.qZA()()(),a.TgZ(12,"p")(13,"a",8),a.NdJ("click",function(){a.CHM(me);const Ce=a.oxw();return a.KtG(Ce.appManager.launchWebPage("https://openchargemap.org/site/loginprovider/passwordreset"))}),a._uU(14,"Reset your password"),a.qZA()(),a.BQk()}if(2&ye){const me=a.oxw();a.xp6(7),a.Q6J("ngModel",me.email),a.xp6(4),a.Q6J("ngModel",me.password)}}function ee(ye,De){if(1&ye){const me=a.EpF();a.ynx(0),a.TgZ(1,"p",13),a._uU(2," Create a new Open Charge Map account. "),a.qZA(),a.TgZ(3,"ion-list")(4,"ion-item")(5,"ion-label",14),a._uU(6,"Email"),a.qZA(),a.TgZ(7,"ion-input",15),a.NdJ("ngModelChange",function(Ce){a.CHM(me);const de=a.oxw();return a.KtG(de.email=Ce)}),a.qZA()(),a.TgZ(8,"ion-item")(9,"ion-label",14),a._uU(10,"Display Name or Nickname"),a.qZA(),a.TgZ(11,"ion-input",15),a.NdJ("ngModelChange",function(Ce){a.CHM(me);const de=a.oxw();return a.KtG(de.username=Ce)}),a.qZA()(),a.TgZ(12,"ion-item")(13,"ion-label",14),a._uU(14,"Password"),a.qZA(),a.TgZ(15,"ion-input",16),a.NdJ("ngModelChange",function(Ce){a.CHM(me);const de=a.oxw();return a.KtG(de.password=Ce)}),a.qZA()(),a.TgZ(16,"ion-item")(17,"ion-label",14),a._uU(18,"Confirm Password"),a.qZA(),a.TgZ(19,"ion-input",16),a.NdJ("ngModelChange",function(Ce){a.CHM(me);const de=a.oxw();return a.KtG(de.confirmpassword=Ce)}),a.qZA()()(),a.BQk()}if(2&ye){const me=a.oxw();a.xp6(7),a.Q6J("ngModel",me.email),a.xp6(4),a.Q6J("ngModel",me.username),a.xp6(4),a.Q6J("ngModel",me.password),a.xp6(4),a.Q6J("ngModel",me.confirmpassword)}}let Te=(()=>{class ye{appManager;modalController;translate;alertController;loadingController;logging;router;location;email;password;username;confirmpassword;mode="signin";constructor(me,Ye,Ce,de,Pe,Be,Ne,Ae){this.appManager=me,this.modalController=Ye,this.translate=Ce,this.alertController=de,this.loadingController=Pe,this.logging=Be,this.router=Ne,this.location=Ae,this.email=""}cancelSignIn(){this.modalController.dismiss()}performRegister(){var me=this;return(0,h.Z)(function*(){if(me.password!=me.confirmpassword)return void alert("Your password and the confirmed password do not match, please try again.");if(me.password.length<6)return void alert("Your password should be at least 6 characters.");const Ye=yield me.loadingController.create({message:"Registering .."});yield Ye.present();let Ce=!1;try{yield me.appManager.api.performRegister(me.username,me.email,me.password),Ye.dismiss(),localStorage.setItem("authResponse",JSON.stringify(me.appManager.api.authResponse)),me.appManager.isUserAuthenticated(!0),me.modalController.dismiss(),me.appManager.analytics.appEvent("Profile","SignedIn")}catch(de){Ce=!0,Ye.dismiss(),yield(yield me.alertController.create({header:"Open Charge Map",subHeader:"Email or Password not recognised",buttons:["Ok"]})).present(),me.logging.log("Error logging in:"+de)}})()}performSignIn(){var me=this;return(0,h.Z)(function*(){if("register"==me.mode)return me.performRegister();const Ye=yield me.loadingController.create({message:"Signing In.."});yield Ye.present();let Ce=!1;try{yield me.appManager.api.performSignIn(me.email,me.password),Ye.dismiss(),localStorage.setItem("authResponse",JSON.stringify(me.appManager.api.authResponse)),me.appManager.isUserAuthenticated(!0),me.modalController.dismiss(),me.appManager.analytics.appEvent("Profile","SignedIn")}catch(de){Ce=!0,Ye.dismiss(),yield(yield me.alertController.create({header:"Open Charge Map",subHeader:"Email or Password not recognised",buttons:["Ok"]})).present(),me.logging.log("Error logging in:"+de)}})()}static \u0275fac=function(Ye){return new(Ye||ye)(a.Y36(X.c),a.Y36(j.IN),a.Y36(K.sK),a.Y36(j.Br),a.Y36(j.HT),a.Y36(p.z),a.Y36(C.F0),a.Y36(oe.Ye))};static \u0275cmp=a.Xpm({type:ye,selectors:[["ng-component"]],decls:28,vars:9,consts:[[1,"signin-page","ion-padding"],["item-left",""],["src","assets/images/icons/branding/AppIcon_128x128.png"],[3,"ngModel","ngModelChange"],["value","signin"],["value","register"],[4,"ngIf"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["type","submit","color","primary",3,"click"],["name","log-in","slot","start"],[1,"ion-padding"],["position","floating"],["type","text",3,"ngModel","ngModelChange"],["type","password",3,"ngModel","ngModelChange"]],template:function(Ye,Ce){1&Ye&&(a.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),a._uU(3),a.ALo(4,"translate"),a.qZA()()(),a.TgZ(5,"ion-content",0)(6,"ion-avatar",1),a._UZ(7,"img",2),a.qZA(),a.TgZ(8,"ion-segment",3),a.NdJ("ngModelChange",function(Pe){return Ce.mode=Pe}),a.TgZ(9,"ion-segment-button",4)(10,"ion-label"),a._uU(11,"Sign In"),a.qZA()(),a.TgZ(12,"ion-segment-button",5)(13,"ion-label"),a._uU(14,"Create Account"),a.qZA()()(),a.YNc(15,Le,15,2,"ng-container",6)(16,ee,20,4,"ng-container",6),a.qZA(),a.TgZ(17,"ion-footer")(18,"ion-toolbar")(19,"ion-buttons",7)(20,"ion-button",8),a.NdJ("click",function(){return Ce.cancelSignIn()}),a._UZ(21,"ion-icon",9),a._uU(22," Cancel"),a.qZA()(),a.TgZ(23,"ion-buttons",10)(24,"ion-button",11),a.NdJ("click",function(){return Ce.performSignIn()}),a._UZ(25,"ion-icon",12),a._uU(26),a.ALo(27,"translate"),a.qZA()()()()),2&Ye&&(a.xp6(3),a.hij(" ",a.lcZ(4,5,"ocm.general.signIn")," "),a.xp6(5),a.Q6J("ngModel",Ce.mode),a.xp6(7),a.Q6J("ngIf","signin"==Ce.mode),a.xp6(1),a.Q6J("ngIf","register"==Ce.mode),a.xp6(10),a.hij(" ",a.lcZ(27,7,"ocm.general.signIn"),""))},dependencies:[oe.O5,_e.JJ,_e.On,j.BJ,j.YG,j.Sm,j.W2,j.fr,j.Gu,j.gu,j.pK,j.Ie,j.Q$,j.q_,j.cJ,j.GO,j.wd,j.sr,j.QI,j.j9,K.X$],encapsulation:2})}return ye})()},439:(zn,wt,S)=>{"use strict";S.d(wt,{l:()=>oe});var h=S(5861),p=S(9127),X=S(9159),a=S(7518),j=S(9862),K=S(553),C=S(8564);let oe=(()=>{class _e{http;refData;logging;serviceBase="https://api.openchargemap.io";serviceBaseURL=this.serviceBase+"/v4";hasAuthorizationError=!1;ATTRIBUTION_METADATAFIELDID=4;authResponse;clientName="ocm.api.default";authorizationErrorCallback;generalErrorCallback;allowMirror=!1;lastPOIApiCallURL="";constructor(ee,Te,ye){this.http=ee,this.refData=Te,this.logging=ye,this.serviceBaseURL=K.N.apiBase+"/v3"}getNumberListString(ee){let Te="";for(let ye=0;ye<ee.length;ye++)Te+=ee[ye],ye<ee.length&&(Te+=",");return Te}fetchPOIListByParam(ee){var Te=this;return(0,h.Z)(function*(){const ye=Te.serviceBaseURL+"/poi/?client="+Te.clientName+(Te.allowMirror?" &allowmirror=true":"")+"&verbose=false&output=json";ee.compact=!0;let De="";null!=ee.countryCode&&(De+="&countrycode="+ee.countryCode),null!=ee.latitude&&(De+="&latitude="+ee.latitude),null!=ee.longitude&&(De+="&longitude="+ee.longitude),null!=ee.distance&&(De+="&distance="+ee.distance),null!=ee.distanceUnit&&(De+="&distanceunit="+ee.distanceUnit),null!=ee.includeComments&&(De+="&includecomments="+ee.includeComments),null!=ee.maxResults&&(De+="&maxresults="+ee.maxResults),null!=ee.countryIdList&&(De+="&countryid="+Te.getNumberListString(ee.countryIdList)),null!=ee.levelIdList&&(De+="&levelid="+Te.getNumberListString(ee.levelIdList)),null!=ee.connectionTypeIdList&&ee.connectionTypeIdList.length>0&&(De+="&connectiontypeid="+Te.getNumberListString(ee.connectionTypeIdList)),null!=ee.operatorIdList&&ee.operatorIdList.length>0&&(De+="&operatorid="+Te.getNumberListString(ee.operatorIdList)),null!=ee.usageTypeIdList&&ee.usageTypeIdList.length>0&&(De+="&usagetypeid="+Te.getNumberListString(ee.usageTypeIdList)),null!=ee.statusTypeIdList&&ee.statusTypeIdList.length>0&&(De+="&statustypeid="+Te.getNumberListString(ee.statusTypeIdList)),null!=ee.locationTitle&&(De+="&locationtitle="+ee.locationTitle),null!=ee.minPowerKW&&ee.minPowerKW>0&&(De+="&minpowerkw="+ee.minPowerKW),null!=ee.maxPowerKW&&ee.maxPowerKW>0&&(De+="&maxpowerkw="+ee.maxPowerKW),null!=ee.submissionStatusTypeIdList&&(De+="&submissionstatustypeid="+Te.getNumberListString(ee.submissionStatusTypeIdList)),null!=ee.poiIdList&&ee.poiIdList.length>0&&(De+="&chargepointid="+Te.getNumberListString(ee.poiIdList)),0==ee.enableCaching&&(De+="&enablecaching=false"),null!=ee.compact&&(De+="&compact="+ee.compact),ee.levelOfDetail>1&&(De+="&levelofdetail="+ee.levelOfDetail),null!=ee.polyline&&(De+="&polyline="+ee.polyline),null!=ee.boundingbox&&(De+="&boundingbox="+ee.boundingbox),null!=ee.additionalParams&&(De+="&"+ee.additionalParams);const me=ye+De;if(Te.lastPOIApiCallURL===me&&0!=ee.enableCaching)return Te.logging.log("Skipped API call due to same query being repeated."),[];Te.lastPOIApiCallURL=me,Te.logging.log("API Call:"+me,p.i.VERBOSE);try{let Ye=yield Te.http.get(me,Te.getHttpRequestOptions()).toPromise();return Te.refData.hydrateCompactPOIList(Ye)}catch(Ye){const Ce=Ye.message||"Could not fetch POI list from server.";throw Te.logging.log("API Client: "+JSON.stringify(Ye),p.i.ERROR),Ce}})()}getHttpRequestOptions(ee=!0){let Te=new j.WM;return ee&&(Te=Te.append("Content-Type","application/json")),this.authResponse&&this.authResponse.Data&&this.authResponse.Data.access_token&&(Te=Te.append("Authorization","Bearer "+this.authResponse.Data.access_token)),Te=Te.append("X-API-Key",K.N.apiKey),{headers:Te}}fetchCoreReferenceData(ee){let Te=this.serviceBaseURL+"/referencedata/?client="+this.clientName+"&output=json"+(this.allowMirror?"&allowmirror=true":"")+"&verbose=false&compact=true";return null!=ee&&null!=ee.CountryIds&&(Te+="&countryid="+this.getNumberListString(ee.CountryIds)),this.logging.log("API Call:"+Te,p.i.VERBOSE),this.http.get(Te,this.getHttpRequestOptions())}performSignIn(ee,Te){return this.http.post(this.serviceBaseURL+"/profile/authenticate/",JSON.stringify({emailaddress:ee,password:Te}),this.getHttpRequestOptions()).toPromise().then(me=>(this.authResponse=me,this.authResponse))}performRegister(ee,Te,ye){return this.http.post(this.serviceBaseURL+"/profile/register/",JSON.stringify({username:ee,emailaddress:Te,password:ye}),this.getHttpRequestOptions()).toPromise().then(Ye=>(this.authResponse=Ye,this.authResponse))}performSubmission(ee,Te){return ee===a.qO.POI?this.submitPOI(Te):ee===a.qO.Comment?this.submitUserComment(Te):ee===a.qO.Media?this.submitMediaItem(Te):void 0}submitUserComment(ee){const Te=JSON.stringify(ee);return this.logging.log("[api] Submitting user comment"),this.http.post(this.serviceBaseURL+"/comment/",Te,this.getHttpRequestOptions()).toPromise()}submitMediaItem(ee){const Te=JSON.stringify(ee);return this.http.post(this.serviceBaseURL+"/mediaitem/",Te,this.getHttpRequestOptions()).toPromise()}submitPOI(ee){const Te=JSON.stringify(ee);return this.http.post(this.serviceBaseURL+"/poi/",Te,this.getHttpRequestOptions()).toPromise()}getPanoramioLocationPhotos(ee){return new Promise(Te=>{const De="https://www.panoramio.com/map/get_panoramas.php?set=public&from=0&to=2&minx="+(ee.longitude-.001)+"&miny="+(ee.latitude-.001)+"&maxx="+(ee.longitude+.001)+"maxy="+(ee.latitude+.001)+"&size=medium&mapfilter=true&callback=?";return console.log(De),this.http.get(De).toPromise()})}fetchReverseGeocodeResult(ee,Te){return this.http.get(this.serviceBaseURL+"/geocode/?client="+this.clientName+"&output=json&camelcase=false&latitude="+ee+"&longitude="+Te,this.getHttpRequestOptions()).toPromise()}isLocalStorageAvailable(){return typeof window.localStorage<"u"}setCachedDataObject(ee,Te){this.isLocalStorageAvailable()&&(typeof Te>"u"&&(Te=null),null===Te?localStorage.removeItem(ee):localStorage.setItem(ee,JSON.stringify(Te)))}getCachedDataObject(ee){if(this.isLocalStorageAvailable()){const Te=localStorage.getItem(ee);if(null!=Te&&Te.length>0)return JSON.parse(Te)}return null}static \u0275fac=function(Te){return new(Te||_e)(C.LFG(j.eN),C.LFG(X.W),C.LFG(p.z))};static \u0275prov=C.Yz7({token:_e,factory:_e.\u0275fac,providedIn:"root"})}return _e})()},3294:(zn,wt,S)=>{"use strict";S.d(wt,{c:()=>j});var h=S(5861),p=S(9127),X=S(8564),a=S(5472);let j=(()=>{class K{logger;platform;isCordova=!1;ga=null;constructor(oe,_e){this.logger=oe,this.platform=_e,this.isCordova=!(!_e.is("cordova")&&!_e.is("capacitor"))}init(oe){var _e=this;return(0,h.Z)(function*(){_e.isCordova&&_e.ga?yield _e.ga.startTrackerWithId(oe):_e.logger.log("Could not initialise analytics")})()}setAppVersion(oe){var _e=this;return(0,h.Z)(function*(){if(_e.isCordova&&_e.ga)return _e.ga.setAppVersion(oe);_e.logger.log(oe)})()}appEvent(oe,_e){var Le=this;return(0,h.Z)(function*(){if(Le.isCordova&&Le.ga)return Le.ga.trackEvent(oe,_e);Le.logger.log(_e)})()}viewEvent(oe){var _e=this;return(0,h.Z)(function*(){if(_e.isCordova&&_e.ga)return _e.ga.trackView(oe);_e.logger.log(oe)})()}static \u0275fac=function(_e){return new(_e||K)(X.LFG(p.z),X.LFG(a.t4))};static \u0275prov=X.Yz7({token:K,factory:K.\u0275fac,providedIn:"root"})}return K})()},6470:(zn,wt,S)=>{"use strict";S.d(wt,{c:()=>Ce});var h=S(5861),p=S(9127),X=S(439),a=S(7518),j=S(8564),K=S(5957);let C=(()=>{class de{events;isQueueProcessing;appManager;constructor(Be){this.events=Be,this.isQueueProcessing=!1}setAppManager(Be){this.appManager=Be}add(Be,Ne){let Ae=this.getQueueItems();Ae.push(new a.aX(Be,Ne)),this.saveQueueItems(Ae)}update(Be){let Ne=this.getQueueItems(),Ae=new Array;return Ne.forEach(Ge=>{Ae.push(Ge.ID==Be.ID?Be:Ge)}),Ae}processNextQueueItem(){let Be=this.getNextQueueItem();null!=Be&&null!=this.appManager&&this.appManager.api.performSubmission(Be.SubmissionType,Be.Data).then(()=>{Be.IsSubmitted=!0,Be.Attempts++,this.update(Be),this.clear()})}getNextQueueItem(){let Be=this.getQueueItems(),Ne=null;return Be.forEach(Ae=>{null==Ne&&!Ae.IsCancelled&&!Ae.IsInProgress&&!Ae.IsSubmitted&&(Ne=Ae)}),Ne}hasPendingItems(){let Be=!1;return this.getQueueItems().forEach(Ae=>{!Ae.IsFailure&&!Ae.IsCancelled&&!Ae.IsSubmitted&&(Be=!0)}),Be}isCompleted(){let Be=this.getQueueItems(),Ne=!0;return Be.forEach(Ae=>{(Ae.IsInProgress||Ae.IsFailure)&&(Ne=!1)}),Ne}clear(Be=!1){let Ne=this.getQueueItems(),Ae=new Array;Be||Ne.forEach(Ge=>{(Ge.IsInProgress||Ge.IsFailure)&&Ae.push(Ge)}),this.saveQueueItems(Ae)}saveQueueItems(Be){localStorage.setItem("submissionQueue",JSON.stringify(Be))}getQueueItems(){let Be=localStorage.getItem("submissionQueue");return null!=Be?JSON.parse(Be):new Array}static \u0275fac=function(Ne){return new(Ne||de)(j.LFG(K.z))};static \u0275prov=j.Yz7({token:de,factory:de.\u0275fac,providedIn:"root"})}return de})();var oe=S(9159),_e=S(989),Le=S(3294),ee=S(553),Te=S(9862),ye=S(5472),De=S(6728),me=S(3999),Ye=S(703);let Ce=(()=>{class de{http;events;api;submissionQueue;platform;referenceDataManager;journeyManager;translateService;toastController;loadingController;jwtHelper;logging;analytics;enableSubmissionQueue;searchSettings;platformMode;journeys;isDebugMode;clientWidth;clientHeight;isRequestInProgress=!1;title="Open Charge Map";_isUserAuthenticated=null;isEmbeddedMode=!1;isOffline=!1;constructor(Be,Ne,Ae,Ge,lt,ne,Ee,xe,je,Se,Ve,Xe,Ht){this.http=Be,this.events=Ne,this.api=Ae,this.submissionQueue=Ge,this.platform=lt,this.referenceDataManager=ne,this.journeyManager=Ee,this.translateService=xe,this.toastController=je,this.loadingController=Se,this.jwtHelper=Ve,this.logging=Xe,this.analytics=Ht,this.api.clientName="ocm.app.ionic."+ee.N.version,this.isDebugMode=!1,this.enableSubmissionQueue=!1,this.submissionQueue.setAppManager(this),this.platformMode=lt.is("cordova")?"cordova":"web",this.initAppManager(),this.searchSettings=new a.Nm,this.loadSearchSettings(),this.applyURLQueryStringOptions(),this.searchSettings.CheckForActiveFilters(),this.journeyManager.loadJourneys()}loadSearchSettings(){if(null!=localStorage.getItem("searchSettings")){this.searchSettings=new a.Nm;try{let Be=JSON.parse(localStorage.getItem("searchSettings"));Object.assign(this.searchSettings,Be)}catch{}}}savePushRegistration(Be){localStorage.setItem("_pushToken",Be.toString())}getPushRegistration(){localStorage.getItem("_pushToken")}getQueryVariable(Be){let Ae=window.location.search.substring(1).split("&");for(let Ge=0;Ge<Ae.length;Ge++){let lt=Ae[Ge].split("=");if(decodeURIComponent(lt[0])==Be)return lt[1].split(",").map(xe=>decodeURIComponent(xe))}return null}applyURLQueryStringOptions(){if(this.getQueryVariable("mode")&&"embedded"==this.getQueryVariable("mode")[0]&&(this.isEmbeddedMode=!0),this.getQueryVariable("operatorid")){let Be=this.getQueryVariable("operatorid");for(let Ne of Be)this.searchSettings.OperatorList.unshift(parseInt(Ne,10))}if(this.getQueryVariable("latitude")&&this.getQueryVariable("longitude")){let Be=this.getQueryVariable("latitude")[0],Ne=this.getQueryVariable("longitude")[0];this.searchSettings.StartSearchPosition=new a.wC(parseFloat(Be),parseFloat(Ne))}this.getQueryVariable("title")&&(this.title=this.getQueryVariable("title")[0]),this.getQueryVariable("languagecode")&&this.setLanguage(this.getQueryVariable("languagecode")[0]),this.getQueryVariable("id")&&(this.searchSettings.StartViewPoiId=this.getQueryVariable("id")[0])}saveSearchSettings(){this.searchSettings.CheckForActiveFilters(),localStorage.setItem("searchSettings",JSON.stringify(this.searchSettings))}getLanguages(){return[{code:"ar",title:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629 / Arabic"},{code:"bg",title:"Bulgarian / \u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438"},{code:"cs",title:"Czech / \u010ce\u0161tina"},{code:"de",title:"German / Deutsch"},{code:"el",title:"Greek / \u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ae"},{code:"en",title:"English"},{code:"es",title:"Spanish / Espa\xf1ol"},{code:"et",title:"Estonian / Eesti"},{code:"fi",title:"Finnish / Suomi"},{code:"fr",title:"French / Fran\xe7ais"},{code:"fy",title:"West Frisian / Frysk"},{code:"hu",title:"Hungarian / Magyar"},{code:"it",title:"Italian / Italiano"},{code:"ja",title:"Japanese / \u65e5\u672c\u8a9e"},{code:"lt",title:"Lithuanian / Lietuvi\u0173"},{code:"nl",title:"Dutch / Nederlands"},{code:"pt",title:"Portuguese / portugu\xeas"},{code:"ro",title:"Romanian / Rom\xe2n\u0103"},{code:"ru",title:"Russian / P\u0443\u0441\u0441\u043a\u0438\u0439"},{code:"sk",title:"Slovak / Sloven\u010dina"},{code:"tr",title:"Turkish / T\xfcrk\xe7e"},{code:"zh",title:"Chinese / \u4e2d\u56fd\u7684"}]}setLanguage(Be){(null==Be||""==Be)&&(Be="en"),this.logging.log("Changing language: "+Be),this.translateService.use(Be)}initAppManager(){this.initAuthFromStorage(),this.isUserAuthenticated(!0)&&this.enableSubmissionQueue&&null!=this.submissionQueue&&this.submissionQueue.hasPendingItems()&&this.submissionQueue.processNextQueueItem()}initAuthFromStorage(){let Be=localStorage.getItem("authResponse");if(null!=Be){let Ne=JSON.parse(Be);null!=Ne?.Data&&null!=Ne?.Data?.access_token?(this.jwtHelper.decodeToken(Ne.Data.access_token),this.jwtHelper.isTokenExpired(Ne.Data.access_token)?localStorage.removeItem("authResponse"):(this.api.authResponse=Ne,this.logging.log("User has valid auth token in local storage",p.i.VERBOSE))):(this.logging.log("User has invalid auth token in local storage",p.i.VERBOSE),localStorage.removeItem("authResponse"))}}isUserAuthenticated(Be=!1){return!1===Be&&null!=this._isUserAuthenticated||(this._isUserAuthenticated=!1,null!=this.api.authResponse&&(this.jwtHelper.isTokenExpired(this.api.authResponse.Data.access_token)||(this._isUserAuthenticated=!0))),this._isUserAuthenticated}getCurrentAuthToken(){return null!=this.api.authResponse?this.api.authResponse.Data.access_token:null}getUserProfile(){return null!=this.api.authResponse?this.api.authResponse.Data.UserProfile:null}signOutCurrentUser(){localStorage.removeItem("authResponse"),this.api.authResponse=null,this._isUserAuthenticated=!1}submitComment(Be){if(!this.enableSubmissionQueue)return this.api.performSubmission(a.qO.Comment,Be);this.submissionQueue.add(a.qO.Comment,Be),this.submissionQueue.processNextQueueItem()}submitMediaItem(Be){if(!this.enableSubmissionQueue)return this.api.performSubmission(a.qO.Media,Be);this.submissionQueue.add(a.qO.Media,Be),this.submissionQueue.processNextQueueItem()}submitPOI(Be){if(!this.enableSubmissionQueue)return this.api.performSubmission(a.qO.POI,Be);this.submissionQueue.add(a.qO.POI,Be),this.submissionQueue.processNextQueueItem()}showToastNotification(Be){var Ne=this;return(0,h.Z)(function*(){yield(yield Ne.toastController.create({message:Be,duration:3e3})).present()})()}showLoadingProgress(Be){var Ne=this;return(0,h.Z)(function*(){yield(yield Ne.loadingController.create({message:Be})).present()})()}dismissLoadingProgress(){var Be=this;return(0,h.Z)(function*(){return Be.loadingController.dismiss()})()}launchOCMWebPage(Be){this.isUserAuthenticated(!0)&&(-1===Be.indexOf("?")&&(Be+="?"),Be+="&auth="+this.getCurrentAuthToken()),Be="https://openchargemap.org/site"+Be,window.open(Be,"_system")}launchWebPage(Be){window.open(Be,"_system")}isPlatform(Be){return this.platform.is(Be)}static \u0275fac=function(Ne){return new(Ne||de)(j.LFG(Te.eN),j.LFG(K.z),j.LFG(X.l),j.LFG(C),j.LFG(ye.t4),j.LFG(oe.W),j.LFG(_e.i),j.LFG(me.sK),j.LFG(De.yF),j.LFG(De.HT),j.LFG(Ye.N0),j.LFG(p.z),j.LFG(Le.c))};static \u0275prov=j.Yz7({token:de,factory:de.\u0275fac,providedIn:"root"})}return de})()},5957:(zn,wt,S)=>{"use strict";S.d(wt,{z:()=>p});var h=S(8564);let p=(()=>{class X{c=new Map;constructor(){}subscribe(j,...K){let C=this.c.get(j);C||this.c.set(j,C=[]),C.push(...K)}unsubscribe(j,K){if(!K)return this.c.delete(j);const C=this.c.get(j);if(!C)return!1;const oe=C.indexOf(K);return!(oe<0||(C.splice(oe,1),0===C.length&&this.c.delete(j),0))}publish(j,...K){const C=this.c.get(j);return C?C.map(oe=>{try{return oe(...K)}catch(_e){return console.error(_e),null}}):null}static \u0275fac=function(K){return new(K||X)};static \u0275prov=h.Yz7({token:X,factory:X.\u0275fac,providedIn:"root"})}return X})()},989:(zn,wt,S)=>{"use strict";S.d(wt,{i:()=>K});var h=S(9127),p=S(439),X=S(4669),a=S(7518),j=S(8564);let K=(()=>{class C{api;poiManager;logging;journeys;favourites;routePolyline;constructor(_e,Le,ee){this.api=_e,this.poiManager=Le,this.logging=ee,this.journeys=[],this.favourites=[]}loadJourneys(){let _e=localStorage.getItem("journeys");if(null!=_e&&(this.journeys=JSON.parse(_e)),null!=this.journeys)for(let Le of this.journeys)this.fetchAllJourneyPOIDetails(Le)}fetchAllJourneyPOIDetails(_e){this.logging.log("Journeys - fetching poi details for Journey "+_e.Title);let Le=new a.be;Le.poiIdList=[];for(let ee of _e.Stages)for(let Te of ee.WayPoints)for(let ye of Te.PoiIDs)Le.poiIdList.push(ye);this.api.fetchPOIListByParam(Le).then(ee=>{for(let Te of ee)this.updateStoredPOI(Te)})}updateStoredPOI(_e){if(this.journeys.forEach(Le=>{Le.Stages.forEach(ee=>{ee.WayPoints.forEach(Te=>{Te.PoiIDs.forEach(ye=>{if(ye==_e.ID)if(null==Te.PoiList){Te.PoiList=[];let De=new a.Qp("charging",1);De.Poi=_e,De.PoiID=_e.ID,Te.PoiList.push(De)}else for(let De of Te.PoiList)De.PoiID==_e.ID&&(De.Poi=_e)})})})}),null!=this.favourites)for(let Le of this.favourites)"charging"==Le.Type&&Le.PoiID==_e.ID&&(Le.Poi=_e)}saveJourneys(){let _e=JSON.parse(JSON.stringify(this.journeys));for(let ee of _e)for(const Te of ee.Stages)for(let ye of Te.WayPoints)for(let De of ye.PoiList)De.Poi=null,De.Photos=null;const Le=JSON.stringify(_e);localStorage.setItem("journeys",Le)}addJourney(_e,Le){let ee=new a.vw;ee.Title="Stage 1",null!=Le&&ee.WayPoints.push(Le),_e.Stages.push(ee),this.journeys.push(_e)}deleteJourney(_e){this.journeys=this.journeys.filter(Le=>Le.ID!=_e),this.saveJourneys()}getJourney(_e){let Le=this.journeys.filter(ee=>ee.ID==_e);return Le.length>0?Le[0]:null}getJourneyStages(_e){return this.getJourney(_e).Stages}addJourneyWaypoint(_e,Le,ee){let Te=this.getJourney(_e);if(null==Le){let ye=new a.vw;ye.Title="Stage "+(Te.Stages.length+1),ye.WayPoints.push(ee),Te.Stages.push(ye)}else{let ye=Te.Stages[Le];null==ye.WayPoints&&(ye.WayPoints=[]),ye.WayPoints.push(ee)}}addJourneyStage(_e,Le){return this.getJourney(_e).Stages.push(Le)-1}setupTestJourneys(){this.journeys=[];let _e=new a.fw;_e.Title="New York to Brooklyn",_e.Notes="A little jaunt to Brooklyn",_e.Stages=[];let Le=new a.vw,ee=new a.kA;ee.Notes="Starting point",ee.Position=new a.wC(40,1.2),ee.Title="Start",Le.WayPoints.push(ee);let Te=new a.kA;Te.Notes="Middle point",Te.Position=new a.wC(40,1.33),Te.Title="Middle",Le.WayPoints.push(Te);let ye=new a.kA;ye.Notes="End point",ye.Position=new a.wC(40,1.33),ye.Title="End",Le.WayPoints.push(ye),_e.Stages.push(Le),this.journeys.push(_e);let De=new a.fw;De.Title="Aberdeen to London",De.Notes="Roadtrip",De.Stages=[],this.journeys.push(De)}calculateEnergyConsumptionkWh(_e,Le,ee=0,Te){return _e*Te}setRoutePolyline(_e){this.routePolyline=_e}getRoutePolyline(){return this.routePolyline}static \u0275fac=function(Le){return new(Le||C)(j.LFG(p.l),j.LFG(X.R),j.LFG(h.z))};static \u0275prov=j.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"})}return C})()},9127:(zn,wt,S)=>{"use strict";S.d(wt,{i:()=>X,z:()=>a});var h=S(553),p=S(8564),X=function(j){return j[j.VERBOSE=0]="VERBOSE",j[j.INFO=1]="INFO",j[j.WARNING=2]="WARNING",j[j.ERROR=3]="ERROR",j}(X||{});let a=(()=>{class j{logLevel;constructor(){this.logLevel=X.VERBOSE,h.N.production&&(this.logLevel=X.INFO)}log(C,oe=X.VERBOSE){console&&console.log&&oe>=this.logLevel&&console.log("["+X[oe]+"] {"+(new Date).toLocaleTimeString()+"} "+C)}static \u0275fac=function(oe){return new(oe||j)};static \u0275prov=p.Yz7({token:j,factory:j.\u0275fac,providedIn:"root"})}return j})()},4669:(zn,wt,S)=>{"use strict";S.d(wt,{R:()=>C});var h=S(5861),p=S(9127),X=S(439),a=S(3294),j=S(8564),K=S(5957);let C=(()=>{class oe{api;events;logging;analytics;poiList;isRequestInProgress=!1;constructor(Le,ee,Te,ye){this.api=Le,this.events=ee,this.logging=Te,this.analytics=ye}refreshPOIList(Le){var ee=this;return(0,h.Z)(function*(){try{return ee.poiList=yield ee.fetchPOIList(Le),ee.events.publish("ocm:poiList:updated"),ee.analytics.appEvent("Search","Fetched Results"),ee.poiList.length}catch{return 0}})()}fetchPOIList(Le){var ee=this;return(0,h.Z)(function*(){ee.isRequestInProgress=!0;try{let Te=yield ee.api.fetchPOIListByParam(Le);return ee.isRequestInProgress=!1,Te&&Te.length&&ee.logging.log("fetched POI list ["+Te.length+"]"),Te}catch{return ee.isRequestInProgress=!1,[]}})()}clearResults(){this.poiList=[],this.events.publish("ocm:poiList:cleared"),this.logging.log("clearing results after settings change",p.i.VERBOSE)}getPOIById(Le,ee=!1,Te=!1){var ye=this;return(0,h.Z)(function*(){if(!Te&&null!=ye.poiList){const Ye=ye.poiList.find(Ce=>Ce.ID==Le);if(Ye)return Ye}const De={poiIdList:[Le],enableCaching:!Te,includeComments:!0},me=yield ye.api.fetchPOIListByParam(De);return me&&me.length>0?(ye.poiList&&me[0].ID==Le&&(ye.poiList=ye.poiList.filter(Ye=>Ye.ID!=Le),ye.poiList.push(me[0]),ye.logging.log("POI refreshed in cache "+Le)),me[0]):null})()}static \u0275fac=function(ee){return new(ee||oe)(j.LFG(X.l),j.LFG(K.z),j.LFG(p.z),j.LFG(a.c))};static \u0275prov=j.Yz7({token:oe,factory:oe.\u0275fac,providedIn:"root"})}return oe})()},9159:(zn,wt,S)=>{"use strict";S.d(wt,{W:()=>j});var h=S(5861),p=S(9127),X=S(8564),a=S(9862);let j=(()=>{class K{http;logging;referenceData;filteredReferenceData;constructor(oe,_e){this.http=oe,this.logging=_e,this.loadCachedRefData()}refreshReferenceData(oe){var _e=this;return(0,h.Z)(function*(){try{const Le=yield oe.fetchCoreReferenceData(null).toPromise();return _e.setCoreReferenceData(Le),_e.setFilteredReferenceData(Le),_e.logging.log("Got refreshed core ref data.",p.i.VERBOSE),_e.sortCoreReferenceData(),_e.cacheCurrentRefData(),!0}catch(Le){return _e.logging.log("Error fetching core ref data:"+Le),!1}})()}refreshFilteredReferenceData(oe,_e){oe.fetchCoreReferenceData(_e).subscribe(Le=>{this.setFilteredReferenceData(Le),this.sortCoreReferenceData(),this.logging.log("Got refreshed filtered reference data.",p.i.VERBOSE)},Le=>{this.logging.log("Error fetching filtered reference data:"+Le)})}setCoreReferenceData(oe){this.referenceData=oe}setFilteredReferenceData(oe){this.filteredReferenceData=oe}referenceDataLoaded(){return null!=this.referenceData}getCountries(oe=!1){return 1==oe?this.filteredReferenceData.Countries:this.referenceData.Countries}getCountryByID(oe){return this.getRefDataByID(this.referenceData.Countries,oe)}getConnectionTypes(oe=!1){return 1==oe?this.filteredReferenceData.ConnectionTypes:this.referenceData.ConnectionTypes}getConnectionTypeByID(oe){return this.getRefDataByID(this.referenceData.ConnectionTypes,oe)}getUsageTypes(oe=!1){return 1==oe?this.filteredReferenceData.UsageTypes:this.referenceData.UsageTypes.filter(_e=>_e.ID>0)}getUsageTypeByID(oe){return this.getRefDataByID(this.referenceData.UsageTypes,oe)}getStatusTypes(oe=!1){return 1==oe?this.filteredReferenceData.StatusTypes:this.referenceData.StatusTypes.filter(_e=>_e.ID>0)}getStatusTypeByID(oe){return this.getRefDataByID(this.referenceData.StatusTypes,oe)}getNetworkOperators(oe=!1){return 1==oe?this.filteredReferenceData.Operators:this.referenceData.Operators}getNetworkOperatorByID(oe){return this.getRefDataByID(this.referenceData.Operators,oe)}getDataProviders(oe=!1){return 1==oe?this.filteredReferenceData.DataProviders:this.referenceData.DataProviders}getDataProviderByID(oe){return this.getRefDataByID(this.referenceData.DataProviders,oe)}getCheckinStatusTypes(oe=!1,_e=!0){let Le=null;return Le=1==oe?this.filteredReferenceData.CheckinStatusTypes:this.referenceData.CheckinStatusTypes,_e&&(Le=Le.filter(ee=>!1===ee.IsAutomatedCheckin)),Le}getCheckinStatusTypeByID(oe){return this.getRefDataByID(this.referenceData.CheckinStatusTypes,oe)}getCommentTypes(oe=!1,_e=!0){let Le;return Le=1==oe?this.filteredReferenceData.UserCommentTypes:this.referenceData.UserCommentTypes,_e&&(Le=Le.filter(ee=>100!==ee.ID&&110!==ee.ID)),Le}getCommentTypeByID(oe){return this.getRefDataByID(this.referenceData.UserCommentTypes,oe)}getSubmissionStatusTypes(oe=!1){return 1==oe?this.filteredReferenceData.SubmissionStatusTypes:this.referenceData.SubmissionStatusTypes}getSubmissionStatusTypesByID(oe){return this.getRefDataByID(this.referenceData.SubmissionStatusTypes,oe)}getChargingLevelTypes(oe=!1){return 1==oe?this.filteredReferenceData.ChargerTypes:this.referenceData.ChargerTypes}getChargingLevelTypeByID(oe){return this.getRefDataByID(this.referenceData.ChargerTypes,oe)}getOutputCurrentTypes(oe=!1){return oe?this.referenceData.CurrentTypes:this.filteredReferenceData.CurrentTypes}getOutputCurrentTypeByID(oe){return this.getRefDataByID(this.referenceData.CurrentTypes,oe)}loadCachedRefData(){const oe=localStorage.getItem("referenceData");if(null==oe)this.http.get("./assets/data/CoreReferenceData.json").subscribe(_e=>{this.logging.log("Using bundled reference data as cached ref data."),this.setCoreReferenceData(_e),this.setFilteredReferenceData(_e)});else{let _e=JSON.parse(oe);this.setCoreReferenceData(_e)}this.setFilteredReferenceData(this.referenceData)}cacheCurrentRefData(){null!=this.referenceData&&(this.referenceData.CacheDate=new Date,localStorage.setItem("referenceData",JSON.stringify(this.referenceData)))}getRefDataByID(oe,_e){if(""!==_e&&(_e=parseInt(_e,10)),null!=oe)for(let Le=0;Le<oe.length;Le++)if(oe[Le].ID===_e)return oe[Le];return null}sortCoreReferenceData(){this.sortReferenceData(this.referenceData.ConnectionTypes),this.sortReferenceData(this.referenceData.Countries),this.sortReferenceData(this.referenceData.Operators),this.sortReferenceData(this.referenceData.DataProviders),this.sortReferenceData(this.referenceData.UsageTypes),this.sortReferenceData(this.referenceData.StatusTypes),this.sortReferenceData(this.referenceData.CheckinStatusTypes),this.sortReferenceData(this.referenceData.SubmissionStatusTypes),this.filteredReferenceData&&(this.sortReferenceData(this.filteredReferenceData.ConnectionTypes),this.sortReferenceData(this.filteredReferenceData.Operators))}sortReferenceData(oe){oe.sort(this.sortListByTitle)}sortListByTitle(oe,_e){return oe.Title<_e.Title?-1:oe.Title>_e.Title?1:0}getMetadataValueByMetadataFieldID(oe,_e){if(""!==_e&&(_e=parseInt(_e,10)),null!=oe)for(let Le=0;Le<oe.length;Le++)if(oe[Le].ID===_e)return oe[Le];return null}hydrateCompactPOI(oe,_e=!1){const Le=this;if(null!=oe.DataProviderID&&(_e||null==oe.DataProvider)&&(oe.DataProvider=Le.getDataProviderByID(oe.DataProviderID)),null!=oe.OperatorID&&(_e||null==oe.OperatorInfo)&&(oe.OperatorInfo=Le.getNetworkOperatorByID(oe.OperatorID)),null!=oe.UsageTypeID&&(_e||null==oe.UsageType)&&(oe.UsageType=Le.getUsageTypeByID(oe.UsageTypeID)),null!=oe.AddressInfo.CountryID&&(_e||null==oe.AddressInfo.Country)&&(oe.AddressInfo.Country=Le.getCountryByID(oe.AddressInfo.CountryID)),null!=oe.StatusTypeID&&(_e||null==oe.StatusType)&&(oe.StatusType=Le.getStatusTypeByID(oe.StatusTypeID)),null!=oe.SubmissionStatusTypeID&&(_e||null==oe.SubmissionStatusType)&&(oe.SubmissionStatusType=Le.getSubmissionStatusTypesByID(oe.SubmissionStatusTypeID)),null!=oe.Connections)for(let ee=0;ee<oe.Connections.length;ee++){const Te=oe.Connections[ee];null!=Te.ConnectionTypeID&&(_e||null==Te.ConnectionType)&&(Te.ConnectionType=Le.getConnectionTypeByID(Te.ConnectionTypeID)),null!=Te.LevelID&&(_e||null==Te.Level)&&(Te.Level=Le.getChargingLevelTypeByID(Te.LevelID)),null!=Te.CurrentTypeID&&(_e||null==Te.CurrentType)&&(Te.CurrentType=Le.getOutputCurrentTypeByID(Te.CurrentTypeID)),null!=Te.StatusTypeID&&(_e||null==Te.StatusType)&&(Te.StatusType=Le.getStatusTypeByID(Te.StatusTypeID)),oe.Connections[ee]=Te}if(null!=oe.UserComments)for(let ee=0;ee<oe.UserComments.length;ee++){const Te=oe.UserComments[ee];null!=Te.CommentTypeID&&(_e||null==Te.CommentType)&&(Te.CommentType=Le.getCommentTypeByID(Te.CommentTypeID)),null!=Te.CheckinStatusTypeID&&(_e||null==Te.CheckinStatusType)&&(Te.CheckinStatusType=Le.getCheckinStatusTypeByID(Te.CheckinStatusTypeID)),oe.UserComments[ee]=Te}return oe}hydrateCompactPOIList(oe){for(let _e=0;_e<oe.length;_e++)oe[_e]=this.hydrateCompactPOI(oe[_e]);return oe}static \u0275fac=function(_e){return new(_e||K)(X.LFG(a.eN),X.LFG(p.z))};static \u0275prov=X.Yz7({token:K,factory:K.\u0275fac,providedIn:"root"})}return K})()},1847:(zn,wt,S)=>{"use strict";S.d(wt,{v:()=>Ye});var h=S(9903),p=S(3955),X=S(866),a=S(9127),j=S(5861),K=S(5592),C=S(3052),oe=S(553),_e=S(7518);class Le{events;logging;mapAPIType;mapReady;providerError;mapCanvasID;map;markerList;polylinePath;mapkitUtils;constructor(de,Pe){this.events=de,this.logging=Pe,this.events=de,this.mapAPIType=p.b.MAPKIT_JS,this.mapReady=!1,this.markerList=new Map,this.mapkitUtils=new ee}initAPI(){mapkit&&mapkit.init({authorizationCallback:function(de){de(oe.N.mapKitToken)}})}disposeMap(){}initMap(de,Pe,Be){this.mapCanvasID=de;let Ne=!0;if(Ne=!(typeof mapkit>"u"),!Ne)return this.logging.log("Call to initMap before API is ready:"+p.b[this.mapAPIType],a.i.ERROR),this.mapReady=!1,!1;this.initAPI(),null==this.map&&(document.getElementById(de),this.map=new mapkit.Map(de),this.map.annotationForCluster=function(Ge){"poi"===Ge.clusteringIdentifier&&(Ge.title="Charging Location",Ge.subtitle=Ge.memberAnnotations.reduce((lt,ne)=>lt+ne.population,0))},this.mapReady=!0,mapkit.addEventListener("configuration-change",Ge=>{this.events.publish("ocm:mapping:ready")}),this.map.addEventListener("scroll-end",Ge=>{this.events.publish("ocm:mapping:dragend")}),this.map.addEventListener("zoom-end",Ge=>{this.events.publish("ocm:mapping:zoom")}))}clearMarkers(){null!=this.markerList&&this.markerList.forEach((de,Pe)=>{try{this.map.removeAnnotation(Pe)}catch{}}),this.markerList=new Map}showPOIListOnMap(de,Pe){let Ge=0,ne=0==this.markerList.size;if(null!=de){let xe=[];for(let je=0;je<de.length;je++)if(null!=de[je].AddressInfo&&null!=de[je].AddressInfo.Latitude&&null!=de[je].AddressInfo.Longitude){let Se=de[je],Ve=!0;if(null!=this.markerList&&this.markerList.has(Se.ID)&&(Ve=!1),Ve){let Xe=null;Xe=X.c.getIconForPOI(Se);let $t="OCM-"+Se.ID+": "+Se.AddressInfo.Title+":";null!=Se.UsageType&&($t+=" "+Se.UsageType.Title),null!=Se.StatusType&&($t+=" "+Se.StatusType.Title);const ke=new mapkit.Coordinate(Se.AddressInfo.Latitude,Se.AddressInfo.Longitude);let pe=new mapkit.ImageAnnotation(ke,{title:$t,size:{width:34,height:50},url:{1:Xe},clusteringIdentifier:"poi"});pe.poi=Se,pe.addEventListener("select",Oe=>{const ie=Oe.target.poi;this.events.publish("ocm:poi:selected",{poi:ie,poiId:ie.ID})}),this.markerList.set(Se.ID,pe),xe.push(pe),Ge++}}xe.length>0&&(this.map.addAnnotations(xe),ne&&this.map.showItems(xe,{animate:!0,padding:new mapkit.Padding(60,25,60,25)})),this.logging.log(Ge+" new map markers added out of a total "+this.markerList.size)}}refreshMapLayout(){null!=this.map&&setTimeout(()=>{this.logging.log("MapKit: refreshMapLayout",a.i.VERBOSE)},200)}setMapCenter(de,Pe){this.map&&(this.map.setCenterAnimated(new mapkit.Coordinate(de.coords.latitude,de.coords.longitude),!1),Pe&&this.setMapZoom(Pe))}getMapCenter(){return new K.y(Pe=>{if(null!=this.map){let Be=this.map.center;null!=Be&&(Pe.next(new C.jR(Be.latitude,Be.longitude)),Pe.complete())}})}setMapZoom(de){const Pe=Math.min(de,28),Be=this.mapkitUtils.deltaFromZoomLevel(this.map,this.map.center,Math.round(Pe)),Ne=new mapkit.CoordinateSpan(111*Be.latitudeDelta,111*Be.longitudeDelta),Ae=new mapkit.CoordinateRegion(this.map.center,Ne);this.map.setRegionAnimated(Ae)}getMapZoom(){return new K.y(Pe=>{this.logging.log("MapKit: getMapZoom not supported",a.i.VERBOSE),Pe.next(this.map._impl.zoomLevel),Pe.complete()})}setMapType(de){this.logging.log("MapKit: skipped setting Map Type :"+de)}getMapBounds(){return new K.y(Pe=>{let Be=new Array,Ne=this.map.region.toBoundingRegion();Be.push(new C.wC(Ne.southLatitude,Ne.westLongitude)),Be.push(new C.wC(Ne.northLatitude,Ne.eastLongitude)),Pe.next(Be),Pe.complete()})}moveToMapBounds(de){this.logging.log("MapKit: map bounds not implemented")}renderMap(de,Pe,Be){return document.getElementById(this.mapCanvasID).style.height=Pe+"px",this.mapReady&&this.showPOIListOnMap(de,Be),!0}renderPolyline(de){this.clearPolyline()}clearPolyline(){null!=this.polylinePath&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(de){return(0,j.Z)(function*(){let Pe=new mapkit.Search({getsUserLocation:!0});return new Promise(function(){var Be=(0,j.Z)(function*(Ne,Ae){let Ge=[];Pe.search(de,function(){var lt=(0,j.Z)(function*(ne,Ee){ne&&Ae(ne),Ge=[],Ee.places.map(xe=>{let je=new _e.nS;je.Title=xe.name,je.Address=xe.formattedAddress,je.Type="place",je.Location=new C.wC(xe.coordinate.latitude,xe.coordinate.longitude),Ge.push(je)}),Ne(Ge)});return function(ne,Ee){return lt.apply(this,arguments)}}())});return function(Ne,Ae){return Be.apply(this,arguments)}}())})()}addPOILayer(de){this.logging.log("Add POI Layer not implemented in this provider.")}}class ee{mercatorRadius=85445659.44705395;mercatorOffset=268435456;longitudeToPixelSpaceX(de){return Math.round(this.mercatorOffset+this.mercatorRadius*de*Math.PI/180)}latitudeToPixelSpaceY(de){return Math.round(this.mercatorOffset-this.mercatorRadius*Math.log((1+Math.sin(de*Math.PI/180))/(1-Math.sin(de*Math.PI/180)))/2)}pixelSpaceXToLongitude(de){return(Math.round(de)-this.mercatorOffset)/this.mercatorRadius*180/Math.PI}pixelSpaceYToLatitude(de){return 180*(Math.PI/2-2*Math.atan(Math.exp((Math.round(de)-this.mercatorOffset)/this.mercatorRadius)))/Math.PI}deltaFromZoomLevel(de,Pe,Be){let Ne=this.longitudeToPixelSpaceX(Pe.longitude),Ae=this.latitudeToPixelSpaceY(Pe.latitude),lt=Math.pow(2,20-Be),ne=de.visibleMapRect.size,Ee=ne.width*lt,xe=ne.height*lt,je=Ne-Ee/2,Se=Ae-xe/2,Ve=this.pixelSpaceXToLongitude(je),Ht=this.pixelSpaceXToLongitude(je+Ee)-Ve,cn=this.pixelSpaceYToLatitude(Se);return{latitudeDelta:-1*(this.pixelSpaceYToLatitude(Se+xe)-cn),longitudeDelta:Ht}}}var Te=S(8564),ye=S(5957),De=S(9862);let me=(()=>{class Ce extends h.k{constructor(Pe,Be,Ne){super(Pe,Be,Ne),this.mapAPIType=p.b.MAPTILER,this.mapTileSet="https://maps.tilehosting.com/styles/streets/style.json?key=Gs9z7krALe3CGI60d5cL"}initAPI(){}static \u0275fac=function(Be){return new(Be||Ce)(Te.LFG(ye.z),Te.LFG(a.z),Te.LFG(De.eN))};static \u0275prov=Te.Yz7({token:Ce,factory:Ce.\u0275fac})}return Ce})(),Ye=(()=>{class Ce{logging;http;map;mapCentreMarker;mapsInitialised;mapAPIReady;mapOptions;searchMarker;errorMessage;parentAppContext;mapProvider;debouncedMapPositionUpdate;events;isFocused=!1;constructor(Pe,Be,Ne){this.logging=Be,this.http=Ne,this.events=Pe,this.mapOptions=new p._,this.mapAPIReady=!1,this.mapsInitialised=!1,this.setMapAPI(this.mapOptions.mapAPI);let Ae=this;this.debouncedMapPositionUpdate=X.c.debounce(()=>{this.logging.log("signaling map position change:"),Ae.mapProvider.mapReady&&Ae.getMapCenter().subscribe(Ge=>{null!=Ge?(this.logging.log("Map centre/zoom changed, updating search position:"+Ge),this.updateMapCentrePos(Ge.coords.latitude,Ge.coords.longitude,!1)):this.logging.log("Map centre/zoom changed - map not ready to change centre pos:")})},300,!1)}setParentAppContext(Pe){this.parentAppContext=Pe}setMapAPI(Pe){this.mapOptions.mapAPI=Pe,this.mapOptions.mapAPI==p.b.MAPBOX&&(this.mapProvider=new h.k(this.events,this.logging,this.http)),this.mapOptions.mapAPI==p.b.MAPKIT_JS&&(this.mapProvider=new Le(this.events,this.logging)),this.mapOptions.mapAPI==p.b.MAPTILER&&(this.mapProvider=new me(this.events,this.logging,this.http))}isMapReady(){return null!=this.mapProvider&&this.mapProvider.mapReady}externalAPILoaded(Pe){this.mapAPIReady=!0,this.logging.log("Mapping API Loaded: "+p.b[Pe])}initMap(Pe){if(!this.isMapReady())if(null!=this.mapProvider)this.mapsInitialised&&this.logging.log("initMap: Map provider already initialised"),this.logging.log("Mapping Manager: Init "+p.b[this.mapProvider.mapAPIType]),this.mapProvider.initMap(Pe,this.mapOptions,this);else{if(this.mapsInitialised)return void this.logging.log("initMap: map already initialised");this.logging.log("initMap: "+this.mapOptions.mapAPI)}}mapManipulationPerformed(Pe){this.logging.log("map manipulated:"+Pe),("drag"==Pe||"zoom"==Pe)&&this.debouncedMapPositionUpdate()}updateMapSize(){this.mapProvider&&this.mapProvider.refreshMapLayout()}updateMapCentrePos(Pe,Be,Ne,Ae){Ne&&null!=this.mapProvider&&this.mapProvider.setMapCenter(new C.jR(Pe,Be),Ae),this.mapOptions.mapCentre=new C.jR(Pe,Be)}moveToMapBounds(Pe){this.mapProvider.moveToMapBounds(Pe)}refreshMapView(Pe,Be,Ne){return null!=this.mapProvider?(this.logging.log("Mapping Manager: renderMap "+p.b[this.mapProvider.mapAPIType]),this.isMapReady()?this.mapProvider.renderMap(Be,Pe,this.parentAppContext):this.logging.log("refreshMapView: map provider not initialised..")):this.logging.log("Unsupported Map API: refreshMapView",a.i.ERROR),!0}setMapType(Pe){this.mapOptions.mapType!=Pe&&(this.mapOptions.mapType=Pe,this.isMapReady()&&null!=this.mapProvider?(this.logging.log("Changing map type:"+Pe),this.mapProvider.setMapType(Pe)):this.logging.log("Map type set, maps not initialised yet."))}unfocusMap(){this.logging.log("[mapping] Unfocus Map."),this.isFocused=!1,this.mapProvider.unfocusMap()}focusMap(){this.logging.log("[mapping] Focus Map."),this.isFocused=!0,this.mapProvider.focusMap()}getMapBounds(){return this.mapProvider.getMapBounds()}getMapZoom(){return this.mapProvider.getMapZoom()}setMapZoom(Pe){this.mapProvider.setMapZoom(Pe)}getMapCenter(){return this.mapProvider.getMapCenter()}showPOIOnStaticMap(Pe,Be,Ne=!1,Ae=!1,Ge=200,lt=200){let ne=document.getElementById(Pe);if(null!=ne){let xe=Be.AddressInfo.Latitude,je=Be.AddressInfo.Longitude;Ge>640&&(Ge=640),lt>640&&(lt=640);let Se=Ge,Ve=lt,Xe="https://maps.googleapis.com/maps/api/staticmap?center="+xe+","+je+"&zoom=14&size="+Se+"x"+Ve+"&maptype=roadmap&markers=color:blue%7Clabel:A%7C"+xe+","+je+"&sensor=false",Ht="";Ht+=1==Ne?"<div>"+X.c.formatMapLink(Be,'<div><img width="'+Se+'" height="'+Ve+'" src="'+Xe+'" /></div>',Ae)+"</div>":'<div><img width="'+Se+'" height="'+Ve+'" src="'+Xe+'" /></div>',ne.innerHTML=Ht}}renderPolyline(Pe){this.mapProvider.renderPolyline(Pe)}clearPolyline(){this.mapProvider.clearPolyline()}clearMarkers(){this.logging.log("mapping: clearing markers"),this.mapProvider.clearMarkers()}addPOILayer(Pe){this.mapProvider.addPOILayer(Pe)}static \u0275fac=function(Be){return new(Be||Ce)(Te.LFG(ye.z),Te.LFG(a.z),Te.LFG(De.eN))};static \u0275prov=Te.Yz7({token:Ce,factory:Ce.\u0275fac,providedIn:"root"})}return Ce})()},3955:(zn,wt,S)=>{"use strict";S.d(wt,{_:()=>X,b:()=>p});var h=S(553),p=function(a){return a[a.GOOGLE_WEB=1]="GOOGLE_WEB",a[a.GOOGLE_NATIVE=2]="GOOGLE_NATIVE",a[a.LEAFLET=3]="LEAFLET",a[a.MAPBOX=4]="MAPBOX",a[a.MAPKIT_JS=5]="MAPKIT_JS",a[a.MAPTILER=6]="MAPTILER",a}(p||{});class X{enableClustering;resultBatchID;useMarkerIcons;useMarkerAnimation;enableTrackingMapCentre;enableSearchByWatchingLocation;mapCentre;searchDistanceKM;iconSet;mapAPI;mapMoveQueryRefreshMS;requestSearchUpdate;enableSearchRadiusIndicator;mapType;minZoomLevel;onMapMoveCompleted;constructor(){this.enableClustering=!1,this.resultBatchID=-1,this.useMarkerIcons=!0,this.useMarkerAnimation=!0,this.enableTrackingMapCentre=!1,this.enableSearchByWatchingLocation=!1,this.mapCentre=null,this.mapAPI=h.N.defaultMapProvider,this.mapType="ROADMAP",this.searchDistanceKM=1e5,this.mapMoveQueryRefreshMS=300,this.enableSearchRadiusIndicator=!1,this.minZoomLevel=2}}},9903:(zn,wt,S)=>{"use strict";S.d(wt,{k:()=>me});var h=S(5861),p=S(866),X=S(3955),a=S(5592),j=S(3052),K=S(9127),C=S(2574),_e=S(553),Le=S(7518),ee=S(8564),Te=S(5957),ye=S(9862);let me=(()=>{class Ye{events;logging;http;mapAPIType;mapReady;providerError;mapCanvasID;map;markerList;polylinePath;_isMapAnimating=!1;searchMarker;mapTileSet;constructor(de,Pe,Be){this.events=de,this.logging=Pe,this.http=Be,this.events=de,this.mapAPIType=X.b.MAPBOX,this.mapReady=!1,this.markerList=new Map}initAPI(){C&&Object.getOwnPropertyDescriptor(C,"accessToken").set(_e.N.mapBoxToken)}disposeMap(){this.map&&(this.logging.log("Disposing map",K.i.INFO),this.map.remove())}getCurrentMapTileSet(de){return"SATELLITE"==de?"mapbox://styles/mapbox/satellite-streets-v12?optimize=true":"mapbox://styles/mapbox/streets-v12?optimize=true"}flyAroundPoint(de){if(this._isMapAnimating){this.map.rotateTo(de/100%360,{duration:0});const Pe=this;requestAnimationFrame(function(Be){Pe.flyAroundPoint(Be)})}}initMap(de,Pe,Be){this.mapCanvasID=de;let Ne=!0;if(Ne=!(typeof C>"u"),!Ne)return this.logging.log("Call to initMap before API is ready:"+X.b[this.mapAPIType],K.i.ERROR),this.mapReady=!1,!1;if(null==this.map){let ne=function(xe){return xe*(2-xe)};document.getElementById(de),this.initAPI(),this.map=new C.Map({container:de,style:this.getCurrentMapTileSet(Pe.mapType),zoom:15,attributionControl:!1}),this.map.addControl(new C.AttributionControl({compact:!0,customAttribution:["Open Charge Map Contributors"]})),this.map.addControl(new C.NavigationControl),this.mapReady=!0,this.map.getCanvas().focus();let Ge=100,lt=25;this.map.getCanvas().addEventListener("keydown",xe=>{xe.preventDefault(),38===xe.which?this.map.panBy([0,-Ge],{easing:ne}):40===xe.which?this.map.panBy([0,Ge],{easing:ne}):37===xe.which?this.map.easeTo({bearing:this.map.getBearing()-lt,easing:ne}):39===xe.which?this.map.easeTo({bearing:this.map.getBearing()+lt,easing:ne}):32===xe.which&&(this._isMapAnimating?this._isMapAnimating=!1:(this._isMapAnimating=!0,this.flyAroundPoint(0)))},!0),this.map.on("load",()=>{this.events.publish("ocm:mapping:ready")});let Ee=p.c.debounce(()=>{this.getMapCenter().subscribe(xe=>{this.searchMarker.setLngLat(new C.LngLat(xe.coords.longitude,xe.coords.latitude))})},500,!1);this.map.on("move",()=>{this.searchMarker&&Ee()}),this.map.on("moveend",()=>{this.events.publish("ocm:mapping:dragend"),Pe.onMapMoveCompleted&&Pe.onMapMoveCompleted()}),this.map.on("zoomend",()=>{this.events.publish("ocm:mapping:zoom")})}}clearMarkers(){null!=this.markerList&&this.markerList.forEach((de,Pe)=>{de.remove()}),this.markerList=new Map}showPOIListOnMap(de,Pe,Be=!0){let Ae=this.map,Ge=new C.LngLatBounds,lt=0;if(Ae.getZoom(),null!=de){for(let Se=0;Se<de.length;Se++)if(null!=de[Se].AddressInfo&&null!=de[Se].AddressInfo.Latitude&&null!=de[Se].AddressInfo.Longitude){let Ve=de[Se],Xe=!0;if(null!=this.markerList&&this.markerList.has(Ve.ID)){Xe=!1;let Ht=this.markerList.get(Ve.ID);Ht&&Ht.poi&&Ht.poi.DateLastStatusUpdate!=Ve.DateLastStatusUpdate&&(Ht.remove(),Xe=!0)}if(Xe){let Ht=null,cn=null;Be?(Ht=document.createElement("img"),Ht.src=p.c.getIconForPOI(Ve),Ht.width=34,Ht.height=50):(Ht=null,cn=p.c.getColorForPOI(Ve));let $t=(Be?"OCM-":"EXT-")+Ve.ID+": "+Ve.AddressInfo.Title+":";null!=Ve.UsageType&&($t+=" "+Ve.UsageType.Title),null!=Ve.StatusType&&($t+=" "+Ve.StatusType.Title);let ke=new C.Marker({element:Ht,color:cn,anchor:"bottom"}).setLngLat([Ve.AddressInfo.Longitude,Ve.AddressInfo.Latitude]).addTo(Ae);ke.poi=Ve;let pe=ke.getElement();pe.poi=Ve,pe.addEventListener("click",Oe=>{const ie=Oe.currentTarget.poi;this.events.publish("ocm:poi:selected",{poiId:ie.ID,poi:ie})}),Ge.extend(ke.getLngLat()),this.markerList.set(Ve.ID,ke),lt++}}this.logging.log(lt+" new map markers added out of a total "+this.markerList.size)}if(null!=de&&de.length>0)if(null==Pe||Pe.appConfig.enableLiveMapQuerying)null==Ae.getCenter()&&Ae.setCenter(Ge.getCenter());else{this.logging.log("Fitting to marker bounds:"+Ge),Ae.setCenter(Ge.getCenter()),this.logging.log("zoom before fit bounds:"+Ae.getZoom()),Ae.fitBounds(Ge);let je=Ae.getZoom();Ae.setZoom(je<6?6:je)}}refreshMapLayout(){null!=this.map&&setTimeout(()=>{this.logging.log("MapBoxGL: refreshMapLayout",K.i.VERBOSE),this.map.resize()},200)}setMapCenter(de){this.mapReady&&(this.map.setCenter(new C.LngLat(de.coords.longitude,de.coords.latitude)),this.searchMarker||(this.searchMarker=new C.Marker({color:"#99ccff",anchor:"bottom"}).setLngLat(new C.LngLat(de.coords.longitude,de.coords.latitude)).addTo(this.map),this.searchMarker.getElement().addEventListener("click",()=>{let Pe=this.searchMarker.getLngLat();this.events.publish("ocm:mapping:addpoi",new j.wC(Pe.lat,Pe.lng))})))}getMapCenter(){return new a.y(Pe=>{if(null!=this.map){let Be=this.map.getCenter();null!=Be&&(Pe.next(new j.jR(Be.lat,Be.lng)),Pe.complete())}})}setMapZoom(de){this.map.setZoom(de)}getMapZoom(){return new a.y(Pe=>{let Be=this.map.getZoom();Pe.next(Be),Pe.complete()})}setMapType(de){this.map.setStyle(this.getCurrentMapTileSet(de))}getMapBounds(){return new a.y(Pe=>{let Be=new Array,Ne=this.map.getBounds();Be.push(new j.wC(Ne.getSouthWest().lat,Ne.getSouthWest().lng)),Be.push(new j.wC(Ne.getNorthEast().lat,Ne.getNorthEast().lng)),Pe.next(Be),Pe.complete()})}moveToMapBounds(de){this.map.fitBounds(new C.LngLatBounds(new C.LngLat(de.southWest.longitude,de.southWest.latitude),new C.LngLat(de.northEast.longitude,de.northEast.latitude)))}renderMap(de,Pe,Be){return document.getElementById(this.mapCanvasID).style.height=Pe+"px",this.mapReady&&this.showPOIListOnMap(de,Be),!0}renderPolyline(de){this.clearPolyline()}clearPolyline(){null!=this.polylinePath&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(de,Pe,Be){var Ne=this;return(0,h.Z)(function*(){let Ae=`https://api.mapbox.com/geocoding/v5/mapbox.places/${de||Be+","+Pe}.json?access_token=${_e.N.mapBoxToken}`;return new Promise(function(){var Ge=(0,h.Z)(function*(lt,ne){Ne.http.get(Ae).toPromise().then(Ee=>{let xe=[];xe=[],Ee.features&&Ee.features.map(je=>{let Se=new Le.nS;Se.Title=je.place_name,Se.Address=je.place_name,Se.Type="place",Se.Location=new j.wC(je.center[1],je.center[0]),Se.Attribution=Ee.attribution,xe.push(Se)}),lt(xe)})});return function(lt,ne){return Ge.apply(this,arguments)}}())})()}addPOILayer(de){this.logging.log("Add POI Layer not implemented in this provider."),this.showPOIListOnMap(de,null,!1)}static \u0275fac=function(Pe){return new(Pe||Ye)(ee.LFG(Te.z),ee.LFG(K.z),ee.LFG(ye.eN))};static \u0275prov=ee.Yz7({token:Ye,factory:Ye.\u0275fac})}return Ye})()},553:(zn,wt,S)=>{"use strict";S.d(wt,{N:()=>h});const h={name:"prod",version:"8.5.8",production:!0,analyticsId:"",googleMapsKey:"",mapBoxToken:"pk.eyJ1Ijoid2VicHJvZnVzaW9uIiwiYSI6ImNsZTZzbWo4czBxYm4zb3FpNjFhMDM0NmQifQ.3zXrhXbwFyEgOkMdpzwtiQ",mapKitToken:"",enableStaticMaps:!1,defaultMapProvider:4,apiBase:"https://api.openchargemap.io",apiKey:"9bb03e5b-0fb2-4916-9b2b-26c6bd27a56a",enabledFeatures:["MAP","ADD_COMMENT","ADD_PHOTO","FAVOURITES","FILTER_OPTIONS_BY_COUNTRY","ADD_POI","EDIT_POI","LAYERS"]}},3108:(zn,wt,S)=>{"use strict";var h=S(6593),p=S(8564),X=S(5086),a=S(3999),j=S(6814),K=S(6223),C=S(6728);let oe=(()=>{class _n{static \u0275fac=function(sn){return new(sn||_n)};static \u0275mod=p.oAB({type:_n});static \u0275inj=p.cJS({imports:[j.ez,K.u5,C.Pc,a.aw,X.e]})}return _n})(),_e=(()=>{class _n{static \u0275fac=function(sn){return new(sn||_n)};static \u0275mod=p.oAB({type:_n});static \u0275inj=p.cJS({imports:[j.ez,K.u5,C.Pc,a.aw,X.e]})}return _n})(),Le=(()=>{class _n{static \u0275fac=function(sn){return new(sn||_n)};static \u0275mod=p.oAB({type:_n});static \u0275inj=p.cJS({imports:[j.ez,K.u5,C.Pc,a.aw,X.e]})}return _n})();var ee=S(4606),Te=S(9862),ye=S(6800),De=S(703),me=S(5472);class Ye{http;prefix;suffix;constructor(Bi,pn="/assets/i18n/",sn=".json"){this.http=Bi,this.prefix=pn,this.suffix=sn}getTranslation(Bi){return this.http.get(`${this.prefix}${Bi}${this.suffix}`)}}var Ce=S(5861),de=S(1847),Pe=S(3247),Be=S(8767),Ne=S(4292),Ae=S(6470);function Ge(_n,Bi){if(1&_n){const pn=p.EpF();p.TgZ(0,"div"),p._uU(1," You are not signed in. "),p.TgZ(2,"button",5),p.NdJ("click",function(){p.CHM(pn);const Cn=p.oxw();return p.KtG(Cn.showSignInModal())}),p._uU(3),p.ALo(4,"translate"),p.qZA()()}2&_n&&(p.xp6(3),p.Oqu(p.lcZ(4,1,"ocm.general.signIn")))}function lt(_n,Bi){if(1&_n&&(p.TgZ(0,"div")(1,"ion-card")(2,"ion-item")(3,"ion-avatar",6),p._UZ(4,"img",7),p.qZA(),p.TgZ(5,"h2"),p._uU(6),p.qZA()(),p.TgZ(7,"ion-card-content")(8,"p"),p._uU(9),p.qZA(),p.TgZ(10,"p"),p._uU(11),p.qZA()(),p.TgZ(12,"ion-item")(13,"ion-note",8),p._UZ(14,"ion-icon",9),p._uU(15),p.qZA()()()()),2&_n){const pn=p.oxw();p.xp6(4),p.s9C("src",pn.userProfile.ProfileImageURL,p.LSH),p.xp6(2),p.Oqu(pn.userProfile.Username),p.xp6(3),p.hij(" ",pn.userProfile.Profile,""),p.xp6(2),p.hij(" Date Joined: ",pn.userProfile.DateCreated," "),p.xp6(4),p.hij(" ",pn.userProfile.ReputationPoints," Contributor Points ")}}let ne=(()=>{class _n{appManager;nav;translate;modalController;userProfile;constructor(pn,sn,Cn,$i){this.appManager=pn,this.nav=sn,this.translate=Cn,this.modalController=$i}ionViewDidEnter(){this.userProfile=this.appManager.getUserProfile(),null!=this.userProfile&&this.appManager.isUserAuthenticated(!0)?this.refreshProfileView():this.showSignInModal(),this.appManager.analytics.viewEvent("Profile")}refreshProfileView(){this.userProfile=this.appManager.getUserProfile()}showSignInModal(){this.modalController.create({component:Be.F,componentProps:{Profile:this.userProfile}}).then(pn=>{pn.onDidDismiss().then(()=>{this.refreshProfileView()}),pn.present()})}close(){this.modalController.dismiss()}static \u0275fac=function(sn){return new(sn||_n)(p.Y36(Ae.c),p.Y36(me.SH),p.Y36(a.sK),p.Y36(C.IN))};static \u0275cmp=p.Xpm({type:_n,selectors:[["ng-component"]],decls:14,vars:5,consts:[[1,"profile-page","ion-padding"],[4,"ngIf"],["slot","end"],[3,"click"],["name","close","slot","start"],["ion-button","",3,"click"],["slot","start"],[3,"src"],["item-left",""],["name","star"]],template:function(sn,Cn){1&sn&&(p.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),p._uU(3),p.ALo(4,"translate"),p.qZA()()(),p.TgZ(5,"ion-content",0),p.YNc(6,Ge,5,3,"div",1)(7,lt,16,5,"div",1),p.qZA(),p.TgZ(8,"ion-footer")(9,"ion-toolbar")(10,"ion-buttons",2)(11,"ion-button",3),p.NdJ("click",function(){return Cn.close()}),p._UZ(12,"ion-icon",4),p._uU(13," Close "),p.qZA()()()()),2&sn&&(p.xp6(3),p.hij(" ",p.lcZ(4,3,"ocm.navigation.profile.sectionTitle")," "),p.xp6(3),p.Q6J("ngIf",null==Cn.userProfile),p.xp6(1),p.Q6J("ngIf",null!=Cn.userProfile))},dependencies:[j.O5,C.BJ,C.YG,C.Sm,C.PM,C.FN,C.W2,C.fr,C.Gu,C.gu,C.Ie,C.uN,C.wd,C.sr,a.X$],encapsulation:2})}return _n})();var Ee=S(9127),xe=S(553),je=S(6662),Se=S(3294),Ve=S(866),Xe=S(9236),Ht=S(8062),cn=S(2726);const xn=(0,cn.fo)("PushNotifications",{}),ie=(0,cn.fo)("StatusBar"),it=(0,cn.fo)("SplashScreen",{web:()=>S.e(4485).then(S.bind(S,4485)).then(_n=>new _n.SplashScreenWeb)}),_t=(0,cn.fo)("App",{web:()=>S.e(2912).then(S.bind(S,2912)).then(_n=>new _n.AppWeb)});var Kt=S(5957);function Mn(_n,Bi){if(1&_n){const pn=p.EpF();p.TgZ(0,"ion-item",9),p.NdJ("click",function(){p.CHM(pn);const Cn=p.oxw();return p.KtG(Cn.openRoutePlannerModal())}),p._UZ(1,"ion-icon",12),p.TgZ(2,"ion-label"),p._uU(3," Route Planner "),p.qZA()()}}function fn(_n,Bi){if(1&_n){const pn=p.EpF();p.TgZ(0,"ion-item",9),p.NdJ("click",function(){p.CHM(pn);const Cn=p.oxw();return p.KtG(Cn.add())}),p._UZ(1,"ion-icon",13),p.TgZ(2,"ion-label"),p._uU(3),p.ALo(4,"translate"),p.qZA()()}2&_n&&(p.xp6(3),p.hij(" ",p.lcZ(4,1,"ocm.general.addLocation")," "))}function qn(_n,Bi){if(1&_n){const pn=p.EpF();p.TgZ(0,"ion-item",9),p.NdJ("click",function(){p.CHM(pn);const Cn=p.oxw();return p.KtG(Cn.journeys())}),p._UZ(1,"ion-icon",12),p.TgZ(2,"ion-label"),p._uU(3," Journeys "),p.qZA()()}}function li(_n,Bi){if(1&_n){const pn=p.EpF();p.TgZ(0,"ion-item",9),p.NdJ("click",function(){p.CHM(pn);const Cn=p.oxw();return p.KtG(Cn.addLayer())}),p._UZ(1,"ion-icon",14),p.TgZ(2,"ion-label"),p._uU(3," Add Layer "),p.qZA()()}}function en(_n,Bi){if(1&_n){const pn=p.EpF();p.ynx(0),p.TgZ(1,"ion-item",9),p.NdJ("click",function(){p.CHM(pn);const Cn=p.oxw();return p.KtG(Cn.signIn())}),p._UZ(2,"ion-icon",15),p.TgZ(3,"ion-label"),p._uU(4),p.ALo(5,"translate"),p.qZA()(),p.BQk()}2&_n&&(p.xp6(4),p.hij(" ",p.lcZ(5,1,"ocm.general.signIn")," "))}function Dt(_n,Bi){if(1&_n){const pn=p.EpF();p.ynx(0),p.TgZ(1,"ion-item",9),p.NdJ("click",function(){p.CHM(pn);const Cn=p.oxw();return p.KtG(Cn.profile())}),p._UZ(2,"ion-icon",15),p.TgZ(3,"ion-label"),p._uU(4),p.ALo(5,"translate"),p.qZA()(),p.TgZ(6,"ion-item",9),p.NdJ("click",function(){p.CHM(pn);const Cn=p.oxw();return p.KtG(Cn.signOut())}),p._UZ(7,"ion-icon",16),p.TgZ(8,"ion-label"),p._uU(9),p.ALo(10,"translate"),p._UZ(11,"br"),p.TgZ(12,"small",17),p._uU(13),p.qZA()()(),p.BQk()}if(2&_n){const pn=p.oxw();p.xp6(4),p.hij(" ",p.lcZ(5,3,"ocm.navigation.profile.sectionTitle")," "),p.xp6(5),p.hij(" ",p.lcZ(10,5,"ocm.general.signOut")," "),p.xp6(4),p.hij(" ",pn.getUserName(),"")}}const Ie=()=>["/search"];let Ct=(()=>{class _n{platform;translate;mapping;modalController;appManager;logger;analytics;events;enabledFeatures;constructor(pn,sn,Cn,$i,ct,ge,se,tt){this.platform=pn,this.translate=sn,this.mapping=Cn,this.modalController=$i,this.appManager=ct,this.logger=ge,this.analytics=se,this.events=tt,this.logger.log("Environment: "+xe.N.name),this.initializeApp(),this.enabledFeatures=xe.N.enabledFeatures,1!=ct.searchSettings.EnableAdvancedEditorFeatures&&(this.enabledFeatures=this.enabledFeatures.filter(yt=>"LAYERS"!=yt))}configurePushNotifications(){xn.register(),xn.addListener("registration",pn=>{this.logger.log("Push registration success, token: "+pn.value),this.appManager.savePushRegistration(pn.value)}),xn.addListener("registrationError",pn=>{this.logger.log("Error on registration: "+JSON.stringify(pn))}),xn.addListener("pushNotificationReceived",pn=>{this.logger.log("Push received: "+JSON.stringify(pn),Ee.i.INFO)}),xn.addListener("pushNotificationActionPerformed",pn=>{this.logger.log("Push action performed: "+JSON.stringify(pn))})}isUserAuthenticated(){return this.appManager.isUserAuthenticated()}getUserName(){let pn=this.appManager.getUserProfile();return pn?pn.EmailAddress?pn.EmailAddress:pn.Username:"Not Signed In"}initializeApp(){var pn=this;this.platform.ready().then(()=>{this.platform.is("capacitor")&&(ie.show(),it.hide()),this.translate.addLangs(this.appManager.getLanguages().map(sn=>sn.code)),this.translate.setDefaultLang("en"),null!=this.appManager.searchSettings.Language?this.translate.use(this.appManager.searchSettings.Language):this.translate.currentLang||this.translate.use("en"),this.translate.get("ocm.search.performSearch").toPromise().then(sn=>{}),this.analytics.init(xe.N.analyticsId).then(()=>{this.analytics.setAppVersion(xe.N.version),this.analytics.appEvent("Startup","App Loaded")}).catch(sn=>this.logger.log("Error starting analytics")),this.events.subscribe("ocm:mapping:addpoi",function(){var sn=(0,Ce.Z)(function*(Cn){Ve.c.isFeatureEnabled("ADD_POI")&&pn.add(Cn)});return function(Cn){return sn.apply(this,arguments)}}()),(this.platform.is("ios")||this.platform.is("android"))&&(this.configurePushNotifications(),this.checkForAppOpenUrl())})}checkForAppOpenUrl(){return(0,Ce.Z)(function*(){_t.addListener("appUrlOpen",sn=>{alert("App (re)opened with URL: "+sn.url)});let pn=yield _t.getLaunchUrl();pn&&pn.url&&alert("App opened with URL: "+pn.url)})()}openRoutePlannerModal(){var pn=this;return(0,Ce.Z)(function*(){pn.mapping.unfocusMap();const sn=yield pn.modalController.create({component:Pe.u});sn.onDidDismiss().then(Cn=>{pn.mapping.focusMap()}),yield sn.present()})()}continueAdd(pn){var sn=this;return(0,Ce.Z)(function*(){const Cn=yield sn.modalController.create({component:je.Y,componentProps:{startPos:pn}});Cn.onDidDismiss().then($i=>{sn.mapping.focusMap()}),yield Cn.present()})()}add(pn){var sn=this;return(0,Ce.Z)(function*(){if(sn.mapping.unfocusMap(),!sn.appManager.isUserAuthenticated(!0)){const Cn=yield sn.modalController.create({component:Be.F});return Cn.onDidDismiss().then(function(){var $i=(0,Ce.Z)(function*(ct){sn.mapping.focusMap(),sn.appManager.isUserAuthenticated(!0)&&(yield sn.continueAdd(pn))});return function(ct){return $i.apply(this,arguments)}}()),yield Cn.present()}yield sn.continueAdd(pn)})()}signIn(){var pn=this;return(0,Ce.Z)(function*(){pn.mapping.unfocusMap();const sn=yield pn.modalController.create({component:Be.F});return sn.onDidDismiss().then(Cn=>{pn.mapping.focusMap(),pn.appManager.isUserAuthenticated(!0)}),yield sn.present()})()}signOut(){var pn=this;return(0,Ce.Z)(function*(){pn.appManager.signOutCurrentUser()})()}profile(){var pn=this;return(0,Ce.Z)(function*(){pn.mapping.unfocusMap();const sn=yield pn.modalController.create({component:ne});sn.onDidDismiss().then(Cn=>{pn.mapping.focusMap()}),yield sn.present()})()}journeys(){var pn=this;return(0,Ce.Z)(function*(){pn.mapping.unfocusMap();const sn=yield pn.modalController.create({component:Ne.g});sn.onDidDismiss().then(Cn=>{pn.mapping.focusMap()}),yield sn.present()})()}addLayer(){var pn=this;return(0,Ce.Z)(function*(){const sn=yield pn.modalController.create({component:Ht.A});yield sn.present();const{data:Cn}=yield sn.onWillDismiss();Cn&&pn.mapping.addPOILayer(Cn)})()}about(){var pn=this;return(0,Ce.Z)(function*(){pn.mapping.unfocusMap();const sn=yield pn.modalController.create({component:Xe.t});sn.onDidDismiss().then(Cn=>{pn.mapping.focusMap()}),yield sn.present()})()}static \u0275fac=function(sn){return new(sn||_n)(p.Y36(me.t4),p.Y36(a.sK),p.Y36(de.v),p.Y36(C.IN),p.Y36(Ae.c),p.Y36(Ee.z),p.Y36(Se.c),p.Y36(Kt.z))};static \u0275cmp=p.Xpm({type:_n,selectors:[["app-root"]],decls:29,vars:17,consts:[["contentId","main-content",3,"disabled"],["contentId","main-content","swipeGesture","false"],["slot","start"],["src","assets/images/icons/branding/AppIcon_128x128.png"],["auto-hide","false"],[3,"routerDirection","routerLink"],["slot","start","name","home"],[3,"click",4,"ngIf"],[4,"ngIf"],[3,"click"],["slot","start","name","information-circle-outline"],["id","main-content"],["slot","start","name","map"],["slot","start","name","add-circle-outline"],["slot","start","name","albums"],["slot","start","name","person"],["slot","start","name","log-out"],[2,"color","#c0c0c0"]],template:function(sn,Cn){1&sn&&(p.TgZ(0,"ion-app")(1,"ion-split-pane",0)(2,"ion-menu",1)(3,"ion-header")(4,"ion-toolbar")(5,"ion-thumbnail",2),p._UZ(6,"img",3),p.qZA(),p.TgZ(7,"ion-title"),p._uU(8),p.qZA()()(),p.TgZ(9,"ion-content")(10,"ion-list")(11,"ion-menu-toggle",4)(12,"ion-item",5),p._UZ(13,"ion-icon",6),p.TgZ(14,"ion-label"),p._uU(15),p.ALo(16,"translate"),p.qZA()(),p.YNc(17,Mn,4,0,"ion-item",7)(18,fn,5,3,"ion-item",7)(19,qn,4,0,"ion-item",7)(20,li,4,0,"ion-item",7)(21,en,6,3,"ng-container",8)(22,Dt,14,7,"ng-container",8),p.TgZ(23,"ion-item",9),p.NdJ("click",function(){return Cn.about()}),p._UZ(24,"ion-icon",10),p.TgZ(25,"ion-label"),p._uU(26),p.ALo(27,"translate"),p.qZA()()()()()(),p._UZ(28,"ion-router-outlet",11),p.qZA()()),2&sn&&(p.xp6(1),p.Q6J("disabled",!0),p.xp6(7),p.Oqu(Cn.appManager.title),p.xp6(4),p.Q6J("routerDirection","root")("routerLink",p.DdM(16,Ie)),p.xp6(3),p.hij(" ",p.lcZ(16,12,"ocm.search.sectionTitle")," "),p.xp6(2),p.Q6J("ngIf",Cn.enabledFeatures.includes("ROUTE_PLANNER")),p.xp6(1),p.Q6J("ngIf",Cn.enabledFeatures.includes("ADD_POI")),p.xp6(1),p.Q6J("ngIf",Cn.enabledFeatures.includes("FAVOURITES")),p.xp6(1),p.Q6J("ngIf",Cn.enabledFeatures.includes("LAYERS")),p.xp6(1),p.Q6J("ngIf",!Cn.isUserAuthenticated()),p.xp6(1),p.Q6J("ngIf",Cn.isUserAuthenticated()),p.xp6(4),p.hij(" ",p.lcZ(27,14,"ocm.general.about")," "))},dependencies:[j.O5,C.dr,C.W2,C.Gu,C.gu,C.Ie,C.Q$,C.q_,C.z0,C.zc,C.jI,C.Bs,C.wd,C.sr,C.jP,C.YI,ye.rH,a.X$],encapsulation:2})}return _n})();const on=[{path:"",redirectTo:"search",pathMatch:"full"},{path:"search",loadChildren:()=>Promise.resolve().then(S.bind(S,4606)).then(_n=>_n.SearchPageModule)},{path:"journeys",loadChildren:()=>Promise.resolve().then(S.bind(S,9192)).then(_n=>_n.JourneysModule)},{path:"signin",loadChildren:()=>Promise.resolve().then(S.bind(S,9472)).then(_n=>_n.SignInModule)},{path:"poi-editor/:id",loadChildren:()=>Promise.resolve().then(S.bind(S,5722)).then(_n=>_n.PoiEditorPageModule)},{path:"about",loadChildren:()=>Promise.resolve().then(S.bind(S,7425)).then(_n=>_n.AboutPageModule)},{path:"layer-editor",loadChildren:()=>Promise.resolve().then(S.bind(S,2309)).then(_n=>_n.LayerEditorPageModule)}];let Rn=(()=>{class _n{static \u0275fac=function(sn){return new(sn||_n)};static \u0275mod=p.oAB({type:_n});static \u0275inj=p.cJS({imports:[ye.Bz.forRoot(on,{useHash:!0}),ye.Bz]})}return _n})(),Vn=(()=>{class _n{static \u0275fac=function(sn){return new(sn||_n)};static \u0275mod=p.oAB({type:_n});static \u0275inj=p.cJS({imports:[j.ez,K.u5,C.Pc,a.aw,X.e]})}return _n})();var Ut=S(9472);let Hn=(()=>{class _n{static \u0275fac=function(sn){return new(sn||_n)};static \u0275mod=p.oAB({type:_n});static \u0275inj=p.cJS({imports:[j.ez,K.u5,C.Pc,a.aw,X.e,ye.Bz.forChild([{path:"",component:ne}])]})}return _n})();var qe=S(4119);let Nt=(()=>{class _n{static \u0275fac=function(sn){return new(sn||_n)};static \u0275mod=p.oAB({type:_n});static \u0275inj=p.cJS({imports:[j.ez,K.u5,C.Pc,a.aw,X.e,ye.Bz.forChild([{path:"",component:qe.N}])]})}return _n})();var Xt=S(9192),Tn=S(5722),oi=S(7425),xi=S(2309);function Oi(){return localStorage.getItem("access_token")}function gr(_n){return new Ye(_n,"/assets/i18n/",".json")}let Wi=(()=>{class _n{static \u0275fac=function(sn){return new(sn||_n)};static \u0275mod=p.oAB({type:_n,bootstrap:[Ct]});static \u0275inj=p.cJS({providers:[{provide:ye.wN,useClass:me.r4}],imports:[h.b2,Te.JF,a.aw.forRoot({loader:{provide:a.Zw,useFactory:gr,deps:[Te.eN]}}),C.Pc.forRoot(),Rn,De.Ar.forRoot({config:{tokenGetter:Oi}}),ee.SearchPageModule,Vn,Xt.JourneysModule,Ut.SignInModule,Le,oe,_e,Tn.PoiEditorPageModule,Hn,Nt,oi.AboutPageModule,xi.LayerEditorPageModule]})}return _n})();xe.N.production&&(0,p.G48)(),h.q6().bootstrapModule(Wi).catch(_n=>console.log(_n))},2574:function(zn){zn.exports=function(){"use strict";var wt,S,h;function p(a,j){if(wt)if(S){var K="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+wt+")(sharedChunk); ("+S+")(sharedChunk); self.onerror = null;",C={};wt(C),h=j(C),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(h.workerUrl=window.URL.createObjectURL(new Blob([K],{type:"text/javascript"})))}else S=j;else wt=j}return p(0,function(a){var j=typeof self<"u"?self:{},K="2.15.0";let C;const oe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==C){const r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{C=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):r}catch{C=r}}return C},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!oe.API_URL)return null;try{const r=new URL(oe.API_URL);return"api.mapbox.cn"===r.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===r.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},_e={supported:!1,testSupport:function(r){!Te&&ee&&(ye?De(r):Le=r)}};let Le,ee,Te=!1,ye=!1;function De(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,ee),r.isContextLost())return;_e.supported=!0}catch{}r.deleteTexture(e),Te=!0}j.document&&(ee=j.document.createElement("img"),ee.onload=function(){Le&&De(Le),Le=null,ye=!0},ee.onerror=function(){Te=!0,Le=null},ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const me="01";function Ye(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ce=de;function de(r,e,o,l){this.cx=3*r,this.bx=3*(o-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=o,this.p2y=l}de.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(void 0===e&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var o=r,l=0;l<8;l++){var f=this.sampleCurveX(o)-r;if(Math.abs(f)<e)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=f/_}var y=0,w=1;for(o=r,l=0;l<20&&(f=this.sampleCurveX(o),!(Math.abs(f-r)<e));l++)r>f?y=o:w=o,o=.5*(w-y)+y;return o},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var Pe=Ye(Ce),Be=Ne;function Ne(r,e){this.x=r,this.y=e}Ne.prototype={clone:function(){return new Ne(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,o=r.y-this.y;return e*e+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),o=Math.sin(r),l=o*this.x+e*this.y;return this.x=e*this.x-o*this.y,this.y=l,this},_rotateAround:function(r,e){var o=Math.cos(r),l=Math.sin(r),f=e.y+l*(this.x-e.x)+o*(this.y-e.y);return this.x=e.x+o*(this.x-e.x)-l*(this.y-e.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ne.convert=function(r){return r instanceof Ne?r:Array.isArray(r)?new Ne(r[0],r[1]):r};var Ae=Ye(Be);const Ge=Math.PI/180,lt=180/Math.PI;function ne(r){return r*Ge}function Ee(r){return r*lt}const xe=[[0,0],[1,0],[1,1],[0,1]];function je(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,o=e*r;return 4*(r<.5?o:3*(r-e)+o-.75)}function Se(r,e,o,l){const f=new Pe(r,e,o,l);return function(_){return f.solve(_)}}const Ve=Se(.25,.1,.25,1);function Xe(r,e,o){return Math.min(o,Math.max(e,r))}function Ht(r,e,o){return(o=Xe((o-r)/(e-r),0,1))*o*(3-2*o)}function cn(r,e,o){const l=o-e,f=((r-e)%l+l)%l+e;return f===e?o:f}function xn(r,e,o){if(!r.length)return o(null,[]);let l=r.length;const f=new Array(r.length);let _=null;r.forEach((y,w)=>{e(y,(E,D)=>{E&&(_=E),f[w]=D,0==--l&&o(_,f)})})}function $t(r){const e=[];for(const o in r)e.push(r[o]);return e}function ke(r,...e){for(const o of e)for(const l in o)r[l]=o[l];return r}let pe=1;function Oe(){return pe++}function ie(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function it(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function _t(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function Kt(r,e){r.forEach(o=>{e[o]&&(e[o]=e[o].bind(e))})}function Mn(r,e){return-1!==r.indexOf(e,r.length-e.length)}function fn(r,e,o){const l={};for(const f in r)l[f]=e.call(o||this,r[f],f,r);return l}function qn(r,e,o){const l={};for(const f in r)e.call(o||this,r[f],f,r)&&(l[f]=r[f]);return l}function li(r){return Array.isArray(r)?r.map(li):"object"==typeof r&&r?fn(r,li):r}const en={};function Dt(r){en[r]||(typeof console<"u"&&console.warn(r),en[r]=!0)}function Ie(r,e,o){return(o.y-r.y)*(e.x-r.x)>(e.y-r.y)*(o.x-r.x)}function Ct(r){let e=0;for(let o,l,f=0,_=r.length,y=_-1;f<_;y=f++)o=r[f],l=r[y],e+=(l.x-o.x)*(o.y+l.y);return e}function on(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Rn(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,l,f,_)=>{const y=f||_;return e[l]=!y||y.toLowerCase(),""}),e["max-age"]){const o=parseInt(e["max-age"],10);isNaN(o)?delete e["max-age"]:e["max-age"]=o}return e}let Vn=null;function Ut(r){if(null==Vn){const e=r.navigator?r.navigator.userAgent:null;Vn=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Vn}function Hn(r){try{const e=j[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function qe(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}const Nt="mapbox-tiles";let oi,xi,Xt=500,Tn=50;function Oi(){try{return j.caches}catch{}}function gr(){Oi()&&!oi&&(oi=j.caches.open(Nt))}function ki(r){const e=r.indexOf("?");if(e<0)return r;const l=function(f){const _=f.indexOf("?");return _>0?f.slice(_+1).split("&"):[]}(r).filter(f=>{const _=f.split("=");return"language"===_[0]||"worldview"===_[0]});return l.length?`${r.slice(0,e)}?${l.join("&")}`:r.slice(0,e)}let Wi=1/0;const _n={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(_n);class Bi extends Error{constructor(e,o,l){401===o&&Gt(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=o,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const pn=on()?()=>self.worker&&self.worker.referrer:()=>("blob:"===j.location.protocol?j.parent:j).location.href,sn=function(r,e){if(!(/^file:/.test(o=r.url)||/^file:/.test(pn())&&!/^\w+:/.test(o))){if(j.fetch&&j.Request&&j.AbortController&&j.Request.prototype.hasOwnProperty("signal"))return function(l,f){const _=new j.AbortController,y=new j.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:pn(),referrerPolicy:l.referrerPolicy,signal:_.signal});let w=!1,E=!1;const D=(L=y.url).indexOf("sku=")>0&&Gt(L);var L;"json"===l.type&&y.headers.set("Accept","application/json");const B=(Y,Q,he)=>{if(E)return;if(Y&&"SecurityError"!==Y.message&&Dt(Y.toString()),Q&&he)return V(Q);const Ue=Date.now();j.fetch(y).then(ot=>{if(ot.ok){const bt=D?ot.clone():null;return V(ot,bt,Ue)}return f(new Bi(ot.statusText,ot.status,l.url))}).catch(ot=>{"AbortError"!==ot.name&&f(new Error(`${ot.message} ${l.url}`))})},V=(Y,Q,he)=>{("arrayBuffer"===l.type?Y.arrayBuffer():"json"===l.type?Y.json():Y.text()).then(Ue=>{E||(Q&&he&&function(ot,bt,st){if(gr(),!oi)return;const vt={status:bt.status,statusText:bt.statusText,headers:new j.Headers};bt.headers.forEach((un,nn)=>vt.headers.set(nn,un));const St=Rn(bt.headers.get("Cache-Control")||"");if(St["no-store"])return;St["max-age"]&&vt.headers.set("Expires",new Date(st+1e3*St["max-age"]).toUTCString());const At=vt.headers.get("Expires");At&&(new Date(At).getTime()-st<42e4||function(un,nn){if(void 0===xi)try{new Response(new ReadableStream),xi=!0}catch{xi=!1}xi?nn(un.body):un.blob().then(nn)}(bt,un=>{const nn=new j.Response(un,vt);gr(),oi&&oi.then(In=>In.put(ki(ot.url),nn)).catch(In=>Dt(In.message))}))}(y,Q,he),w=!0,f(null,Ue,Y.headers.get("Cache-Control"),Y.headers.get("Expires")))}).catch(Ue=>{E||f(new Error(Ue.message))})};return D?function(Y,Q){if(gr(),!oi)return Q(null);const he=ki(Y.url);oi.then(Ue=>{Ue.match(he).then(ot=>{const bt=function(st){if(!st)return!1;const vt=new Date(st.headers.get("Expires")||0),St=Rn(st.headers.get("Cache-Control")||"");return vt>Date.now()&&!St["no-cache"]}(ot);Ue.delete(he),bt&&Ue.put(he,ot.clone()),Q(null,ot,bt)}).catch(Q)}).catch(Q)}(y,B):B(null,null),{cancel:()=>{E=!0,w||_.abort()}}}(r,e);if(on()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var o;return function(l,f){const _=new j.XMLHttpRequest;_.open(l.method||"GET",l.url,!0),"arrayBuffer"===l.type&&(_.responseType="arraybuffer");for(const y in l.headers)_.setRequestHeader(y,l.headers[y]);return"json"===l.type&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials="include"===l.credentials,_.onerror=()=>{f(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||0===_.status)&&null!==_.response){let y=_.response;if("json"===l.type)try{y=JSON.parse(_.response)}catch(w){return f(w)}f(null,y,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else f(new Bi(_.statusText,_.status,l.url))},_.send(l.body),{cancel:()=>_.abort()}}(r,e)},Cn=function(r,e){return sn(ke(r,{type:"arrayBuffer"}),e)};function $i(r){const e=j.document.createElement("a");return e.href=r,e.protocol===j.document.location.protocol&&e.host===j.document.location.host}const ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ge,se;ge=[],se=0;const tt=function(r,e){if(_e.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),se>=oe.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ge.push(_),_}se++;let o=!1;const l=()=>{if(!o)for(o=!0,se--;ge.length&&se<oe.MAX_PARALLEL_IMAGE_REQUESTS;){const _=ge.shift(),{requestParameters:y,callback:w,cancelled:E}=_;E||(_.cancel=tt(y,w).cancel)}},f=Cn(r,(_,y,w,E)=>{l(),_?e(_):y&&(j.createImageBitmap?function(D,L){const B=new j.Blob([new Uint8Array(D)],{type:"image/png"});j.createImageBitmap(B).then(V=>{L(null,V)}).catch(V=>{L(new Error(`Could not load image because of ${V.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(D,L)=>e(D,L,w,E)):function(D,L){const B=new j.Image,V=j.URL;B.onload=()=>{L(null,B),V.revokeObjectURL(B.src),B.onload=null,j.requestAnimationFrame(()=>{B.src=ct})},B.onerror=()=>L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Y=new j.Blob([new Uint8Array(D)],{type:"image/png"});B.src=D.byteLength?V.createObjectURL(Y):ct}(y,(D,L)=>e(D,L,w,E)))});return{cancel:()=>{f.cancel(),l()}}},yt="NO_ACCESS_TOKEN";function Ot(r){return 0===r.indexOf("mapbox:")}function Gt(r){return oe.API_URL_REGEX.test(r)}function Vt(r){return oe.API_CDN_URL_REGEX.test(r)}function Et(r){return oe.API_STYLE_REGEX.test(r)&&!Jt(r)}function Jt(r){return oe.API_SPRITE_REGEX.test(r)}const Bn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function mn(r){const e=r.match(Bn);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ae(r){const e=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${e}`}const ht="mapbox.eventData";function G(r){if(!r)return null;const e=r.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(j.atob(e[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ze{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const o=G(oe.ACCESS_TOKEN);let l="";return l=o&&o.u?j.btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(f,_)=>String.fromCharCode(+("0x"+_)))):oe.ACCESS_TOKEN||"",e?`${ht}.${e}:${l}`:`${ht}:${l}`}fetchEventData(){const e=Hn("localStorage"),o=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{const f=j.localStorage.getItem(o);f&&(this.eventData=JSON.parse(f));const _=j.localStorage.getItem(l);_&&(this.anonId=_)}catch{Dt("Unable to read from LocalStorage")}}saveEventData(){const e=Hn("localStorage"),o=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{j.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&j.localStorage.setItem(o,JSON.stringify(this.eventData))}catch{Dt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,o,l,f){if(!oe.EVENTS_URL)return;const _=mn(oe.EVENTS_URL);_.params.push(`access_token=${f||oe.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(e).toISOString()},w=o?ke(y,o):y,E={url:ae(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};var L;this.pendingRequest=(L=D=>{this.pendingRequest=null,l(D),this.saveEventData(),this.processRequests(f)},sn(ke(E,{method:"POST"}),L))}queueRequest(e,o){this.queue.push(e),this.processRequests(o)}}const at=new class extends ze{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,e){oe.EVENTS_URL&&oe.ACCESS_TOKEN&&Array.isArray(r)&&r.some(o=>Ot(o)||Gt(o))&&this.queueRequest(Date.now(),e)}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=G(oe.ACCESS_TOKEN),o=e?e.u:oe.ACCESS_TOKEN;let l=o!==this.eventData.tokenU;_t(this.anonId)||(this.anonId=ie(),l=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),y=new Date(f),w=(f-this.eventData.lastSuccess)/864e5;l=l||w>=1||w<-1||_.getDate()!==y.getDate()}else l=!0;l?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:K,skuId:me,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=f,this.eventData.tokenU=o)},r):this.processRequests()}},rn=at.postTurnstileEvent.bind(at),Dn=new class extends ze{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,e,o,l){this.skuToken=e,this.errorCb=l,oe.EVENTS_URL&&(o||oe.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},o):this.errorCb(new Error(yt)))}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:o}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),_t(this.anonId)||(this.anonId=ie()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:K,skuId:me,skuToken:this.skuToken,userId:this.anonId},l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},r))}},gi=Dn.postMapLoadEvent.bind(Dn),Mi=new class extends ze{constructor(){super("gljs.performance")}postPerformanceEvent(r,e){oe.EVENTS_URL&&(r||oe.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},r)}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:o}=this.queue.shift(),l=function(f){const _=j.performance.getEntriesByType("resource"),y=j.performance.getEntriesByType("mark"),w=function(V){const Y={};if(V)for(const Q in V)if("other"!==Q)for(const he of V[Q]){const Ue=`${Q}ResolveRangeMin`,ot=`${Q}ResolveRangeMax`,bt=`${Q}RequestCount`,st=`${Q}RequestCachedCount`;Y[Ue]=Math.min(Y[Ue]||1/0,he.startTime),Y[ot]=Math.max(Y[ot]||-1/0,he.responseEnd);const vt=St=>{void 0===Y[St]&&(Y[St]=0),++Y[St]};void 0!==he.transferSize&&0===he.transferSize&&vt(st),vt(bt)}return Y}(function(V,Y){const Q={};if(V)for(const he of V){const Ue=Y(he);void 0===Q[Ue]&&(Q[Ue]=[]),Q[Ue].push(he)}return Q}(_,Io)),E=j.devicePixelRatio,D=j.navigator.connection||j.navigator.mozConnection||j.navigator.webkitConnection,L={counters:[],metadata:[],attributes:[]},B=(V,Y,Q)=>{null!=Q&&V.push({name:Y,value:Q.toString()})};for(const V in w)B(L.counters,V,w[V]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(B(L.counters,"interactionRangeMin",f.interactionRange[0]),B(L.counters,"interactionRangeMax",f.interactionRange[1])),y)for(const V of Object.keys(ho)){const Y=ho[V],Q=y.find(he=>he.name===Y);Q&&B(L.counters,Y,Q.startTime)}return B(L.counters,"visibilityHidden",f.visibilityHidden),B(L.attributes,"style",function(V){if(V)for(const Y of V){const Q=Y.name.split("?")[0];if(Et(Q)){const he=Q.split("/").slice(-2);if(2===he.length)return`mapbox://styles/${he[0]}/${he[1]}`}}}(_)),B(L.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),B(L.attributes,"fogEnabled",f.fogEnabled?"true":"false"),B(L.attributes,"projection",f.projection),B(L.attributes,"zoom",f.zoom),B(L.metadata,"devicePixelRatio",E),B(L.metadata,"connectionEffectiveType",D?D.effectiveType:void 0),B(L.metadata,"navigatorUserAgent",j.navigator.userAgent),B(L.metadata,"screenWidth",j.screen.width),B(L.metadata,"screenHeight",j.screen.height),B(L.metadata,"windowWidth",j.innerWidth),B(L.metadata,"windowHeight",j.innerHeight),B(L.metadata,"mapWidth",f.width/E),B(L.metadata,"mapHeight",f.height/E),B(L.metadata,"webglRenderer",f.renderer),B(L.metadata,"webglVendor",f.vendor),B(L.metadata,"sdkVersion",K),B(L.metadata,"sdkIdentifier","mapbox-gl-js"),L}(o);for(const f of l.metadata);for(const f of l.counters);for(const f of l.attributes);this.postEvent(e,l,()=>{},r)}},Li=Mi.postPerformanceEvent.bind(Mi),yr=new class extends ze{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,e,o,l){if(!oe.API_URL||!oe.SESSION_PATH)return;const f=mn(oe.API_URL+oe.SESSION_PATH);f.params.push(`sku=${e||""}`),f.params.push(`access_token=${l||oe.ACCESS_TOKEN||""}`);const _={url:ae(f),headers:{"Content-Type":"text/plain"}};var w;this.pendingRequest=(w=y=>{this.pendingRequest=null,o(y),this.saveEventData(),this.processRequests(l)},sn(ke(_,{method:"GET"}),w))}getSessionAPI(r,e,o,l){this.skuToken=e,this.errorCb=l,oe.SESSION_PATH&&oe.API_URL&&(o||oe.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},o):this.errorCb(new Error(yt)))}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:o}=this.queue.shift();e&&this.success[e]||this.getSession(o,this.skuToken,l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},r)}},Ui=yr.getSessionAPI.bind(yr),Fr=new Set,ho={create:"create",load:"load",fullLoad:"fullLoad"},Do={mark(r){j.performance.mark(r)},measure(r,e,o){j.performance.measure(r,e,o)}};function Io(r){const e=r.name.split("?")[0];return Vt(e)&&e.includes("mapbox-gl.js")?"javascript":Vt(e)&&e.includes("mapbox-gl.css")?"css":oe.API_FONTS_REGEX.test(e)?"fontRange":Jt(e)?"sprite":Et(e)?"style":oe.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const Zi=j.performance;function ao(r){const e=r?r.url.toString():void 0;return Zi.getEntriesByName(e)}let Ro,xo,qi,Ci;const Kr={now:()=>void 0!==qi?qi:j.performance.now(),setNow(r){qi=r},restoreNow(){qi=void 0},frame(r){const e=j.requestAnimationFrame(r);return{cancel:()=>j.cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:o,height:l}=r;Ci||(Ci=j.document.createElement("canvas"));const f=Ci.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(o>Ci.width||l>Ci.height)&&(Ci.width=o,Ci.height=l),f.clearRect(-e,-e,o+2*e,l+2*e),f.drawImage(r,0,0,o,l),f.getImageData(-e,-e,o+2*e,l+2*e)},resolveURL:r=>(Ro||(Ro=j.document.createElement("a")),Ro.href=r,Ro.href),get devicePixelRatio(){return j.devicePixelRatio},get prefersReducedMotion(){return!!j.matchMedia&&(null==xo&&(xo=j.matchMedia("(prefers-reduced-motion: reduce)")),xo.matches)}};function Yt(r,e,o){o[r]&&-1!==o[r].indexOf(e)||(o[r]=o[r]||[],o[r].push(e))}function Tt(r,e,o){if(o&&o[r]){const l=o[r].indexOf(e);-1!==l&&o[r].splice(l,1)}}class Mt{constructor(e,o={}){ke(this,o),this.type=e}}class Qt extends Mt{constructor(e,o={}){super("error",ke({error:e},o))}}class wn{on(e,o){return this._listeners=this._listeners||{},Yt(e,o,this._listeners),this}off(e,o){return Tt(e,o,this._listeners),Tt(e,o,this._oneTimeListeners),this}once(e,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Yt(e,o,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,o){"string"==typeof e&&(e=new Mt(e,o||{}));const l=e.type;if(this.listens(l)){e.target=this;const f=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const w of f)w.call(this,e);const _=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const w of _)Tt(l,w,this._oneTimeListeners),w.call(this,e);const y=this._eventedParent;y&&(ke(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof Qt&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,o){return this._eventedParent=e,this._eventedParentData=o,this}}var It=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Xn(r,...e){for(const o of e)for(const l in o)r[l]=o[l];return r}function ui(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Wn(r){if(Array.isArray(r))return r.map(Wn);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const o in r)e[o]=Wn(r[o]);return e}return ui(r)}class lr extends Error{constructor(e,o){super(o),this.message=o,this.key=e}}var Je=lr;class rt{constructor(e,o=[]){this.parent=e,this.bindings={};for(const[l,f]of o)this.bindings[l]=f}concat(e){return new rt(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var we=rt;const ut={kind:"null"},dt={kind:"number"},Lt={kind:"string"},gn={kind:"boolean"},ti={kind:"color"},di={kind:"object"},Kn={kind:"value"},Xi={kind:"collator"},J={kind:"formatted"},be={kind:"resolvedImage"};function ft(r,e){return{kind:"array",itemType:r,N:e}}function mt(r){if("array"===r.kind){const e=mt(r.itemType);return"number"==typeof r.N?`array<${e}, ${r.N}>`:"value"===r.itemType.kind?"array":`array<${e}>`}return r.kind}const yn=[ut,dt,Lt,gn,ti,J,di,ft(Kn),be];function jt(r,e){if("error"===e.kind)return null;if("array"===r.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!jt(r.itemType,e.itemType))&&("number"!=typeof r.N||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if("value"===r.kind)for(const o of yn)if(!jt(o,e))return null}return`Expected ${mt(r)} but found ${mt(e)} instead.`}function Fn(r,e){return e.some(o=>o.kind===r.kind)}function $n(r,e){return e.some(o=>"null"===o?null===r:"array"===o?Array.isArray(r):"object"===o?r&&!Array.isArray(r)&&"object"==typeof r:o===typeof r)}var Un,Ln={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ci(r){return(r=Math.round(r))<0?0:r>255?255:r}function Ri(r){return ci("%"===r[r.length-1]?parseFloat(r)/100*255:parseInt(r))}function Gi(r){return(e="%"===r[r.length-1]?parseFloat(r)/100:parseFloat(r))<0?0:e>1?1:e;var e}function or(r,e,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?r+(e-r)*o*6:2*o<1?e:3*o<2?r+(e-r)*(2/3-o)*6:r}try{Un={}.parseCSSColor=function(r){var e,o=r.replace(/ /g,"").toLowerCase();if(o in Ln)return Ln[o].slice();if("#"===o[0])return 4===o.length?(e=parseInt(o.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===o.length&&(e=parseInt(o.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=o.indexOf("("),f=o.indexOf(")");if(-1!==l&&f+1===o.length){var _=o.substr(0,l),y=o.substr(l+1,f-(l+1)).split(","),w=1;switch(_){case"rgba":if(4!==y.length)return null;w=Gi(y.pop());case"rgb":return 3!==y.length?null:[Ri(y[0]),Ri(y[1]),Ri(y[2]),w];case"hsla":if(4!==y.length)return null;w=Gi(y.pop());case"hsl":if(3!==y.length)return null;var E=(parseFloat(y[0])%360+360)%360/360,D=Gi(y[1]),L=Gi(y[2]),B=L<=.5?L*(D+1):L+D-L*D,V=2*L-B;return[ci(255*or(V,B,E+1/3)),ci(255*or(V,B,E)),ci(255*or(V,B,E-1/3)),w];default:return null}}return null}}catch{}class ur{constructor(e,o,l,f=1){this.r=e,this.g=o,this.b=l,this.a=f}static parse(e){if(!e)return;if(e instanceof ur)return e;if("string"!=typeof e)return;const o=Un(e);return o?new ur(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[e,o,l,f]=this.toArray();return`rgba(${Math.round(e)},${Math.round(o)},${Math.round(l)},${f})`}toArray(){const{r:e,g:o,b:l,a:f}=this;return 0===f?[0,0,0,0]:[255*e/f,255*o/f,255*l/f,f]}toArray01(){const{r:e,g:o,b:l,a:f}=this;return 0===f?[0,0,0,0]:[e/f,o/f,l/f,f]}toArray01PremultipliedAlpha(){const{r:e,g:o,b:l,a:f}=this;return[e,o,l,f]}}ur.black=new ur(0,0,0,1),ur.white=new ur(1,1,1,1),ur.transparent=new ur(0,0,0,0),ur.red=new ur(1,0,0,1),ur.blue=new ur(0,0,1,1);var R=ur;class $e{constructor(e,o,l){this.sensitivity=e?o?"variant":"case":o?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,o){return this.collator.compare(e,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class H{constructor(e,o,l,f,_){this.text=e.normalize?e.normalize():e,this.image=o,this.scale=l,this.fontStack=f,this.textColor=_}}class Ze{constructor(e){this.sections=e}static fromString(e){return new Ze([new H(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Ze?e:Ze.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const o of this.sections){if(o.image){e.push(["image",o.image.name]);continue}e.push(o.text);const l={};o.fontStack&&(l["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(l["font-scale"]=o.scale),o.textColor&&(l["text-color"]=["rgba"].concat(o.textColor.toArray())),e.push(l)}return e}}class Bt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Bt({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Vi(r,e,o,l){return"number"==typeof r&&r>=0&&r<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof o&&o>=0&&o<=255?void 0===l||"number"==typeof l&&l>=0&&l<=1?null:`Invalid rgba value [${[r,e,o,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof l?[r,e,o,l]:[r,e,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Tr(r){if(null===r||"string"==typeof r||"boolean"==typeof r||"number"==typeof r||r instanceof R||r instanceof $e||r instanceof Ze||r instanceof Bt)return!0;if(Array.isArray(r)){for(const e of r)if(!Tr(e))return!1;return!0}if("object"==typeof r){for(const e in r)if(!Tr(r[e]))return!1;return!0}return!1}function ji(r){if(null===r)return ut;if("string"==typeof r)return Lt;if("boolean"==typeof r)return gn;if("number"==typeof r)return dt;if(r instanceof R)return ti;if(r instanceof $e)return Xi;if(r instanceof Ze)return J;if(r instanceof Bt)return be;if(Array.isArray(r)){const e=r.length;let o;for(const l of r){const f=ji(l);if(o){if(o===f)continue;o=Kn;break}o=f}return ft(o||Kn,e)}return di}function Ko(r){const e=typeof r;return null===r?"":"string"===e||"number"===e||"boolean"===e?String(r):r instanceof R||r instanceof Ze||r instanceof Bt?r.toString():JSON.stringify(r)}class Mo{constructor(e,o){this.type=e,this.value=o}static parse(e,o){if(2!==e.length)return o.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Tr(e[1]))return o.error("invalid value");const l=e[1];let f=ji(l);const _=o.expectedType;return"array"!==f.kind||0!==f.N||!_||"array"!==_.kind||"number"==typeof _.N&&0!==_.N||(f=_),new Mo(f,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof R?["rgba"].concat(this.value.toArray()):this.value instanceof Ze?this.value.serialize():this.value}}var Ns=Mo,cr=class{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}};const Bs={string:Lt,number:dt,boolean:gn,object:di};class _r{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");let l,f=1;const _=e[0];if("array"===_){let w,E;if(e.length>2){const D=e[1];if("string"!=typeof D||!(D in Bs)||"object"===D)return o.error('The item type argument of "array" must be one of string, number, boolean',1);w=Bs[D],f++}else w=Kn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return o.error('The length argument to "array" must be a positive integer literal',2);E=e[2],f++}l=ft(w,E)}else l=Bs[_];const y=[];for(;f<e.length;f++){const w=o.parse(e[f],f,Kn);if(!w)return null;y.push(w)}return new _r(l,y)}evaluate(e){for(let o=0;o<this.args.length;o++){const l=this.args[o].evaluate(e);if(!jt(this.type,ji(l)))return l;if(o===this.args.length-1)throw new cr(`Expected value to be of type ${mt(this.type)}, but found ${mt(ji(l))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,o=[e.kind];if("array"===e.kind){const l=e.itemType;if("string"===l.kind||"number"===l.kind||"boolean"===l.kind){o.push(l.kind);const f=e.N;("number"==typeof f||this.args.length>1)&&o.push(f)}}return o.concat(this.args.map(l=>l.serialize()))}}var Uo=_r;class jo{constructor(e){this.type=J,this.sections=e}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&"object"==typeof l)return o.error("First argument must be an image or text section.");const f=[];let _=!1;for(let y=1;y<=e.length-1;++y){const w=e[y];if(_&&"object"==typeof w&&!Array.isArray(w)){_=!1;let E=null;if(w["font-scale"]&&(E=o.parse(w["font-scale"],1,dt),!E))return null;let D=null;if(w["text-font"]&&(D=o.parse(w["text-font"],1,ft(Lt)),!D))return null;let L=null;if(w["text-color"]&&(L=o.parse(w["text-color"],1,ti),!L))return null;const B=f[f.length-1];B.scale=E,B.font=D,B.textColor=L}else{const E=o.parse(e[y],1,Kn);if(!E)return null;const D=E.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,f.push({content:E,scale:null,font:null,textColor:null})}}return new jo(f)}evaluate(e){return new Ze(this.sections.map(o=>{const l=o.content.evaluate(e);return ji(l)===be?new H("",l,null,null,null):new H(Ko(l),null,o.scale?o.scale.evaluate(e):null,o.font?o.font.evaluate(e).join(","):null,o.textColor?o.textColor.evaluate(e):null)}))}eachChild(e){for(const o of this.sections)e(o.content),o.scale&&e(o.scale),o.font&&e(o.font),o.textColor&&e(o.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const o of this.sections){e.push(o.content.serialize());const l={};o.scale&&(l["font-scale"]=o.scale.serialize()),o.font&&(l["text-font"]=o.font.serialize()),o.textColor&&(l["text-color"]=o.textColor.serialize()),e.push(l)}return e}}class Go{constructor(e){this.type=be,this.input=e}static parse(e,o){if(2!==e.length)return o.error("Expected two arguments.");const l=o.parse(e[1],1,Lt);return l?new Go(l):o.error("No image name provided.")}evaluate(e){const o=this.input.evaluate(e),l=Bt.fromString(o);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(o)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Al={"to-boolean":gn,"to-color":ti,"to-number":dt,"to-string":Lt};class $a{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const l=e[0];if(("to-boolean"===l||"to-string"===l)&&2!==e.length)return o.error("Expected one argument.");const f=Al[l],_=[];for(let y=1;y<e.length;y++){const w=o.parse(e[y],y,Kn);if(!w)return null;_.push(w)}return new $a(f,_)}evaluate(e){if("boolean"===this.type.kind)return!!this.args[0].evaluate(e);if("color"===this.type.kind){let o,l;for(const f of this.args){if(o=f.evaluate(e),l=null,o instanceof R)return o;if("string"==typeof o){const _=e.parseColor(o);if(_)return _}else if(Array.isArray(o)&&(l=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Vi(o[0],o[1],o[2],o[3]),!l))return new R(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new cr(l||`Could not parse color from value '${"string"==typeof o?o:String(JSON.stringify(o))}'`)}if("number"===this.type.kind){let o=null;for(const l of this.args){if(o=l.evaluate(e),null===o)return 0;const f=Number(o);if(!isNaN(f))return f}throw new cr(`Could not convert ${JSON.stringify(o)} to number.`)}return"formatted"===this.type.kind?Ze.fromString(Ko(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Bt.fromString(Ko(this.args[0].evaluate(e))):Ko(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new jo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Go(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(o=>{e.push(o.serialize())}),e}}var zs=$a;const lo=["Unknown","Point","LineString","Polygon"];var Aa=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?lo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:o,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*e-r[0])+this.featureDistanceData.bearing[1]*(l*e-r[1])}return 0}parseColor(r){let e=this._parseColorCache[r];return e||(e=this._parseColorCache[r]=R.parse(r)),e}};class fo{constructor(e,o,l,f){this.name=e,this.type=o,this._evaluate=l,this.args=f}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,o){const l=e[0],f=fo.definitions[l];if(!f)return o.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=y.filter(([D])=>!Array.isArray(D)||D.length===e.length-1);let E=null;for(const[D,L]of w){E=new Rl(o.registry,o.path,null,o.scope);const B=[];let V=!1;for(let Y=1;Y<e.length;Y++){const Q=e[Y],he=Array.isArray(D)?D[Y-1]:D.type,Ue=E.parse(Q,1+B.length,he);if(!Ue){V=!0;break}B.push(Ue)}if(!V)if(Array.isArray(D)&&D.length!==B.length)E.error(`Expected ${D.length} arguments, but found ${B.length} instead.`);else{for(let Y=0;Y<B.length;Y++){const Q=Array.isArray(D)?D[Y]:D.type,he=B[Y];E.concat(Y+1).checkSubtype(Q,he.type)}if(0===E.errors.length)return new fo(l,_,L,B)}}if(1===w.length)o.errors.push(...E.errors);else{const D=(w.length?w:y).map(([B])=>{return V=B,Array.isArray(V)?`(${V.map(mt).join(", ")})`:`(${mt(V.type)}...)`;var V}).join(" | "),L=[];for(let B=1;B<e.length;B++){const V=o.parse(e[B],1+L.length);if(!V)return null;L.push(mt(V.type))}o.error(`Expected arguments of type ${D}, but found (${L.join(", ")}) instead.`)}return null}static register(e,o){fo.definitions=o;for(const l in o)e[l]=fo}}var po=fo;class mr{constructor(e,o,l){this.type=Xi,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=o}static parse(e,o){if(2!==e.length)return o.error("Expected one argument.");const l=e[1];if("object"!=typeof l||Array.isArray(l))return o.error("Collator options argument must be an object.");const f=o.parse(void 0!==l["case-sensitive"]&&l["case-sensitive"],1,gn);if(!f)return null;const _=o.parse(void 0!==l["diacritic-sensitive"]&&l["diacritic-sensitive"],1,gn);if(!_)return null;let y=null;return l.locale&&(y=o.parse(l.locale,1,Lt),!y)?null:new mr(f,_,y)}evaluate(e){return new $e(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Lo=8192;function ns(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function ha(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function ws(r,e){const o=(180+r[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,f=Math.pow(2,e.z);return[Math.round(o*f*Lo),Math.round(l*f*Lo)]}function na(r,e,o){const l=r[0]-e[0],f=r[1]-e[1],_=r[0]-o[0],y=r[1]-o[1];return l*y-_*f==0&&l*_<=0&&f*y<=0}function Us(r,e){let o=!1;for(let y=0,w=e.length;y<w;y++){const E=e[y];for(let D=0,L=E.length;D<L-1;D++){if(na(r,E[D],E[D+1]))return!1;(f=E[D])[1]>(l=r)[1]!=(_=E[D+1])[1]>l[1]&&l[0]<(_[0]-f[0])*(l[1]-f[1])/(_[1]-f[1])+f[0]&&(o=!o)}}var l,f,_;return o}function Za(r,e){for(let o=0;o<e.length;o++)if(Us(r,e[o]))return!0;return!1}function fl(r,e,o,l){const f=l[0]-o[0],_=l[1]-o[1],y=(r[0]-o[0])*_-f*(r[1]-o[1]),w=(e[0]-o[0])*_-f*(e[1]-o[1]);return y>0&&w<0||y<0&&w>0}function cs(r,e,o){for(const D of o)for(let L=0;L<D.length-1;++L)if((w=[(y=D[L+1])[0]-(_=D[L])[0],y[1]-_[1]])[0]*(E=[(f=e)[0]-(l=r)[0],f[1]-l[1]])[1]-w[1]*E[0]!=0&&fl(l,f,_,y)&&fl(_,y,l,f))return!0;var l,f,_,y,w,E;return!1}function vr(r,e){for(let o=0;o<r.length;++o)if(!Us(r[o],e))return!1;for(let o=0;o<r.length-1;++o)if(cs(r[o],r[o+1],e))return!1;return!0}function Sl(r,e){for(let o=0;o<e.length;o++)if(vr(r,e[o]))return!0;return!1}function Xo(r,e,o){const l=[];for(let f=0;f<r.length;f++){const _=[];for(let y=0;y<r[f].length;y++){const w=ws(r[f][y],o);ns(e,w),_.push(w)}l.push(_)}return l}function Ql(r,e,o){const l=[];for(let f=0;f<r.length;f++){const _=Xo(r[f],e,o);l.push(_)}return l}function Ga(r,e,o,l){if(r[0]<o[0]||r[0]>o[2]){const f=.5*l;let _=r[0]-o[0]>f?-l:o[0]-r[0]>f?l:0;0===_&&(_=r[0]-o[2]>f?-l:o[2]-r[0]>f?l:0),r[0]+=_}ns(e,r)}function Pl(r,e,o,l){const f=Math.pow(2,l.z)*Lo,_=[l.x*Lo,l.y*Lo],y=[];if(!r)return y;for(const w of r)for(const E of w){const D=[E.x+_[0],E.y+_[1]];Ga(D,e,o,f),y.push(D)}return y}function fa(r,e,o,l){const f=Math.pow(2,l.z)*Lo,_=[l.x*Lo,l.y*Lo],y=[];if(!r)return y;for(const E of r){const D=[];for(const L of E){const B=[L.x+_[0],L.y+_[1]];ns(e,B),D.push(B)}y.push(D)}if(e[2]-e[0]<=f/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of y)for(const D of E)Ga(D,e,o,f)}var w;return y}class pa{constructor(e,o){this.type=gn,this.geojson=e,this.geometries=o}static parse(e,o){if(2!==e.length)return o.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Tr(e[1])){const l=e[1];if("FeatureCollection"===l.type)for(let f=0;f<l.features.length;++f){const _=l.features[f].geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new pa(l,l.features[f].geometry)}else if("Feature"===l.type){const f=l.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new pa(l,l.geometry)}else if("Polygon"===l.type||"MultiPolygon"===l.type)return new pa(l,l)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(o,l){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(!y)return!1;if("Polygon"===l.type){const w=Xo(l.coordinates,_,y),E=Pl(o.geometry(),f,_,y);if(!ha(f,_))return!1;for(const D of E)if(!Us(D,w))return!1}if("MultiPolygon"===l.type){const w=Ql(l.coordinates,_,y),E=Pl(o.geometry(),f,_,y);if(!ha(f,_))return!1;for(const D of E)if(!Za(D,w))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(o,l){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(!y)return!1;if("Polygon"===l.type){const w=Xo(l.coordinates,_,y),E=fa(o.geometry(),f,_,y);if(!ha(f,_))return!1;for(const D of E)if(!vr(D,w))return!1}if("MultiPolygon"===l.type){const w=Ql(l.coordinates,_,y),E=fa(o.geometry(),f,_,y);if(!ha(f,_))return!1;for(const D of E)if(!Sl(D,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Ha=pa;function js(r){if(r instanceof po&&("get"===r.name&&1===r.args.length||"feature-state"===r.name||"has"===r.name&&1===r.args.length||"properties"===r.name||"geometry-type"===r.name||"id"===r.name||/^filter-/.test(r.name))||r instanceof Ha)return!1;let e=!0;return r.eachChild(o=>{e&&!js(o)&&(e=!1)}),e}function bo(r){if(r instanceof po&&"feature-state"===r.name)return!1;let e=!0;return r.eachChild(o=>{e&&!bo(o)&&(e=!1)}),e}function Sa(r,e){if(r instanceof po&&e.indexOf(r.name)>=0)return!1;let o=!0;return r.eachChild(l=>{o&&!Sa(l,e)&&(o=!1)}),o}class ia{constructor(e,o){this.type=o.type,this.name=e,this.boundExpression=o}static parse(e,o){if(2!==e.length||"string"!=typeof e[1])return o.error("'var' expression requires exactly one string literal argument.");const l=e[1];return o.scope.has(l)?new ia(l,o.scope.get(l)):o.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ol=ia;class Wa{constructor(e,o=[],l,f=new we,_=[]){this.registry=e,this.path=o,this.key=o.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=_,this.expectedType=l}parse(e,o,l,f,_={}){return o?this.concat(o,l,f)._parse(e,_):this._parse(e,_)}_parse(e,o){function l(f,_,y){return"assert"===y?new Uo(_,[f]):"coerce"===y?new zs(_,[f]):f}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=e[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[f];if(_){let y=_.parse(e,this);if(!y)return null;if(this.expectedType){const w=this.expectedType,E=y.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==E.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(w,E))return null}else y=l(y,w,o.typeAnnotation||"coerce");else y=l(y,w,o.typeAnnotation||"assert")}if(!(y instanceof Ns)&&"resolvedImage"!==y.type.kind&&qa(y)){const w=new Aa;try{y=new Ns(y.type,y.evaluate(w))}catch(E){return this.error(E.message),null}}return y}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,o,l){const f="number"==typeof e?this.path.concat(e):this.path,_=l?this.scope.concat(l):this.scope;return new Wa(this.registry,f,o||null,_,this.errors)}error(e,...o){const l=`${this.key}${o.map(f=>`[${f}]`).join("")}`;this.errors.push(new Je(l,e))}checkSubtype(e,o){const l=jt(e,o);return l&&this.error(l),l}}var Rl=Wa;function qa(r){if(r instanceof Ol)return qa(r.boundExpression);if(r instanceof po&&"error"===r.name||r instanceof mr||r instanceof Ha)return!1;const e=r instanceof zs||r instanceof Uo;let o=!0;return r.eachChild(l=>{o=e?o&&qa(l):o&&l instanceof Ns}),!!o&&js(r)&&Sa(r,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ma(r,e){const o=r.length-1;let l,f,_=0,y=o,w=0;for(;_<=y;)if(w=Math.floor((_+y)/2),l=r[w],f=r[w+1],l<=e){if(w===o||e<f)return w;_=w+1}else{if(!(l>e))throw new cr("Input is not a number.");y=w-1}return 0}class Ya{constructor(e,o,l){this.type=e,this.input=o,this.labels=[],this.outputs=[];for(const[f,_]of l)this.labels.push(f),this.outputs.push(_)}static parse(e,o){if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");const l=o.parse(e[1],1,dt);if(!l)return null;const f=[];let _=null;o.expectedType&&"value"!==o.expectedType.kind&&(_=o.expectedType);for(let y=1;y<e.length;y+=2){const w=1===y?-1/0:e[y],E=e[y+1],D=y,L=y+1;if("number"!=typeof w)return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(f.length&&f[f.length-1][0]>=w)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const B=o.parse(E,L,_);if(!B)return null;_=_||B.type,f.push([w,B])}return new Ya(_,l,f)}evaluate(e){const o=this.labels,l=this.outputs;if(1===o.length)return l[0].evaluate(e);const f=this.input.evaluate(e);if(f<=o[0])return l[0].evaluate(e);const _=o.length;return f>=o[_-1]?l[_-1].evaluate(e):l[ma(o,f)].evaluate(e)}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&e.push(this.labels[o]),e.push(this.outputs[o].serialize());return e}}var pl=Ya;function _i(r,e,o){return r*(1-o)+e*o}var Br=Object.freeze({__proto__:null,array:function(r,e,o){return r.map((l,f)=>_i(l,e[f],o))},color:function(r,e,o){return new R(_i(r.r,e.r,o),_i(r.g,e.g,o),_i(r.b,e.b,o),_i(r.a,e.a,o))},number:_i});const ue=4/29,W=6/29,He=3*W*W,zt=W*W*W,vi=Math.PI/180,dr=180/Math.PI;function wr(r){return r>zt?Math.pow(r,1/3):r/He+ue}function ai(r){return r>W?r*r*r:He*(r-ue)}function Ni(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Jr(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function us(r){const e=Jr(r.r),o=Jr(r.g),l=Jr(r.b),f=wr((.4124564*e+.3575761*o+.1804375*l)/.95047),_=wr((.2126729*e+.7151522*o+.072175*l)/1);return{l:116*_-16,a:500*(f-_),b:200*(_-wr((.0193339*e+.119192*o+.9503041*l)/1.08883)),alpha:r.a}}function wo(r){let e=(r.l+16)/116,o=isNaN(r.a)?e:e+r.a/500,l=isNaN(r.b)?e:e-r.b/200;return e=1*ai(e),o=.95047*ai(o),l=1.08883*ai(l),new R(Ni(3.2404542*o-1.5371385*e-.4985314*l),Ni(-.969266*o+1.8760108*e+.041556*l),Ni(.0556434*o-.2040259*e+1.0572252*l),r.alpha)}function Ho(r,e,o){const l=e-r;return r+o*(l>180||l<-180?l-360*Math.round(l/360):l)}const ra={forward:us,reverse:wo,interpolate:function(r,e,o){return{l:_i(r.l,e.l,o),a:_i(r.a,e.a,o),b:_i(r.b,e.b,o),alpha:_i(r.alpha,e.alpha,o)}}},Ar={forward:function(r){const{l:e,a:o,b:l}=us(r),f=Math.atan2(l,o)*dr;return{h:f<0?f+360:f,c:Math.sqrt(o*o+l*l),l:e,alpha:r.a}},reverse:function(r){const e=r.h*vi,o=r.c;return wo({l:r.l,a:Math.cos(e)*o,b:Math.sin(e)*o,alpha:r.alpha})},interpolate:function(r,e,o){return{h:Ho(r.h,e.h,o),c:_i(r.c,e.c,o),l:_i(r.l,e.l,o),alpha:_i(r.alpha,e.alpha,o)}}};var Vo=Object.freeze({__proto__:null,hcl:Ar,lab:ra});class Cs{constructor(e,o,l,f,_){this.type=e,this.operator=o,this.interpolation=l,this.input=f,this.labels=[],this.outputs=[];for(const[y,w]of _)this.labels.push(y),this.outputs.push(w)}static interpolationFactor(e,o,l,f){let _=0;if("exponential"===e.name)_=Yi(o,e.base,l,f);else if("linear"===e.name)_=Yi(o,1,l,f);else if("cubic-bezier"===e.name){const y=e.controlPoints;_=new Pe(y[0],y[1],y[2],y[3]).solve(Yi(o,1,l,f))}return _}static parse(e,o){let[l,f,_,...y]=e;if(!Array.isArray(f)||0===f.length)return o.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const D=f[1];if("number"!=typeof D)return o.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:D}}else{if("cubic-bezier"!==f[0])return o.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const D=f.slice(1);if(4!==D.length||D.some(L=>"number"!=typeof L||L<0||L>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(_=o.parse(_,2,dt),!_)return null;const w=[];let E=null;"interpolate-hcl"===l||"interpolate-lab"===l?E=ti:o.expectedType&&"value"!==o.expectedType.kind&&(E=o.expectedType);for(let D=0;D<y.length;D+=2){const L=y[D],B=y[D+1],V=D+3,Y=D+4;if("number"!=typeof L)return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(w.length&&w[w.length-1][0]>=L)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const Q=o.parse(B,Y,E);if(!Q)return null;E=E||Q.type,w.push([L,Q])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new Cs(E,l,f,_,w):o.error(`Type ${mt(E)} is not interpolatable.`)}evaluate(e){const o=this.labels,l=this.outputs;if(1===o.length)return l[0].evaluate(e);const f=this.input.evaluate(e);if(f<=o[0])return l[0].evaluate(e);const _=o.length;if(f>=o[_-1])return l[_-1].evaluate(e);const y=ma(o,f),w=Cs.interpolationFactor(this.interpolation,f,o[y],o[y+1]),E=l[y].evaluate(e),D=l[y+1].evaluate(e);return"interpolate"===this.operator?Br[this.type.kind.toLowerCase()](E,D,w):"interpolate-hcl"===this.operator?Ar.reverse(Ar.interpolate(Ar.forward(E),Ar.forward(D),w)):ra.reverse(ra.interpolate(ra.forward(E),ra.forward(D),w))}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)o.push(this.labels[l],this.outputs[l].serialize());return o}}function Yi(r,e,o,l){const f=l-o,_=r-o;return 0===f?0:1===e?_/f:(Math.pow(e,_)-1)/(Math.pow(e,f)-1)}var Qo=Cs;class Pa{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expectected at least one argument.");let l=null;const f=o.expectedType;f&&"value"!==f.kind&&(l=f);const _=[];for(const w of e.slice(1)){const E=o.parse(w,1+_.length,l,void 0,{typeAnnotation:"omit"});if(!E)return null;l=l||E.type,_.push(E)}const y=f&&_.some(w=>jt(f,w.type));return new Pa(y?Kn:l,_)}evaluate(e){let o,l=null,f=0;for(const _ of this.args){if(f++,l=_.evaluate(e),l&&l instanceof Bt&&!l.available&&(o||(o=l),l=null,f===this.args.length))return o;if(null!==l)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(o=>{e.push(o.serialize())}),e}}var ds=Pa;class Xr{constructor(e,o){this.type=o.type,this.bindings=[].concat(e),this.result=o}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const o of this.bindings)e(o[1]);e(this.result)}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let _=1;_<e.length-1;_+=2){const y=e[_];if("string"!=typeof y)return o.error(`Expected string, but found ${typeof y} instead.`,_);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",_);const w=o.parse(e[_+1],_+1);if(!w)return null;l.push([y,w])}const f=o.parse(e[e.length-1],e.length-1,o.expectedType,l);return f?new Xr(l,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[o,l]of this.bindings)e.push(o,l.serialize());return e.push(this.result.serialize()),e}}var Ja=Xr;class oa{constructor(e,o,l){this.type=e,this.index=o,this.input=l}static parse(e,o){if(3!==e.length)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=o.parse(e[1],1,dt),f=o.parse(e[2],2,ft(o.expectedType||Kn));return l&&f?new oa(f.type.itemType,l,f):null}evaluate(e){const o=this.index.evaluate(e),l=this.input.evaluate(e);if(o<0)throw new cr(`Array index out of bounds: ${o} < 0.`);if(o>=l.length)throw new cr(`Array index out of bounds: ${o} > ${l.length-1}.`);if(o!==Math.floor(o))throw new cr(`Array index must be an integer, but found ${o} instead.`);return l[o]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var is=oa;class ga{constructor(e,o){this.type=gn,this.needle=e,this.haystack=o}static parse(e,o){if(3!==e.length)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=o.parse(e[1],1,Kn),f=o.parse(e[2],2,Kn);return l&&f?Fn(l.type,[gn,Lt,dt,ut,Kn])?new ga(l,f):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${mt(l.type)} instead`):null}evaluate(e){const o=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(null==l)return!1;if(!$n(o,["boolean","string","number","null"]))throw new cr(`Expected first argument to be of type boolean, string, number or null, but found ${mt(ji(o))} instead.`);if(!$n(l,["string","array"]))throw new cr(`Expected second argument to be of type array or string, but found ${mt(ji(l))} instead.`);return l.indexOf(o)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var sa=ga;class Es{constructor(e,o,l){this.type=dt,this.needle=e,this.haystack=o,this.fromIndex=l}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=o.parse(e[1],1,Kn),f=o.parse(e[2],2,Kn);if(!l||!f)return null;if(!Fn(l.type,[gn,Lt,dt,ut,Kn]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${mt(l.type)} instead`);if(4===e.length){const _=o.parse(e[3],3,dt);return _?new Es(l,f,_):null}return new Es(l,f)}evaluate(e){const o=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!$n(o,["boolean","string","number","null"]))throw new cr(`Expected first argument to be of type boolean, string, number or null, but found ${mt(ji(o))} instead.`);if(!$n(l,["string","array"]))throw new cr(`Expected second argument to be of type array or string, but found ${mt(ji(l))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(e);return l.indexOf(o,f)}return l.indexOf(o)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ll=Es;class _a{constructor(e,o,l,f,_,y){this.inputType=e,this.type=o,this.input=l,this.cases=f,this.outputs=_,this.otherwise=y}static parse(e,o){if(e.length<5)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return o.error("Expected an even number of arguments.");let l,f;o.expectedType&&"value"!==o.expectedType.kind&&(f=o.expectedType);const _={},y=[];for(let D=2;D<e.length-1;D+=2){let L=e[D];const B=e[D+1];Array.isArray(L)||(L=[L]);const V=o.concat(D);if(0===L.length)return V.error("Expected at least one branch label.");for(const Q of L){if("number"!=typeof Q&&"string"!=typeof Q)return V.error("Branch labels must be numbers or strings.");if("number"==typeof Q&&Math.abs(Q)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof Q&&Math.floor(Q)!==Q)return V.error("Numeric branch labels must be integer values.");if(l){if(V.checkSubtype(l,ji(Q)))return null}else l=ji(Q);if(void 0!==_[String(Q)])return V.error("Branch labels must be unique.");_[String(Q)]=y.length}const Y=o.parse(B,D,f);if(!Y)return null;f=f||Y.type,y.push(Y)}const w=o.parse(e[1],1,Kn);if(!w)return null;const E=o.parse(e[e.length-1],e.length-1,f);return E?"value"!==w.type.kind&&o.concat(1).checkSubtype(l,w.type)?null:new _a(l,f,w,_,y,E):null}evaluate(e){const o=this.input.evaluate(e);return(ji(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),l=[],f={};for(const y of o){const w=f[this.cases[y]];void 0===w?(f[this.cases[y]]=l.length,l.push([this.cases[y],[y]])):l[w][1].push(y)}const _=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,w]of l)e.push(1===w.length?_(w[0]):w.map(_)),e.push(this.outputs[y].serialize());return e.push(this.otherwise.serialize()),e}}var er=_a;class Ka{constructor(e,o,l){this.type=e,this.branches=o,this.otherwise=l}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return o.error("Expected an odd number of arguments.");let l;o.expectedType&&"value"!==o.expectedType.kind&&(l=o.expectedType);const f=[];for(let y=1;y<e.length-1;y+=2){const w=o.parse(e[y],y,gn);if(!w)return null;const E=o.parse(e[y+1],y+1,l);if(!E)return null;f.push([w,E]),l=l||E.type}const _=o.parse(e[e.length-1],e.length-1,l);return _?new Ka(l,f,_):null}evaluate(e){for(const[o,l]of this.branches)if(o.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[o,l]of this.branches)e(o),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(o=>{e.push(o.serialize())}),e}}var ml=Ka;class Wo{constructor(e,o,l,f){this.type=e,this.input=o,this.beginIndex=l,this.endIndex=f}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=o.parse(e[1],1,Kn),f=o.parse(e[2],2,dt);if(!l||!f)return null;if(!Fn(l.type,[ft(Kn),Lt,Kn]))return o.error(`Expected first argument to be of type array or string, but found ${mt(l.type)} instead`);if(4===e.length){const _=o.parse(e[3],3,dt);return _?new Wo(l.type,l,f,_):null}return new Wo(l.type,l,f)}evaluate(e){const o=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!$n(o,["string","array"]))throw new cr(`Expected first argument to be of type array or string, but found ${mt(ji(o))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(e);return o.slice(l,f)}return o.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var gl=Wo;function aa(r,e){return"=="===r||"!="===r?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function mo(r,e,o,l){return 0===l.compare(e,o)}function Ts(r,e,o){const l="=="!==r&&"!="!==r;return class fC{constructor(_,y,w){this.type=gn,this.lhs=_,this.rhs=y,this.collator=w,this.hasUntypedArgument="value"===_.type.kind||"value"===y.type.kind}static parse(_,y){if(3!==_.length&&4!==_.length)return y.error("Expected two or three arguments.");const w=_[0];let E=y.parse(_[1],1,Kn);if(!E)return null;if(!aa(w,E.type))return y.concat(1).error(`"${w}" comparisons are not supported for type '${mt(E.type)}'.`);let D=y.parse(_[2],2,Kn);if(!D)return null;if(!aa(w,D.type))return y.concat(2).error(`"${w}" comparisons are not supported for type '${mt(D.type)}'.`);if(E.type.kind!==D.type.kind&&"value"!==E.type.kind&&"value"!==D.type.kind)return y.error(`Cannot compare types '${mt(E.type)}' and '${mt(D.type)}'.`);l&&("value"===E.type.kind&&"value"!==D.type.kind?E=new Uo(D.type,[E]):"value"!==E.type.kind&&"value"===D.type.kind&&(D=new Uo(E.type,[D])));let L=null;if(4===_.length){if("string"!==E.type.kind&&"string"!==D.type.kind&&"value"!==E.type.kind&&"value"!==D.type.kind)return y.error("Cannot use collator to compare non-string types.");if(L=y.parse(_[3],3,Xi),!L)return null}return new fC(E,D,L)}evaluate(_){const y=this.lhs.evaluate(_),w=this.rhs.evaluate(_);if(l&&this.hasUntypedArgument){const E=ji(y),D=ji(w);if(E.kind!==D.kind||"string"!==E.kind&&"number"!==E.kind)throw new cr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${E.kind}, ${D.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const E=ji(y),D=ji(w);if("string"!==E.kind||"string"!==D.kind)return e(_,y,w)}return this.collator?o(_,y,w,this.collator.evaluate(_)):e(_,y,w)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[r];return this.eachChild(y=>{_.push(y.serialize())}),_}}}const ko=Ts("==",function(r,e,o){return e===o},mo),go=Ts("!=",function(r,e,o){return e!==o},function(r,e,o,l){return!mo(0,e,o,l)}),bc=Ts("<",function(r,e,o){return e<o},function(r,e,o,l){return l.compare(e,o)<0}),Xa=Ts(">",function(r,e,o){return e>o},function(r,e,o,l){return l.compare(e,o)>0}),ec=Ts("<=",function(r,e,o){return e<=o},function(r,e,o,l){return l.compare(e,o)<=0}),Ds=Ts(">=",function(r,e,o){return e>=o},function(r,e,o,l){return l.compare(e,o)>=0});class _l{constructor(e,o,l,f,_,y){this.type=Lt,this.number=e,this.locale=o,this.currency=l,this.unit=f,this.minFractionDigits=_,this.maxFractionDigits=y}static parse(e,o){if(3!==e.length)return o.error("Expected two arguments.");const l=o.parse(e[1],1,dt);if(!l)return null;const f=e[2];if("object"!=typeof f||Array.isArray(f))return o.error("NumberFormat options argument must be an object.");let _=null;if(f.locale&&(_=o.parse(f.locale,1,Lt),!_))return null;let y=null;if(f.currency&&(y=o.parse(f.currency,1,Lt),!y))return null;let w=null;if(f.unit&&(w=o.parse(f.unit,1,Lt),!w))return null;let E=null;if(f["min-fraction-digits"]&&(E=o.parse(f["min-fraction-digits"],1,dt),!E))return null;let D=null;return f["max-fraction-digits"]&&(D=o.parse(f["max-fraction-digits"],1,dt),!D)?null:new _l(l,_,y,w,E,D)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class yl{constructor(e){this.type=dt,this.input=e}static parse(e,o){if(2!==e.length)return o.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=o.parse(e[1],1);return l?"array"!==l.type.kind&&"string"!==l.type.kind&&"value"!==l.type.kind?o.error(`Expected argument of type string or array, but found ${mt(l.type)} instead.`):new yl(l):null}evaluate(e){const o=this.input.evaluate(e);if("string"==typeof o||Array.isArray(o))return o.length;throw new cr(`Expected value to be of type string or array, but found ${mt(ji(o))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(o=>{e.push(o.serialize())}),e}}const Jc={"==":ko,"!=":go,">":Xa,"<":bc,">=":Ds,"<=":ec,array:Uo,at:is,boolean:Uo,case:ml,coalesce:ds,collator:mr,format:jo,image:Go,in:sa,"index-of":Ll,interpolate:Qo,"interpolate-hcl":Qo,"interpolate-lab":Qo,length:yl,let:Ja,literal:Ns,match:er,number:Uo,"number-format":_l,object:Uo,slice:gl,step:pl,string:Uo,"to-boolean":zs,"to-color":zs,"to-number":zs,"to-string":zs,var:Ol,within:Ha};function tc(r,[e,o,l,f]){e=e.evaluate(r),o=o.evaluate(r),l=l.evaluate(r);const _=f?f.evaluate(r):1,y=Vi(e,o,l,_);if(y)throw new cr(y);return new R(e/255*_,o/255*_,l/255*_,_)}function Vs(r,e){return r in e}function Qa(r,e){const o=e[r];return void 0===o?null:o}function rs(r){return{type:r}}po.register(Jc,{error:[{kind:"error"},[Lt],(r,[e])=>{throw new cr(e.evaluate(r))}],typeof:[Lt,[Kn],(r,[e])=>mt(ji(e.evaluate(r)))],"to-rgba":[ft(dt,4),[ti],(r,[e])=>e.evaluate(r).toArray()],rgb:[ti,[dt,dt,dt],tc],rgba:[ti,[dt,dt,dt,dt],tc],has:{type:gn,overloads:[[[Lt],(r,[e])=>Vs(e.evaluate(r),r.properties())],[[Lt,di],(r,[e,o])=>Vs(e.evaluate(r),o.evaluate(r))]]},get:{type:Kn,overloads:[[[Lt],(r,[e])=>Qa(e.evaluate(r),r.properties())],[[Lt,di],(r,[e,o])=>Qa(e.evaluate(r),o.evaluate(r))]]},"feature-state":[Kn,[Lt],(r,[e])=>Qa(e.evaluate(r),r.featureState||{})],properties:[di,[],r=>r.properties()],"geometry-type":[Lt,[],r=>r.geometryType()],id:[Kn,[],r=>r.id()],zoom:[dt,[],r=>r.globals.zoom],pitch:[dt,[],r=>r.globals.pitch||0],"distance-from-center":[dt,[],r=>r.distanceFromCenter()],"heatmap-density":[dt,[],r=>r.globals.heatmapDensity||0],"line-progress":[dt,[],r=>r.globals.lineProgress||0],"sky-radial-progress":[dt,[],r=>r.globals.skyRadialProgress||0],accumulated:[Kn,[],r=>void 0===r.globals.accumulated?null:r.globals.accumulated],"+":[dt,rs(dt),(r,e)=>{let o=0;for(const l of e)o+=l.evaluate(r);return o}],"*":[dt,rs(dt),(r,e)=>{let o=1;for(const l of e)o*=l.evaluate(r);return o}],"-":{type:dt,overloads:[[[dt,dt],(r,[e,o])=>e.evaluate(r)-o.evaluate(r)],[[dt],(r,[e])=>-e.evaluate(r)]]},"/":[dt,[dt,dt],(r,[e,o])=>e.evaluate(r)/o.evaluate(r)],"%":[dt,[dt,dt],(r,[e,o])=>e.evaluate(r)%o.evaluate(r)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(r,[e,o])=>Math.pow(e.evaluate(r),o.evaluate(r))],sqrt:[dt,[dt],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[dt,[dt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[dt,[dt],(r,[e])=>Math.log(e.evaluate(r))],log2:[dt,[dt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[dt,[dt],(r,[e])=>Math.sin(e.evaluate(r))],cos:[dt,[dt],(r,[e])=>Math.cos(e.evaluate(r))],tan:[dt,[dt],(r,[e])=>Math.tan(e.evaluate(r))],asin:[dt,[dt],(r,[e])=>Math.asin(e.evaluate(r))],acos:[dt,[dt],(r,[e])=>Math.acos(e.evaluate(r))],atan:[dt,[dt],(r,[e])=>Math.atan(e.evaluate(r))],min:[dt,rs(dt),(r,e)=>Math.min(...e.map(o=>o.evaluate(r)))],max:[dt,rs(dt),(r,e)=>Math.max(...e.map(o=>o.evaluate(r)))],abs:[dt,[dt],(r,[e])=>Math.abs(e.evaluate(r))],round:[dt,[dt],(r,[e])=>{const o=e.evaluate(r);return o<0?-Math.round(-o):Math.round(o)}],floor:[dt,[dt],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[dt,[dt],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[gn,[Lt,Kn],(r,[e,o])=>r.properties()[e.value]===o.value],"filter-id-==":[gn,[Kn],(r,[e])=>r.id()===e.value],"filter-type-==":[gn,[Lt],(r,[e])=>r.geometryType()===e.value],"filter-<":[gn,[Lt,Kn],(r,[e,o])=>{const l=r.properties()[e.value],f=o.value;return typeof l==typeof f&&l<f}],"filter-id-<":[gn,[Kn],(r,[e])=>{const o=r.id(),l=e.value;return typeof o==typeof l&&o<l}],"filter->":[gn,[Lt,Kn],(r,[e,o])=>{const l=r.properties()[e.value],f=o.value;return typeof l==typeof f&&l>f}],"filter-id->":[gn,[Kn],(r,[e])=>{const o=r.id(),l=e.value;return typeof o==typeof l&&o>l}],"filter-<=":[gn,[Lt,Kn],(r,[e,o])=>{const l=r.properties()[e.value],f=o.value;return typeof l==typeof f&&l<=f}],"filter-id-<=":[gn,[Kn],(r,[e])=>{const o=r.id(),l=e.value;return typeof o==typeof l&&o<=l}],"filter->=":[gn,[Lt,Kn],(r,[e,o])=>{const l=r.properties()[e.value],f=o.value;return typeof l==typeof f&&l>=f}],"filter-id->=":[gn,[Kn],(r,[e])=>{const o=r.id(),l=e.value;return typeof o==typeof l&&o>=l}],"filter-has":[gn,[Kn],(r,[e])=>e.value in r.properties()],"filter-has-id":[gn,[],r=>null!==r.id()&&void 0!==r.id()],"filter-type-in":[gn,[ft(Lt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[gn,[ft(Kn)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[gn,[Lt,ft(Kn)],(r,[e,o])=>o.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[gn,[Lt,ft(Kn)],(r,[e,o])=>function(l,f,_,y){for(;_<=y;){const w=_+y>>1;if(f[w]===l)return!0;f[w]>l?y=w-1:_=w+1}return!1}(r.properties()[e.value],o.value,0,o.value.length-1)],all:{type:gn,overloads:[[[gn,gn],(r,[e,o])=>e.evaluate(r)&&o.evaluate(r)],[rs(gn),(r,e)=>{for(const o of e)if(!o.evaluate(r))return!1;return!0}]]},any:{type:gn,overloads:[[[gn,gn],(r,[e,o])=>e.evaluate(r)||o.evaluate(r)],[rs(gn),(r,e)=>{for(const o of e)if(o.evaluate(r))return!0;return!1}]]},"!":[gn,[gn],(r,[e])=>!e.evaluate(r)],"is-supported-script":[gn,[Lt],(r,[e])=>{const o=r.globals&&r.globals.isSupportedScript;return!o||o(e.evaluate(r))}],upcase:[Lt,[Lt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Lt,[Lt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Lt,rs(Kn),(r,e)=>e.map(o=>Ko(o.evaluate(r))).join("")],"resolved-locale":[Lt,[Xi],(r,[e])=>e.evaluate(r).resolvedLocale()]});var F=Jc;function Me(r){return{result:"success",value:r}}function q(r){return{result:"error",value:r}}function fe(r){return"data-driven"===r["property-type"]}function xt(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function vn(r){return!!r.expression&&r.expression.interpolated}function bn(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":null===r?"null":typeof r}function Ti(r){return"object"==typeof r&&null!==r&&!Array.isArray(r)}function Ur(r){return r}function Lr(r,e){const o="color"===e.type,l=r.stops&&"object"==typeof r.stops[0][0],f=l||!(l||void 0!==r.property),_=r.type||(vn(e)?"exponential":"interval");if(o&&((r=Xn({},r)).stops&&(r.stops=r.stops.map(D=>[D[0],R.parse(D[1])])),r.default=R.parse(r.default?r.default:e.default)),r.colorSpace&&"rgb"!==r.colorSpace&&!Vo[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let y,w,E;if("exponential"===_)y=hr;else if("interval"===_)y=Pr;else if("categorical"===_){y=sr,w=Object.create(null);for(const D of r.stops)w[D[0]]=D[1];E=typeof r.stops[0][0]}else{if("identity"!==_)throw new Error(`Unknown function type "${_}"`);y=So}if(l){const D={},L=[];for(let Y=0;Y<r.stops.length;Y++){const Q=r.stops[Y],he=Q[0].zoom;void 0===D[he]&&(D[he]={zoom:he,type:r.type,property:r.property,default:r.default,stops:[]},L.push(he)),D[he].stops.push([Q[0].value,Q[1]])}const B=[];for(const Y of L)B.push([D[Y].zoom,Lr(D[Y],e)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:Qo.interpolationFactor.bind(void 0,V),zoomStops:B.map(Y=>Y[0]),evaluate:({zoom:Y},Q)=>hr({stops:B,base:r.base},e,Y).evaluate(Y,Q)}}if(f){const D="exponential"===_?{name:"exponential",base:void 0!==r.base?r.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Qo.interpolationFactor.bind(void 0,D),zoomStops:r.stops.map(L=>L[0]),evaluate:({zoom:L})=>y(r,e,L,w,E)}}return{kind:"source",evaluate(D,L){const B=L&&L.properties?L.properties[r.property]:void 0;return void 0===B?Sr(r.default,e.default):y(r,e,B,w,E)}}}function Sr(r,e,o){return void 0!==r?r:void 0!==e?e:void 0!==o?o:void 0}function sr(r,e,o,l,f){return Sr(typeof o===f?l[o]:void 0,r.default,e.default)}function Pr(r,e,o){if("number"!==bn(o))return Sr(r.default,e.default);const l=r.stops.length;if(1===l||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[l-1][0])return r.stops[l-1][1];const f=ma(r.stops.map(_=>_[0]),o);return r.stops[f][1]}function hr(r,e,o){const l=void 0!==r.base?r.base:1;if("number"!==bn(o))return Sr(r.default,e.default);const f=r.stops.length;if(1===f||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[f-1][0])return r.stops[f-1][1];const _=ma(r.stops.map(L=>L[0]),o),y=function(L,B,V,Y){const Q=Y-V,he=L-V;return 0===Q?0:1===B?he/Q:(Math.pow(B,he)-1)/(Math.pow(B,Q)-1)}(o,l,r.stops[_][0],r.stops[_+1][0]),w=r.stops[_][1],E=r.stops[_+1][1];let D=Br[e.type]||Ur;if(r.colorSpace&&"rgb"!==r.colorSpace){const L=Vo[r.colorSpace];D=(B,V)=>L.reverse(L.interpolate(L.forward(B),L.forward(V),y))}return"function"==typeof w.evaluate?{evaluate(...L){const B=w.evaluate.apply(void 0,L),V=E.evaluate.apply(void 0,L);if(void 0!==B&&void 0!==V)return D(B,V,y)}}:D(w,E,y)}function So(r,e,o){return"color"===e.type?o=R.parse(o):"formatted"===e.type?o=Ze.fromString(o.toString()):"resolvedImage"===e.type?o=Bt.fromString(o.toString()):bn(o)===e.type||"enum"===e.type&&e.values[o]||(o=void 0),Sr(o,r.default,e.default)}class $s{constructor(e,o){var l;this.expression=e,this._warningHistory={},this._evaluator=new Aa,this._defaultValue=o?"color"===(l=o).type&&(Ti(l.default)||Array.isArray(l.default))?new R(0,0,0,0):"color"===l.type?R.parse(l.default)||null:void 0===l.default?null:l.default:null,this._enumValues=o&&"enum"===o.type?o.values:null}evaluateWithoutErrorHandling(e,o,l,f,_,y,w,E){return this._evaluator.globals=e,this._evaluator.feature=o,this._evaluator.featureState=l,this._evaluator.canonical=f||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(e,o,l,f,_,y,w,E){this._evaluator.globals=e,this._evaluator.feature=o||null,this._evaluator.featureState=l||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=E||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new cr(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function qo(r){return Array.isArray(r)&&r.length>0&&"string"==typeof r[0]&&r[0]in F}function hs(r,e){const o=new Rl(F,[],e?function(f){const _={color:ti,string:Lt,number:dt,enum:Lt,boolean:gn,formatted:J,resolvedImage:be};return"array"===f.type?ft(_[f.value]||Kn,f.length):_[f.type]}(e):void 0),l=o.parse(r,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return l?Me(new $s(l,e)):q(o.errors)}class $o{constructor(e,o){this.kind=e,this._styleExpression=o,this.isStateDependent="constant"!==e&&!bo(o.expression)}evaluateWithoutErrorHandling(e,o,l,f,_,y){return this._styleExpression.evaluateWithoutErrorHandling(e,o,l,f,_,y)}evaluate(e,o,l,f,_,y){return this._styleExpression.evaluate(e,o,l,f,_,y)}}class fs{constructor(e,o,l,f){this.kind=e,this.zoomStops=l,this._styleExpression=o,this.isStateDependent="camera"!==e&&!bo(o.expression),this.interpolationType=f}evaluateWithoutErrorHandling(e,o,l,f,_,y){return this._styleExpression.evaluateWithoutErrorHandling(e,o,l,f,_,y)}evaluate(e,o,l,f,_,y){return this._styleExpression.evaluate(e,o,l,f,_,y)}interpolationFactor(e,o,l){return this.interpolationType?Qo.interpolationFactor(this.interpolationType,e,o,l):0}}function Yo(r,e){if("error"===(r=hs(r,e)).result)return r;const o=r.value.expression,l=js(o);if(!l&&!fe(e))return q([new Je("","data expressions not supported")]);const f=Sa(o,["zoom","pitch","distance-from-center"]);if(!f&&!xt(e))return q([new Je("","zoom expressions not supported")]);const _=el(o);return _||f?_ instanceof Je?q([_]):_ instanceof Qo&&!vn(e)?q([new Je("",'"interpolate" expressions cannot be used with this property')]):Me(_?new fs(l?"camera":"composite",r.value,_.labels,_ instanceof Qo?_.interpolation:void 0):new $o(l?"constant":"source",r.value)):q([new Je("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Zs{constructor(e,o){this._parameters=e,this._specification=o,Xn(this,Lr(this._parameters,this._specification))}static deserialize(e){return new Zs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function el(r){let e=null;if(r instanceof Ja)e=el(r.result);else if(r instanceof ds){for(const o of r.args)if(e=el(o),e)break}else(r instanceof pl||r instanceof Qo)&&r.input instanceof po&&"zoom"===r.input.name&&(e=r);return e instanceof Je||r.eachChild(o=>{const l=el(o);l instanceof Je?e=l:!e&&l?e=new Je("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new Je("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class fi{constructor(e,o,l,f){this.message=(e?`${e}: `:"")+l,f&&(this.identifier=f),null!=o&&o.__line__&&(this.line=o.__line__)}}function Gs(r){const e=r.key,o=r.value,l=r.valueSpec||{},f=r.objectElementValidators||{},_=r.style,y=r.styleSpec;let w=[];const E=bn(o);if("object"!==E)return[new fi(e,o,`object expected, ${E} found`)];for(const D in o){const L=D.split(".")[0];let B;f[L]?B=f[L]:l[L]?B=Co:f["*"]?B=f["*"]:l["*"]&&(B=Co),B?w=w.concat(B({key:(e&&`${e}.`)+D,value:o[D],valueSpec:l[L]||l["*"],style:_,styleSpec:y,object:o,objectKey:D},o)):w.push(new fi(e,o[D],`unknown property "${D}"`))}for(const D in l)f[D]||l[D].required&&void 0===l[D].default&&void 0===o[D]&&w.push(new fi(e,o,`missing required property "${D}"`));return w}function wc(r){const e=r.value,o=r.valueSpec,l=r.style,f=r.styleSpec,_=r.key,y=r.arrayElementValidator||Co;if("array"!==bn(e))return[new fi(_,e,`array expected, ${bn(e)} found`)];if(o.length&&e.length!==o.length)return[new fi(_,e,`array length ${o.length} expected, length ${e.length} found`)];if(o["min-length"]&&e.length<o["min-length"])return[new fi(_,e,`array length at least ${o["min-length"]} expected, length ${e.length} found`)];let w={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};f.$version<7&&(w.function=o.function),"object"===bn(o.value)&&(w=o.value);let E=[];for(let D=0;D<e.length;D++)E=E.concat(y({array:e,arrayIndex:D,value:e[D],valueSpec:w,style:l,styleSpec:f,key:`${_}[${D}]`}));return E}function nc(r){const e=r.key,o=r.value,l=r.valueSpec;let f=bn(o);if("number"===f&&o!=o&&(f="NaN"),"number"!==f)return[new fi(e,o,`number expected, ${f} found`)];if("minimum"in l){let _=l.minimum;if("array"===bn(l.minimum)&&(_=l.minimum[r.arrayIndex]),o<_)return[new fi(e,o,`${o} is less than the minimum value ${_}`)]}if("maximum"in l){let _=l.maximum;if("array"===bn(l.maximum)&&(_=l.maximum[r.arrayIndex]),o>_)return[new fi(e,o,`${o} is greater than the maximum value ${_}`)]}return[]}function vl(r){const e=r.valueSpec,o=ui(r.value.type);let l,f,_,y={};const w="categorical"!==o&&void 0===r.value.property,E=!w,D="array"===bn(r.value.stops)&&"array"===bn(r.value.stops[0])&&"object"===bn(r.value.stops[0][0]),L=Gs({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(Y){if("identity"===o)return[new fi(Y.key,Y.value,'identity function may not have a "stops" property')];let Q=[];const he=Y.value;return Q=Q.concat(wc({key:Y.key,value:he,valueSpec:Y.valueSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:B})),"array"===bn(he)&&0===he.length&&Q.push(new fi(Y.key,he,"array must have at least one stop")),Q},default:function(Y){return Co({key:Y.key,value:Y.value,valueSpec:e,style:Y.style,styleSpec:Y.styleSpec})}}});return"identity"===o&&w&&L.push(new fi(r.key,r.value,'missing required property "property"')),"identity"===o||r.value.stops||L.push(new fi(r.key,r.value,'missing required property "stops"')),"exponential"===o&&r.valueSpec.expression&&!vn(r.valueSpec)&&L.push(new fi(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(E&&!fe(r.valueSpec)?L.push(new fi(r.key,r.value,"property functions not supported")):w&&!xt(r.valueSpec)&&L.push(new fi(r.key,r.value,"zoom functions not supported"))),"categorical"!==o&&!D||void 0!==r.value.property||L.push(new fi(r.key,r.value,'"property" property is required')),L;function B(Y){let Q=[];const he=Y.value,Ue=Y.key;if("array"!==bn(he))return[new fi(Ue,he,`array expected, ${bn(he)} found`)];if(2!==he.length)return[new fi(Ue,he,`array length 2 expected, length ${he.length} found`)];if(D){if("object"!==bn(he[0]))return[new fi(Ue,he,`object expected, ${bn(he[0])} found`)];if(void 0===he[0].zoom)return[new fi(Ue,he,"object stop key must have zoom")];if(void 0===he[0].value)return[new fi(Ue,he,"object stop key must have value")];const ot=ui(he[0].zoom);if("number"!=typeof ot)return[new fi(Ue,he[0].zoom,"stop zoom values must be numbers")];if(_&&_>ot)return[new fi(Ue,he[0].zoom,"stop zoom values must appear in ascending order")];ot!==_&&(_=ot,f=void 0,y={}),Q=Q.concat(Gs({key:`${Ue}[0]`,value:he[0],valueSpec:{zoom:{}},style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:nc,value:V}}))}else Q=Q.concat(V({key:`${Ue}[0]`,value:he[0],valueSpec:{},style:Y.style,styleSpec:Y.styleSpec},he));return qo(Wn(he[1]))?Q.concat([new fi(`${Ue}[1]`,he[1],"expressions are not allowed in function stops.")]):Q.concat(Co({key:`${Ue}[1]`,value:he[1],valueSpec:e,style:Y.style,styleSpec:Y.styleSpec}))}function V(Y,Q){const he=bn(Y.value),Ue=ui(Y.value),ot=null!==Y.value?Y.value:Q;if(l){if(he!==l)return[new fi(Y.key,ot,`${he} stop domain type must match previous stop domain type ${l}`)]}else l=he;if("number"!==he&&"string"!==he&&"boolean"!==he&&"number"!=typeof Ue&&"string"!=typeof Ue&&"boolean"!=typeof Ue)return[new fi(Y.key,ot,"stop domain value must be a number, string, or boolean")];if("number"!==he&&"categorical"!==o){let bt=`number expected, ${he} found`;return fe(e)&&void 0===o&&(bt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new fi(Y.key,ot,bt)]}return"categorical"!==o||"number"!==he||"number"==typeof Ue&&isFinite(Ue)&&Math.floor(Ue)===Ue?"categorical"!==o&&"number"===he&&"number"==typeof Ue&&"number"==typeof f&&void 0!==f&&Ue<f?[new fi(Y.key,ot,"stop domain values must appear in ascending order")]:(f=Ue,"categorical"===o&&Ue in y?[new fi(Y.key,ot,"stop domain values must be unique")]:(y[Ue]=!0,[])):[new fi(Y.key,ot,`integer expected, found ${String(Ue)}`)]}}function Fo(r){const e=("property"===r.expressionContext?Yo:hs)(Wn(r.value),r.valueSpec);if("error"===e.result)return e.value.map(l=>new fi(`${r.key}${l.key}`,r.value,l.message));const o=e.value.expression||e.value._styleExpression.expression;if("property"===r.expressionContext&&"text-font"===r.propertyKey&&!o.outputDefined())return[new fi(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===r.expressionContext&&"layout"===r.propertyType&&!bo(o))return[new fi(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===r.expressionContext)return ps(o,r);if(r.expressionContext&&0===r.expressionContext.indexOf("cluster")){if(!Sa(o,["zoom","feature-state"]))return[new fi(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===r.expressionContext&&!js(o))return[new fi(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ps(r,e){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const f of e.valueSpec.expression.parameters)o.delete(f);if(0===o.size)return[];const l=[];return r instanceof po&&o.has(r.name)?[new fi(e.key,e.value,`["${r.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(r.eachChild(f=>{l.push(...ps(f,e))}),l)}function Oa(r){const e=r.key,o=r.value,l=r.valueSpec,f=[];return Array.isArray(l.values)?-1===l.values.indexOf(ui(o))&&f.push(new fi(e,o,`expected one of [${l.values.join(", ")}], ${JSON.stringify(o)} found`)):-1===Object.keys(l.values).indexOf(ui(o))&&f.push(new fi(e,o,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(o)} found`)),f}function ic(r){if(!0===r||!1===r)return!0;if(!Array.isArray(r)||0===r.length)return!1;switch(r[0]){case"has":return r.length>=2&&"$id"!==r[1]&&"$type"!==r[1];case"in":return r.length>=3&&("string"!=typeof r[1]||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==r.length||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!ic(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function jr(r,e="fill"){if(null==r)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ic(r)||(r=Zo(r));const o=r;let l=!0;try{l=function(D){if(!Nr(D))return D;let L=Wn(D);return tl(L),L=Cc(L),L}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(o,null,2)}\n        `)}const f=It[`filter_${e}`],_=hs(l,f);let y=null;if("error"===_.result)throw new Error(_.value.map(D=>`${D.key}: ${D.message}`).join(", "));y=(D,L,B)=>_.value.evaluate(D,L,{},B);let w=null,E=null;if(l!==o){const D=hs(o,f);if("error"===D.result)throw new Error(D.value.map(L=>`${L.key}: ${L.message}`).join(", "));w=(L,B,V,Y,Q)=>D.value.evaluate(L,B,{},V,void 0,void 0,Y,Q),E=!js(D.value.expression)}return{filter:y,dynamicFilter:w||void 0,needGeometry:ya(l),needFeature:!!E}}function Cc(r){if(!Array.isArray(r))return r;const e=function(o){if(Kc.has(o[0]))for(let l=1;l<o.length;l++)if(Nr(o[l]))return!0;return o}(r);return!0===e?e:e.map(o=>Cc(o))}function tl(r){let e=!1;const o=[];if("case"===r[0]){for(let l=1;l<r.length-1;l+=2)e=e||Nr(r[l]),o.push(r[l+1]);o.push(r[r.length-1])}else if("match"===r[0]){e=e||Nr(r[1]);for(let l=2;l<r.length-1;l+=2)o.push(r[l+1]);o.push(r[r.length-1])}else if("step"===r[0]){e=e||Nr(r[1]);for(let l=1;l<r.length-1;l+=2)o.push(r[l+1])}e&&(r.length=0,r.push("any",...o));for(let l=1;l<r.length;l++)tl(r[l])}function Nr(r){if(!Array.isArray(r))return!1;if("pitch"===(e=r[0])||"distance-from-center"===e)return!0;var e;for(let o=1;o<r.length;o++)if(Nr(r[o]))return!0;return!1}const Kc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function rc(r,e){return r<e?-1:r>e?1:0}function ya(r){if(!Array.isArray(r))return!1;if("within"===r[0])return!0;for(let e=1;e<r.length;e++)if(ya(r[e]))return!0;return!1}function Zo(r){if(!r)return!0;const e=r[0];return r.length<=1?"any"!==e:"=="===e?Xc(r[1],r[2],"=="):"!="===e?Hs(Xc(r[1],r[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Xc(r[1],r[2],e):"any"===e?(o=r.slice(1),["any"].concat(o.map(Zo))):"all"===e?["all"].concat(r.slice(1).map(Zo)):"none"===e?["all"].concat(r.slice(1).map(Zo).map(Hs)):"in"===e?kl(r[1],r.slice(2)):"!in"===e?Hs(kl(r[1],r.slice(2))):"has"===e?Lu(r[1]):"!has"===e?Hs(Lu(r[1])):"within"!==e||r;var o}function Xc(r,e,o){switch(r){case"$type":return[`filter-type-${o}`,e];case"$id":return[`filter-id-${o}`,e];default:return[`filter-${o}`,r,e]}}function kl(r,e){if(0===e.length)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(o=>typeof o!=typeof e[0])?["filter-in-large",r,["literal",e.sort(rc)]]:["filter-in-small",r,["literal",e]]}}function Lu(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Hs(r){return["!",r]}function Fl(r){return ic(Wn(r.value))?Fo(Xn({},r,{expressionContext:"filter",valueSpec:r.styleSpec[`filter_${r.layerType||"fill"}`]})):xl(r)}function xl(r){const e=r.value,o=r.key;if("array"!==bn(e))return[new fi(o,e,`array expected, ${bn(e)} found`)];const l=r.styleSpec;let f,_=[];if(e.length<1)return[new fi(o,e,"filter array must have at least 1 element")];switch(_=_.concat(Oa({key:`${o}[0]`,value:e[0],valueSpec:l.filter_operator,style:r.style,styleSpec:r.styleSpec})),ui(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===ui(e[1])&&_.push(new fi(o,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&_.push(new fi(o,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(f=bn(e[1]),"string"!==f&&_.push(new fi(`${o}[1]`,e[1],`string expected, ${f} found`)));for(let y=2;y<e.length;y++)f=bn(e[y]),"$type"===ui(e[1])?_=_.concat(Oa({key:`${o}[${y}]`,value:e[y],valueSpec:l.geometry_type,style:r.style,styleSpec:r.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&_.push(new fi(`${o}[${y}]`,e[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)_=_.concat(xl({key:`${o}[${y}]`,value:e[y],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":f=bn(e[1]),2!==e.length?_.push(new fi(o,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==f&&_.push(new fi(`${o}[1]`,e[1],`string expected, ${f} found`));break;case"within":f=bn(e[1]),2!==e.length?_.push(new fi(o,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==f&&_.push(new fi(`${o}[1]`,e[1],`object expected, ${f} found`))}return _}function oc(r,e){const o=r.key,l=r.style,f=r.styleSpec,_=r.value,y=r.objectKey,w=f[`${e}_${r.layerType}`];if(!w)return[];const E=y.match(/^(.*)-transition$/);if("paint"===e&&E&&w[E[1]]&&w[E[1]].transition)return Co({key:o,value:_,valueSpec:f.transition,style:l,styleSpec:f});const D=r.valueSpec||w[y];if(!D)return[new fi(o,_,`unknown property "${y}"`)];let L;if("string"===bn(_)&&fe(D)&&!D.tokens&&(L=/^{([^}]+)}$/.exec(_))){const V=`\`{ "type": "identity", "property": ${L?JSON.stringify(L[1]):'"_"'} }\``;return[new fi(o,_,`"${y}" does not support interpolation syntax\nUse an identity property function instead: ${V}.`)]}const B=[];return"symbol"===r.layerType&&("text-field"===y&&l&&!l.glyphs&&B.push(new fi(o,_,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&Ti(Wn(_))&&"identity"===ui(_.type)&&B.push(new fi(o,_,'"text-font" does not support identity functions'))),B.concat(Co({key:r.key,value:_,valueSpec:D,style:l,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:y}))}function ku(r){return oc(r,"paint")}function bl(r){return oc(r,"layout")}function ms(r){let e=[];const o=r.value,l=r.key,f=r.style,_=r.styleSpec;o.type||o.ref||e.push(new fi(l,o,'either "type" or "ref" is required'));let y=ui(o.type);const w=ui(o.ref);if(o.id){const E=ui(o.id);for(let D=0;D<r.arrayIndex;D++){const L=f.layers[D];ui(L.id)===E&&e.push(new fi(l,o.id,`duplicate layer id "${o.id}", previously used at line ${L.id.__line__}`))}}if("ref"in o){let E;["type","source","source-layer","filter","layout"].forEach(D=>{D in o&&e.push(new fi(l,o[D],`"${D}" is prohibited for ref layers`))}),f.layers.forEach(D=>{ui(D.id)===w&&(E=D)}),E?E.ref?e.push(new fi(l,o.ref,"ref cannot reference another ref layer")):y=ui(E.type):"string"==typeof w&&e.push(new fi(l,o.ref,`ref layer "${w}" not found`))}else if("background"!==y&&"sky"!==y)if(o.source){const E=f.sources&&f.sources[o.source],D=E&&ui(E.type);E?"vector"===D&&"raster"===y?e.push(new fi(l,o.source,`layer "${o.id}" requires a raster source`)):"raster"===D&&"raster"!==y?e.push(new fi(l,o.source,`layer "${o.id}" requires a vector source`)):"vector"!==D||o["source-layer"]?"raster-dem"===D&&"hillshade"!==y?e.push(new fi(l,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||"geojson"===D&&E.lineMetrics||e.push(new fi(l,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new fi(l,o,`layer "${o.id}" must specify a "source-layer"`)):e.push(new fi(l,o.source,`source "${o.source}" not found`))}else e.push(new fi(l,o,'missing required property "source"'));return e=e.concat(Gs({key:l,value:o,valueSpec:_.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Co({key:`${l}.type`,value:o.type,valueSpec:_.layer.type,style:r.style,styleSpec:r.styleSpec,object:o,objectKey:"type"}),filter:E=>Fl(Xn({layerType:y},E)),layout:E=>Gs({layer:o,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":D=>bl(Xn({layerType:y},D))}}),paint:E=>Gs({layer:o,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":D=>ku(Xn({layerType:y},D))}})}})),e}function va(r){const e=r.value,o=r.key,l=bn(e);return"string"!==l?[new fi(o,e,`string expected, ${l} found`)]:[]}const Ki={promoteId:function({key:r,value:e}){if("string"===bn(e))return va({key:r,value:e});{const o=[];for(const l in e)o.push(...va({key:`${r}.${l}`,value:e[l]}));return o}}};function Fu(r){const e=r.value,o=r.key,l=r.styleSpec,f=r.style;if(!e.type)return[new fi(o,e,'"type" is required')];const _=ui(e.type);let y;switch(_){case"vector":case"raster":case"raster-dem":return y=Gs({key:o,value:e,valueSpec:l[`source_${_.replace("-","_")}`],style:r.style,styleSpec:l,objectElementValidators:Ki}),y;case"geojson":if(y=Gs({key:o,value:e,valueSpec:l.source_geojson,style:f,styleSpec:l,objectElementValidators:Ki}),e.cluster)for(const w in e.clusterProperties){const[E,D]=e.clusterProperties[w],L="string"==typeof E?[E,["accumulated"],["get",w]]:E;y.push(...Fo({key:`${o}.${w}.map`,value:D,expressionContext:"cluster-map"})),y.push(...Fo({key:`${o}.${w}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return y;case"video":return Gs({key:o,value:e,valueSpec:l.source_video,style:f,styleSpec:l});case"image":return Gs({key:o,value:e,valueSpec:l.source_image,style:f,styleSpec:l});case"canvas":return[new fi(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Oa({key:`${o}.type`,value:e.type,valueSpec:{values:up(l)},style:f,styleSpec:l})}}function up(r){return r.source.reduce((e,o)=>{const l=r[o];return"enum"===l.type.type&&(e=e.concat(Object.keys(l.type.values))),e},[])}function Qc(r){const e=r.value,o=r.styleSpec,l=o.light,f=r.style;let _=[];const y=bn(e);if(void 0===e)return _;if("object"!==y)return _=_.concat([new fi("light",e,`object expected, ${y} found`)]),_;for(const w in e){const E=w.match(/^(.*)-transition$/);_=_.concat(E&&l[E[1]]&&l[E[1]].transition?Co({key:w,value:e[w],valueSpec:o.transition,style:f,styleSpec:o}):l[w]?Co({key:w,value:e[w],valueSpec:l[w],style:f,styleSpec:o}):[new fi(w,e[w],`unknown property "${w}"`)])}return _}function Ec(r){const e=r.value,o=r.key,l=r.style,f=r.styleSpec,_=f.terrain;let y=[];const w=bn(e);if(void 0===e)return y;if("object"!==w)return y=y.concat([new fi("terrain",e,`object expected, ${w} found`)]),y;for(const E in e){const D=E.match(/^(.*)-transition$/);y=y.concat(D&&_[D[1]]&&_[D[1]].transition?Co({key:E,value:e[E],valueSpec:f.transition,style:l,styleSpec:f}):_[E]?Co({key:E,value:e[E],valueSpec:_[E],style:l,styleSpec:f}):[new fi(E,e[E],`unknown property "${E}"`)])}if(e.source){const E=l.sources&&l.sources[e.source],D=E&&ui(E.type);E?"raster-dem"!==D&&y.push(new fi(o,e.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):y.push(new fi(o,e.source,`source "${e.source}" not found`))}else y.push(new fi(o,e,'terrain is missing required property "source"'));return y}function Tc(r){const e=r.value,o=r.style,l=r.styleSpec,f=l.fog;let _=[];const y=bn(e);if(void 0===e)return _;if("object"!==y)return _=_.concat([new fi("fog",e,`object expected, ${y} found`)]),_;for(const w in e){const E=w.match(/^(.*)-transition$/);_=_.concat(E&&f[E[1]]&&f[E[1]].transition?Co({key:w,value:e[w],valueSpec:l.transition,style:o,styleSpec:l}):f[w]?Co({key:w,value:e[w],valueSpec:f[w],style:o,styleSpec:l}):[new fi(w,e[w],`unknown property "${w}"`)])}return _}const eu={"*":()=>[],array:wc,boolean:function(r){const e=r.value,o=r.key,l=bn(e);return"boolean"!==l?[new fi(o,e,`boolean expected, ${l} found`)]:[]},number:nc,color:function(r){const e=r.key,o=r.value,l=bn(o);return"string"!==l?[new fi(e,o,`color expected, ${l} found`)]:null===Un(o)?[new fi(e,o,`color expected, "${o}" found`)]:[]},enum:Oa,filter:Fl,function:vl,layer:ms,object:Gs,source:Fu,light:Qc,terrain:Ec,fog:Tc,string:va,formatted:function(r){return 0===va(r).length?[]:Fo(r)},resolvedImage:function(r){return 0===va(r).length?[]:Fo(r)},projection:function(r){const e=r.value,o=r.styleSpec,l=o.projection,f=r.style;let _=[];const y=bn(e);if("object"===y)for(const w in e)_=_.concat(Co({key:w,value:e[w],valueSpec:l[w],style:f,styleSpec:o}));else"string"!==y&&(_=_.concat([new fi("projection",e,`object or string expected, ${y} found`)]));return _}};function Co(r){const e=r.value,o=r.valueSpec,l=r.styleSpec;return o.expression&&Ti(ui(e))?vl(r):o.expression&&qo(Wn(e))?Fo(r):o.type&&eu[o.type]?eu[o.type](r):Gs(Xn({},r,{valueSpec:o.type?l[o.type]:o}))}function xh(r){const e=r.value,o=r.key,l=va(r);return l.length||(-1===e.indexOf("{fontstack}")&&l.push(new fi(o,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&l.push(new fi(o,e,'"glyphs" url must include a "{range}" token'))),l}function tu(r,e=It){return la(Co({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:xh,"*":()=>[]}}))}const Td=r=>la(ku(r)),bh=r=>la(bl(r));function la(r){return r.slice().sort((e,o)=>e.line&&o.line?e.line-o.line:0)}function Nn(r,e){let o=!1;if(e&&e.length)for(const l of e)r.fire(new Qt(new Error(l.message))),o=!0;return o}var Cr=xa,Ws=3;function xa(r,e,o){var l=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var f=new Int32Array(this.arrayBuffer);r=f[0],this.d=(e=f[1])+2*(o=f[2]);for(var _=0;_<this.d*this.d;_++){var y=f[Ws+_],w=f[Ws+_+1];l.push(y===w?null:f.subarray(y,w))}var E=f[Ws+l.length+1];this.keys=f.subarray(f[Ws+l.length],E),this.bboxes=f.subarray(E),this.insert=this._insertReadonly}else{this.d=e+2*o;for(var D=0;D<this.d*this.d;D++)l.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=r,this.padding=o,this.scale=e/r,this.uid=0;var L=o/e*r;this.min=-L,this.max=r+L}xa.prototype.insert=function(r,e,o,l,f){this._forEachCell(e,o,l,f,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(e),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(f)},xa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},xa.prototype._insertCell=function(r,e,o,l,f,_){this.cells[f].push(_)},xa.prototype.query=function(r,e,o,l,f){var _=this.min,y=this.max;if(r<=_&&e<=_&&y<=o&&y<=l&&!f)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(r,e,o,l,this._queryCell,w,{},f),w},xa.prototype._queryCell=function(r,e,o,l,f,_,y,w){var E=this.cells[f];if(null!==E)for(var D=this.keys,L=this.bboxes,B=0;B<E.length;B++){var V=E[B];if(void 0===y[V]){var Y=4*V;(w?w(L[Y+0],L[Y+1],L[Y+2],L[Y+3]):r<=L[Y+2]&&e<=L[Y+3]&&o>=L[Y+0]&&l>=L[Y+1])?(y[V]=!0,_.push(D[V])):y[V]=!1}}},xa.prototype._forEachCell=function(r,e,o,l,f,_,y,w){for(var E=this._convertToCellCoord(r),D=this._convertToCellCoord(e),L=this._convertToCellCoord(o),B=this._convertToCellCoord(l),V=E;V<=L;V++)for(var Y=D;Y<=B;Y++){var Q=this.d*Y+V;if((!w||w(this._convertFromCellCoord(V),this._convertFromCellCoord(Y),this._convertFromCellCoord(V+1),this._convertFromCellCoord(Y+1)))&&f.call(this,r,e,o,l,Q,_,y,w))return}},xa.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},xa.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},xa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,e=Ws+this.cells.length+1+1,o=0,l=0;l<this.cells.length;l++)o+=this.cells[l].length;var f=new Int32Array(e+o+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var _=e,y=0;y<r.length;y++){var w=r[y];f[Ws+y]=_,f.set(w,_),_+=w.length}return f[Ws+r.length]=_,f.set(this.keys,_),f[Ws+r.length+1]=_+=this.keys.length,f.set(this.bboxes,_),_+=this.bboxes.length,f.buffer};var Er=Ye(Cr);const sc={};function yi(r,e,o={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writeable:!1}),sc[e]={klass:r,omit:o.omit||[]}}yi(Object,"Object"),Er.serialize=function(r,e){const o=r.toArrayBuffer();return e&&e.push(o),{buffer:o}},Er.deserialize=function(r){return new Er(r.buffer)},Object.defineProperty(Er,"name",{value:"Grid"}),yi(Er,"Grid"),yi(R,"Color"),yi(Error,"Error"),yi(Bi,"AJAXError"),yi(Bt,"ResolvedImage"),yi(Zs,"StylePropertyFunction"),yi($s,"StyleExpression",{omit:["_evaluator"]}),yi(fs,"ZoomDependentExpression"),yi($o,"ZoomConstantExpression"),yi(po,"CompoundExpression",{omit:["_evaluate"]});for(const r in F)sc[F[r]._classRegistryKey]||yi(F[r],`Expression${r}`);function qs(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&"ArrayBuffer"===r.constructor.name)}function ac(r){return j.ImageBitmap&&r instanceof j.ImageBitmap}function nl(r,e){if(null==r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(qs(r)||ac(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const o=r;return e&&e.push(o.buffer),o}if(r instanceof j.ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const o=[];for(const l of r)o.push(nl(l,e));return o}if("object"==typeof r){const o=r.constructor,l=o._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);const f=o.serialize?o.serialize(r,e):{};if(!o.serialize){for(const _ in r)r.hasOwnProperty(_)&&(sc[l].omit.indexOf(_)>=0||(f[_]=nl(r[_],e)));r instanceof Error&&(f.message=r.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(f.$name=l),f}throw new Error("can't serialize object of type "+typeof r)}function wl(r){if(null==r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||qs(r)||ac(r)||ArrayBuffer.isView(r)||r instanceof j.ImageData)return r;if(Array.isArray(r))return r.map(wl);if("object"==typeof r){const e=r.$name||"Object",{klass:o}=sc[e];if(!o)throw new Error(`can't deserialize unregistered class ${e}`);if(o.deserialize)return o.deserialize(r);const l=Object.create(o.prototype);for(const f of Object.keys(r))"$name"!==f&&(l[f]=wl(r[f]));return l}throw new Error("can't deserialize object of type "+typeof r)}const pi={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function lc(r){for(const e of r)if(nu(e.charCodeAt(0)))return!0;return!1}function os(r){for(const e of r)if(!Ra(e.charCodeAt(0)))return!1;return!0}function Ra(r){return!(pi.Arabic(r)||pi["Arabic Supplement"](r)||pi["Arabic Extended-A"](r)||pi["Arabic Presentation Forms-A"](r)||pi["Arabic Presentation Forms-B"](r))}function nu(r){return!(746!==r&&747!==r&&(r<4352||!(pi["Bopomofo Extended"](r)||pi.Bopomofo(r)||pi["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||pi["CJK Compatibility Ideographs"](r)||pi["CJK Compatibility"](r)||pi["CJK Radicals Supplement"](r)||pi["CJK Strokes"](r)||!(!pi["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||12336===r)||pi["CJK Unified Ideographs Extension A"](r)||pi["CJK Unified Ideographs"](r)||pi["Enclosed CJK Letters and Months"](r)||pi["Hangul Compatibility Jamo"](r)||pi["Hangul Jamo Extended-A"](r)||pi["Hangul Jamo Extended-B"](r)||pi["Hangul Jamo"](r)||pi["Hangul Syllables"](r)||pi.Hiragana(r)||pi["Ideographic Description Characters"](r)||pi.Kanbun(r)||pi["Kangxi Radicals"](r)||pi["Katakana Phonetic Extensions"](r)||pi.Katakana(r)&&12540!==r||!(!pi["Halfwidth and Fullwidth Forms"](r)||65288===r||65289===r||65293===r||r>=65306&&r<=65310||65339===r||65341===r||65343===r||r>=65371&&r<=65503||65507===r||r>=65512&&r<=65519)||!(!pi["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||pi["Unified Canadian Aboriginal Syllabics"](r)||pi["Unified Canadian Aboriginal Syllabics Extended"](r)||pi["Vertical Forms"](r)||pi["Yijing Hexagram Symbols"](r)||pi["Yi Syllables"](r)||pi["Yi Radicals"](r))))}function ba(r){return!(nu(r)||(e=r,pi["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||pi["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||pi["Letterlike Symbols"](e)||pi["Number Forms"](e)||pi["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||pi["Control Pictures"](e)&&9251!==e||pi["Optical Character Recognition"](e)||pi["Enclosed Alphanumerics"](e)||pi["Geometric Shapes"](e)||pi["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||pi["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||pi["CJK Symbols and Punctuation"](e)||pi.Katakana(e)||pi["Private Use Area"](e)||pi["CJK Compatibility Forms"](e)||pi["Small Form Variants"](e)||pi["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function La(r){return r>=1424&&r<=2303||pi["Arabic Presentation Forms-A"](r)||pi["Arabic Presentation Forms-B"](r)}function wh(r,e){return!(!e&&La(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||pi.Khmer(r))}function Dd(r){for(const e of r)if(La(e.charCodeAt(0)))return!0;return!1}const P="deferred",U="loading",O="loaded";let z=null,d="unavailable",n=null;const c=function(r){r&&"string"==typeof r&&r.indexOf("NetworkError")>-1&&(d="error"),z&&z(r)};function m(){v.fire(new Mt("pluginStateChange",{pluginStatus:d,pluginURL:n}))}const v=new wn,b=function(){return d},I=function(){if(d!==P||!n)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");d=U,m(),n&&Cn({url:n},r=>{r?c(r):(d=O,m())})},M={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>d===O||null!=M.applyArabicShaping,isLoading:()=>d===U,setState(r){d=r.pluginStatus,n=r.pluginURL},isParsed:()=>null!=M.applyArabicShaping&&null!=M.processBidirectionalText&&null!=M.processStyledBidirectionalText,getPluginURL:()=>n};class N{constructor(e,o){this.zoom=e,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(o,l){for(const f of o)if(!wh(f.charCodeAt(0),l))return!1;return!0}(e,M.isLoaded())}}class Z{constructor(e,o){this.property=e,this.value=o,this.expression=function(l,f){if(Ti(l))return new Zs(l,f);if(qo(l)){const _=Yo(l,f);if("error"===_.result)throw new Error(_.value.map(y=>`${y.key}: ${y.message}`).join(", "));return _.value}{let _=l;return"string"==typeof l&&"color"===f.type&&(_=R.parse(l)),{kind:"constant",evaluate:()=>_}}}(void 0===o?e.specification.default:o,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,o,l){return this.property.possiblyEvaluate(this,e,o,l)}}class ${constructor(e){this.property=e,this.value=new Z(e,void 0)}transitioned(e,o){return new Re(this.property,this.value,o,ke({},e.transition,this.transition),e.now)}untransitioned(){return new Re(this.property,this.value,null,{},0)}}class re{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return li(this._values[e].value.value)}setValue(e,o){this._values.hasOwnProperty(e)||(this._values[e]=new $(this._values[e].property)),this._values[e].value=new Z(this._values[e].property,null===o?void 0:li(o))}getTransition(e){return li(this._values[e].transition)}setTransition(e,o){this._values.hasOwnProperty(e)||(this._values[e]=new $(this._values[e].property)),this._values[e].transition=li(o)||void 0}serialize(){const e={};for(const o of Object.keys(this._values)){const l=this.getValue(o);void 0!==l&&(e[o]=l);const f=this.getTransition(o);void 0!==f&&(e[`${o}-transition`]=f)}return e}transitioned(e,o){const l=new Fe(this._properties);for(const f of Object.keys(this._values))l._values[f]=this._values[f].transitioned(e,o._values[f]);return l}untransitioned(){const e=new Fe(this._properties);for(const o of Object.keys(this._values))e._values[o]=this._values[o].untransitioned();return e}}class Re{constructor(e,o,l,f,_){const y=f.delay||0,w=f.duration||0;_=_||0,this.property=e,this.value=o,this.begin=_+y,this.end=this.begin+w,e.specification.transition&&(f.delay||f.duration)&&(this.prior=l)}possiblyEvaluate(e,o,l){const f=e.now||0,_=this.value.possiblyEvaluate(e,o,l),y=this.prior;if(y){if(f>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(f<this.begin)return y.possiblyEvaluate(e,o,l);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,o,l),_,je(w))}}return _}}class Fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,o,l){const f=new nt(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(e,o,l);return f}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class et{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return li(this._values[e].value)}setValue(e,o){this._values[e]=new Z(this._values[e].property,null===o?void 0:li(o))}serialize(){const e={};for(const o of Object.keys(this._values)){const l=this.getValue(o);void 0!==l&&(e[o]=l)}return e}possiblyEvaluate(e,o,l){const f=new nt(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(e,o,l);return f}}class Qe{constructor(e,o,l){this.property=e,this.value=o,this.parameters=l}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,o,l,f){return this.property.evaluate(this.value,this.parameters,e,o,l,f)}}class nt{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ce{constructor(e){this.specification=e}possiblyEvaluate(e,o){return e.expression.evaluate(o)}interpolate(e,o,l){const f=Br[this.specification.type];return f?f(e,o,l):e}}class We{constructor(e,o){this.specification=e,this.overrides=o}possiblyEvaluate(e,o,l,f){return new Qe(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(o,null,{},l,f)}:e.expression,o)}interpolate(e,o,l){if("constant"!==e.value.kind||"constant"!==o.value.kind)return e;if(void 0===e.value.value||void 0===o.value.value)return new Qe(this,{kind:"constant",value:void 0},e.parameters);const f=Br[this.specification.type];return f?new Qe(this,{kind:"constant",value:f(e.value.value,o.value.value,l)},e.parameters):e}evaluate(e,o,l,f,_,y){return"constant"===e.kind?e.value:e.evaluate(o,l,f,_,y)}}class pt{constructor(e){this.specification=e}possiblyEvaluate(e,o,l,f){return!!e.expression.evaluate(o,null,{},l,f)}interpolate(){return!1}}class gt{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new N(0,{});for(const l in e){const f=e[l];f.specification.overridable&&this.overridableProperties.push(l);const _=this.defaultPropertyValues[l]=new Z(f,void 0),y=this.defaultTransitionablePropertyValues[l]=new $(f);this.defaultTransitioningPropertyValues[l]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=_.possiblyEvaluate(o)}}}function Pt(r,e){return 256*(r=Xe(Math.floor(r),0,255))+Xe(Math.floor(e),0,255)}yi(We,"DataDrivenProperty"),yi(ce,"DataConstantProperty"),yi(pt,"ColorRampProperty");const Ft={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rt{constructor(e,o){this._structArray=e,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class qt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,o){return e._trim(),o&&(e.isTransferred=!0,o.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const o=Object.create(this.prototype);return o.arrayBuffer=e.arrayBuffer,o.length=e.length,o.capacity=e.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Wt(r,e=1){let o=0,l=0;return{members:r.map(f=>{const _=Ft[f.type].BYTES_PER_ELEMENT,y=o=an(o,Math.max(e,_)),w=f.components||1;return l=Math.max(l,_),o+=_*w,{name:f.name,type:f.type,components:w,offset:y}}),size:an(o,Math.max(l,e)),alignment:e}}function an(r,e){return Math.ceil(r/e)*e}class Yn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,o)}emplace(e,o,l){const f=2*e;return this.int16[f+0]=o,this.int16[f+1]=l,e}}Yn.prototype.bytesPerElement=4,yi(Yn,"StructArrayLayout2i4");class tn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,o,l)}emplace(e,o,l,f){const _=3*e;return this.int16[_+0]=o,this.int16[_+1]=l,this.int16[_+2]=f,e}}tn.prototype.bytesPerElement=6,yi(tn,"StructArrayLayout3i6");class Pn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,o,l,f)}emplace(e,o,l,f,_){const y=4*e;return this.int16[y+0]=o,this.int16[y+1]=l,this.int16[y+2]=f,this.int16[y+3]=_,e}}Pn.prototype.bytesPerElement=8,yi(Pn,"StructArrayLayout4i8");class dn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l,f,_,y,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,o,l,f,_,y,w)}emplace(e,o,l,f,_,y,w,E){const D=6*e,L=12*e,B=3*e;return this.int16[D+0]=o,this.int16[D+1]=l,this.uint8[L+4]=f,this.uint8[L+5]=_,this.uint8[L+6]=y,this.uint8[L+7]=w,this.float32[B+2]=E,e}}dn.prototype.bytesPerElement=12,yi(dn,"StructArrayLayout2i4ub1f12");class Zn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,o,l,f)}emplace(e,o,l,f,_){const y=4*e;return this.float32[y+0]=o,this.float32[y+1]=l,this.float32[y+2]=f,this.float32[y+3]=_,e}}Zn.prototype.bytesPerElement=16,yi(Zn,"StructArrayLayout4f16");class ln extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l,f,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,o,l,f,_)}emplace(e,o,l,f,_,y){const w=6*e,E=3*e;return this.uint16[w+0]=o,this.uint16[w+1]=l,this.uint16[w+2]=f,this.uint16[w+3]=_,this.float32[E+2]=y,e}}ln.prototype.bytesPerElement=12,yi(ln,"StructArrayLayout4ui1f12");class An extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,o,l,f)}emplace(e,o,l,f,_){const y=4*e;return this.uint16[y+0]=o,this.uint16[y+1]=l,this.uint16[y+2]=f,this.uint16[y+3]=_,e}}An.prototype.bytesPerElement=8,yi(An,"StructArrayLayout4ui8");class Qn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l,f,_,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,o,l,f,_,y)}emplace(e,o,l,f,_,y,w){const E=6*e;return this.int16[E+0]=o,this.int16[E+1]=l,this.int16[E+2]=f,this.int16[E+3]=_,this.int16[E+4]=y,this.int16[E+5]=w,e}}Qn.prototype.bytesPerElement=12,yi(Qn,"StructArrayLayout6i12");class jn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l,f,_,y,w,E,D,L,B,V){const Y=this.length;return this.resize(Y+1),this.emplace(Y,e,o,l,f,_,y,w,E,D,L,B,V)}emplace(e,o,l,f,_,y,w,E,D,L,B,V,Y){const Q=12*e;return this.int16[Q+0]=o,this.int16[Q+1]=l,this.int16[Q+2]=f,this.int16[Q+3]=_,this.uint16[Q+4]=y,this.uint16[Q+5]=w,this.uint16[Q+6]=E,this.uint16[Q+7]=D,this.int16[Q+8]=L,this.int16[Q+9]=B,this.int16[Q+10]=V,this.int16[Q+11]=Y,e}}jn.prototype.bytesPerElement=24,yi(jn,"StructArrayLayout4i4ui4i24");class ei extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l,f,_,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,o,l,f,_,y)}emplace(e,o,l,f,_,y,w){const E=10*e,D=5*e;return this.int16[E+0]=o,this.int16[E+1]=l,this.int16[E+2]=f,this.float32[D+2]=_,this.float32[D+3]=y,this.float32[D+4]=w,e}}ei.prototype.bytesPerElement=20,yi(ei,"StructArrayLayout3i3f20");class Ai extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint32[1*e+0]=o,e}}Ai.prototype.bytesPerElement=4,yi(Ai,"StructArrayLayout1ul4");class Ji extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l,f,_,y,w,E,D,L,B,V,Y){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,o,l,f,_,y,w,E,D,L,B,V,Y)}emplace(e,o,l,f,_,y,w,E,D,L,B,V,Y,Q){const he=20*e,Ue=10*e;return this.int16[he+0]=o,this.int16[he+1]=l,this.int16[he+2]=f,this.int16[he+3]=_,this.int16[he+4]=y,this.float32[Ue+3]=w,this.float32[Ue+4]=E,this.float32[Ue+5]=D,this.float32[Ue+6]=L,this.int16[he+14]=B,this.uint32[Ue+8]=V,this.uint16[he+18]=Y,this.uint16[he+19]=Q,e}}Ji.prototype.bytesPerElement=40,yi(Ji,"StructArrayLayout5i4f1i1ul2ui40");class wi extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l,f,_,y,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,o,l,f,_,y,w)}emplace(e,o,l,f,_,y,w,E){const D=8*e;return this.int16[D+0]=o,this.int16[D+1]=l,this.int16[D+2]=f,this.int16[D+4]=_,this.int16[D+5]=y,this.int16[D+6]=w,this.int16[D+7]=E,e}}wi.prototype.bytesPerElement=16,yi(wi,"StructArrayLayout3i2i2i16");class Si extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l,f,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,o,l,f,_)}emplace(e,o,l,f,_,y){const w=4*e,E=8*e;return this.float32[w+0]=o,this.float32[w+1]=l,this.float32[w+2]=f,this.int16[E+6]=_,this.int16[E+7]=y,e}}Si.prototype.bytesPerElement=16,yi(Si,"StructArrayLayout2f1f2i16");class fr extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,o,l,f)}emplace(e,o,l,f,_){const y=12*e,w=3*e;return this.uint8[y+0]=o,this.uint8[y+1]=l,this.float32[w+1]=f,this.float32[w+2]=_,e}}fr.prototype.bytesPerElement=12,yi(fr,"StructArrayLayout2ub2f12");class tr extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,o,l)}emplace(e,o,l,f){const _=3*e;return this.float32[_+0]=o,this.float32[_+1]=l,this.float32[_+2]=f,e}}tr.prototype.bytesPerElement=12,yi(tr,"StructArrayLayout3f12");class Di extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,o,l)}emplace(e,o,l,f){const _=3*e;return this.uint16[_+0]=o,this.uint16[_+1]=l,this.uint16[_+2]=f,e}}Di.prototype.bytesPerElement=6,yi(Di,"StructArrayLayout3ui6");class Dr extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,o,l,f,_,y,w,E,D,L,B,V,Y,Q,he,Ue,ot,bt,st,vt,St){const At=this.length;return this.resize(At+1),this.emplace(At,e,o,l,f,_,y,w,E,D,L,B,V,Y,Q,he,Ue,ot,bt,st,vt,St)}emplace(e,o,l,f,_,y,w,E,D,L,B,V,Y,Q,he,Ue,ot,bt,st,vt,St,At){const un=30*e,nn=15*e,In=60*e;return this.int16[un+0]=o,this.int16[un+1]=l,this.int16[un+2]=f,this.float32[nn+2]=_,this.float32[nn+3]=y,this.uint16[un+8]=w,this.uint16[un+9]=E,this.uint32[nn+5]=D,this.uint32[nn+6]=L,this.uint32[nn+7]=B,this.uint16[un+16]=V,this.uint16[un+17]=Y,this.uint16[un+18]=Q,this.float32[nn+10]=he,this.float32[nn+11]=Ue,this.uint8[In+48]=ot,this.uint8[In+49]=bt,this.uint8[In+50]=st,this.uint32[nn+13]=vt,this.int16[un+28]=St,this.uint8[In+58]=At,e}}Dr.prototype.bytesPerElement=60,yi(Dr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Qr extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,o,l,f,_,y,w,E,D,L,B,V,Y,Q,he,Ue,ot,bt,st,vt,St,At,un,nn,In,Jn,hn,On,kn,Gn){const ii=this.length;return this.resize(ii+1),this.emplace(ii,e,o,l,f,_,y,w,E,D,L,B,V,Y,Q,he,Ue,ot,bt,st,vt,St,At,un,nn,In,Jn,hn,On,kn,Gn)}emplace(e,o,l,f,_,y,w,E,D,L,B,V,Y,Q,he,Ue,ot,bt,st,vt,St,At,un,nn,In,Jn,hn,On,kn,Gn,ii){const En=38*e,hi=19*e;return this.int16[En+0]=o,this.int16[En+1]=l,this.int16[En+2]=f,this.float32[hi+2]=_,this.float32[hi+3]=y,this.int16[En+8]=w,this.int16[En+9]=E,this.int16[En+10]=D,this.int16[En+11]=L,this.int16[En+12]=B,this.int16[En+13]=V,this.uint16[En+14]=Y,this.uint16[En+15]=Q,this.uint16[En+16]=he,this.uint16[En+17]=Ue,this.uint16[En+18]=ot,this.uint16[En+19]=bt,this.uint16[En+20]=st,this.uint16[En+21]=vt,this.uint16[En+22]=St,this.uint16[En+23]=At,this.uint16[En+24]=un,this.uint16[En+25]=nn,this.uint16[En+26]=In,this.uint16[En+27]=Jn,this.uint16[En+28]=hn,this.uint32[hi+15]=On,this.float32[hi+16]=kn,this.float32[hi+17]=Gn,this.float32[hi+18]=ii,e}}Qr.prototype.bytesPerElement=76,yi(Qr,"StructArrayLayout3i2f6i15ui1ul3f76");class Vr extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.float32[1*e+0]=o,e}}Vr.prototype.bytesPerElement=4,yi(Vr,"StructArrayLayout1f4");class $r extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l,f,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,o,l,f,_)}emplace(e,o,l,f,_,y){const w=5*e;return this.float32[w+0]=o,this.float32[w+1]=l,this.float32[w+2]=f,this.float32[w+3]=_,this.float32[w+4]=y,e}}$r.prototype.bytesPerElement=20,yi($r,"StructArrayLayout5f20");class gs extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,o,l,f)}emplace(e,o,l,f,_){const y=6*e;return this.uint32[3*e+0]=o,this.uint16[y+2]=l,this.uint16[y+3]=f,this.uint16[y+4]=_,e}}gs.prototype.bytesPerElement=12,yi(gs,"StructArrayLayout1ul3ui12");class oo extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,o)}emplace(e,o,l){const f=2*e;return this.uint16[f+0]=o,this.uint16[f+1]=l,e}}oo.prototype.bytesPerElement=4,yi(oo,"StructArrayLayout2ui4");class wa extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint16[1*e+0]=o,e}}wa.prototype.bytesPerElement=2,yi(wa,"StructArrayLayout1ui2");class ca extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,o)}emplace(e,o,l){const f=2*e;return this.float32[f+0]=o,this.float32[f+1]=l,e}}ca.prototype.bytesPerElement=8,yi(ca,"StructArrayLayout2f8");class no extends Rt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}no.prototype.size=40;class Zr extends Ji{get(e){return new no(this,e)}}yi(Zr,"CollisionBoxArray");class br extends Rt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}br.prototype.size=60;class Eo extends Dr{get(e){return new br(this,e)}}yi(Eo,"PlacedSymbolArray");class Is extends Rt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Is.prototype.size=76;class io extends Qr{get(e){return new Is(this,e)}}yi(io,"SymbolInstanceArray");class Ms extends Vr{getoffsetX(e){return this.float32[1*e+0]}}yi(Ms,"GlyphOffsetArray");class iu extends Yn{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}yi(iu,"SymbolLineVertexArray");class Nl extends Rt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Nl.prototype.size=12;class ru extends gs{get(e){return new Nl(this,e)}}yi(ru,"FeatureIndexArray");class Ca extends oo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}yi(Ca,"FillExtrusionCentroidArray");const Ys=Wt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),cc=Wt([{name:"a_dash",components:4,type:"Uint16"}]);var ou={exports:{}},es=function(r,e){var o,l,f,_,y,w,E,D;for(l=r.length-(o=3&r.length),f=e,y=3432918353,w=461845907,D=0;D<l;)E=255&r.charCodeAt(D)|(255&r.charCodeAt(++D))<<8|(255&r.charCodeAt(++D))<<16|(255&r.charCodeAt(++D))<<24,++D,f=27492+(65535&(_=5*(65535&(f=(f^=E=(65535&(E=(E=(65535&E)*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(E=0,o){case 3:E^=(255&r.charCodeAt(D+2))<<16;case 2:E^=(255&r.charCodeAt(D+1))<<8;case 1:f^=E=(65535&(E=(E=(65535&(E^=255&r.charCodeAt(D)))*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295}return f^=r.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0},fy=function(r,e){for(var o,l=r.length,f=e^l,_=0;l>=4;)o=1540483477*(65535&(o=255&r.charCodeAt(_)|(255&r.charCodeAt(++_))<<8|(255&r.charCodeAt(++_))<<16|(255&r.charCodeAt(++_))<<24))+((1540483477*(o>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),l-=4,++_;switch(l){case 3:f^=(255&r.charCodeAt(_+2))<<16;case 2:f^=(255&r.charCodeAt(_+1))<<8;case 1:f=1540483477*(65535&(f^=255&r.charCodeAt(_)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};ou.exports=es,ou.exports.murmur3=es,ou.exports.murmur2=fy;var Ch=Ye(ou.exports);class Nu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,o,l,f){this.ids.push(dg(e)),this.positions.push(o,l,f)}getPositions(e){const o=dg(e);let l=0,f=this.ids.length-1;for(;l<f;){const y=l+f>>1;this.ids[y]>=o?f=y:l=y+1}const _=[];for(;this.ids[l]===o;)_.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return _}static serialize(e,o){const l=new Float64Array(e.ids),f=new Uint32Array(e.positions);return Eh(l,f,0,l.length-1),o&&o.push(l.buffer,f.buffer),{ids:l,positions:f}}static deserialize(e){const o=new Nu;return o.ids=e.ids,o.positions=e.positions,o.indexed=!0,o}}function dg(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Ch(String(r))}function Eh(r,e,o,l){for(;o<l;){const f=r[o+l>>1];let _=o-1,y=l+1;for(;;){do{_++}while(r[_]<f);do{y--}while(r[y]>f);if(_>=y)break;Bu(r,_,y),Bu(e,3*_,3*y),Bu(e,3*_+1,3*y+1),Bu(e,3*_+2,3*y+2)}y-o<l-y?(Eh(r,e,o,y),o=y+1):(Eh(r,e,y+1,l),l=y)}}function Bu(r,e,o){const l=r[e];r[e]=r[o],r[o]=l}yi(Nu,"FeaturePositionMap");class Ea{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,o),this.initialized=!0),!!this.location}}class uc extends Ea{constructor(e){super(e),this.current=0}set(e,o,l){this.fetchUniformLocation(e,o)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class au extends Ea{constructor(e){super(e),this.current=[0,0,0,0]}set(e,o,l){this.fetchUniformLocation(e,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class dp extends Ea{constructor(e){super(e),this.current=R.transparent}set(e,o,l){this.fetchUniformLocation(e,o)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const hp=new Float32Array(16),zu=new Float32Array(9),j0=new Float32Array(4);function fp(r){return[Pt(255*r.r,255*r.g),Pt(255*r.b,255*r.a)]}class Th{constructor(e,o,l){this.value=e,this.uniformNames=o.map(f=>`u_${f}`),this.type=l}setUniform(e,o,l,f,_){o.set(e,_,f.constantOr(this.value))}getBinding(e,o){return"color"===this.type?new dp(e):new uc(e)}}class Id{constructor(e,o){this.uniformNames=o.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,o,l,f,_){const y="u_pattern"===_||"u_dash"===_?this.pattern:"u_pixel_ratio"===_?this.pixelRatio:null;y&&o.set(e,_,y)}getBinding(e,o){return"u_pattern"===o||"u_dash"===o?new au(e):new uc(e)}}class Ic{constructor(e,o,l,f){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=o.map(_=>({name:`a_${_}`,type:"Float32",components:"color"===l?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,o,l,f,_,y){const w=this.paintVertexArray.length,E=this.expression.evaluate(new N(0),o,{},_,f,y);this.paintVertexArray.resize(e),this._setPaintValue(w,e,E)}updatePaintArray(e,o,l,f,_){const y=this.expression.evaluate({zoom:0},l,f,void 0,_);this._setPaintValue(e,o,y)}_setPaintValue(e,o,l){if("color"===this.type){const f=fp(l);for(let _=e;_<o;_++)this.paintVertexArray.emplace(_,f[0],f[1])}else{for(let f=e;f<o;f++)this.paintVertexArray.emplace(f,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class zl{constructor(e,o,l,f,_,y){this.expression=e,this.uniformNames=o.map(w=>`u_${w}_t`),this.type=l,this.useIntegerZoom=f,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=o.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===l?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,o,l,f,_,y){const w=this.expression.evaluate(new N(this.zoom),o,{},_,f,y),E=this.expression.evaluate(new N(this.zoom+1),o,{},_,f,y),D=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(D,e,w,E)}updatePaintArray(e,o,l,f,_){const y=this.expression.evaluate({zoom:this.zoom},l,f,void 0,_),w=this.expression.evaluate({zoom:this.zoom+1},l,f,void 0,_);this._setPaintValue(e,o,y,w)}_setPaintValue(e,o,l,f){if("color"===this.type){const _=fp(l),y=fp(f);for(let w=e;w<o;w++)this.paintVertexArray.emplace(w,_[0],_[1],y[0],y[1])}else{for(let _=e;_<o;_++)this.paintVertexArray.emplace(_,l,f);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(f))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,o,l,f,_){const y=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,w=Xe(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);o.set(e,_,w)}getBinding(e,o){return new uc(e)}}class lu{constructor(e,o,l,f,_){this.expression=e,this.layerId=_,this.paintVertexAttributes=("array"===l?cc:Ys).members;for(let y=0;y<o.length;++y);this.paintVertexArray=new f}populatePaintArray(e,o,l){const f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(f,e,o.patterns&&o.patterns[this.layerId],l)}updatePaintArray(e,o,l,f,_,y){this._setPaintValues(e,o,l.patterns&&l.patterns[this.layerId],y)}_setPaintValues(e,o,l,f){if(!f||!l)return;const _=f[l];if(!_)return;const{tl:y,br:w,pixelRatio:E}=_;for(let D=e;D<o;D++)this.paintVertexArray.emplace(D,y[0],y[1],w[0],w[1],E)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cu{constructor(e,o,l=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const _ in e.paint._values){if(!l(_))continue;const y=e.paint.get(_);if(!(y instanceof Qe&&fe(y.property.specification)))continue;const w=my(_,e.type),E=y.value,D=y.property.specification.type,L=!!y.property.useIntegerZoom,B="line-dasharray"===_||_.endsWith("pattern"),V="line-dasharray"===_&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==E.kind||V)if("source"===E.kind||V||B){const Y=Uu(_,D,"source");this.binders[_]=B?new lu(E,w,D,Y,e.id):new Ic(E,w,D,Y),f.push(`/a_${_}`)}else{const Y=Uu(_,D,"composite");this.binders[_]=new zl(E,w,D,L,o,Y),f.push(`/z_${_}`)}else this.binders[_]=B?new Id(E.value,w):new Th(E.value,w,D),f.push(`/u_${_}`)}this.cacheKey=f.sort().join("")}getMaxValue(e){const o=this.binders[e];return o instanceof Ic||o instanceof zl?o.maxValue:0}populatePaintArrays(e,o,l,f,_,y){for(const w in this.binders){const E=this.binders[w];(E instanceof Ic||E instanceof zl||E instanceof lu)&&E.populatePaintArray(e,o,l,f,_,y)}}setConstantPatternPositions(e){for(const o in this.binders){const l=this.binders[o];l instanceof Id&&l.setConstantPatternPositions(e)}}updatePaintArrays(e,o,l,f,_,y){let w=!1;for(const E in e){const D=o.getPositions(E);for(const L of D){const B=l.feature(L.index);for(const V in this.binders){const Y=this.binders[V];if((Y instanceof Ic||Y instanceof zl||Y instanceof lu)&&!0===Y.expression.isStateDependent){const Q=f.paint.get(V);Y.expression=Q.value,Y.updatePaintArray(L.start,L.end,B,e[E],_,y),w=!0}}}}return w}defines(){const e=[];for(const o in this.binders){const l=this.binders[o];(l instanceof Th||l instanceof Id)&&e.push(...l.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return e}getBinderAttributes(){const e=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof Ic||l instanceof zl||l instanceof lu)for(let f=0;f<l.paintVertexAttributes.length;f++)e.push(l.paintVertexAttributes[f].name)}return e}getBinderUniforms(){const e=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof Th||l instanceof Id||l instanceof zl)for(const f of l.uniformNames)e.push(f)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const o=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof Th||f instanceof Id||f instanceof zl)for(const _ of f.uniformNames)o.push({name:_,property:l,binding:f.getBinding(e,_)})}return o}setUniforms(e,o,l,f,_){for(const{name:y,property:w,binding:E}of l)this.binders[w].setUniform(e,E,_,f.get(w),y)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const o=this.binders[e];(o instanceof Ic||o instanceof zl||o instanceof lu)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const o in this.binders){const l=this.binders[o];(l instanceof Ic||l instanceof zl||l instanceof lu)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const o=this.binders[e];(o instanceof Ic||o instanceof zl||o instanceof lu)&&o.destroy()}}}class il{constructor(e,o,l=(()=>!0)){this.programConfigurations={};for(const f of e)this.programConfigurations[f.id]=new cu(f,o,l);this.needsUpload=!1,this._featureMap=new Nu,this._bufferOffset=0}populatePaintArrays(e,o,l,f,_,y,w){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(e,o,f,_,y,w);void 0!==o.id&&this._featureMap.add(o.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,o,l,f,_){for(const y of l)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,o,y,f,_)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const py={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function my(r,e){return py[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const ss={"line-pattern":{source:ln,composite:ln},"fill-pattern":{source:ln,composite:ln},"fill-extrusion-pattern":{source:ln,composite:ln},"line-dasharray":{source:An,composite:An}},gy={color:{source:ca,composite:Zn},number:{source:Vr,composite:ca}};function Uu(r,e,o){const l=ss[r];return l&&l[o]||gy[e][o]}yi(Th,"ConstantBinder"),yi(Id,"PatternConstantBinder"),yi(Ic,"SourceExpressionBinder"),yi(lu,"PatternCompositeBinder"),yi(zl,"CompositeExpressionBinder"),yi(cu,"ProgramConfiguration",{omit:["_buffers"]}),yi(il,"ProgramConfigurationSet");const hg="-transition";class Po extends wn{constructor(e,o){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),o.layout&&(this._unevaluatedLayout=new et(o.layout)),o.paint)){this._transitionablePaint=new re(o.paint);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new nt(o.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,o,l={}){null!=o&&this._validate(bh,`layers.${this.id}.layout.${e}`,e,o,l)||("visibility"!==e?this._unevaluatedLayout.setValue(e,o):this.visibility=o)}getPaintProperty(e){return Mn(e,hg)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,o,l={}){if(null!=o&&this._validate(Td,`layers.${this.id}.paint.${e}`,e,o,l))return!1;if(Mn(e,hg))return this._transitionablePaint.setTransition(e.slice(0,-11),o||void 0),!1;{const f=this._transitionablePaint._values[e],_=f.value.isDataDriven(),y=f.value;this._transitionablePaint.setValue(e,o),this._handleSpecialPaintPropertyUpdate(e);const w=this._transitionablePaint._values[e].value,E=w.isDataDriven(),D=Mn(e,"pattern")||"line-dasharray"===e;return E||_||D||this._handleOverridablePaintPropertyUpdate(e,y,w)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,o,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,o)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),qn(e,(o,l)=>!(void 0===o||"layout"===l&&!Object.keys(o).length||"paint"===l&&!Object.keys(o).length))}_validate(e,o,l,f,_={}){return(!_||!1!==_.validate)&&Nn(this,e.call(tu,{key:o,layerType:this.type,objectKey:l,value:f,styleSpec:It,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const o=this.paint.get(e);if(o instanceof Qe&&fe(o.property.specification)&&("source"===o.value.kind||"composite"===o.value.kind)&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=jr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const ju=Wt([{name:"a_pos",components:2,type:"Int16"}],4),fg=Wt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class _o{constructor(e=[]){this.segments=e}prepareSegment(e,o,l,f){let _=this.segments[this.segments.length-1];return e>_o.MAX_VERTEX_ARRAY_LENGTH&&Dt(`Max vertices per segment is ${_o.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!_||_.vertexLength+e>_o.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==f)&&(_={vertexOffset:o.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},void 0!==f&&(_.sortKey=f),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const e of this.segments)for(const o in e.vaos)e.vaos[o].destroy()}static simpleSegment(e,o,l,f){return new _o([{vertexOffset:e,primitiveOffset:o,vertexLength:l,primitiveLength:f,vaos:{},sortKey:0}])}}_o.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yi(_o,"SegmentVector");var Ii=8192;class Ul{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Gr?new Gr(e.lng,e.lat):Gr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Gr?new Gr(e.lng,e.lat):Gr.convert(e),this}extend(e){const o=this._sw,l=this._ne;let f,_;if(e instanceof Gr)f=e,_=e;else{if(!(e instanceof Ul))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Ul.convert(e)):this.extend(Gr.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Gr.convert(e)):this;if(f=e._sw,_=e._ne,!f||!_)return this}return o||l?(o.lng=Math.min(f.lng,o.lng),o.lat=Math.min(f.lat,o.lat),l.lng=Math.max(_.lng,l.lng),l.lat=Math.max(_.lat,l.lat)):(this._sw=new Gr(f.lng,f.lat),this._ne=new Gr(_.lng,_.lat)),this}getCenter(){return new Gr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Gr(this.getWest(),this.getNorth())}getSouthEast(){return new Gr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:l}=Gr.convert(e);let f=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&f}static convert(e){return!e||e instanceof Ul?e:new Ul(e)}}var pp=1e-6,ua=typeof Float32Array<"u"?Float32Array:Array;function _y(){var r=new ua(9);return ua!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Ta(r,e,o){var l=e[0],f=e[1],_=e[2],y=e[3],w=e[4],E=e[5],D=e[6],L=e[7],B=e[8],V=o[0],Y=o[1],Q=o[2],he=o[3],Ue=o[4],ot=o[5],bt=o[6],st=o[7],vt=o[8];return r[0]=V*l+Y*y+Q*D,r[1]=V*f+Y*w+Q*L,r[2]=V*_+Y*E+Q*B,r[3]=he*l+Ue*y+ot*D,r[4]=he*f+Ue*w+ot*L,r[5]=he*_+Ue*E+ot*B,r[6]=bt*l+st*y+vt*D,r[7]=bt*f+st*w+vt*L,r[8]=bt*_+st*E+vt*B,r}function ka(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Mc(r,e){var o=e[0],l=e[1],f=e[2],_=e[3],y=e[4],w=e[5],E=e[6],D=e[7],L=e[8],B=e[9],V=e[10],Y=e[11],Q=e[12],he=e[13],Ue=e[14],ot=e[15],bt=o*w-l*y,st=o*E-f*y,vt=o*D-_*y,St=l*E-f*w,At=l*D-_*w,un=f*D-_*E,nn=L*he-B*Q,In=L*Ue-V*Q,Jn=L*ot-Y*Q,hn=B*Ue-V*he,On=B*ot-Y*he,kn=V*ot-Y*Ue,Gn=bt*kn-st*On+vt*hn+St*Jn-At*In+un*nn;return Gn?(r[0]=(w*kn-E*On+D*hn)*(Gn=1/Gn),r[1]=(f*On-l*kn-_*hn)*Gn,r[2]=(he*un-Ue*At+ot*St)*Gn,r[3]=(V*At-B*un-Y*St)*Gn,r[4]=(E*Jn-y*kn-D*In)*Gn,r[5]=(o*kn-f*Jn+_*In)*Gn,r[6]=(Ue*vt-Q*un-ot*st)*Gn,r[7]=(L*un-V*vt+Y*st)*Gn,r[8]=(y*On-w*Jn+D*nn)*Gn,r[9]=(l*Jn-o*On-_*nn)*Gn,r[10]=(Q*At-he*vt+ot*bt)*Gn,r[11]=(B*vt-L*At-Y*bt)*Gn,r[12]=(w*In-y*hn-E*nn)*Gn,r[13]=(o*hn-l*In+f*nn)*Gn,r[14]=(he*st-Q*St-Ue*bt)*Gn,r[15]=(L*St-B*st+V*bt)*Gn,r):null}function Vu(r,e,o){var l=e[0],f=e[1],_=e[2],y=e[3],w=e[4],E=e[5],D=e[6],L=e[7],B=e[8],V=e[9],Y=e[10],Q=e[11],he=e[12],Ue=e[13],ot=e[14],bt=e[15],st=o[0],vt=o[1],St=o[2],At=o[3];return r[0]=st*l+vt*w+St*B+At*he,r[1]=st*f+vt*E+St*V+At*Ue,r[2]=st*_+vt*D+St*Y+At*ot,r[3]=st*y+vt*L+St*Q+At*bt,r[4]=(st=o[4])*l+(vt=o[5])*w+(St=o[6])*B+(At=o[7])*he,r[5]=st*f+vt*E+St*V+At*Ue,r[6]=st*_+vt*D+St*Y+At*ot,r[7]=st*y+vt*L+St*Q+At*bt,r[8]=(st=o[8])*l+(vt=o[9])*w+(St=o[10])*B+(At=o[11])*he,r[9]=st*f+vt*E+St*V+At*Ue,r[10]=st*_+vt*D+St*Y+At*ot,r[11]=st*y+vt*L+St*Q+At*bt,r[12]=(st=o[12])*l+(vt=o[13])*w+(St=o[14])*B+(At=o[15])*he,r[13]=st*f+vt*E+St*V+At*Ue,r[14]=st*_+vt*D+St*Y+At*ot,r[15]=st*y+vt*L+St*Q+At*bt,r}function $u(r,e,o){var l,f,_,y,w,E,D,L,B,V,Y,Q,he=o[0],Ue=o[1],ot=o[2];return e===r?(r[12]=e[0]*he+e[4]*Ue+e[8]*ot+e[12],r[13]=e[1]*he+e[5]*Ue+e[9]*ot+e[13],r[14]=e[2]*he+e[6]*Ue+e[10]*ot+e[14],r[15]=e[3]*he+e[7]*Ue+e[11]*ot+e[15]):(f=e[1],_=e[2],y=e[3],w=e[4],E=e[5],D=e[6],L=e[7],B=e[8],V=e[9],Y=e[10],Q=e[11],r[0]=l=e[0],r[1]=f,r[2]=_,r[3]=y,r[4]=w,r[5]=E,r[6]=D,r[7]=L,r[8]=B,r[9]=V,r[10]=Y,r[11]=Q,r[12]=l*he+w*Ue+B*ot+e[12],r[13]=f*he+E*Ue+V*ot+e[13],r[14]=_*he+D*Ue+Y*ot+e[14],r[15]=y*he+L*Ue+Q*ot+e[15]),r}function uu(r,e,o){var l=o[0],f=o[1],_=o[2];return r[0]=e[0]*l,r[1]=e[1]*l,r[2]=e[2]*l,r[3]=e[3]*l,r[4]=e[4]*f,r[5]=e[5]*f,r[6]=e[6]*f,r[7]=e[7]*f,r[8]=e[8]*_,r[9]=e[9]*_,r[10]=e[10]*_,r[11]=e[11]*_,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function mp(r,e,o){var l=Math.sin(o),f=Math.cos(o),_=e[4],y=e[5],w=e[6],E=e[7],D=e[8],L=e[9],B=e[10],V=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=_*f+D*l,r[5]=y*f+L*l,r[6]=w*f+B*l,r[7]=E*f+V*l,r[8]=D*f-_*l,r[9]=L*f-y*l,r[10]=B*f-w*l,r[11]=V*f-E*l,r}function Dh(r,e,o){var l=Math.sin(o),f=Math.cos(o),_=e[0],y=e[1],w=e[2],E=e[3],D=e[8],L=e[9],B=e[10],V=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=_*f-D*l,r[1]=y*f-L*l,r[2]=w*f-B*l,r[3]=E*f-V*l,r[8]=_*l+D*f,r[9]=y*l+L*f,r[10]=w*l+B*f,r[11]=E*l+V*f,r}function pg(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function mg(r,e,o){var l,f,_,y=o[0],w=o[1],E=o[2],D=Math.hypot(y,w,E);return D<pp?null:(y*=D=1/D,w*=D,E*=D,l=Math.sin(e),f=Math.cos(e),r[0]=y*y*(_=1-f)+f,r[1]=w*y*_+E*l,r[2]=E*y*_-w*l,r[3]=0,r[4]=y*w*_-E*l,r[5]=w*w*_+f,r[6]=E*w*_+y*l,r[7]=0,r[8]=y*E*_+w*l,r[9]=w*E*_-y*l,r[10]=E*E*_+f,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var yy=Vu;function Md(){var r=new ua(3);return ua!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Ad(r){var e=new ua(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Sd(r){return Math.hypot(r[0],r[1],r[2])}function dc(r,e,o){var l=new ua(3);return l[0]=r,l[1]=e,l[2]=o,l}function hc(r,e,o){return r[0]=e[0]+o[0],r[1]=e[1]+o[1],r[2]=e[2]+o[2],r}function Zu(r,e,o){return r[0]=e[0]-o[0],r[1]=e[1]-o[1],r[2]=e[2]-o[2],r}function gg(r,e,o){return r[0]=e[0]*o[0],r[1]=e[1]*o[1],r[2]=e[2]*o[2],r}function Gu(r,e,o){return r[0]=Math.min(e[0],o[0]),r[1]=Math.min(e[1],o[1]),r[2]=Math.min(e[2],o[2]),r}function du(r,e,o){return r[0]=Math.max(e[0],o[0]),r[1]=Math.max(e[1],o[1]),r[2]=Math.max(e[2],o[2]),r}function Js(r,e,o){return r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r}function Hu(r,e,o,l){return r[0]=e[0]+o[0]*l,r[1]=e[1]+o[1]*l,r[2]=e[2]+o[2]*l,r}function Ks(r,e){var o=e[0],l=e[1],f=e[2],_=o*o+l*l+f*f;return _>0&&(_=1/Math.sqrt(_)),r[0]=e[0]*_,r[1]=e[1]*_,r[2]=e[2]*_,r}function rl(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Ac(r,e,o){var l=e[0],f=e[1],_=e[2],y=o[0],w=o[1],E=o[2];return r[0]=f*E-_*w,r[1]=_*y-l*E,r[2]=l*w-f*y,r}function co(r,e,o){var l=e[0],f=e[1],_=e[2],y=o[3]*l+o[7]*f+o[11]*_+o[15];return r[0]=(o[0]*l+o[4]*f+o[8]*_+o[12])/(y=y||1),r[1]=(o[1]*l+o[5]*f+o[9]*_+o[13])/y,r[2]=(o[2]*l+o[6]*f+o[10]*_+o[14])/y,r}function _g(r,e,o){var l=o[0],f=o[1],_=o[2],y=e[0],w=e[1],E=e[2],D=f*E-_*w,L=_*y-l*E,B=l*w-f*y,V=f*B-_*L,Y=_*D-l*B,Q=l*L-f*D,he=2*o[3];return L*=he,B*=he,Y*=2,Q*=2,r[0]=y+(D*=he)+(V*=2),r[1]=w+L+Y,r[2]=E+B+Q,r}var Ih,ol=Zu,vy=gg,V0=Sd;function yg(r,e,o){return r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r[3]=e[3]*o,r}function vg(r,e){var o=e[0],l=e[1],f=e[2],_=e[3],y=o*o+l*l+f*f+_*_;return y>0&&(y=1/Math.sqrt(y)),r[0]=o*y,r[1]=l*y,r[2]=f*y,r[3]=_*y,r}function hu(r,e,o){var l=e[0],f=e[1],_=e[2],y=e[3];return r[0]=o[0]*l+o[4]*f+o[8]*_+o[12]*y,r[1]=o[1]*l+o[5]*f+o[9]*_+o[13]*y,r[2]=o[2]*l+o[6]*f+o[10]*_+o[14]*y,r[3]=o[3]*l+o[7]*f+o[11]*_+o[15]*y,r}function fu(){var r=new ua(4);return ua!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function gp(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Mh(r,e,o){o*=.5;var l=e[0],f=e[1],_=e[2],y=e[3],w=Math.sin(o),E=Math.cos(o);return r[0]=l*E+y*w,r[1]=f*E+_*w,r[2]=_*E-f*w,r[3]=y*E-l*w,r}function Pd(r,e,o){o*=.5;var l=e[0],f=e[1],_=e[2],y=e[3],w=Math.sin(o),E=Math.cos(o);return r[0]=l*E-_*w,r[1]=f*E+y*w,r[2]=_*E+l*w,r[3]=y*E-f*w,r}Md(),Ih=new ua(4),ua!=Float32Array&&(Ih[0]=0,Ih[1]=0,Ih[2]=0,Ih[3]=0);var _p=vg;Md(),dc(1,0,0),dc(0,1,0),fu(),fu(),_y();const xy=Wt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:yp}=xy,vp=Wt([{name:"a_pos_3",components:3,type:"Int16"}]);var Sc=Wt([{name:"a_pos",type:"Int16",components:2}]);class xg{constructor(e,o){this.pos=e,this.dir=o}intersectsPlane(e,o,l){const f=rl(o,this.dir);if(Math.abs(f)<1e-6)return!1;const _=((e[0]-this.pos[0])*o[0]+(e[1]-this.pos[1])*o[1]+(e[2]-this.pos[2])*o[2])/f;return l[0]=this.pos[0]+this.dir[0]*_,l[1]=this.pos[1]+this.dir[1]*_,l[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(e,o,l){if(he=(Y=this.pos)[0],Ue=Y[1],ot=Y[2],bt=(Q=e)[0],st=Q[1],vt=Q[2],Math.abs(he-bt)<=pp*Math.max(1,Math.abs(he),Math.abs(bt))&&Math.abs(Ue-st)<=pp*Math.max(1,Math.abs(Ue),Math.abs(st))&&Math.abs(ot-vt)<=pp*Math.max(1,Math.abs(ot),Math.abs(vt))||0===o)return l[0]=l[1]=l[2]=0,!1;var Y,Q,he,Ue,ot,bt,st,vt;const[f,_,y]=this.dir,w=this.pos[0]-e[0],E=this.pos[1]-e[1],D=this.pos[2]-e[2],L=f*f+_*_+y*y,B=2*(w*f+E*_+D*y),V=B*B-4*L*(w*w+E*E+D*D-o*o);if(V<0){const Y=Math.max(-B/2,0),Q=w+f*Y,he=E+_*Y,Ue=D+y*Y,ot=Math.hypot(Q,he,Ue);return l[0]=Q*o/ot,l[1]=he*o/ot,l[2]=Ue*o/ot,!1}{const Y=(-B-Math.sqrt(V))/(2*L);if(Y<0){const Q=Math.hypot(w,E,D);return l[0]=w*o/Q,l[1]=E*o/Q,l[2]=D*o/Q,!1}return l[0]=w+f*Y,l[1]=E+_*Y,l[2]=D+y*Y,!0}}}class Od{constructor(e,o,l,f,_){this.TL=e,this.TR=o,this.BR=l,this.BL=f,this.horizon=_}static fromInvProjectionMatrix(e,o,l){const f=[-1,1,1],_=[1,1,1],y=[1,-1,1],w=[-1,-1,1],E=co(f,f,e),D=co(_,_,e),L=co(y,y,e),B=co(w,w,e);return new Od(E,D,L,B,o/l)}}class xp{constructor(e,o){this.points=e,this.planes=o}static fromInvProjectionMatrix(e,o,l,f){const _=Math.pow(2,l),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const D=hu([],E,e),L=1/D[3]/o*_;return(B=D)[0]=(V=D)[0]*(Y=[L,L,f?1/D[3]:L,L])[0],B[1]=V[1]*Y[1],B[2]=V[2]*Y[2],B[3]=V[3]*Y[3],B;var B,V,Y}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const D=Ks([],Ac([],ol([],y[E[0]],y[E[1]]),ol([],y[E[2]],y[E[1]]))),L=-rl(D,y[E[1]]);return D.concat(L)});return new xp(y,w)}}class _s{static fromPoints(e){const o=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const f of e)Gu(o,o,f),du(l,l,f);return new _s(o,l)}static applyTransform(e,o){const l=e.getCorners();for(let f=0;f<l.length;++f)co(l[f],l[f],o);return _s.fromPoints(l)}constructor(e,o){this.min=e,this.max=o,this.center=Js([],hc([],this.min,this.max),.5)}quadrant(e){const o=[e%2==0,e<2],l=Ad(this.min),f=Ad(this.max);for(let _=0;_<o.length;_++)l[_]=o[_]?this.min[_]:this.center[_],f[_]=o[_]?this.center[_]:this.max[_];return f[2]=this.max[2],new _s(l,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,o=this.max;return[[e[0],e[1],e[2]],[o[0],e[1],e[2]],[o[0],o[1],e[2]],[e[0],o[1],e[2]],[e[0],e[1],o[2]],[o[0],e[1],o[2]],[o[0],o[1],o[2]],[e[0],o[1],o[2]]]}intersects(e){const o=this.getCorners();let l=!0;for(let f=0;f<e.planes.length;f++){const _=e.planes[f];let y=0;for(let w=0;w<o.length;w++)y+=rl(_,o[w])+_[3]>=0;if(0===y)return 0;y!==o.length&&(l=!1)}if(l)return 2;for(let f=0;f<3;f++){let _=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const E=e.points[w][f]-this.min[f];_=Math.min(_,E),y=Math.max(y,E)}if(y<0||_>this.max[f]-this.min[f])return 0}return 1}}const Ah=5,bp=6,Xs=Ii/Math.PI/2,by=16383,Pc=[64,32,16],sl=-Xs,Da=Xs,Sh=[new _s([sl,sl,sl],[Da,Da,Da]),new _s([sl,sl,sl],[0,0,Da]),new _s([0,sl,sl],[Da,0,Da]),new _s([sl,0,sl],[0,Da,Da]),new _s([0,0,sl],[Da,Da,Da])];function Fa(r){return r*Xs/gu}function pu(r,e,o,l=!0){const f=Js([],r._camera.position,r.worldSize),_=[e,o,1,1];hu(_,_,r.pixelMatrixInverse),yg(_,_,1/_[3]);const y=Ks([],ol([],_,f)),w=r.globeMatrix,E=[w[12],w[13],w[14]],D=ol([],E,f),L=Sd(D),B=Ks([],D),V=r.worldSize/(2*Math.PI),Y=rl(B,y),Q=Math.asin(V/L);if(Q<Math.acos(Y)){if(!l)return null;const Jn=[],hn=[];Js(Jn,y,L/Y),Ks(hn,ol(hn,Jn,D)),Ks(y,hc(y,D,Js(y,hn,Math.tan(Q)*L)))}const he=[];new xg(f,y).closestPointOnSphere(E,V,he);const Ue=Ks([],qe(w,0)),ot=Ks([],qe(w,1)),bt=Ks([],qe(w,2)),st=rl(Ue,he),vt=rl(ot,he),St=rl(bt,he),At=Ee(Math.asin(-vt/V));let un=Ee(Math.atan2(st,St));un=r.center.lng+function(Jn,hn){const On=(hn-Jn+180)%360-180;return On<-180?On+360:On}(r.center.lng,un);const nn=Vl(un),In=Xe($l(At),0,1);return new Lc(nn,In)}class wp{constructor(e,o,l){this.a=ol([],e,l),this.b=ol([],o,l),this.center=l;const f=Ks([],this.a),_=Ks([],this.b);this.angle=Math.acos(rl(f,_))}}function Cp(r,e){if(0===r.angle)return null;let o;return o=0===r.a[e]?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),o<0||o>1?null:function(l,f,_,y){const w=Math.sin(_);return l*(Math.sin((1-y)*_)/w)+f*(Math.sin(y*_)/w)}(r.a[e],r.b[e],r.angle,Xe(o,0,1))+r.center[e]}function jl(r){if(r.z<=1)return Sh[r.z+2*r.y+r.x];const e=Rd(Ph(r));return _s.fromPoints(e)}function Oc(r,e,o){return Js(r,r,1-o),Hu(r,r,e,o)}function mu(r,e){const o=Ju(e.zoom);if(0===o)return jl(r);const l=Ph(r),f=Rd(l),_=Vl(l.getWest())*e.worldSize,y=Vl(l.getEast())*e.worldSize,w=$l(l.getNorth())*e.worldSize,E=$l(l.getSouth())*e.worldSize,D=[_,w,0],L=[y,w,0],B=[_,E,0],V=[y,E,0],Y=Mc([],e.globeMatrix);return co(D,D,Y),co(L,L,Y),co(B,B,Y),co(V,V,Y),f[0]=Oc(f[0],B,o),f[1]=Oc(f[1],V,o),f[2]=Oc(f[2],L,o),f[3]=Oc(f[3],D,o),_s.fromPoints(f)}function bg(r,e,o){for(const l of r)co(l,l,e),Js(l,l,o)}function Ph({x:r,y:e,z:o}){const l=1/(1<<o),f=new Gr(Ba(r*l),To((e+1)*l)),_=new Gr(Ba((r+1)*l),To(e*l));return new Ul(f,_)}function Rd(r){const e=ne(r.getNorth()),o=ne(r.getSouth()),l=Math.cos(e),f=Math.cos(o),_=Math.sin(e),y=Math.sin(o),w=r.getWest(),E=r.getEast();return[Wu(f,y,w),Wu(f,y,E),Wu(l,_,E),Wu(l,_,w)]}function Wu(r,e,o,l=Xs){return o=ne(o),[r*Math.sin(o)*l,-e*l,r*Math.cos(o)*l]}function Rc(r,e,o){return Wu(Math.cos(ne(r)),Math.sin(ne(r)),e,o)}function qu(r,e,o,l){const f=1<<o.z,_=(r/Ii+o.x)/f;return Rc(To((e/Ii+o.y)/f),Ba(_),l)}function Oh({min:r,max:e}){return by/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const wg=new Float64Array(16);function Yu(r){const e=Oh(r),o=pg(wg,[e,e,e]);return $u(o,o,((l=[])[0]=-(f=r.min)[0],l[1]=-f[1],l[2]=-f[2],l));var l,f}function Ep(r){const e=(l=r.min,(o=wg)[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=l[0],o[13]=l[1],o[14]=l[2],o[15]=1,o);var o,l;const f=1/Oh(r);return uu(e,e,[f,f,f])}function Tp(r,e,o,l,f){const _=function(E){const D=Ii/(2*Math.PI);return E/(2*Math.PI)/D}(o),y=[r,e,-o/(2*Math.PI)],w=ka(new Float64Array(16));return $u(w,w,y),uu(w,w,[_,_,_]),mp(w,w,ne(-f)),Dh(w,w,ne(-l)),w}function Ju(r){return Ht(Ah,bp,r)}function Cg(r,e){const o=Rc(e.lat,e.lng);return y=(f=Zu([],function(Q){const he=Rc(Q._center.lat,Q._center.lng);let Ue=Ac([],dc(0,1,0),he);const ot=mg([],-Q.angle,he);Ue=co(Ue,Ue,ot),mg(ot,-Q._pitch,Ue);const bt=Ks([],he);return Js(bt,bt,Fa(Q.cameraToCenterDistance/Q.pixelsPerMeter)),co(bt,bt,ot),hc([],he,bt)}(r),o))[0],w=f[1],E=f[2],D=(_=o)[0],L=_[1],B=_[2],Y=(V=Math.sqrt(y*y+w*w+E*E)*Math.sqrt(D*D+L*L+B*B))&&rl(f,_)/V,Math.acos(Math.min(Math.max(Y,-1),1));var f,_,y,w,E,D,L,B,V,Y}function Eg(r,e){return Cg(r,e)>Math.PI/2*1.01}const Dp=ne(85),Tg=Math.cos(Dp),al=Math.sin(Dp),gu=6371008.8,pc=2*Math.PI*gu;class Cl{constructor(e,o){if(isNaN(e)||isNaN(o))throw new Error(`Invalid LngLat object: (${e}, ${o})`);if(this.lng=+e,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Cl(cn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const o=Math.PI/180,l=this.lat*o,f=e.lat*o,_=Math.sin(l)*Math.sin(f)+Math.cos(l)*Math.cos(f)*Math.cos((e.lng-this.lng)*o);return gu*Math.acos(Math.min(_,1))}toBounds(e=0){const o=360*e/40075017,l=o/Math.cos(Math.PI/180*this.lat);return new Ul(new Cl(this.lng-l,this.lat-o),new Cl(this.lng+l,this.lat+o))}toEcef(e){const o=Fa(e);return Rc(this.lat,this.lng,Xs+o)}static convert(e){if(e instanceof Cl)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Cl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Cl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Gr=Cl;function _u(r){return pc*Math.cos(r*Math.PI/180)}function Vl(r){return(180+r)/360}function $l(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Na(r,e){return r/_u(e)}function Ba(r){return 360*r-180}function To(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Ip(r,e){return r*_u(To(e))}const ys=85.051129;function Mp(r){return 1/Math.cos(r*Math.PI/180)}class Lc{constructor(e,o,l=0){this.x=+e,this.y=+o,this.z=+l}static fromLngLat(e,o=0){const l=Gr.convert(e);return new Lc(Vl(l.lng),$l(l.lat),Na(o,l.lat))}toLngLat(){return new Gr(Ba(this.x),To(this.y))}toAltitude(){return Ip(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/pc*Mp(To(this.y))}}function Dg(r,e,o,l,f,_,y,w,E){const D=(e+l)/2,L=(o+f)/2,B=new Ae(D,L);w(B),function(V,Y,Q,he,Ue,ot){const bt=Q-Ue,st=he-ot;return Math.abs((he-Y)*bt-(Q-V)*st)/Math.hypot(bt,st)}(B.x,B.y,_.x,_.y,y.x,y.y)>=E?(Dg(r,e,o,D,L,_,B,w,E),Dg(r,D,L,l,f,B,y,w,E)):r.push(y)}function Cy(r,e,o){let l=r[0],f=l.x,_=l.y;e(l);const y=[l];for(let w=1;w<r.length;w++){const E=r[w],{x:D,y:L}=E;e(E),Dg(y,f,_,D,L,l,E,e,o),f=D,_=L,l=E}return y}function Ap(r,e,o,l){if(l(e,o)){const f=e.add(o)._mult(.5);Ap(r,e,f,l),Ap(r,f,o,l)}else r.push(o)}function Ey(r,e){let o=r[0];const l=[o];for(let f=1;f<r.length;f++){const _=r[f];Ap(l,o,_,e),o=_}return l}const Sp=Math.pow(2,14)-1,Ig=-Sp-1;function Ty(r,e){const o=Math.round(r.x*e),l=Math.round(r.y*e);return r.x=Xe(o,Ig,Sp),r.y=Xe(l,Ig,Sp),(o<r.x||o>r.x+1||l<r.y||l>r.y+1)&&Dt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Zl(r,e,o){const l=r.loadGeometry(),f=r.extent,_=Ii/f;if(e&&o&&o.projection.isReprojectedInTileSpace){const y=1<<e.z,{scale:w,x:E,y:D,projection:L}=o,B=V=>{const Y=Ba((e.x+V.x/f)/y),Q=To((e.y+V.y/f)/y),he=L.project(Y,Q);V.x=(he.x*w-E)*f,V.y=(he.y*w-D)*f};for(let V=0;V<l.length;V++)if(1!==r.type)l[V]=Cy(l[V],B,1);else{const Y=[];for(const Q of l[V])Q.x<0||Q.x>=f||Q.y<0||Q.y>=f||(B(Q),Y.push(Q));l[V]=Y}}for(const y of l)for(const w of y)Ty(w,_);return l}function ll(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Zl(r):[]}}function Qs(r,e,o,l,f){r.emplaceBack(2*e+(l+1)/2,2*o+(f+1)/2)}function El(r,e,o){r.emplaceBack(e.x,e.y,e.z,16384*o[0],16384*o[1],16384*o[2])}class Ld{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Yn,this.indexArray=new Di,this.segments=new _o,this.programConfigurations=new il(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,l,f){const _=this.layers[0],y=[];let w=null;"circle"===_.type&&(w=_.layout.get("circle-sort-key"));for(const{feature:D,id:L,index:B,sourceLayerIndex:V}of e){const Y=this.layers[0]._featureFilter.needGeometry,Q=ll(D,Y);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),Q,l))continue;const he=w?w.evaluate(Q,{},l):void 0,Ue={id:L,properties:D.properties,type:D.type,sourceLayerIndex:V,index:B,geometry:Y?Q.geometry:Zl(D,l,f),patterns:{},sortKey:he};y.push(Ue)}w&&y.sort((D,L)=>D.sortKey-L.sortKey);let E=null;"globe"===f.projection.name&&(this.globeExtVertexArray=new Qn,E=f.projection);for(const D of y){const{geometry:L,index:B,sourceLayerIndex:V}=D,Y=e[B].feature;this.addFeature(D,L,B,o.availableImages,l,E),o.featureIndex.insert(Y,L,B,V,this.index)}}update(e,o,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,l,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ju.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,fg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,o,l,f,_,y){for(const w of o)for(const E of w){const D=E.x,L=E.y;if(D<0||D>=Ii||L<0||L>=Ii)continue;if(y){const Y=y.projectTilePoint(D,L,_),Q=y.upVector(_,D,L),he=this.globeExtVertexArray;El(he,Y,Q),El(he,Y,Q),El(he,Y,Q),El(he,Y,Q)}const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),V=B.vertexLength;Qs(this.layoutVertexArray,D,L,-1,-1),Qs(this.layoutVertexArray,D,L,1,-1),Qs(this.layoutVertexArray,D,L,1,1),Qs(this.layoutVertexArray,D,L,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+2,V+3),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},f,_)}}function Pp(r,e){for(let o=0;o<r.length;o++)if(Fc(e,r[o]))return!0;for(let o=0;o<e.length;o++)if(Fc(r,e[o]))return!0;return!!Xu(r,e)}function kc(r,e,o){return!!Fc(r,e)||!!Op(e,r,o)}function Ku(r,e){if(1===r.length)return Dy(e,r[0]);for(let o=0;o<e.length;o++){const l=e[o];for(let f=0;f<l.length;f++)if(Fc(r,l[f]))return!0}for(let o=0;o<r.length;o++)if(Dy(e,r[o]))return!0;for(let o=0;o<e.length;o++)if(Xu(r,e[o]))return!0;return!1}function $0(r,e,o){if(r.length>1){if(Xu(r,e))return!0;for(let l=0;l<e.length;l++)if(Op(e[l],r,o))return!0}for(let l=0;l<r.length;l++)if(Op(r[l],e,o))return!0;return!1}function Xu(r,e){if(0===r.length||0===e.length)return!1;for(let o=0;o<r.length-1;o++){const l=r[o],f=r[o+1];for(let _=0;_<e.length-1;_++)if(Mg(l,f,e[_],e[_+1]))return!0}return!1}function Mg(r,e,o,l){return Ie(r,o,l)!==Ie(e,o,l)&&Ie(r,e,o)!==Ie(r,e,l)}function Op(r,e,o){const l=o*o;if(1===e.length)return r.distSqr(e[0])<l;for(let f=1;f<e.length;f++)if(Rp(r,e[f-1],e[f])<l)return!0;return!1}function Rp(r,e,o){const l=e.distSqr(o);if(0===l)return r.distSqr(e);const f=((r.x-e.x)*(o.x-e.x)+(r.y-e.y)*(o.y-e.y))/l;return r.distSqr(f<0?e:f>1?o:o.sub(e)._mult(f)._add(e))}function Dy(r,e){let o,l,f,_=!1;for(let y=0;y<r.length;y++){o=r[y];for(let w=0,E=o.length-1;w<o.length;E=w++)l=o[w],f=o[E],l.y>e.y!=f.y>e.y&&e.x<(f.x-l.x)*(e.y-l.y)/(f.y-l.y)+l.x&&(_=!_)}return _}function Fc(r,e){let o=!1;for(let l=0,f=r.length-1;l<r.length;f=l++){const _=r[l],y=r[f];_.y>e.y!=y.y>e.y&&e.x<(y.x-_.x)*(e.y-_.y)/(y.y-_.y)+_.x&&(o=!o)}return o}function Iy(r,e,o,l,f){for(const y of r)if(e<=y.x&&o<=y.y&&l>=y.x&&f>=y.y)return!0;const _=[new Ae(e,o),new Ae(e,f),new Ae(l,f),new Ae(l,o)];if(r.length>2)for(const y of _)if(Fc(r,y))return!0;for(let y=0;y<r.length-1;y++)if(My(r[y],r[y+1],_))return!0;return!1}function My(r,e,o){const l=o[0],f=o[2];if(r.x<l.x&&e.x<l.x||r.x>f.x&&e.x>f.x||r.y<l.y&&e.y<l.y||r.y>f.y&&e.y>f.y)return!1;const _=Ie(r,e,o[0]);return _!==Ie(r,e,o[1])||_!==Ie(r,e,o[2])||_!==Ie(r,e,o[3])}function Qu(r,e,o){const l=e.paint.get(r).value;return"constant"===l.kind?l.value:o.programConfigurations.get(e.id).getMaxValue(r)}function ed(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Ay(r,e,o,l,f){if(!e[0]&&!e[1])return r;const _=Ae.convert(e)._mult(f);"viewport"===o&&_._rotate(-l);const y=[];for(let w=0;w<r.length;w++)y.push(r[w].sub(_));return y}function Sy(r,e,o,l){const f=Ae.convert(r)._mult(l);return"viewport"===e&&f._rotate(-o),f}yi(Ld,"CircleBucket",{omit:["layers"]});const Lp=new gt({"circle-sort-key":new We(It.layout_circle["circle-sort-key"])});var Z0={paint:new gt({"circle-radius":new We(It.paint_circle["circle-radius"]),"circle-color":new We(It.paint_circle["circle-color"]),"circle-blur":new We(It.paint_circle["circle-blur"]),"circle-opacity":new We(It.paint_circle["circle-opacity"]),"circle-translate":new ce(It.paint_circle["circle-translate"]),"circle-translate-anchor":new ce(It.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ce(It.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ce(It.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new We(It.paint_circle["circle-stroke-width"]),"circle-stroke-color":new We(It.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new We(It.paint_circle["circle-stroke-opacity"])}),layout:Lp};function Py(r,e,o,l,f,_,y,w,E){if(_&&r.queryGeometry.isAboveHorizon)return!1;_&&(E*=r.pixelToTileUnitsFactor);const D=r.tileID.canonical,L=o.projection.upVectorScale(D,o.center.lat,o.worldSize).metersToTile;for(const B of e)for(const V of B){const Y=V.add(w),Q=f&&o.elevation?o.elevation.exaggeration()*f.getElevationAt(Y.x,Y.y,!0):0,he=o.projection.projectTilePoint(Y.x,Y.y,D);if(Q>0){const st=o.projection.upVector(D,Y.x,Y.y);he.x+=st[0]*L*Q,he.y+=st[1]*L*Q,he.z+=st[2]*L*Q}const Ue=_?Y:G0(he.x,he.y,he.z,l),ot=_?r.tilespaceRays.map(st=>Ry(st,Q)):r.queryGeometry.screenGeometry,bt=hu([],[he.x,he.y,he.z,1],l);if(!y&&_?E*=bt[3]/o.cameraToCenterDistance:y&&!_&&(E*=o.cameraToCenterDistance/bt[3]),_){const st=To((V.y/Ii+D.y)/(1<<D.z));E/=o.projection.pixelsPerMeter(st,1)/Na(1,st)}if(kc(ot,Ue,E))return!0}return!1}function G0(r,e,o,l){const f=hu([],[r,e,o,1],l);return new Ae(f[0]/f[3],f[1]/f[3])}const Oy=dc(0,0,0),H0=dc(0,0,1);function Ry(r,e){const o=Md();return Oy[2]=e,r.intersectsPlane(Oy,H0,o),new Ae(o[0],o[1])}class kd extends Ld{}function Fd(r,{width:e,height:o},l,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==e*o*l)throw new RangeError("mismatched image size")}else f=new Uint8Array(e*o*l);return r.width=e,r.height=o,r.data=f,r}function Rh(r,e,o){const{width:l,height:f}=e;l===r.width&&f===r.height||(Lh(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,l),height:Math.min(r.height,f)},o),r.width=l,r.height=f,r.data=e.data)}function Lh(r,e,o,l,f,_){if(0===f.width||0===f.height)return e;if(f.width>r.width||f.height>r.height||o.x>r.width-f.width||o.y>r.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>e.width||f.height>e.height||l.x>e.width-f.width||l.y>e.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const y=r.data,w=e.data;for(let E=0;E<f.height;E++){const D=((o.y+E)*r.width+o.x)*_,L=((l.y+E)*e.width+l.x)*_;for(let B=0;B<f.width*_;B++)w[L+B]=y[D+B]}return e}yi(kd,"HeatmapBucket",{omit:["layers"]});class Gl{constructor(e,o){Fd(this,e,1,o)}resize(e){Rh(this,new Gl(e),1)}clone(){return new Gl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,l,f,_){Lh(e,o,l,f,_,1)}}class vs{constructor(e,o){Fd(this,e,4,o)}resize(e){Rh(this,new vs(e),4)}replace(e,o){o?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new vs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,l,f,_){Lh(e,o,l,f,_,4)}}yi(Gl,"AlphaImage"),yi(vs,"RGBAImage");var Ly={paint:new gt({"heatmap-radius":new We(It.paint_heatmap["heatmap-radius"]),"heatmap-weight":new We(It.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ce(It.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pt(It.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ce(It.paint_heatmap["heatmap-opacity"])})};function kh(r){const e={},o=r.resolution||256,l=r.clips?r.clips.length:1,f=r.image||new vs({width:o,height:l}),_=(y,w,E)=>{e[r.evaluationKey]=E;const D=r.expression.evaluate(e);f.data[y+w+0]=Math.floor(255*D.r/D.a),f.data[y+w+1]=Math.floor(255*D.g/D.a),f.data[y+w+2]=Math.floor(255*D.b/D.a),f.data[y+w+3]=Math.floor(255*D.a)};if(r.clips)for(let y=0,w=0;y<l;++y,w+=4*o)for(let E=0,D=0;E<o;E++,D+=4){const L=E/(o-1),{start:B,end:V}=r.clips[y];_(w,D,B*(1-L)+V*L)}else for(let y=0,w=0;y<o;y++,w+=4)_(0,w,y/(o-1));return f}var Ag={paint:new gt({"hillshade-illumination-direction":new ce(It.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ce(It.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ce(It.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ce(It.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ce(It.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ce(It.paint_hillshade["hillshade-accent-color"])})};const Fh=Wt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Nh}=Fh;var td={exports:{}};function Bh(r,e,o){o=o||2;var l,f,_,y,w,E,D,L=e&&e.length,B=L?e[0]*o:r.length,V=Sg(r,0,B,o,!0),Y=[];if(!V||V.next===V.prev)return Y;if(L&&(V=function(he,Ue,ot,bt){var st,vt,St,At=[];for(st=0,vt=Ue.length;st<vt;st++)(St=Sg(he,Ue[st]*bt,st<vt-1?Ue[st+1]*bt:he.length,bt,!1))===St.next&&(St.steiner=!0),At.push(Fp(St));for(At.sort(Pg),st=0;st<At.length;st++)ot=By(At[st],ot);return ot}(r,e,V,o)),r.length>80*o){l=_=r[0],f=y=r[1];for(var Q=o;Q<B;Q+=o)(w=r[Q])<l&&(l=w),(E=r[Q+1])<f&&(f=E),w>_&&(_=w),E>y&&(y=E);D=0!==(D=Math.max(_-l,y-f))?32767/D:0}return nd(V,Y,o,l,f,D,0),Y}function Sg(r,e,o,l,f){var _,y;if(f===Up(r,e,o,l)>0)for(_=e;_<o;_+=l)y=zp(_,r[_],r[_+1],y);else for(_=o-l;_>=e;_-=l)y=zp(_,r[_],r[_+1],y);return y&&Nc(y,y.next)&&(Bd(y),y=y.next),y}function yu(r,e){if(!r)return r;e||(e=r);var o,l=r;do{if(o=!1,l.steiner||!Nc(l,l.next)&&0!==Ir(l.prev,l,l.next))l=l.next;else{if(Bd(l),(l=e=l.prev)===l.next)break;o=!0}}while(o||l!==e);return e}function nd(r,e,o,l,f,_,y){if(r){!y&&_&&function(L,B,V,Y){var Q=L;do{0===Q.z&&(Q.z=ea(Q.x,Q.y,B,V,Y)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next}while(Q!==L);Q.prevZ.nextZ=null,Q.prevZ=null,function(he){var Ue,ot,bt,st,vt,St,At,un,nn=1;do{for(ot=he,he=null,vt=null,St=0;ot;){for(St++,bt=ot,At=0,Ue=0;Ue<nn&&(At++,bt=bt.nextZ);Ue++);for(un=nn;At>0||un>0&&bt;)0!==At&&(0===un||!bt||ot.z<=bt.z)?(st=ot,ot=ot.nextZ,At--):(st=bt,bt=bt.nextZ,un--),vt?vt.nextZ=st:he=st,st.prevZ=vt,vt=st;ot=bt}vt.nextZ=null,nn*=2}while(St>1)}(Q)}(r,l,f,_);for(var w,E,D=r;r.prev!==r.next;)if(w=r.prev,E=r.next,_?ky(r,l,f,_):kp(r))e.push(w.i/o|0),e.push(r.i/o|0),e.push(E.i/o|0),Bd(r),r=E.next,D=E.next;else if((r=E)===D){y?1===y?nd(r=Fy(yu(r),e,o),e,o,l,f,_,2):2===y&&Ny(r,e,o,l,f,_):nd(yu(r),e,o,l,f,_,1);break}}}function kp(r){var e=r.prev,o=r,l=r.next;if(Ir(e,o,l)>=0)return!1;for(var f=e.x,_=o.x,y=l.x,w=e.y,E=o.y,D=l.y,L=f<_?f<y?f:y:_<y?_:y,B=w<E?w<D?w:D:E<D?E:D,V=f>_?f>y?f:y:_>y?_:y,Y=w>E?w>D?w:D:E>D?E:D,Q=l.next;Q!==e;){if(Q.x>=L&&Q.x<=V&&Q.y>=B&&Q.y<=Y&&vu(f,w,_,E,y,D,Q.x,Q.y)&&Ir(Q.prev,Q,Q.next)>=0)return!1;Q=Q.next}return!0}function ky(r,e,o,l){var f=r.prev,_=r,y=r.next;if(Ir(f,_,y)>=0)return!1;for(var w=f.x,E=_.x,D=y.x,L=f.y,B=_.y,V=y.y,Y=w<E?w<D?w:D:E<D?E:D,Q=L<B?L<V?L:V:B<V?B:V,he=w>E?w>D?w:D:E>D?E:D,Ue=L>B?L>V?L:V:B>V?B:V,ot=ea(Y,Q,e,o,l),bt=ea(he,Ue,e,o,l),st=r.prevZ,vt=r.nextZ;st&&st.z>=ot&&vt&&vt.z<=bt;){if(st.x>=Y&&st.x<=he&&st.y>=Q&&st.y<=Ue&&st!==f&&st!==y&&vu(w,L,E,B,D,V,st.x,st.y)&&Ir(st.prev,st,st.next)>=0||(st=st.prevZ,vt.x>=Y&&vt.x<=he&&vt.y>=Q&&vt.y<=Ue&&vt!==f&&vt!==y&&vu(w,L,E,B,D,V,vt.x,vt.y)&&Ir(vt.prev,vt,vt.next)>=0))return!1;vt=vt.nextZ}for(;st&&st.z>=ot;){if(st.x>=Y&&st.x<=he&&st.y>=Q&&st.y<=Ue&&st!==f&&st!==y&&vu(w,L,E,B,D,V,st.x,st.y)&&Ir(st.prev,st,st.next)>=0)return!1;st=st.prevZ}for(;vt&&vt.z<=bt;){if(vt.x>=Y&&vt.x<=he&&vt.y>=Q&&vt.y<=Ue&&vt!==f&&vt!==y&&vu(w,L,E,B,D,V,vt.x,vt.y)&&Ir(vt.prev,vt,vt.next)>=0)return!1;vt=vt.nextZ}return!0}function Fy(r,e,o){var l=r;do{var f=l.prev,_=l.next.next;!Nc(f,_)&&Bp(f,l,l.next,_)&&id(f,_)&&id(_,f)&&(e.push(f.i/o|0),e.push(l.i/o|0),e.push(_.i/o|0),Bd(l),Bd(l.next),l=r=_),l=l.next}while(l!==r);return yu(l)}function Ny(r,e,o,l,f,_){var y=r;do{for(var w=y.next.next;w!==y.prev;){if(y.i!==w.i&&Np(y,w)){var E=Og(y,w);return y=yu(y,y.next),E=yu(E,E.next),nd(y,e,o,l,f,_,0),void nd(E,e,o,l,f,_,0)}w=w.next}y=y.next}while(y!==r)}function Pg(r,e){return r.x-e.x}function By(r,e){var o=function(f,_){var y,w=_,E=f.x,D=f.y,L=-1/0;do{if(D<=w.y&&D>=w.next.y&&w.next.y!==w.y){var B=w.x+(D-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(B<=E&&B>L&&(L=B,y=w.x<w.next.x?w:w.next,B===E))return y}w=w.next}while(w!==_);if(!y)return null;var V,Y=y,Q=y.x,he=y.y,Ue=1/0;w=y;do{E>=w.x&&w.x>=Q&&E!==w.x&&vu(D<he?E:L,D,Q,he,D<he?L:E,D,w.x,w.y)&&(V=Math.abs(D-w.y)/(E-w.x),id(w,f)&&(V<Ue||V===Ue&&(w.x>y.x||w.x===y.x&&zy(y,w)))&&(y=w,Ue=V)),w=w.next}while(w!==Y);return y}(r,e);if(!o)return e;var l=Og(o,r);return yu(l,l.next),yu(o,o.next)}function zy(r,e){return Ir(r.prev,r,e.prev)<0&&Ir(e.next,r,r.next)<0}function ea(r,e,o,l,f){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-o)*f|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*f|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Fp(r){var e=r,o=r;do{(e.x<o.x||e.x===o.x&&e.y<o.y)&&(o=e),e=e.next}while(e!==r);return o}function vu(r,e,o,l,f,_,y,w){return(f-y)*(e-w)>=(r-y)*(_-w)&&(r-y)*(l-w)>=(o-y)*(e-w)&&(o-y)*(_-w)>=(f-y)*(l-w)}function Np(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(o,l){var f=o;do{if(f.i!==o.i&&f.next.i!==o.i&&f.i!==l.i&&f.next.i!==l.i&&Bp(f,f.next,o,l))return!0;f=f.next}while(f!==o);return!1}(r,e)&&(id(r,e)&&id(e,r)&&function(o,l){var f=o,_=!1,y=(o.x+l.x)/2,w=(o.y+l.y)/2;do{f.y>w!=f.next.y>w&&f.next.y!==f.y&&y<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(_=!_),f=f.next}while(f!==o);return _}(r,e)&&(Ir(r.prev,r,e.prev)||Ir(r,e.prev,e))||Nc(r,e)&&Ir(r.prev,r,r.next)>0&&Ir(e.prev,e,e.next)>0)}function Ir(r,e,o){return(e.y-r.y)*(o.x-e.x)-(e.x-r.x)*(o.y-e.y)}function Nc(r,e){return r.x===e.x&&r.y===e.y}function Bp(r,e,o,l){var f=zh(Ir(r,e,o)),_=zh(Ir(r,e,l)),y=zh(Ir(o,l,r)),w=zh(Ir(o,l,e));return f!==_&&y!==w||!(0!==f||!Nd(r,o,e))||!(0!==_||!Nd(r,l,e))||!(0!==y||!Nd(o,r,l))||!(0!==w||!Nd(o,e,l))}function Nd(r,e,o){return e.x<=Math.max(r.x,o.x)&&e.x>=Math.min(r.x,o.x)&&e.y<=Math.max(r.y,o.y)&&e.y>=Math.min(r.y,o.y)}function zh(r){return r>0?1:r<0?-1:0}function id(r,e){return Ir(r.prev,r,r.next)<0?Ir(r,e,r.next)>=0&&Ir(r,r.prev,e)>=0:Ir(r,e,r.prev)<0||Ir(r,r.next,e)<0}function Og(r,e){var o=new Uh(r.i,r.x,r.y),l=new Uh(e.i,e.x,e.y),f=r.next,_=e.prev;return r.next=e,e.prev=r,o.next=f,f.prev=o,l.next=o,o.prev=l,_.next=l,l.prev=_,l}function zp(r,e,o,l){var f=new Uh(r,e,o);return l?(f.next=l.next,f.prev=l,l.next.prev=f,l.next=f):(f.prev=f,f.next=f),f}function Bd(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Uh(r,e,o){this.i=r,this.x=e,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Up(r,e,o,l){for(var f=0,_=e,y=o-l;_<o;_+=l)f+=(r[y]-r[_])*(r[_+1]+r[y+1]),y=_;return f}td.exports=Bh,td.exports.default=Bh,Bh.deviation=function(r,e,o,l){var f=e&&e.length,_=Math.abs(Up(r,0,f?e[0]*o:r.length,o));if(f)for(var y=0,w=e.length;y<w;y++)_-=Math.abs(Up(r,e[y]*o,y<w-1?e[y+1]*o:r.length,o));var E=0;for(y=0;y<l.length;y+=3){var D=l[y]*o,L=l[y+1]*o,B=l[y+2]*o;E+=Math.abs((r[D]-r[B])*(r[L+1]-r[D+1])-(r[D]-r[L])*(r[B+1]-r[D+1]))}return 0===_&&0===E?0:Math.abs((E-_)/_)},Bh.flatten=function(r){for(var e=r[0][0].length,o={vertices:[],holes:[],dimensions:e},l=0,f=0;f<r.length;f++){for(var _=0;_<r[f].length;_++)for(var y=0;y<e;y++)o.vertices.push(r[f][_][y]);f>0&&o.holes.push(l+=r[f-1].length)}return o};var jp=Ye(td.exports);function Vp(r,e,o,l,f){jh(r,e,o||0,l||r.length-1,f||Ud)}function jh(r,e,o,l,f){for(;l>o;){if(l-o>600){var _=l-o+1,y=e-o+1,w=Math.log(_),E=.5*Math.exp(2*w/3),D=.5*Math.sqrt(w*E*(_-E)/_)*(y-_/2<0?-1:1);jh(r,e,Math.max(o,Math.floor(e-y*E/_+D)),Math.min(l,Math.floor(e+(_-y)*E/_+D)),f)}var L=r[e],B=o,V=l;for(zd(r,o,e),f(r[l],L)>0&&zd(r,o,l);B<V;){for(zd(r,B,V),B++,V--;f(r[B],L)<0;)B++;for(;f(r[V],L)>0;)V--}0===f(r[o],L)?zd(r,o,V):zd(r,++V,l),V<=e&&(o=V+1),e<=V&&(l=V-1)}}function zd(r,e,o){var l=r[e];r[e]=r[o],r[o]=l}function Ud(r,e){return r<e?-1:r>e?1:0}function $p(r,e){const o=r.length;if(o<=1)return[r];const l=[];let f,_;for(let y=0;y<o;y++){const w=Ct(r[y]);0!==w&&(r[y].area=Math.abs(w),void 0===_&&(_=w<0),_===w<0?(f&&l.push(f),f=[r[y]]):f.push(r[y]))}if(f&&l.push(f),e>1)for(let y=0;y<l.length;y++)l[y].length<=e||(Vp(l[y],e,1,l[y].length-1,Uy),l[y]=l[y].slice(0,e));return l}function Uy(r,e){return e.area-r.area}function Vh(r,e,o){const l=o.patternDependencies;let f=!1;for(const _ of e){const y=_.paint.get(`${r}-pattern`);y.isConstant()||(f=!0);const w=y.constantOr(null);w&&(f=!0,l[w]=!0)}return f}function $h(r,e,o,l,f){const _=f.patternDependencies;for(const y of e){const w=y.paint.get(`${r}-pattern`).value;if("constant"!==w.kind){let E=w.evaluate({zoom:l},o,{},f.availableImages);E=E&&E.name?E.name:E,_[E]=!0,o.patterns[y.id]=E}}return o}class jd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Yn,this.indexArray=new Di,this.indexArray2=new oo,this.programConfigurations=new il(e.layers,e.zoom),this.segments=new _o,this.segments2=new _o,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=e.projection}populate(e,o,l,f){this.hasPattern=Vh("fill",this.layers,o);const _=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:w,id:E,index:D,sourceLayerIndex:L}of e){const B=this.layers[0]._featureFilter.needGeometry,V=ll(w,B);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),V,l))continue;const Y=_?_.evaluate(V,{},l,o.availableImages):void 0,Q={id:E,properties:w.properties,type:w.type,sourceLayerIndex:L,index:D,geometry:B?V.geometry:Zl(w,l,f),patterns:{},sortKey:Y};y.push(Q)}_&&y.sort((w,E)=>w.sortKey-E.sortKey);for(const w of y){const{geometry:E,index:D,sourceLayerIndex:L}=w;if(this.hasPattern){const B=$h("fill",this.layers,w,this.zoom,o);this.patternFeatures.push(B)}else this.addFeature(w,E,D,l,{},o.availableImages);o.featureIndex.insert(e[D].feature,E,D,L,this.index)}}update(e,o,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,l,f)}addFeatures(e,o,l,f,_){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,o,l,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Nh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,o,l,f,_,y=[]){for(const w of $p(o,500)){let E=0;for(const Q of w)E+=Q.length;const D=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),L=D.vertexLength,B=[],V=[];for(const Q of w){if(0===Q.length)continue;Q!==w[0]&&V.push(B.length/2);const he=this.segments2.prepareSegment(Q.length,this.layoutVertexArray,this.indexArray2),Ue=he.vertexLength;this.layoutVertexArray.emplaceBack(Q[0].x,Q[0].y),this.indexArray2.emplaceBack(Ue+Q.length-1,Ue),B.push(Q[0].x),B.push(Q[0].y);for(let ot=1;ot<Q.length;ot++)this.layoutVertexArray.emplaceBack(Q[ot].x,Q[ot].y),this.indexArray2.emplaceBack(Ue+ot-1,Ue+ot),B.push(Q[ot].x),B.push(Q[ot].y);he.vertexLength+=Q.length,he.primitiveLength+=Q.length}const Y=jp(B,V);for(let Q=0;Q<Y.length;Q+=3)this.indexArray.emplaceBack(L+Y[Q],L+Y[Q+1],L+Y[Q+2]);D.vertexLength+=E,D.primitiveLength+=Y.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,_,y,f)}}yi(jd,"FillBucket",{omit:["layers","patternFeatures"]});const rd=new gt({"fill-sort-key":new We(It.layout_fill["fill-sort-key"])});var Zh={paint:new gt({"fill-antialias":new ce(It.paint_fill["fill-antialias"]),"fill-opacity":new We(It.paint_fill["fill-opacity"]),"fill-color":new We(It.paint_fill["fill-color"]),"fill-outline-color":new We(It.paint_fill["fill-outline-color"]),"fill-translate":new ce(It.paint_fill["fill-translate"]),"fill-translate-anchor":new ce(It.paint_fill["fill-translate-anchor"]),"fill-pattern":new We(It.paint_fill["fill-pattern"])}),layout:rd};const Rg=Wt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Zp=Wt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Gh=Wt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:jy}=Rg;var Hh={},Vy=Be,Lg=od;function od(r,e,o,l,f){this.properties={},this.extent=o,this.type=0,this._pbf=r,this._geometry=-1,this._keys=l,this._values=f,r.readFields($y,this,e)}function $y(r,e,o){1==r?e.id=o.readVarint():2==r?function(l,f){for(var _=l.readVarint()+l.pos;l.pos<_;){var y=f._keys[l.readVarint()],w=f._values[l.readVarint()];f.properties[y]=w}}(o,e):3==r?e.type=o.readVarint():4==r&&(e._geometry=o.pos)}function kg(r){for(var e,o,l=0,f=0,_=r.length,y=_-1;f<_;y=f++)l+=((o=r[y]).x-(e=r[f]).x)*(e.y+o.y);return l}od.types=["Unknown","Point","LineString","Polygon"],od.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,o=r.readVarint()+r.pos,l=1,f=0,_=0,y=0,w=[];r.pos<o;){if(f<=0){var E=r.readVarint();l=7&E,f=E>>3}if(f--,1===l||2===l)_+=r.readSVarint(),y+=r.readSVarint(),1===l&&(e&&w.push(e),e=[]),e.push(new Vy(_,y));else{if(7!==l)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&w.push(e),w},od.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,o=1,l=0,f=0,_=0,y=1/0,w=-1/0,E=1/0,D=-1/0;r.pos<e;){if(l<=0){var L=r.readVarint();o=7&L,l=L>>3}if(l--,1===o||2===o)(f+=r.readSVarint())<y&&(y=f),f>w&&(w=f),(_+=r.readSVarint())<E&&(E=_),_>D&&(D=_);else if(7!==o)throw new Error("unknown command "+o)}return[y,E,w,D]},od.prototype.toGeoJSON=function(r,e,o){var l,f,_=this.extent*Math.pow(2,o),y=this.extent*r,w=this.extent*e,E=this.loadGeometry(),D=od.types[this.type];function L(Y){for(var Q=0;Q<Y.length;Q++){var he=Y[Q];Y[Q]=[360*(he.x+y)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(he.y+w)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(l=0;l<E.length;l++)B[l]=E[l][0];L(E=B);break;case 2:for(l=0;l<E.length;l++)L(E[l]);break;case 3:for(E=function(Y){var Q=Y.length;if(Q<=1)return[Y];for(var he,Ue,ot=[],bt=0;bt<Q;bt++){var st=kg(Y[bt]);0!==st&&(void 0===Ue&&(Ue=st<0),Ue===st<0?(he&&ot.push(he),he=[Y[bt]]):he.push(Y[bt]))}return he&&ot.push(he),ot}(E),l=0;l<E.length;l++)for(f=0;f<E[l].length;f++)L(E[l][f])}1===E.length?E=E[0]:D="Multi"+D;var V={type:"Feature",geometry:{type:D,coordinates:E},properties:this.properties};return"id"in this&&(V.id=this.id),V};var Vd=Lg,$d=Wh;function Wh(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Zy,this,e),this.length=this._features.length}function Zy(r,e,o){15===r?e.version=o.readVarint():1===r?e.name=o.readString():5===r?e.extent=o.readVarint():2===r?e._features.push(o.pos):3===r?e._keys.push(o.readString()):4===r&&e._values.push(function(l){for(var f=null,_=l.readVarint()+l.pos;l.pos<_;){var y=l.readVarint()>>3;f=1===y?l.readString():2===y?l.readFloat():3===y?l.readDouble():4===y?l.readVarint64():5===y?l.readVarint():6===y?l.readSVarint():7===y?l.readBoolean():null}return f}(o))}Wh.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new Vd(this._pbf,e,this.extent,this._keys,this._values)};var Gy=$d;function Gp(r,e,o){if(3===r){var l=new Gy(o,o.readVarint()+o.pos);l.length&&(e[l.name]=l)}}var qh=Hh.VectorTile=function(r,e){this.layers=r.readFields(Gp,{},e)},Hl=Hh.VectorTileFeature=Lg;function Zd(r,e,o,l){const f=[],_=0===l?(y,w,E,D,L,B)=>{y.push(new Ae(B,E+(B-w)/(D-w)*(L-E)))}:(y,w,E,D,L,B)=>{y.push(new Ae(w+(B-E)/(L-E)*(D-w),B))};for(const y of r){const w=[];for(const E of y){if(E.length<=2)continue;const D=[];for(let V=0;V<E.length-1;V++){const Y=E[V].x,Q=E[V].y,he=E[V+1].x,Ue=E[V+1].y,ot=0===l?Y:Q,bt=0===l?he:Ue;ot<e?bt>e&&_(D,Y,Q,he,Ue,e):ot>o?bt<o&&_(D,Y,Q,he,Ue,o):D.push(E[V]),bt<e&&ot>=e&&_(D,Y,Q,he,Ue,e),bt>o&&ot<=o&&_(D,Y,Q,he,Ue,o)}let L=E[E.length-1];const B=0===l?L.x:L.y;B>=e&&B<=o&&D.push(L),D.length&&(L=D[D.length-1],D[0].x===L.x&&D[0].y===L.y||D.push(D[0]),w.push(D))}w.length&&f.push(w)}return f}Hh.VectorTileLayer=$d;const Fg=Hl.types,Hy=Math.pow(2,13);function Yh(r,e,o,l,f,_,y,w){r.emplaceBack((e<<1)+y,(o<<1)+_,(Math.floor(l*Hy)<<1)+f,Math.round(w))}function Bc(r,e,o){r.emplaceBack(e.x,e.y,e.z,16384*o[0],16384*o[1],16384*o[2])}class Ng{constructor(){this.acc=new Ae(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ae(e.x,e.y),this.max=new Ae(e.x,e.y))}append(e,o){this.currentPolyCount.edges++,this.acc._add(e);const l=this.min,f=this.max;e.x<l.x?l.x=e.x:e.x>f.x&&(f.x=e.x),e.y<l.y?l.y=e.y:e.y>f.y&&(f.y=e.y),((0===e.x||e.x===Ii)&&e.x===o.x)!=((0===e.y||e.y===Ii)&&e.y===o.y)&&this.processBorderOverlap(e,o),o.x<0!=e.x<0&&this.addBorderIntersection(0,_i(o.y,e.y,(0-o.x)/(e.x-o.x))),o.x>Ii!=e.x>Ii&&this.addBorderIntersection(1,_i(o.y,e.y,(Ii-o.x)/(e.x-o.x))),o.y<0!=e.y<0&&this.addBorderIntersection(2,_i(o.x,e.x,(0-o.y)/(e.y-o.y))),o.y>Ii!=e.y>Ii&&this.addBorderIntersection(3,_i(o.x,e.x,(Ii-o.y)/(e.y-o.y)))}addBorderIntersection(e,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];o<l[0]&&(l[0]=o),o>l[1]&&(l[1]=o)}processBorderOverlap(e,o){if(e.x===o.x){if(e.y===o.y)return;const l=0===e.x?0:1;this.addBorderIntersection(l,o.y),this.addBorderIntersection(l,e.y)}else{const l=0===e.y?2:3;this.addBorderIntersection(l,o.x),this.addBorderIntersection(l,e.x)}}centroid(){const e=this.polyCount.reduce((o,l)=>o+l.edges,0);return 0!==e?this.acc.div(e)._round():new Ae(0,0)}span(){return new Ae(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,o)=>e+ +(o[0]!==Number.MAX_VALUE),0)}}class sd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Pn,this.centroidVertexArray=new Ca,this.indexArray=new Di,this.programConfigurations=new il(e.layers,e.zoom),this.segments=new _o,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.enableTerrain=e.enableTerrain}populate(e,o,l,f){this.features=[],this.hasPattern=Vh("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(_){const y=Math.exp(Math.PI*(1-_.y/(1<<_.z)*2));return 80150034*y/(y*y+1)/Ii/(1<<_.z)}(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:_,id:y,index:w,sourceLayerIndex:E}of e){const D=this.layers[0]._featureFilter.needGeometry,L=ll(_,D);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),L,l))continue;const B={id:y,sourceLayerIndex:E,index:w,geometry:D?L.geometry:Zl(_,l,f),properties:_.properties,type:_.type,patterns:{}},V=this.layoutVertexArray.length;this.hasPattern?this.features.push($h("fill-extrusion",this.layers,B,this.zoom,o)):this.addFeature(B,B.geometry,w,l,{},o.availableImages,f),o.featureIndex.insert(_,B.geometry,w,E,this.index,V)}this.sortBorders()}addFeatures(e,o,l,f,_){for(const y of this.features){const{geometry:w}=y;this.addFeature(y,w,y.index,o,l,f,_)}this.sortBorders()}update(e,o,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,l,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jy),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Gh.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Zp.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,o,l,f,_,y,w){const E=[new Ae(0,0),new Ae(Ii,Ii)],D=w.projection,L="globe"===D.name,B=this.enableTerrain&&!L?new Ng:null,V="Polygon"===Fg[e.type];L&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Qn);const Y=$p(o,500);for(let ot=Y.length-1;ot>=0;ot--){const bt=Y[ot];(0===bt.length||(Q=bt[0]).every(st=>st.x<=0)||Q.every(st=>st.x>=Ii)||Q.every(st=>st.y<=0)||Q.every(st=>st.y>=Ii))&&Y.splice(ot,1)}var Q;let he;if(L)he=Kh(Y,E,f);else{he=[];for(const ot of Y)he.push({polygon:ot,bounds:E})}const Ue=V?this.edgeRadius:0;for(const{polygon:ot,bounds:bt}of he){let st=0,vt=0;for(const At of ot)V&&!At[0].equals(At[At.length-1])&&At.push(At[0]),vt+=V?At.length-1:At.length;const St=this.segments.prepareSegment((V?5:4)*vt,this.layoutVertexArray,this.indexArray);if(V){const At=[],un=[];st=St.vertexLength;for(const In of ot){let Jn,hn;In.length&&In!==ot[0]&&un.push(At.length/2),Jn=In[1].sub(In[0])._perp()._unit();for(let On=1;On<In.length;On++){const kn=In[On],Gn=In[On===In.length-1?1:On+1];let{x:ii,y:En}=kn;if(Ue){hn=Gn.sub(kn)._perp()._unit();const hi=Jn.add(hn)._unit(),Ei=Ue*Math.min(4,1/(Jn.x*hi.x+Jn.y*hi.y));ii+=Ei*hi.x,En+=Ei*hi.y,Jn=hn}Yh(this.layoutVertexArray,ii,En,0,0,1,1,0),St.vertexLength++,At.push(kn.x,kn.y),L&&Bc(this.layoutVertexExtArray,D.projectTilePoint(ii,En,f),D.upVector(f,ii,En))}}const nn=jp(At,un);for(let In=0;In<nn.length;In+=3)this.indexArray.emplaceBack(st+nn[In],st+nn[In+2],st+nn[In+1]),St.primitiveLength++}for(const At of ot){B&&At.length&&B.startRing(At[0]);let un,nn,In,Jn=At.length>4&&Gd(At[At.length-2],At[0],At[1]),hn=Ue?Bg(At[At.length-2],At[0],At[1],Ue):0;nn=At[1].sub(At[0])._perp()._unit();let On=!0;for(let kn=1,Gn=0;kn<At.length;kn++){let ii=At[kn-1],En=At[kn];const hi=At[kn===At.length-1?1:kn+1];if(B&&V&&B.currentPolyCount.top++,Wp(En,ii,bt)){Ue&&(nn=hi.sub(En)._perp()._unit(),On=!On);continue}B&&B.append(En,ii);const Ei=En.sub(ii)._perp(),mi=Ei.x/(Math.abs(Ei.x)+Math.abs(Ei.y)),Hi=Ei.y>0?1:0,ri=ii.dist(En);if(Gn+ri>32768&&(Gn=0),Ue){In=hi.sub(En)._perp()._unit();let Qi=Jh(ii,En,hi,Hp(nn,In),Ue);isNaN(Qi)&&(Qi=0);const zi=En.sub(ii)._unit();ii=ii.add(zi.mult(hn))._round(),En=En.add(zi.mult(-Qi))._round(),hn=Qi,nn=In}const Pi=St.vertexLength,nr=At.length>4&&Gd(ii,En,hi);let Mr=ad(Gn,Jn,On);if(Yh(this.layoutVertexArray,ii.x,ii.y,mi,Hi,0,0,Mr),Yh(this.layoutVertexArray,ii.x,ii.y,mi,Hi,0,1,Mr),Gn+=ri,Mr=ad(Gn,nr,!On),Jn=nr,Yh(this.layoutVertexArray,En.x,En.y,mi,Hi,0,0,Mr),Yh(this.layoutVertexArray,En.x,En.y,mi,Hi,0,1,Mr),St.vertexLength+=4,this.indexArray.emplaceBack(Pi+0,Pi+1,Pi+2),this.indexArray.emplaceBack(Pi+1,Pi+3,Pi+2),St.primitiveLength+=2,Ue){const Qi=st+(1===kn?At.length-2:kn-2),zi=1===kn?st:Qi+1;if(this.indexArray.emplaceBack(Pi+1,Qi,Pi+3),this.indexArray.emplaceBack(Qi,zi,Pi+3),St.primitiveLength+=2,void 0===un&&(un=Pi),!Wp(hi,At[kn],bt)){const ro=kn===At.length-1?un:St.vertexLength;this.indexArray.emplaceBack(Pi+2,Pi+3,ro),this.indexArray.emplaceBack(Pi+3,ro+1,ro),this.indexArray.emplaceBack(Pi+3,zi,ro+1),St.primitiveLength+=3}On=!On}if(L){const Qi=this.layoutVertexExtArray,zi=D.projectTilePoint(ii.x,ii.y,f),ro=D.projectTilePoint(En.x,En.y,f),ir=D.upVector(f,ii.x,ii.y),rr=D.upVector(f,En.x,En.y);Bc(Qi,zi,ir),Bc(Qi,zi,ir),Bc(Qi,ro,rr),Bc(Qi,ro,rr)}}V&&(st+=At.length-1)}}if(B&&B.polyCount.length>0){if(B.borders){B.vertexArrayOffset=this.centroidVertexArray.length;const ot=B.borders,bt=this.featuresOnBorder.push(B)-1;for(let st=0;st<4;st++)ot[st][0]!==Number.MAX_VALUE&&this.borders[st].push(bt)}this.encodeCentroid(B.borders?void 0:B.centroid(),B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,_,y,f)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((o,l)=>this.featuresOnBorder[o].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}encodeCentroid(e,o,l=!0){let f,_;if(e)if(0!==e.y){const w=o.span()._mult(this.tileToMeter);f=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(w.x/10)),_=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else f=Math.ceil(7*(e.x+450)),_=0;else f=0,_=+l;let y=l?this.centroidVertexArray.length:o.vertexArrayOffset;for(const w of o.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let E=0;E<w.top;E++)this.centroidVertexArray.emplace(y++,f,_);for(let E=0;E<2*w.edges;E++)this.centroidVertexArray.emplace(y++,0,_),this.centroidVertexArray.emplace(y++,f,_)}}}function Hp(r,e){const o=r.add(e)._unit();return r.x*o.x+r.y*o.y}function Bg(r,e,o,l){const f=e.sub(r)._perp()._unit(),_=o.sub(e)._perp()._unit();return Jh(r,e,o,Hp(f,_),l)}function Jh(r,e,o,l,f){const _=Math.sqrt(1-l*l);return Math.min(r.dist(e)/3,e.dist(o)/3,f*_/l)}function Wp(r,e,o){return r.x<o[0].x&&e.x<o[0].x||r.x>o[1].x&&e.x>o[1].x||r.y<o[0].y&&e.y<o[0].y||r.y>o[1].y&&e.y>o[1].y}function Gd(r,e,o){if(r.x<0||r.x>=Ii||e.x<0||e.x>=Ii||o.x<0||o.x>=Ii)return!1;const l=o.sub(e),f=l.perp(),_=r.sub(e);return(l.x*_.x+l.y*_.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(_.x*_.x+_.y*_.y))>-.866&&f.x*_.x+f.y*_.y<0}function ad(r,e,o){const l=e?2|r:-3&r;return o?1|l:-2&l}function qp(){const r=Math.PI/32,e=Math.tan(r),o=gu;return o*Math.sqrt(1+2*e*e)-o}function Kh(r,e,o){const l=1<<o.z,f=Ba(o.x/l),_=Ba((o.x+1)/l),y=To(o.y/l),w=To((o.y+1)/l);return function(E,D,L,B,V=0,Y){const Q=[];if(!E.length||!L||!B)return Q;const he=(At,un)=>{for(const nn of At)Q.push({polygon:nn,bounds:un})},Ue=Math.ceil(Math.log2(L)),ot=Math.ceil(Math.log2(B)),bt=Ue-ot,st=[];for(let At=0;At<Math.abs(bt);At++)st.push(bt>0?0:1);for(let At=0;At<Math.min(Ue,ot);At++)st.push(0),st.push(1);let vt=E;if(vt=Zd(vt,D[0].y-V,D[1].y+V,1),vt=Zd(vt,D[0].x-V,D[1].x+V,0),!vt.length)return Q;const St=[];for(st.length?St.push({polygons:vt,bounds:D,depth:0}):he(vt,D);St.length;){const At=St.pop(),un=At.depth,nn=st[un],In=At.bounds[0],Jn=At.bounds[1],hn=0===nn?In.x:In.y,On=0===nn?Jn.x:Jn.y,kn=Y?Y(nn,hn,On):.5*(hn+On),Gn=Zd(At.polygons,hn-V,kn+V,nn),ii=Zd(At.polygons,kn-V,On+V,nn);if(Gn.length){const En=[In,new Ae(0===nn?kn:Jn.x,1===nn?kn:Jn.y)];st.length>un+1?St.push({polygons:Gn,bounds:En,depth:un+1}):he(Gn,En)}if(ii.length){const En=[new Ae(0===nn?kn:In.x,1===nn?kn:In.y),Jn];st.length>un+1?St.push({polygons:ii,bounds:En,depth:un+1}):he(ii,En)}}return Q}(r,e,Math.ceil((_-f)/11.25),Math.ceil((y-w)/11.25),1,(E,D,L)=>{if(0===E)return.5*(D+L);{const B=To((o.y+D/Ii)/l);return($l(.5*(To((o.y+L/Ii)/l)+B))*l-o.y)*Ii}})}yi(sd,"FillExtrusionBucket",{omit:["layers","features"]}),yi(Ng,"PartMetadata");const Xh=new gt({"fill-extrusion-edge-radius":new ce(It["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var zg={paint:new gt({"fill-extrusion-opacity":new ce(It["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new We(It["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ce(It["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ce(It["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new We(It["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new We(It["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new We(It["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ce(It["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ce(It["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ce(It["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new ce(It["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Xh};function Qh(r,e,o){var l=2*Math.PI*6378137/256/Math.pow(2,o);return[r*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class zc{constructor(e,o,l){this.z=e,this.x=o,this.y=l,this.key=Hd(0,e,e,o,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,o){const l=(y=this.y,w=this.z,E=Qh(256*(_=this.x),256*(y=Math.pow(2,w)-y-1),w),D=Qh(256*(_+1),256*(y+1),w),E[0]+","+E[1]+","+D[0]+","+D[1]),f=function(_,y,w){let E,D="";for(let L=_;L>0;L--)E=1<<L-1,D+=(y&E?1:0)+(w&E?2:0);return D}(this.z,this.x,this.y);var _,y,w,E,D;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===o?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ug{constructor(e,o){this.wrap=e,this.canonical=o,this.key=Hd(e,o.z,o.z,o.x,o.y)}}class As{constructor(e,o,l,f,_){this.overscaledZ=e,this.wrap=o,this.canonical=new zc(l,+f,+_),this.key=0===o&&e===l?this.canonical.key:Hd(o,e,l,f,_)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const o=this.canonical.z-e;return e>this.canonical.z?new As(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new As(e,this.wrap,e,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(e,o=!0){if(this.overscaledZ===e&&o)return this.key;if(e>this.canonical.z)return Hd(this.wrap*+o,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return Hd(this.wrap*+o,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const o=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>o&&e.canonical.y===this.canonical.y>>o}children(e){if(this.overscaledZ>=e)return[new As(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,l=2*this.canonical.x,f=2*this.canonical.y;return[new As(o,this.wrap,o,l,f),new As(o,this.wrap,o,l+1,f),new As(o,this.wrap,o,l,f+1),new As(o,this.wrap,o,l+1,f+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new As(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new As(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ug(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Hd(r,e,o,l,f){const _=1<<Math.min(o,22);let y=_*(f%_)+l%_;return r&&o<22&&(y+=_*_*((r<0?-2*r-1:2*r)%(1<<2*(22-o)))),16*(32*y+o)+(e-o)}yi(zc,"CanonicalTileID"),yi(As,"OverscaledTileID",{omit:["projMatrix"]});class ld extends Ae{constructor(e,o,l){super(e,o),this.z=l}}function Wd(r,e){return r.x*e.x+r.y*e.y}function Yp(r,e){if(1===r.length){let o=0;const l=e[o++];let f;for(;!f||l.equals(f);)if(f=e[o++],!f)return 1/0;for(;o<e.length;o++){const _=e[o],y=r[0],w=f.sub(l),E=_.sub(l),D=y.sub(l),L=Wd(w,w),B=Wd(w,E),V=Wd(E,E),Y=Wd(D,w),Q=Wd(D,E),he=L*V-B*B,Ue=(V*Y-B*Q)/he,ot=(L*Q-B*Y)/he,bt=l.z*(1-Ue-ot)+f.z*Ue+_.z*ot;if(isFinite(bt))return bt}return 1/0}{let o=1/0;for(const l of e)o=Math.min(o,l.z);return o}}function Jp(r,e,o,l,f,_,y,w){const E=y*f.getElevationAt(r,e,!0,!0),D=0!==_[0],L=D?0===_[1]?y*(_[0]/7-450):y*function(B,V,Y){const Q=Math.floor(V[0]/8),he=Math.floor(V[1]/8),Ue=10*(V[0]-8*Q),ot=10*(V[1]-8*he),bt=B.getElevationAt(Q,he,!0,!0),st=B.getMeterToDEM(Y),vt=Math.floor(.5*(Ue*st-1)),St=Math.floor(.5*(ot*st-1)),At=B.tileCoordToPixel(Q,he),un=2*vt+1,nn=2*St+1,In=(Ei=un,mi=nn,[(ii=B).getElevationAtPixel(En=At.x-vt,hi=At.y-St,!0),ii.getElevationAtPixel(En+mi,hi,!0),ii.getElevationAtPixel(En,hi+mi,!0),ii.getElevationAtPixel(En+Ei,hi+mi,!0)]),Jn=Math.abs(In[0]-In[1]),hn=Math.abs(In[2]-In[3]),On=Math.abs(In[0]-In[2])+Math.abs(In[1]-In[3]),kn=Math.min(.25,.5*st*(Jn+hn)/un),Gn=Math.min(.25,.5*st*On/nn);var ii,En,hi,Ei,mi;return bt+Math.max(kn*Ue,Gn*ot)}(f,_,w):E;return{base:E+(0===o)?-1:o,top:D?Math.max(L+l,E+o+2):E+l}}const ef=Wt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Kp}=ef,cd=Wt([{name:"a_packed",components:4,type:"Float32"}]),{members:Wy}=cd,qy=Hl.types,W0=Math.cos(Math.PI/180*37.5);class tf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new dn,this.layoutVertexArray2=new Zn,this.indexArray=new Di,this.programConfigurations=new il(e.layers,e.zoom),this.segments=new _o,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,l,f){this.hasPattern=Vh("line",this.layers,o);const _=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:L,id:B,index:V,sourceLayerIndex:Y}of e){const Q=this.layers[0]._featureFilter.needGeometry,he=ll(L,Q);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),he,l))continue;const Ue=_?_.evaluate(he,{},l):void 0,ot={id:B,properties:L.properties,type:L.type,sourceLayerIndex:Y,index:V,geometry:Q?he.geometry:Zl(L,l,f),patterns:{},sortKey:Ue};y.push(ot)}_&&y.sort((L,B)=>L.sortKey-B.sortKey);const{lineAtlas:w,featureIndex:E}=o,D=this.addConstantDashes(w);for(const L of y){const{geometry:B,index:V,sourceLayerIndex:Y}=L;if(D&&this.addFeatureDashes(L,w),this.hasPattern){const Q=$h("line",this.layers,L,this.zoom,o);this.patternFeatures.push(Q)}else this.addFeature(L,B,V,l,w.positions,o.availableImages);E.insert(e[V].feature,B,V,Y,this.index)}}addConstantDashes(e){let o=!1;for(const l of this.layers){const f=l.paint.get("line-dasharray").value,_=l.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==_.kind)o=!0;else{const y=_.value,w=f.value;if(!w)continue;e.addDash(w,y)}}return o}addFeatureDashes(e,o){const l=this.zoom;for(const f of this.layers){const _=f.paint.get("line-dasharray").value,y=f.layout.get("line-cap").value;if("constant"===_.kind&&"constant"===y.kind)continue;let w,E;if("constant"===_.kind){if(w=_.value,!w)continue}else w=_.evaluate({zoom:l},e);E="constant"===y.kind?y.value:y.evaluate({zoom:l},e),o.addDash(w,E),e.patterns[f.id]=o.getKey(w,E)}}update(e,o,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,l,f)}addFeatures(e,o,l,f,_){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,o,l,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Wy)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kp),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,o,l,f,_,y){const w=this.layers[0].layout,E=w.get("line-join").evaluate(e,{}),D=w.get("line-cap").evaluate(e,{}),L=w.get("line-miter-limit"),B=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const V of o)this.addLine(V,e,E,D,L,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,_,y,f)}addLine(e,o,l,f,_,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ot=0;ot<e.length-1;ot++)this.totalDistance+=e[ot].dist(e[ot+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===qy[o.type];let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let D=0;for(;D<E-1&&e[D].equals(e[D+1]);)D++;if(E<(w?3:2))return;"bevel"===l&&(_=1.05);const L=this.overscaling<=16?15*Ii/(512*this.overscaling):0,B=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let V,Y,Q,he,Ue;this.e1=this.e2=-1,w&&(V=e[E-2],Ue=e[D].sub(V)._unit()._perp());for(let ot=D;ot<E;ot++){if(Q=ot===E-1?w?e[D+1]:void 0:e[ot+1],Q&&e[ot].equals(Q))continue;Ue&&(he=Ue),V&&(Y=V),V=e[ot],Ue=Q?Q.sub(V)._unit()._perp():he,he=he||Ue;let bt=he.add(Ue);0===bt.x&&0===bt.y||bt._unit();const st=he.x*Ue.x+he.y*Ue.y,vt=bt.x*Ue.x+bt.y*Ue.y,St=0!==vt?1/vt:1/0,At=2*Math.sqrt(2-2*vt),un=vt<W0&&Y&&Q,nn=he.x*Ue.y-he.y*Ue.x>0;if(un&&ot>D){const hn=V.dist(Y);if(hn>2*L){const On=V.sub(V.sub(Y)._mult(L/hn)._round());this.updateDistance(Y,On),this.addCurrentVertex(On,he,0,0,B),Y=On}}const In=Y&&Q;let Jn=In?l:w?"butt":f;if(In&&"round"===Jn&&(St<y?Jn="miter":St<=2&&(Jn="fakeround")),"miter"===Jn&&St>_&&(Jn="bevel"),"bevel"===Jn&&(St>2&&(Jn="flipbevel"),St<_&&(Jn="miter")),Y&&this.updateDistance(Y,V),"miter"===Jn)bt._mult(St),this.addCurrentVertex(V,bt,0,0,B);else if("flipbevel"===Jn){if(St>100)bt=Ue.mult(-1);else{const hn=St*he.add(Ue).mag()/he.sub(Ue).mag();bt._perp()._mult(hn*(nn?-1:1))}this.addCurrentVertex(V,bt,0,0,B),this.addCurrentVertex(V,bt.mult(-1),0,0,B)}else if("bevel"===Jn||"fakeround"===Jn){const hn=-Math.sqrt(St*St-1),On=nn?hn:0,kn=nn?0:hn;if(Y&&this.addCurrentVertex(V,he,On,kn,B),"fakeround"===Jn){const Gn=Math.round(180*At/Math.PI/20);for(let ii=1;ii<Gn;ii++){let En=ii/Gn;if(.5!==En){const Ei=En-.5;En+=En*Ei*(En-1)*((1.0904+st*(st*(3.55645-1.43519*st)-3.2452))*Ei*Ei+(.848013+st*(.215638*st-1.06021)))}const hi=Ue.sub(he)._mult(En)._add(he)._unit()._mult(nn?-1:1);this.addHalfVertex(V,hi.x,hi.y,!1,nn,0,B)}}Q&&this.addCurrentVertex(V,Ue,-On,-kn,B)}else if("butt"===Jn)this.addCurrentVertex(V,bt,0,0,B);else if("square"===Jn){const hn=Y?1:-1;Y||this.addCurrentVertex(V,bt,hn,hn,B),this.addCurrentVertex(V,bt,0,0,B),Y&&this.addCurrentVertex(V,bt,hn,hn,B)}else"round"===Jn&&(Y&&(this.addCurrentVertex(V,he,0,0,B),this.addCurrentVertex(V,he,1,1,B,!0)),Q&&(this.addCurrentVertex(V,Ue,-1,-1,B,!0),this.addCurrentVertex(V,Ue,0,0,B)));if(un&&ot<E-1){const hn=V.dist(Q);if(hn>2*L){const On=V.add(Q.sub(V)._mult(L/hn)._round());this.updateDistance(V,On),this.addCurrentVertex(On,Ue,0,0,B),V=On}}}}addCurrentVertex(e,o,l,f,_,y=!1){const w=o.y*f-o.x,E=-o.y-o.x*f;this.addHalfVertex(e,o.x+o.y*l,o.y-o.x*l,y,!1,l,_),this.addHalfVertex(e,w,E,y,!0,-f,_)}addHalfVertex({x:e,y:o},l,f,_,y,w,E){this.layoutVertexArray.emplaceBack((e<<1)+(_?1:0),(o<<1)+(y?1:0),Math.round(63*l)+128,Math.round(63*f)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const D=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),E.primitiveLength++),y?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,o){this.distance+=e.dist(o),this.updateScaledDistance()}}yi(tf,"LineBucket",{omit:["layers","patternFeatures"]});const nf=new gt({"line-cap":new We(It.layout_line["line-cap"]),"line-join":new We(It.layout_line["line-join"]),"line-miter-limit":new ce(It.layout_line["line-miter-limit"]),"line-round-limit":new ce(It.layout_line["line-round-limit"]),"line-sort-key":new We(It.layout_line["line-sort-key"])});var rf={paint:new gt({"line-opacity":new We(It.paint_line["line-opacity"]),"line-color":new We(It.paint_line["line-color"]),"line-translate":new ce(It.paint_line["line-translate"]),"line-translate-anchor":new ce(It.paint_line["line-translate-anchor"]),"line-width":new We(It.paint_line["line-width"]),"line-gap-width":new We(It.paint_line["line-gap-width"]),"line-offset":new We(It.paint_line["line-offset"]),"line-blur":new We(It.paint_line["line-blur"]),"line-dasharray":new We(It.paint_line["line-dasharray"]),"line-pattern":new We(It.paint_line["line-pattern"]),"line-gradient":new pt(It.paint_line["line-gradient"]),"line-trim-offset":new ce(It.paint_line["line-trim-offset"])}),layout:nf};const Xp=new class extends We{possiblyEvaluate(r,e){return e=new N(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(r,e)}evaluate(r,e,o,l){return e=ke({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(r,e,o,l)}}(rf.paint.properties["line-width"].specification);function Qp(r,e){return e>0?e+2*r:r}Xp.useIntegerZoom=!0;const jg=Wt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vg=Wt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Yy=Wt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Wt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jy=Wt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Ky=Wt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Wt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $g=Wt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xy=Wt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Wt([{name:"triangle",components:3,type:"Uint16"}]),Wt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Wt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Wt([{type:"Float32",name:"offsetX"}]),Wt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var yo=24;const da=128;function em(r,e){const{expression:o}=e;if("constant"===o.kind)return{kind:"constant",layoutSize:o.evaluate(new N(r+1))};if("source"===o.kind)return{kind:"source"};{const{zoomStops:l,interpolationType:f}=o;let _=0;for(;_<l.length&&l[_]<=r;)_++;_=Math.max(0,_-1);let y=_;for(;y<l.length&&l[y]<r+1;)y++;y=Math.min(l.length-1,y);const w=l[_],E=l[y];return"composite"===o.kind?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:E,minSize:o.evaluate(new N(w)),maxSize:o.evaluate(new N(E)),interpolationType:f}}}function tm(r,{uSize:e,uSizeT:o},{lowerSize:l,upperSize:f}){return"source"===r.kind?l/da:"composite"===r.kind?_i(l/da,f/da,o):e}function qd(r,e){let o=0,l=0;if("constant"===r.kind)l=r.layoutSize;else if("source"!==r.kind){const{interpolationType:f,minZoom:_,maxZoom:y}=r,w=f?Xe(Qo.interpolationFactor(f,e,_,y),0,1):0;"camera"===r.kind?l=_i(r.minSize,r.maxSize,w):o=w}return{uSizeT:o,uSize:l}}var q0=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:da,evaluateSizeForFeature:tm,evaluateSizeForZoom:qd,getSizeData:em});function Y0(r,e,o){return r.sections.forEach(l=>{l.text=function(f,_,y){const w=_.layout.get("text-transform").evaluate(y,{});return"uppercase"===w?f=f.toLocaleUpperCase():"lowercase"===w&&(f=f.toLocaleLowerCase()),M.applyArabicShaping&&(f=M.applyArabicShaping(f)),f}(l.text,e,o)}),r}const sf={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Zg(r){return"\ufe36"===r||"\ufe48"===r||"\ufe38"===r||"\ufe44"===r||"\ufe42"===r||"\ufe3e"===r||"\ufe3c"===r||"\ufe3a"===r||"\ufe18"===r||"\ufe40"===r||"\ufe10"===r||"\ufe13"===r||"\ufe14"===r||"\uff40"===r||"\uffe3"===r||"\ufe11"===r||"\ufe12"===r}function Qy(r){return"\ufe35"===r||"\ufe47"===r||"\ufe37"===r||"\ufe43"===r||"\ufe41"===r||"\ufe3d"===r||"\ufe3b"===r||"\ufe39"===r||"\ufe17"===r||"\ufe3f"===r}var Gg=Hr,Hg=function(r,e,o,l,f){var _,y,w=8*f-l-1,E=(1<<w)-1,D=E>>1,L=-7,B=o?f-1:0,V=o?-1:1,Y=r[e+B];for(B+=V,_=Y&(1<<-L)-1,Y>>=-L,L+=w;L>0;_=256*_+r[e+B],B+=V,L-=8);for(y=_&(1<<-L)-1,_>>=-L,L+=l;L>0;y=256*y+r[e+B],B+=V,L-=8);if(0===_)_=1-D;else{if(_===E)return y?NaN:1/0*(Y?-1:1);y+=Math.pow(2,l),_-=D}return(Y?-1:1)*y*Math.pow(2,_-l)},Wg=function(r,e,o,l,f,_){var y,w,E,D=8*_-f-1,L=(1<<D)-1,B=L>>1,V=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,Y=l?0:_-1,Q=l?1:-1,he=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,y=L):(y=Math.floor(Math.log(e)/Math.LN2),e*(E=Math.pow(2,-y))<1&&(y--,E*=2),(e+=y+B>=1?V/E:V*Math.pow(2,1-B))*E>=2&&(y++,E/=2),y+B>=L?(w=0,y=L):y+B>=1?(w=(e*E-1)*Math.pow(2,f),y+=B):(w=e*Math.pow(2,B-1)*Math.pow(2,f),y=0));f>=8;r[o+Y]=255&w,Y+=Q,w/=256,f-=8);for(y=y<<f|w,D+=f;D>0;r[o+Y]=255&y,Y+=Q,y/=256,D-=8);r[o+Y-Q]|=128*he};function Hr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Hr.Varint=0,Hr.Fixed64=1,Hr.Bytes=2,Hr.Fixed32=5;var Tl=4294967296,ud=1/Tl,nm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Wl(r){return r.type===Hr.Bytes?r.readVarint()+r.pos:r.pos+1}function ev(r,e,o){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));o.realloc(l);for(var f=o.pos-1;f>=r;f--)o.buf[f+l]=o.buf[f]}function J0(r,e){for(var o=0;o<r.length;o++)e.writeVarint(r[o])}function K0(r,e){for(var o=0;o<r.length;o++)e.writeSVarint(r[o])}function im(r,e){for(var o=0;o<r.length;o++)e.writeFloat(r[o])}function rm(r,e){for(var o=0;o<r.length;o++)e.writeDouble(r[o])}function X0(r,e){for(var o=0;o<r.length;o++)e.writeBoolean(r[o])}function Q0(r,e){for(var o=0;o<r.length;o++)e.writeFixed32(r[o])}function qg(r,e){for(var o=0;o<r.length;o++)e.writeSFixed32(r[o])}function tv(r,e){for(var o=0;o<r.length;o++)e.writeFixed64(r[o])}function nv(r,e){for(var o=0;o<r.length;o++)e.writeSFixed64(r[o])}function af(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function dd(r,e,o){r[o]=e,r[o+1]=e>>>8,r[o+2]=e>>>16,r[o+3]=e>>>24}function om(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}Hr.prototype={destroy:function(){this.buf=null},readFields:function(r,e,o){for(o=o||this.length;this.pos<o;){var l=this.readVarint(),f=l>>3,_=this.pos;this.type=7&l,r(f,e,this),this.pos===_&&this.skip(l)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=af(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=om(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=af(this.buf,this.pos)+af(this.buf,this.pos+4)*Tl;return this.pos+=8,r},readSFixed64:function(){var r=af(this.buf,this.pos)+om(this.buf,this.pos+4)*Tl;return this.pos+=8,r},readFloat:function(){var r=Hg(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Hg(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,o,l=this.buf;return e=127&(o=l[this.pos++]),o<128?e:(e|=(127&(o=l[this.pos++]))<<7,o<128?e:(e|=(127&(o=l[this.pos++]))<<14,o<128?e:(e|=(127&(o=l[this.pos++]))<<21,o<128?e:function(f,_,y){var w,E,D=y.buf;if(w=(112&(E=D[y.pos++]))>>4,E<128||(w|=(127&(E=D[y.pos++]))<<3,E<128)||(w|=(127&(E=D[y.pos++]))<<10,E<128)||(w|=(127&(E=D[y.pos++]))<<17,E<128)||(w|=(127&(E=D[y.pos++]))<<24,E<128)||(w|=(1&(E=D[y.pos++]))<<31,E<128))return function xu(r,e,o){return o?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}(f,w,_);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(o=l[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&nm?nm.decode(this.buf.subarray(e,r)):function(o,l,f){for(var _="",y=l;y<f;){var w,E,D,L=o[y],B=null,V=L>239?4:L>223?3:L>191?2:1;if(y+V>f)break;1===V?L<128&&(B=L):2===V?128==(192&(w=o[y+1]))&&(B=(31&L)<<6|63&w)<=127&&(B=null):3===V?(E=o[y+2],128==(192&(w=o[y+1]))&&128==(192&E)&&((B=(15&L)<<12|(63&w)<<6|63&E)<=2047||B>=55296&&B<=57343)&&(B=null)):4===V&&(E=o[y+2],D=o[y+3],128==(192&(w=o[y+1]))&&128==(192&E)&&128==(192&D)&&((B=(15&L)<<18|(63&w)<<12|(63&E)<<6|63&D)<=65535||B>=1114112)&&(B=null)),null===B?(B=65533,V=1):B>65535&&(B-=65536,_+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),_+=String.fromCharCode(B),y+=V}return _}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Hr.Bytes)return r.push(this.readVarint(e));var o=Wl(this);for(r=r||[];this.pos<o;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Hr.Bytes)return r.push(this.readSVarint());var e=Wl(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Hr.Bytes)return r.push(this.readBoolean());var e=Wl(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Hr.Bytes)return r.push(this.readFloat());var e=Wl(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Hr.Bytes)return r.push(this.readDouble());var e=Wl(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Hr.Bytes)return r.push(this.readFixed32());var e=Wl(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Hr.Bytes)return r.push(this.readSFixed32());var e=Wl(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Hr.Bytes)return r.push(this.readFixed64());var e=Wl(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Hr.Bytes)return r.push(this.readSFixed64());var e=Wl(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Hr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Hr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Hr.Fixed32)this.pos+=4;else{if(e!==Hr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var o=new Uint8Array(e);o.set(this.buf),this.buf=o,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),dd(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),dd(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),dd(this.buf,-1&r,this.pos),dd(this.buf,Math.floor(r*ud),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),dd(this.buf,-1&r,this.pos),dd(this.buf,Math.floor(r*ud),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,o){var l,f,_,w;if(e>=0?(l=e%4294967296|0,f=e/4294967296|0):(f=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,f=f+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),_=l,(w=o).buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,w.buf[w.pos]=127&(_>>>=7),function(_,y){var w=(7&_)<<4;y.buf[y.pos++]|=w|((_>>>=3)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_)))))}(f,o)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(l,f,_){for(var y,w,E=0;E<f.length;E++){if((y=f.charCodeAt(E))>55295&&y<57344){if(!w){y>56319||E+1===f.length?(l[_++]=239,l[_++]=191,l[_++]=189):w=y;continue}if(y<56320){l[_++]=239,l[_++]=191,l[_++]=189,w=y;continue}y=w-55296<<10|y-56320|65536,w=null}else w&&(l[_++]=239,l[_++]=191,l[_++]=189,w=null);y<128?l[_++]=y:(y<2048?l[_++]=y>>6|192:(y<65536?l[_++]=y>>12|224:(l[_++]=y>>18|240,l[_++]=y>>12&63|128),l[_++]=y>>6&63|128),l[_++]=63&y|128)}return _}(this.buf,r,this.pos);var o=this.pos-e;o>=128&&ev(e,o,this),this.pos=e-1,this.writeVarint(o),this.pos+=o},writeFloat:function(r){this.realloc(4),Wg(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Wg(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var o=0;o<e;o++)this.buf[this.pos++]=r[o]},writeRawMessage:function(r,e){this.pos++;var o=this.pos;r(e,this);var l=this.pos-o;l>=128&&ev(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeMessage:function(r,e,o){this.writeTag(r,Hr.Bytes),this.writeRawMessage(e,o)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,J0,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,K0,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,X0,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,im,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,rm,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,Q0,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,qg,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,tv,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,nv,e)},writeBytesField:function(r,e){this.writeTag(r,Hr.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Hr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Hr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Hr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Hr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Hr.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Hr.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Hr.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Hr.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Hr.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};var bu=Ye(Gg);const sm=3;function am(r,e,o){e.glyphs=[],1===r&&o.readMessage(iv,e)}function iv(r,e,o){if(3===r){const{id:l,bitmap:f,width:_,height:y,left:w,top:E,advance:D}=o.readMessage(hd,{});e.glyphs.push({id:l,bitmap:new Gl({width:_+2*sm,height:y+2*sm},f),metrics:{width:_,height:y,left:w,top:E,advance:D}})}else 4===r?e.ascender=o.readSVarint():5===r&&(e.descender=o.readSVarint())}function hd(r,e,o){1===r?e.id=o.readVarint():2===r?e.bitmap=o.readBytes():3===r?e.width=o.readVarint():4===r?e.height=o.readVarint():5===r?e.left=o.readSVarint():6===r?e.top=o.readSVarint():7===r&&(e.advance=o.readVarint())}const Yg=sm;function lm(r){let e=0,o=0;for(const y of r)e+=y.w*y.h,o=Math.max(o,y.w);r.sort((y,w)=>w.h-y.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),o),h:1/0}];let f=0,_=0;for(const y of r)for(let w=l.length-1;w>=0;w--){const E=l[w];if(!(y.w>E.w||y.h>E.h)){if(y.x=E.x,y.y=E.y,_=Math.max(_,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===E.w&&y.h===E.h){const D=l.pop();w<l.length&&(l[w]=D)}else y.h===E.h?(E.x+=y.w,E.w-=y.w):y.w===E.w?(E.y+=y.h,E.h-=y.h):(l.push({x:E.x+y.w,y:E.y,w:E.w-y.w,h:y.h}),E.y+=y.h,E.h-=y.h);break}}return{w:f,h:_,fill:e/(f*_)||0}}const Ss=1;class lf{constructor(e,{pixelRatio:o,version:l,stretchX:f,stretchY:_,content:y}){this.paddedRect=e,this.pixelRatio=o,this.stretchX=f,this.stretchY=_,this.content=y,this.version=l}get tl(){return[this.paddedRect.x+Ss,this.paddedRect.y+Ss]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ss,this.paddedRect.y+this.paddedRect.h-Ss]}get displaySize(){return[(this.paddedRect.w-2*Ss)/this.pixelRatio,(this.paddedRect.h-2*Ss)/this.pixelRatio]}}class Jg{constructor(e,o){const l={},f={};this.haveRenderCallbacks=[];const _=[];this.addImages(e,l,_),this.addImages(o,f,_);const{w:y,h:w}=lm(_),E=new vs({width:y||1,height:w||1});for(const D in e){const L=e[D],B=l[D].paddedRect;vs.copy(L.data,E,{x:0,y:0},{x:B.x+Ss,y:B.y+Ss},L.data)}for(const D in o){const L=o[D],B=f[D].paddedRect,V=B.x+Ss,Y=B.y+Ss,Q=L.data.width,he=L.data.height;vs.copy(L.data,E,{x:0,y:0},{x:V,y:Y},L.data),vs.copy(L.data,E,{x:0,y:he-1},{x:V,y:Y-1},{width:Q,height:1}),vs.copy(L.data,E,{x:0,y:0},{x:V,y:Y+he},{width:Q,height:1}),vs.copy(L.data,E,{x:Q-1,y:0},{x:V-1,y:Y},{width:1,height:he}),vs.copy(L.data,E,{x:0,y:0},{x:V+Q,y:Y},{width:1,height:he})}this.image=E,this.iconPositions=l,this.patternPositions=f}addImages(e,o,l){for(const f in e){const _=e[f],y={x:0,y:0,w:_.data.width+2*Ss,h:_.data.height+2*Ss};l.push(y),o[f]=new lf(y,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(e,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),o),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),o)}patchUpdatedImage(e,o,l){if(!e||!o||e.version===o.version)return;e.version=o.version;const[f,_]=e.tl;l.update(o.data,void 0,{x:f,y:_})}}yi(lf,"ImagePosition"),yi(Jg,"ImageAtlas");const za={horizontal:1,vertical:2,horizontalOnly:3},Kg=-17;class Yd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,o){const l=new Yd;return l.scale=e||1,l.fontStack=o,l}static forImage(e){const o=new Yd;return o.imageName=e,o}}class wu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,o){const l=new wu;for(let f=0;f<e.sections.length;f++){const _=e.sections[f];_.image?l.addImageSection(_):l.addTextSection(_,o)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(o,l){let f="";for(let _=0;_<o.length;_++){const y=o.charCodeAt(_+1)||null,w=o.charCodeAt(_-1)||null;f+=!l&&(y&&ba(y)&&!sf[o[_+1]]||w&&ba(w)&&!sf[o[_-1]])||!sf[o[_]]?o[_]:sf[o[_]]}return f}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&cm[this.text.charCodeAt(l)];l++)e++;let o=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&cm[this.text.charCodeAt(l)];l--)o--;this.text=this.text.substring(e,o),this.sectionIndex=this.sectionIndex.slice(e,o)}substring(e,o){const l=new wu;return l.text=this.text.substring(e,o),l.sectionIndex=this.sectionIndex.slice(e,o),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,o)=>Math.max(e,this.sections[o].scale),0)}addTextSection(e,o){this.text+=e.text,this.sections.push(Yd.forText(e.scale,e.fontStack||o));const l=this.sections.length-1;for(let f=0;f<e.text.length;++f)this.sectionIndex.push(l)}addImageSection(e){const o=e.image?e.image.name:"";if(0===o.length)return void Dt("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Yd.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Dt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Xg(r,e,o,l,f,_,y,w,E,D,L,B,V,Y,Q){const he=wu.fromFeature(r,f);B===za.vertical&&he.verticalizePunctuation(V);let Ue=[];const ot=function(At,un,nn,In,Jn,hn){if(!At)return[];const On=[],kn=function(hi,Ei,mi,Hi,ri,Pi){let nr=0;for(let Mr=0;Mr<hi.length();Mr++){const Qi=hi.getSection(Mr);nr+=rv(hi.getCharCode(Mr),Qi,Hi,ri,Ei,Pi)}return nr/Math.max(1,Math.ceil(nr/mi))}(At,un,nn,In,Jn,hn),Gn=At.text.indexOf("\u200b")>=0;let ii=0;for(let hi=0;hi<At.length();hi++){const Ei=At.getSection(hi),mi=At.getCharCode(hi);if(cm[mi]||(ii+=rv(mi,Ei,In,Jn,un,hn)),hi<At.length()-1){const Hi=!((En=mi)<11904||!(pi["Bopomofo Extended"](En)||pi.Bopomofo(En)||pi["CJK Compatibility Forms"](En)||pi["CJK Compatibility Ideographs"](En)||pi["CJK Compatibility"](En)||pi["CJK Radicals Supplement"](En)||pi["CJK Strokes"](En)||pi["CJK Symbols and Punctuation"](En)||pi["CJK Unified Ideographs Extension A"](En)||pi["CJK Unified Ideographs"](En)||pi["Enclosed CJK Letters and Months"](En)||pi["Halfwidth and Fullwidth Forms"](En)||pi.Hiragana(En)||pi["Ideographic Description Characters"](En)||pi["Kangxi Radicals"](En)||pi["Katakana Phonetic Extensions"](En)||pi.Katakana(En)||pi["Vertical Forms"](En)||pi["Yi Radicals"](En)||pi["Yi Syllables"](En)));(Jd[mi]||Hi||Ei.imageName)&&On.push(Qg(hi+1,ii,kn,On,cf(mi,At.getCharCode(hi+1),Hi&&Gn),!1))}}var En;return uf(Qg(At.length(),ii,kn,On,0,!0))}(he,D,_,e,l,Y),{processBidirectionalText:bt,processStyledBidirectionalText:st}=M;if(bt&&1===he.sections.length){const At=bt(he.toString(),ot);for(const un of At){const nn=new wu;nn.text=un,nn.sections=he.sections;for(let In=0;In<un.length;In++)nn.sectionIndex.push(0);Ue.push(nn)}}else if(st){const At=st(he.text,he.sectionIndex,ot);for(const un of At){const nn=new wu;nn.text=un[0],nn.sectionIndex=un[1],nn.sections=he.sections,Ue.push(nn)}}else Ue=function(At,un){const nn=[],In=At.text;let Jn=0;for(const hn of un)nn.push(At.substring(Jn,hn)),Jn=hn;return Jn<In.length&&nn.push(At.substring(Jn,In.length)),nn}(he,ot);const vt=[],St={positionedLines:vt,text:he.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:B,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(At,un,nn,In,Jn,hn,On,kn,Gn,ii,En,hi){let Ei=0,mi=0,Hi=0;const ri="right"===kn?1:"left"===kn?0:.5;let Pi=!1;for(const ir of Jn){const rr=ir.getSections();for(const Wr of rr){if(Wr.imageName)continue;const Or=un[Wr.fontStack];if(Or&&(Pi=void 0!==Or.ascender&&void 0!==Or.descender,!Pi))break}if(!Pi)break}let nr=0;for(const ir of Jn){ir.trim();const rr=ir.getMaxScale(),Wr=(rr-1)*yo,Or={positionedGlyphs:[],lineOffset:0};At.positionedLines[nr]=Or;const eo=Or.positionedGlyphs;let zr=0;if(!ir.length()){mi+=hn,++nr;continue}let kr=0,vo=0;for(let to=0;to<ir.length();to++){const xr=ir.getSection(to),Bo=ir.getSectionIndex(to),uo=ir.getCharCode(to);let Rr=xr.scale,zo=null,qr=null,Os=null,Oo=yo,as=0;const Jo=!(Gn===za.horizontal||!En&&!nu(uo)||En&&(cm[uo]||(Mr=uo,pi.Arabic(Mr)||pi["Arabic Supplement"](Mr)||pi["Arabic Extended-A"](Mr)||pi["Arabic Presentation Forms-A"](Mr)||pi["Arabic Presentation Forms-B"](Mr))));if(xr.imageName){const Rs=In[xr.imageName];if(!Rs)continue;Os=xr.imageName,At.iconsInText=At.iconsInText||!0,qr=Rs.paddedRect;const ts=Rs.displaySize;Rr=Rr*yo/hi,zo={width:ts[0],height:ts[1],left:Ss,top:-Yg,advance:Jo?ts[1]:ts[0],localGlyph:!1},as=Pi?-zo.height*Rr:Kg+rr*yo-ts[1]*Rr,Oo=zo.advance;const Ls=(Jo?ts[0]:ts[1])*Rr-yo*rr;Ls>0&&Ls>zr&&(zr=Ls)}else{const Rs=nn[xr.fontStack];if(!Rs)continue;Rs[uo]&&(qr=Rs[uo]);const ts=un[xr.fontStack];if(!ts)continue;const Ls=ts.glyphs[uo];if(!Ls)continue;if(zo=Ls.metrics,Oo=8203!==uo?yo:0,Pi){const Ou=void 0!==ts.ascender?Math.abs(ts.ascender):0,bd=void 0!==ts.descender?Math.abs(ts.descender):0,ch=(Ou+bd)*Rr;kr<ch&&(kr=ch,vo=(Ou-bd)/2*Rr),as=-Ou*Rr}else as=Kg+(rr-Rr)*yo}Jo?(At.verticalizable=!0,eo.push({glyph:uo,imageName:Os,x:Ei,y:mi+as,vertical:Jo,scale:Rr,localGlyph:zo.localGlyph,fontStack:xr.fontStack,sectionIndex:Bo,metrics:zo,rect:qr}),Ei+=Oo*Rr+ii):(eo.push({glyph:uo,imageName:Os,x:Ei,y:mi+as,vertical:Jo,scale:Rr,localGlyph:zo.localGlyph,fontStack:xr.fontStack,sectionIndex:Bo,metrics:zo,rect:qr}),Ei+=zo.advance*Rr+ii)}0!==eo.length&&(Hi=Math.max(Ei-ii,Hi),Pi?Cu(eo,ri,zr,vo,hn*rr/2):Cu(eo,ri,zr,0,hn/2)),Ei=0;const No=hn*rr+zr;Or.lineOffset=Math.max(zr,Wr),mi+=No,++nr}var Mr;const Qi=mi,{horizontalAlign:zi,verticalAlign:ro}=Kd(On);(function(ir,rr,Wr,Or,eo,zr){const kr=(rr-Wr)*eo,vo=-zr*Or;for(const No of ir)for(const to of No.positionedGlyphs)to.x+=kr,to.y+=vo})(At.positionedLines,ri,zi,ro,Hi,Qi),At.top+=-ro*Qi,At.bottom=At.top+Qi,At.left+=-zi*Hi,At.right=At.left+Hi,At.hasBaseline=Pi}(St,e,o,l,Ue,y,w,E,B,D,V,Q),!function(At){for(const un of At)if(0!==un.positionedGlyphs.length)return!1;return!0}(vt)&&St}const cm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Jd={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function rv(r,e,o,l,f,_){if(e.imageName){const y=l[e.imageName];return y?y.displaySize[0]*e.scale*yo/_+f:0}{const y=o[e.fontStack],w=y&&y.glyphs[r];return w?w.metrics.advance*e.scale+f:0}}function ov(r,e,o,l){const f=Math.pow(r-e,2);return l?r<e?f/2:2*f:f+Math.abs(o)*o}function cf(r,e,o){let l=0;return 10===r&&(l-=1e4),o&&(l+=150),40!==r&&65288!==r||(l+=50),41!==e&&65289!==e||(l+=50),l}function Qg(r,e,o,l,f,_){let y=null,w=ov(e,o,f,_);for(const E of l){const D=ov(e-E.x,o,f,_)+E.badness;D<=w&&(y=E,w=D)}return{index:r,x:e,priorBreak:y,badness:w}}function uf(r){return r?uf(r.priorBreak).concat(r.index):[]}function Kd(r){let e=.5,o=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:e,verticalAlign:o}}function Cu(r,e,o,l,f){if(!(e||o||l||f))return;const _=r.length-1,y=r[_],w=(y.x+y.metrics.advance*y.scale)*e;for(let E=0;E<=_;E++)r[E].x-=w,r[E].y+=o+l+f}function um(r,e,o){const{horizontalAlign:l,verticalAlign:f}=Kd(o),_=e[0]-r.displaySize[0]*l,y=e[1]-r.displaySize[1]*f;return{image:r,top:y,bottom:y+r.displaySize[1],left:_,right:_+r.displaySize[0]}}function df(r,e,o,l,f,_){const y=r.image;let w;if(y.content){const Ue=y.content,ot=y.pixelRatio||1;w=[Ue[0]/ot,Ue[1]/ot,y.displaySize[0]-Ue[2]/ot,y.displaySize[1]-Ue[3]/ot]}const E=e.left*_,D=e.right*_;let L,B,V,Y;"width"===o||"both"===o?(Y=f[0]+E-l[3],B=f[0]+D+l[1]):(Y=f[0]+(E+D-y.displaySize[0])/2,B=Y+y.displaySize[0]);const Q=e.top*_,he=e.bottom*_;return"height"===o||"both"===o?(L=f[1]+Q-l[0],V=f[1]+he+l[2]):(L=f[1]+(Q+he-y.displaySize[1])/2,V=L+y.displaySize[1]),{image:y,top:L,right:B,bottom:V,left:Y,collisionPadding:w}}class Ua extends Ae{constructor(e,o,l,f,_){super(e,o),this.angle=f,this.z=l,void 0!==_&&(this.segment=_)}clone(){return new Ua(this.x,this.y,this.z,this.angle,this.segment)}}function Xd(r,e,o,l,f){if(void 0===e.segment)return!0;let _=e,y=e.segment+1,w=0;for(;w>-o/2;){if(y--,y<0)return!1;w-=r[y].dist(_),_=r[y]}w+=r[y].dist(r[y+1]),y++;const E=[];let D=0;for(;w<o/2;){const L=r[y],B=r[y+1];if(!B)return!1;let V=r[y-1].angleTo(L)-L.angleTo(B);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:V}),D+=V;w-E[0].distance>l;)D-=E.shift().angleDelta;if(D>f)return!1;y++,w+=L.dist(B)}return!0}function Eu(r){let e=0;for(let o=0;o<r.length-1;o++)e+=r[o].dist(r[o+1]);return e}function hf(r,e,o){return r?.6*e*o:0}function ff(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function pf(r,e,o,l,f,_){const y=hf(o,f,_),w=ff(o,l)*_;let E=0;const D=Eu(r)/2;for(let L=0;L<r.length-1;L++){const B=r[L],V=r[L+1],Y=B.dist(V);if(E+Y>D){const Q=(D-E)/Y,he=_i(B.x,V.x,Q),Ue=_i(B.y,V.y,Q),ot=new Ua(he,Ue,0,V.angleTo(B),L);return!y||Xd(r,ot,w,y,e)?ot:void 0}E+=Y}}function ex(r,e,o,l,f,_,y,w,E){const D=hf(l,_,y),L=ff(l,f),B=L*y,V=0===r[0].x||r[0].x===E||0===r[0].y||r[0].y===E;return e-B<e/4&&(e=B+e/4),mf(r,V?e/2*w%e:(L/2+2*_)*y*w%e,e,D,o,B,V,!1,E)}function mf(r,e,o,l,f,_,y,w,E){const D=_/2,L=Eu(r);let B=0,V=e-o,Y=[];for(let Q=0;Q<r.length-1;Q++){const he=r[Q],Ue=r[Q+1],ot=he.dist(Ue),bt=Ue.angleTo(he);for(;V+o<B+ot;){V+=o;const st=(V-B)/ot,vt=_i(he.x,Ue.x,st),St=_i(he.y,Ue.y,st);if(vt>=0&&vt<E&&St>=0&&St<E&&V-D>=0&&V+D<=L){const At=new Ua(vt,St,0,bt,Q);At._round(),l&&!Xd(r,At,_,l,f)||Y.push(At)}}B+=ot}return w||Y.length||y||(Y=mf(r,B/2,o,l,f,_,y,!0,E)),Y}function fd(r,e,o,l,f){const _=[];for(let y=0;y<r.length;y++){const w=r[y];let E;for(let D=0;D<w.length-1;D++){let L=w[D],B=w[D+1];L.x<e&&B.x<e||(L.x<e?L=new Ae(e,L.y+(e-L.x)/(B.x-L.x)*(B.y-L.y))._round():B.x<e&&(B=new Ae(e,L.y+(e-L.x)/(B.x-L.x)*(B.y-L.y))._round()),L.y<o&&B.y<o||(L.y<o?L=new Ae(L.x+(o-L.y)/(B.y-L.y)*(B.x-L.x),o)._round():B.y<o&&(B=new Ae(L.x+(o-L.y)/(B.y-L.y)*(B.x-L.x),o)._round()),L.x>=l&&B.x>=l||(L.x>=l?L=new Ae(l,L.y+(l-L.x)/(B.x-L.x)*(B.y-L.y))._round():B.x>=l&&(B=new Ae(l,L.y+(l-L.x)/(B.x-L.x)*(B.y-L.y))._round()),L.y>=f&&B.y>=f||(L.y>=f?L=new Ae(L.x+(f-L.y)/(B.y-L.y)*(B.x-L.x),f)._round():B.y>=f&&(B=new Ae(L.x+(f-L.y)/(B.y-L.y)*(B.x-L.x),f)._round()),E&&L.equals(E[E.length-1])||(E=[L],_.push(E)),E.push(B)))))}}return _}yi(Ua,"Anchor");const Qd=1e20;function dm(r,e,o,l,f,_,y,w,E){for(let D=e;D<e+l;D++)e_(r,o*_+D,_,f,y,w,E);for(let D=o;D<o+f;D++)e_(r,D*_+e,1,l,y,w,E)}function e_(r,e,o,l,f,_,y){_[0]=0,y[0]=-Qd,y[1]=Qd,f[0]=r[e];for(let w=1,E=0,D=0;w<l;w++){f[w]=r[e+w*o];const L=w*w;do{const B=_[E];D=(f[w]-f[B]+L-B*B)/(w-B)/2}while(D<=y[E]&&--E>-1);E++,_[E]=w,y[E]=D,y[E+1]=Qd}for(let w=0,E=0;w<l;w++){for(;y[E+1]<w;)E++;const D=_[E],L=w-D;r[e+w*o]=f[D]+L*L}}const Dl=2,eh={none:0,ideographs:1,all:2};class Tu{constructor(e,o,l){this.requestManager=e,this.localGlyphMode=o,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,o){const l=[];for(const f in e)for(const _ of e[f])l.push({stack:f,id:_});xn(l,({stack:f,id:_},y)=>{let w=this.entries[f];w||(w=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=w.glyphs[_];if(void 0!==E)return void y(null,{stack:f,id:_,glyph:E});if(E=this._tinySDF(w,f,_),E)return w.glyphs[_]=E,void y(null,{stack:f,id:_,glyph:E});const D=Math.floor(_/256);if(256*D>65535)return void y(new Error("glyphs > 65535 not supported"));if(w.ranges[D])return void y(null,{stack:f,id:_,glyph:E});let L=w.requests[D];L||(L=w.requests[D]=[],Tu.loadGlyphRange(f,D,this.url,this.requestManager,(B,V)=>{if(V){w.ascender=V.ascender,w.descender=V.descender;for(const Y in V.glyphs)this._doesCharSupportLocalGlyph(+Y)||(w.glyphs[+Y]=V.glyphs[+Y]);w.ranges[D]=!0}for(const Y of L)Y(B,V);delete w.requests[D]})),L.push((B,V)=>{B?y(B):V&&y(null,{stack:f,id:_,glyph:V.glyphs[_]||null})})},(f,_)=>{if(f)o(f);else if(_){const y={};for(const{stack:w,id:E,glyph:D}of _)void 0===y[w]&&(y[w]={}),void 0===y[w].glyphs&&(y[w].glyphs={}),y[w].glyphs[E]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},y[w].ascender=this.entries[w].ascender,y[w].descender=this.entries[w].descender;o(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==eh.none&&(this.localGlyphMode===eh.all?!!this.localFontFamily:!!this.localFontFamily&&(pi["CJK Unified Ideographs"](e)||pi["Hangul Syllables"](e)||pi.Hiragana(e)||pi.Katakana(e)||pi["CJK Symbols and Punctuation"](e)))}_tinySDF(e,o,l){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(l))return;let _=e.tinySDF;if(!_){let he="400";/bold/i.test(o)?he="900":/medium/i.test(o)?he="500":/light/i.test(o)&&(he="200"),_=e.tinySDF=new Tu.TinySDF({fontFamily:f,fontWeight:he,fontSize:24*Dl,buffer:3*Dl,radius:8*Dl}),_.fontWeight=he}if(this.localGlyphs[_.fontWeight][l])return this.localGlyphs[_.fontWeight][l];const y=String.fromCharCode(l),{data:w,width:E,height:D,glyphWidth:L,glyphHeight:B,glyphLeft:V,glyphTop:Y,glyphAdvance:Q}=_.draw(y);return this.localGlyphs[_.fontWeight][l]={id:l,bitmap:new Gl({width:E,height:D},w),metrics:{width:L/Dl,height:B/Dl,left:V/Dl,top:Y/Dl-27,advance:Q/Dl,localGlyph:!0}}}}Tu.loadGlyphRange=function(r,e,o,l,f){const _=256*e,y=_+255,w=l.transformRequest(l.normalizeGlyphsURL(o).replace("{fontstack}",r).replace("{range}",`${_}-${y}`),_n.Glyphs);Cn(w,(E,D)=>{if(E)f(E);else if(D){const L={},B=new bu(D).readFields(am,{});for(const V of B.glyphs)L[V.id]=V;f(null,{glyphs:L,ascender:B.ascender,descender:B.descender})}})},Tu.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:o=8,cutoff:l=.25,fontFamily:f="sans-serif",fontWeight:_="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=o;const w=this.size=r+4*e,E=this._createCanvas(w),D=this.ctx=E.getContext("2d",{willReadFrequently:!0});D.font=`${y} ${_} ${r}px ${f}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:l,actualBoundingBoxLeft:f,actualBoundingBoxRight:_}=this.ctx.measureText(r),y=Math.ceil(o),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-f))),E=Math.min(this.size-this.buffer,y+Math.ceil(l)),D=w+2*this.buffer,L=E+2*this.buffer,B=Math.max(D*L,0),V=new Uint8ClampedArray(B),Y={data:V,width:D,height:L,glyphWidth:w,glyphHeight:E,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(0===w||0===E)return Y;const{ctx:Q,buffer:he,gridInner:Ue,gridOuter:ot}=this;Q.clearRect(he,he,w,E),Q.fillText(r,he,he+y);const bt=Q.getImageData(he,he,w,E);ot.fill(Qd,0,B),Ue.fill(0,0,B);for(let st=0;st<E;st++)for(let vt=0;vt<w;vt++){const St=bt.data[4*(st*w+vt)+3]/255;if(0===St)continue;const At=(st+he)*D+vt+he;if(1===St)ot[At]=0,Ue[At]=Qd;else{const un=.5-St;ot[At]=un>0?un*un:0,Ue[At]=un<0?un*un:0}}dm(ot,0,0,D,L,D,this.f,this.v,this.z),dm(Ue,he,he,w,E,D,this.f,this.v,this.z);for(let st=0;st<B;st++){const vt=Math.sqrt(ot[st])-Math.sqrt(Ue[st]);V[st]=Math.round(255-255*(vt/this.radius+this.cutoff))}return Y}};const pd=Ss;function t_(r,e,o,l){const f=[],_=r.image,y=_.pixelRatio,w=_.paddedRect.w-2*pd,E=_.paddedRect.h-2*pd,D=r.right-r.left,L=r.bottom-r.top,B=_.stretchX||[[0,w]],V=_.stretchY||[[0,E]],Y=(hn,On)=>hn+On[1]-On[0],Q=B.reduce(Y,0),he=V.reduce(Y,0),Ue=w-Q,ot=E-he;let bt=0,st=Q,vt=0,St=he,At=0,un=Ue,nn=0,In=ot;if(_.content&&l){const hn=_.content;bt=hm(B,0,hn[0]),vt=hm(V,0,hn[1]),st=hm(B,hn[0],hn[2]),St=hm(V,hn[1],hn[3]),At=hn[0]-bt,nn=hn[1]-vt,un=hn[2]-hn[0]-st,In=hn[3]-hn[1]-St}const Jn=(hn,On,kn,Gn)=>{const ii=Du(hn.stretch-bt,st,D,r.left),En=md(hn.fixed-At,un,hn.stretch,Q),hi=Du(On.stretch-vt,St,L,r.top),Ei=md(On.fixed-nn,In,On.stretch,he),mi=Du(kn.stretch-bt,st,D,r.left),Hi=md(kn.fixed-At,un,kn.stretch,Q),ri=Du(Gn.stretch-vt,St,L,r.top),Pi=md(Gn.fixed-nn,In,Gn.stretch,he),nr=new Ae(ii,hi),Mr=new Ae(mi,hi),Qi=new Ae(mi,ri),zi=new Ae(ii,ri),ro=new Ae(En/y,Ei/y),ir=new Ae(Hi/y,Pi/y),rr=e*Math.PI/180;if(rr){const eo=Math.sin(rr),zr=Math.cos(rr),kr=[zr,-eo,eo,zr];nr._matMult(kr),Mr._matMult(kr),zi._matMult(kr),Qi._matMult(kr)}const Wr=hn.stretch+hn.fixed,Or=On.stretch+On.fixed;return{tl:nr,tr:Mr,bl:zi,br:Qi,tex:{x:_.paddedRect.x+pd+Wr,y:_.paddedRect.y+pd+Or,w:kn.stretch+kn.fixed-Wr,h:Gn.stretch+Gn.fixed-Or},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ro,pixelOffsetBR:ir,minFontScaleX:un/y/D,minFontScaleY:In/y/L,isSDF:o}};if(l&&(_.stretchX||_.stretchY)){const hn=n_(B,Ue,Q),On=n_(V,ot,he);for(let kn=0;kn<hn.length-1;kn++){const Gn=hn[kn],ii=hn[kn+1];for(let En=0;En<On.length-1;En++)f.push(Jn(Gn,On[En],ii,On[En+1]))}}else f.push(Jn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:E+1}));return f}function hm(r,e,o){let l=0;for(const f of r)l+=Math.max(e,Math.min(o,f[1]))-Math.max(e,Math.min(o,f[0]));return l}function n_(r,e,o){const l=[{fixed:-pd,stretch:0}];for(const[f,_]of r){const y=l[l.length-1];l.push({fixed:f-y.stretch,stretch:y.stretch}),l.push({fixed:f-y.stretch,stretch:y.stretch+(_-f)})}return l.push({fixed:e+pd,stretch:o}),l}function Du(r,e,o,l){return r/e*o+l}function md(r,e,o,l){return r-e*o/l}function sv(r,e,o,l){const f=e+r.positionedLines[l].lineOffset;return 0===l?o+f/2:o+(f+(e+r.positionedLines[l-1].lineOffset))/2}class i_{constructor(e=[],o=fm){if(this.data=e,this.length=this.data.length,this.compare=o,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:o,compare:l}=this,f=o[e];for(;e>0;){const _=e-1>>1,y=o[_];if(l(f,y)>=0)break;o[e]=y,e=_}o[e]=f}_down(e){const{data:o,compare:l}=this,f=this.length>>1,_=o[e];for(;e<f;){let y=1+(e<<1),w=o[y];const E=y+1;if(E<this.length&&l(o[E],w)<0&&(y=E,w=o[E]),l(w,_)>=0)break;o[e]=w,e=y}o[e]=_}}function fm(r,e){return r<e?-1:r>e?1:0}function gf(r,e=1,o=!1){let l=1/0,f=1/0,_=-1/0,y=-1/0;const w=r[0];for(let Y=0;Y<w.length;Y++){const Q=w[Y];(!Y||Q.x<l)&&(l=Q.x),(!Y||Q.y<f)&&(f=Q.y),(!Y||Q.x>_)&&(_=Q.x),(!Y||Q.y>y)&&(y=Q.y)}const E=Math.min(_-l,y-f);let D=E/2;const L=new i_([],av);if(0===E)return new Ae(l,f);for(let Y=l;Y<_;Y+=E)for(let Q=f;Q<y;Q+=E)L.push(new Iu(Y+D,Q+D,D,r));let B=function(Y){let Q=0,he=0,Ue=0;const ot=Y[0];for(let bt=0,st=ot.length,vt=st-1;bt<st;vt=bt++){const St=ot[bt],At=ot[vt],un=St.x*At.y-At.x*St.y;he+=(St.x+At.x)*un,Ue+=(St.y+At.y)*un,Q+=3*un}return new Iu(he/Q,Ue/Q,0,Y)}(r),V=L.length;for(;L.length;){const Y=L.pop();(Y.d>B.d||!B.d)&&(B=Y,o&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,V)),Y.max-B.d<=e||(D=Y.h/2,L.push(new Iu(Y.p.x-D,Y.p.y-D,D,r)),L.push(new Iu(Y.p.x+D,Y.p.y-D,D,r)),L.push(new Iu(Y.p.x-D,Y.p.y+D,D,r)),L.push(new Iu(Y.p.x+D,Y.p.y+D,D,r)),V+=4)}return o&&(console.log(`num probes: ${V}`),console.log(`best distance: ${B.d}`)),B.p}function av(r,e){return e.max-r.max}class Iu{constructor(e,o,l,f){this.p=new Ae(e,o),this.h=l,this.d=function(_,y){let w=!1,E=1/0;for(let D=0;D<y.length;D++){const L=y[D];for(let B=0,V=L.length,Y=V-1;B<V;Y=B++){const Q=L[B],he=L[Y];Q.y>_.y!=he.y>_.y&&_.x<(he.x-Q.x)*(_.y-Q.y)/(he.y-Q.y)+Q.x&&(w=!w),E=Math.min(E,Rp(_,Q,he))}}return(w?1:-1)*Math.sqrt(E)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const gd=7,_f=Number.POSITIVE_INFINITY,tx=Math.sqrt(2);function r_(r,[e,o]){let l=0,f=0;if(o===_f){e<0&&(e=0);const _=e/tx;switch(r){case"top-right":case"top-left":f=_-gd;break;case"bottom-right":case"bottom-left":f=-_+gd;break;case"bottom":f=-e+gd;break;case"top":f=e-gd}switch(r){case"top-right":case"bottom-right":l=-_;break;case"top-left":case"bottom-left":l=_;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),o=Math.abs(o),r){case"top-right":case"top-left":case"top":f=o-gd;break;case"bottom-right":case"bottom-left":case"bottom":f=-o+gd}switch(r){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,f]}function yf(r,e,o,l,f,_,y,w,E,D){r.createArrays(),r.tilePixelRatio=Ii/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const L=r.layers[0].layout,B=r.layers[0]._unevaluatedLayout._values,V={};if("composite"===r.textSizeData.kind){const{minZoom:he,maxZoom:Ue}=r.textSizeData;V.compositeTextSizes=[B["text-size"].possiblyEvaluate(new N(he),w),B["text-size"].possiblyEvaluate(new N(Ue),w)]}if("composite"===r.iconSizeData.kind){const{minZoom:he,maxZoom:Ue}=r.iconSizeData;V.compositeIconSizes=[B["icon-size"].possiblyEvaluate(new N(he),w),B["icon-size"].possiblyEvaluate(new N(Ue),w)]}V.layoutTextSize=B["text-size"].possiblyEvaluate(new N(E+1),w),V.layoutIconSize=B["icon-size"].possiblyEvaluate(new N(E+1),w),V.textMaxSize=B["text-size"].possiblyEvaluate(new N(18),w);const Y="map"===L.get("text-rotation-alignment")&&"point"!==L.get("symbol-placement"),Q=L.get("text-size");for(const he of r.features){const Ue=L.get("text-font").evaluate(he,{},w).join(","),ot=Q.evaluate(he,{},w),bt=V.layoutTextSize.evaluate(he,{},w),st=(V.layoutIconSize.evaluate(he,{},w),{horizontal:{},vertical:void 0}),vt=he.text;let St,At=[0,0];if(vt){const In=vt.toString(),Jn=L.get("text-letter-spacing").evaluate(he,{},w)*yo,hn=L.get("text-line-height").evaluate(he,{},w)*yo,On=os(In)?Jn:0,kn=L.get("text-anchor").evaluate(he,{},w),Gn=L.get("text-variable-anchor");if(!Gn){const mi=L.get("text-radial-offset").evaluate(he,{},w);At=mi?r_(kn,[mi*yo,_f]):L.get("text-offset").evaluate(he,{},w).map(Hi=>Hi*yo)}let ii=Y?"center":L.get("text-justify").evaluate(he,{},w);const En="point"===L.get("symbol-placement"),hi=En?L.get("text-max-width").evaluate(he,{},w)*yo:1/0,Ei=mi=>{r.allowVerticalPlacement&&lc(In)&&(st.vertical=Xg(vt,e,o,f,Ue,hi,hn,kn,mi,On,At,za.vertical,!0,bt,ot))};if(!Y&&Gn){const mi="auto"===ii?Gn.map(ri=>pm(ri)):[ii];let Hi=!1;for(let ri=0;ri<mi.length;ri++){const Pi=mi[ri];if(!st.horizontal[Pi])if(Hi)st.horizontal[Pi]=st.horizontal[0];else{const nr=Xg(vt,e,o,f,Ue,hi,hn,"center",Pi,On,At,za.horizontal,!1,bt,ot);nr&&(st.horizontal[Pi]=nr,Hi=1===nr.positionedLines.length)}}Ei("left")}else{if("auto"===ii&&(ii=pm(kn)),En||L.get("text-writing-mode").indexOf("horizontal")>=0||!lc(In)){const mi=Xg(vt,e,o,f,Ue,hi,hn,kn,ii,On,At,za.horizontal,!1,bt,ot);mi&&(st.horizontal[ii]=mi)}Ei(En?"left":ii)}}let un=!1;if(he.icon&&he.icon.name){const In=l[he.icon.name];In&&(St=um(f[he.icon.name],L.get("icon-offset").evaluate(he,{},w),L.get("icon-anchor").evaluate(he,{},w)),un=In.sdf,void 0===r.sdfIcons?r.sdfIcons=In.sdf:r.sdfIcons!==In.sdf&&Dt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(In.pixelRatio!==r.pixelRatio||0!==L.get("icon-rotate").constantOr(1))&&(r.iconsNeedLinear=!0))}const nn=o_(st.horizontal)||st.vertical;r.iconsInText||(r.iconsInText=!!nn&&nn.iconsInText),(nn||St)&&_d(r,he,st,St,l,V,bt,0,At,un,y,w,D)}_&&r.generateCollisionDebugBuffers(E,r.collisionBoxArray)}function pm(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function _d(r,e,o,l,f,_,y,w,E,D,L,B,V){let Y=_.textMaxSize.evaluate(e,{},B);void 0===Y&&(Y=y);const Q=r.layers[0].layout,he=Q.get("icon-offset").evaluate(e,{},B),Ue=o_(o.horizontal)||o.vertical,ot="globe"===V.name,bt=yo,st=y/bt,vt=r.tilePixelRatio*Y/bt,St=(kn=r.overscaling,r.zoom>18&&kn>2&&(kn>>=1),Math.max(Ii/(512*kn),1)*Q.get("symbol-spacing")),At=Q.get("text-padding")*r.tilePixelRatio,un=Q.get("icon-padding")*r.tilePixelRatio,nn=ne(Q.get("text-max-angle")),In="map"===Q.get("text-rotation-alignment")&&"point"!==Q.get("symbol-placement"),Jn="map"===Q.get("icon-rotation-alignment")&&"point"!==Q.get("symbol-placement"),hn=Q.get("symbol-placement"),On=St/2;var kn;const Gn=Q.get("icon-text-fit");let ii;l&&"none"!==Gn&&(r.allowVerticalPlacement&&o.vertical&&(ii=df(l,o.vertical,Gn,Q.get("icon-text-fit-padding"),he,st)),Ue&&(l=df(l,Ue,Gn,Q.get("icon-text-fit-padding"),he,st)));const En=(hi,Ei,mi)=>{if(Ei.x<0||Ei.x>=Ii||Ei.y<0||Ei.y>=Ii)return;let Hi=null;if(ot){const{x:ri,y:Pi,z:nr}=V.projectTilePoint(Ei.x,Ei.y,mi);Hi={anchor:new Ua(ri,Pi,nr,0,void 0),up:V.upVector(mi,Ei.x,Ei.y)}}!function(ri,Pi,nr,Mr,Qi,zi,ro,ir,rr,Wr,Or,eo,zr,kr,vo,No,to,xr,Bo,uo,Rr,zo,qr,Os,Oo){const as=ri.addToLineVertexArray(Pi,Mr);let Jo,Rs,ts,Ls,Ou,bd,ch,Fm=0,Nm=0,Bm=0,uh=0,zm=-1,Um=-1;const dl={};let M_=Ch("");const Jl=nr?nr.anchor:Pi;let Ff=0,Nf=0;if(void 0===rr._unevaluatedLayout.getValue("text-radial-offset")?[Ff,Nf]=rr.layout.get("text-offset").evaluate(Rr,{},Oo).map(Ia=>Ia*yo):(Ff=rr.layout.get("text-radial-offset").evaluate(Rr,{},Oo)*yo,Nf=_f),ri.allowVerticalPlacement&&Qi.vertical){const Ia=Qi.vertical;if(vo)bd=gm(Ia),ir&&(ch=gm(ir));else{const Ma=rr.layout.get("text-rotate").evaluate(Rr,{},Oo)+90;ts=vf(Wr,Jl,Pi,Or,eo,zr,Ia,kr,Ma,No),ir&&(Ls=vf(Wr,Jl,Pi,Or,eo,zr,ir,xr,Ma))}}if(zi){const Ia=rr.layout.get("icon-rotate").evaluate(Rr,{},Oo),Ma="none"!==rr.layout.get("icon-text-fit"),hh=t_(zi,Ia,qr,Ma),Vm=ir?t_(ir,Ia,qr,Ma):void 0;Rs=vf(Wr,Jl,Pi,Or,eo,zr,zi,xr,Ia),Fm=4*hh.length;const A_=ri.iconSizeData;let Ru=null;"source"===A_.kind?(Ru=[da*rr.layout.get("icon-size").evaluate(Rr,{},Oo)],Ru[0]>Uc&&Dt(`${ri.layerIds[0]}: Value for "icon-size" is >= ${mc}. Reduce your "icon-size".`)):"composite"===A_.kind&&(Ru=[da*zo.compositeIconSizes[0].evaluate(Rr,{},Oo),da*zo.compositeIconSizes[1].evaluate(Rr,{},Oo)],(Ru[0]>Uc||Ru[1]>Uc)&&Dt(`${ri.layerIds[0]}: Value for "icon-size" is >= ${mc}. Reduce your "icon-size".`)),ri.addSymbols(ri.icon,hh,Ru,uo,Bo,Rr,!1,nr,Pi,as.lineStartIndex,as.lineLength,-1,Os,Oo),zm=ri.icon.placedSymbolArray.length-1,Vm&&(Nm=4*Vm.length,ri.addSymbols(ri.icon,Vm,Ru,uo,Bo,Rr,za.vertical,nr,Pi,as.lineStartIndex,as.lineLength,-1,Os,Oo),Um=ri.icon.placedSymbolArray.length-1)}for(const Ia in Qi.horizontal){const Ma=Qi.horizontal[Ia];Jo||(M_=Ch(Ma.text),vo?Ou=gm(Ma):Jo=vf(Wr,Jl,Pi,Or,eo,zr,Ma,kr,rr.layout.get("text-rotate").evaluate(Rr,{},Oo),No));const hh=1===Ma.positionedLines.length;if(Bm+=mm(ri,nr,Pi,Ma,ro,rr,vo,Rr,No,as,Qi.vertical?za.horizontal:za.horizontalOnly,hh?Object.keys(Qi.horizontal):[Ia],dl,zm,zo,Os,Oo),hh)break}Qi.vertical&&(uh+=mm(ri,nr,Pi,Qi.vertical,ro,rr,vo,Rr,No,as,za.vertical,["vertical"],dl,Um,zo,Os,Oo));let Hc=-1;const jm=(Ia,Ma)=>Ia?Math.max(Ia,Ma):Ma;Hc=jm(Ou,Hc),Hc=jm(bd,Hc),Hc=jm(ch,Hc);const dh=Hc>-1?1:0;ri.glyphOffsetArray.length>=Vc.MAX_GLYPHS&&Dt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Rr.sortKey&&ri.addToSortKeyRanges(ri.symbolInstances.length,Rr.sortKey),ri.symbolInstances.emplaceBack(Jl.x,Jl.y,Jl.z,Pi.x,Pi.y,dl.right>=0?dl.right:-1,dl.center>=0?dl.center:-1,dl.left>=0?dl.left:-1,dl.vertical>=0?dl.vertical:-1,zm,Um,M_,void 0!==Jo?Jo:ri.collisionBoxArray.length,void 0!==Jo?Jo+1:ri.collisionBoxArray.length,void 0!==ts?ts:ri.collisionBoxArray.length,void 0!==ts?ts+1:ri.collisionBoxArray.length,void 0!==Rs?Rs:ri.collisionBoxArray.length,void 0!==Rs?Rs+1:ri.collisionBoxArray.length,Ls||ri.collisionBoxArray.length,Ls?Ls+1:ri.collisionBoxArray.length,Or,Bm,uh,Fm,Nm,dh,0,Ff,Nf,Hc)}(r,Ei,Hi,hi,o,l,f,ii,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,At,In,E,0,un,Jn,he,e,_,D,L,B)};if("line"===hn)for(const hi of fd(e.geometry,0,0,Ii,Ii)){const Ei=ex(hi,St,nn,o.vertical||Ue,l,bt,vt,r.overscaling,Ii);for(const mi of Ei)Ue&&s_(r,Ue.text,On,mi)||En(hi,mi,B)}else if("line-center"===hn){for(const hi of e.geometry)if(hi.length>1){const Ei=pf(hi,nn,o.vertical||Ue,l,bt,vt);Ei&&En(hi,Ei,B)}}else if("Polygon"===e.type)for(const hi of $p(e.geometry,0)){const Ei=gf(hi,16);En(hi[0],new Ua(Ei.x,Ei.y,0,0,void 0),B)}else if("LineString"===e.type)for(const hi of e.geometry)En(hi,new Ua(hi[0].x,hi[0].y,0,0,void 0),B);else if("Point"===e.type)for(const hi of e.geometry)for(const Ei of hi)En([Ei],new Ua(Ei.x,Ei.y,0,0,void 0),B)}const mc=255,Uc=mc*da;function mm(r,e,o,l,f,_,y,w,E,D,L,B,V,Y,Q,he,Ue){const ot=function(vt,St,At,un,nn,In,Jn,hn){const On=[];if(0===St.positionedLines.length)return On;const kn=un.layout.get("text-rotate").evaluate(In,{})*Math.PI/180,Gn=function(mi){const Hi=mi[0],ri=mi[1],Pi=Hi*ri;return Pi>0?[Hi,-ri]:Pi<0?[-Hi,ri]:0===Hi?[ri,Hi]:[ri,-Hi]}(At);let ii=Math.abs(St.top-St.bottom);for(const mi of St.positionedLines)ii-=mi.lineOffset;const En=St.positionedLines.length,hi=ii/En;let Ei=St.top-At[1];for(let mi=0;mi<En;++mi){const Hi=St.positionedLines[mi];Ei=sv(St,hi,Ei,mi);for(const ri of Hi.positionedGlyphs){if(!ri.rect)continue;const Pi=ri.rect||{};let nr=Yg+1,Mr=!0,Qi=1,zi=0;if(ri.imageName){const qr=Jn[ri.imageName];if(!qr)continue;if(qr.sdf){Dt("SDF images are not supported in formatted text and will be ignored.");continue}Mr=!1,Qi=qr.pixelRatio,nr=Ss/Qi}const ro=(nn||hn)&&ri.vertical,ir=ri.metrics.advance*ri.scale/2,rr=ri.metrics,Wr=ri.rect;if(null===Wr)continue;hn&&St.verticalizable&&(zi=ri.imageName?ir-ri.metrics.width*ri.scale/2:0);const Or=nn?[ri.x+ir,ri.y]:[0,0];let eo=[0,0],zr=[0,0],kr=!1;nn||(ro?(zr=[ri.x+ir+Gn[0],ri.y+Gn[1]-zi],kr=!0):eo=[ri.x+ir+At[0],ri.y+At[1]-zi]);const vo=Wr.w*ri.scale/(Qi*(ri.localGlyph?Dl:1)),No=Wr.h*ri.scale/(Qi*(ri.localGlyph?Dl:1));let to,xr,Bo,uo;if(ro){const qr=ri.y-Ei,Os=new Ae(-ir,ir-qr),Oo=-Math.PI/2,as=new Ae(...zr);to=new Ae(-ir+eo[0],eo[1]),to._rotateAround(Oo,Os)._add(as),to.x+=-qr+ir,to.y-=(rr.left-nr)*ri.scale;const Jo=ri.imageName?rr.advance*ri.scale:yo*ri.scale,Rs=String.fromCharCode(ri.glyph);Zg(Rs)?to.x+=(1-nr)*ri.scale:Qy(Rs)?to.x+=Jo-rr.height*ri.scale+(-nr-1)*ri.scale:to.x+=ri.imageName||rr.width+2*nr===Wr.w&&rr.height+2*nr===Wr.h?(Jo-No)/2:(Jo-(rr.height+2*nr)*ri.scale)/2,xr=new Ae(to.x,to.y-vo),Bo=new Ae(to.x+No,to.y),uo=new Ae(to.x+No,to.y-vo)}else{const qr=(rr.left-nr)*ri.scale-ir+eo[0],Os=(-rr.top-nr)*ri.scale+eo[1],Oo=qr+vo,as=Os+No;to=new Ae(qr,Os),xr=new Ae(Oo,Os),Bo=new Ae(qr,as),uo=new Ae(Oo,as)}if(kn){let qr;qr=nn?new Ae(0,0):kr?new Ae(Gn[0],Gn[1]):new Ae(At[0],At[1]),to._rotateAround(kn,qr),xr._rotateAround(kn,qr),Bo._rotateAround(kn,qr),uo._rotateAround(kn,qr)}const Rr=new Ae(0,0),zo=new Ae(0,0);On.push({tl:to,tr:xr,bl:Bo,br:uo,tex:Pi,writingMode:St.writingMode,glyphOffset:Or,sectionIndex:ri.sectionIndex,isSDF:Mr,pixelOffsetTL:Rr,pixelOffsetBR:zo,minFontScaleX:0,minFontScaleY:0})}}return On}(0,l,E,_,y,w,f,r.allowVerticalPlacement),bt=r.textSizeData;let st=null;"source"===bt.kind?(st=[da*_.layout.get("text-size").evaluate(w,{},Ue)],st[0]>Uc&&Dt(`${r.layerIds[0]}: Value for "text-size" is >= ${mc}. Reduce your "text-size".`)):"composite"===bt.kind&&(st=[da*Q.compositeTextSizes[0].evaluate(w,{},Ue),da*Q.compositeTextSizes[1].evaluate(w,{},Ue)],(st[0]>Uc||st[1]>Uc)&&Dt(`${r.layerIds[0]}: Value for "text-size" is >= ${mc}. Reduce your "text-size".`)),r.addSymbols(r.text,ot,st,E,y,w,L,e,o,D.lineStartIndex,D.lineLength,Y,he,Ue);for(const vt of B)V[vt]=r.text.placedSymbolArray.length-1;return 4*ot.length}function o_(r){for(const e in r)return r[e];return null}function vf(r,e,o,l,f,_,y,w,E,D){let L=y.top,B=y.bottom,V=y.left,Y=y.right;const Q=y.collisionPadding;if(Q&&(V-=Q[0],L-=Q[1],Y+=Q[2],B+=Q[3]),E){const he=new Ae(V,L),Ue=new Ae(Y,L),ot=new Ae(V,B),bt=new Ae(Y,B),st=ne(E);let vt=new Ae(0,0);D&&(vt=new Ae(D[0],D[1])),he._rotateAround(st,vt),Ue._rotateAround(st,vt),ot._rotateAround(st,vt),bt._rotateAround(st,vt),V=Math.min(he.x,Ue.x,ot.x,bt.x),Y=Math.max(he.x,Ue.x,ot.x,bt.x),L=Math.min(he.y,Ue.y,ot.y,bt.y),B=Math.max(he.y,Ue.y,ot.y,bt.y)}return r.emplaceBack(e.x,e.y,e.z,o.x,o.y,V,L,Y,B,w,l,f,_),r.length-1}function gm(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function s_(r,e,o,l){const f=r.compareText;if(e in f){const _=f[e];for(let y=_.length-1;y>=0;y--)if(l.dist(_[y])<o)return!0}else f[e]=[];return f[e].push(l),!1}function a_(r,e){const o=r.fovAboveCenter,l=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,f=(r._camera.position[2]*r.worldSize-l)/Math.cos(r._pitch),_=Math.sin(o)*f/Math.sin(Math.max(Math.PI/2-r._pitch-o,.01)),y=Math.sin(r._pitch)*_+f;return Math.min(1.01*y,f*(1/r._horizonShift))}function gc(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const o=Math.pow(2,-r.z),l=r.x*o,f=(r.x+1)*o,_=r.y*o,y=(r.y+1)*o,w=Ba(l),E=Ba(f),D=To(_),L=To(y),B=e.project(w,D),V=e.project(E,D),Y=e.project(E,L),Q=e.project(w,L);let he=Math.min(B.x,V.x,Y.x,Q.x),Ue=Math.min(B.y,V.y,Y.y,Q.y),ot=Math.max(B.x,V.x,Y.x,Q.x),bt=Math.max(B.y,V.y,Y.y,Q.y);const st=o/16;function vt(At,un,nn,In,Jn,hn){const On=(nn+Jn)/2,kn=(In+hn)/2,Gn=e.project(Ba(On),To(kn)),ii=Math.max(0,he-Gn.x,Ue-Gn.y,Gn.x-ot,Gn.y-bt);he=Math.min(he,Gn.x),ot=Math.max(ot,Gn.x),Ue=Math.min(Ue,Gn.y),bt=Math.max(bt,Gn.y),ii>st&&(vt(At,Gn,nn,In,On,kn),vt(Gn,un,On,kn,Jn,hn))}vt(B,V,l,_,f,_),vt(V,Y,f,_,f,y),vt(Y,Q,f,y,l,y),vt(Q,B,l,y,l,_),he-=st,Ue-=st,ot+=st,bt+=st;const St=1/Math.max(ot-he,bt-Ue);return{scale:St,x:he*St,y:Ue*St,x2:ot*St,y2:bt*St,projection:e}}const nx=ka(new Float32Array(16));class Mu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,o){return{x:0,y:0,z:0}}unproject(e,o){return new Gr(0,0)}projectTilePoint(e,o,l){return{x:e,y:o,z:0}}locationPoint(e,o,l=!0){return e._coordinatePoint(e.locationCoordinate(o),l)}pixelsPerMeter(e,o){return Na(1,e)*o}pixelSpaceConversion(e,o,l){return 1}farthestPixelDistance(e){return a_(e,e.pixelsPerMeter)}pointCoordinate(e,o,l,f){const _=e.horizonLineFromTop(!1),y=new Ae(o,Math.max(_,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(y,f))}pointCoordinate3D(e,o,l){const f=new Ae(o,l);if(e.elevation)return e.elevation.pointCoordinate(f);{const _=this.pointCoordinate(e,f.x,f.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(e,o){if(e.elevation)return!this.pointCoordinate3D(e,o.x,o.y);const l=e.horizonLineFromTop();return o.y<l}createInversionMatrix(e,o){return nx}createTileMatrix(e,o,l){let f,_,y;const w=l.canonical,E=ka(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=gc(w,this);f=1,_=D.x+l.wrap*D.scale,y=D.y,uu(E,E,[f/D.scale,f/D.scale,e.pixelsPerMeter/o])}else f=o/e.zoomScale(w.z),_=(w.x+Math.pow(2,w.z)*l.wrap)*f,y=w.y*f;return $u(E,E,[_,y,0]),uu(E,E,[f/Ii,f/Ii,1]),E}upVector(e,o,l){return[0,0,1]}upVectorScale(e,o,l){return{metersToTile:1}}}class ix extends Mu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[o,l]=this.parallels=e.parallels||[29.5,45.5],f=Math.sin(ne(o));this.n=(f+Math.sin(ne(l)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(e,o){const{n:l,c:f,r0:_}=this,y=ne(e-this.center[0]),w=ne(o),E=Math.sqrt(f-2*l*Math.sin(w))/l;return{x:E*Math.sin(y*l),y:E*Math.cos(y*l)-_,z:0}}unproject(e,o){const{n:l,c:f,r0:_}=this,y=_+o;let w=Math.atan2(e,Math.abs(y))*Math.sign(y);y*l<0&&(w-=Math.PI*Math.sign(e)*Math.sign(y));const E=ne(this.center[0])*l;w=cn(w,-Math.PI-E,Math.PI-E);const D=Xe(Ee(w/l)+this.center[0],-180,180),L=Math.asin(Xe((f-(e*e+y*y)*l*l)/(2*l),-1,1)),B=Xe(Ee(L),-ys,ys);return new Gr(D,B)}}const th=1.340264,nh=-.081106,xf=893e-6,jc=.003796,bf=Math.sqrt(3)/2;class lv extends Mu{project(e,o){o=o/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(bf*Math.sin(o)),f=l*l,_=f*f*f;return{x:.5*(e*Math.cos(l)/(bf*(th+3*nh*f+_*(7*xf+9*jc*f)))/Math.PI+.5),y:1-.5*(l*(th+nh*f+_*(xf+jc*f))/Math.PI+1),z:0}}unproject(e,o){e=(2*e-.5)*Math.PI;let l=o=(2*(1-o)-1)*Math.PI,f=l*l,_=f*f*f;for(let L,B,V,Y=0;Y<12&&(B=l*(th+nh*f+_*(xf+jc*f))-o,V=th+3*nh*f+_*(7*xf+9*jc*f),L=B/V,l=Xe(l-L,-Math.PI/3,Math.PI/3),f=l*l,_=f*f*f,!(Math.abs(L)<1e-12));++Y);const y=bf*e*(th+3*nh*f+_*(7*xf+9*jc*f))/Math.cos(l),w=Math.asin(Math.sin(l)/bf),E=Xe(180*y/Math.PI,-180,180),D=Xe(180*w/Math.PI,-ys,ys);return new Gr(E,D)}}class _m extends Mu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,o){return{x:.5+e/360,y:.5-o/360,z:0}}unproject(e,o){const l=360*(e-.5),f=Xe(360*(.5-o),-ys,ys);return new Gr(l,f)}}const Au=Math.PI/2;function wf(r){return Math.tan((Au+r)/2)}class cv extends Mu{constructor(e){super(e),this.center=e.center||[0,30];const[o,l]=this.parallels=e.parallels||[30,30];let f=ne(o),_=ne(l);this.southernCenter=f+_<0,this.southernCenter&&(f=-f,_=-_);const y=Math.cos(f),w=wf(f);this.n=f===_?Math.sin(f):Math.log(y/Math.cos(_))/Math.log(wf(_)/w),this.f=y*Math.pow(wf(f),this.n)/this.n}project(e,o){o=ne(o),this.southernCenter&&(o=-o),e=ne(e-this.center[0]);const l=1e-6,{n:f,f:_}=this;_>0?o<-Au+l&&(o=-Au+l):o>Au-l&&(o=Au-l);const y=_/Math.pow(wf(o),f);let w=y*Math.sin(f*e),E=_-y*Math.cos(f*e);return w=.5*(w/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:w,y:this.southernCenter?E:1-E,z:0}}unproject(e,o){e=(2*e-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:l,f}=this,_=f-o,y=Math.sign(_),w=Math.sign(l)*Math.sqrt(e*e+_*_);let E=Math.atan2(e,Math.abs(_))*y;_*l<0&&(E-=Math.PI*Math.sign(e)*y);const D=Xe(Ee(E/l)+this.center[0],-180,180),L=Xe(Ee(2*Math.atan(Math.pow(f/w,1/l))-Au),-ys,ys);return new Gr(D,this.southernCenter?-L:L)}}class l_ extends Mu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,o){return{x:Vl(e),y:$l(o),z:0}}unproject(e,o){const l=Ba(e),f=To(o);return new Gr(l,f)}}const c_=ne(ys);class u_ extends Mu{project(e,o){const l=(o=ne(o))*o,f=l*l;return{x:.5*((e=ne(e))*(.8707-.131979*l+f*(f*(.003971*l-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+l*(.015085+f*(.028874*l-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(e,o){e=(2*e-.5)*Math.PI;let l=o=(2*(1-o)-1)*Math.PI,f=25,_=0,y=l*l;do{y=l*l;const D=y*y;_=(l*(1.007226+y*(.015085+D*(.028874*y-.044475-.005916*D)))-o)/(1.007226+y*(.045255+D*(.259866*y-.311325-.005916*11*D))),l=Xe(l-_,-c_,c_)}while(Math.abs(_)>1e-6&&--f>0);y=l*l;const w=Xe(Ee(e/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),E=Ee(l);return new Gr(w,E)}}const ym=ne(ys);class d_ extends Mu{project(e,o){o=ne(o),e=ne(e);const l=Math.cos(o),f=2/Math.PI,_=Math.acos(l*Math.cos(e/2)),y=Math.sin(_)/_,w=.5*(e*f+2*l*Math.sin(e/2)/y)||0,E=.5*(o+Math.sin(o)/y)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(e,o){let l=e=(2*e-.5)*Math.PI,f=o=(2*(1-o)-1)*Math.PI,_=25;const y=1e-6;let w=0,E=0;do{const D=Math.cos(f),L=Math.sin(f),B=2*L*D,V=L*L,Y=D*D,Q=Math.cos(l/2),he=Math.sin(l/2),Ue=2*Q*he,ot=he*he,bt=1-Y*Q*Q,st=bt?1/bt:0,vt=bt?Math.acos(D*Q)*Math.sqrt(1/bt):0,St=.5*(2*vt*D*he+2*l/Math.PI)-e,At=.5*(vt*L+f)-o,un=.5*st*(Y*ot+vt*D*Q*V)+1/Math.PI,nn=st*(Ue*B/4-vt*L*he),In=.125*st*(B*he-vt*L*Y*Ue),Jn=.5*st*(V*Q+vt*ot*D)+.5,hn=nn*In-Jn*un;w=(At*nn-St*Jn)/hn,E=(St*In-At*un)/hn,l=Xe(l-w,-Math.PI,Math.PI),f=Xe(f-E,-ym,ym)}while((Math.abs(w)>y||Math.abs(E)>y)&&--_>0);return new Gr(Ee(l),Ee(f))}}class h_ extends Mu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ne(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,o){const{scale:l,cosPhi:f}=this;return{x:ne(e)*f*l+.5,y:-Math.sin(ne(o))/f*l+.5,z:0}}unproject(e,o){const{scale:l,cosPhi:f}=this,_=-(o-.5)/l,y=Xe(Ee((e-.5)/l)/f,-180,180),w=Math.asin(Xe(_*f,-1,1)),E=Xe(Ee(w),-ys,ys);return new Gr(y,E)}}class uv extends l_{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,o,l){const f=qu(e,o,l);return co(f,f,Yu(jl(l))),{x:f[0],y:f[1],z:f[2]}}locationPoint(e,o){const l=Rc(o.lat,o.lng),f=Ks([],l),_=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(o),e._centerAltitude):e._centerAltitude;Hu(l,l,f,Na(1,0)*Ii*_);const y=ka(new Float64Array(16));return Vu(y,e.pixelMatrix,e.globeMatrix),co(l,l,y),new Ae(l[0],l[1])}pixelsPerMeter(e,o){return Na(1,0)*o}pixelSpaceConversion(e,o,l){const f=Na(1,e)*o,_=_i(Na(1,45)*o,f,l);return this.pixelsPerMeter(e,o)/_}createTileMatrix(e,o,l){const f=Ep(jl(l.canonical));return Vu(new Float64Array(16),e.globeMatrix,f)}createInversionMatrix(e,o){const{center:l}=e,f=Yu(jl(o));return Dh(f,f,ne(l.lng)),mp(f,f,ne(l.lat)),uu(f,f,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(e,o,l,f){return pu(e,o,l,!0)||new Lc(0,0)}pointCoordinate3D(e,o,l){const f=this.pointCoordinate(e,o,l,0);return[f.x,f.y,f.z]}isPointAboveHorizon(e,o){return!pu(e,o.x,o.y,!1)}farthestPixelDistance(e){const o=function(f,_){const y=f.cameraToCenterDistance,w=f._centerAltitude*_,E=f._camera,D=f._camera.forward(),L=hc([],Js([],D,-y),[0,0,w]),B=f.worldSize/(2*Math.PI),V=[0,0,-B],Y=f.width/f.height,Q=Math.tan(f.fovAboveCenter),he=Js([],E.up(),Q),Ue=Js([],E.right(),Q*Y),ot=Ks([],hc([],hc([],D,he),Ue)),bt=[];let st;if(new xg(L,ot).closestPointOnSphere(V,B,bt)){const vt=hc([],bt,V),St=ol([],vt,L);st=Math.cos(f.fovAboveCenter)*Sd(St)}else{const vt=ol([],L,V),St=ol([],V,L);Ks(St,St);const At=Sd(vt)-B;st=Math.sqrt(At*(At+2*B));const un=Math.acos(st/(B+At))-Math.acos(rl(D,St));st*=Math.cos(un)}return 1.01*st}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Ju(e.zoom);if(l>0){const f=a_(e,Na(1,e.center.lat)*e.worldSize),_=e.worldSize/(2*Math.PI),y=Math.max(e.width,e.height)/e.worldSize*Math.PI;return _i(o,f+_*(1-Math.cos(y)),Math.pow(l,10))}return o}upVector(e,o,l){return qu(o,l,e,1)}upVectorScale(e){return{metersToTile:Fa(Oh(jl(e)))}}}function vm(r){const e=r.parallels,o=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new l_(r);case"equirectangular":return new _m(r);case"naturalEarth":return new u_(r);case"equalEarth":return new lv(r);case"winkelTripel":return new d_(r);case"albers":return o?new h_(r):new ix(r);case"lambertConformalConic":return o?new h_(r):new cv(r);case"globe":return new uv(r)}throw new Error(`Invalid projection name: ${r.name}`)}const xm=Hl.types,rx=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ih(r,e,o,l,f,_,y,w,E,D,L,B,V){const Y=w?Math.min(Uc,Math.round(w[0])):0,Q=w?Math.min(Uc,Math.round(w[1])):0;r.emplaceBack(e,o,Math.round(32*l),Math.round(32*f),_,y,(Y<<1)+(E?1:0),Q,16*D,16*L,256*B,256*V)}function yd(r,e,o,l,f,_,y){r.emplaceBack(e,o,l,f,_,y)}function Cf(r,e,o,l,f){r.emplaceBack(e,o,l,f),r.emplaceBack(e,o,l,f),r.emplaceBack(e,o,l,f),r.emplaceBack(e,o,l,f)}function rh(r){for(const e of r.sections)if(Dd(e.text))return!0;return!1}class Ef{constructor(e){this.layoutVertexArray=new jn,this.indexArray=new Di,this.programConfigurations=e,this.segments=new _o,this.dynamicLayoutVertexArray=new Zn,this.opacityVertexArray=new Ai,this.placedSymbolArray=new Eo,this.globeExtVertexArray=new ei}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,o,l,f){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Yy.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,rx,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Vg.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||f)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}yi(Ef,"SymbolBuffers");class Tf{constructor(e,o,l){this.layoutVertexArray=new e,this.layoutAttributes=o,this.indexArray=new l,this.segments=new _o,this.collisionVertexArray=new fr,this.collisionVertexArrayExt=new tr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Jy.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Ky.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}yi(Tf,"CollisionBuffers");class Vc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ka([]),this.placementViewportMatrix=ka([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=em(this.zoom,o["text-size"]),this.iconSizeData=em(this.zoom,o["icon-size"]);const l=this.layers[0].layout,f=l.get("symbol-sort-key"),_=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==_&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===_||"auto"===_&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(y=>za[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Ef(new il(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Ef(new il(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ms,this.lineVertexArray=new iu,this.symbolInstances=new io}calculateGlyphDependencies(e,o,l,f,_){for(let y=0;y<e.length;y++)if(o[e.charCodeAt(y)]=!0,f&&_){const w=sf[e.charAt(y)];w&&(o[w.charCodeAt(0)]=!0)}}populate(e,o,l,f){const _=this.layers[0],y=_.layout,w="globe"===this.projection.name,E=y.get("text-font"),D=y.get("text-field"),L=y.get("icon-image"),B=("constant"!==D.value.kind||D.value.value instanceof Ze&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==E.value.kind||E.value.value.length>0),V="constant"!==L.value.kind||!!L.value.value||Object.keys(L.parameters).length>0,Y=y.get("symbol-sort-key");if(this.features=[],!B&&!V)return;const Q=o.iconDependencies,he=o.glyphDependencies,Ue=o.availableImages,ot=new N(this.zoom);for(const{feature:bt,id:st,index:vt,sourceLayerIndex:St}of e){const At=_._featureFilter.needGeometry,un=ll(bt,At);if(!_._featureFilter.filter(ot,un,l))continue;if(At||(un.geometry=Zl(bt,l,f)),w&&1!==bt.type&&l.z<=5){const hn=un.geometry,On=.98078528056,kn=(Gn,ii)=>rl(qu(Gn.x,Gn.y,l,1),qu(ii.x,ii.y,l,1))<On;for(let Gn=0;Gn<hn.length;Gn++)hn[Gn]=Ey(hn[Gn],kn)}let nn,In;if(B){const hn=_.getValueAndResolveTokens("text-field",un,l,Ue),On=Ze.factory(hn);rh(On)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===b()||this.hasRTLText&&M.isParsed())&&(nn=Y0(On,_,un))}if(V){const hn=_.getValueAndResolveTokens("icon-image",un,l,Ue);In=hn instanceof Bt?hn:Bt.fromString(hn)}if(!nn&&!In)continue;const Jn=this.sortFeaturesByKey?Y.evaluate(un,{},l):void 0;if(this.features.push({id:st,text:nn,icon:In,index:vt,sourceLayerIndex:St,geometry:un.geometry,properties:bt.properties,type:xm[bt.type],sortKey:Jn}),In&&(Q[In.name]=!0),nn){const hn=E.evaluate(un,{},l).join(","),On="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(za.vertical)>=0;for(const kn of nn.sections)if(kn.image)Q[kn.image.name]=!0;else{const Gn=lc(nn.toString()),ii=kn.fontStack||hn,En=he[ii]=he[ii]||{};this.calculateGlyphDependencies(kn.text,En,On,this.allowVerticalPlacement,Gn)}}}"line"===y.get("symbol-placement")&&(this.features=function(bt){const st={},vt={},St=[];let At=0;function un(hn){St.push(bt[hn]),At++}function nn(hn,On,kn){const Gn=vt[hn];return delete vt[hn],vt[On]=Gn,St[Gn].geometry[0].pop(),St[Gn].geometry[0]=St[Gn].geometry[0].concat(kn[0]),Gn}function In(hn,On,kn){const Gn=st[On];return delete st[On],st[hn]=Gn,St[Gn].geometry[0].shift(),St[Gn].geometry[0]=kn[0].concat(St[Gn].geometry[0]),Gn}function Jn(hn,On,kn){const Gn=kn?On[0][On[0].length-1]:On[0][0];return`${hn}:${Gn.x}:${Gn.y}`}for(let hn=0;hn<bt.length;hn++){const On=bt[hn],kn=On.geometry,Gn=On.text?On.text.toString():null;if(!Gn){un(hn);continue}const ii=Jn(Gn,kn),En=Jn(Gn,kn,!0);if(ii in vt&&En in st&&vt[ii]!==st[En]){const hi=In(ii,En,kn),Ei=nn(ii,En,St[hi].geometry);delete st[ii],delete vt[En],vt[Jn(Gn,St[Ei].geometry,!0)]=Ei,St[hi].geometry=null}else ii in vt?nn(ii,En,kn):En in st?In(ii,En,kn):(un(hn),st[ii]=At-1,vt[En]=At-1)}return St.filter(hn=>hn.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((bt,st)=>bt.sortKey-st.sortKey)}update(e,o,l,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,o,this.layers,l,f),this.icon.programConfigurations.updatePaintArrays(e,o,this.layers,l,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=vm(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,o){const l=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:f,y:_}of o)this.lineVertexArray.emplaceBack(f,_);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,o,l,f,_,y,w,E,D,L,B,V,Y,Q){const he=e.indexArray,Ue=e.layoutVertexArray,ot=e.globeExtVertexArray,bt=e.segments.prepareSegment(4*o.length,Ue,he,this.canOverlap?y.sortKey:void 0),st=this.glyphOffsetArray.length,vt=bt.vertexLength,St=this.allowVerticalPlacement&&w===za.vertical?Math.PI/2:0,At=y.text&&y.text.sections;for(let nn=0;nn<o.length;nn++){const{tl:In,tr:Jn,bl:hn,br:On,tex:kn,pixelOffsetTL:Gn,pixelOffsetBR:ii,minFontScaleX:En,minFontScaleY:hi,glyphOffset:Ei,isSDF:mi,sectionIndex:Hi}=o[nn],ri=bt.vertexLength,Pi=Ei[1];if(ih(Ue,D.x,D.y,In.x,Pi+In.y,kn.x,kn.y,l,mi,Gn.x,Gn.y,En,hi),ih(Ue,D.x,D.y,Jn.x,Pi+Jn.y,kn.x+kn.w,kn.y,l,mi,ii.x,Gn.y,En,hi),ih(Ue,D.x,D.y,hn.x,Pi+hn.y,kn.x,kn.y+kn.h,l,mi,Gn.x,ii.y,En,hi),ih(Ue,D.x,D.y,On.x,Pi+On.y,kn.x+kn.w,kn.y+kn.h,l,mi,ii.x,ii.y,En,hi),E){const{x:nr,y:Mr,z:Qi}=E.anchor,[zi,ro,ir]=E.up;yd(ot,nr,Mr,Qi,zi,ro,ir),yd(ot,nr,Mr,Qi,zi,ro,ir),yd(ot,nr,Mr,Qi,zi,ro,ir),yd(ot,nr,Mr,Qi,zi,ro,ir),Cf(e.dynamicLayoutVertexArray,nr,Mr,Qi,St)}else Cf(e.dynamicLayoutVertexArray,D.x,D.y,D.z,St);he.emplaceBack(ri,ri+1,ri+2),he.emplaceBack(ri+1,ri+2,ri+3),bt.vertexLength+=4,bt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ei[0]),nn!==o.length-1&&Hi===o[nn+1].sectionIndex||e.programConfigurations.populatePaintArrays(Ue.length,y,y.index,{},Y,Q,At&&At[Hi])}const un=E?E.anchor:D;e.placedSymbolArray.emplaceBack(un.x,un.y,un.z,D.x,D.y,st,this.glyphOffsetArray.length-st,vt,L,B,D.segment,l?l[0]:0,l?l[1]:0,f[0],f[1],w,0,!1,0,V,0)}_commitLayoutVertex(e,o,l,f,_,y,w){e.emplaceBack(o,l,f,_,y,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(e,o,l,f,_,y,w){const E=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),D=E.vertexLength,L=w.tileAnchorX,B=w.tileAnchorY;for(let Y=0;Y<4;Y++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(o,-e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(o,e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(o,e.padding,e.padding),l.collisionVertexArrayExt.emplaceBack(o,-e.padding,e.padding),this._commitLayoutVertex(l.layoutVertexArray,f,_,y,L,B,new Ae(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,f,_,y,L,B,new Ae(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,f,_,y,L,B,new Ae(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,f,_,y,L,B,new Ae(e.x1,e.y2)),E.vertexLength+=4;const V=l.indexArray;V.emplaceBack(D,D+1),V.emplaceBack(D+1,D+2),V.emplaceBack(D+2,D+3),V.emplaceBack(D+3,D),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,o,l,f,_,y){for(let w=f;w<_;w++){const E=l.get(w),D=this.getSymbolInstanceTextSize(e,y,o,w);this._addCollisionDebugVertices(E,D,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(e,o,l,f,_,y){for(let w=f;w<_;w++){const E=l.get(w),D=this.getSymbolInstanceIconSize(e,o,y.placedIconSymbolIndex);this._addCollisionDebugVertices(E,D,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}generateCollisionDebugBuffers(e,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Tf(wi,$g.members,oo),this.iconCollisionBox=new Tf(wi,$g.members,oo);const l=qd(this.iconSizeData,e),f=qd(this.textSizeData,e);for(let _=0;_<this.symbolInstances.length;_++){const y=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(f,e,o,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(f,e,o,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(l,e,o,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(l,e,o,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,o,l,f){const _=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:f),y=tm(this.textSizeData,e,_)/yo;return this.tilePixelRatio*y}getSymbolInstanceIconSize(e,o,l){const f=this.icon.placedSymbolArray.get(l),_=tm(this.iconSizeData,e,f);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(e,o,l){e.emplaceBack(o,-l,-l),e.emplaceBack(o,l,-l),e.emplaceBack(o,l,l),e.emplaceBack(o,-l,l)}_updateTextDebugCollisionBoxes(e,o,l,f,_,y){for(let w=f;w<_;w++){const E=l.get(w),D=this.getSymbolInstanceTextSize(e,y,o,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,E.padding)}}_updateIconDebugCollisionBoxes(e,o,l,f,_,y){for(let w=f;w<_;w++){const E=l.get(w),D=this.getSymbolInstanceIconSize(e,o,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,E.padding)}}updateCollisionDebugBuffers(e,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=qd(this.iconSizeData,e),f=qd(this.textSizeData,e);for(let _=0;_<this.symbolInstances.length;_++){const y=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(f,e,o,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(f,e,o,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(l,e,o,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(l,e,o,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,o,l,f,_,y,w,E,D){const L={};if(o<l){const{x1:B,y1:V,x2:Y,y2:Q,padding:he,projectedAnchorX:Ue,projectedAnchorY:ot,projectedAnchorZ:bt,tileAnchorX:st,tileAnchorY:vt,featureIndex:St}=e.get(o);L.textBox={x1:B,y1:V,x2:Y,y2:Q,padding:he,projectedAnchorX:Ue,projectedAnchorY:ot,projectedAnchorZ:bt,tileAnchorX:st,tileAnchorY:vt},L.textFeatureIndex=St}if(f<_){const{x1:B,y1:V,x2:Y,y2:Q,padding:he,projectedAnchorX:Ue,projectedAnchorY:ot,projectedAnchorZ:bt,tileAnchorX:st,tileAnchorY:vt,featureIndex:St}=e.get(f);L.verticalTextBox={x1:B,y1:V,x2:Y,y2:Q,padding:he,projectedAnchorX:Ue,projectedAnchorY:ot,projectedAnchorZ:bt,tileAnchorX:st,tileAnchorY:vt},L.verticalTextFeatureIndex=St}if(y<w){const{x1:B,y1:V,x2:Y,y2:Q,padding:he,projectedAnchorX:Ue,projectedAnchorY:ot,projectedAnchorZ:bt,tileAnchorX:st,tileAnchorY:vt,featureIndex:St}=e.get(y);L.iconBox={x1:B,y1:V,x2:Y,y2:Q,padding:he,projectedAnchorX:Ue,projectedAnchorY:ot,projectedAnchorZ:bt,tileAnchorX:st,tileAnchorY:vt},L.iconFeatureIndex=St}if(E<D){const{x1:B,y1:V,x2:Y,y2:Q,padding:he,projectedAnchorX:Ue,projectedAnchorY:ot,projectedAnchorZ:bt,tileAnchorX:st,tileAnchorY:vt,featureIndex:St}=e.get(E);L.verticalIconBox={x1:B,y1:V,x2:Y,y2:Q,padding:he,projectedAnchorX:Ue,projectedAnchorY:ot,projectedAnchorZ:bt,tileAnchorX:st,tileAnchorY:vt},L.verticalIconFeatureIndex=St}return L}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const l=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,o){const l=e.placedSymbolArray.get(o),f=l.vertexStartIndex+4*l.numGlyphs;for(let _=l.vertexStartIndex;_<f;_+=4)e.indexArray.emplaceBack(_,_+1,_+2),e.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const o=Math.sin(e),l=Math.cos(e),f=[],_=[],y=[];for(let w=0;w<this.symbolInstances.length;++w){y.push(w);const E=this.symbolInstances.get(w);f.push(0|Math.round(o*E.tileAnchorX+l*E.tileAnchorY)),_.push(E.featureIndex)}return y.sort((w,E)=>f[w]-f[E]||_[E]-_[w]),y}addToSortKeyRanges(e,o){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===o?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const l=this.symbolInstances.get(o);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:D}=l;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),_>=0&&_!==f&&this.addIndicesForPlacedSymbol(this.text,_),y>=0&&y!==_&&y!==f&&this.addIndicesForPlacedSymbol(this.text,y),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}yi(Vc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Vc.MAX_GLYPHS=65535,Vc.addDynamicAttributes=Cf;const dv=new gt({"symbol-placement":new ce(It.layout_symbol["symbol-placement"]),"symbol-spacing":new ce(It.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ce(It.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new We(It.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ce(It.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ce(It.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ce(It.layout_symbol["icon-ignore-placement"]),"icon-optional":new ce(It.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ce(It.layout_symbol["icon-rotation-alignment"]),"icon-size":new We(It.layout_symbol["icon-size"]),"icon-text-fit":new ce(It.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ce(It.layout_symbol["icon-text-fit-padding"]),"icon-image":new We(It.layout_symbol["icon-image"]),"icon-rotate":new We(It.layout_symbol["icon-rotate"]),"icon-padding":new ce(It.layout_symbol["icon-padding"]),"icon-keep-upright":new ce(It.layout_symbol["icon-keep-upright"]),"icon-offset":new We(It.layout_symbol["icon-offset"]),"icon-anchor":new We(It.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ce(It.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ce(It.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ce(It.layout_symbol["text-rotation-alignment"]),"text-field":new We(It.layout_symbol["text-field"]),"text-font":new We(It.layout_symbol["text-font"]),"text-size":new We(It.layout_symbol["text-size"]),"text-max-width":new We(It.layout_symbol["text-max-width"]),"text-line-height":new We(It.layout_symbol["text-line-height"]),"text-letter-spacing":new We(It.layout_symbol["text-letter-spacing"]),"text-justify":new We(It.layout_symbol["text-justify"]),"text-radial-offset":new We(It.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ce(It.layout_symbol["text-variable-anchor"]),"text-anchor":new We(It.layout_symbol["text-anchor"]),"text-max-angle":new ce(It.layout_symbol["text-max-angle"]),"text-writing-mode":new ce(It.layout_symbol["text-writing-mode"]),"text-rotate":new We(It.layout_symbol["text-rotate"]),"text-padding":new ce(It.layout_symbol["text-padding"]),"text-keep-upright":new ce(It.layout_symbol["text-keep-upright"]),"text-transform":new We(It.layout_symbol["text-transform"]),"text-offset":new We(It.layout_symbol["text-offset"]),"text-allow-overlap":new ce(It.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ce(It.layout_symbol["text-ignore-placement"]),"text-optional":new ce(It.layout_symbol["text-optional"])});var bm={paint:new gt({"icon-opacity":new We(It.paint_symbol["icon-opacity"]),"icon-color":new We(It.paint_symbol["icon-color"]),"icon-halo-color":new We(It.paint_symbol["icon-halo-color"]),"icon-halo-width":new We(It.paint_symbol["icon-halo-width"]),"icon-halo-blur":new We(It.paint_symbol["icon-halo-blur"]),"icon-translate":new ce(It.paint_symbol["icon-translate"]),"icon-translate-anchor":new ce(It.paint_symbol["icon-translate-anchor"]),"text-opacity":new We(It.paint_symbol["text-opacity"]),"text-color":new We(It.paint_symbol["text-color"],{runtimeType:ti,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new We(It.paint_symbol["text-halo-color"]),"text-halo-width":new We(It.paint_symbol["text-halo-width"]),"text-halo-blur":new We(It.paint_symbol["text-halo-blur"]),"text-translate":new ce(It.paint_symbol["text-translate"]),"text-translate-anchor":new ce(It.paint_symbol["text-translate-anchor"])}),layout:dv};class f_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ut,this.defaultValue=e}evaluate(e){if(e.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(e.formattedSection))return o.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yi(f_,"FormatSectionOverride",{omit:["defaultValue"]});class oh extends Po{constructor(e){super(e,bm)}recalculate(e,o){super.recalculate(e,o),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const f=[];for(const _ of l)f.indexOf(_)<0&&f.push(_);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,o,l,f){const _=this.layout.get(e).evaluate(o,{},l,f),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||qo(y.value)||!_?_:(w=o.properties,_.replace(/{([^{}]+)}/g,(D,L)=>L in w?String(w[L]):""));var w}createBucket(e){return new Vc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of bm.paint.overridableProperties){if(!oh.hasPaintOverride(this.layout,e))continue;const o=this.paint.get(e),l=new f_(o),f=new $s(l,o.property.specification);let _=null;_="constant"===o.value.kind||"source"===o.value.kind?new $o("source",f):new fs("composite",f,o.value.zoomStops,o.value._interpolationType),this.paint._values[e]=new Qe(o.property,_,o.parameters)}}_handleOverridablePaintPropertyUpdate(e,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven())&&oh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,o){const l=e.get("text-field"),f=bm.paint.properties[o];let _=!1;const y=w=>{for(const E of w)if(f.overrides&&f.overrides.hasOverride(E))return void(_=!0)};if("constant"===l.value.kind&&l.value.value instanceof Ze)y(l.value.value.sections);else if("source"===l.value.kind){const w=D=>{_||(D instanceof Ns&&ji(D.value)===J?y(D.value.sections):D instanceof jo?y(D.sections):D.eachChild(w))},E=l.value;E._styleExpression&&w(E._styleExpression.expression)}return _}getProgramConfiguration(e){return new cu(this,e)}}var ox={paint:new gt({"background-color":new ce(It.paint_background["background-color"]),"background-pattern":new ce(It.paint_background["background-pattern"]),"background-opacity":new ce(It.paint_background["background-opacity"])})},wm={paint:new gt({"raster-opacity":new ce(It.paint_raster["raster-opacity"]),"raster-hue-rotate":new ce(It.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ce(It.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ce(It.paint_raster["raster-brightness-max"]),"raster-saturation":new ce(It.paint_raster["raster-saturation"]),"raster-contrast":new ce(It.paint_raster["raster-contrast"]),"raster-resampling":new ce(It.paint_raster["raster-resampling"]),"raster-fade-duration":new ce(It.paint_raster["raster-fade-duration"])})};class $c extends Po{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Df={paint:new gt({"sky-type":new ce(It.paint_sky["sky-type"]),"sky-atmosphere-sun":new ce(It.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ce(It.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ce(It.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ce(It.paint_sky["sky-gradient-radius"]),"sky-gradient":new pt(It.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ce(It.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ce(It.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ce(It.paint_sky["sky-opacity"])})};function If(r,e,o){const l=[0,0,1],f=gp([]);return Pd(f,f,o?-ne(r)+Math.PI:ne(r)),Mh(f,f,-ne(e)),_g(l,l,f),Ks(l,l)}const p_={circle:class extends Po{constructor(r){super(r,Z0)}createBucket(r){return new Ld(r)}queryRadius(r){const e=r;return Qu("circle-radius",this,e)+Qu("circle-stroke-width",this,e)+ed(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,o,l,f,_,y,w){const E=Sy(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,r.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(e,o)+this.paint.get("circle-stroke-width").evaluate(e,o);return Py(r,l,_,y,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,D)}getProgramIds(){return["circle"]}getProgramConfiguration(r){return new cu(this,r)}},heatmap:class extends Po{createBucket(r){return new kd(r)}constructor(r){super(r,Ly),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){"heatmap-color"===r&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=kh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return Qu("heatmap-radius",this,r)}queryIntersectsFeature(r,e,o,l,f,_,y,w){const E=this.paint.get("heatmap-radius").evaluate(e,o);return Py(r,l,_,y,w,!0,!0,new Ae(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(r){return new cu(this,r)}},hillshade:class extends Po{constructor(r){super(r,Ag)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Po{constructor(r){super(r,Zh)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),o=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getProgramConfiguration(r){return new cu(this,r)}recalculate(r,e){super.recalculate(r,e);const o=this.paint._values["fill-outline-color"];"constant"===o.value.kind&&void 0===o.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new jd(r)}queryRadius(){return ed(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,o,l,f,_){return!r.queryGeometry.isAboveHorizon&&Ku(Ay(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,r.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Po{constructor(r){super(r,zg)}createBucket(r){return new sd(r)}queryRadius(){return ed(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(r){return new cu(this,r)}queryIntersectsFeature(r,e,o,l,f,_,y,w,E){const D=Sy(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,r.pixelToTileUnitsFactor),L=this.paint.get("fill-extrusion-height").evaluate(e,o),B=this.paint.get("fill-extrusion-base").evaluate(e,o),V=[0,0],Y=w&&_.elevation,Q=_.elevation?_.elevation.exaggeration():1,he=r.tile.getBucket(this);if(Y&&he instanceof sd){const vt=he.centroidVertexArray,St=E+1;St<vt.length&&(V[0]=vt.geta_centroid_pos0(St),V[1]=vt.geta_centroid_pos1(St))}if(0===V[0]&&1===V[1])return!1;"globe"===_.projection.name&&(l=Kh([l],[new Ae(0,0),new Ae(Ii,Ii)],r.tileID.canonical).map(vt=>vt.polygon).flat());const Ue=Y?w:null,[ot,bt]=(St=l,At=B,un=L,nn=D,In=y,Jn=Ue,hn=V,On=Q,kn=_.center.lat,"globe"===(vt=_).projection.name?function(ii,En,hi,Ei,mi,Hi,ri,Pi,nr,Mr,Qi){const zi=[],ro=[],ir=ii.projection.upVectorScale(Qi,ii.center.lat,ii.worldSize).metersToTile,rr=[0,0,0,1],Wr=[0,0,0,1],Or=(zr,kr,vo,No)=>{zr[0]=kr,zr[1]=vo,zr[2]=No,zr[3]=1},eo=qp();hi>0&&(hi+=eo),Ei+=eo;for(const zr of En){const kr=[],vo=[];for(const No of zr){const to=No.x+mi.x,xr=No.y+mi.y,Bo=ii.projection.projectTilePoint(to,xr,Qi),uo=ii.projection.upVector(Qi,No.x,No.y);let Rr=hi,zo=Ei;if(ri){const qr=Jp(to,xr,hi,Ei,ri,Pi,nr,Mr);Rr+=qr.base,zo+=qr.top}0!==hi?Or(rr,Bo.x+uo[0]*ir*Rr,Bo.y+uo[1]*ir*Rr,Bo.z+uo[2]*ir*Rr):Or(rr,Bo.x,Bo.y,Bo.z),Or(Wr,Bo.x+uo[0]*ir*zo,Bo.y+uo[1]*ir*zo,Bo.z+uo[2]*ir*zo),co(rr,rr,Hi),co(Wr,Wr,Hi),kr.push(new ld(rr[0],rr[1],rr[2])),vo.push(new ld(Wr[0],Wr[1],Wr[2]))}zi.push(kr),ro.push(vo)}return[zi,ro]}(vt,St,At,un,nn,In,Jn,hn,On,kn,r.tileID.canonical):Jn?function(ii,En,hi,Ei,mi,Hi,ri,Pi,nr){const Mr=[],Qi=[],zi=[0,0,0,1];for(const ro of ii){const ir=[],rr=[];for(const Wr of ro){const Or=Wr.x+Ei.x,eo=Wr.y+Ei.y,zr=Jp(Or,eo,En,hi,Hi,ri,Pi,nr);zi[0]=Or,zi[1]=eo,zi[2]=zr.base,zi[3]=1,hu(zi,zi,mi),zi[3]=Math.max(zi[3],1e-5);const kr=new ld(zi[0]/zi[3],zi[1]/zi[3],zi[2]/zi[3]);zi[0]=Or,zi[1]=eo,zi[2]=zr.top,zi[3]=1,hu(zi,zi,mi),zi[3]=Math.max(zi[3],1e-5);const vo=new ld(zi[0]/zi[3],zi[1]/zi[3],zi[2]/zi[3]);ir.push(kr),rr.push(vo)}Mr.push(ir),Qi.push(rr)}return[Mr,Qi]}(St,At,un,nn,In,Jn,hn,On,kn):function(ii,En,hi,Ei,mi){const Hi=[],ri=[],Pi=mi[8]*En,nr=mi[9]*En,Mr=mi[10]*En,Qi=mi[11]*En,zi=mi[8]*hi,ro=mi[9]*hi,ir=mi[10]*hi,rr=mi[11]*hi;for(const Wr of ii){const Or=[],eo=[];for(const zr of Wr){const kr=zr.x+Ei.x,vo=zr.y+Ei.y,No=mi[0]*kr+mi[4]*vo+mi[12],to=mi[1]*kr+mi[5]*vo+mi[13],xr=mi[2]*kr+mi[6]*vo+mi[14],Bo=mi[3]*kr+mi[7]*vo+mi[15],uo=No+Pi,Rr=to+nr,zo=xr+Mr,qr=Math.max(Bo+Qi,1e-5),Os=No+zi,Oo=to+ro,as=xr+ir,Jo=Math.max(Bo+rr,1e-5);Or.push(new ld(uo/qr,Rr/qr,zo/qr)),eo.push(new ld(Os/Jo,Oo/Jo,as/Jo))}Hi.push(Or),ri.push(eo)}return[Hi,ri]}(St,At,un,nn,In)),st=r.queryGeometry;var vt,St,At,un,nn,In,Jn,hn,On,kn;return function(vt,St,At){let un=1/0;Ku(At,St)&&(un=Yp(At,St[0]));for(let nn=0;nn<St.length;nn++){const In=St[nn],Jn=vt[nn];for(let hn=0;hn<In.length-1;hn++){const On=In[hn],kn=[On,In[hn+1],Jn[hn+1],Jn[hn],On];Pp(At,kn)&&(un=Math.min(un,Yp(At,kn)))}}return un!==1/0&&un}(ot,bt,st.isPointQuery()?st.screenBounds:st.screenGeometry)}},line:class extends Po{constructor(r){super(r,rf),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if("line-gradient"===r){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof pl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=Xp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new tf(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(r){return new cu(this,r)}queryRadius(r){const e=r,o=Qp(Qu("line-width",this,e),Qu("line-gap-width",this,e)),l=Qu("line-offset",this,e);return o/2+Math.abs(l)+ed(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,o,l,f,_){if(r.queryGeometry.isAboveHorizon)return!1;const y=Ay(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,r.pixelToTileUnitsFactor),w=r.pixelToTileUnitsFactor/2*Qp(this.paint.get("line-width").evaluate(e,o),this.paint.get("line-gap-width").evaluate(e,o)),E=this.paint.get("line-offset").evaluate(e,o);return E&&(l=function(D,L){const B=[],V=new Ae(0,0);for(let Y=0;Y<D.length;Y++){const Q=D[Y],he=[];for(let Ue=0;Ue<Q.length;Ue++){const ot=Q[Ue],bt=Q[Ue+1],st=0===Ue?V:ot.sub(Q[Ue-1])._unit()._perp(),vt=Ue===Q.length-1?V:bt.sub(ot)._unit()._perp(),St=st._add(vt)._unit();St._mult(1/(St.x*vt.x+St.y*vt.y)),he.push(St._mult(L)._add(ot))}B.push(he)}return B}(l,E*r.pixelToTileUnitsFactor)),function(D,L,B){for(let V=0;V<L.length;V++){const Y=L[V];if(D.length>=3)for(let Q=0;Q<Y.length;Q++)if(Fc(D,Y[Q]))return!0;if($0(D,Y,B))return!0}return!1}(y,l,w)}isTileClipped(){return!0}},symbol:oh,background:class extends Po{constructor(r){super(r,ox)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Po{constructor(r){super(r,wm)}getProgramIds(){return["raster"]}},sky:class extends Po{constructor(r){super(r,Df),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){"sky-gradient"===r?this._updateColorRamp():"sky-atmosphere-sun"!==r&&"sky-atmosphere-halo-color"!==r&&"sky-atmosphere-color"!==r&&"sky-atmosphere-sun-intensity"!==r||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=kh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if("atmosphere"===this.paint.get("sky-type")){const l=this.paint.get("sky-atmosphere-sun"),f=!l,_=r.style.light,y=_.properties.get("position");return f&&"viewport"===_.properties.get("anchor")&&Dt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?If(y.azimuthal,90-y.polar,e):If(l[0],90-l[1],e)}const o=this.paint.get("sky-gradient-center");return If(o[0],90-o[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return"atmosphere"===r?["skyboxCapture","skybox"]:"gradient"===r?["skyboxGradient"]:null}}};class sh{constructor(e,o,l,f){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(o,f)}update(e,o,l){const{width:f,height:_}=e,{context:y}=this,{gl:w}=y,{HTMLImageElement:E,HTMLCanvasElement:D,HTMLVideoElement:L,ImageData:B,ImageBitmap:V}=j;if(w.bindTexture(w.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!o||!1!==o.premultiply)),l||this.size&&this.size[0]===f&&this.size[1]===_){const{x:Y,y:Q}=l||{x:0,y:0};e instanceof E||e instanceof D||e instanceof L||e instanceof B||V&&e instanceof V?w.texSubImage2D(w.TEXTURE_2D,0,Y,Q,w.RGBA,w.UNSIGNED_BYTE,e):w.texSubImage2D(w.TEXTURE_2D,0,Y,Q,f,_,w.RGBA,w.UNSIGNED_BYTE,e.data)}else this.size=[f,_],e instanceof E||e instanceof D||e instanceof L||e instanceof B||V&&e instanceof V?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,e):w.texImage2D(w.TEXTURE_2D,0,this.format,f,_,0,this.format,w.UNSIGNED_BYTE,e.data);this.useMipmap=!!(o&&o.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(e,o){const{context:l}=this,{gl:f}=l;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:e),this.filter=e),o!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class hv{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class fv{constructor(){this.tasks={},this.taskQueue=[],Kt(["process"],this),this.invoker=new hv(this.process),this.nextId=0}add(e,o){const l=this.nextId++,f=function({type:_,isSymbolTile:y,zoom:w}){return w=w||0,"message"===_?0:"maybePrepare"!==_||y?"parseTile"!==_||y?"parseTile"===_&&y?300-w:"maybePrepare"===_&&y?400-w:500:200-w:100-w}(o);if(0===f){on();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:e,metadata:o,priority:f,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){on();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const o=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let e=null,o=1/0;for(let f=0;f<this.taskQueue.length;f++){const _=this.tasks[this.taskQueue[f]];_.priority<o&&(o=_.priority,e=f)}if(null===e)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class m_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let o=0;o<e.length;o++){const l=e[o];this._stringToNumber[l]=o,this._numberToString[o]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const g_=["tile","layer","source","sourceLayer","state"];class pv{constructor(e,o,l,f,_){this.type="Feature",this._vectorTileFeature=e,this._z=o,this._x=l,this._y=f,this.properties=e.properties,this.id=_}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const o of g_)void 0!==this[o]&&(e[o]=this[o]);return e}}const Su=new Uint16Array(8184);for(let r=0;r<2046;r++){let e=r+2,o=0,l=0,f=0,_=0,y=0,w=0;for(1&e?f=_=y=32:o=l=w=32;(e>>=1)>1;){const D=o+f>>1,L=l+_>>1;1&e?(f=o,_=l,o=y,l=w):(o=f,l=_,f=y,_=w),y=D,w=L}const E=4*r;Su[E+0]=o,Su[E+1]=l,Su[E+2]=f,Su[E+3]=_}const Il=new Uint16Array(2178),yc=new Uint8Array(1089),Cm=new Uint16Array(1089);function pr(r){return 0===r?-.03125:32===r?.03125:0}var Em=Wt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Tm={type:2,extent:Ii,loadGeometry:()=>[[new Ae(0,0),new Ae(Ii+1,0),new Ae(Ii+1,Ii+1),new Ae(0,Ii+1),new Ae(0,0)]]};class Zc{constructor(e,o,l,f,_){this.tileID=e,this.uid=Oe(),this.uses=0,this.tileSize=o,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(e){const o=e+this.timeAdded;o<Kr.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=gc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,o,l){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(f,_){const y={};if(!_)return y;for(const w of f){const E=w.layerIds.map(D=>_.getLayer(D)).filter(Boolean);if(0!==E.length){w.layers=E,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(D=>E.filter(L=>L.id===D)[0]));for(const D of E)y[D.id]=w}}return y}(e.buckets,o.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof Vc){if(this.hasSymbolBuckets=!0,!l)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof Vc&&_.hasRTLText){this.hasRTLText=!0,M.isLoading()||M.isLoaded()||"deferred"!==b()||I();break}}this.queryPadding=0;for(const f in this.buckets){const _=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(f).queryRadius(_))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Zr}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const f=this.buckets[l];f.uploadPending()&&f.upload(e)}const o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new sh(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new sh(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new sh(e,this.lineAtlas.image,o.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,l,f,_,y,w,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:w,transform:y,params:_,tileTransform:this.tileTransform},e,o,l):{}}querySourceFeatures(e,o){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const f=l.loadVTLayers(),_=o?o.sourceLayer:"",y=f._geojsonTileLayer||f[_];if(!y)return;const w=jr(o&&o.filter),{z:E,x:D,y:L}=this.tileID.canonical,B={z:E,x:D,y:L};for(let V=0;V<y.length;V++){const Y=y.feature(V);if(w.needGeometry){const Ue=ll(Y,!0);if(!w.filter(new N(this.tileID.overscaledZ),Ue,this.tileID.canonical))continue}else if(!w.filter(new N(this.tileID.overscaledZ),Y))continue;const Q=l.getId(Y,_),he=new pv(Y,E,D,L,Q);he.tile=B,e.push(he)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const o=this.expirationTime;if(e.cacheControl){const l=Rn(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let f=!1;if(this.expirationTime>l)f=!1;else if(o)if(this.expirationTime<o)f=!0;else{const _=this.expirationTime-o;_?this.expirationTime=l+Math.max(_,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!o)return;const l=this.latestFeatureIndex.loadVTLayers(),f=o.style.listImages();for(const _ in this.buckets){if(!o.style.hasLayer(_))continue;const y=this.buckets[_],w=y.layers[0].sourceLayer||"_geojsonTileLayer",E=l[w],D=e[w];if(!E||!D||0===Object.keys(D).length)continue;if(y.update(D,E,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof tf||y instanceof jd){const B=o.style._getSourceCache(y.layers[0].source);o._terrain&&o._terrain.enabled&&B&&y.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(B.id,this.tileID)}const L=o&&o.style&&o.style.getLayer(_);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Kr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Kr.now()+e}setTexture(e,o){const l=o.context,f=l.gl;this.texture=this.texture||o.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new sh(l,e,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(e,o){const l={};for(const f of o)l[f]=!0;this.dependencies[e]=l}hasDependency(e,o){for(const l of e){const f=this.dependencies[l];if(f)for(const _ of o)if(f[_])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,o){if(!o||"mercator"===o.name||this._tileDebugBuffer)return;const l=Zl(Tm,this.tileID.canonical,this.tileTransform)[0],f=new Yn,_=new wa;for(let y=0;y<l.length;y++){const{x:w,y:E}=l[y];f.emplaceBack(w,E),_.emplaceBack(y)}_.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(_),this._tileDebugBuffer=e.createVertexBuffer(f,Sc.members),this._tileDebugSegments=_o.simpleSegment(0,0,f.length,_.length)}_makeTileBoundsBuffers(e,o){if(this._tileBoundsBuffer||!o||"mercator"===o.name)return;const l=Zl(Tm,this.tileID.canonical,this.tileTransform)[0];let f,_;if(this.isRaster){const y=function(w,E){const D=gc(w,E),L=Math.pow(2,w.z);for(let Ue=0;Ue<33;Ue++)for(let ot=0;ot<33;ot++){const bt=Ba((w.x+(ot+pr(ot))/32)/L),st=To((w.y+(Ue+pr(Ue))/32)/L),vt=E.project(bt,st),St=33*Ue+ot;Il[2*St+0]=Math.round((vt.x*D.scale-D.x)*Ii),Il[2*St+1]=Math.round((vt.y*D.scale-D.y)*Ii)}yc.fill(0),Cm.fill(0);for(let Ue=2045;Ue>=0;Ue--){const ot=4*Ue,bt=Su[ot+0],st=Su[ot+1],vt=Su[ot+2],St=Su[ot+3],At=bt+vt>>1,un=st+St>>1,nn=At+un-st,In=un+bt-At,Jn=33*st+bt,hn=33*St+vt,On=33*un+At,kn=Math.hypot((Il[2*Jn+0]+Il[2*hn+0])/2-Il[2*On+0],(Il[2*Jn+1]+Il[2*hn+1])/2-Il[2*On+1])>=16;yc[On]=yc[On]||(kn?1:0),Ue<1022&&(yc[On]=yc[On]||yc[33*(st+In>>1)+(bt+nn>>1)]||yc[33*(St+In>>1)+(vt+nn>>1)])}const B=new Pn,V=new Di;let Y=0;function Q(Ue,ot){const bt=33*ot+Ue;return 0===Cm[bt]&&(B.emplaceBack(Il[2*bt+0],Il[2*bt+1],Ue*Ii/32,ot*Ii/32),Cm[bt]=++Y),Cm[bt]-1}function he(Ue,ot,bt,st,vt,St){const At=Ue+bt>>1,un=ot+st>>1;if(Math.abs(Ue-vt)+Math.abs(ot-St)>1&&yc[33*un+At])he(vt,St,Ue,ot,At,un),he(bt,st,vt,St,At,un);else{const nn=Q(Ue,ot),In=Q(bt,st),Jn=Q(vt,St);V.emplaceBack(nn,In,Jn)}}return he(0,0,32,32,32,0),he(32,32,0,0,0,32),{vertices:B,indices:V}}(this.tileID.canonical,o);f=y.vertices,_=y.indices}else{f=new Pn,_=new Di;for(const{x:w,y:E}of l)f.emplaceBack(w,E,0,0);const y=jp(f.int16,void 0,4);for(let w=0;w<y.length;w+=3)_.emplaceBack(y[w],y[w+1],y[w+2])}this._tileBoundsBuffer=e.createVertexBuffer(f,Em.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(_),this._tileBoundsSegments=_o.simpleSegment(0,0,f.length,_.length)}_makeGlobeTileDebugBuffers(e,o){const l=o.projection;if(!l||"globe"!==l.name||o.freezeTileCoverage)return;const f=this.tileID.canonical,_=Yu(mu(f,o)),y=Ju(o.zoom);let w;y>0&&(w=Mc(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,f,o,_,w,y),this._makeGlobeTileDebugTextBuffer(e,f,o,_,w,y)}_globePoint(e,o,l,f,_,y,w){let E=qu(e,o,l);if(y){const D=1<<l.z,L=Vl(f.center.lng),B=$l(f.center.lat),V=(l.x+.5)/D-L;let Y=0;V>.5?Y=-1:V<-.5&&(Y=1);let Q=(e/Ii+l.x)/D+Y,he=(o/Ii+l.y)/D;Q=(Q-L)*f._pixelsPerMercatorPixel+L,he=(he-B)*f._pixelsPerMercatorPixel+B;const Ue=[Q*f.worldSize,he*f.worldSize,0];co(Ue,Ue,y),E=Oc(E,Ue,w)}return co(E,E,_)}_makeGlobeTileDebugBorderBuffer(e,o,l,f,_,y){const w=new Yn,E=new wa,D=new tn,L=(V,Y,Q,he,Ue)=>{const ot=(Q-V)/(Ue-1),bt=(he-Y)/(Ue-1),st=w.length;for(let vt=0;vt<Ue;vt++){const St=V+vt*ot,At=Y+vt*bt;w.emplaceBack(St,At);const un=this._globePoint(St,At,o,l,f,_,y);D.emplaceBack(un[0],un[1],un[2]),E.emplaceBack(st+vt)}},B=Ii;L(0,0,B,0,16),L(B,0,B,B,16),L(B,B,0,B,16),L(0,B,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(E),this._tileDebugBuffer=e.createVertexBuffer(w,Sc.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(D,vp.members),this._tileDebugSegments=_o.simpleSegment(0,0,w.length,E.length)}_makeGlobeTileDebugTextBuffer(e,o,l,f,_,y){const w=Ii/4,E=new Yn,D=new Di,L=new tn,B=25;D.reserve(32),E.reserve(B),L.reserve(B);const V=(Y,Q)=>B*Y+Q;for(let Y=0;Y<B;Y++){const Q=Y*w;for(let he=0;he<B;he++){const Ue=he*w;E.emplaceBack(Ue,Q);const ot=this._globePoint(Ue,Q,o,l,f,_,y);L.emplaceBack(ot[0],ot[1],ot[2])}}for(let Y=0;Y<4;Y++)for(let Q=0;Q<4;Q++){const he=V(Y,Q),Ue=V(Y,Q+1),ot=V(Y+1,Q),bt=V(Y+1,Q+1);D.emplaceBack(he,Ue,ot),D.emplaceBack(ot,Ue,bt)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(D),this._tileDebugTextBuffer=e.createVertexBuffer(E,Sc.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(L,vp.members),this._tileDebugTextSegments=_o.simpleSegment(0,0,B,32)}}class __{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,l){const f=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},ke(this.stateChanges[e][f],l),null===this.deletedStates[e]){this.deletedStates[e]={};for(const _ in this.state[e])_!==f&&(this.deletedStates[e][_]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][f]){this.deletedStates[e][f]={};for(const _ in this.state[e][f])l[_]||(this.deletedStates[e][f][_]=null)}else for(const _ in l)this.deletedStates[e]&&this.deletedStates[e][f]&&null===this.deletedStates[e][f][_]&&delete this.deletedStates[e][f][_]}removeFeatureState(e,o,l){if(null===this.deletedStates[e])return;const f=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&void 0!==o)null!==this.deletedStates[e][f]&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][l]=null);else if(void 0!==o)if(this.stateChanges[e]&&this.stateChanges[e][f])for(l in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][l]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}getState(e,o){const l=String(o),f=ke({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const _=this.deletedStates[e][o];if(null===_)return{};for(const y in _)delete f[y]}return f}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){const l={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const _={};for(const y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),ke(this.state[f][y],this.stateChanges[f][y]),_[y]=this.state[f][y];l[f]=_}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const _={};if(null===this.deletedStates[f])for(const y in this.state[f])_[y]={},this.state[f][y]={};else for(const y in this.deletedStates[f]){if(null===this.deletedStates[f][y])this.state[f][y]={};else if(this.state[f][y])for(const w of Object.keys(this.deletedStates[f][y]))delete this.state[f][y][w];_[y]=this.state[f][y]}l[f]=l[f]||{},ke(l[f],_)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(l).length)for(const f in e)e[f].setFeatureState(l,o)}}class y_{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,o){const l=this.toIdx(e,o);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,o){return this.leaves[this.toIdx(e,o)]}toIdx(e,o){return o*this.size+e}}function ah(r,e,o,l){let f=0,_=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(l[y])<1e-15){if(o[y]<r[y]||o[y]>e[y])return null}else{const w=1/l[y];let E=(r[y]-o[y])*w,D=(e[y]-o[y])*w;if(E>D){const L=E;E=D,D=L}if(E>f&&(f=E),D<_&&(_=D),f>_)return null}return f}function Pu(r,e,o,l,f,_,y,w,E,D,L){const B=l-r,V=f-e,Y=_-o,Q=y-r,he=w-e,Ue=E-o,ot=L[1]*Ue-L[2]*he,bt=L[2]*Q-L[0]*Ue,st=L[0]*he-L[1]*Q,vt=B*ot+V*bt+Y*st;if(Math.abs(vt)<1e-15)return null;const St=1/vt,At=D[0]-r,un=D[1]-e,nn=D[2]-o,In=(At*ot+un*bt+nn*st)*St;if(In<0||In>1)return null;const Jn=un*Y-nn*V,hn=nn*B-At*Y,On=At*V-un*B,kn=(L[0]*Jn+L[1]*hn+L[2]*On)*St;return kn<0||In+kn>1?null:(Q*Jn+he*hn+Ue*On)*St}function Mf(r,e,o){return(r-e)/(o-e)}function vd(r,e,o,l,f,_,y,w,E){const D=1<<o,L=_-l,B=y-f,V=(r+1)/D*L+l,Y=(e+0)/D*B+f,Q=(e+1)/D*B+f;w[0]=(r+0)/D*L+l,w[1]=Y,E[0]=V,E[1]=Q}class Dm{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(_){const y=Math.ceil(Math.log2(_.dim/8)),w=[];let E=Math.ceil(Math.pow(2,y));const D=1/E,L=(Y,Q,he,Ue,ot)=>{const bt=Ue?1:0,st=(Y+1)*he-bt,vt=Q*he,St=(Q+1)*he-bt;ot[0]=Y*he,ot[1]=vt,ot[2]=st,ot[3]=St};let B=new y_(E);const V=[];for(let Y=0;Y<E*E;Y++){L(Y%E,Math.floor(Y/E),D,!1,V);const Q=ql(V[0],V[1],_),he=ql(V[2],V[1],_),Ue=ql(V[2],V[3],_),ot=ql(V[0],V[3],_);B.minimums.push(Math.min(Q,he,Ue,ot)),B.maximums.push(Math.max(Q,he,Ue,ot)),B.leaves.push(1)}for(w.push(B),E/=2;E>=1;E/=2){const Y=w[w.length-1];B=new y_(E);for(let Q=0;Q<E*E;Q++){L(Q%E,Math.floor(Q/E),2,!0,V);const he=Y.getElevation(V[0],V[1]),Ue=Y.getElevation(V[2],V[1]),ot=Y.getElevation(V[2],V[3]),bt=Y.getElevation(V[0],V[3]),st=Y.isLeaf(V[0],V[1]),vt=Y.isLeaf(V[2],V[1]),St=Y.isLeaf(V[2],V[3]),At=Y.isLeaf(V[0],V[3]),un=Math.min(he.min,Ue.min,ot.min,bt.min),nn=Math.max(he.max,Ue.max,ot.max,bt.max),In=st&&vt&&St&&At;B.maximums.push(nn),B.minimums.push(un),B.leaves.push(nn-un<=5&&In?1:0)}w.push(B)}return w}(this.dem),l=o.length-1,f=o[l];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(o,0,0,l,0)}raycastRoot(e,o,l,f,_,y,w=1){return ah([e,o,-100],[l,f,this.maximums[0]*w],_,y)}raycast(e,o,l,f,_,y,w=1){if(!this.nodeCount)return null;const E=this.raycastRoot(e,o,l,f,_,y,w);if(null==E)return null;const D=[],L=[],B=[],V=[],Y=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;Y.length>0;){const{idx:Q,t:he,nodex:Ue,nodey:ot,depth:bt}=Y.pop();if(this.leaves[Q]){vd(Ue,ot,bt,e,o,l,f,B,V);const vt=1<<bt,St=(Ue+0)/vt,At=(Ue+1)/vt,un=(ot+0)/vt,nn=(ot+1)/vt,In=ql(St,un,this.dem)*w,Jn=ql(At,un,this.dem)*w,hn=ql(At,nn,this.dem)*w,On=ql(St,nn,this.dem)*w,kn=Pu(B[0],B[1],In,V[0],B[1],Jn,V[0],V[1],hn,_,y),Gn=Pu(V[0],V[1],hn,B[0],V[1],On,B[0],B[1],In,_,y),ii=Math.min(null!==kn?kn:Number.MAX_VALUE,null!==Gn?Gn:Number.MAX_VALUE);if(ii!==Number.MAX_VALUE)return ii;{const En=Hu([],_,y,he);if(Af(In,Jn,On,hn,Mf(En[0],B[0],V[0]),Mf(En[1],B[1],V[1]))>=En[2])return he}continue}let st=0;for(let vt=0;vt<this._siblingOffset.length;vt++){vd((Ue<<1)+this._siblingOffset[vt][0],(ot<<1)+this._siblingOffset[vt][1],bt+1,e,o,l,f,B,V),B[2]=-100,V[2]=this.maximums[this.childOffsets[Q]+vt]*w;const St=ah(B,V,_,y);if(null!=St){const At=St;D[vt]=At;let un=!1;for(let nn=0;nn<st&&!un;nn++)At>=D[L[nn]]&&(L.splice(nn,0,vt),un=!0);un||(L[st]=vt),st++}}for(let vt=0;vt<st;vt++){const St=L[vt];Y.push({idx:this.childOffsets[Q]+St,t:D[St],nodex:(Ue<<1)+this._siblingOffset[St][0],nodey:(ot<<1)+this._siblingOffset[St][1],depth:bt+1})}}return null}_addNode(e,o,l){return this.minimums.push(e),this.maximums.push(o),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,o,l,f,_){if(1===e[f].isLeaf(o,l))return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const y=f-1,w=e[y];let E=0,D=0;for(let L=0;L<this._siblingOffset.length;L++){const B=2*o+this._siblingOffset[L][0],V=2*l+this._siblingOffset[L][1],Y=w.getElevation(B,V),Q=w.isLeaf(B,V),he=this._addNode(Y.min,Y.max,Q);Q&&(E|=1<<L),D||(D=he)}for(let L=0;L<this._siblingOffset.length;L++)E&1<<L||this._construct(e,2*o+this._siblingOffset[L][0],2*l+this._siblingOffset[L][1],y,D+L)}}function Af(r,e,o,l,f,_){return _i(_i(r,o,_),_i(e,l,_),f)}function ql(r,e,o){const l=o.dim,f=Xe(r*l-.5,0,l-1),_=Xe(e*l-.5,0,l-1),y=Math.floor(f),w=Math.floor(_),E=Math.min(y+1,l-1),D=Math.min(w+1,l-1);return Af(o.get(y,w),o.get(E,w),o.get(y,D),o.get(E,D),f-y,_-w)}const Sf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function v_(r,e,o){return(256*r*256+256*e+o)/10-1e4}function Im(r,e,o){return 256*r+e+o/256-32768}class Pf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,o,l,f=!1,_=!1){if(this.uid=e,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(l&&"mapbox"!==l&&"terrarium"!==l)return Dt(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const y=this.dim=o.height-2,w=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.encoding=l||"mapbox",this.borderReady=f,!f){for(let E=0;E<y;E++)w[this._idx(-1,E)]=w[this._idx(0,E)],w[this._idx(y,E)]=w[this._idx(y-1,E)],w[this._idx(E,-1)]=w[this._idx(E,0)],w[this._idx(E,y)]=w[this._idx(E,y-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(y,-1)]=w[this._idx(y-1,0)],w[this._idx(-1,y)]=w[this._idx(0,y-1)],w[this._idx(y,y)]=w[this._idx(y-1,y-1)],_&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Dm(this)}get(e,o,l=!1){l&&(e=Xe(e,-1,this.dim),o=Xe(o,-1,this.dim));const f=4*this._idx(e,o);return("terrarium"===this.encoding?Im:v_)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(e){return Sf[e]}get unpackVector(){return Sf[this.encoding]}_idx(e,o){if(e<-1||e>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(e+1)}static pack(e,o){const l=[0,0,0,0],f=Pf.getUnpackVector(o);let _=Math.floor((e+f[3])/f[2]);return l[2]=_%256,_=Math.floor(_/256),l[1]=_%256,_=Math.floor(_/256),l[0]=_,l}getPixels(){return new vs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,o,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let f=o*this.dim,_=o*this.dim+this.dim,y=l*this.dim,w=l*this.dim+this.dim;switch(o){case-1:f=_-1;break;case 1:_=f+1}switch(l){case-1:y=w-1;break;case 1:w=y+1}const E=-o*this.dim,D=-l*this.dim;for(let L=y;L<w;L++)for(let B=f;B<_;B++){const V=4*this._idx(B,L),Y=4*this._idx(B+E,L+D);this.pixels[V+0]=e.pixels[Y+0],this.pixels[V+1]=e.pixels[Y+1],this.pixels[V+2]=e.pixels[Y+2],this.pixels[V+3]=e.pixels[Y+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}yi(Pf,"DEMData"),yi(Dm,"DemMinMaxQuadTree",{omit:["dem"]});class mv{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(const e in this.data)for(const o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,l){const f=e.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const _={value:o,timeout:void 0};if(void 0!==l&&(_.timeout=setTimeout(()=>{this.remove(e,_)},l)),this.data[f].push(_),this.order.push(f),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){const o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;const l=e.wrapped().key,f=void 0===o?0:this.data[l].indexOf(o),_=this.data[l][f];return this.data[l].splice(f,1),_.timeout&&clearTimeout(_.timeout),0===this.data[l].length&&delete this.data[l],this.onRemove(_.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){const o=[];for(const l in this.data)for(const f of this.data[l])e(f.value)||o.push(f);for(const l of o)this.remove(l.value.tileID,l)}}class xd{constructor(e,o,l){this.func=e,this.mask=o,this.range=l}}xd.ReadOnly=!1,xd.ReadWrite=!0,xd.disabled=new xd(519,xd.ReadOnly,[0,1]);class Mm{constructor(e,o,l,f,_,y){this.test=e,this.ref=o,this.mask=l,this.fail=f,this.depthFail=_,this.pass=y}}Mm.disabled=new Mm({func:519,mask:0},0,0,7680,7680,7680);class Yl{constructor(e,o,l){this.blendFunction=e,this.blendColor=o,this.mask=l}}Yl.Replace=[1,0],Yl.disabled=new Yl(Yl.Replace,R.transparent,[!1,!1,!1,!1]),Yl.unblended=new Yl(Yl.Replace,R.transparent,[!0,!0,!0,!0]),Yl.alphaBlended=new Yl([1,771],R.transparent,[!0,!0,!0,!0]);class ul{constructor(e,o,l){this.enable=e,this.mode=o,this.frontFace=l}}ul.disabled=new ul(!1,1029,2305),ul.backCCW=new ul(!0,1029,2305),ul.backCW=new ul(!0,1029,2304),ul.frontCW=new ul(!0,1028,2304),ul.frontCCW=new ul(!0,1028,2305);class Gc extends wn{constructor(e,o,l){super(),this.id=e,this._onlySymbols=l,o.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new mv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new __,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const o=this._tiles[e];if("loaded"!==o.state&&"errored"!==o.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,o){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,o)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const l=this._tiles[o];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return $t(this._tiles).map(e=>e.tileID).sort(x_).map(e=>e.key)}getRenderableIds(e){const o=[];for(const l in this._tiles)this._isIdRenderable(+l,e)&&o.push(this._tiles[l]);return e?o.sort((l,f)=>{const _=l.tileID,y=f.tileID,w=new Ae(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),E=new Ae(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-y.overscaledZ||E.y-w.y||E.x-w.x}).map(l=>l.tileID.key):o.map(l=>l.tileID).sort(x_).map(l=>l.key)}hasRenderableParent(e){const o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,o){const l=this._tiles[e];l&&("loading"!==l.state&&(l.state=o),this._loadTile(l,this._tileLoaded.bind(this,l,e,o)))}_tileLoaded(e,o,l,f){if(f)if(e.state="errored",404!==f.status)this._source.fire(new Qt(f,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Kr.now(),"expired"===l&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Mt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const o=this.getRenderableIds();for(let f=0;f<o.length;f++){const _=o[f];if(e.neighboringTiles&&e.neighboringTiles[_]){const y=this.getTileByID(_);l(e,y),l(y,e)}}function l(f,_){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let y=_.tileID.canonical.x-f.tileID.canonical.x;const w=_.tileID.canonical.y-f.tileID.canonical.y,E=Math.pow(2,f.tileID.canonical.z),D=_.tileID.key;0===y&&0===w||Math.abs(w)>1||(Math.abs(y)>1&&(1===Math.abs(y+E)?y+=E:1===Math.abs(y-E)&&(y-=E)),_.dem&&f.dem&&(f.dem.backfillBorder(_.dem,y,w),f.neighboringTiles&&f.neighboringTiles[D]&&(f.neighboringTiles[D].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,l,f){for(const _ in this._tiles){let y=this._tiles[_];if(f[_]||!y.hasData()||y.tileID.overscaledZ<=o||y.tileID.overscaledZ>l)continue;let w=y.tileID;for(;y&&y.tileID.overscaledZ>o+1;){const D=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[D.key],y&&y.hasData()&&(w=D)}let E=w;for(;E.overscaledZ>o;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]){f[w.key]=w;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=o?l:null}for(let l=e.overscaledZ-1;l>=o;l--){const f=e.scaledTo(l),_=this._getLoadedTile(f);if(_)return _}}_getLoadedTile(e){const o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,o){o=o||this._source.tileSize;const l=Math.ceil(e.width/o)+1,f=Math.ceil(e.height/o)+1,_=Math.floor(l*f*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,_):_,w="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(w)}handleWrapJump(e){const o=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,o){const l={};for(const f in this._tiles){const _=this._tiles[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+o),l[_.tileID.key]=_}this._tiles=l;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(e,o,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let f;this.updateCacheSize(e,o),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new As(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(f=e.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(w=>this._source.hasTile(w)))):f=[];const _=this._updateRetainedTiles(f);if(b_(this._source.type)&&0!==f.length){const w={},E={},D=Object.keys(_);for(const B of D){const V=_[B],Y=this._tiles[B];if(!Y||Y.fadeEndTime&&Y.fadeEndTime<=Kr.now())continue;const Q=this.findLoadedParent(V,Math.max(V.overscaledZ-Gc.maxOverzooming,this._source.minzoom));Q&&(this._addTile(Q.tileID),w[Q.tileID.key]=Q.tileID),E[B]=V}const L=f[f.length-1].overscaledZ;for(const B in this._tiles){const V=this._tiles[B];if(_[B]||!V.hasData())continue;let Y=V.tileID;for(;Y.overscaledZ>L;){Y=Y.scaledTo(Y.overscaledZ-1);const Q=this._tiles[Y.key];if(Q&&Q.hasData()&&E[Y.key]){_[B]=V.tileID;break}}}for(const B in w)_[B]||(this._coveredTiles[B]=!0,_[B]=w[B])}for(const w in _)this._tiles[w].clearFadeHold();const y=function(w,E){const D=[];for(const L in w)L in E||D.push(L);return D}(this._tiles,_);for(const w of y){const E=this._tiles[w];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const o={};if(0===e.length)return o;const l={},f=e.reduce((D,L)=>Math.min(D,L.overscaledZ),1/0),_=e[0].overscaledZ,y=Math.max(_-Gc.maxOverzooming,this._source.minzoom),w=Math.max(_+Gc.maxUnderzooming,this._source.minzoom),E={};for(const D of e){const L=this._addTile(D);o[D.key]=D,L.hasData()||f<this._source.maxzoom&&(E[D.key]=D)}this._retainLoadedChildren(E,f,w,o);for(const D of e){let L=this._tiles[D.key];if(L.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const V=D.children(this._source.maxzoom)[0],Y=this.getTile(V);if(Y&&Y.hasData()){o[V.key]=V;continue}}else{const V=D.children(this._source.maxzoom);if(o[V[0].key]&&o[V[1].key]&&o[V[2].key]&&o[V[3].key])continue}let B=L.wasRequested();for(let V=D.overscaledZ-1;V>=y;--V){const Y=D.scaledTo(V);if(l[Y.key]||(l[Y.key]=!0,L=this.getTile(Y),!L&&B&&(L=this._addTile(Y)),L&&(o[Y.key]=Y,B=L.wasRequested(),L.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const o=[];let l,f=this._tiles[e].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){l=this._loadedParentTiles[f.key];break}o.push(f.key);const _=f.scaledTo(f.overscaledZ-1);if(l=this._getLoadedTile(_),l)break;f=_}for(const _ of o)this._loadedParentTiles[_]=l}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));const l=!!o;if(!l){const f=this.map?this.map.painter:null;o=new Zc(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,e.key,o.state))}return o?(o.uses++,this._tiles[e.key]=o,l||this._source.fire(new Mt("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=o.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&"reloading"!==o.state?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,o,l){const f=[],_=this.transform;if(!_)return f;const y="globe"===_.projection.name,w=Vl(_.center.lng);for(const E in this._tiles){const D=this._tiles[E];if(l&&D.clearQueryDebugViz(),D.holdingForFade())continue;let L;if(y){const B=D.tileID.canonical;if(0===B.z){const V=[Math.abs(Xe(w,...Ps(B,-1))-w),Math.abs(Xe(w,...Ps(B,1))-w)];L=[0,2*V.indexOf(Math.min(...V))-1]}else{const V=[Math.abs(Xe(w,...Ps(B,-1))-w),Math.abs(Xe(w,...Ps(B,0))-w),Math.abs(Xe(w,...Ps(B,1))-w)];L=[V.indexOf(Math.min(...V))-1]}}else L=[0];for(const B of L){const V=e.containsTile(D,_,o,B);V&&f.push(V)}}return f}getVisibleCoordinates(e){const o=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of o)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(b_(this._source.type))for(const e in this._tiles){const o=this._tiles[e];if(void 0!==o.fadeEndTime&&o.fadeEndTime>=Kr.now())return!0}return!1}setFeatureState(e,o,l){this._state.updateState(e=e||"_geojsonTileLayer",o,l)}removeFeatureState(e,o,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,l)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,l){const f=this._tiles[e];f&&f.setDependencies(o,l)}reloadTilesForDependencies(e,o){for(const l in this._tiles)this._tiles[l].hasDependency(e,o)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(e,o))}_preloadTiles(e,o){if(!this._sourceLoaded){const w=()=>{this._sourceLoaded&&(this._source.off("data",w),this._preloadTiles(e,o))};return void this._source.on("data",w)}const l=new Map,f=Array.isArray(e)?e:[e],_=this.map.painter.terrain,y=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const w of f){const E=w.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of E)l.set(D.key,D);this.usedForTerrain&&w.updateElevation(!1)}xn(Array.from(l.values()),(w,E)=>{const D=new Zc(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,L=>{"raster-dem"===this._source.type&&D.dem&&this._backfillDEM(D),E(L,D)})},o)}}function x_(r,e){const o=Math.abs(2*r.wrap)-+(r.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||l-o||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x}function b_(r){return"raster"===r||"image"===r||"video"===r||"custom"===r}function Ps(r,e){const o=1<<r.z;return[r.x/o+e,(r.x+1)/o+e]}Gc.maxOverzooming=10,Gc.maxUnderzooming=3;class Rf{constructor(e,o,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=o,this._offset=l}static create(e,o,l){const f=l||e.findDEMTileFor(o);if(!f||!f.dem)return;const _=f.dem,y=f.tileID,w=1<<o.canonical.z-y.canonical.z;return new Rf(f,f.tileSize/Ii/w,[(o.canonical.x/w-y.canonical.x)*_.dim,(o.canonical.y/w-y.canonical.y)*_.dim])}tileCoordToPixel(e,o){const l=o*this._scale+this._offset[1],f=Math.floor(e*this._scale+this._offset[0]),_=Math.floor(l);return new Ae(f,_)}getElevationAt(e,o,l,f){const _=e*this._scale+this._offset[0],y=o*this._scale+this._offset[1],w=Math.floor(_),E=Math.floor(y),D=this._dem;return f=!!f,l?_i(_i(D.get(w,E,f),D.get(w,E+1,f),y-E),_i(D.get(w+1,E,f),D.get(w+1,E+1,f),y-E),_-w):D.get(w,E,f)}getElevationAtPixel(e,o,l){return this._dem.get(e,o,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Na(1,e)*this._dem.stride}}class w_{constructor(e,o){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Er(Ii,16,0),this.featureIndexArray=new ru,this.promoteId=o}insert(e,o,l,f,_,y=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,f,_,y);const E=this.grid;for(let D=0;D<o.length;D++){const L=o[D],B=[1/0,1/0,-1/0,-1/0];for(let V=0;V<L.length;V++){const Y=L[V];B[0]=Math.min(B[0],Y.x),B[1]=Math.min(B[1],Y.y),B[2]=Math.max(B[2],Y.x),B[3]=Math.max(B[3],Y.y)}B[0]<Ii&&B[1]<Ii&&B[2]>=0&&B[3]>=0&&E.insert(w,B[0],B[1],B[2],B[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new qh(new bu(this.rawTileData)).layers,this.sourceLayerCoder=new m_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,o,l,f){this.loadVTLayers();const _=e.params||{},y=jr(_.filter),w=e.tileResult,E=e.transform,D=w.bufferedTilespaceBounds,L=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(Q,he,Ue,ot)=>Iy(w.bufferedTilespaceGeometry,Q,he,Ue,ot));L.sort(Pm);let B=null;E.elevation&&L.length>0&&(B=Rf.create(E.elevation,this.tileID));const V={};let Y;for(let Q=0;Q<L.length;Q++){const he=L[Q];if(he===Y)continue;Y=he;const Ue=this.featureIndexArray.get(he);let ot=null;this.loadMatchingFeature(V,Ue,y,_.layers,_.availableImages,o,l,f,(bt,st,vt,St=0)=>(ot||(ot=Zl(bt,this.tileID.canonical,e.tileTransform)),st.queryIntersectsFeature(w,bt,vt,ot,this.z,e.transform,e.pixelPosMatrix,B,St)))}return V}loadMatchingFeature(e,o,l,f,_,y,w,E,D){const{featureIndex:L,bucketIndex:B,sourceLayerIndex:V,layoutVertexArrayOffset:Y}=o,Q=this.bucketLayerIDs[B];if(f&&!function(bt,st){for(let vt=0;vt<bt.length;vt++)if(st.indexOf(bt[vt])>=0)return!0;return!1}(f,Q))return;const he=this.sourceLayerCoder.decode(V),Ue=this.vtLayers[he].feature(L);if(l.needGeometry){const bt=ll(Ue,!0);if(!l.filter(new N(this.tileID.overscaledZ),bt,this.tileID.canonical))return}else if(!l.filter(new N(this.tileID.overscaledZ),Ue))return;const ot=this.getId(Ue,he);for(let bt=0;bt<Q.length;bt++){const st=Q[bt];if(f&&f.indexOf(st)<0)continue;const vt=y[st];if(!vt)continue;let St={};void 0!==ot&&E&&(St=E.getState(vt.sourceLayer||"_geojsonTileLayer",ot));const At=ke({},w[st]);At.paint=gv(At.paint,vt.paint,Ue,St,_),At.layout=gv(At.layout,vt.layout,Ue,St,_);const un=!D||D(Ue,vt,St,Y);if(!un)continue;const nn=new pv(Ue,this.z,this.x,this.y,ot);nn.layer=At;let In=e[st];void 0===In&&(In=e[st]=[]),In.push({featureIndex:L,feature:nn,intersectionZ:un})}}lookupSymbolFeatures(e,o,l,f,_,y,w,E){const D={};this.loadVTLayers();const L=jr(_);for(const B of e)this.loadMatchingFeature(D,{bucketIndex:l,sourceLayerIndex:f,featureIndex:B,layoutVertexArrayOffset:0},L,y,w,E,o);return D}loadFeature(e){const{featureIndex:o,sourceLayerIndex:l}=e;this.loadVTLayers();const f=this.sourceLayerCoder.decode(l),_=this.vtFeatures[f];if(_[o])return _[o];const y=this.vtLayers[f].feature(o);return _[o]=y,y}hasLayer(e){for(const o of this.bucketLayerIDs)for(const l of o)if(e===l)return!0;return!1}getId(e,o){let l=e.id;if(this.promoteId){const f="string"==typeof this.promoteId?this.promoteId:this.promoteId[o];null!=f&&(l=e.properties[f]),"boolean"==typeof l&&(l=Number(l))}return l}}function gv(r,e,o,l,f){return fn(r,(_,y)=>{const w=e instanceof nt?e.get(y):null;return w&&w.evaluate?w.evaluate(o,l,f):w})}function Pm(r,e){return e-r}yi(w_,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Om{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.image=new Gl({width:e,height:o}),this.positions={},this.uploaded=!1}getDash(e,o){const l=this.getKey(e,o);return this.positions[l]}trim(){const e=this.width,o=this.height=it(this.nextRow);this.image.resize({width:e,height:o})}getKey(e,o){return e.join(",")+o}getDashRanges(e,o,l){const f=[];let _=e.length%2==1?-e[e.length-1]*l:0,y=e[0]*l,w=!0;f.push({left:_,right:y,isDash:w,zeroLength:0===e[0]});let E=e[0];for(let D=1;D<e.length;D++){w=!w;const L=e[D];_=E*l,E+=L,y=E*l,f.push({left:_,right:y,isDash:w,zeroLength:0===L})}return f}addRoundDash(e,o,l){const f=o/2;for(let _=-l;_<=l;_++){const y=this.width*(this.nextRow+l+_);let w=0,E=e[w];for(let D=0;D<this.width;D++){D/E.right>1&&(E=e[++w]);const L=Math.abs(D-E.left),B=Math.abs(D-E.right),V=Math.min(L,B);let Y;const Q=_/l*(f+1);if(E.isDash){const he=f-Math.abs(Q);Y=Math.sqrt(V*V+he*he)}else Y=f-Math.sqrt(V*V+Q*Q);this.image.data[y+D]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(e,o){for(let E=e.length-1;E>=0;--E){const D=e[E],L=e[E+1];D.zeroLength?e.splice(E,1):L&&L.isDash===D.isDash&&(L.left=D.left,e.splice(E,1))}const l=e[0],f=e[e.length-1];l.isDash===f.isDash&&(l.left=f.left-this.width,f.right=l.right+this.width);const _=this.width*this.nextRow;let y=0,w=e[y];for(let E=0;E<this.width;E++){E/w.right>1&&(w=e[++y]);const D=Math.abs(E-w.left),L=Math.abs(E-w.right),B=Math.min(D,L);this.image.data[_+E]=Math.max(0,Math.min(255,(w.isDash?B:-B)+o+128))}}addDash(e,o){const l=this.getKey(e,o);if(this.positions[l])return this.positions[l];const f="round"===o,_=f?7:0,y=2*_+1;if(this.nextRow+y>this.height)return Dt("LineAtlas out of space"),null;0===e.length&&e.push(1);let w=0;for(let L=0;L<e.length;L++)e[L]<0&&(Dt("Negative value is found in line dasharray, replacing values with 0"),e[L]=0),w+=e[L];if(0!==w){const L=this.width/w,B=this.getDashRanges(e,this.width,L);f?this.addRoundDash(B,L,_):this.addRegularDash(B,"square"===o?.5*L:0)}const E=this.nextRow+_;this.nextRow+=y;const D={tl:[E,_],br:[w,0]};return this.positions[l]=D,D}}yi(Om,"LineAtlas");const C_=1*Dl;class E_{constructor(e){const o={},l=[];for(const w in e){const E=e[w],D=o[w]={};for(const L in E.glyphs){const B=E.glyphs[+L];if(!B||0===B.bitmap.width||0===B.bitmap.height)continue;const V=B.metrics.localGlyph?C_:1,Y={x:0,y:0,w:B.bitmap.width+2*V,h:B.bitmap.height+2*V};l.push(Y),D[L]=Y}}const{w:f,h:_}=lm(l),y=new Gl({width:f||1,height:_||1});for(const w in e){const E=e[w];for(const D in E.glyphs){const L=E.glyphs[+D];if(!L||0===L.bitmap.width||0===L.bitmap.height)continue;const B=o[w][D],V=L.metrics.localGlyph?C_:1;Gl.copy(L.bitmap,y,{x:0,y:0},{x:B.x+V,y:B.y+V},L.bitmap)}}this.image=y,this.positions=o}}yi(E_,"GlyphAtlas");class _v{constructor(e){this.tileID=new As(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=gc(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,o,l,f,_){this.status="parsing",this.data=e,this.collisionBoxArray=new Zr;const y=new m_(Object.keys(e.layers).sort()),w=new w_(this.tileID,this.promoteId);w.bucketLayerIDs=[];const E={},D=new Om(256,256),L={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:l},B=o.familiesBySource[this.source];for(const St in B){const At=e.layers[St];if(!At)continue;let un=!1,nn=!1;for(const hn of B[St])"symbol"===hn[0].type?un=!0:nn=!0;if(!0===this.isSymbolTile&&!un||!1===this.isSymbolTile&&!nn)continue;1===At.version&&Dt(`Vector tile source "${this.source}" layer "${St}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const In=y.encode(St),Jn=[];for(let hn=0;hn<At.length;hn++){const On=At.feature(hn),kn=w.getId(On,St);Jn.push({feature:On,id:kn,index:hn,sourceLayerIndex:In})}for(const hn of B[St]){const On=hn[0];void 0!==this.isSymbolTile&&"symbol"===On.type!==this.isSymbolTile||On.minzoom&&this.zoom<Math.floor(On.minzoom)||On.maxzoom&&this.zoom>=On.maxzoom||"none"!==On.visibility&&(Lf(hn,this.zoom,l),(E[On.id]=On.createBucket({index:w.bucketLayerIDs.length,layers:hn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:In,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:l})).populate(Jn,L,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push(hn.map(kn=>kn.id)))}}let V,Y,Q,he;D.trim();const Ue={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ot=()=>{if(V)return _(V);if(Y&&Q&&he){const St=new E_(Y),At=new Jg(Q,he);for(const un in E){const nn=E[un];nn instanceof Vc?(Lf(nn.layers,this.zoom,l),yf(nn,Y,St.positions,Q,At.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection)):nn.hasPattern&&(nn instanceof tf||nn instanceof jd||nn instanceof sd)&&(Lf(nn.layers,this.zoom,l),nn.addFeatures(L,this.tileID.canonical,At.patternPositions,l,this.tileTransform))}this.status="done",_(null,{buckets:$t(E).filter(un=>!un.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:St.image,lineAtlas:D,imageAtlas:At,glyphMap:this.returnDependencies?Y:null,iconMap:this.returnDependencies?Q:null,glyphPositions:this.returnDependencies?St.positions:null})}},bt=fn(L.glyphDependencies,St=>Object.keys(St).map(Number));Object.keys(bt).length?f.send("getGlyphs",{uid:this.uid,stacks:bt},(St,At)=>{V||(V=St,Y=At,ot())},void 0,!1,Ue):Y={};const st=Object.keys(L.iconDependencies);st.length?f.send("getImages",{icons:st,source:this.source,tileID:this.tileID,type:"icons"},(St,At)=>{V||(V=St,Q=At,ot())},void 0,!1,Ue):Q={};const vt=Object.keys(L.patternDependencies);vt.length?f.send("getImages",{icons:vt,source:this.source,tileID:this.tileID,type:"patterns"},(St,At)=>{V||(V=St,he=At,ot())},void 0,!1,Ue):he={},ot()}}function Lf(r,e,o){const l=new N(e);for(const f of r)f.recalculate(l,o)}class T_{constructor(e){this.entries={},this.scheduler=e}request(e,o,l,f){const _=this.entries[e]=this.entries[e]||{callbacks:[]};if(_.result){const[y,w]=_.result;return this.scheduler?this.scheduler.add(()=>{f(y,w)},o):f(y,w),()=>{}}return _.callbacks.push(f),_.cancel||(_.cancel=l((y,w)=>{_.result=[y,w];for(const E of _.callbacks)this.scheduler?this.scheduler.add(()=>{E(y,w)},o):E(y,w);setTimeout(()=>delete this.entries[e],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(y=>y!==f),_.callbacks.length||(_.cancel(),delete this.entries[e]))}}}function D_(r,e,o){const l=JSON.stringify(r.request);return r.data&&(this.deduped.entries[l]={result:[null,r.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},f=>{const _=Cn(r.request,(y,w,E,D)=>{y?f(y):w&&f(null,{vectorTile:o?void 0:new qh(new bu(w)),rawData:w,cacheControl:E,expires:D})});return()=>{_.cancel(),f()}},e)}const kf=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Rm{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,l]=new Uint8Array(e,0,2);if(219!==o)throw new Error("Data does not appear to be in a KDBush format.");const f=l>>4;if(1!==f)throw new Error(`Got v${f} data when expected v1.`);const _=kf[15&l];if(!_)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new Rm(w,y,_,e)}constructor(e,o=64,l=Float64Array,f){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const _=kf.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-w%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${l}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+E,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+w+E),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+E,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=e)}add(e,o){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=o,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Lm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,o,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:y,nodeSize:w}=this,E=[0,_.length-1,0],D=[];for(;E.length;){const L=E.pop()||0,B=E.pop()||0,V=E.pop()||0;if(B-V<=w){for(let Ue=V;Ue<=B;Ue++){const ot=y[2*Ue],bt=y[2*Ue+1];ot>=e&&ot<=l&&bt>=o&&bt<=f&&D.push(_[Ue])}continue}const Y=V+B>>1,Q=y[2*Y],he=y[2*Y+1];Q>=e&&Q<=l&&he>=o&&he<=f&&D.push(_[Y]),(0===L?e<=Q:o<=he)&&(E.push(V),E.push(Y-1),E.push(1-L)),(0===L?l>=Q:f>=he)&&(E.push(Y+1),E.push(B),E.push(1-L))}return D}within(e,o,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:_,nodeSize:y}=this,w=[0,f.length-1,0],E=[],D=l*l;for(;w.length;){const L=w.pop()||0,B=w.pop()||0,V=w.pop()||0;if(B-V<=y){for(let Ue=V;Ue<=B;Ue++)Ml(_[2*Ue],_[2*Ue+1],e,o)<=D&&E.push(f[Ue]);continue}const Y=V+B>>1,Q=_[2*Y],he=_[2*Y+1];Ml(Q,he,e,o)<=D&&E.push(f[Y]),(0===L?e-l<=Q:o-l<=he)&&(w.push(V),w.push(Y-1),w.push(1-L)),(0===L?e+l>=Q:o+l>=he)&&(w.push(Y+1),w.push(B),w.push(1-L))}return E}}function Lm(r,e,o,l,f,_){if(f-l<=o)return;const y=l+f>>1;I_(r,e,y,l,f,_),Lm(r,e,o,l,y-1,1-_),Lm(r,e,o,y+1,f,1-_)}function I_(r,e,o,l,f,_){for(;f>l;){if(f-l>600){const D=f-l+1,L=o-l+1,B=Math.log(D),V=.5*Math.exp(2*B/3),Y=.5*Math.sqrt(B*V*(D-V)/D)*(L-D/2<0?-1:1);I_(r,e,o,Math.max(l,Math.floor(o-L*V/D+Y)),Math.min(f,Math.floor(o+(D-L)*V/D+Y)),_)}const y=e[2*o+_];let w=l,E=f;for(lh(r,e,l,o),e[2*f+_]>y&&lh(r,e,l,f);w<E;){for(lh(r,e,w,E),w++,E--;e[2*w+_]<y;)w++;for(;e[2*E+_]>y;)E--}e[2*l+_]===y?lh(r,e,l,E):(E++,lh(r,e,E,f)),E<=o&&(l=E+1),o<=E&&(f=E-1)}}function lh(r,e,o,l){km(r,o,l),km(e,2*o,2*l),km(e,2*o+1,2*l+1)}function km(r,e,o){const l=r[e];r[e]=r[o],r[o]=l}function Ml(r,e,o,l){const f=r-o,_=e-l;return f*f+_*_}a.ARRAY_TYPE=ua,a.AUTH_ERR_MSG=yt,a.Aabb=_s,a.Actor=class{constructor(r,e,o){this.target=r,this.parent=e,this.mapId=o,this.callbacks={},this.cancelCallbacks={},Kt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=on()?r:j,this.scheduler=new fv}send(r,e,o,l,f=!1,_){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=_,this.callbacks[y]=o);const w=Ut(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:r,hasCallback:!!o,targetMapId:l,mustQueue:f,sourceMapId:this.mapId,data:nl(e,w)},w),{cancel:()=>{o&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(r){const e=r.data,o=e.id;if(o&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const l=this.cancelCallbacks[o];delete this.cancelCallbacks[o],l&&l.cancel()}else if(e.mustQueue||on()){const l=this.callbacks[o];this.cancelCallbacks[o]=this.scheduler.add(()=>this.processTask(o,e),l&&l.metadata||{type:"message"})}else this.processTask(o,e)}processTask(r,e){if("<response>"===e.type){const o=this.callbacks[r];delete this.callbacks[r],o&&(e.error?o(wl(e.error)):o(null,wl(e.data)))}else{const o=Ut(this.globalScope)?void 0:[],l=e.hasCallback?(_,y)=>{delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:_?nl(_):null,data:nl(y,o)},o)}:_=>{},f=wl(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,f,l);else if(this.parent.getWorkerSource){const _=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,_[0],f.source)[_[1]](f,l)}else l(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=zc,a.Color=R,a.ColorMode=Yl,a.CullFaceMode=ul,a.DEMData=Pf,a.DataConstantProperty=ce,a.DedupedRequest=T_,a.DepthMode=xd,a.EXTENT=Ii,a.Elevation=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const o=e.getSource().maxzoom,l=1<<o,f=Math.floor(r.x),_=Math.floor((r.x-f)*l),y=Math.floor(r.y*l),w=this.findDEMTileFor(new As(o,f,o,_,y));return!(!w||!w.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,o=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const l=this._source();if(!l||r.y<0||r.y>1)return e;const f=l.getSource().maxzoom,_=1<<f,y=Math.floor(r.x),w=r.x-y,E=new As(f,y,f,Math.floor(w*_),Math.floor(r.y*_)),D=this.findDEMTileFor(E);if(!D||!D.dem)return e;const L=D.dem,B=1<<D.tileID.canonical.z,V=(w*B-D.tileID.canonical.x)*L.dim,Y=(r.y*B-D.tileID.canonical.y)*L.dim,Q=Math.floor(V),he=Math.floor(Y);return(o?this.exaggeration():1)*_i(_i(L.get(Q,he),L.get(Q,he+1),Y-he),_i(L.get(Q+1,he),L.get(Q+1,he+1),Y-he),V-Q)}getAtTileOffset(r,e,o){const l=1<<r.canonical.z;return this.getAtPointOrZero(new Lc(r.wrap+(r.canonical.x+e/Ii)/l,(r.canonical.y+o/Ii)/l))}getAtTileOffsetFunc(r,e,o,l){return f=>{const _=this.getAtTileOffset(r,f.x,f.y),y=l.upVector(r.canonical,f.x,f.y);return Js(y,y,_*l.upVectorScale(r.canonical,e,o).metersToTile),y}}getForTilePoints(r,e,o,l){if(this.isUsingMockSource())return!1;const f=Rf.create(this,r,l);return!!f&&(e.forEach(_=>{_[2]=this.exaggeration()*f.getElevationAt(_[0],_[1],o)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const o=e.dem.tree,l=e.tileID,f=1<<r.canonical.z-l.canonical.z;let _=r.canonical.x/f-l.canonical.x,y=r.canonical.y/f-l.canonical.y,w=0;for(let E=0;E<r.canonical.z-l.canonical.z&&!o.leaves[w];E++){_*=2,y*=2;const D=2*Math.floor(y)+Math.floor(_);w=o.childOffsets[w]+D,_%=1,y%=1}return{min:this.exaggeration()*o.minimums[w],max:this.exaggeration()*o.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,o){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=Qt,a.EvaluationParameters=N,a.Event=Mt,a.Evented=wn,a.FillExtrusionBucket=sd,a.Frustum=xp,a.FrustumCorners=Od,a.GLOBE_RADIUS=Xs,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=bp,a.GLOBE_ZOOM_THRESHOLD_MIN=Ah,a.GlobeSharedBuffers=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const r of this._wireframeSegments)r.destroy()}}_fillGridMeshWithLods(r,e){const o=new Yn,l=new Di,f=[],_=r+1+2,y=e[0]+1,w=e[0]+1+(1+e.length),E=(D,L,B)=>{let V=D===_-1?D-2:0===D?D:D-1;return V+=B?24575:0,[V,L]};for(let D=0;D<_;++D)o.emplaceBack(...E(D,0,!0));for(let D=0;D<y;++D)for(let L=0;L<_;++L)o.emplaceBack(...E(L,D,(0===L||L===_-1)&&!0));for(let D=0;D<e.length;++D){const L=e[D];for(let B=0;B<_;++B)o.emplaceBack(...E(B,L,!0))}for(let D=0;D<e.length;++D){const L=l.length,B=e[D]+1+2,V=new Di;for(let he=0;he<B-1;he++){const Ue=he===B-2,ot=Ue?_*(w-e.length+D-he):_;for(let bt=0;bt<_-1;bt++){const st=he*_+bt;0===he||Ue||0===bt||bt===_-2?(V.emplaceBack(st+1,st,st+ot),V.emplaceBack(st+ot,st+ot+1,st+1)):(l.emplaceBack(st+1,st,st+ot),l.emplaceBack(st+ot,st+ot+1,st+1))}}const Y=_o.simpleSegment(0,L,o.length,l.length-L);for(let he=0;he<V.uint16.length;he+=3)l.emplaceBack(V.uint16[he],V.uint16[he+1],V.uint16[he+2]);const Q=_o.simpleSegment(0,L,o.length,l.length-L);f.push({withoutSkirts:Y,withSkirts:Q})}return{vertices:o,indices:l,segments:f}}_createGrid(r){const e=this._fillGridMeshWithLods(64,Pc);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,Sc.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new Di;for(let f=0;f<=64;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const o=new $r,l=new $r;this._poleSegments=[];for(let f=0,_=0;f<Ah;f++){const y=360/(1<<f);o.emplaceBack(0,-Xs,0,.5,0),l.emplaceBack(0,-Xs,0,.5,1);for(let w=0;w<=64;w++){const E=w/64,D=_i(0,y,E),[L,B,V]=Wu(Tg,al,D,Xs);o.emplaceBack(L,B,V,E,0),l.emplaceBack(L,B,V,E,1)}this._poleSegments.push(_o.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(o,yp,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(l,yp,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}getWirefameBuffers(r,e){if(!this._wireframeSegments){const o=new oo,l=64,f=l+1+2,_=1;this._wireframeSegments=[];for(let y=0,w=0;y<Pc.length;y++){const E=Pc[y];for(let L=_;L<E+_;L++)for(let B=_;B<l+_;B++){const V=L*f+B;o.emplaceBack(V,V+1),o.emplaceBack(V,V+f),o.emplaceBack(V,V+f+1)}const D=E*l*3;this._wireframeSegments.push(_o.simpleSegment(0,w,(E+1)*f,D)),w+=D}this._wireframeIndexBuffer=r.createIndexBuffer(o)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},a.GlyphManager=Tu,a.ImagePosition=lf,a.KDBush=Rm,a.LivePerformanceUtils=Do,a.LngLat=Gr,a.LngLatBounds=Ul,a.LocalGlyphMode=eh,a.MAX_MERCATOR_LATITUDE=ys,a.MercatorCoordinate=Lc,a.ONE_EM=yo,a.OverscaledTileID=As,a.PerformanceMarkers=ho,a.Point=Ae,a.Properties=gt,a.RGBAImage=vs,a.Ray=xg,a.RequestManager=class{constructor(r,e,o){this._transformRequestFn=r,this._customAccessToken=e,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const r=function(){let e="";for(let o=0;o<10;o++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",me,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,e){return this._transformRequestFn&&this._transformRequestFn(r,e)||{url:r}}normalizeStyleURL(r,e){if(!Ot(r))return r;const o=mn(r);return o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||e)}normalizeGlyphsURL(r,e){if(!Ot(r))return r;const o=mn(r);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||e)}normalizeSourceURL(r,e,o,l){if(!Ot(r))return r;const f=mn(r);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),o&&f.params.push(`language=${o}`),l&&f.params.push(`worldview=${l}`),this._makeAPIURL(f,this._customAccessToken||e)}normalizeSpriteURL(r,e,o,l){const f=mn(r);return Ot(r)?(f.path=`/styles/v1${f.path}/sprite${e}${o}`,this._makeAPIURL(f,this._customAccessToken||l)):(f.path+=`${e}${o}`,ae(f))}normalizeTileURL(r,e,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!Ot(r))return r;const l=mn(r);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||o&&"raster"!==l.authority&&512===o?"@2x":""}${_e.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${oe.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${oe.TILE_URL_VERSION}${l.path}`);const f=this._customAccessToken||function(_){for(const y of _){const w=y.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(l.params)||oe.ACCESS_TOKEN;return oe.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,f)}canonicalizeTileURL(r,e){const o=mn(r);if(!o.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!o.path.match(/\.[\w]+$/))return r;let l="mapbox://";o.path.match(/^\/raster\/v1\//)?l+=`raster/${o.path.replace(`/${oe.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${o.path.replace(`/${oe.TILE_URL_VERSION}/`,"")}`;let f=o.params;return e&&(f=f.filter(_=>!_.match(/^access_token=/))),f.length&&(l+=`?${f.join("&")}`),l}canonicalizeTileset(r,e){const o=!!e&&Ot(e),l=[];for(const f of r.tiles||[])Gt(f)?l.push(this.canonicalizeTileURL(f,o)):l.push(f);return l}_makeAPIURL(r,e){const o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=mn(oe.API_URL);if(r.protocol=l.protocol,r.authority=l.authority,"http"===r.protocol){const f=r.params.indexOf("secure");f>=0&&r.params.splice(f,1)}if("/"!==l.path&&(r.path=`${l.path}${r.path}`),!oe.REQUIRE_ACCESS_TOKEN)return ae(r);if(e=e||oe.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return r.params=r.params.filter(f=>-1===f.indexOf("access_token")),r.params.push(`access_token=${e||""}`),ae(r)}},a.ResourceType=_n,a.SegmentVector=_o,a.SourceCache=Gc,a.StencilMode=Mm,a.StructArrayLayout1ui2=wa,a.StructArrayLayout2f1f2i16=Si,a.StructArrayLayout2i4=Yn,a.StructArrayLayout2ui4=oo,a.StructArrayLayout3f12=tr,a.StructArrayLayout3ui6=Di,a.StructArrayLayout4i8=Pn,a.StructArrayLayout5f20=$r,a.Texture=sh,a.Tile=Zc,a.Transitionable=re,a.Uniform1f=uc,a.Uniform1i=class extends Ea{constructor(r){super(r),this.current=0}set(r,e,o){this.fetchUniformLocation(r,e)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},a.Uniform2f=class extends Ea{constructor(r){super(r),this.current=[0,0]}set(r,e,o){this.fetchUniformLocation(r,e)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}},a.Uniform3f=class extends Ea{constructor(r){super(r),this.current=[0,0,0]}set(r,e,o){this.fetchUniformLocation(r,e)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}},a.Uniform4f=au,a.UniformColor=dp,a.UniformMatrix2f=class extends Ea{constructor(r){super(r),this.current=j0}set(r,e,o){if(this.fetchUniformLocation(r,e))for(let l=0;l<4;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}},a.UniformMatrix3f=class extends Ea{constructor(r){super(r),this.current=zu}set(r,e,o){if(this.fetchUniformLocation(r,e))for(let l=0;l<9;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}},a.UniformMatrix4f=class extends Ea{constructor(r){super(r),this.current=hp}set(r,e,o){if(this.fetchUniformLocation(r,e)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let l=1;l<16;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}},a.UnwrappedTileID=Ug,a.ValidationError=fi,a.VectorTileFeature=Hl,a.VectorTileWorkerSource=class extends wn{constructor(r,e,o,l,f){super(),this.actor=r,this.layerIndex=e,this.availableImages=o,this.loadVectorData=f||D_,this.loading={},this.loaded={},this.deduped=new T_(r.scheduler),this.isSpriteLoaded=l,this.scheduler=r.scheduler}loadTile(r,e){const o=r.uid,l=r&&r.request,f=l&&l.collectResourceTiming,_=this.loading[o]=new _v(r);_.abort=this.loadVectorData(r,(y,w)=>{const E=!this.loading[o];if(delete this.loading[o],E||y||!w)return _.status="done",E||(this.loaded[o]=_),e(y);const D=w.rawData,L={};w.expires&&(L.expires=w.expires),w.cacheControl&&(L.cacheControl=w.cacheControl),_.vectorTile=w.vectorTile||new qh(new bu(D));const B=()=>{_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,(V,Y)=>{if(V||!Y)return e(V);const Q={};if(f){const he=ao(l);he.length>0&&(Q.resourceTiming=JSON.parse(JSON.stringify(he)))}e(null,ke({rawTileData:D.slice(0)},Y,L,Q))})};this.isSpriteLoaded?B():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(B,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):B()}),this.loaded=this.loaded||{},this.loaded[o]=_})}reloadTile(r,e){const o=this.loaded,l=r.uid,f=this;if(o&&o[l]){const _=o[l];_.showCollisionBoxes=r.showCollisionBoxes,_.enableTerrain=!!r.enableTerrain,_.projection=r.projection,_.tileTransform=gc(r.tileID.canonical,r.projection);const y=(w,E)=>{const D=_.reloadCallback;D&&(delete _.reloadCallback,_.parse(_.vectorTile,f.layerIndex,this.availableImages,f.actor,D)),e(w,E)};"parsing"===_.status?_.reloadCallback=y:"done"===_.status&&(_.vectorTile?_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(r,e){const o=r.uid,l=this.loading[o];l&&(l.abort&&l.abort(),delete this.loading[o]),e()}removeTile(r,e){const o=this.loaded,l=r.uid;o&&o[l]&&delete o[l],e()}},a.WritingMode=za,a.ZoomDependentExpression=fs,a.add=hc,a.addDynamicAttributes=Cf,a.adjoint=function(r,e){var o=e[0],l=e[1],f=e[2],_=e[3],y=e[4],w=e[5],E=e[6],D=e[7],L=e[8];return r[0]=y*L-w*D,r[1]=f*D-l*L,r[2]=l*w-f*y,r[3]=w*E-_*L,r[4]=o*L-f*E,r[5]=f*_-o*w,r[6]=_*D-y*E,r[7]=l*E-o*D,r[8]=o*y-l*_,r},a.asyncAll=xn,a.bezier=Se,a.bindAll=Kt,a.boundsAttributes=Em,a.bufferConvexPolygon=function(r,e){const o=[];for(let l=0;l<r.length;l++){const f=cn(l-1,-1,r.length-1),_=cn(l+1,-1,r.length-1),y=r[l],w=r[_],E=r[f].sub(y).unit(),D=w.sub(y).unit(),L=D.angleWithSep(E.x,E.y),B=E.add(D).unit().mult(-1*e/Math.sin(L/2));o.push(y.add(B))}return o},a.cacheEntryPossiblyAdded=function(r){Wi++,Wi>Tn&&(r.getActor().send("enforceCacheSizeLimit",Xt),Wi=0)},a.calculateGlobeLabelMatrix=function(r,e){const{x:o,y:l}=r.point,f=Tp(o,l,r.worldSize/r._pixelsPerMercatorPixel,0,0);return Vu(f,f,Ep(jl(e)))},a.calculateGlobeMatrix=function(r){const{x:e,y:o}=r.point,{lng:l,lat:f}=r._center;return Tp(e,o,r.worldSize,l,f)},a.calculateGlobeMercatorMatrix=function(r){const e=r.pixelsPerMeter,o=e/Na(1,r.center.lat),l=ka(new Float64Array(16));return $u(l,l,[r.point.x,r.point.y,0]),uu(l,l,[o,o,e]),Float32Array.from(l)},a.circumferenceAtLatitude=_u,a.clamp=Xe,a.clearTileCache=function(r){if(!Oi())return;const e=j.caches.delete(Nt);r&&e.catch(r).then(()=>r())},a.clipLine=fd,a.clone=function(r){var e=new ua(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},a.clone$1=li,a.collisionCircleLayout=Xy,a.config=oe,a.conjugate=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},a.create=function(){var r=new ua(16);return ua!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},a.create$1=_y,a.createExpression=hs,a.createLayout=Wt,a.createStyleLayer=function(r){return"custom"===r.type?new $c(r):new p_[r.type](r)},a.cross=Ac,a.degToRad=ne,a.distance=function(r,e){return Math.hypot(e[0]-r[0],e[1]-r[1],e[2]-r[2])},a.div=function(r,e,o){return r[0]=e[0]/o[0],r[1]=e[1]/o[1],r[2]=e[2]/o[2],r},a.dot=rl,a.earthRadius=gu,a.ease=Ve,a.easeCubicInOut=je,a.ecefToLatLng=function([r,e,o]){const l=Math.hypot(r,e,o),f=Math.atan2(r,o),_=.5*Math.PI-Math.acos(-e/l);return new Gr(Ee(f),Ee(_))},a.emitValidationErrors=Nn,a.endsWith=Mn,a.enforceCacheSizeLimit=function(r){gr(),oi&&oi.then(e=>{e.keys().then(o=>{for(let l=0;l<o.length-r;l++)e.delete(o[l])})})},a.evaluateSizeForFeature=tm,a.evaluateSizeForZoom=qd,a.evaluateVariableOffset=r_,a.evented=v,a.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},a.exactEquals$1=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]},a.exported=Kr,a.exported$1=_e,a.extend=ke,a.extend$1=Xn,a.fillExtrusionHeightLift=qp,a.filterObject=qn,a.fromMat4=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},a.fromQuat=function(r,e){var o=e[0],l=e[1],f=e[2],_=e[3],y=o+o,w=l+l,E=f+f,D=o*y,L=l*y,B=l*w,V=f*y,Y=f*w,Q=f*E,he=_*y,Ue=_*w,ot=_*E;return r[0]=1-B-Q,r[1]=L+ot,r[2]=V-Ue,r[3]=0,r[4]=L-ot,r[5]=1-D-Q,r[6]=Y+he,r[7]=0,r[8]=V+Ue,r[9]=Y-he,r[10]=1-D-B,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},a.fromRotation=function(r,e){var o=Math.sin(e),l=Math.cos(e);return r[0]=l,r[1]=o,r[2]=0,r[3]=-o,r[4]=l,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},a.fromScaling=pg,a.furthestTileCorner=function(r){const e=Math.round((r+45+360)%360/90)%4;return xe[e]},a.getAABBPointSquareDist=function(r,e,o){let l=0;for(let f=0;f<2;++f){const _=o?o[f]:0;r[f]>_&&(l+=(r[f]-_)*(r[f]-_)),e[f]<_&&(l+=(_-e[f])*(_-e[f]))}return l},a.getAnchorAlignment=Kd,a.getAnchorJustification=pm,a.getBounds=function(r){let e=1/0,o=1/0,l=-1/0,f=-1/0;for(const _ of r)e=Math.min(e,_.x),o=Math.min(o,_.y),l=Math.max(l,_.x),f=Math.max(f,_.y);return{min:new Ae(e,o),max:new Ae(l,f)}},a.getColumn=qe,a.getDefaultExportFromCjs=Ye,a.getGridMatrix=function(r,e,o,l){const f=e.getNorth(),_=e.getSouth(),y=e.getWest(),w=e.getEast(),E=1<<r.z,D=w-y,L=f-_,B=D/64,V=-L/Pc[o],Y=[0,B,0,V,0,0,f,y,0];if(r.z>0){const Q=180/l;Ta(Y,Y,[Q/D+1,0,0,0,Q/L+1,0,-.5*Q/B,.5*Q/V,1])}return Y[2]=E,Y[5]=r.x,Y[8]=r.y,Y},a.getImage=tt,a.getJSON=function(r,e){return sn(ke(r,{type:"json"}),e)},a.getLatitudinalLod=function(r){const e=ys-5;r=Xe(r,-e,e)/e*90;const o=Math.pow(Math.abs(Math.sin(ne(r))),3);return Math.round(o*(Pc.length-1))},a.getMapSessionAPI=Ui,a.getPerformanceMeasurement=ao,a.getProjection=vm,a.getRTLTextPluginStatus=b,a.getReferrer=pn,a.getTilePoint=function(r,{x:e,y:o},l=0){return new Ae(((e-l)*r.scale-r.x)*Ii,(o*r.scale-r.y)*Ii)},a.getTileVec3=function(r,e,o=0){return dc(((e.x-o)*r.scale-r.x)*Ii,(e.y*r.scale-r.y)*Ii,Ip(e.z,e.y))},a.getVideo=function(r,e){const o=j.document.createElement("video");o.muted=!0,o.onloadstart=function(){e(null,o)};for(let l=0;l<r.length;l++){const f=j.document.createElement("source");$i(r[l])||(o.crossOrigin="Anonymous"),f.src=r[l],o.appendChild(f)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(r){const e=[0,0,0],o=ka(new Float64Array(16));return Vu(o,r.pixelMatrix,r.globeMatrix),co(e,e,o),new Ae(e[0],e[1])},a.globeDenormalizeECEF=Ep,a.globeECEFOrigin=function(r,e){const o=[0,0,0];return co(o,o,Yu(jl(e.canonical))),co(o,o,r),o},a.globeMetersToEcef=Fa,a.globeNormalizeECEF=Yu,a.globePixelsToTileUnits=function(r,e){return Ii/(512*Math.pow(2,r))*Oh(jl(e))},a.globePoleMatrixForTile=function(r,e,o){const l=ka(new Float64Array(16)),f=(e/(1<<r)-.5)*Math.PI*2;return Dh(l,o.globeMatrix,f),Float32Array.from(l)},a.globeTileBounds=jl,a.globeTiltAtLngLat=Cg,a.globeToMercatorTransition=Ju,a.globeUseCustomAntiAliasing=function(r,e,o){const l=Ju(o.zoom),f=r.style.map._antialias,_=!!e.extStandardDerivatives,y=e.extStandardDerivativesForceOff||r.terrain&&r.terrain.exaggeration()>0;return 0===l&&!f&&!y&&_},a.identity=ka,a.identity$1=gp,a.invert=Mc,a.isFullscreen=function(){return!!j.document.fullscreenElement||!!j.document.webkitFullscreenElement},a.isLngLatBehindGlobe=Eg,a.isMapAuthenticated=function(r){return Fr.has(r)},a.isMapboxURL=Ot,a.isSafariWithAntialiasingBug=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!Ut(r)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=To,a.latLngToECEF=Rc,a.len=V0,a.length=Sd,a.length$1=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},a.lngFromMercatorX=Ba,a.loadVectorTile=D_,a.makeRequest=sn,a.mapValue=function(r,e,o,l,f){return Xe((r-e)/(o-e)*(f-l)+l,l,f)},a.mercatorScale=Mp,a.mercatorXfromLng=Vl,a.mercatorYfromLat=$l,a.mercatorZfromAltitude=Na,a.mul=yy,a.mul$1=vy,a.multiply=Vu,a.multiply$1=Ta,a.multiply$2=gg,a.nextPowerOfTwo=it,a.normalize=Ks,a.normalize$1=_p,a.normalize$2=vg,a.number=_i,a.ortho=function(r,e,o,l,f,_,y){var w=1/(e-o),E=1/(l-f),D=1/(_-y);return r[0]=-2*w,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*E,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*D,r[11]=0,r[12]=(e+o)*w,r[13]=(f+l)*E,r[14]=(y+_)*D,r[15]=1,r},a.pbf=Gg,a.perspective=function(r,e,o,l,f){var _,y=1/Math.tan(e/2);return r[0]=y/o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,null!=f&&f!==1/0?(r[10]=(f+l)*(_=1/(l-f)),r[14]=2*f*l*_):(r[10]=-1,r[14]=-2*l),r},a.pick=function(r,e){const o={};for(let l=0;l<e.length;l++){const f=e[l];f in r&&(o[f]=r[f])}return o},a.plugin=M,a.pointGeometry=Be,a.polesInViewport=function(r){const e=ka(new Float64Array(16));Vu(e,r.pixelMatrix,r.globeMatrix);const o=[0,sl,0],l=[0,Da,0];return co(o,o,e),co(l,l,e),[o[0]>0&&o[0]<=r.width&&o[1]>0&&o[1]<=r.height&&!Eg(r,new Gr(r.center.lat,90)),l[0]>0&&l[0]<=r.width&&l[1]>0&&l[1]<=r.height&&!Eg(r,new Gr(r.center.lat,-90))]},a.polygonContainsPoint=Fc,a.polygonIntersectsBox=Iy,a.polygonIntersectsPolygon=Pp,a.polygonizeBounds=function(r,e,o=0,l=!0){const f=new Ae(o,o),_=r.sub(f),y=e.add(f),w=[_,new Ae(y.x,_.y),y,new Ae(_.x,y.y)];return l&&w.push(_.clone()),w},a.posAttributes=Sc,a.postMapLoadEvent=gi,a.postPerformanceEvent=Li,a.postTurnstileEvent=rn,a.potpack=lm,a.prevPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},a.radToDeg=Ee,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(r){return r({pluginStatus:d,pluginURL:n}),v.on("pluginStateChange",r),r},a.removeAuthState=function(r){Fr.delete(r)},a.renderColorRamp=kh,a.resample=Cy,a.rotateX=mp,a.rotateX$1=Mh,a.rotateY=Dh,a.rotateY$1=Pd,a.rotateZ=function(r,e,o){var l=Math.sin(o),f=Math.cos(o),_=e[0],y=e[1],w=e[2],E=e[3],D=e[4],L=e[5],B=e[6],V=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=_*f+D*l,r[1]=y*f+L*l,r[2]=w*f+B*l,r[3]=E*f+V*l,r[4]=D*f-_*l,r[5]=L*f-y*l,r[6]=B*f-w*l,r[7]=V*f-E*l,r},a.rotateZ$1=function(r,e,o){o*=.5;var l=e[0],f=e[1],_=e[2],y=e[3],w=Math.sin(o),E=Math.cos(o);return r[0]=l*E+f*w,r[1]=f*E-l*w,r[2]=_*E+y*w,r[3]=y*E-_*w,r},a.scale=uu,a.scale$1=yg,a.scale$2=Js,a.scaleAndAdd=Hu,a.set=function(r,e,o,l){return r[0]=e,r[1]=o,r[2]=l,r},a.setCacheLimits=function(r,e){Xt=r,Tn=e},a.setColumn=function(r,e,o){r[4*e+0]=o[0],r[4*e+1]=o[1],r[4*e+2]=o[2],r[4*e+3]=o[3]},a.setRTLTextPlugin=function(r,e,o=!1){if(d===P||d===U||d===O)throw new Error("setRTLTextPlugin cannot be called multiple times.");n=Kr.resolveURL(r),d=P,z=e,m(),o||I()},a.smoothstep=Ht,a.spec=It,a.squaredLength=function(r){var e=r[0],o=r[1],l=r[2];return e*e+o*o+l*l},a.storeAuthState=function(r,e){e?Fr.add(r):Fr.delete(r)},a.sub=ol,a.subtract=Zu,a.symbolSize=q0,a.tileAABB=function(r,e,o,l,f,_,y,w,E){if("globe"===E.name)return function wy(r,e,o){const l=e/r.worldSize,f=r.globeMatrix;if(o.z<=1){const nn=jl(o).getCorners();return bg(nn,f,l),_s.fromPoints(nn)}const _=Ph(o),y=Rd(_);bg(y,f,l);const w=Number.MAX_VALUE,E=[-w,-w,-w],D=[w,w,w];if(_.contains(r.center)){for(const Jn of y)Gu(D,D,Jn),du(E,E,Jn);E[2]=0;const nn=r.point,In=[nn.x*l,nn.y*l,0];return Gu(D,D,In),du(E,E,In),new _s(D,E)}const L=[f[12]*l,f[13]*l,f[14]*l],B=_.getCenter(),V=Xe(r.center.lat,-ys,ys),Y=Xe(B.lat,-ys,ys),Q=Vl(r.center.lng),he=$l(V);let Ue=Q-Vl(B.lng);const ot=he-$l(Y);Ue>.5?Ue-=1:Ue<-.5&&(Ue+=1);let bt=0;Math.abs(Ue)>Math.abs(ot)?bt=Ue>=0?1:3:(bt=ot>=0?0:2,Hu(L,L,[f[4]*l,f[5]*l,f[6]*l],-Math.sin(ne(ot>=0?_.getSouth():_.getNorth()))*Xs));const st=y[bt],vt=y[(bt+1)%4],St=new wp(st,vt,L),At=[Cp(St,0)||st[0],Cp(St,1)||st[1],Cp(St,2)||st[2]],un=Ju(r.zoom);if(un>0){const nn=function({x:Jn,y:hn,z:On},kn,Gn,ii,En){const hi=1/(1<<On);let Ei=Jn*hi,mi=Ei+hi,Hi=hn*hi,ri=Hi+hi,Pi=0;const nr=(Ei+mi)/2-ii;return nr>.5?Pi=-1:nr<-.5&&(Pi=1),Ei=((Ei+Pi)*kn-(ii*=kn))*Gn+ii,mi=((mi+Pi)*kn-ii)*Gn+ii,Hi=(Hi*kn-(En*=kn))*Gn+En,ri=(ri*kn-En)*Gn+En,[[Ei,ri,0],[mi,ri,0],[mi,Hi,0],[Ei,Hi,0]]}(o,e,r._pixelsPerMercatorPixel,Q,he);for(let Jn=0;Jn<y.length;Jn++)Oc(y[Jn],nn[Jn],un);const In=hc([],nn[bt],nn[(bt+1)%4]);Js(In,In,.5),Oc(At,In,un)}for(const nn of y)Gu(D,D,nn),du(E,E,nn);return D[2]=Math.min(st[2],vt[2]),Gu(D,D,At),du(E,E,At),new _s(D,E)}(r,e,new zc(o,l,f));const D=gc({z:o,x:l,y:f},E);return new _s([(_+D.x/D.scale)*e,e*(D.y/D.scale),y],[(_+D.x2/D.scale)*e,e*(D.y2/D.scale),w])},a.tileCornersToBounds=Ph,a.tileTransform=gc,a.transformMat3=function(r,e,o){var l=e[0],f=e[1],_=e[2];return r[0]=l*o[0]+f*o[3]+_*o[6],r[1]=l*o[1]+f*o[4]+_*o[7],r[2]=l*o[2]+f*o[5]+_*o[8],r},a.transformMat4=co,a.transformMat4$1=hu,a.transformQuat=_g,a.transitionTileAABBinECEF=mu,a.translate=$u,a.transpose=function(r,e){if(r===e){var o=e[1],l=e[2],f=e[5];r[1]=e[3],r[2]=e[6],r[3]=o,r[5]=e[7],r[6]=l,r[7]=f}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r},a.triggerPluginCompletionEvent=c,a.uniqueId=Oe,a.updateGlobeVertexNormal=function(r,e,o,l,f){const _=5*e+2;r.float32[_+0]=o,r.float32[_+1]=l,r.float32[_+2]=f},a.validateCustomStyleLayer=function(r){const e=[],o=r.id;return void 0===o&&e.push({message:`layers.${o}: missing required property "id"`}),void 0===r.render&&e.push({message:`layers.${o}: missing required method "render"`}),r.renderingMode&&"2d"!==r.renderingMode&&"3d"!==r.renderingMode&&e.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateFilter=r=>la(Fl(r)),a.validateFog=r=>la(Tc(r)),a.validateLayer=r=>la(ms(r)),a.validateLight=r=>la(Qc(r)),a.validateSource=r=>la(Fu(r)),a.validateStyle=tu,a.validateTerrain=r=>la(Ec(r)),a.values=$t,a.vectorTile=Hh,a.version=K,a.warnOnce=Dt,a.window=j,a.wrap=cn}),p(0,function(a){function j(ct){if("number"==typeof ct||"boolean"==typeof ct||"string"==typeof ct||null==ct)return JSON.stringify(ct);if(Array.isArray(ct)){let se="[";for(const tt of ct)se+=`${j(tt)},`;return`${se}]`}let ge="{";for(const se of Object.keys(ct).sort())ge+=`${se}:${j(ct[se])},`;return`${ge}}`}function K(ct){let ge="";for(const se of a.refProperties)ge+=`/${j(ct[se])}`;return ge}class C{constructor(ge){this.keyCache={},ge&&this.replace(ge)}replace(ge){this._layerConfigs={},this._layers={},this.update(ge,[])}update(ge,se){for(const yt of ge)this._layerConfigs[yt.id]=yt,(this._layers[yt.id]=a.createStyleLayer(yt)).compileFilter(),this.keyCache[yt.id]&&delete this.keyCache[yt.id];for(const yt of se)delete this.keyCache[yt],delete this._layerConfigs[yt],delete this._layers[yt];this.familiesBySource={};const tt=function(yt,Ot){const Gt={};for(let Et=0;Et<yt.length;Et++){const Jt=Ot&&Ot[yt[Et].id]||K(yt[Et]);Ot&&(Ot[yt[Et].id]=Jt);let Bn=Gt[Jt];Bn||(Bn=Gt[Jt]=[]),Bn.push(yt[Et])}const Vt=[];for(const Et in Gt)Vt.push(Gt[Et]);return Vt}(a.values(this._layerConfigs),this.keyCache);for(const yt of tt){const Ot=yt.map(mn=>this._layers[mn.id]),Gt=Ot[0];if("none"===Gt.visibility)continue;const Vt=Gt.source||"";let Et=this.familiesBySource[Vt];Et||(Et=this.familiesBySource[Vt]={});const Jt=Gt.sourceLayer||"_geojsonTileLayer";let Bn=Et[Jt];Bn||(Bn=Et[Jt]=[]),Bn.push(Ot)}}}class oe{loadTile(ge,se){const{uid:tt,encoding:yt,rawImageData:Ot,padding:Gt,buildQuadTree:Vt}=ge,Et=a.window.ImageBitmap&&Ot instanceof a.window.ImageBitmap?this.getImageData(Ot,Gt):Ot;se(null,new a.DEMData(tt,Et,yt,Gt<1,Vt))}getImageData(ge,se){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ge.width,ge.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ge.width,this.offscreenCanvas.height=ge.height,this.offscreenCanvasContext.drawImage(ge,0,0,ge.width,ge.height);const tt=this.offscreenCanvasContext.getImageData(-se,-se,ge.width+2*se,ge.height+2*se);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),tt}}function _e(ct,ge){if(0!==ct.length){Le(ct[0],ge);for(var se=1;se<ct.length;se++)Le(ct[se],!ge)}}function Le(ct,ge){for(var se=0,tt=0,yt=0,Ot=ct.length,Gt=Ot-1;yt<Ot;Gt=yt++){var Vt=(ct[yt][0]-ct[Gt][0])*(ct[Gt][1]+ct[yt][1]),Et=se+Vt;tt+=Math.abs(se)>=Math.abs(Vt)?se-Et+Vt:Vt-Et+se,se=Et}se+tt>=0!=!!ge&&ct.reverse()}var ee=a.getDefaultExportFromCjs(function ct(ge,se){var tt,yt=ge&&ge.type;if("FeatureCollection"===yt)for(tt=0;tt<ge.features.length;tt++)ct(ge.features[tt],se);else if("GeometryCollection"===yt)for(tt=0;tt<ge.geometries.length;tt++)ct(ge.geometries[tt],se);else if("Feature"===yt)ct(ge.geometry,se);else if("Polygon"===yt)_e(ge.coordinates,se);else if("MultiPolygon"===yt)for(tt=0;tt<ge.coordinates.length;tt++)_e(ge.coordinates[tt],se);return ge});const Te=a.VectorTileFeature.prototype.toGeoJSON;var ye={exports:{}},De=a.pointGeometry,me=a.vectorTile.VectorTileFeature,Ye=Ce;function Ce(ct,ge){this.options=ge||{},this.features=ct,this.length=ct.length}function de(ct,ge){this.id="number"==typeof ct.id?ct.id:void 0,this.type=ct.type,this.rawGeometry=1===ct.type?[ct.geometry]:ct.geometry,this.properties=ct.tags,this.extent=ge||4096}Ce.prototype.feature=function(ct){return new de(this.features[ct],this.options.extent)},de.prototype.loadGeometry=function(){var ct=this.rawGeometry;this.geometry=[];for(var ge=0;ge<ct.length;ge++){for(var se=ct[ge],tt=[],yt=0;yt<se.length;yt++)tt.push(new De(se[yt][0],se[yt][1]));this.geometry.push(tt)}return this.geometry},de.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ct=this.geometry,ge=1/0,se=-1/0,tt=1/0,yt=-1/0,Ot=0;Ot<ct.length;Ot++)for(var Gt=ct[Ot],Vt=0;Vt<Gt.length;Vt++){var Et=Gt[Vt];ge=Math.min(ge,Et.x),se=Math.max(se,Et.x),tt=Math.min(tt,Et.y),yt=Math.max(yt,Et.y)}return[ge,tt,se,yt]},de.prototype.toGeoJSON=me.prototype.toGeoJSON;var Pe=a.pbf,Be=Ye;function Ne(ct){var ge=new Pe;return function(se,tt){for(var yt in se.layers)tt.writeMessage(3,Ae,se.layers[yt])}(ct,ge),ge.finish()}function Ae(ct,ge){var se;ge.writeVarintField(15,ct.version||1),ge.writeStringField(1,ct.name||""),ge.writeVarintField(5,ct.extent||4096);var tt={keys:[],values:[],keycache:{},valuecache:{}};for(se=0;se<ct.length;se++)tt.feature=ct.feature(se),ge.writeMessage(2,Ge,tt);var yt=tt.keys;for(se=0;se<yt.length;se++)ge.writeStringField(3,yt[se]);var Ot=tt.values;for(se=0;se<Ot.length;se++)ge.writeMessage(4,je,Ot[se])}function Ge(ct,ge){var se=ct.feature;void 0!==se.id&&ge.writeVarintField(1,se.id),ge.writeMessage(2,lt,ct),ge.writeVarintField(3,se.type),ge.writeMessage(4,xe,se)}function lt(ct,ge){var se=ct.feature,tt=ct.keys,yt=ct.values,Ot=ct.keycache,Gt=ct.valuecache;for(var Vt in se.properties){var Et=se.properties[Vt],Jt=Ot[Vt];if(null!==Et){void 0===Jt&&(tt.push(Vt),Ot[Vt]=Jt=tt.length-1),ge.writeVarint(Jt);var Bn=typeof Et;"string"!==Bn&&"boolean"!==Bn&&"number"!==Bn&&(Et=JSON.stringify(Et));var mn=Bn+":"+Et,ae=Gt[mn];void 0===ae&&(yt.push(Et),Gt[mn]=ae=yt.length-1),ge.writeVarint(ae)}}}function ne(ct,ge){return(ge<<3)+(7&ct)}function Ee(ct){return ct<<1^ct>>31}function xe(ct,ge){for(var se=ct.loadGeometry(),tt=ct.type,yt=0,Ot=0,Gt=se.length,Vt=0;Vt<Gt;Vt++){var Et=se[Vt],Jt=1;1===tt&&(Jt=Et.length),ge.writeVarint(ne(1,Jt));for(var Bn=3===tt?Et.length-1:Et.length,mn=0;mn<Bn;mn++){1===mn&&1!==tt&&ge.writeVarint(ne(2,Bn-1));var ae=Et[mn].x-yt,ht=Et[mn].y-Ot;ge.writeVarint(Ee(ae)),ge.writeVarint(Ee(ht)),yt+=ae,Ot+=ht}3===tt&&ge.writeVarint(ne(7,1))}}function je(ct,ge){var se=typeof ct;"string"===se?ge.writeStringField(1,ct):"boolean"===se?ge.writeBooleanField(7,ct):"number"===se&&(ct%1!=0?ge.writeDoubleField(3,ct):ct<0?ge.writeSVarintField(6,ct):ge.writeVarintField(5,ct))}ye.exports=Ne,ye.exports.fromVectorTileJs=Ne,ye.exports.fromGeojsonVt=function(ct,ge){ge=ge||{};var se={};for(var tt in ct)se[tt]=new Be(ct[tt].features,ge),se[tt].name=tt,se[tt].version=ge.version,se[tt].extent=ge.extent;return Ne({layers:se})},ye.exports.GeoJSONWrapper=Be;var Se=a.getDefaultExportFromCjs(ye.exports);const Ve={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ct=>ct},Xe=Math.fround||(Ht=new Float32Array(1),ct=>(Ht[0]=+ct,Ht[0]));var Ht;const cn=3,xn=5,$t=6;class ke{constructor(ge){this.options=Object.assign(Object.create(Ve),ge),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ge){const{log:se,minZoom:tt,maxZoom:yt}=this.options;se&&console.time("total time");const Ot=`prepare ${ge.length} points`;se&&console.time(Ot),this.points=ge;const Gt=[];for(let Et=0;Et<ge.length;Et++){const Jt=ge[Et];if(!Jt.geometry)continue;const[Bn,mn]=Jt.geometry.coordinates,ae=Xe(ie(Bn)),ht=Xe(it(mn));Gt.push(ae,ht,1/0,Et,-1,1),this.options.reduce&&Gt.push(0)}let Vt=this.trees[yt+1]=this._createTree(Gt);se&&console.timeEnd(Ot);for(let Et=yt;Et>=tt;Et--){const Jt=+Date.now();Vt=this.trees[Et]=this._createTree(this._cluster(Vt,Et)),se&&console.log("z%d: %d clusters in %dms",Et,Vt.numItems,+Date.now()-Jt)}return se&&console.timeEnd("total time"),this}getClusters(ge,se){let tt=((ge[0]+180)%360+360)%360-180;const yt=Math.max(-90,Math.min(90,ge[1]));let Ot=180===ge[2]?180:((ge[2]+180)%360+360)%360-180;const Gt=Math.max(-90,Math.min(90,ge[3]));if(ge[2]-ge[0]>=360)tt=-180,Ot=180;else if(tt>Ot){const mn=this.getClusters([tt,yt,180,Gt],se),ae=this.getClusters([-180,yt,Ot,Gt],se);return mn.concat(ae)}const Vt=this.trees[this._limitZoom(se)],Et=Vt.range(ie(tt),it(Gt),ie(Ot),it(yt)),Jt=Vt.data,Bn=[];for(const mn of Et){const ae=this.stride*mn;Bn.push(Jt[ae+xn]>1?pe(Jt,ae,this.clusterProps):this.points[Jt[ae+cn]])}return Bn}getChildren(ge){const se=this._getOriginId(ge),tt=this._getOriginZoom(ge),yt="No cluster with the specified id.",Ot=this.trees[tt];if(!Ot)throw new Error(yt);const Gt=Ot.data;if(se*this.stride>=Gt.length)throw new Error(yt);const Vt=this.options.radius/(this.options.extent*Math.pow(2,tt-1)),Et=Ot.within(Gt[se*this.stride],Gt[se*this.stride+1],Vt),Jt=[];for(const Bn of Et){const mn=Bn*this.stride;Gt[mn+4]===ge&&Jt.push(Gt[mn+xn]>1?pe(Gt,mn,this.clusterProps):this.points[Gt[mn+cn]])}if(0===Jt.length)throw new Error(yt);return Jt}getLeaves(ge,se,tt){const yt=[];return this._appendLeaves(yt,ge,se=se||10,tt=tt||0,0),yt}getTile(ge,se,tt){const yt=this.trees[this._limitZoom(ge)],Ot=Math.pow(2,ge),{extent:Gt,radius:Vt}=this.options,Et=Vt/Gt,Jt=(tt-Et)/Ot,Bn=(tt+1+Et)/Ot,mn={features:[]};return this._addTileFeatures(yt.range((se-Et)/Ot,Jt,(se+1+Et)/Ot,Bn),yt.data,se,tt,Ot,mn),0===se&&this._addTileFeatures(yt.range(1-Et/Ot,Jt,1,Bn),yt.data,Ot,tt,Ot,mn),se===Ot-1&&this._addTileFeatures(yt.range(0,Jt,Et/Ot,Bn),yt.data,-1,tt,Ot,mn),mn.features.length?mn:null}getClusterExpansionZoom(ge){let se=this._getOriginZoom(ge)-1;for(;se<=this.options.maxZoom;){const tt=this.getChildren(ge);if(se++,1!==tt.length)break;ge=tt[0].properties.cluster_id}return se}_appendLeaves(ge,se,tt,yt,Ot){const Gt=this.getChildren(se);for(const Vt of Gt){const Et=Vt.properties;if(Et&&Et.cluster?Ot+Et.point_count<=yt?Ot+=Et.point_count:Ot=this._appendLeaves(ge,Et.cluster_id,tt,yt,Ot):Ot<yt?Ot++:ge.push(Vt),ge.length===tt)break}return Ot}_createTree(ge){const se=new a.KDBush(ge.length/this.stride|0,this.options.nodeSize,Float32Array);for(let tt=0;tt<ge.length;tt+=this.stride)se.add(ge[tt],ge[tt+1]);return se.finish(),se.data=ge,se}_addTileFeatures(ge,se,tt,yt,Ot,Gt){for(const Vt of ge){const Et=Vt*this.stride,Jt=se[Et+xn]>1;let Bn,mn,ae;if(Jt)Bn=Oe(se,Et,this.clusterProps),mn=se[Et],ae=se[Et+1];else{const ze=this.points[se[Et+cn]];Bn=ze.properties;const[at,rn]=ze.geometry.coordinates;mn=ie(at),ae=it(rn)}const ht={type:1,geometry:[[Math.round(this.options.extent*(mn*Ot-tt)),Math.round(this.options.extent*(ae*Ot-yt))]],tags:Bn};let G;G=Jt||this.options.generateId?se[Et+cn]:this.points[se[Et+cn]].id,void 0!==G&&(ht.id=G),Gt.features.push(ht)}}_limitZoom(ge){return Math.max(this.options.minZoom,Math.min(Math.floor(+ge),this.options.maxZoom+1))}_cluster(ge,se){const{radius:tt,extent:yt,reduce:Ot,minPoints:Gt}=this.options,Vt=tt/(yt*Math.pow(2,se)),Et=ge.data,Jt=[],Bn=this.stride;for(let mn=0;mn<Et.length;mn+=Bn){if(Et[mn+2]<=se)continue;Et[mn+2]=se;const ae=Et[mn],ht=Et[mn+1],G=ge.within(Et[mn],Et[mn+1],Vt),ze=Et[mn+xn];let at=ze;for(const rn of G){const Dn=rn*Bn;Et[Dn+2]>se&&(at+=Et[Dn+xn])}if(at>ze&&at>=Gt){let rn,Dn=ae*ze,gi=ht*ze,Mi=-1;const Li=((mn/Bn|0)<<5)+(se+1)+this.points.length;for(const yr of G){const Ui=yr*Bn;if(Et[Ui+2]<=se)continue;Et[Ui+2]=se;const Fr=Et[Ui+xn];Dn+=Et[Ui]*Fr,gi+=Et[Ui+1]*Fr,Et[Ui+4]=Li,Ot&&(rn||(rn=this._map(Et,mn,!0),Mi=this.clusterProps.length,this.clusterProps.push(rn)),Ot(rn,this._map(Et,Ui)))}Et[mn+4]=Li,Jt.push(Dn/at,gi/at,1/0,Li,-1,at),Ot&&Jt.push(Mi)}else{for(let rn=0;rn<Bn;rn++)Jt.push(Et[mn+rn]);if(at>1)for(const rn of G){const Dn=rn*Bn;if(!(Et[Dn+2]<=se)){Et[Dn+2]=se;for(let gi=0;gi<Bn;gi++)Jt.push(Et[Dn+gi])}}}}return Jt}_getOriginId(ge){return ge-this.points.length>>5}_getOriginZoom(ge){return(ge-this.points.length)%32}_map(ge,se,tt){if(ge[se+xn]>1){const Gt=this.clusterProps[ge[se+$t]];return tt?Object.assign({},Gt):Gt}const yt=this.points[ge[se+cn]].properties,Ot=this.options.map(yt);return tt&&Ot===yt?Object.assign({},Ot):Ot}}function pe(ct,ge,se){return{type:"Feature",id:ct[ge+cn],properties:Oe(ct,ge,se),geometry:{type:"Point",coordinates:[(tt=ct[ge],360*(tt-.5)),_t(ct[ge+1])]}};var tt}function Oe(ct,ge,se){const tt=ct[ge+xn],yt=tt>=1e4?`${Math.round(tt/1e3)}k`:tt>=1e3?Math.round(tt/100)/10+"k":tt,Ot=ct[ge+$t],Gt=-1===Ot?{}:Object.assign({},se[Ot]);return Object.assign(Gt,{cluster:!0,cluster_id:ct[ge+cn],point_count:tt,point_count_abbreviated:yt})}function ie(ct){return ct/360+.5}function it(ct){const ge=Math.sin(ct*Math.PI/180),se=.5-.25*Math.log((1+ge)/(1-ge))/Math.PI;return se<0?0:se>1?1:se}function _t(ct){const ge=(180-360*ct)*Math.PI/180;return 360*Math.atan(Math.exp(ge))/Math.PI-90}function Kt(ct,ge,se,tt){for(var yt,Ot=tt,Gt=se-ge>>1,Vt=se-ge,Et=ct[ge],Jt=ct[ge+1],Bn=ct[se],mn=ct[se+1],ae=ge+3;ae<se;ae+=3){var ht=Mn(ct[ae],ct[ae+1],Et,Jt,Bn,mn);if(ht>Ot)yt=ae,Ot=ht;else if(ht===Ot){var G=Math.abs(ae-Gt);G<Vt&&(yt=ae,Vt=G)}}Ot>tt&&(yt-ge>3&&Kt(ct,ge,yt,tt),ct[yt+2]=Ot,se-yt>3&&Kt(ct,yt,se,tt))}function Mn(ct,ge,se,tt,yt,Ot){var Gt=yt-se,Vt=Ot-tt;if(0!==Gt||0!==Vt){var Et=((ct-se)*Gt+(ge-tt)*Vt)/(Gt*Gt+Vt*Vt);Et>1?(se=yt,tt=Ot):Et>0&&(se+=Gt*Et,tt+=Vt*Et)}return(Gt=ct-se)*Gt+(Vt=ge-tt)*Vt}function fn(ct,ge,se,tt){var yt={id:void 0===ct?null:ct,type:ge,geometry:se,tags:tt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ot){var Gt=Ot.geometry,Vt=Ot.type;if("Point"===Vt||"MultiPoint"===Vt||"LineString"===Vt)qn(Ot,Gt);else if("Polygon"===Vt||"MultiLineString"===Vt)for(var Et=0;Et<Gt.length;Et++)qn(Ot,Gt[Et]);else if("MultiPolygon"===Vt)for(Et=0;Et<Gt.length;Et++)for(var Jt=0;Jt<Gt[Et].length;Jt++)qn(Ot,Gt[Et][Jt])}(yt),yt}function qn(ct,ge){for(var se=0;se<ge.length;se+=3)ct.minX=Math.min(ct.minX,ge[se]),ct.minY=Math.min(ct.minY,ge[se+1]),ct.maxX=Math.max(ct.maxX,ge[se]),ct.maxY=Math.max(ct.maxY,ge[se+1])}function li(ct,ge,se,tt){if(ge.geometry){var yt=ge.geometry.coordinates,Ot=ge.geometry.type,Gt=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2),Vt=[],Et=ge.id;if(se.promoteId?Et=ge.properties[se.promoteId]:se.generateId&&(Et=tt||0),"Point"===Ot)en(yt,Vt);else if("MultiPoint"===Ot)for(var Jt=0;Jt<yt.length;Jt++)en(yt[Jt],Vt);else if("LineString"===Ot)Dt(yt,Vt,Gt,!1);else if("MultiLineString"===Ot){if(se.lineMetrics){for(Jt=0;Jt<yt.length;Jt++)Dt(yt[Jt],Vt=[],Gt,!1),ct.push(fn(Et,"LineString",Vt,ge.properties));return}Ie(yt,Vt,Gt,!1)}else if("Polygon"===Ot)Ie(yt,Vt,Gt,!0);else{if("MultiPolygon"!==Ot){if("GeometryCollection"===Ot){for(Jt=0;Jt<ge.geometry.geometries.length;Jt++)li(ct,{id:Et,geometry:ge.geometry.geometries[Jt],properties:ge.properties},se,tt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Jt=0;Jt<yt.length;Jt++){var Bn=[];Ie(yt[Jt],Bn,Gt,!0),Vt.push(Bn)}}ct.push(fn(Et,Ot,Vt,ge.properties))}}function en(ct,ge){ge.push(Ct(ct[0])),ge.push(on(ct[1])),ge.push(0)}function Dt(ct,ge,se,tt){for(var yt,Ot,Gt=0,Vt=0;Vt<ct.length;Vt++){var Et=Ct(ct[Vt][0]),Jt=on(ct[Vt][1]);ge.push(Et),ge.push(Jt),ge.push(0),Vt>0&&(Gt+=tt?(yt*Jt-Et*Ot)/2:Math.sqrt(Math.pow(Et-yt,2)+Math.pow(Jt-Ot,2))),yt=Et,Ot=Jt}var Bn=ge.length-3;ge[2]=1,Kt(ge,0,Bn,se),ge[Bn+2]=1,ge.size=Math.abs(Gt),ge.start=0,ge.end=ge.size}function Ie(ct,ge,se,tt){for(var yt=0;yt<ct.length;yt++){var Ot=[];Dt(ct[yt],Ot,se,tt),ge.push(Ot)}}function Ct(ct){return ct/360+.5}function on(ct){var ge=Math.sin(ct*Math.PI/180),se=.5-.25*Math.log((1+ge)/(1-ge))/Math.PI;return se<0?0:se>1?1:se}function Rn(ct,ge,se,tt,yt,Ot,Gt,Vt){if(tt/=ge,Ot>=(se/=ge)&&Gt<tt)return ct;if(Gt<se||Ot>=tt)return null;for(var Et=[],Jt=0;Jt<ct.length;Jt++){var Bn=ct[Jt],mn=Bn.geometry,ae=Bn.type,ht=0===yt?Bn.minX:Bn.minY,G=0===yt?Bn.maxX:Bn.maxY;if(ht>=se&&G<tt)Et.push(Bn);else if(!(G<se||ht>=tt)){var ze=[];if("Point"===ae||"MultiPoint"===ae)Vn(mn,ze,se,tt,yt);else if("LineString"===ae)Ut(mn,ze,se,tt,yt,!1,Vt.lineMetrics);else if("MultiLineString"===ae)qe(mn,ze,se,tt,yt,!1);else if("Polygon"===ae)qe(mn,ze,se,tt,yt,!0);else if("MultiPolygon"===ae)for(var at=0;at<mn.length;at++){var rn=[];qe(mn[at],rn,se,tt,yt,!0),rn.length&&ze.push(rn)}if(ze.length){if(Vt.lineMetrics&&"LineString"===ae){for(at=0;at<ze.length;at++)Et.push(fn(Bn.id,ae,ze[at],Bn.tags));continue}"LineString"!==ae&&"MultiLineString"!==ae||(1===ze.length?(ae="LineString",ze=ze[0]):ae="MultiLineString"),"Point"!==ae&&"MultiPoint"!==ae||(ae=3===ze.length?"Point":"MultiPoint"),Et.push(fn(Bn.id,ae,ze,Bn.tags))}}}return Et.length?Et:null}function Vn(ct,ge,se,tt,yt){for(var Ot=0;Ot<ct.length;Ot+=3){var Gt=ct[Ot+yt];Gt>=se&&Gt<=tt&&(ge.push(ct[Ot]),ge.push(ct[Ot+1]),ge.push(ct[Ot+2]))}}function Ut(ct,ge,se,tt,yt,Ot,Gt){for(var Vt,Et,Jt=Hn(ct),Bn=0===yt?Xt:Tn,mn=ct.start,ae=0;ae<ct.length-3;ae+=3){var ht=ct[ae],G=ct[ae+1],ze=ct[ae+2],at=ct[ae+3],rn=ct[ae+4],Dn=0===yt?ht:G,gi=0===yt?at:rn,Mi=!1;Gt&&(Vt=Math.sqrt(Math.pow(ht-at,2)+Math.pow(G-rn,2))),Dn<se?gi>se&&(Et=Bn(Jt,ht,G,at,rn,se),Gt&&(Jt.start=mn+Vt*Et)):Dn>tt?gi<tt&&(Et=Bn(Jt,ht,G,at,rn,tt),Gt&&(Jt.start=mn+Vt*Et)):Nt(Jt,ht,G,ze),gi<se&&Dn>=se&&(Et=Bn(Jt,ht,G,at,rn,se),Mi=!0),gi>tt&&Dn<=tt&&(Et=Bn(Jt,ht,G,at,rn,tt),Mi=!0),!Ot&&Mi&&(Gt&&(Jt.end=mn+Vt*Et),ge.push(Jt),Jt=Hn(ct)),Gt&&(mn+=Vt)}var Li=ct.length-3;ht=ct[Li],G=ct[Li+1],ze=ct[Li+2],(Dn=0===yt?ht:G)>=se&&Dn<=tt&&Nt(Jt,ht,G,ze),Li=Jt.length-3,Ot&&Li>=3&&(Jt[Li]!==Jt[0]||Jt[Li+1]!==Jt[1])&&Nt(Jt,Jt[0],Jt[1],Jt[2]),Jt.length&&ge.push(Jt)}function Hn(ct){var ge=[];return ge.size=ct.size,ge.start=ct.start,ge.end=ct.end,ge}function qe(ct,ge,se,tt,yt,Ot){for(var Gt=0;Gt<ct.length;Gt++)Ut(ct[Gt],ge,se,tt,yt,Ot,!1)}function Nt(ct,ge,se,tt){ct.push(ge),ct.push(se),ct.push(tt)}function Xt(ct,ge,se,tt,yt,Ot){var Gt=(Ot-ge)/(tt-ge);return ct.push(Ot),ct.push(se+(yt-se)*Gt),ct.push(1),Gt}function Tn(ct,ge,se,tt,yt,Ot){var Gt=(Ot-se)/(yt-se);return ct.push(ge+(tt-ge)*Gt),ct.push(Ot),ct.push(1),Gt}function oi(ct,ge){for(var se=[],tt=0;tt<ct.length;tt++){var yt,Ot=ct[tt],Gt=Ot.type;if("Point"===Gt||"MultiPoint"===Gt||"LineString"===Gt)yt=xi(Ot.geometry,ge);else if("MultiLineString"===Gt||"Polygon"===Gt){yt=[];for(var Vt=0;Vt<Ot.geometry.length;Vt++)yt.push(xi(Ot.geometry[Vt],ge))}else if("MultiPolygon"===Gt)for(yt=[],Vt=0;Vt<Ot.geometry.length;Vt++){for(var Et=[],Jt=0;Jt<Ot.geometry[Vt].length;Jt++)Et.push(xi(Ot.geometry[Vt][Jt],ge));yt.push(Et)}se.push(fn(Ot.id,Gt,yt,Ot.tags))}return se}function xi(ct,ge){var se=[];se.size=ct.size,void 0!==ct.start&&(se.start=ct.start,se.end=ct.end);for(var tt=0;tt<ct.length;tt+=3)se.push(ct[tt]+ge,ct[tt+1],ct[tt+2]);return se}function Oi(ct,ge){if(ct.transformed)return ct;var se,tt,yt,Ot=1<<ct.z,Gt=ct.x,Vt=ct.y;for(se=0;se<ct.features.length;se++){var Et=ct.features[se],Jt=Et.geometry,Bn=Et.type;if(Et.geometry=[],1===Bn)for(tt=0;tt<Jt.length;tt+=2)Et.geometry.push(gr(Jt[tt],Jt[tt+1],ge,Ot,Gt,Vt));else for(tt=0;tt<Jt.length;tt++){var mn=[];for(yt=0;yt<Jt[tt].length;yt+=2)mn.push(gr(Jt[tt][yt],Jt[tt][yt+1],ge,Ot,Gt,Vt));Et.geometry.push(mn)}}return ct.transformed=!0,ct}function gr(ct,ge,se,tt,yt,Ot){return[Math.round(se*(ct*tt-yt)),Math.round(se*(ge*tt-Ot))]}function ki(ct,ge,se,tt,yt){for(var Ot=ge===yt.maxZoom?0:yt.tolerance/((1<<ge)*yt.extent),Gt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:se,y:tt,z:ge,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Vt=0;Vt<ct.length;Vt++){Gt.numFeatures++,Wi(Gt,ct[Vt],Ot,yt);var Et=ct[Vt].minX,Jt=ct[Vt].minY,Bn=ct[Vt].maxX,mn=ct[Vt].maxY;Et<Gt.minX&&(Gt.minX=Et),Jt<Gt.minY&&(Gt.minY=Jt),Bn>Gt.maxX&&(Gt.maxX=Bn),mn>Gt.maxY&&(Gt.maxY=mn)}return Gt}function Wi(ct,ge,se,tt){var yt=ge.geometry,Ot=ge.type,Gt=[];if("Point"===Ot||"MultiPoint"===Ot)for(var Vt=0;Vt<yt.length;Vt+=3)Gt.push(yt[Vt]),Gt.push(yt[Vt+1]),ct.numPoints++,ct.numSimplified++;else if("LineString"===Ot)_n(Gt,yt,ct,se,!1,!1);else if("MultiLineString"===Ot||"Polygon"===Ot)for(Vt=0;Vt<yt.length;Vt++)_n(Gt,yt[Vt],ct,se,"Polygon"===Ot,0===Vt);else if("MultiPolygon"===Ot)for(var Et=0;Et<yt.length;Et++){var Jt=yt[Et];for(Vt=0;Vt<Jt.length;Vt++)_n(Gt,Jt[Vt],ct,se,!0,0===Vt)}if(Gt.length){var Bn=ge.tags||null;if("LineString"===Ot&&tt.lineMetrics){for(var mn in Bn={},ge.tags)Bn[mn]=ge.tags[mn];Bn.mapbox_clip_start=yt.start/yt.size,Bn.mapbox_clip_end=yt.end/yt.size}var ae={geometry:Gt,type:"Polygon"===Ot||"MultiPolygon"===Ot?3:"LineString"===Ot||"MultiLineString"===Ot?2:1,tags:Bn};null!==ge.id&&(ae.id=ge.id),ct.features.push(ae)}}function _n(ct,ge,se,tt,yt,Ot){var Gt=tt*tt;if(tt>0&&ge.size<(yt?Gt:tt))se.numPoints+=ge.length/3;else{for(var Vt=[],Et=0;Et<ge.length;Et+=3)(0===tt||ge[Et+2]>Gt)&&(se.numSimplified++,Vt.push(ge[Et]),Vt.push(ge[Et+1])),se.numPoints++;yt&&function(Jt,Bn){for(var mn=0,ae=0,ht=Jt.length,G=ht-2;ae<ht;G=ae,ae+=2)mn+=(Jt[ae]-Jt[G])*(Jt[ae+1]+Jt[G+1]);if(mn>0===Bn)for(ae=0,ht=Jt.length;ae<ht/2;ae+=2){var ze=Jt[ae],at=Jt[ae+1];Jt[ae]=Jt[ht-2-ae],Jt[ae+1]=Jt[ht-1-ae],Jt[ht-2-ae]=ze,Jt[ht-1-ae]=at}}(Vt,Ot),ct.push(Vt)}}function Bi(ct,ge){var se=(ge=this.options=function(yt,Ot){for(var Gt in Ot)yt[Gt]=Ot[Gt];return yt}(Object.create(this.options),ge)).debug;if(se&&console.time("preprocess data"),ge.maxZoom<0||ge.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ge.promoteId&&ge.generateId)throw new Error("promoteId and generateId cannot be used together.");var yt,Ot,Gt,Vt,Et,Jt,tt=function(yt,Ot){var Gt=[];if("FeatureCollection"===yt.type)for(var Vt=0;Vt<yt.features.length;Vt++)li(Gt,yt.features[Vt],Ot,Vt);else li(Gt,"Feature"===yt.type?yt:{geometry:yt},Ot);return Gt}(ct,ge);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ge.indexMaxZoom,ge.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Vt=yt=tt,Et=Rn(yt,1,-1-(Gt=(Ot=ge).buffer/Ot.extent),Gt,0,-1,2,Ot),Jt=Rn(yt,1,1-Gt,2+Gt,0,-1,2,Ot),(Et||Jt)&&(Vt=Rn(yt,1,-Gt,1+Gt,0,-1,2,Ot)||[],Et&&(Vt=oi(Et,1).concat(Vt)),Jt&&(Vt=Vt.concat(oi(Jt,-1)))),(tt=Vt).length&&this.splitTile(tt,0,0,0),se&&(tt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function pn(ct,ge,se){return 32*((1<<ct)*se+ge)+ct}function sn(ct,ge){const se=ct.tileID.canonical;if(!this._geoJSONIndex)return ge(null,null);const tt=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!tt)return ge(null,null);const yt=new class{constructor(Gt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=Gt.length,this._features=Gt}feature(Gt){return new class{constructor(Vt){this._feature=Vt,this.extent=a.EXTENT,this.type=Vt.type,this.properties=Vt.tags,"id"in Vt&&!isNaN(Vt.id)&&(this.id=parseInt(Vt.id,10))}loadGeometry(){if(1===this._feature.type){const Vt=[];for(const Et of this._feature.geometry)Vt.push([new a.Point(Et[0],Et[1])]);return Vt}{const Vt=[];for(const Et of this._feature.geometry){const Jt=[];for(const Bn of Et)Jt.push(new a.Point(Bn[0],Bn[1]));Vt.push(Jt)}return Vt}}toGeoJSON(Vt,Et,Jt){return Te.call(this,Vt,Et,Jt)}}(this._features[Gt])}}(tt.features);let Ot=Se(yt);0===Ot.byteOffset&&Ot.byteLength===Ot.buffer.byteLength||(Ot=new Uint8Array(Ot)),ge(null,{vectorTile:yt,rawData:Ot.buffer})}Bi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Bi.prototype.splitTile=function(ct,ge,se,tt,yt,Ot,Gt){for(var Vt=[ct,ge,se,tt],Et=this.options,Jt=Et.debug;Vt.length;){tt=Vt.pop(),se=Vt.pop(),ge=Vt.pop(),ct=Vt.pop();var Bn=1<<ge,mn=pn(ge,se,tt),ae=this.tiles[mn];if(!ae&&(Jt>1&&console.time("creation"),ae=this.tiles[mn]=ki(ct,ge,se,tt,Et),this.tileCoords.push({z:ge,x:se,y:tt}),Jt)){Jt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ge,se,tt,ae.numFeatures,ae.numPoints,ae.numSimplified),console.timeEnd("creation"));var ht="z"+ge;this.stats[ht]=(this.stats[ht]||0)+1,this.total++}if(ae.source=ct,yt){if(ge===Et.maxZoom||ge===yt)continue;var G=1<<yt-ge;if(se!==Math.floor(Ot/G)||tt!==Math.floor(Gt/G))continue}else if(ge===Et.indexMaxZoom||ae.numPoints<=Et.indexMaxPoints)continue;if(ae.source=null,0!==ct.length){Jt>1&&console.time("clipping");var ze,at,rn,Dn,gi,Mi,Li=.5*Et.buffer/Et.extent,yr=.5-Li,Ui=.5+Li,Fr=1+Li;ze=at=rn=Dn=null,gi=Rn(ct,Bn,se-Li,se+Ui,0,ae.minX,ae.maxX,Et),Mi=Rn(ct,Bn,se+yr,se+Fr,0,ae.minX,ae.maxX,Et),ct=null,gi&&(ze=Rn(gi,Bn,tt-Li,tt+Ui,1,ae.minY,ae.maxY,Et),at=Rn(gi,Bn,tt+yr,tt+Fr,1,ae.minY,ae.maxY,Et),gi=null),Mi&&(rn=Rn(Mi,Bn,tt-Li,tt+Ui,1,ae.minY,ae.maxY,Et),Dn=Rn(Mi,Bn,tt+yr,tt+Fr,1,ae.minY,ae.maxY,Et),Mi=null),Jt>1&&console.timeEnd("clipping"),Vt.push(ze||[],ge+1,2*se,2*tt),Vt.push(at||[],ge+1,2*se,2*tt+1),Vt.push(rn||[],ge+1,2*se+1,2*tt),Vt.push(Dn||[],ge+1,2*se+1,2*tt+1)}}},Bi.prototype.getTile=function(ct,ge,se){var tt=this.options,yt=tt.extent,Ot=tt.debug;if(ct<0||ct>24)return null;var Gt=1<<ct,Vt=pn(ct,ge=(ge%Gt+Gt)%Gt,se);if(this.tiles[Vt])return Oi(this.tiles[Vt],yt);Ot>1&&console.log("drilling down to z%d-%d-%d",ct,ge,se);for(var Et,Jt=ct,Bn=ge,mn=se;!Et&&Jt>0;)Jt--,Bn=Math.floor(Bn/2),mn=Math.floor(mn/2),Et=this.tiles[pn(Jt,Bn,mn)];return Et&&Et.source?(Ot>1&&console.log("found parent tile z%d-%d-%d",Jt,Bn,mn),Ot>1&&console.time("drilling down"),this.splitTile(Et.source,Jt,Bn,mn,ct,ge,se),Ot>1&&console.timeEnd("drilling down"),this.tiles[Vt]?Oi(this.tiles[Vt],yt):null):null};class Cn extends a.VectorTileWorkerSource{constructor(ge,se,tt,yt,Ot){super(ge,se,tt,yt,sn),Ot&&(this.loadGeoJSON=Ot)}loadData(ge,se){const tt=ge&&ge.request,yt=tt&&tt.collectResourceTiming;this.loadGeoJSON(ge,(Ot,Gt)=>{if(Ot||!Gt)return se(Ot);if("object"!=typeof Gt)return se(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`));{ee(Gt,!0);try{if(ge.filter){const Et=a.createExpression(ge.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Et.result)throw new Error(Et.value.map(Bn=>`${Bn.key}: ${Bn.message}`).join(", "));Gt={type:"FeatureCollection",features:Gt.features.filter(Bn=>Et.value.evaluate({zoom:0},Bn))}}this._geoJSONIndex=ge.cluster?new ke(function({superclusterOptions:Et,clusterProperties:Jt}){if(!Jt||!Et)return Et;const Bn={},mn={},ae={accumulated:null,zoom:0},ht={properties:null},G=Object.keys(Jt);for(const ze of G){const[at,rn]=Jt[ze],Dn=a.createExpression(rn),gi=a.createExpression("string"==typeof at?[at,["accumulated"],["get",ze]]:at);Bn[ze]=Dn.value,mn[ze]=gi.value}return Et.map=ze=>{ht.properties=ze;const at={};for(const rn of G)at[rn]=Bn[rn].evaluate(ae,ht);return at},Et.reduce=(ze,at)=>{ht.properties=at;for(const rn of G)ae.accumulated=ze[rn],ze[rn]=mn[rn].evaluate(ae,ht)},Et}(ge)).load(Gt.features):new Bi(Et=Gt,ge.geojsonVtOptions)}catch(Et){return se(Et)}this.loaded={};const Vt={};if(yt){const Et=a.getPerformanceMeasurement(tt);Et&&(Vt.resourceTiming={},Vt.resourceTiming[ge.source]=JSON.parse(JSON.stringify(Et)))}se(null,Vt)}var Et})}reloadTile(ge,se){const tt=this.loaded;return tt&&tt[ge.uid]?super.reloadTile(ge,se):this.loadTile(ge,se)}loadGeoJSON(ge,se){if(ge.request)a.getJSON(ge.request,se);else{if("string"!=typeof ge.data)return se(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`));try{return se(null,JSON.parse(ge.data))}catch{return se(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ge,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(ge.clusterId))}catch(tt){se(tt)}}getClusterChildren(ge,se){try{se(null,this._geoJSONIndex.getChildren(ge.clusterId))}catch(tt){se(tt)}}getClusterLeaves(ge,se){try{se(null,this._geoJSONIndex.getLeaves(ge.clusterId,ge.limit,ge.offset))}catch(tt){se(tt)}}}class $i{constructor(ge){this.self=ge,this.actor=new a.Actor(ge,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:Cn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(se,tt)=>{if(this.workerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.workerSourceTypes[se]=tt},this.self.registerRTLTextPlugin=se=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=se.applyArabicShaping,a.plugin.processBidirectionalText=se.processBidirectionalText,a.plugin.processStyledBidirectionalText=se.processStyledBidirectionalText}}clearCaches(ge,se,tt){delete this.layerIndexes[ge],delete this.availableImages[ge],delete this.workerSources[ge],delete this.demWorkerSources[ge],tt()}checkIfReady(ge,se,tt){tt()}setReferrer(ge,se){this.referrer=se}spriteLoaded(ge,se){this.isSpriteLoaded[ge]=se;for(const tt in this.workerSources[ge]){const yt=this.workerSources[ge][tt];for(const Ot in yt)yt[Ot]instanceof a.VectorTileWorkerSource&&(yt[Ot].isSpriteLoaded=se,yt[Ot].fire(new a.Event("isSpriteLoaded")))}}setImages(ge,se,tt){this.availableImages[ge]=se;for(const yt in this.workerSources[ge]){const Ot=this.workerSources[ge][yt];for(const Gt in Ot)Ot[Gt].availableImages=se}tt()}enableTerrain(ge,se,tt){this.terrain=se,tt()}setProjection(ge,se){this.projections[ge]=a.getProjection(se)}setLayers(ge,se,tt){this.getLayerIndex(ge).replace(se),tt()}updateLayers(ge,se,tt){this.getLayerIndex(ge).update(se.layers,se.removedIds),tt()}loadTile(ge,se,tt){const yt=this.enableTerrain?a.extend({enableTerrain:this.terrain},se):se;yt.projection=this.projections[ge]||this.defaultProjection,this.getWorkerSource(ge,se.type,se.source).loadTile(yt,tt)}loadDEMTile(ge,se,tt){const yt=this.enableTerrain?a.extend({buildQuadTree:this.terrain},se):se;this.getDEMWorkerSource(ge,se.source).loadTile(yt,tt)}reloadTile(ge,se,tt){const yt=this.enableTerrain?a.extend({enableTerrain:this.terrain},se):se;yt.projection=this.projections[ge]||this.defaultProjection,this.getWorkerSource(ge,se.type,se.source).reloadTile(yt,tt)}abortTile(ge,se,tt){this.getWorkerSource(ge,se.type,se.source).abortTile(se,tt)}removeTile(ge,se,tt){this.getWorkerSource(ge,se.type,se.source).removeTile(se,tt)}removeSource(ge,se,tt){if(!this.workerSources[ge]||!this.workerSources[ge][se.type]||!this.workerSources[ge][se.type][se.source])return;const yt=this.workerSources[ge][se.type][se.source];delete this.workerSources[ge][se.type][se.source],void 0!==yt.removeSource?yt.removeSource(se,tt):tt()}loadWorkerSource(ge,se,tt){try{this.self.importScripts(se.url),tt()}catch(yt){tt(yt.toString())}}syncRTLPluginState(ge,se,tt){try{a.plugin.setState(se);const yt=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&null!=yt){this.self.importScripts(yt);const Ot=a.plugin.isParsed();tt(Ot?void 0:new Error(`RTL Text Plugin failed to import scripts from ${yt}`),Ot)}}catch(yt){tt(yt.toString())}}getAvailableImages(ge){let se=this.availableImages[ge];return se||(se=[]),se}getLayerIndex(ge){let se=this.layerIndexes[ge];return se||(se=this.layerIndexes[ge]=new C),se}getWorkerSource(ge,se,tt){return this.workerSources[ge]||(this.workerSources[ge]={}),this.workerSources[ge][se]||(this.workerSources[ge][se]={}),this.workerSources[ge][se][tt]||(this.workerSources[ge][se][tt]=new this.workerSourceTypes[se]({send:(Ot,Gt,Vt,Et,Jt,Bn)=>{this.actor.send(Ot,Gt,Vt,ge,Jt,Bn)},scheduler:this.actor.scheduler},this.getLayerIndex(ge),this.getAvailableImages(ge),this.isSpriteLoaded[ge])),this.workerSources[ge][se][tt]}getDEMWorkerSource(ge,se){return this.demWorkerSources[ge]||(this.demWorkerSources[ge]={}),this.demWorkerSources[ge][se]||(this.demWorkerSources[ge][se]=new oe),this.demWorkerSources[ge][se]}enforceCacheSizeLimit(ge,se){a.enforceCacheSizeLimit(se)}getWorkerPerformanceMetrics(ge,se,tt){tt(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new $i(self)),$i}),p(0,function(a){function j(d,n){if(Array.isArray(d)){if(!Array.isArray(n)||d.length!==n.length)return!1;for(let c=0;c<d.length;c++)if(!j(d[c],n[c]))return!1;return!0}if("object"==typeof d&&null!==d&&null!==n){if("object"!=typeof n||Object.keys(d).length!==Object.keys(n).length)return!1;for(const c in d)if(!j(d[c],n[c]))return!1;return!0}return d===n}var K=C;function C(d){return n=d,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,v,b=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(b);try{v=new Worker(I),m=!0}catch{m=!1}return v&&v.terminate(),URL.revokeObjectURL(I),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var v=m.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===m.width}()||(void 0===oe[c=n&&n.failIfMajorPerformanceCaveat]&&(oe[c]=function(m){var v,I,M,N,b=(I=m,M=document.createElement("canvas"),(N=Object.create(C.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,M.getContext("webgl",N)||M.getContext("experimental-webgl",N));if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),!0===b.getShaderParameter(v,b.COMPILE_STATUS))}(c)),!oe[c]||document.documentMode));var n,c}var oe={};function _e(d,n,c){const m=a.window.document.createElement(d);return void 0!==n&&(m.className=n),c&&c.appendChild(m),m}function Le(d,n,c){const m=a.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const v of Object.keys(n))m.setAttributeNS(null,v,n[v]);return c&&c.appendChild(m),m}C.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ee=a.window.document&&a.window.document.documentElement.style,Te=ee&&void 0!==ee.userSelect?"userSelect":"WebkitUserSelect";let ye;function De(){ee&&Te&&(ye=ee[Te],ee[Te]="none")}function me(){ee&&Te&&(ee[Te]=ye)}function Ye(d){d.preventDefault(),d.stopPropagation(),a.window.removeEventListener("click",Ye,!0)}function Ce(){a.window.addEventListener("click",Ye,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",Ye,!0)},0)}function de(d,n){const c=d.getBoundingClientRect();return Ne(d,c,n)}function Pe(d,n){const c=d.getBoundingClientRect(),m=[];for(let v=0;v<n.length;v++)m.push(Ne(d,c,n[v]));return m}function Be(d){return void 0!==a.window.InstallTrigger&&2===d.button&&d.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function Ne(d,n,c){const m=d.offsetWidth===n.width?1:d.offsetWidth/n.width;return new a.Point((c.clientX-n.left)*m,(c.clientY-n.top)*m)}function Ae(d,n){var c=n[0],m=n[1],v=n[2],b=n[3],I=c*b-v*m;return I?(d[0]=b*(I=1/I),d[1]=-m*I,d[2]=-v*I,d[3]=c*I,d):null}function Ge(d){const{userImage:n}=d;return!!(n&&n.render&&n.render())&&(d.data.replace(new Uint8Array(n.data.buffer)),!0)}class lt extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:c,callback:m}of this.requestors)this._notify(c,m);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,c){this._validate(n,c)&&(this.images[n]=c)}_validate(n,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),m=!1),m}_validateStretch(n,c){if(!n)return!0;let m=0;for(const v of n){if(v[0]<m||v[1]<v[0]||c<v[1])return!1;m=v[1]}return!0}_validateContent(n,c){return!(n&&(4!==n.length||n[0]<0||c.data.width<n[0]||n[1]<0||c.data.height<n[1]||n[2]<0||c.data.width<n[2]||n[3]<0||c.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,c){c.version=this.images[n].version+1,this.images[n]=c,this.updatedImages[n]=!0}removeImage(n){const c=this.images[n];delete this.images[n],delete this.patterns[n],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,c){let m=!0;if(!this.isLoaded())for(const v of n)this.images[v]||(m=!1);this.isLoaded()||m?this._notify(n,c):this.requestors.push({ids:n,callback:c})}_notify(n,c){const m={};for(const v of n){this.images[v]||this.fire(new a.Event("styleimagemissing",{id:v}));const b=this.images[v];b?m[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!(!b.userImage||!b.userImage.render)}:a.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,m)}getPixelSize(){const{width:n,height:c}=this.atlasImage;return{width:n,height:c}}getPattern(n){const c=this.patterns[n],m=this.getImage(n);if(!m)return null;if(c&&c.position.version===m.version)return c.position;if(c)c.position.version=m.version;else{const v={w:m.data.width+2,h:m.data.height+2,x:0,y:0},b=new a.ImagePosition(v,m);this.patterns[n]={bin:v,position:b}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const c=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(n,this.atlasImage,c.RGBA),this.atlasTexture&&this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const b in this.patterns)n.push(this.patterns[b].bin);const{w:c,h:m}=a.potpack(n),v=this.atlasImage;v.resize({width:c||1,height:m||1});for(const b in this.patterns){const{bin:I}=this.patterns[b],M=I.x+1,N=I.y+1,Z=this.images[b].data,$=Z.width,re=Z.height;a.RGBAImage.copy(Z,v,{x:0,y:0},{x:M,y:N},{width:$,height:re}),a.RGBAImage.copy(Z,v,{x:0,y:re-1},{x:M,y:N-1},{width:$,height:1}),a.RGBAImage.copy(Z,v,{x:0,y:0},{x:M,y:N+re},{width:$,height:1}),a.RGBAImage.copy(Z,v,{x:$-1,y:0},{x:M-1,y:N},{width:1,height:re}),a.RGBAImage.copy(Z,v,{x:0,y:0},{x:M+$,y:N},{width:1,height:re})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const c of n){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const m=this.images[c];Ge(m)&&this.updateImage(c,m)}}}const ne=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(d,n){return function([c,m,v]){const b=a.degToRad(m+90),I=a.degToRad(v);return{x:c*Math.cos(b)*Math.sin(I),y:c*Math.sin(b)*Math.sin(I),z:c*Math.cos(I),azimuthal:m,polar:v}}(d.expression.evaluate(n))}interpolate(d,n,c){return{x:a.number(d.x,n.x,c),y:a.number(d.y,n.y,c),z:a.number(d.z,n.z,c),azimuthal:a.number(d.azimuthal,n.azimuthal,c),polar:a.number(d.polar,n.polar,c)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)});class Ee extends a.Evented{constructor(n){super(),this._transitionable=new a.Transitionable(ne),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,c={}){if(!this._validate(a.validateLight,n,c))for(const m in n){const v=n[m];a.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),v):this._transitionable.setValue(m,v)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,m){return(!m||!1!==m.validate)&&a.emitValidationErrors(this,n.call(a.validateStyle,a.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const xe=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)});let je=class extends a.Evented{constructor(d,n){super(),this._transitionable=new a.Transitionable(xe),this.set(d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(d){for(const n in d){const c=d[n];a.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-11),c):this._transitionable.setValue(n,c)}}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}};function Se(d,n,c,m){const v=a.smoothstep(45,65,c),[b,I]=Ve(d,m),M=a.length(n);let N=1-Math.min(1,Math.exp((M-b)/(I-b)*-6));return N*=N*N,N=Math.min(1,1.00747*N),N*v*d.alpha}function Ve(d,n){const c=.5/Math.tan(.5*n);return[d.range[0]+c,d.range[1]+c]}const Xe=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])});class Ht extends a.Evented{constructor(n,c){super(),this._transitionable=new a.Transitionable(Xe),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const n=this._transform,c="globe"===n.projection.name,m=a.globeToMercatorTransition(n.zoom),v=this.properties.get("range"),b=[.5,3];return{range:c?[a.number(b[0],v[0],m),a.number(b[1],v[1],m)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,c={}){if(!this._validate(a.validateFog,n,c)){for(const m of Object.keys(a.spec.fog))n&&void 0===n[m]&&(n[m]=a.spec.fog[m].default);for(const m in n){const v=n[m];a.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),v):this._transitionable.setValue(m,v)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:a.smoothstep(45,65,n))*c.a}getOpacityAtLatLng(n,c){return this._transform.projection.supportsFog?function(m,v,b){const I=a.MercatorCoordinate.fromLngLat(v),M=b.elevation?b.elevation.getAtPointOrZero(I):0,N=[I.x,I.y,M];return a.transformMat4(N,N,b.mercatorFogMatrix),Se(m,N,b.pitch,b._fov)}(this.state,n,c):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Ve(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,m){return(!m||!1!==m.validate)&&a.emitValidationErrors(this,n.call(a.validateStyle,a.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class cn{constructor(n,c){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const m=this.workerPool.acquire(this.id);for(let v=0;v<m.length;v++){const b=new cn.Actor(m[v],c,this.id);b.name=`Worker ${v}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,c,m){a.asyncAll(this.actors,(v,b)=>{v.send(n,c,b)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function xn(d,n,c){return n*(a.EXTENT/(d.tileSize*Math.pow(2,c-d.tileID.overscaledZ)))}cn.Actor=a.Actor;class $t{constructor(n,c,m,v){this.screenBounds=n,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(n,c){let m,v;if(n instanceof a.Point||"number"==typeof n[0]){const b=a.Point.convert(n);m=[b],v=c.isPointAboveHorizon(b)}else{const b=a.Point.convert(n[0]),I=a.Point.convert(n[1]);m=[b,I],v=a.polygonizeBounds(b,I).every(M=>c.isPointAboveHorizon(M))}return new $t(m,c.getCameraPoint(),v,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(n){return a.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const c=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],v=a.polygonizeBounds(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?v[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(v[3]=this.cameraPoint)),a.bufferConvexPolygon(v,n)}bufferedCameraGeometryGlobe(n){const c=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],v=a.polygonizeBounds(c,m,n),b=this.cameraPoint.clone();switch(3*((b.y>c.y)+(b.y>m.y))+((b.x>c.x)+(b.x>m.x))){case 0:v[0]=b,v[4]=b.clone();break;case 1:v.splice(1,0,b);break;case 2:v[1]=b;break;case 3:v.splice(4,0,b);break;case 5:v.splice(2,0,b);break;case 6:v[3]=b;break;case 7:v.splice(3,0,b);break;case 8:v[2]=b}return v}containsTile(n,c,m,v=0){const b=n.queryPadding/c._pixelsPerMercatorPixel+1,I=m?this._bufferedCameraMercator(b,c):this._bufferedScreenMercator(b,c);let M=n.tileID.wrap+(I.unwrapped?v:0);const N=I.polygon.map(nt=>a.getTilePoint(n.tileTransform,nt,M));if(!a.polygonIntersectsBox(N,0,0,a.EXTENT,a.EXTENT))return;M=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const Z=this.screenGeometryMercator.polygon.map(nt=>a.getTileVec3(n.tileTransform,nt,M)),$=Z.map(nt=>new a.Point(nt[0],nt[1])),re=c.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),Re=a.getTileVec3(n.tileTransform,re,M),Fe=Z.map(nt=>{const ce=a.sub(nt,nt,Re);return a.normalize(ce,ce),new a.Ray(Re,ce)}),et=xn(n,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:$,tilespaceRays:Fe,bufferedTilespaceGeometry:N,bufferedTilespaceBounds:(Qe=a.getBounds(N),Qe.min.x=a.clamp(Qe.min.x,0,a.EXTENT),Qe.min.y=a.clamp(Qe.min.y,0,a.EXTENT),Qe.max.x=a.clamp(Qe.max.x,0,a.EXTENT),Qe.max.y=a.clamp(Qe.max.y,0,a.EXTENT),Qe),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:et};var Qe}_bufferedScreenMercator(n,c){const m=Oe(n);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let v;return v="globe"===c.projection.name?this._projectAndResample(this.bufferedScreenGeometry(n),c):{polygon:this.bufferedScreenGeometry(n).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[m]=v,v}}_bufferedCameraMercator(n,c){const m=Oe(n);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let v;return v="globe"===c.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),c):{polygon:this.bufferedCameraGeometry(n).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[m]=v,v}}_projectAndResample(n,c){const m=function(b,I){const M=a.multiply([],I.pixelMatrix,I.globeMatrix),N=[0,-a.GLOBE_RADIUS,0,1],Z=[0,a.GLOBE_RADIUS,0,1],$=[0,0,0,1];a.transformMat4$1(N,N,M),a.transformMat4$1(Z,Z,M),a.transformMat4$1($,$,M);const re=new a.Point(N[0]/N[3],N[1]/N[3]),Re=new a.Point(Z[0]/Z[3],Z[1]/Z[3]),Fe=a.polygonContainsPoint(b,re)&&N[3]<$[3],et=a.polygonContainsPoint(b,Re)&&Z[3]<$[3];if(!Fe&&!et)return null;const Qe=function(Rt,qt,Wt){for(let an=1;an<Rt.length;an++){const Yn=pe(qt.pointCoordinate3D(Rt[an-1]).x),tn=pe(qt.pointCoordinate3D(Rt[an]).x);if(Wt<0){if(Yn<tn)return{idx:an,t:-Yn/(tn-1-Yn)}}else if(tn<Yn)return{idx:an,t:(1-Yn)/(tn+1-Yn)}}return null}(b,I,Fe?-1:1);if(!Qe)return null;const{idx:nt,t:ce}=Qe;let We=nt>1?ke(b.slice(0,nt),I):[],pt=nt<b.length?ke(b.slice(nt),I):[];We=We.map(Rt=>new a.Point(pe(Rt.x),Rt.y)),pt=pt.map(Rt=>new a.Point(pe(Rt.x),Rt.y));const gt=[...We];0===gt.length&&gt.push(pt[pt.length-1]);const Pt=a.number(gt[gt.length-1].y,(0===pt.length?We[0]:pt[0]).y,ce);let Ft;return Ft=Fe?[new a.Point(0,Pt),new a.Point(0,0),new a.Point(1,0),new a.Point(1,Pt)]:[new a.Point(1,Pt),new a.Point(1,1),new a.Point(0,1),new a.Point(0,Pt)],gt.push(...Ft),0===pt.length?gt.push(We[0]):gt.push(...pt),{polygon:gt.map(Rt=>new a.MercatorCoordinate(Rt.x,Rt.y)),unwrapped:!1}}(n,c);if(m)return m;const v=function(b,I){let M=!1,N=-1/0,Z=0;for(let re=0;re<b.length-1;re++)b[re].x>N&&(N=b[re].x,Z=re);for(let re=0;re<b.length-1;re++){const Re=(Z+re)%(b.length-1),Fe=b[Re],et=b[Re+1];Math.abs(Fe.x-et.x)>.5&&(Fe.x<et.x?(Fe.x+=1,0===Re&&(b[b.length-1].x+=1)):(et.x+=1,Re+1===b.length-1&&(b[0].x+=1)),M=!0)}const $=a.mercatorXfromLng(I.center.lng);return M&&$<Math.abs($-1)&&b.forEach(re=>{re.x-=1}),{polygon:b,unwrapped:M}}(ke(n,c).map(b=>new a.Point(pe(b.x),b.y)),c);return{polygon:v.polygon.map(b=>new a.MercatorCoordinate(b.x,b.y)),unwrapped:v.unwrapped}}}function ke(d,n){return a.resample(d,c=>{const m=n.pointCoordinate3D(c);c.x=m.x,c.y=m.y},1/256)}function pe(d){return d<0?1+d%1:d%1}function Oe(d){return 100*d|0}function ie(d,n,c,m,v){const b=function(I,M){if(I)return v(I);if(M){d.url&&M.tiles&&d.tiles&&delete d.tiles;const N=a.pick(a.extend(M,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(N.vectorLayers=M.vector_layers,N.vectorLayerIds=N.vectorLayers.map(Z=>Z.id)),N.tiles=n.canonicalizeTileset(N,d.url),v(null,N)}};return d.url?a.getJSON(n.transformRequest(n.normalizeSourceURL(d.url,null,c,m),a.ResourceType.Source),b):a.exported.frame(()=>b(null,d))}class it{constructor(n,c,m){this.bounds=a.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=c||0,this.maxzoom=m||24}validateBounds(n){return Array.isArray(n)&&4===n.length?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const c=Math.pow(2,n.z),m=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*c),v=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*c),b=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*c),I=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*c);return n.x>=m&&n.x<b&&n.y>=v&&n.y<I}}class _t{constructor(n,c,m){this.context=n;const v=n.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Kt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Mn{constructor(n,c,m,v){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=v,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),n.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,c){for(let m=0;m<this.attributes.length;m++){const v=c.attributes[this.attributes[m].name];void 0!==v&&n.enableVertexAttribArray(v)}}setVertexAttribPointers(n,c,m){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],I=c.attributes[b.name];void 0!==I&&n.vertexAttribPointer(I,b.components,n[Kt[b.type]],!1,this.itemSize,b.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class fn{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qn extends fn{getDefault(){return a.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class li extends fn{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class en extends fn{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Dt extends fn{getDefault(){return[!0,!0,!0,!0]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ie extends fn{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Ct extends fn{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class on extends fn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const c=this.current;(n.func!==c.func||n.ref!==c.ref||n.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Rn extends fn{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Vn extends fn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=n,this.dirty=!1}}class Ut extends fn{getDefault(){return[0,1]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Hn extends fn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=n,this.dirty=!1}}class qe extends fn{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Nt extends fn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.BLEND):c.disable(c.BLEND),this.current=n,this.dirty=!1}}class Xt extends fn{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Tn extends fn{getDefault(){return a.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class oi extends fn{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class xi extends fn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=n,this.dirty=!1}}class Oi extends fn{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class gr extends fn{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let ki,Wi=class extends fn{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class _n extends fn{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Bi extends fn{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class pn extends fn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class sn extends fn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Cn extends fn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class $i extends fn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ct extends fn{getDefault(){return null}set(n){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ge extends fn{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class se extends fn{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class tt extends fn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class yt extends fn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Ot extends fn{constructor(n,c){super(n),this.context=n,this.parent=c}getDefault(){return null}}class Gt extends Ot{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Vt extends Ot{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Et extends Vt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Jt{constructor(n,c,m,v){this.context=n,this.width=c,this.height=m;const b=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Gt(n,b),v&&(this.depthAttachment=new Vt(n,b))}destroy(){const n=this.context.gl,c=this.colorAttachment.get();if(c&&n.deleteTexture(c),this.depthAttachment){const m=this.depthAttachment.get();m&&n.deleteRenderbuffer(m)}n.deleteFramebuffer(this.framebuffer)}}class Bn{constructor(n,c=!1){if(this.gl=n,this.isWebGL2=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),c){const m=n;this.extVertexArrayObject={createVertexArrayOES:m.createVertexArray.bind(n),deleteVertexArrayOES:m.deleteVertexArray.bind(n),bindVertexArrayOES:m.bindVertexArray.bind(n)}}this.clearColor=new qn(this),this.clearDepth=new li(this),this.clearStencil=new en(this),this.colorMask=new Dt(this),this.depthMask=new Ie(this),this.stencilMask=new Ct(this),this.stencilFunc=new on(this),this.stencilOp=new Rn(this),this.stencilTest=new Vn(this),this.depthRange=new Ut(this),this.depthTest=new Hn(this),this.depthFunc=new qe(this),this.blend=new Nt(this),this.blendFunc=new Xt(this),this.blendColor=new Tn(this),this.blendEquation=new oi(this),this.cullFace=new xi(this),this.cullFaceSide=new Oi(this),this.frontFace=new gr(this),this.program=new Wi(this),this.activeTexture=new _n(this),this.viewport=new Bi(this),this.bindFramebuffer=new pn(this),this.bindRenderbuffer=new sn(this),this.bindTexture=new Cn(this),this.bindVertexBuffer=new $i(this),this.bindElementBuffer=new ct(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ge(this),this.pixelStoreUnpack=new se(this),this.pixelStoreUnpackPremultiplyAlpha=new tt(this),this.pixelStoreUnpackFlipY=new yt(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),c||(this.extTextureHalfFloat=n.getExtension("OES_texture_half_float")),(c||this.extTextureHalfFloat&&n.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c||n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,c){return new _t(this,n,c)}createVertexBuffer(n,c,m){return new Mn(this,n,c,m)}createRenderbuffer(n,c,m){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,n,c,m),this.bindRenderbuffer.set(null),b}createFramebuffer(n,c,m){return new Jt(this,n,c,m)}clear({color:n,depth:c,stencil:m}){const v=this.gl;let b=0;n&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==m&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),v.clear(b)}setCullFace(n){!1===n.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){j(n.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class mn extends a.Evented{constructor(n,c,m,v){if(super(),this.id=n,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(c,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(n){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=ie(this._options,this.map._requestManager,c,m,(v,b)=>{this._tileJSONRequest=null,this._loaded=!0,v?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),m&&2!==m.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new a.ErrorEvent(v))):b&&(a.extend(this,b),b.bounds&&(this.tileBounds=new it(b.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(b.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(v)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}loadTile(n,c){const m=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(m,a.ResourceType.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile};if(v.request.collectResourceTiming=this._collectResourceTiming,n.actor&&"expired"!==n.state)"loading"===n.state?n.reloadCallback=c:n.request=n.actor.send("reloadTile",v,b.bind(this));else if(n.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",v,b.bind(this),void 0,!0);else{const I=a.loadVectorTile.call({deduped:this._deduped},v,(M,N)=>{M||!N?b.call(this,M):(v.data={cacheControl:N.cacheControl,expires:N.expires,rawData:N.rawData.slice(0)},n.actor&&n.actor.send("loadTile",v,b.bind(this),void 0,!0))},!0);n.request={cancel:I}}function b(I,M){return delete n.request,n.aborted?c(null):I&&404!==I.status?c(I):(M&&M.resourceTiming&&(n.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&n.setExpiryData(M),n.loadVectorData(M,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id})}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ae extends a.Evented{constructor(n,c,m,v){super(),this.id=n,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},c),a.extend(this,a.pick(c,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ie(this._options,this.map._requestManager,null,null,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new a.ErrorEvent(c)):m&&(a.extend(this,m),m.bounds&&(this.tileBounds=new it(m.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(m.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(c)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,c){const m=a.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);n.request=a.getImage(this.map._requestManager.transformRequest(v,a.ResourceType.Tile),(b,I,M,N)=>(delete n.request,n.aborted?(n.state="unloaded",c(null)):b?(n.state="errored",c(b)):I?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:M,expires:N}),n.setTexture(I,this.map.painter),n.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(n,c,m){n.setTexture(c,m)}static unloadTileData(n,c){n.texture&&c.saveTileTexture(n.texture)}abortTile(n,c){n.request&&(n.request.cancel(),delete n.request),c()}unloadTile(n,c){n.texture&&this.map.painter.saveTileTexture(n.texture),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ht(d,n,c,m,v,b,I,M){const N=[d,c,v,n,m,b,1,1,1],Z=[I,M,1],$=a.adjoint([],N),[re,Re,Fe]=a.transformMat3(Z,Z,a.transpose($,$));return a.multiply$1(N,[re,0,0,0,Re,0,0,0,Fe],N)}class G extends a.Evented{constructor(n,c,m,v){super(),this.id=n,this.dispatcher=m,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=c,this._dirty=!1}load(n,c){this._loaded=c||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(m,v)=>{if(this._imageRequest=null,this._loaded=!0,m)this.fire(new a.ErrorEvent(m));else if(v){const{HTMLImageElement:b}=a.window;this.image=v instanceof b?a.exported.getImageData(v):v,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const c=n.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let v=1/0,b=1/0,I=-1/0,M=-1/0;for(const re of m)v=Math.min(v,re.x),b=Math.min(b,re.y),I=Math.max(I,re.x),M=Math.max(M,re.y);const N=Math.max(I-v,M-b),Z=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),$=Math.pow(2,Z);return new a.CanonicalTileID(Z,Math.floor((v+I)/2*$),Math.floor((b+M)/2*$))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const N in this.tiles){const Z=this.tiles[N];"loaded"!==Z.state&&(Z.state="loaded",Z.texture=this.texture)}if(this._boundsArray)return;const c=a.tileTransform(this.tileID,this.map.transform.projection),[m,v,b,I]=this.coordinates.map(N=>{const Z=c.projection.project(N[0],N[1]);return a.getTilePoint(c,Z)._round()});this.perspectiveTransform=function(N,Z,$,re,Re,Fe,et,Qe,nt,ce){const We=ht(0,0,N,0,0,Z,N,Z),pt=ht($,re,Re,Fe,et,Qe,nt,ce);return a.multiply$1(pt,a.adjoint(We,We),pt),[pt[6]/pt[8]*N/a.EXTENT,pt[7]/pt[8]*Z/a.EXTENT]}(this.width,this.height,m.x,m.y,v.x,v.y,I.x,I.y,b.x,b.y);const M=this._boundsArray=new a.StructArrayLayout4i8;M.emplaceBack(m.x,m.y,0,0),M.emplaceBack(v.x,v.y,a.EXTENT,0),M.emplaceBack(I.x,I.y,0,a.EXTENT),M.emplaceBack(b.x,b.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(M,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const n=this.map.painter.context,c=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new a.Texture(n,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,c){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},c(null)):(n.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ze={vector:mn,raster:ae,"raster-dem":class extends ae{constructor(d,n,c,m){super(d,n,c,m),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(d,n){const c=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(v,b){v&&(d.state="errored",n(v)),b&&(d.dem=b,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",n(null))}d.request=a.getImage(this.map._requestManager.transformRequest(c,a.ResourceType.Tile),function(v,b,I,M){if(delete d.request,d.aborted)d.state="unloaded",n(null);else if(v)d.state="errored",n(v);else if(b){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:I,expires:M});const N=a.window.ImageBitmap&&b instanceof a.window.ImageBitmap&&(null==ki&&(ki=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof a.window.createImageBitmap),ki),Z=1-(b.width-a.prevPowerOfTwo(b.width))/2;Z<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const $=N?b:a.exported.getImageData(b,Z),re={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:$,encoding:this.encoding,padding:Z};d.actor&&"expired"!==d.state||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",re,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){const n=d.canonical,c=Math.pow(2,n.z),m=(n.x-1+c)%c,v=0===n.x?d.wrap-1:d.wrap,b=(n.x+1+c)%c,I=n.x+1===c?d.wrap+1:d.wrap,M={};return M[new a.OverscaledTileID(d.overscaledZ,v,n.z,m,n.y).key]={backfilled:!1},M[new a.OverscaledTileID(d.overscaledZ,I,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(M[new a.OverscaledTileID(d.overscaledZ,v,n.z,m,n.y-1).key]={backfilled:!1},M[new a.OverscaledTileID(d.overscaledZ,d.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},M[new a.OverscaledTileID(d.overscaledZ,I,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<c&&(M[new a.OverscaledTileID(d.overscaledZ,v,n.z,m,n.y+1).key]={backfilled:!1},M[new a.OverscaledTileID(d.overscaledZ,d.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},M[new a.OverscaledTileID(d.overscaledZ,I,n.z,b,n.y+1).key]={backfilled:!1}),M}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends a.Evented{constructor(d,n,c,m){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=n.data,this._options=a.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const v=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*v,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*v,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*v,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},n),this}getClusterChildren(d,n){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},n),this}getClusterLeaves(d,n,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:n,offset:c},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=a.extend({},this.workerOptions),n=this._data;"string"==typeof n?(d.request=this.map._requestManager.transformRequest(a.exported.resolveURL(n),a.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new a.ErrorEvent(c));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(v.resourceTiming=m.resourceTiming[this.id]),this.fire(new a.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,n){const c=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(c,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,v)=>(delete d.request,d.unloadVectorData(),d.aborted?n(null):m?n(m):(d.loadVectorData(v,this.map.painter,"reloadTile"===c),n(null))),void 0,"loadTile"===c)}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends G{constructor(d,n,c,m){super(d,n,c,m),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const n of d.urls)this.urls.push(this.map._requestManager.transformRequest(n,a.ResourceType.Source).url);a.getVideo(this.urls,(n,c)=>{this._loaded=!0,n?this.fire(new a.ErrorEvent(n)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const n=this.video.seekable;d<n.start(0)||d>n.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const d=this.map.painter.context,n=d.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(d,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:G,canvas:class extends G{constructor(d,n,c,m){super(d,n,c,m),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(b=>"number"!=typeof b))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const n=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends a.Evented{constructor(d,n,c,m){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=n,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new it(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:n,y:c,z:m}=d.canonical;return this._implementation.hasTile({x:n,y:c,z:m})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,n){const{x:c,y:m,z:v}=d.tileID.canonical,b=new a.window.AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:c,y:m,z:v},{signal:b.signal})).then(function(I){return delete d.request,d.aborted?(d.state="unloaded",n(null)):void 0===I?(d.state="errored",n(null)):null===I?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",n(null)):(M=I)instanceof a.window.ImageData||M instanceof a.window.HTMLCanvasElement||M instanceof a.window.ImageBitmap||M instanceof a.window.HTMLImageElement?(this.loadTileData(d,I),d.state="loaded",void n(null)):(d.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var M}.bind(this)).catch(I=>{20!==I.code&&(d.state="errored",n(I))}),d.request.cancel=()=>b.abort()}loadTileData(d,n){ae.loadTileData(d,n,this._map.painter)}unloadTileData(d){ae.unloadTileData(d,this._map.painter)}unloadTile(d,n){if(this.unloadTileData(d),this._implementation.unloadTile){const{x:c,y:m,z:v}=d.tileID.canonical;this._implementation.unloadTile({x:c,y:m,z:v})}n()}abortTile(d,n){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},at=function(d,n,c,m){const v=new ze[n.type](d,n,c,m);if(v.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${v.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],v),v};function rn(d,n){const c=a.identity([]);return a.scale(c,c,[.5*d.width,.5*-d.height,1]),a.translate(c,c,[1,-1,0]),a.multiply(c,c,d.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(c)}function Dn(d,n,c,m,v,b,I,M=!1){const N=d.tilesIn(m,I,M);N.sort(Mi);const Z=[];for(const re of N)Z.push({wrappedTileID:re.tile.tileID.wrapped().key,queryResults:re.tile.queryRenderedFeatures(n,c,d._state,re,v,b,rn(d.transform,re.tile.tileID),M)});const $=function(re){const Re={},Fe={};for(const et of re){const Qe=et.queryResults,nt=et.wrappedTileID,ce=Fe[nt]=Fe[nt]||{};for(const We in Qe){const pt=Qe[We],gt=ce[We]=ce[We]||{},Pt=Re[We]=Re[We]||[];for(const Ft of pt)gt[Ft.featureIndex]||(gt[Ft.featureIndex]=!0,Pt.push(Ft))}}return Re}(Z);for(const re in $)$[re].forEach(Re=>{const Fe=Re.feature,et=Fe.layer;et&&"background"!==et.type&&"sky"!==et.type&&(Fe.source=et.source,et["source-layer"]&&(Fe.sourceLayer=et["source-layer"]),Fe.state=void 0!==Fe.id?d.getFeatureState(et["source-layer"],Fe.id):{})});return $}function gi(d,n){const c=d.getRenderableIds().map(b=>d.getTileByID(b)),m=[],v={};for(let b=0;b<c.length;b++){const I=c[b],M=I.tileID.canonical.key;v[M]||(v[M]=!0,I.querySourceFeatures(m,n))}return m}function Mi(d,n){const c=d.tileID,m=n.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}function Li(){return null!=z.workerClass?new z.workerClass:new a.window.Worker(z.workerUrl)}const yr="mapboxgl_preloaded_worker_pool";class Ui{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Ui.workerCount;)this.workers.push(new Li);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[yr]}numActive(){return Object.keys(this.active).length}}let Fr;function ho(){return Fr||(Fr=new Ui),Fr}function Do(d,n){const c={};for(const m in d)"ref"!==m&&(c[m]=d[m]);return a.refProperties.forEach(m=>{m in n&&(c[m]=n[m])}),c}function Io(d){d=d.slice();const n=Object.create(null);for(let c=0;c<d.length;c++)n[d[c].id]=d[c];for(let c=0;c<d.length;c++)"ref"in d[c]&&(d[c]=Do(d[c],n[d[c].ref]));return d}Ui.workerCount=2;const Zi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function ao(d,n,c){c.push({command:Zi.addSource,args:[d,n[d]]})}function Ro(d,n,c){n.push({command:Zi.removeSource,args:[d]}),c[d]=!0}function xo(d,n,c,m){Ro(d,c,m),ao(d,n,c)}function qi(d,n,c){let m;for(m in d[c])if(d[c].hasOwnProperty(m)&&"data"!==m&&!j(d[c][m],n[c][m]))return!1;for(m in n[c])if(n[c].hasOwnProperty(m)&&"data"!==m&&!j(d[c][m],n[c][m]))return!1;return!0}function Ci(d,n,c,m,v,b){let I;for(I in n=n||{},d=d||{})d.hasOwnProperty(I)&&(j(d[I],n[I])||c.push({command:b,args:[m,I,n[I],v]}));for(I in n)n.hasOwnProperty(I)&&!d.hasOwnProperty(I)&&(j(d[I],n[I])||c.push({command:b,args:[m,I,n[I],v]}))}function Kr(d){return d.id}function Yt(d,n){return d[n.id]=n,d}class Tt{constructor(n,c){this.reset(n,c)}reset(n,c){this.points=n||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(1===this.points.length)return this.points[0];n=a.clamp(n,0,1);let c=1,m=this._distances[c];const v=n*this.paddedLength+this.padding;for(;m<v&&c<this._distances.length;)m=this._distances[++c];const b=c-1,I=this._distances[b],M=m-I,N=M>0?(v-I)/M:0;return this.points[b].mult(1-N).add(this.points[c].mult(N))}}class Mt{constructor(n,c,m){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/m),this.yCellCount=Math.ceil(c/m);for(let I=0;I<this.xCellCount*this.yCellCount;I++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=c,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,c,m,v,b){this._forEachCell(c,m,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(n,c,m,v){this._forEachCell(c-v,m-v,c+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(c),this.circles.push(m),this.circles.push(v)}_insertBoxCell(n,c,m,v,b,I){this.boxCells[b].push(I)}_insertCircleCell(n,c,m,v,b,I){this.circleCells[b].push(I)}_query(n,c,m,v,b,I){if(m<0||n>this.width||v<0||c>this.height)return!b&&[];const M=[];if(n<=0&&c<=0&&this.width<=m&&this.height<=v){if(b)return!0;for(let N=0;N<this.boxKeys.length;N++)M.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const Z=this.circles[3*N],$=this.circles[3*N+1],re=this.circles[3*N+2];M.push({key:this.circleKeys[N],x1:Z-re,y1:$-re,x2:Z+re,y2:$+re})}return I?M.filter(I):M}return this._forEachCell(n,c,m,v,this._queryCell,M,{hitTest:b,seenUids:{box:{},circle:{}}},I),b?M.length>0:M}_queryCircle(n,c,m,v,b){const I=n-m,M=n+m,N=c-m,Z=c+m;if(M<0||I>this.width||Z<0||N>this.height)return!v&&[];const $=[];return this._forEachCell(I,N,M,Z,this._queryCellCircle,$,{hitTest:v,circle:{x:n,y:c,radius:m},seenUids:{box:{},circle:{}}},b),v?$.length>0:$}query(n,c,m,v,b){return this._query(n,c,m,v,!1,b)}hitTest(n,c,m,v,b){return this._query(n,c,m,v,!0,b)}hitTestCircle(n,c,m,v){return this._queryCircle(n,c,m,!0,v)}_queryCell(n,c,m,v,b,I,M,N){const Z=M.seenUids,$=this.boxCells[b];if(null!==$){const Re=this.bboxes;for(const Fe of $)if(!Z.box[Fe]){Z.box[Fe]=!0;const et=4*Fe;if(n<=Re[et+2]&&c<=Re[et+3]&&m>=Re[et+0]&&v>=Re[et+1]&&(!N||N(this.boxKeys[Fe]))){if(M.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[Fe],x1:Re[et],y1:Re[et+1],x2:Re[et+2],y2:Re[et+3]})}}}const re=this.circleCells[b];if(null!==re){const Re=this.circles;for(const Fe of re)if(!Z.circle[Fe]){Z.circle[Fe]=!0;const et=3*Fe;if(this._circleAndRectCollide(Re[et],Re[et+1],Re[et+2],n,c,m,v)&&(!N||N(this.circleKeys[Fe]))){if(M.hitTest)return I.push(!0),!0;{const Qe=Re[et],nt=Re[et+1],ce=Re[et+2];I.push({key:this.circleKeys[Fe],x1:Qe-ce,y1:nt-ce,x2:Qe+ce,y2:nt+ce})}}}}}_queryCellCircle(n,c,m,v,b,I,M,N){const Z=M.circle,$=M.seenUids,re=this.boxCells[b];if(null!==re){const Fe=this.bboxes;for(const et of re)if(!$.box[et]){$.box[et]=!0;const Qe=4*et;if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,Fe[Qe+0],Fe[Qe+1],Fe[Qe+2],Fe[Qe+3])&&(!N||N(this.boxKeys[et])))return I.push(!0),!0}}const Re=this.circleCells[b];if(null!==Re){const Fe=this.circles;for(const et of Re)if(!$.circle[et]){$.circle[et]=!0;const Qe=3*et;if(this._circlesCollide(Fe[Qe],Fe[Qe+1],Fe[Qe+2],Z.x,Z.y,Z.radius)&&(!N||N(this.circleKeys[et])))return I.push(!0),!0}}}_forEachCell(n,c,m,v,b,I,M,N){const Z=this._convertToXCellCoord(n),$=this._convertToYCellCoord(c),re=this._convertToXCellCoord(m),Re=this._convertToYCellCoord(v);for(let Fe=Z;Fe<=re;Fe++)for(let et=$;et<=Re;et++)if(b.call(this,n,c,m,v,this.xCellCount*et+Fe,I,M,N))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,c,m,v,b,I){const M=v-n,N=b-c,Z=m+I;return Z*Z>M*M+N*N}_circleAndRectCollide(n,c,m,v,b,I,M){const N=(I-v)/2,Z=Math.abs(n-(v+N));if(Z>N+m)return!1;const $=(M-b)/2,re=Math.abs(c-(b+$));if(re>$+m)return!1;if(Z<=N||re<=$)return!0;const Re=Z-N,Fe=re-$;return Re*Re+Fe*Fe<=m*m}}const Qt={unknown:0,flipRequired:1,flipNotRequired:2},wn=Math.tan(85*Math.PI/180);function It(d,n,c,m,v,b,I){const M=a.create();if(c)if("globe"===b.name){const N=a.calculateGlobeLabelMatrix(v,n);a.multiply(M,M,N)}else{const N=Ae([],I);M[0]=N[0],M[1]=N[1],M[4]=N[2],M[5]=N[3],m||a.rotateZ(M,M,v.angle)}else a.multiply(M,v.labelPlaneMatrix,d);return M}function Xn(d,n,c,m,v,b,I){const M=It(d,n,c,m,v,b,I);return"globe"===b.name&&c||(M[2]=M[6]=M[10]=M[14]=0),M}function ui(d,n,c,m,v,b,I){if(c){if("globe"===b.name){const M=It(d,n,c,m,v,b,I);return a.invert(M,M),a.multiply(M,d,M),M}{const M=a.clone(d),N=a.identity([]);return N[0]=I[0],N[1]=I[1],N[4]=I[2],N[5]=I[3],a.multiply(M,M,N),m||a.rotateZ(M,M,-v.angle),M}}return v.glCoordMatrix}function Wn(d,n,c,m){const v=[d,n,c,1];c?a.transformMat4$1(v,v,m):Kn(v,v,m);const b=v[3];return v[0]/=b,v[1]/=b,v[2]/=b,v}function lr(d,n){return Math.min(.5+d/n*.5,1.5)}function Je(d,n){const c=d[0]/d[3],m=d[1]/d[3];return c>=-n[0]&&c<=n[0]&&m>=-n[1]&&m<=n[1]}function rt(d,n,c,m,v,b,I,M,N,Z){const $=c.transform,re=m?d.textSizeData:d.iconSizeData,Re=a.evaluateSizeForZoom(re,c.transform.zoom),Fe="globe"===$.projection.name,et=[256/c.width*2+1,256/c.height*2+1],Qe=m?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;Qe.clear();let nt=null;Fe&&(nt=m?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const ce=d.lineVertexArray,We=m?d.text.placedSymbolArray:d.icon.placedSymbolArray,pt=c.transform.width/c.transform.height;let gt,Pt=!1;for(let Ft=0;Ft<We.length;Ft++){const Rt=We.get(Ft),{numGlyphs:qt,writingMode:Wt}=Rt;if(Wt!==a.WritingMode.vertical||Pt||gt===a.WritingMode.horizontal||(Pt=!0),gt=Wt,(Rt.hidden||Wt===a.WritingMode.vertical)&&!Pt){di(qt,Qe);continue}Pt=!1;const an=new a.Point(Rt.tileAnchorX,Rt.tileAnchorY);let{x:Yn,y:tn,z:Pn}=$.projection.projectTilePoint(an.x,an.y,Z.canonical);if(N){const[Ji,wi,Si]=N(an);Yn+=Ji,tn+=wi,Pn+=Si}const dn=[Yn,tn,Pn,1];if(a.transformMat4$1(dn,dn,n),!Je(dn,et)){di(qt,Qe);continue}const Zn=lr(c.transform.cameraToCenterDistance,dn[3]),ln=a.evaluateSizeForFeature(re,Re,Rt),An=I?ln/Zn:ln*Zn,Qn=Wn(Yn,tn,Pn,v);if(Qn[3]<=0){di(qt,Qe);continue}let jn={};const ei=I?null:N,Ai=dt(Rt,An,!1,M,n,v,b,d.glyphOffsetArray,ce,Qe,nt,Qn,an,jn,pt,ei,$.projection,Z,I);Pt=Ai.useVertical,ei&&Ai.needsFlipping&&(jn={}),(Ai.notEnoughRoom||Pt||Ai.needsFlipping&&dt(Rt,An,!0,M,n,v,b,d.glyphOffsetArray,ce,Qe,nt,Qn,an,jn,pt,ei,$.projection,Z,I).notEnoughRoom)&&di(qt,Qe)}m?(d.text.dynamicLayoutVertexBuffer.updateData(Qe),nt&&d.text.globeExtVertexBuffer.updateData(nt)):(d.icon.dynamicLayoutVertexBuffer.updateData(Qe),nt&&d.icon.globeExtVertexBuffer.updateData(nt))}function we(d,n,c,m,v,b,I,M,N,Z,$,re,Re,Fe,et,Qe){const{lineStartIndex:nt,glyphStartIndex:ce,segment:We}=M,pt=ce+M.numGlyphs,gt=nt+M.lineLength,Pt=n.getoffsetX(ce),Ft=n.getoffsetX(pt-1),Rt=ti(d*Pt,c,m,v,b,I,We,nt,gt,N,Z,$,re,Re,!0,Fe,et,Qe);if(!Rt)return null;const qt=ti(d*Ft,c,m,v,b,I,We,nt,gt,N,Z,$,re,Re,!0,Fe,et,Qe);return qt?{first:Rt,last:qt}:null}function ut(d,n,c,m){return d===a.WritingMode.horizontal&&Math.abs(m)>Math.abs(c)?{useVertical:!0}:d===a.WritingMode.vertical?m>0?{needsFlipping:!0}:null:n!==Qt.unknown&&(0===(v=c)||Math.abs(m/v)>wn)?n===Qt.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null;var v}function dt(d,n,c,m,v,b,I,M,N,Z,$,re,Re,Fe,et,Qe,nt,ce,We){const pt=n/24,gt=d.lineOffsetX*pt,Pt=d.lineOffsetY*pt,{lineStartIndex:Ft,glyphStartIndex:Rt,numGlyphs:qt,segment:Wt,writingMode:an,flipState:Yn}=d,tn=Ft+d.lineLength,Pn=dn=>{if($){const[Qn,jn,ei]=dn.up,Ai=Z.length;a.updateGlobeVertexNormal($,Ai+0,Qn,jn,ei),a.updateGlobeVertexNormal($,Ai+1,Qn,jn,ei),a.updateGlobeVertexNormal($,Ai+2,Qn,jn,ei),a.updateGlobeVertexNormal($,Ai+3,Qn,jn,ei)}const[Zn,ln,An]=dn.point;a.addDynamicAttributes(Z,Zn,ln,An,dn.angle)};if(qt>1){const dn=we(pt,M,gt,Pt,c,re,Re,d,N,b,Fe,Qe,!1,nt,ce,We);if(!dn)return{notEnoughRoom:!0};if(m&&!c){let[Zn,ln,An]=dn.first.point,[Qn,jn,ei]=dn.last.point;[Zn,ln]=Wn(Zn,ln,An,I),[Qn,jn]=Wn(Qn,jn,ei,I);const Ai=ut(an,Yn,(Qn-Zn)*et,jn-ln);if(d.flipState=Ai&&Ai.needsFlipping?Qt.flipRequired:Qt.flipNotRequired,Ai)return Ai}Pn(dn.first);for(let Zn=Rt+1;Zn<Rt+qt-1;Zn++){const ln=ti(pt*M.getoffsetX(Zn),gt,Pt,c,re,Re,Wt,Ft,tn,N,b,Fe,Qe,!1,!1,nt,ce,We);if(!ln)return Z.length-=4*(Zn-Rt),{notEnoughRoom:!0};Pn(ln)}Pn(dn.last)}else{if(m&&!c){const Zn=Wn(Re.x,Re.y,0,v),ln=Ft+Wt+1,An=new a.Point(N.getx(ln),N.gety(ln)),Qn=Wn(An.x,An.y,0,v),jn=Qn[3]>0?Qn:gn(Re,An,Zn,1,v,void 0,nt,ce.canonical),ei=ut(an,Yn,(jn[0]-Zn[0])*et,jn[1]-Zn[1]);if(d.flipState=ei&&ei.needsFlipping?Qt.flipRequired:Qt.flipNotRequired,ei)return ei}const dn=ti(pt*M.getoffsetX(Rt),gt,Pt,c,re,Re,Wt,Ft,tn,N,b,Fe,Qe,!1,!1,nt,ce,We);if(!dn)return{notEnoughRoom:!0};Pn(dn)}return{}}function Lt(d,n,c,m,v){const{x:b,y:I,z:M}=m.projectTilePoint(d.x,d.y,n);if(!v)return Wn(b,I,M,c);const[N,Z,$]=v(d);return Wn(b+N,I+Z,M+$,c)}function gn(d,n,c,m,v,b,I,M){const N=Lt(d.sub(n)._unit()._add(d),M,v,I,b);return a.sub(N,c,N),a.normalize(N,N),a.scaleAndAdd(N,c,N,m)}function ti(d,n,c,m,v,b,I,M,N,Z,$,re,Re,Fe,et,Qe,nt,ce){const We=m?d-n:d+n;let pt=We>0?1:-1,gt=0;m&&(pt*=-1,gt=Math.PI),pt<0&&(gt+=Math.PI);let Pt=M+I+(pt>0?0:1)|0,Ft=v,Rt=v,qt=0,Wt=0;const an=Math.abs(We),Yn=[],tn=[];let Pn=b,dn=Pn;const Zn=()=>gn(dn,Pn,Rt,an-qt+1,$,Re,Qe,nt.canonical);for(;qt+Wt<=an;){if(Pt+=pt,Pt<M||Pt>=N)return null;if(Rt=Ft,dn=Pn,Yn.push(Rt),Fe&&tn.push(dn),Pn=new a.Point(Z.getx(Pt),Z.gety(Pt)),Ft=re[Pt],!Ft){const Si=Lt(Pn,nt.canonical,$,Qe,Re);Ft=Si[3]>0?re[Pt]=Si:Zn()}qt+=Wt,Wt=a.distance(Rt,Ft)}et&&Re&&(re[Pt]&&(Ft=Zn(),Wt=a.distance(Rt,Ft)),re[Pt]=Ft);const ln=(an-qt)/Wt,An=Pn.sub(dn)._mult(ln)._add(dn),Qn=a.sub([],Ft,Rt),jn=a.scaleAndAdd([],Rt,Qn,ln);let ei=[0,0,1],Ai=Qn[0],Ji=Qn[1];if(ce&&(ei=Qe.upVector(nt.canonical,An.x,An.y),0!==ei[0]||0!==ei[1]||1!==ei[2])){const Si=[ei[2],0,-ei[0]],fr=a.cross([],ei,Si);a.normalize(Si,Si),a.normalize(fr,fr),Ai=a.dot(Qn,Si),Ji=a.dot(Qn,fr)}if(c){const Si=a.cross([],ei,Qn);a.normalize(Si,Si),a.scaleAndAdd(jn,jn,Si,c*pt)}const wi=gt+Math.atan2(Ji,Ai);return Yn.push(jn),Fe&&tn.push(An),{point:jn,angle:wi,path:Yn,tilePath:tn,up:ei}}function di(d,n){const c=n.length,m=c+4*d;n.resize(m),n.float32.fill(-1/0,4*c,4*m)}function Kn(d,n,c){const m=n[0],v=n[1];return d[0]=c[0]*m+c[4]*v+c[12],d[1]=c[1]*m+c[5]*v+c[13],d[3]=c[3]*m+c[7]*v+c[15],d}const Xi=100;class J{constructor(n,c,m=new Mt(n.width+200,n.height+200,25),v=new Mt(n.width+200,n.height+200,25)){this.transform=n,this.grid=m,this.ignoredGrid=v,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Xi,this.screenBottomBoundary=n.height+Xi,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=c}placeCollisionBox(n,c,m,v,b,I,M,N){let Z=m.projectedAnchorX,$=m.projectedAnchorY,re=m.projectedAnchorZ;const Re=m.elevation,Fe=m.tileID,et=n.getProjection();if(Re&&Fe){const[Ft,Rt,qt]=et.upVector(Fe.canonical,m.tileAnchorX,m.tileAnchorY),Wt=et.upVectorScale(Fe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Z+=Ft*Re*Wt,$+=Rt*Re*Wt,re+=qt*Re*Wt}const Qe=this.projectAndGetPerspectiveRatio(M,Z,$,re,m.tileID,"globe"===et.name||!!Re||this.transform.pitch>0,et),nt=I*Qe.perspectiveRatio,ce=(m.x1*c+v.x-m.padding)*nt+Qe.point.x,We=(m.y1*c+v.y-m.padding)*nt+Qe.point.y,pt=(m.x2*c+v.x+m.padding)*nt+Qe.point.x,gt=(m.y2*c+v.y+m.padding)*nt+Qe.point.y,Pt=Qe.perspectiveRatio<=.55||Qe.occluded;return!this.isInsideGrid(ce,We,pt,gt)||!b&&this.grid.hitTest(ce,We,pt,gt,N)||Pt?{box:[],offscreen:!1,occluded:Qe.occluded}:{box:[ce,We,pt,gt],offscreen:this.isOffscreen(ce,We,pt,gt),occluded:!1}}placeCollisionCircles(n,c,m,v,b,I,M,N,Z,$,re,Re,Fe,et,Qe){const nt=[],ce=this.transform.elevation,We=n.getProjection(),pt=ce?ce.getAtTileOffsetFunc(Qe,this.transform.center.lat,this.transform.worldSize,We):null,gt=new a.Point(m.tileAnchorX,m.tileAnchorY);let{x:Pt,y:Ft,z:Rt}=We.projectTilePoint(gt.x,gt.y,Qe.canonical);if(pt){const[An,Qn,jn]=pt(gt);Pt+=An,Ft+=Qn,Rt+=jn}const qt="globe"===We.name,Wt=this.projectAndGetPerspectiveRatio(M,Pt,Ft,Rt,Qe,qt||!!ce||this.transform.pitch>0,We),{perspectiveRatio:an}=Wt,Yn=(re?I/an:I*an)/a.ONE_EM,tn=Wn(Pt,Ft,Rt,N),Pn=Wt.signedDistanceFromCamera>0?we(Yn,b,m.lineOffsetX*Yn,m.lineOffsetY*Yn,!1,tn,gt,m,v,N,{},ce&&!re?pt:null,re&&!!ce,We,Qe,re):null;let dn=!1,Zn=!1,ln=!0;if(Pn&&!Wt.occluded){const An=.5*Fe*an+et,Qn=new a.Point(-100,-100),jn=new a.Point(this.screenRightBoundary,this.screenBottomBoundary),ei=new Tt,{first:Ai,last:Ji}=Pn,wi=Ai.path.length;let Si=[];for(let Di=wi-1;Di>=1;Di--)Si.push(Ai.path[Di]);for(let Di=1;Di<Ji.path.length;Di++)Si.push(Ji.path[Di]);const fr=2.5*An;Z&&(Si=Si.map(([Di,Dr,Qr],Vr)=>(pt&&!qt&&(Qr=pt(Vr<wi-1?Ai.tilePath[wi-1-Vr]:Ji.tilePath[Vr-wi+2])[2]),Wn(Di,Dr,Qr,Z))),Si.some(Di=>Di[3]<=0)&&(Si=[]));let tr=[];if(Si.length>0){let Di=1/0,Dr=-1/0,Qr=1/0,Vr=-1/0;for(const $r of Si)Di=Math.min(Di,$r[0]),Qr=Math.min(Qr,$r[1]),Dr=Math.max(Dr,$r[0]),Vr=Math.max(Vr,$r[1]);Dr>=Qn.x&&Di<=jn.x&&Vr>=Qn.y&&Qr<=jn.y&&(tr=[Si.map($r=>new a.Point($r[0],$r[1]))],(Di<Qn.x||Dr>jn.x||Qr<Qn.y||Vr>jn.y)&&(tr=a.clipLine(tr,Qn.x,Qn.y,jn.x,jn.y)))}for(const Di of tr){ei.reset(Di,.25*An);let Dr=0;Dr=ei.length<=.5*An?1:Math.ceil(ei.paddedLength/fr)+1;for(let Qr=0;Qr<Dr;Qr++){const Vr=Qr/Math.max(Dr-1,1),$r=ei.lerp(Vr),gs=$r.x+Xi,oo=$r.y+Xi;nt.push(gs,oo,An,0);const wa=gs-An,ca=oo-An,no=gs+An,Zr=oo+An;if(ln=ln&&this.isOffscreen(wa,ca,no,Zr),Zn=Zn||this.isInsideGrid(wa,ca,no,Zr),!c&&this.grid.hitTestCircle(gs,oo,An,Re)&&(dn=!0,!$))return{circles:[],offscreen:!1,collisionDetected:dn,occluded:!1}}}}return{circles:!$&&dn||!Zn?[]:nt,offscreen:ln,collisionDetected:dn,occluded:Wt.occluded}}queryRenderedSymbols(n){if(0===n.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let m=1/0,v=1/0,b=-1/0,I=-1/0;for(const $ of n){const re=new a.Point($.x+Xi,$.y+Xi);m=Math.min(m,re.x),v=Math.min(v,re.y),b=Math.max(b,re.x),I=Math.max(I,re.y),c.push(re)}const M=this.grid.query(m,v,b,I).concat(this.ignoredGrid.query(m,v,b,I)),N={},Z={};for(const $ of M){const re=$.key;if(void 0===N[re.bucketInstanceId]&&(N[re.bucketInstanceId]={}),N[re.bucketInstanceId][re.featureIndex])continue;const Re=[new a.Point($.x1,$.y1),new a.Point($.x2,$.y1),new a.Point($.x2,$.y2),new a.Point($.x1,$.y2)];a.polygonIntersectsPolygon(c,Re)&&(N[re.bucketInstanceId][re.featureIndex]=!0,void 0===Z[re.bucketInstanceId]&&(Z[re.bucketInstanceId]=[]),Z[re.bucketInstanceId].push(re.featureIndex))}return Z}insertCollisionBox(n,c,m,v,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,c,m,v,b){const I=c?this.ignoredGrid:this.grid,M={bucketInstanceId:m,featureIndex:v,collisionGroupID:b};for(let N=0;N<n.length;N+=4)I.insertCircle(M,n[N],n[N+1],n[N+2])}projectAndGetPerspectiveRatio(n,c,m,v,b,I,M){const N=[c,m,v,1];let Z=!1;v||this.transform.pitch>0?(a.transformMat4$1(N,N,n),this.fogState&&b&&"globe"!==M.name&&(Z=function(Re,Fe,et,Qe,nt,ce){const We=ce.calculateFogTileMatrix(nt),pt=[Fe,et,Qe];return a.transformMat4(pt,pt,We),Se(Re,pt,ce.pitch,ce._fov)}(this.fogState,c,m,v,b.toUnwrapped(),this.transform)>.9)):Kn(N,N,n);const $=N[3];return{point:new a.Point((N[0]/$+1)/2*this.transform.width+Xi,(-N[1]/$+1)/2*this.transform.height+Xi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/$*.5,1.5),signedDistanceFromCamera:$,occluded:I&&N[2]>$||Z}}isOffscreen(n,c,m,v){return m<Xi||n>=this.screenRightBoundary||v<Xi||c>this.screenBottomBoundary}isInsideGrid(n,c,m,v){return m>=0&&n<this.gridRightBoundary&&v>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const n=a.identity([]);return a.translate(n,n,[-100,-100,0]),n}}function be(d,n,c){const m=n.createTileMatrix(d,d.worldSize,c.toUnwrapped());return a.multiply(new Float32Array(16),d.projMatrix,m)}function ft(d,n,c){if(n.projection.name===c.projection.name)return d.projMatrix;const m=c.clone();return m.setProjection(n.projection),be(m,n.getProjection(),d)}function mt(d,n,c){return n.name===c.projection.name?d.projMatrix:be(c,n,d)}class yn{constructor(n,c,m,v){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?c:-c))):v&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class jt{constructor(n,c,m,v,b,I=!1){this.text=new yn(n?n.text:null,c,m,b),this.icon=new yn(n?n.icon:null,c,v,b),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fn{constructor(n,c,m,v=!1){this.text=n,this.icon=c,this.skipFade=m,this.clipped=v}}class $n{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Un{constructor(n,c,m,v,b){this.bucketInstanceId=n,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=b}}class Ln{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const c=++this.maxGroupID;this.collisionGroups[n]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[n]}}function ci(d,n,c,m,v){const{horizontalAlign:b,verticalAlign:I}=a.getAnchorAlignment(d),M=-(b-.5)*n,N=-(I-.5)*c,Z=a.evaluateVariableOffset(d,m);return new a.Point(M+Z[0]*v,N+Z[1]*v)}function Ri(d,n,c,m,v){const b=new a.Point(d,n);return c&&b._rotate(m?v:-v),b}class Gi{constructor(n,c,m,v,b){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new J(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Ln(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,c,m,v){const b=m.getBucket(c),I=m.latestFeatureIndex;if(!b||!I||c.id!==b.layerIds[0])return;const M=b.layers[0].layout,N=m.collisionBoxArray,Z=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),$=m.tileSize/a.EXTENT,re=m.tileID.toUnwrapped();this.transform.setProjection(b.projection);const Re=(Fe=m.tileID,et=b.getProjection(),Qe=this.transform,et.name===this.projection?Qe.calculateProjMatrix(Fe.toUnwrapped()):be(Qe,et,Fe));var Fe,et,Qe;const nt="map"===M.get("text-pitch-alignment"),ce="map"===M.get("text-rotation-alignment");c.compileFilter();const We=c.dynamicFilter(),pt=c.dynamicFilterNeedsFeature(),gt=this.transform.calculatePixelsToTileUnitsMatrix(m),Pt=Xn(Re,m.tileID.canonical,nt,ce,this.transform,b.getProjection(),gt);let Ft=null;if(nt){const Wt=ui(Re,m.tileID.canonical,nt,ce,this.transform,b.getProjection(),gt);Ft=a.multiply([],this.transform.labelPlaneMatrix,Wt)}let Rt=null;We&&m.latestFeatureIndex&&(Rt={unwrappedTileID:re,dynamicFilter:We,dynamicFilterNeedsFeature:pt,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Un(b.bucketInstanceId,I,b.sourceLayerIndex,b.index,m.tileID);const qt={bucket:b,layout:M,posMatrix:Re,textLabelPlaneMatrix:Pt,labelToScreenMatrix:Ft,clippingData:Rt,scale:Z,textPixelRatio:$,holdingForFade:m.holdingForFade(),collisionBoxArray:N,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(const Wt of b.sortKeyRanges){const{sortKey:an,symbolInstanceStart:Yn,symbolInstanceEnd:tn}=Wt;n.push({sortKey:an,symbolInstanceStart:Yn,symbolInstanceEnd:tn,parameters:qt})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:qt})}attemptAnchorPlacement(n,c,m,v,b,I,M,N,Z,$,re,Re,Fe,et,Qe,nt,ce,We){const{textOffset0:pt,textOffset1:gt,crossTileID:Pt}=Re,Ft=[pt,gt],Rt=ci(n,m,v,Ft,b),qt=this.collisionIndex.placeCollisionBox(et,b,c,Ri(Rt.x,Rt.y,I,M,this.transform.angle),re,N,Z,$.predicate);if(nt){const Wt=et.getSymbolInstanceIconSize(We,this.transform.zoom,Re.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(et,Wt,nt,Ri(Rt.x,Rt.y,I,M,this.transform.angle),re,N,Z,$.predicate).box.length)return}if(qt.box.length>0){let Wt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Pt]&&this.prevPlacement.placements[Pt]&&this.prevPlacement.placements[Pt].text&&(Wt=this.prevPlacement.variableOffsets[Pt].anchor),this.variableOffsets[Pt]={textOffset:Ft,width:m,height:v,anchor:n,textScale:b,prevAnchor:Wt},this.markUsedJustification(et,n,Re,Qe),et.allowVerticalPlacement&&(this.markUsedOrientation(et,Qe,Re),this.placedOrientations[Pt]=Qe),{shift:Rt,placedGlyphBoxes:qt}}}placeLayerBucketPart(n,c,m,v){const{bucket:b,layout:I,posMatrix:M,textLabelPlaneMatrix:N,labelToScreenMatrix:Z,clippingData:$,textPixelRatio:re,holdingForFade:Re,collisionBoxArray:Fe,partiallyEvaluatedTextSize:et,partiallyEvaluatedIconSize:Qe,collisionGroup:nt}=n.parameters,ce=I.get("text-optional"),We=I.get("icon-optional"),pt=I.get("text-allow-overlap"),gt=I.get("icon-allow-overlap"),Pt="map"===I.get("text-rotation-alignment"),Ft="map"===I.get("text-pitch-alignment"),Rt="none"!==I.get("icon-text-fit"),qt="viewport-y"===I.get("symbol-z-order");this.transform.setProjection(b.projection);let Wt=pt&&(gt||!b.hasIconData()||We),an=gt&&(pt||!b.hasTextData()||ce);!b.collisionArrays&&Fe&&b.deserializeCollisionBoxes(Fe),m&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,Fe);const Yn=(tn,Pn,dn)=>{const{crossTileID:Zn,numVerticalGlyphVertices:ln}=tn;if($){const no={zoom:this.transform.zoom,pitch:this.transform.pitch};let Zr=null;if($.dynamicFilterNeedsFeature){const br=this.retainedQueryData[b.bucketInstanceId];Zr=$.featureIndex.loadFeature({featureIndex:tn.featureIndex,bucketIndex:br.bucketIndex,sourceLayerIndex:br.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,$.dynamicFilter)(no,Zr,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new a.Point(tn.tileAnchorX,tn.tileAnchorY),this.transform.calculateDistanceTileData($.unwrappedTileID)))return this.placements[Zn]=new Fn(!1,!1,!1,!0),void c.add(Zn)}if(c.has(Zn))return;if(Re)return void(this.placements[Zn]=new Fn(!1,!1,!1));let An=!1,Qn=!1,jn=!0,ei=!1,Ai=!1,Ji=null,wi={box:null,offscreen:null,occluded:null},Si={box:null,offscreen:null,occluded:null},fr=null,tr=null,Di=null,Dr=0,Qr=0,Vr=0;dn.textFeatureIndex?Dr=dn.textFeatureIndex:tn.useRuntimeCollisionCircles&&(Dr=tn.featureIndex),dn.verticalTextFeatureIndex&&(Qr=dn.verticalTextFeatureIndex);const $r=no=>{no.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const Zr=this.transform.elevation;(Zr||no.elevation)&&(no.elevation=Zr?Zr.getAtTileOffset(no.tileID,no.tileAnchorX,no.tileAnchorY):0)},gs=dn.textBox;if(gs){$r(gs);const no=br=>{let Eo=a.WritingMode.horizontal;if(b.allowVerticalPlacement&&!br&&this.prevPlacement){const Is=this.prevPlacement.placedOrientations[Zn];Is&&(this.placedOrientations[Zn]=Is,Eo=Is,this.markUsedOrientation(b,Eo,tn))}return Eo},Zr=(br,Eo)=>{if(b.allowVerticalPlacement&&ln>0&&dn.verticalTextBox){for(const Is of b.writingModes)if(Is===a.WritingMode.vertical?(wi=Eo(),Si=wi):wi=br(),wi&&wi.box&&wi.box.length)break}else wi=br()};if(I.get("text-variable-anchor")){let br=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Zn]){const io=this.prevPlacement.variableOffsets[Zn];br.indexOf(io.anchor)>0&&(br=br.filter(Ms=>Ms!==io.anchor),br.unshift(io.anchor))}const Eo=(io,Ms,iu)=>{const Nl=b.getSymbolInstanceTextSize(et,tn,this.transform.zoom,Pn),ru=(io.x2-io.x1)*Nl+2*io.padding,Ca=(io.y2-io.y1)*Nl+2*io.padding,Ys=Rt&&!gt?Ms:null;Ys&&$r(Ys);let cc={box:[],offscreen:!1,occluded:!1};const ou=pt?2*br.length:br.length;for(let Dc=0;Dc<ou;++Dc){const Bl=this.attemptAnchorPlacement(br[Dc%br.length],io,ru,Ca,Nl,Pt,Ft,re,M,nt,Dc>=br.length,tn,Pn,b,iu,Ys,et,Qe);if(Bl&&(cc=Bl.placedGlyphBoxes,cc&&cc.box&&cc.box.length)){An=!0,Ji=Bl.shift;break}}return cc};Zr(()=>Eo(gs,dn.iconBox,a.WritingMode.horizontal),()=>{const io=dn.verticalTextBox;return io&&$r(io),b.allowVerticalPlacement&&!(wi&&wi.box&&wi.box.length)&&ln>0&&io?Eo(io,dn.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),wi&&(An=wi.box,jn=wi.offscreen,ei=wi.occluded);const Is=no(!(!wi||!wi.box));if(!An&&this.prevPlacement){const io=this.prevPlacement.variableOffsets[Zn];io&&(this.variableOffsets[Zn]=io,this.markUsedJustification(b,io.anchor,tn,Is))}}else{const br=(Eo,Is)=>{const io=b.getSymbolInstanceTextSize(et,tn,this.transform.zoom,Pn),Ms=this.collisionIndex.placeCollisionBox(b,io,Eo,new a.Point(0,0),pt,re,M,nt.predicate);return Ms&&Ms.box&&Ms.box.length&&(this.markUsedOrientation(b,Is,tn),this.placedOrientations[Zn]=Is),Ms};Zr(()=>br(gs,a.WritingMode.horizontal),()=>{const Eo=dn.verticalTextBox;return b.allowVerticalPlacement&&ln>0&&Eo?($r(Eo),br(Eo,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),no(!!(wi&&wi.box&&wi.box.length))}}if(fr=wi,An=fr&&fr.box&&fr.box.length>0,jn=fr&&fr.offscreen,ei=fr&&fr.occluded,tn.useRuntimeCollisionCircles){const no=b.text.placedSymbolArray.get(tn.centerJustifiedTextSymbolIndex>=0?tn.centerJustifiedTextSymbolIndex:tn.verticalPlacedTextSymbolIndex),Zr=a.evaluateSizeForFeature(b.textSizeData,et,no),br=I.get("text-padding");tr=this.collisionIndex.placeCollisionCircles(b,pt,no,b.lineVertexArray,b.glyphOffsetArray,Zr,M,N,Z,m,Ft,nt.predicate,tn.collisionCircleDiameter*Zr/a.ONE_EM,br,this.retainedQueryData[b.bucketInstanceId].tileID),An=pt||tr.circles.length>0&&!tr.collisionDetected,jn=jn&&tr.offscreen,ei=tr.occluded}if(dn.iconFeatureIndex&&(Vr=dn.iconFeatureIndex),dn.iconBox){const no=Zr=>{$r(Zr);const br=Rt&&Ji?Ri(Ji.x,Ji.y,Pt,Ft,this.transform.angle):new a.Point(0,0),Eo=b.getSymbolInstanceIconSize(Qe,this.transform.zoom,tn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,Eo,Zr,br,gt,re,M,nt.predicate)};Si&&Si.box&&Si.box.length&&dn.verticalIconBox?(Di=no(dn.verticalIconBox),Qn=Di.box.length>0):(Di=no(dn.iconBox),Qn=Di.box.length>0),jn=jn&&Di.offscreen,Ai=Di.occluded}const oo=ce||0===tn.numHorizontalGlyphVertices&&0===ln,wa=We||0===tn.numIconVertices;if(oo||wa?wa?oo||(Qn=Qn&&An):An=Qn&&An:Qn=An=Qn&&An,An&&fr&&fr.box&&this.collisionIndex.insertCollisionBox(fr.box,I.get("text-ignore-placement"),b.bucketInstanceId,Si&&Si.box&&Qr?Qr:Dr,nt.ID),Qn&&Di&&this.collisionIndex.insertCollisionBox(Di.box,I.get("icon-ignore-placement"),b.bucketInstanceId,Vr,nt.ID),tr&&(An&&this.collisionIndex.insertCollisionCircles(tr.circles,I.get("text-ignore-placement"),b.bucketInstanceId,Dr,nt.ID),m)){const no=b.bucketInstanceId;let Zr=this.collisionCircleArrays[no];void 0===Zr&&(Zr=this.collisionCircleArrays[no]=new $n);for(let br=0;br<tr.circles.length;br+=4)Zr.circles.push(tr.circles[br+0]),Zr.circles.push(tr.circles[br+1]),Zr.circles.push(tr.circles[br+2]),Zr.circles.push(tr.collisionDetected?1:0)}const ca="globe"!==b.projection.name;Wt=Wt&&(ca||!ei),an=an&&(ca||!Ai),this.placements[Zn]=new Fn(An||Wt,Qn||an,jn||b.justReloaded),c.add(Zn)};if(qt){const tn=b.getSortedSymbolIndexes(this.transform.angle);for(let Pn=tn.length-1;Pn>=0;--Pn){const dn=tn[Pn];Yn(b.symbolInstances.get(dn),dn,b.collisionArrays[dn])}}else for(let tn=n.symbolInstanceStart;tn<n.symbolInstanceEnd;tn++)Yn(b.symbolInstances.get(tn),tn,b.collisionArrays[tn]);if(m&&b.bucketInstanceId in this.collisionCircleArrays){const tn=this.collisionCircleArrays[b.bucketInstanceId];a.invert(tn.invProjMatrix,M),tn.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(n,c,m,v){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:N,crossTileID:Z}=m,$=a.getAnchorJustification(c),re=v===a.WritingMode.vertical?N:"left"===$?b:"center"===$?I:"right"===$?M:-1;b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=re>=0&&b!==re?0:Z),I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=re>=0&&I!==re?0:Z),M>=0&&(n.text.placedSymbolArray.get(M).crossTileID=re>=0&&M!==re?0:Z),N>=0&&(n.text.placedSymbolArray.get(N).crossTileID=re>=0&&N!==re?0:Z)}markUsedOrientation(n,c,m){const v=c===a.WritingMode.horizontal||c===a.WritingMode.horizontalOnly?c:0,b=c===a.WritingMode.vertical?c:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:N,verticalPlacedTextSymbolIndex:Z}=m,$=n.text.placedSymbolArray;I>=0&&($.get(I).placedOrientation=v),M>=0&&($.get(M).placedOrientation=v),N>=0&&($.get(N).placedOrientation=v),Z>=0&&($.get(Z).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const v=c?c.symbolFadeChange(n):1,b=c?c.opacities:{},I=c?c.variableOffsets:{},M=c?c.placedOrientations:{};for(const N in this.placements){const Z=this.placements[N],$=b[N];$?(this.opacities[N]=new jt($,v,Z.text,Z.icon,null,Z.clipped),m=m||Z.text!==$.text.placed||Z.icon!==$.icon.placed):(this.opacities[N]=new jt(null,v,Z.text,Z.icon,Z.skipFade,Z.clipped),m=m||Z.text||Z.icon)}for(const N in b){const Z=b[N];if(!this.opacities[N]){const $=new jt(Z,v,!1,!1);$.isHidden()||(this.opacities[N]=$,m=m||Z.text.placed||Z.icon.placed)}}for(const N in I)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=I[N]);for(const N in M)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=M[N]);m?this.lastPlacementChangeTime=n:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:n)}updateLayerOpacities(n,c){const m=new Set;for(const v of c){const b=v.getBucket(n);b&&v.latestFeatureIndex&&n.id===b.layerIds[0]&&this.updateBucketOpacities(b,m,v.collisionBoxArray)}}updateBucketOpacities(n,c,m){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const v=n.layers[0].layout,b=!!n.layers[0].dynamicFilter(),I=new jt(null,0,!1,!1,!0),M=v.get("text-allow-overlap"),N=v.get("icon-allow-overlap"),Z=v.get("text-variable-anchor"),$="map"===v.get("text-rotation-alignment"),re="map"===v.get("text-pitch-alignment"),Re="none"!==v.get("icon-text-fit"),Fe=new jt(null,0,M&&(N||!n.hasIconData()||v.get("icon-optional")),N&&(M||!n.hasTextData()||v.get("text-optional")),!0);!n.collisionArrays&&m&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(m);const et=(nt,ce,We)=>{for(let pt=0;pt<ce/4;pt++)nt.opacityVertexArray.emplaceBack(We)};let Qe=0;for(let nt=0;nt<n.symbolInstances.length;nt++){const ce=n.symbolInstances.get(nt),{numHorizontalGlyphVertices:We,numVerticalGlyphVertices:pt,crossTileID:gt,numIconVertices:Pt}=ce,Ft=c.has(gt);let Rt=this.opacities[gt];Ft?Rt=I:Rt||(Rt=Fe,this.opacities[gt]=Rt),c.add(gt);const qt=We>0||pt>0,Wt=Pt>0,an=this.placedOrientations[gt],Yn=an===a.WritingMode.vertical,tn=an===a.WritingMode.horizontal||an===a.WritingMode.horizontalOnly;if(!qt&&!Wt||Rt.isHidden()||Qe++,qt){const Pn=Tr(Rt.text);et(n.text,We,Yn?ji:Pn),et(n.text,pt,tn?ji:Pn);const dn=Rt.text.isHidden(),{leftJustifiedTextSymbolIndex:Zn,centerJustifiedTextSymbolIndex:ln,rightJustifiedTextSymbolIndex:An,verticalPlacedTextSymbolIndex:Qn}=ce,jn=n.text.placedSymbolArray,ei=dn||Yn?1:0;Zn>=0&&(jn.get(Zn).hidden=ei),ln>=0&&(jn.get(ln).hidden=ei),An>=0&&(jn.get(An).hidden=ei),Qn>=0&&(jn.get(Qn).hidden=dn||tn?1:0);const Ai=this.variableOffsets[gt];Ai&&this.markUsedJustification(n,Ai.anchor,ce,an);const Ji=this.placedOrientations[gt];Ji&&(this.markUsedJustification(n,"left",ce,Ji),this.markUsedOrientation(n,Ji,ce))}if(Wt){const Pn=Tr(Rt.icon),{placedIconSymbolIndex:dn,verticalPlacedIconSymbolIndex:Zn}=ce,ln=n.icon.placedSymbolArray,An=Rt.icon.isHidden()?1:0;dn>=0&&(et(n.icon,Pt,Yn?ji:Pn),ln.get(dn).hidden=An),Zn>=0&&(et(n.icon,ce.numVerticalIconVertices,tn?ji:Pn),ln.get(Zn).hidden=An)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Pn=n.collisionArrays[nt];if(Pn){let dn=new a.Point(0,0),Zn=!0;if(Pn.textBox||Pn.verticalTextBox){if(Z){const An=this.variableOffsets[gt];An?(dn=ci(An.anchor,An.width,An.height,An.textOffset,An.textScale),$&&dn._rotate(re?this.transform.angle:-this.transform.angle)):Zn=!1}b&&(Zn=!Rt.clipped),Pn.textBox&&or(n.textCollisionBox.collisionVertexArray,Rt.text.placed,!Zn||Yn,dn.x,dn.y),Pn.verticalTextBox&&or(n.textCollisionBox.collisionVertexArray,Rt.text.placed,!Zn||tn,dn.x,dn.y)}const ln=Zn&&!(tn||!Pn.verticalIconBox);Pn.iconBox&&or(n.iconCollisionBox.collisionVertexArray,Rt.icon.placed,ln,Re?dn.x:0,Re?dn.y:0),Pn.verticalIconBox&&or(n.iconCollisionBox.collisionVertexArray,Rt.icon.placed,!ln,Re?dn.x:0,Re?dn.y:0)}}}if(n.fullyClipped=0===Qe,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const nt=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=nt.invProjMatrix,n.placementViewportMatrix=nt.viewportMatrix,n.collisionCircleArray=nt.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return 0===this.fadeDuration?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>n}setStale(){this.stale=!0}}function or(d,n,c,m,v){d.emplaceBack(n?1:0,c?1:0,m||0,v||0),d.emplaceBack(n?1:0,c?1:0,m||0,v||0),d.emplaceBack(n?1:0,c?1:0,m||0,v||0),d.emplaceBack(n?1:0,c?1:0,m||0,v||0)}const ur=Math.pow(2,25),R=Math.pow(2,24),$e=Math.pow(2,17),H=Math.pow(2,16),Ze=Math.pow(2,9),Bt=Math.pow(2,8),Vi=Math.pow(2,1);function Tr(d){if(0===d.opacity&&!d.placed)return 0;if(1===d.opacity&&d.placed)return 4294967295;const n=d.placed?1:0,c=Math.floor(127*d.opacity);return c*ur+n*R+c*$e+n*H+c*Ze+n*Bt+c*Vi+n}const ji=0;class Ko{constructor(n){this._sortAcrossTiles="viewport-y"!==n.layout.get("symbol-z-order")&&void 0!==n.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,c,m,v,b){const I=this._bucketParts;for(;this._currentTileIndex<n.length;)if(c.getBucketParts(I,v,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((M,N)=>M.sortKey-N.sortKey));this._currentPartIndex<I.length;){const M=I[this._currentPartIndex];if(c.placeLayerBucketPart(M,this._seenCrossTileIDs,m,0===M.symbolInstanceStart),this._currentPartIndex++,b())return!0}return!1}}class Mo{constructor(n,c,m,v,b,I,M,N){this.placement=new Gi(n,b,I,M,N),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(n,c,m){const v=a.exported.now(),b=()=>{const I=a.exported.now()-v;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=c[n[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=M)&&(!I.maxzoom||I.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Ko(I)),this._inProgressLayer.continuePlacement(m[I.source],this.placement,this._showCollisionBoxes,I,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Ns=512/a.EXTENT/2;class cr{constructor(n,c,m){this.tileID=n,this.bucketInstanceId=m,this.index=new a.KDBush(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=n.canonical.x*a.EXTENT,b=n.canonical.y*a.EXTENT;for(let I=0;I<c.length;I++){const{key:M,crossTileID:N,tileAnchorX:Z,tileAnchorY:$}=c.get(I),re=Math.floor((v+Z)*Ns),Re=Math.floor((b+$)*Ns);this.index.add(re,Re),this.keys.push(M),this.crossTileIDs.push(N)}this.index.finish()}findMatches(n,c,m){const v=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),b=Ns/Math.pow(2,c.canonical.z-this.tileID.canonical.z),I=c.canonical.x*a.EXTENT,M=c.canonical.y*a.EXTENT;for(let N=0;N<n.length;N++){const Z=n.get(N);if(Z.crossTileID)continue;const{key:$,tileAnchorX:re,tileAnchorY:Re}=Z,Fe=Math.floor((I+re)*b),et=Math.floor((M+Re)*b),Qe=this.index.range(Fe-v,et-v,Fe+v,et+v);for(const nt of Qe){const ce=this.crossTileIDs[nt];if(this.keys[nt]===$&&!m.has(ce)){m.add(ce),Z.crossTileID=ce;break}}}}}class Bs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _r{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const c=Math.round((n-this.lng)/360);if(0!==c)for(const m in this.indexes){const v=this.indexes[m],b={};for(const I in v){const M=v[I];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+c),b[M.tileID.key]=M}this.indexes[m]=b}this.lng=n}addBucket(n,c,m){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<c.symbolInstances.length;b++)c.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const v=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const I=this.indexes[b];if(Number(b)>n.overscaledZ)for(const M in I){const N=I[M];N.tileID.isChildOf(n)&&N.findMatches(c.symbolInstances,n,v)}else{const M=I[n.scaledTo(Number(b)).key];M&&M.findMatches(c.symbolInstances,n,v)}}for(let b=0;b<c.symbolInstances.length;b++){const I=c.symbolInstances.get(b);I.crossTileID||(I.crossTileID=m.generate(),v.add(I.crossTileID))}return void 0===this.indexes[n.overscaledZ]&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new cr(n,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(n,c){for(const m of c.crossTileIDs)this.usedCrossTileIDs[n].delete(m)}removeStaleBuckets(n){let c=!1;for(const m in this.indexes){const v=this.indexes[m];for(const b in v)n[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[b]),delete v[b],c=!0)}return c}}class Uo{constructor(){this.layerIndexes={},this.crossTileIDs=new Bs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,c,m,v){let b=this.layerIndexes[n.id];void 0===b&&(b=this.layerIndexes[n.id]=new _r);let I=!1;const M={};"globe"!==v.name&&b.handleWrapJump(m);for(const N of c){const Z=N.getBucket(n);Z&&n.id===Z.layerIds[0]&&(Z.bucketInstanceId||(Z.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(N.tileID,Z,this.crossTileIDs)&&(I=!0),M[Z.bucketInstanceId]=!0)}return b.removeStaleBuckets(M)&&(I=!0),I}pruneUnusedLayers(n){const c={};n.forEach(m=>{c[m]=!0});for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}const jo=(d,n)=>a.emitValidationErrors(d,n&&n.filter(c=>"source.canvas"!==c.identifier)),Go=a.pick(Zi,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Al=a.pick(Zi,["setCenter","setZoom","setBearing","setPitch"]),$a={version:8,layers:[],sources:{}},zs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class lo extends a.Evented{constructor(n,c={}){super(),this.map=n,this.dispatcher=new cn(ho(),this),this.imageManager=new lt,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(n._requestManager,c.localFontFamily?a.LocalGlyphMode.all:c.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.crossTileSymbolIndex=new Uo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const m=this;this._rtlTextPluginCallback=lo.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,I)=>{if(a.triggerPluginCompletionEvent(b),I&&I.every(M=>M))for(const M in m._sourceCaches){const N=m._sourceCaches[M],Z=N.getSource().type;"vector"!==Z&&"geojson"!==Z||N.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const b=this.getSource(v.sourceId);if(b&&b.vectorLayerIds)for(const I in this._layers){const M=this._layers[I];M.source===b.id&&this._validateLayer(M)}})}loadURL(n,c={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof c.validate?c.validate:!a.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,c.accessToken);const v=this.map._requestManager.transformRequest(n,a.ResourceType.Style);this._request=a.getJSON(v,(b,I)=>{this._request=null,b?this.fire(new a.ErrorEvent(b)):I&&this._load(I,m)})}loadJSON(n,c={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(n,!1!==c.validate)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load($a,!1)}_updateLayerCount(n,c){const m=c?1:-1;n.is3D()&&(this._num3DLayers+=m),"circle"===n.type&&(this._numCircleLayers+=m),"symbol"===n.type&&(this._numSymbolLayers+=m)}_load(n,c){if(c&&jo(this,a.validateStyle(n)))return;this._loaded=!0,this.stylesheet=a.clone$1(n),this._updateMapProjection();for(const v in n.sources)this.addSource(v,n.sources[v],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const m=Io(this.stylesheet.layers);this._order=m.map(v=>v.id),this._layers={},this._serializedLayers={};for(const v of m){const b=a.createStyleLayer(v);b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ee(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(c,m,v){let b,I,M;const N=a.exported.devicePixelRatio>1?"@2x":"";let Z=a.getJSON(m.transformRequest(m.normalizeSpriteURL(c,N,".json"),a.ResourceType.SpriteJSON),(Re,Fe)=>{Z=null,M||(M=Re,b=Fe,re())}),$=a.getImage(m.transformRequest(m.normalizeSpriteURL(c,N,".png"),a.ResourceType.SpriteImage),(Re,Fe)=>{$=null,M||(M=Re,I=Fe,re())});function re(){if(M)v(M);else if(b&&I){const Re=a.exported.getImageData(I),Fe={};for(const et in b){const{width:Qe,height:nt,x:ce,y:We,sdf:pt,pixelRatio:gt,stretchX:Pt,stretchY:Ft,content:Rt}=b[et],qt=new a.RGBAImage({width:Qe,height:nt});a.RGBAImage.copy(Re,qt,{x:ce,y:We},{x:0,y:0},{width:Qe,height:nt}),Fe[et]={data:qt,pixelRatio:gt,sdf:pt,stretchX:Pt,stretchY:Ft,content:Rt}}v(null,Fe)}}return{cancel(){Z&&(Z.cancel(),Z=null),$&&($.cancel(),$=null)}}}(n,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new a.ErrorEvent(c));else if(m)for(const v in m)this.imageManager.addImage(v,m[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(n){const c=this.getSource(n.source);if(!c)return;const m=n.sourceLayer;m&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(m))&&this.fire(new a.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const c=[];for(const m of n){const v=this._layers[m];"custom"!==v.type&&c.push(v.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&("function"==typeof n.isLayerDraped?n.isLayerDraped():zs[n.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const c=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(v.length||b.length)&&this._updateWorkerLayers(v,b);for(const I in this._updatedSources){const M=this._updatedSources[I];"reload"===M?this._reloadSource(I):"clear"===M&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const m={};for(const v in this._sourceCaches){const b=this._sourceCaches[v];m[v]=b.used,b.used=!1}for(const v of this._order){const b=this._layers[v];if(b.recalculate(n,this._availableImages),!b.isHidden(n.zoom)){const M=this._getLayerSourceCache(b);M&&(M.used=!0)}const I=this.map.painter;if(I){const M=b.getProgramIds();if(!M)continue;const N=b.getProgramConfiguration(n.zoom);for(const Z of M)I.useProgram(Z,N)}}for(const v in m){const b=this._sourceCaches[v];m[v]!==b.used&&b.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),jo(this,a.validateStyle(n)))return!1;(n=a.clone$1(n)).layers=Io(n.layers);const c=function(v,b){if(!v)return[{command:Zi.setStyle,args:[b]}];let I=[];try{if(!j(v.version,b.version))return[{command:Zi.setStyle,args:[b]}];j(v.center,b.center)||I.push({command:Zi.setCenter,args:[b.center]}),j(v.zoom,b.zoom)||I.push({command:Zi.setZoom,args:[b.zoom]}),j(v.bearing,b.bearing)||I.push({command:Zi.setBearing,args:[b.bearing]}),j(v.pitch,b.pitch)||I.push({command:Zi.setPitch,args:[b.pitch]}),j(v.sprite,b.sprite)||I.push({command:Zi.setSprite,args:[b.sprite]}),j(v.glyphs,b.glyphs)||I.push({command:Zi.setGlyphs,args:[b.glyphs]}),j(v.transition,b.transition)||I.push({command:Zi.setTransition,args:[b.transition]}),j(v.light,b.light)||I.push({command:Zi.setLight,args:[b.light]}),j(v.fog,b.fog)||I.push({command:Zi.setFog,args:[b.fog]}),j(v.projection,b.projection)||I.push({command:Zi.setProjection,args:[b.projection]});const M={},N=[];!function(re,Re,Fe,et){let Qe;for(Qe in Re=Re||{},re=re||{})re.hasOwnProperty(Qe)&&(Re.hasOwnProperty(Qe)||Ro(Qe,Fe,et));for(Qe in Re){if(!Re.hasOwnProperty(Qe))continue;const nt=Re[Qe];re.hasOwnProperty(Qe)?j(re[Qe],nt)||("geojson"===re[Qe].type&&"geojson"===nt.type&&qi(re,Re,Qe)?Fe.push({command:Zi.setGeoJSONSourceData,args:[Qe,nt.data]}):xo(Qe,Re,Fe,et)):ao(Qe,Re,Fe)}}(v.sources,b.sources,N,M);const Z=[];v.layers&&v.layers.forEach(re=>{re.source&&M[re.source]?I.push({command:Zi.removeLayer,args:[re.id]}):Z.push(re)});let $=v.terrain;$&&M[$.source]&&(I.push({command:Zi.setTerrain,args:[void 0]}),$=void 0),I=I.concat(N),j($,b.terrain)||I.push({command:Zi.setTerrain,args:[b.terrain]}),function(re,Re,Fe){Re=Re||[];const et=(re=re||[]).map(Kr),Qe=Re.map(Kr),nt=re.reduce(Yt,{}),ce=Re.reduce(Yt,{}),We=et.slice(),pt=Object.create(null);let gt,Pt,Ft,Rt,qt,Wt,an;for(gt=0,Pt=0;gt<et.length;gt++)Ft=et[gt],ce.hasOwnProperty(Ft)?Pt++:(Fe.push({command:Zi.removeLayer,args:[Ft]}),We.splice(We.indexOf(Ft,Pt),1));for(gt=0,Pt=0;gt<Qe.length;gt++)Ft=Qe[Qe.length-1-gt],We[We.length-1-gt]!==Ft&&(nt.hasOwnProperty(Ft)?(Fe.push({command:Zi.removeLayer,args:[Ft]}),We.splice(We.lastIndexOf(Ft,We.length-Pt),1)):Pt++,Wt=We[We.length-gt],Fe.push({command:Zi.addLayer,args:[ce[Ft],Wt]}),We.splice(We.length-gt,0,Ft),pt[Ft]=!0);for(gt=0;gt<Qe.length;gt++)if(Ft=Qe[gt],Rt=nt[Ft],qt=ce[Ft],!pt[Ft]&&!j(Rt,qt))if(j(Rt.source,qt.source)&&j(Rt["source-layer"],qt["source-layer"])&&j(Rt.type,qt.type)){for(an in Ci(Rt.layout,qt.layout,Fe,Ft,null,Zi.setLayoutProperty),Ci(Rt.paint,qt.paint,Fe,Ft,null,Zi.setPaintProperty),j(Rt.filter,qt.filter)||Fe.push({command:Zi.setFilter,args:[Ft,qt.filter]}),j(Rt.minzoom,qt.minzoom)&&j(Rt.maxzoom,qt.maxzoom)||Fe.push({command:Zi.setLayerZoomRange,args:[Ft,qt.minzoom,qt.maxzoom]}),Rt)Rt.hasOwnProperty(an)&&"layout"!==an&&"paint"!==an&&"filter"!==an&&"metadata"!==an&&"minzoom"!==an&&"maxzoom"!==an&&(0===an.indexOf("paint.")?Ci(Rt[an],qt[an],Fe,Ft,an.slice(6),Zi.setPaintProperty):j(Rt[an],qt[an])||Fe.push({command:Zi.setLayerProperty,args:[Ft,an,qt[an]]}));for(an in qt)qt.hasOwnProperty(an)&&!Rt.hasOwnProperty(an)&&"layout"!==an&&"paint"!==an&&"filter"!==an&&"metadata"!==an&&"minzoom"!==an&&"maxzoom"!==an&&(0===an.indexOf("paint.")?Ci(Rt[an],qt[an],Fe,Ft,an.slice(6),Zi.setPaintProperty):j(Rt[an],qt[an])||Fe.push({command:Zi.setLayerProperty,args:[Ft,an,qt[an]]}))}else Fe.push({command:Zi.removeLayer,args:[Ft]}),Wt=We[We.lastIndexOf(Ft)+1],Fe.push({command:Zi.addLayer,args:[qt,Wt]})}(Z,b.layers,I)}catch(M){console.warn("Unable to compute style diff:",M),I=[{command:Zi.setStyle,args:[b]}]}return I}(this.serialize(),n).filter(v=>!(v.command in Al));if(0===c.length)return!1;const m=c.filter(v=>!(v.command in Go));if(m.length>0)throw new Error(`Unimplemented: ${m.map(v=>v.command).join(", ")}.`);return c.forEach(v=>{"setTransition"!==v.command&&"setProjection"!==v.command&&this[v.command].apply(this,v.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,c){return this.getImage(n)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,c),this._afterImageUpdated(n),this)}updateImage(n,c){this.imageManager.updateImage(n,c)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,c,m={}){if(this._checkLoaded(),void 0!==this.getSource(n))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(a.validateSource,`sources.${n}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const v=at(n,c,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:v.serialize(),sourceId:n}));const b=I=>{const M=(I?"symbol:":"other:")+n,N=this._sourceCaches[M]=new a.SourceCache(M,v,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[n]=N,N.style=this,N.onAdd(this.map)};b(!1),"vector"!==c.type&&"geojson"!==c.type||b(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const c=this.getSource(n);if(!c)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===n)return this.fire(new a.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new a.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(n);for(const v of m)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,c){this._checkLoaded(),this.getSource(n).setData(c),this._changed=!0}getSource(n){const c=this._getSourceCache(n);return c&&c.getSource()}_getSources(){const n=[];for(const c in this._otherSourceCaches){const m=this._getSourceCache(c);m&&n.push(m.getSource())}return n}addLayer(n,c,m={}){this._checkLoaded();const v=n.id;if(this.getLayer(v))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let b;if("custom"===n.type){if(jo(this,a.validateCustomStyleLayer(n)))return;b=a.createStyleLayer(n)}else{if("object"==typeof n.source&&(this.addSource(v,n.source),n=a.clone$1(n),n=a.extend(n,{source:v})),this._validate(a.validateLayer,`layers.${v}`,n,{arrayIndex:-1},m))return;b=a.createStyleLayer(n),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const I=c?this._order.indexOf(c):this._order.length;if(c&&-1===I)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(I,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const M=this._getLayerSourceCache(b);if(this._removedLayers[v]&&b.source&&M&&"custom"!==b.type){const N=this._removedLayers[v];delete this._removedLayers[v],N.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",M.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,c){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===c)return;const m=this._order.indexOf(n);this._order.splice(m,1);const v=c?this._order.indexOf(c):this._order.length;c&&-1===v?this.fire(new a.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(v,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const c=this._layers[n];if(!c)return void this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const m=this._order.indexOf(n);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=c,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const c in this._layers)if(this._layers[c].type===n)return!0;return!1}setLayerZoomRange(n,c,m){this._checkLoaded();const v=this.getLayer(n);v?v.minzoom===c&&v.maxzoom===m||(null!=c&&(v.minzoom=c),null!=m&&(v.maxzoom=m),this._updateLayer(v)):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,c,m={}){this._checkLoaded();const v=this.getLayer(n);if(v){if(!j(v.filter,c))return null==c?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(a.validateFilter,`layers.${v.id}.filter`,c,{layerType:v.type},m)||(v.filter=a.clone$1(c),this._updateLayer(v)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const c=this.getLayer(n);return c&&a.clone$1(c.filter)}setLayoutProperty(n,c,m,v={}){this._checkLoaded();const b=this.getLayer(n);b?j(b.getLayoutProperty(c),m)||(b.setLayoutProperty(c,m,v),this._updateLayer(b)):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,c){const m=this.getLayer(n);if(m)return m.getLayoutProperty(c);this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,c,m,v={}){this._checkLoaded();const b=this.getLayer(n);b?j(b.getPaintProperty(c),m)||(b.setPaintProperty(c,m,v)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,c){const m=this.getLayer(n);return m&&m.getPaintProperty(c)}setFeatureState(n,c){this._checkLoaded();const m=n.source,v=n.sourceLayer,b=this.getSource(m);if(!b)return void this.fire(new a.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const I=b.type;if("geojson"===I&&v)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!v)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===n.id&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const M=this._getSourceCaches(m);for(const N of M)N.setFeatureState(v,n.id,c)}removeFeatureState(n,c){this._checkLoaded();const m=n.source,v=this.getSource(m);if(!v)return void this.fire(new a.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const b=v.type,I="vector"===b?n.sourceLayer:void 0;if("vector"===b&&!I)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof n.id&&"number"!=typeof n.id)return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const M=this._getSourceCaches(m);for(const N of M)N.removeFeatureState(I,n.id,c)}getFeatureState(n){this._checkLoaded();const c=n.source,m=n.sourceLayer,v=this.getSource(c);if(v){if("vector"!==v.type||m)return void 0===n.id&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(m,n.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();n[m.id]||(n[m.id]=m.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(n){this._updatedLayers[n.id]=!0;const c=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[n.source]="reload",c.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const c=I=>"fill-extrusion"===this._layers[I].type,m={},v=[];for(let I=this._order.length-1;I>=0;I--){const M=this._order[I];if(c(M)){m[M]=I;for(const N of n){const Z=N[M];if(Z)for(const $ of Z)v.push($)}}}v.sort((I,M)=>M.intersectionZ-I.intersectionZ);const b=[];for(let I=this._order.length-1;I>=0;I--){const M=this._order[I];if(c(M))for(let N=v.length-1;N>=0;N--){const Z=v[N].feature;if(m[Z.layer.id]<I)break;b.push(Z),v.pop()}else for(const N of n){const Z=N[M];if(Z)for(const $ of Z)b.push($.feature)}}return b}queryRenderedFeatures(n,c,m){c&&c.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const v={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const N of c.layers){const Z=this._layers[N];if(!Z)return this.fire(new a.ErrorEvent(new Error(`The layer '${N}' does not exist in the map's style and cannot be queried for features.`))),[];v[Z.source]=!0}}const b=[];c.availableImages=this._availableImages;const I=c&&c.layers?c.layers.some(N=>{const Z=this.getLayer(N);return Z&&Z.is3D()}):this.has3DLayers(),M=$t.createFromScreenPoints(n,m);for(const N in this._sourceCaches){const Z=this._sourceCaches[N].getSource().id;c.layers&&!v[Z]||b.push(Dn(this._sourceCaches[N],this._layers,this._serializedLayers,M,c,m,I,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(N,Z,$,re,Re,Fe,et){const Qe={},nt=Fe.queryRenderedSymbols(re),ce=[];for(const We of Object.keys(nt).map(Number))ce.push(et[We]);ce.sort(Mi);for(const We of ce){const pt=We.featureIndex.lookupSymbolFeatures(nt[We.bucketInstanceId],Z,We.bucketIndex,We.sourceLayerIndex,Re.filter,Re.layers,Re.availableImages,N);for(const gt in pt){const Pt=Qe[gt]=Qe[gt]||[],Ft=pt[gt];Ft.sort((Rt,qt)=>{const Wt=We.featureSortOrder;if(Wt){const an=Wt.indexOf(Rt.featureIndex);return Wt.indexOf(qt.featureIndex)-an}return qt.featureIndex-Rt.featureIndex});for(const Rt of Ft)Pt.push(Rt)}}for(const We in Qe)Qe[We].forEach(pt=>{const gt=pt.feature,Pt=$(N[We]);if(!Pt)return;const Ft=Pt.getFeatureState(gt.layer["source-layer"],gt.id);gt.source=gt.layer.source,gt.layer["source-layer"]&&(gt.sourceLayer=gt.layer["source-layer"]),gt.state=Ft});return Qe}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),M.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(n,c){c&&c.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const m=this._getSourceCaches(n);let v=[];for(const b of m)v=v.concat(gi(b,c));return v}addSourceType(n,c,m){return lo.getSourceType(n)?m(new Error(`A source type called "${n}" already exists.`)):(lo.setSourceType(n,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:c.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(n,c={}){this._checkLoaded();const m=this.light.getLight();let v=!1;for(const I in n)if(!j(n[I],m[I])){v=!0;break}if(!v)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,c),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,c=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let m=n;if(1===c){if("object"==typeof m.source){const v="terrain-dem-src";this.addSource(v,m.source),m=a.clone$1(m),m=a.extend(m,{source:v})}if(this._validate(a.validateTerrain,"terrain",m))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,c)}else{const v=this.terrain,b=v.get();for(const I of Object.keys(a.spec.terrain))!m.hasOwnProperty(I)&&a.spec.terrain[I].default&&(m[I]=a.spec.terrain[I].default);for(const I in m)if(!j(m[I],b[I])){v.set(m),this.stylesheet.terrain=m;const M=this._setTransitionParameters({duration:0});v.updateTransitions(M);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const c=this.fog=new Ht(n,this.map.transform);this.stylesheet.fog=n;const m=this._setTransitionParameters({duration:0});c.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,m=c.get();0===Object.keys(n).length&&c.set(n);for(const v in n)if(!j(n[v],m[v])){c.set(n),this.stylesheet.fog=n;const b=this._setTransitionParameters({duration:0});c.updateTransitions(b);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:a.exported.now(),transition:a.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(m=>this.isLayerDraped(this._layers[m])),c=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...c)}_createTerrain(n,c){const m=this.terrain=new je(n,c);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const v=this._setTransitionParameters({duration:0});m.updateTransitions(v)}_force3DLayerUpdate(){for(const n in this._layers){const c=this._layers[n];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const c=this._layers[n];"symbol"===c.type&&this._updateLayer(c)}}_validate(n,c,m,v,b={}){return(!b||!1!==b.validate)&&jo(this,n.call(a.validateStyle,a.extend({key:c,style:this.serialize(),value:m,styleSpec:a.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const c=this._getSourceCaches(n);for(const m of c)m.clearTiles()}_reloadSource(n){const c=this._getSourceCaches(n);for(const m of c)m.resume(),m.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const c in this._sourceCaches)this._sourceCaches[c].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const c=this._sourceCaches[n];c.resume(),c.reload()}}_updatePlacement(n,c,m,v,b=!1){let I=!1,M=!1;const N={};for(const Z of this._order){const $=this._layers[Z];if("symbol"!==$.type)continue;if(!N[$.source]){const Re=this._getLayerSourceCache($);if(!Re)continue;N[$.source]=Re.getRenderableIds(!0).map(Fe=>Re.getTileByID(Fe)).sort((Fe,et)=>et.tileID.overscaledZ-Fe.tileID.overscaledZ||(Fe.tileID.isLessThan(et.tileID)?-1:1))}const re=this.crossTileSymbolIndex.addLayer($,N[$.source],n.center.lng,n.projection);I=I||re}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),n.zoom))&&(this.pauseablePlacement=new Mo(n,this._order,b,c,m,v,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),M=!0),I&&this.pauseablePlacement.placement.setStale()),M||I)for(const Z of this._order){const $=this._layers[Z];"symbol"===$.type&&this.placement.updateLayerOpacities($,N[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,c,m){this.imageManager.getImages(c.icons,m),this._updateTilesForChangedImages();const v=b=>{b&&b.setDependencies(c.tileID.key,c.type,c.icons)};v(this._otherSourceCaches[c.source]),v(this._symbolSourceCaches[c.source])}getGlyphs(n,c,m){this.glyphManager.getGlyphs(c.stacks,m)}getResource(n,c,m){return a.makeRequest(c,m)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return"symbol"===n.type?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const c=[];return this._otherSourceCaches[n]&&c.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&c.push(this._symbolSourceCaches[n]),c}_isSourceCacheLoaded(n){const c=this._getSourceCaches(n);return 0===c.length?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):c.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}lo.getSourceType=function(d){return ze[d]},lo.setSourceType=function(d,n){ze[d]=n},lo.registerForPluginStateChange=a.registerForPluginStateChange;var Aa="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",fo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",po="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",mr="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Lo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let ns={},ha={};const ws=[];cs(Aa,ws),cs(po,ws),cs(mr,ws),cs(Lo,ws),ns=vr("",po),ha=vr(Lo,mr);const na=vr("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Us=Aa,Za="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var fl={background:vr("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:vr("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:vr("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:vr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:vr("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:vr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:vr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:vr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:vr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:vr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:vr("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:vr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:vr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:vr("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:vr("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:vr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:vr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:vr("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:vr("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:vr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:vr("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:vr("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:vr("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:vr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:vr("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:vr("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",fo),skyboxGradient:vr("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",fo),skyboxCapture:vr("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:vr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:vr("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function cs(d,n){const c=d.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let m of c)if(m=m.trim(),"#"===m[0]&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=m.split(" ");for(const b of v)n.includes(b)||n.push(b)}}function vr(d,n){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),v={},b=[...ws];return cs(d,b),cs(n,b),{fragmentSource:d=d.replace(c,(I,M,N,Z,$)=>(v[$]=!0,"define"===M?`\n#ifndef HAS_UNIFORM_u_${$}\nvarying ${N} ${Z} ${$};\n#else\nuniform ${N} ${Z} u_${$};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${$}\n    ${N} ${Z} ${$} = u_${$};\n#endif\n`)),vertexSource:n=n.replace(c,(I,M,N,Z,$)=>{const re="float"===Z?"vec2":"vec4",Re=$.match(/color/)?"color":re;return v[$]?"define"===M?`\n#ifndef HAS_UNIFORM_u_${$}\nuniform lowp float u_${$}_t;\nattribute ${N} ${re} a_${$};\nvarying ${N} ${Z} ${$};\n#else\nuniform ${N} ${Z} u_${$};\n#endif\n`:"vec4"===Re?`\n#ifndef HAS_UNIFORM_u_${$}\n    ${$} = a_${$};\n#else\n    ${N} ${Z} ${$} = u_${$};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${$}\n    ${$} = unpack_mix_${Re}(a_${$}, u_${$}_t);\n#else\n    ${N} ${Z} ${$} = u_${$};\n#endif\n`:"define"===M?`\n#ifndef HAS_UNIFORM_u_${$}\nuniform lowp float u_${$}_t;\nattribute ${N} ${re} a_${$};\n#else\nuniform ${N} ${Z} u_${$};\n#endif\n`:"vec4"===Re?`\n#ifndef HAS_UNIFORM_u_${$}\n    ${N} ${Z} ${$} = a_${$};\n#else\n    ${N} ${Z} ${$} = u_${$};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${$}\n    ${N} ${Z} ${$} = unpack_mix_${Re}(a_${$}, u_${$}_t);\n#else\n    ${N} ${Z} ${$} = u_${$};\n#endif\n`}),staticAttributes:m,usedDefines:b}}class Sl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,c,m,v,b,I,M){this.context=n;let N=this.boundPaintVertexBuffers.length!==v.length;for(let $=0;!N&&$<v.length;$++)this.boundPaintVertexBuffers[$]!==v[$]&&(N=!0);let Z=this.boundDynamicVertexBuffers.length!==M.length;for(let $=0;!Z&&$<M.length;$++)this.boundDynamicVertexBuffers[$]!==M[$]&&(Z=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==m||N||Z||this.boundIndexBuffer!==b||this.boundVertexOffset!==I)this.freshBind(c,m,v,b,I,M);else{n.bindVertexArrayOES.set(this.vao);for(const $ of M)$&&$.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(n,c,m,v,b,I){let M;const N=n.numAttributes,Z=this.context,$=Z.gl;if(Z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Z.extVertexArrayObject.createVertexArrayOES(),Z.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=n,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=I;else{M=Z.currentNumAttributes||0;for(let re=N;re<M;re++)$.disableVertexAttribArray(re)}c.enableAttributes($,n),c.bind(),c.setVertexAttribPointers($,n,b);for(const re of m)re.enableAttributes($,n),re.bind(),re.setVertexAttribPointers($,n,b);for(const re of I)re&&(re.enableAttributes($,n),re.bind(),re.setVertexAttribPointers($,n,b));v&&v.bind(),Z.currentNumAttributes=N}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Xo(d,n){const c=Math.pow(2,n.canonical.z),m=n.canonical.y;return[new a.MercatorCoordinate(0,m/c).toLngLat().lat,new a.MercatorCoordinate(0,(m+1)/c).toLngLat().lat]}function Ql(d,n,c,m,v,b,I){const M=d.context,N=M.gl,Z=c.fbo;if(!Z)return;d.prepareDrawTile();const $=d.useProgram("hillshade");M.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,Z.colorAttachment.get());const re=((Qe,nt,ce,We)=>{const pt=ce.paint.get("hillshade-shadow-color"),gt=ce.paint.get("hillshade-highlight-color"),Pt=ce.paint.get("hillshade-accent-color");let Ft=ce.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ce.paint.get("hillshade-illumination-anchor")&&(Ft-=Qe.transform.angle);const Rt=!Qe.options.moving;return{u_matrix:We||Qe.transform.calculateProjMatrix(nt.tileID.toUnwrapped(),Rt),u_image:0,u_latrange:Xo(0,nt.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),Ft],u_shadow:pt,u_highlight:gt,u_accent:Pt}})(d,c,m,d.terrain?n.projMatrix:null);d.prepareDrawProgram(M,$,n.toUnwrapped());const{tileBoundsBuffer:Re,tileBoundsIndexBuffer:Fe,tileBoundsSegments:et}=d.getTileBoundsBuffers(c);$.draw(M,N.TRIANGLES,v,b,I,a.CullFaceMode.disabled,re,m.id,Re,Fe,et)}function Ga(d,n,c){if(!n.needsDEMTextureUpload)return;const m=d.context,v=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||d.getTileTexture(c.stride);const b=c.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new a.Texture(m,b,v.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Pl(d,n,c,m,v,b){const I=d.context,M=I.gl;if(!n.dem)return;const N=n.dem;if(I.activeTexture.set(M.TEXTURE1),Ga(d,n,N),!n.demTexture)return;n.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);const Z=N.dim;I.activeTexture.set(M.TEXTURE0);let $=n.fbo;if(!$){const et=new a.Texture(I,{width:Z,height:Z,data:null},M.RGBA);et.bind(M.LINEAR,M.CLAMP_TO_EDGE),$=n.fbo=I.createFramebuffer(Z,Z,!0),$.colorAttachment.set(et.texture)}I.bindFramebuffer.set($.framebuffer),I.viewport.set([0,0,Z,Z]);const{tileBoundsBuffer:re,tileBoundsIndexBuffer:Re,tileBoundsSegments:Fe}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(I,M.TRIANGLES,m,v,b,a.CullFaceMode.disabled,((et,Qe)=>{const nt=Qe.stride,ce=a.create();return a.ortho(ce,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(ce,ce,[0,-a.EXTENT,0]),{u_matrix:ce,u_image:1,u_dimension:[nt,nt],u_zoom:et.overscaledZ,u_unpack:Qe.unpackVector}})(n.tileID,N),c.id,re,Re,Fe),n.needsHillshadePrepare=!1}const fa=d=>({u_matrix:new a.UniformMatrix4f(d),u_image0:new a.Uniform1i(d),u_skirt_height:new a.Uniform1f(d)}),pa=(d,n)=>({u_matrix:d,u_image0:0,u_skirt_height:n}),Ha=(d,n,c,m,v,b,I,M,N,Z,$,re,Re,Fe,et)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:c,u_zoom_transition:v,u_merc_center:b,u_image0:0,u_frustum_tl:I,u_frustum_tr:M,u_frustum_br:N,u_frustum_bl:Z,u_globe_pos:$,u_globe_radius:re,u_viewport:Re,u_grid_matrix:et?Float32Array.from(et):new Float32Array(9),u_skirt_height:Fe});function js(d,n){return null!=d&&null!=n&&!(!d.hasData()||!n.hasData())&&null!=d.demTexture&&null!=n.demTexture&&d.tileID.key!==n.tileID.key}const bo=new class{constructor(){this.operations={}}newMorphing(d,n,c,m,v){if(d in this.operations){const b=this.operations[d];b.to.tileID.key!==c.tileID.key&&(b.queued=c)}else this.operations[d]={startTime:m,phase:0,duration:v,from:n,to:c,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const n=this.operations[d];return{from:n.from,to:n.to,phase:n.phase}}update(d){for(const n in this.operations){const c=this.operations[n];for(c.phase=(d-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,d)){delete this.operations[n];break}}}_nextOp(d,n){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=n,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Sa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ia(d){return 6*Math.pow(1.5,22-d)}function Ol(d,n){const c=1<<d.z;return!n&&(0===d.x||d.x===c-1)||0===d.y||d.y===c-1}const Wa=d=>({u_matrix:d});function Rl(d,n,c,m,v){if(v>0){const b=a.exported.now(),I=(b-d.timeAdded)/v,M=n?(b-n.timeAdded)/v:-1,N=c.getSource(),Z=m.coveringZoomLevel({tileSize:N.tileSize,roundZoom:N.roundZoom}),$=!n||Math.abs(n.tileID.overscaledZ-Z)>Math.abs(d.tileID.overscaledZ-Z),re=$&&d.refreshedUponExpiration?1:a.clamp($?I:1-M,0,1);return d.refreshedUponExpiration&&I>=1&&(d.refreshedUponExpiration=!1),n?{opacity:1,mix:1-re}:{opacity:re,mix:0}}return{opacity:1,mix:0}}class qa extends a.SourceCache{constructor(n){const c={type:"raster-dem",maxzoom:n.transform.maxZoom},m=new cn(ho(),null),v=at("mock-dem",c,m,n.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,c){n.state="loaded",c(null)}}class ma extends a.SourceCache{constructor(n){const c=at("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new cn(ho(),null),n.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,c,m){if(n.freezeTileCoverage)return;this.transform=n;const v=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,I)=>{if(b[I.key]="",!this._tiles[I.key]){const M=new a.Tile(I,this._source.tileSize*I.overscaleFactor(),n.tileZoom);M.state="loaded",this._tiles[I.key]=M}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const c=this.proxyCachedFBO[n];if(void 0!==c){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ya extends a.OverscaledTileID{constructor(n,c,m){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class pl extends a.Elevation{constructor(n,c){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,v,b]=function(N){const Z=new a.StructArrayLayout2i4,$=new a.StructArrayLayout3ui6;Z.reserve(17161),$.reserve(33800);const Re=a.EXTENT/128,Fe=a.EXTENT+Re/2,et=Fe+Re;for(let nt=-Re;nt<et;nt+=Re)for(let ce=-Re;ce<et;ce+=Re){const We=ce<0||ce>Fe||nt<0||nt>Fe?24575:0,pt=a.clamp(Math.round(ce),0,a.EXTENT),gt=a.clamp(Math.round(nt),0,a.EXTENT);Z.emplaceBack(pt+We,gt)}const Qe=(nt,ce)=>{const We=131*ce+nt;$.emplaceBack(We+1,We,We+131),$.emplaceBack(We+131,We+131+1,We+1)};for(let nt=1;nt<129;nt++)for(let ce=1;ce<129;ce++)Qe(ce,nt);return[0,129].forEach(nt=>{for(let ce=0;ce<130;ce++)Qe(ce,nt),Qe(nt,ce)}),[Z,$,32768]}(),I=n.context;this.gridBuffer=I.createVertexBuffer(m,a.posAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(v),this.gridSegments=a.SegmentVector.simpleSegment(0,0,m.length,v.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,m.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ma(c.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,a.EXTENT,0,a.EXTENT,0,1);const M=I.gl;this._overlapStencilMode=new a.StencilMode({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new qa(c.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,c,m){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const v=n.terrain.properties;this.sourceCache=0===n.terrain.drapeRenderMode?this._mockSourceCache:n._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const b=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(c,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),c.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==n.efficiency&&a.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&"source"===n.dataType?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):"style"===n.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=c.getIds().map(N=>{const Z=c.getTileByID(N).tileID;return Z.projMatrix=m.calculateProjMatrix(Z.toUnwrapped()),Z});(function(N,Z){const $=Z.transform.pointCoordinate(Z.transform.getCameraPoint()),re=new a.Point($.x,$.y);N.sort((Re,Fe)=>{if(Fe.overscaledZ-Re.overscaledZ)return Fe.overscaledZ-Re.overscaledZ;const et=new a.Point(Re.canonical.x+(1<<Re.canonical.z)*Re.wrap,Re.canonical.y),Qe=new a.Point(Fe.canonical.x+(1<<Fe.canonical.z)*Fe.wrap,Fe.canonical.y),nt=re.mult(1<<Re.canonical.z);return nt.x-=.5,nt.y-=.5,nt.distSqr(et)-nt.distSqr(Qe)})})(v,this.painter),this._previousZoom=m.zoom;const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(N=>{this.proxyToSource[N.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const N in I){const Z=I[N];if(!Z.used||(Z!==this.sourceCache&&this.resetTileLookupCache(Z.id),this._setupProxiedCoordsForOrtho(Z,n[N],b),Z.usedForTerrain))continue;const $=n[N];Z.getSource().reparseOverscaled&&this._assignTerrainTiles($)}this.proxiedCoords[c.id]=v.map(N=>new Ya(N,N.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const M={};this._visibleDemTiles=[];for(const N of this.proxyCoords){const Z=this.terrainTileForTile[N.key];if(!Z)continue;const $=Z.tileID.key;$ in M||(this._visibleDemTiles.push(Z),M[$]=$)}}_assignTerrainTiles(n){this._initializing||n.forEach(c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){const n=this.painter.context,c=n.gl;for(const m in this.terrainTileForTile){const v=this.terrainTileForTile[m],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(n.activeTexture.set(c.TEXTURE1),Ga(this.painter,v,b))}}_prepareDemTileUniforms(n,c,m,v){if(!c||null==c.demTexture)return!1;const b=n.tileID.canonical,I=Math.pow(2,c.tileID.canonical.z-b.z),M=v||"";return m[`u_dem_tl${M}`]=[b.x*I%1,b.y*I%1],m[`u_dem_scale${M}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,c=n.gl;if(!this._emptyDepthBufferTexture){const m=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(n,m,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const c=this._visibleDemTiles.reduce((m,v)=>{if(!v.dem)return m;const b=v.dem.tree.minimums[0];return b>0&&n++,m+b},0);return n?c/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,c=n.gl;n.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),v=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new a.Texture(n,v,c.RGBA,{premultiply:!1}),b}setupElevationDraw(n,c,m){const v=this.painter.context,b=v.gl,I=(M=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(M),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var M;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();let N=null,Z=null,$=1;if(m&&m.morphing&&this._useVertexMorphing){const re=m.morphing.srcDemTile,Re=m.morphing.dstDemTile;$=m.morphing.phase,re&&Re&&(this._prepareDemTileUniforms(n,re,I,"_prev")&&(Z=re),this._prepareDemTileUniforms(n,Re,I)&&(N=Re))}if(Z&&N?(v.activeTexture.set(b.TEXTURE2),N.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),v.activeTexture.set(b.TEXTURE4),Z.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),I.u_dem_lerp=$):(N=this.terrainTileForTile[n.tileID.key],v.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(n,N,I)?N.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),v.activeTexture.set(b.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&N){const re=(1<<N.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=re}if(m&&m.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(v,I),"globe"===this.painter.transform.projection.name){const re=this.globeUniformValues(this.painter.transform,n.tileID.canonical,m&&m.useDenormalizedUpVectorScale);c.setGlobeUniformValues(v,re)}}globeUniformValues(n,c,m){const v=n.projection;return{u_tile_tl_up:v.upVector(c,0,0),u_tile_tr_up:v.upVector(c,a.EXTENT,0),u_tile_br_up:v.upVector(c,a.EXTENT,a.EXTENT),u_tile_bl_up:v.upVector(c,0,a.EXTENT),u_tile_up_scale:m?a.globeMetersToEcef(1):v.upVectorScale(c,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const c=this.painter,m=this.painter.context;0!==n.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,b,I,M,N){if("globe"===v.transform.projection.name)!function(Z,$,re,Re,Fe){const et=Z.context,Qe=et.gl;let nt,ce;const We=Z.options.showTerrainWireframe?2:0,pt=Z.transform,gt=a.globeUseCustomAntiAliasing(Z,et,pt),Pt=(Zn,ln)=>{if(ce===Zn)return;const An=[Sa[Zn],"PROJECTION_GLOBE_VIEW"];gt&&An.push("CUSTOM_ANTIALIASING"),ln&&An.push(Sa[We]),nt=Z.useProgram("globeRaster",null,An),ce=Zn},Ft=Z.colorModeForRenderPass(),Rt=new a.DepthMode(Qe.LEQUAL,a.DepthMode.ReadWrite,Z.depthRangeFor3D);bo.update(Fe);const qt=a.calculateGlobeMercatorMatrix(pt),Wt=[a.mercatorXfromLng(pt.center.lng),a.mercatorYfromLat(pt.center.lat)],an=We?[!1,!0]:[!1],Yn=Z.globeSharedBuffers,tn=[pt.width*a.exported.devicePixelRatio,pt.height*a.exported.devicePixelRatio],Pn=Float32Array.from(pt.globeMatrix),dn={useDenormalizedUpVectorScale:!0};if(an.forEach(Zn=>{const ln=Z.transform,An=ia(ln.zoom)*$.exaggeration();ce=-1;const Qn=Zn?Qe.LINES:Qe.TRIANGLES;for(const jn of Re){const ei=re.getTile(jn),Ai=a.StencilMode.disabled,Ji=$.prevTerrainTileForTile[jn.key],wi=$.terrainTileForTile[jn.key];js(Ji,wi)&&bo.newMorphing(jn.key,Ji,wi,Fe,250),et.activeTexture.set(Qe.TEXTURE0),ei.texture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE);const Si=bo.getMorphValuesForProxy(jn.key),fr=Si?1:0;Si&&a.extend$1(dn,{morphing:{srcDemTile:Si.from,dstDemTile:Si.to,phase:a.easeCubicInOut(Si.phase)}});const tr=a.tileCornersToBounds(jn.canonical),Di=a.getLatitudinalLod(tr.getCenter().lat),Dr=a.getGridMatrix(jn.canonical,tr,Di,ln.worldSize/ln._pixelsPerMercatorPixel),Qr=a.globeNormalizeECEF(a.globeTileBounds(jn.canonical)),Vr=Ha(ln.projMatrix,Pn,qt,Qr,a.globeToMercatorTransition(ln.zoom),Wt,ln.frustumCorners.TL,ln.frustumCorners.TR,ln.frustumCorners.BR,ln.frustumCorners.BL,ln.globeCenterInViewSpace,ln.globeRadius,tn,An,Dr);if(Pt(fr,Zn),$.setupElevationDraw(ei,nt,dn),Z.prepareDrawProgram(et,nt,jn.toUnwrapped()),Yn){const[$r,gs,oo]=Zn?Yn.getWirefameBuffers(Z.context,Di):Yn.getGridBuffers(Di,0!==An);nt.draw(et,Qn,Rt,Ai,Ft,a.CullFaceMode.backCCW,Vr,"globe_raster",$r,gs,oo)}}}),Yn){const Zn=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];gt&&Zn.push("CUSTOM_ANTIALIASING"),nt=Z.useProgram("globeRaster",null,Zn);for(const ln of Re){const{x:An,y:Qn,z:jn}=ln.canonical,ei=0===Qn,Ai=Qn===(1<<jn)-1,[Ji,wi,Si,fr]=Yn.getPoleBuffers(jn);if(fr&&(ei||Ai)){const tr=re.getTile(ln);et.activeTexture.set(Qe.TEXTURE0),tr.texture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE);let Di=a.globePoleMatrixForTile(jn,An,pt);const Dr=a.globeNormalizeECEF(a.globeTileBounds(ln.canonical)),Qr=(Vr,$r)=>Vr.draw(et,Qe.TRIANGLES,Rt,a.StencilMode.disabled,Ft,a.CullFaceMode.disabled,Ha(pt.projMatrix,Di,Di,Dr,0,Wt,pt.frustumCorners.TL,pt.frustumCorners.TR,pt.frustumCorners.BR,pt.frustumCorners.BL,pt.globeCenterInViewSpace,pt.globeRadius,tn,0),"globe_pole_raster",$r,Si,fr);$.setupElevationDraw(tr,nt,dn),Z.prepareDrawProgram(et,nt,ln.toUnwrapped()),ei&&Qr(nt,Ji),Ai&&(Di=a.scale(a.create(),Di,[1,-1,1]),Qr(nt,wi))}}}}(v,b,I,M,N);else{const Z=v.context,$=Z.gl;let re,Re;const Fe=v.options.showTerrainWireframe?2:0,et=(pt,gt)=>{if(Re===pt)return;const Pt=[Sa[pt]];gt&&Pt.push(Sa[Fe]),re=v.useProgram("terrainRaster",null,Pt),Re=pt},Qe=v.colorModeForRenderPass(),nt=new a.DepthMode($.LEQUAL,a.DepthMode.ReadWrite,v.depthRangeFor3D);bo.update(N);const ce=v.transform,We=ia(ce.zoom)*b.exaggeration();(Fe?[!1,!0]:[!1]).forEach(pt=>{Re=-1;const gt=pt?$.LINES:$.TRIANGLES,[Pt,Ft]=pt?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const Rt of M){const qt=I.getTile(Rt),Wt=a.StencilMode.disabled,an=b.prevTerrainTileForTile[Rt.key],Yn=b.terrainTileForTile[Rt.key];js(an,Yn)&&bo.newMorphing(Rt.key,an,Yn,N,250),Z.activeTexture.set($.TEXTURE0),qt.texture.bind($.LINEAR,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST);const tn=bo.getMorphValuesForProxy(Rt.key),Pn=tn?1:0;let dn;tn&&(dn={morphing:{srcDemTile:tn.from,dstDemTile:tn.to,phase:a.easeCubicInOut(tn.phase)}});const Zn=pa(Rt.projMatrix,Ol(Rt.canonical,ce.renderWorldCopies)?We/10:We);et(Pn,pt),b.setupElevationDraw(qt,re,dn),v.prepareDrawProgram(Z,re,Rt.toUnwrapped()),re.draw(Z,gt,nt,Wt,Qe,a.CullFaceMode.backCCW,Zn,"terrain_raster",b.gridBuffer,Pt,Ft)}})}}(c,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(0===this._drapedRenderBatches.length)return n+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],I=this._drapedRenderBatches.shift(),M=[],N=c.style.order;let Z=0;for(const $ of b){const re=v.getTileByID($.proxyTileKey),Re=v.proxyCachedFBO[$.key]?v.proxyCachedFBO[$.key][n]:void 0,Fe=void 0!==Re?v.renderCache[Re]:this.pool[Z++],et=void 0!==Re;if(re.texture=Fe.tex,et&&!Fe.dirty){M.push(re.tileID);continue}let Qe;m.bindFramebuffer.set(Fe.fb.framebuffer),this.renderedToTile=!1,Fe.dirty&&(m.clear({color:a.Color.transparent,stencil:0}),Fe.dirty=!1);for(let nt=I.start;nt<=I.end;++nt){const ce=c.style._layers[N[nt]];if(ce.isHidden(c.transform.zoom))continue;const We=c.style._getLayerSourceCache(ce),pt=We?this.proxyToSource[$.key][We.id]:[$];if(!pt)continue;const gt=pt;m.viewport.set([0,0,Fe.fb.width,Fe.fb.height]),Qe!==(We?We.id:null)&&(this._setupStencil(Fe,pt,ce,We),Qe=We?We.id:null),c.renderLayer(c,We,ce,gt)}this.renderedToTile?(Fe.dirty=!0,M.push(re.tileID)):et||--Z,5===Z&&(Z=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),I.end+1}postRender(){}renderCacheEfficiency(n){const c=n.order.length;if(0===c)return{efficiency:100};let m,v=0,b=0,I=!1;for(let M=0;M<c;++M){const N=n._layers[n.order[M]];this._style.isLayerDraped(N)?(I&&++v,++b):I||(I=!0,m=N.id)}return 0===b?{efficiency:100}:{efficiency:100*(1-v/b),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{n=Math.min(n,c.dem.tree.minimums[0])}),0===n?n:(n-30)*this._exaggeration}raycast(n,c,m){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const I=b.tileID,M=1<<I.overscaledZ,{x:N,y:Z}=I.canonical,$=N/M,re=(N+1)/M,Re=Z/M,Fe=(Z+1)/M;return{minx:$,miny:Re,maxx:re,maxy:Fe,t:b.dem.tree.raycastRoot($,Re,re,Fe,n,c,m),tile:b}});v.sort((b,I)=>(null!==b.t?b.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const b of v){if(null==b.t)return null;const I=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,c,m);if(null!=I)return I}return null}_createFBO(){const n=this.painter.context,c=n.gl,m=this.drapeBufferSize;n.activeTexture.set(c.TEXTURE0);const v=new a.Texture(n,{width:m[0],height:m[1],data:null},c.RGBA);v.bind(c.LINEAR,c.CLAMP_TO_EDGE);const b=n.createFramebuffer(m[0],m[1],!1);return b.colorAttachment.set(v.texture),b.depthAttachment=new Et(n,b.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const c=this._style._layers[n],m=c.isHidden(this.painter.transform.zoom);return"custom"===c.type?!m&&c.shouldRedrape():!m&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const m of this._style._getSources())if(m instanceof mn){n=!0;break}if(!n)return;const c={};for(let m=0;m<this._style.order.length;++m){const v=this._style._layers[this._style.order[m]],b=this._style._getLayerSourceCache(v);if(b&&!c[b.id]&&!v.isHidden(this.painter.transform.zoom)&&"line"===v.type&&v.widthExpression()instanceof a.ZoomDependentExpression){c[b.id]=!0;for(const I of this.proxyCoords){const M=this.proxyToSource[I.key][b.id];if(M)for(const N of M)this._clearRenderCacheForTile(b.id,N)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const m in this._style._sourceCaches)if(this._style._sourceCaches[m]._source instanceof ae){n=!0;break}if(!n)return;const c={};for(let m=0;m<this._style.order.length;++m){const v=this._style._layers[this._style.order[m]],b=this._style._getLayerSourceCache(v);if(!b||c[b.id]||v.isHidden(this.painter.transform.zoom)||"raster"!==v.type)continue;const I=v.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const N=this.proxyToSource[M.key][b.id];if(N)for(const Z of N){const $=Rl(b.getTile(Z),b.findLoadedParent(Z,0),b,this.painter.transform,I);(1!==$.opacity||0!==$.mix)&&this._clearRenderCacheForTile(b.id,Z)}}}}_setupDrapedRenderBatches(){const n=this._style.order,c=n.length;if(0===c)return;const m=[];let v,b=0,I=this._style._layers[n[b]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++b<c;)I=this._style._layers[n[b]];for(;b<c;++b){const M=this._style._layers[n[b]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?void 0===v&&(v=b):void 0!==v&&(m.push({start:v,end:b-1}),v=void 0))}void 0!==v&&m.push({start:v,end:b-1}),this._drapedRenderBatches=m}_setupRenderCache(n){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const I=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let M=0;M<I.length;++M){const N=Object.values(I[M]);c.renderCachePool.push(...N)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,v=this._tilesDirty;for(let I=m.length-1;I>=0;I--){const M=m[I];if(c.getTileByID(M.key),void 0!==c.proxyCachedFBO[M.key]){const N=n[M.key],Z=this.proxyToSource[M.key];let $=0;for(const re in Z){const Re=Z[re],Fe=N[re];if(!Fe||Fe.length!==Re.length||Re.some((et,Qe)=>et!==Fe[Qe]||v[re]&&v[re].hasOwnProperty(et.key))){$=-1;break}++$}for(const re in c.proxyCachedFBO[M.key])c.renderCache[c.proxyCachedFBO[M.key][re]].dirty=$<0||$!==Object.values(N).length}}const b=[...this._drapedRenderBatches];b.sort((I,M)=>M.end-M.start-(I.end-I.start));for(const I of b)for(const M of m){if(c.proxyCachedFBO[M.key])continue;let N=c.renderCachePool.pop();void 0===N&&c.renderCache.length<50&&(N=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==N&&(c.proxyCachedFBO[M.key]={},c.proxyCachedFBO[M.key][I.start]=N,c.renderCache[N].dirty=!0)}this._tilesDirty={}}_setupStencil(n,c,m,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,I=b.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let M;if(m.isTileClipped())M=c.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(n,c){const m=this.painter,v=this.painter.context,b=v.gl;m._tileClippingMaskIDs={},v.setColorMode(a.ColorMode.disabled),v.setDepthMode(a.DepthMode.disabled);const I=m.useProgram("clippingMask");for(const M of n){const N=m._tileClippingMaskIDs[M.key]=--c;I.draw(v,b.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:b.ALWAYS,mask:0},N,255,b.KEEP,b.KEEP,b.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Wa(M.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(n){const c=this.painter.transform;if(n.x<0||n.x>c.width||n.y<0||n.y>c.height)return null;const m=[n.x,n.y,1,1];a.transformMat4$1(m,m,c.pixelMatrixInverse),a.scale$1(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const v=c._camera.position,b=a.mercatorZfromAltitude(1,c.center.lat),I=[v[0],v[1],v[2]/b,0],M=a.subtract([],m.slice(0,3),I);a.normalize(M,M);const N=this.raycast(I,M,this._exaggeration);return null!==N&&N?(a.scaleAndAdd(I,I,M,N),I[3]=I[2],I[2]*=b,I):null}drawDepth(){const n=this.painter,c=n.context,m=this.proxySourceCache,v=Math.ceil(n.width),b=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=c.gl,M=c.createFramebuffer(v,b,!0);c.activeTexture.set(I.TEXTURE0);const N=new a.Texture(c,{width:v,height:b,data:null},I.RGBA);N.bind(I.NEAREST,I.CLAMP_TO_EDGE),M.colorAttachment.set(N.texture);const Z=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,v,b);M.depthAttachment.set(Z),this._depthFBO=M,this._depthTexture=N}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,v,b]),function(I,M,N,Z){if("globe"===I.transform.projection.name)return;const $=I.context,re=$.gl;$.clear({depth:1});const Re=I.useProgram("terrainDepth"),Fe=new a.DepthMode(re.LESS,a.DepthMode.ReadWrite,I.depthRangeFor3D);for(const et of Z){const Qe=N.getTile(et),nt=pa(et.projMatrix,0);M.setupElevationDraw(Qe,Re),Re.draw($,re.TRIANGLES,Fe,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,nt,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}}(n,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,c,m){if(n.getSource()instanceof G)return this._setupProxiedCoordsForImageSource(n,c,m);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const v=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let M=0;M<b.length;M++){const N=b[M],Z=this._findTileCoveringTileID(N,n);if(Z){const $=this._createProxiedId(N,Z,m[N.key]&&m[N.key][n.id]);v.push($),this.proxyToSource[N.key][n.id]=[$]}}let I=!1;for(let M=0;M<c.length;M++){const N=n.getTile(c[M]);if(!N||!N.hasData())continue;const Z=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(Z&&Z.tileID.canonical.z!==N.tileID.canonical.z){const $=this.proxyToSource[Z.tileID.key][n.id],re=this._createProxiedId(Z.tileID,N,m[Z.tileID.key]&&m[Z.tileID.key][n.id]);$?$.splice($.length-1,0,re):this.proxyToSource[Z.tileID.key][n.id]=[re],v.push(re),I=!0}}this._sourceTilesOverlap[n.id]=I}_setupProxiedCoordsForImageSource(n,c,m){if(!n.getSource().loaded())return;const v=this.proxiedCoords[n.id]=[],b=this.proxyCoords,I=n.getSource(),M=new a.Point(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),N=I.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce(($,re)=>($.min.x=Math.min($.min.x,re.x-M.x),$.min.y=Math.min($.min.y,re.y-M.y),$.max.x=Math.max($.max.x,re.x-M.x),$.max.y=Math.max($.max.y,re.y-M.y),$),{min:new a.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Z=($,re)=>{const Re=$.wrap+$.canonical.x/(1<<$.canonical.z),Fe=$.canonical.y/(1<<$.canonical.z),et=a.EXTENT/(1<<$.canonical.z),Qe=re.wrap+re.canonical.x/(1<<re.canonical.z),nt=re.canonical.y/(1<<re.canonical.z);return Re+et<Qe+N.min.x||Re>Qe+N.max.x||Fe+et<nt+N.min.y||Fe>nt+N.max.y};for(let $=0;$<b.length;$++){const re=b[$];for(let Re=0;Re<c.length;Re++){const Fe=n.getTile(c[Re]);if(!Fe||!Fe.hasData()||Z(re,Fe.tileID))continue;const et=this._createProxiedId(re,Fe,m[re.key]&&m[re.key][n.id]),Qe=this.proxyToSource[re.key][n.id];Qe?Qe.push(et):this.proxyToSource[re.key][n.id]=[et],v.push(et)}}}_createProxiedId(n,c,m){let v=this.orthoMatrix;if(m){const b=m.find(I=>I.key===c.tileID.key);if(b)return b}if(c.tileID.key!==n.key){const b=n.canonical.z-c.tileID.canonical.z;let I,M,N;v=a.create();const Z=c.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(I=a.EXTENT>>b,M=I*((c.tileID.canonical.x<<b)-n.canonical.x+Z),N=I*((c.tileID.canonical.y<<b)-n.canonical.y)):(I=a.EXTENT<<-b,M=a.EXTENT*(c.tileID.canonical.x-(n.canonical.x+Z<<-b)),N=a.EXTENT*(c.tileID.canonical.y-(n.canonical.y<<-b))),a.ortho(v,0,I,0,I,0,1),a.translate(v,v,[M,N,0])}return new Ya(c.tileID,n.key,v)}_findTileCoveringTileID(n,c){let m=c.getTile(n);if(m&&m.hasData())return m;const v=this._findCoveringTileCache[c.id],b=v[n.key];if(m=b?c.getTileByID(b):null,m&&m.hasData()||null===b)return m;let I=m?m.tileID:n,M=I.overscaledZ;const N=c.getSource().minzoom,Z=[];if(!b){const re=c.getSource().maxzoom;if(n.canonical.z>=re){const Re=n.canonical.z-re;c.getSource().reparseOverscaled?(M=Math.max(n.canonical.z+2,c.transform.tileZoom),I=new a.OverscaledTileID(M,n.wrap,re,n.canonical.x>>Re,n.canonical.y>>Re)):0!==Re&&(M=re,I=new a.OverscaledTileID(M,n.wrap,re,n.canonical.x>>Re,n.canonical.y>>Re))}I.key!==n.key&&(Z.push(I.key),m=c.getTile(I))}const $=re=>{Z.forEach(Re=>{v[Re]=re}),Z.length=0};for(M-=1;M>=N&&(!m||!m.hasData());M--){m&&$(m.tileID.key);const re=I.calculateScaledKey(M);if(m=c.getTileByID(re),m&&m.hasData())break;const Re=v[re];if(null===Re)break;void 0===Re?Z.push(re):m=c.getTileByID(Re)}return $(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,c){let m=this._tilesDirty[n];m||(m=this._tilesDirty[n]={}),m[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(c){let m=0;const v=new a.StructArrayLayout2ui4,b=131;for(let I=1;I<129;I++){for(let M=1;M<129;M++)m=I*b+M,v.emplaceBack(m,m+1),v.emplaceBack(m,m+b),v.emplaceBack(m+1,m+b),128===I&&v.emplaceBack(m+b,m+b+1);v.emplaceBack(m+1,m+1+b)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class _i{static cacheKey(n,c,m,v){let b=`${c}${v?v.cacheKey:""}`;for(const I of m)n.usedDefines.includes(I)&&(b+=`/${I}`);return b}constructor(n,c,m,v,b,I){const M=n.gl;this.program=M.createProgram();const N=function(ce){const We=[];for(let pt=0;pt<ce.length;pt++){if(null===ce[pt])continue;const gt=ce[pt].split(" ");We.push(gt.pop())}return We}(m.staticAttributes),Z=v?v.getBinderAttributes():[],$=N.concat(Z);let re=v?v.defines():[];re=re.concat(I.map(ce=>`#define ${ce}`));const Re=n.isWebGL2?"#version 300 es\n":"",Fe=Re+re.concat(n.extStandardDerivatives&&0===Re.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Za):Za,Za,Us,na.fragmentSource,ha.fragmentSource,m.fragmentSource).join("\n"),et=Re+re.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Us,na.vertexSource,ha.vertexSource,ns.vertexSource,m.vertexSource).join("\n"),Qe=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(Qe,Fe),M.compileShader(Qe),M.attachShader(this.program,Qe);const nt=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(nt,et),M.compileShader(nt),M.attachShader(this.program,nt),this.attributes={},this.numAttributes=$.length;for(let ce=0;ce<this.numAttributes;ce++)$[ce]&&(M.bindAttribLocation(this.program,ce,$[ce]),this.attributes[$[ce]]=ce);M.linkProgram(this.program),M.deleteShader(nt),M.deleteShader(Qe),this.fixedUniforms=b(n),this.binderUniforms=v?v.getUniforms(n):[],I.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new a.Uniform1i(ce=n),u_dem_prev:new a.Uniform1i(ce),u_dem_unpack:new a.Uniform4f(ce),u_dem_tl:new a.Uniform2f(ce),u_dem_scale:new a.Uniform1f(ce),u_dem_tl_prev:new a.Uniform2f(ce),u_dem_scale_prev:new a.Uniform1f(ce),u_dem_size:new a.Uniform1f(ce),u_dem_lerp:new a.Uniform1f(ce),u_exaggeration:new a.Uniform1f(ce),u_depth:new a.Uniform1i(ce),u_depth_size_inv:new a.Uniform2f(ce),u_meter_to_dem:new a.Uniform1f(ce),u_label_plane_matrix_inv:new a.UniformMatrix4f(ce)}),I.includes("GLOBE")&&(this.globeUniforms=(ce=>({u_tile_tl_up:new a.Uniform3f(ce),u_tile_tr_up:new a.Uniform3f(ce),u_tile_br_up:new a.Uniform3f(ce),u_tile_bl_up:new a.Uniform3f(ce),u_tile_up_scale:new a.Uniform1f(ce)}))(n)),I.includes("FOG")&&(this.fogUniforms=(ce=>({u_fog_matrix:new a.UniformMatrix4f(ce),u_fog_range:new a.Uniform2f(ce),u_fog_color:new a.Uniform4f(ce),u_fog_horizon_blend:new a.Uniform1f(ce),u_fog_temporal_offset:new a.Uniform1f(ce),u_frustum_tl:new a.Uniform3f(ce),u_frustum_tr:new a.Uniform3f(ce),u_frustum_br:new a.Uniform3f(ce),u_frustum_bl:new a.Uniform3f(ce),u_globe_pos:new a.Uniform3f(ce),u_globe_radius:new a.Uniform1f(ce),u_globe_transition:new a.Uniform1f(ce),u_is_globe:new a.Uniform1i(ce),u_viewport:new a.Uniform2f(ce)}))(n))}var ce}setTerrainUniformValues(n,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in c)m[v]&&m[v].set(this.program,v,c[v])}}setGlobeUniformValues(n,c){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in c)m[v]&&m[v].set(this.program,v,c[v])}}setFogUniformValues(n,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in c)m[v].set(this.program,v,c[v])}}draw(n,c,m,v,b,I,M,N,Z,$,re,Re,Fe,et,Qe){const nt=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(m),n.setStencilMode(v),n.setColorMode(b),n.setCullFace(I);for(const We of Object.keys(this.fixedUniforms))this.fixedUniforms[We].set(this.program,We,M[We]);et&&et.setUniforms(this.program,n,this.binderUniforms,Re,{zoom:Fe});const ce={[nt.LINES]:2,[nt.TRIANGLES]:3,[nt.LINE_STRIP]:1}[c];for(const We of re.get()){const pt=We.vaos||(We.vaos={});(pt[N]||(pt[N]=new Sl)).bind(n,this,Z,et?et.getPaintVertexBuffers():[],$,We.vertexOffset,Qe||[]),nt.drawElements(c,We.primitiveLength*ce,nt.UNSIGNED_SHORT,We.primitiveOffset*ce*2)}}}function Br(d,n){const c=Math.pow(2,n.tileID.overscaledZ),m=n.tileSize*Math.pow(2,d.transform.tileZoom)/c,v=m*(n.tileID.canonical.x+n.tileID.wrap*c),b=m*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_tile_units_to_pixels:1/xn(n,1,d.transform.tileZoom),u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const Ao=a.create(),le=(d,n,c,m,v,b,I,M,N,Z,$)=>{const re=n.style.light,Re=re.properties.get("position"),Fe=[Re.x,Re.y,Re.z],et=a.create$1();"viewport"===re.properties.get("anchor")&&(a.fromRotation(et,-n.transform.angle),a.transformMat3(Fe,Fe,et));const Qe=re.properties.get("color"),nt=n.transform,ce={u_matrix:d,u_lightpos:Fe,u_lightintensity:re.properties.get("intensity"),u_lightcolor:[Qe.r,Qe.g,Qe.b],u_vertical_gradient:+c,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ao,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:b};return"globe"===nt.projection.name&&(ce.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],ce.u_zoom_transition=N,ce.u_inv_rot_matrix=$,ce.u_merc_center=Z,ce.u_up_dir=nt.projection.upVector(new a.CanonicalTileID(0,0,0),Z[0]*a.EXTENT,Z[1]*a.EXTENT),ce.u_height_lift=M),ce},ue=(d,n,c,m,v,b,I,M,N,Z,$,re)=>{const Re=le(d,n,c,m,v,b,I,N,Z,$,re),Fe={u_height_factor:-Math.pow(2,I.overscaledZ)/M.tileSize/8};return a.extend(Re,Br(n,M),Fe)},W=d=>({u_matrix:d}),He=(d,n,c)=>a.extend(W(d),Br(n,c)),zt=(d,n)=>({u_matrix:d,u_world:n}),vi=(d,n,c,m)=>a.extend(He(d,n,c),{u_world:m}),dr=a.create(),wr=(d,n,c,m,v,b)=>{const I=d.transform,M="globe"===I.projection.name;let N;if("map"===b.paint.get("circle-pitch-alignment"))if(M){const $=a.globePixelsToTileUnits(I.zoom,n.canonical)*I._pixelsPerMercatorPixel;N=Float32Array.from([$,0,0,$])}else N=I.calculatePixelsToTileUnitsMatrix(c);else N=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const Z={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:d.translatePosMatrix(n.projMatrix,c,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:N,u_inv_rot_matrix:dr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){Z.u_inv_rot_matrix=m,Z.u_merc_center=v,Z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],Z.u_zoom_transition=a.globeToMercatorTransition(I.zoom);const $=v[0]*a.EXTENT,re=v[1]*a.EXTENT;Z.u_up_dir=I.projection.upVector(new a.CanonicalTileID(0,0,0),$,re)}return Z},ai=d=>{const n=[];return"map"===d.paint.get("circle-pitch-alignment")&&n.push("PITCH_WITH_MAP"),"map"===d.paint.get("circle-pitch-scale")&&n.push("SCALE_WITH_MAP"),n},Ni=(d,n,c,m)=>{const v=a.EXTENT/c.tileSize;return{u_matrix:d,u_camera_to_center_distance:n.getCameraToCenterDistance(m),u_extrude_scale:[n.pixelsToGLUnits[0]/v,n.pixelsToGLUnits[1]/v]}},Jr=(d,n,c=1)=>({u_matrix:d,u_color:n,u_overlay:0,u_overlay_scale:c}),us=a.create(),wo=(d,n,c,m,v,b,I)=>{const M=d.transform,N="globe"===M.projection.name,Z=N?a.globePixelsToTileUnits(M.zoom,n.canonical)*M._pixelsPerMercatorPixel:xn(c,1,b),$={u_matrix:n.projMatrix,u_extrude_scale:Z,u_intensity:I,u_inv_rot_matrix:us,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(N){$.u_inv_rot_matrix=m,$.u_merc_center=v,$.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],$.u_zoom_transition=a.globeToMercatorTransition(M.zoom);const re=v[0]*a.EXTENT,Re=v[1]*a.EXTENT;$.u_up_dir=M.projection.upVector(new a.CanonicalTileID(0,0,0),re,Re)}return $},Ho=(d,n,c,m,v,b,I)=>{const M=d.transform,N=M.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:Vo(d,n,c,m),u_pixels_to_tile_units:N,u_device_pixel_ratio:b,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:Cs(c)?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ar(n,d.transform),u_alpha_discard_threshold:0,u_trim_offset:I}},ra=(d,n,c,m,v)=>{const b=d.transform;return{u_matrix:Vo(d,n,c,m),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:v,u_image:0,u_tile_units_to_pixels:Ar(n,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ar(d,n){return 1/xn(d,1,n.tileZoom)}function Vo(d,n,c,m){return d.translatePosMatrix(m||n.tileID.projMatrix,n,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function Cs(d){const n=d.paint.get("line-dasharray").value;return n.value||"constant"!==n.kind}const Yi=(d,n,c,m,v,b)=>{return{u_matrix:d,u_tl_parent:n,u_scale_parent:c,u_fade_t:m.mix,u_opacity:m.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(M=v.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(I=v.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:Qo(v.paint.get("raster-hue-rotate")),u_perspective_transform:b};var I,M};function Qo(d){d*=Math.PI/180;const n=Math.sin(d),c=Math.cos(d);return[(2*c+1)/3,(-Math.sqrt(3)*n-c+1)/3,(Math.sqrt(3)*n-c+1)/3]}const Pa=a.create(),ds=(d,n,c,m,v,b,I,M,N,Z,$,re,Re,Fe,et,Qe)=>{const nt=v.transform,ce={u_is_size_zoom_constant:+("constant"===d||"source"===d),u_is_size_feature_constant:+("constant"===d||"camera"===d),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:nt.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:nt.width/nt.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:I,u_coord_matrix:M,u_is_text:+N,u_pitch_with_map:+m,u_texsize:Z,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Pa,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Pa,u_up_vector:[0,-1,0]};return"globe"===Qe.name&&(ce.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],ce.u_zoom_transition=re,ce.u_inv_rot_matrix=Fe,ce.u_merc_center=Re,ce.u_camera_forward=nt._camera.forward(),ce.u_ecef_origin=a.globeECEFOrigin(nt.globeMatrix,$.toUnwrapped()),ce.u_tile_matrix=Float32Array.from(nt.globeMatrix),ce.u_up_vector=et),ce},Xr=(d,n,c,m,v,b,I,M,N,Z,$,re,Re,Fe,et,Qe,nt)=>a.extend(ds(d,n,c,m,v,b,I,M,N,Z,re,Re,Fe,et,Qe,nt),{u_gamma_scale:m?v.transform.cameraToCenterDistance*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+$}),Ja=(d,n,c,m,v,b,I,M,N,Z,$,re,Re,Fe,et,Qe)=>a.extend(Xr(d,n,c,m,v,b,I,M,!0,N,!0,$,re,Re,Fe,et,Qe),{u_texsize_icon:Z,u_texture_icon:1}),oa=(d,n,c)=>({u_matrix:d,u_opacity:n,u_color:c}),is=(d,n,c,m,v)=>a.extend(function(b,I,M){const N=I.imageManager.getPattern(b.toString()),{width:Z,height:$}=I.imageManager.getPixelSize(),re=Math.pow(2,M.tileID.overscaledZ),Re=M.tileSize*Math.pow(2,I.transform.tileZoom)/re,Fe=Re*(M.tileID.canonical.x+M.tileID.wrap*re),et=Re*M.tileID.canonical.y;return{u_image:0,u_pattern_tl:N.tl,u_pattern_br:N.br,u_texsize:[Z,$],u_pattern_size:N.displaySize,u_tile_units_to_pixels:1/xn(M,1,I.transform.tileZoom),u_pixel_coord_upper:[Fe>>16,et>>16],u_pixel_coord_lower:[65535&Fe,65535&et]}}(m,c,v),{u_matrix:d,u_opacity:n}),ga={fillExtrusion:d=>({u_matrix:new a.UniformMatrix4f(d),u_lightpos:new a.Uniform3f(d),u_lightintensity:new a.Uniform1f(d),u_lightcolor:new a.Uniform3f(d),u_vertical_gradient:new a.Uniform1f(d),u_opacity:new a.Uniform1f(d),u_edge_radius:new a.Uniform1f(d),u_ao:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_up_dir:new a.Uniform3f(d),u_height_lift:new a.Uniform1f(d)}),fillExtrusionPattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_lightpos:new a.Uniform3f(d),u_lightintensity:new a.Uniform1f(d),u_lightcolor:new a.Uniform3f(d),u_vertical_gradient:new a.Uniform1f(d),u_height_factor:new a.Uniform1f(d),u_edge_radius:new a.Uniform1f(d),u_ao:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_up_dir:new a.Uniform3f(d),u_height_lift:new a.Uniform1f(d),u_image:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_pixel_coord_upper:new a.Uniform2f(d),u_pixel_coord_lower:new a.Uniform2f(d),u_tile_units_to_pixels:new a.Uniform1f(d),u_opacity:new a.Uniform1f(d)}),fill:d=>({u_matrix:new a.UniformMatrix4f(d)}),fillPattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_image:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_pixel_coord_upper:new a.Uniform2f(d),u_pixel_coord_lower:new a.Uniform2f(d),u_tile_units_to_pixels:new a.Uniform1f(d)}),fillOutline:d=>({u_matrix:new a.UniformMatrix4f(d),u_world:new a.Uniform2f(d)}),fillOutlinePattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_world:new a.Uniform2f(d),u_image:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_pixel_coord_upper:new a.Uniform2f(d),u_pixel_coord_lower:new a.Uniform2f(d),u_tile_units_to_pixels:new a.Uniform1f(d)}),circle:d=>({u_camera_to_center_distance:new a.Uniform1f(d),u_extrude_scale:new a.UniformMatrix2f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_up_dir:new a.Uniform3f(d)}),collisionBox:d=>({u_matrix:new a.UniformMatrix4f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_extrude_scale:new a.Uniform2f(d)}),collisionCircle:d=>({u_matrix:new a.UniformMatrix4f(d),u_inv_matrix:new a.UniformMatrix4f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_viewport_size:new a.Uniform2f(d)}),debug:d=>({u_color:new a.UniformColor(d),u_matrix:new a.UniformMatrix4f(d),u_overlay:new a.Uniform1i(d),u_overlay_scale:new a.Uniform1f(d)}),clippingMask:d=>({u_matrix:new a.UniformMatrix4f(d)}),heatmap:d=>({u_extrude_scale:new a.Uniform1f(d),u_intensity:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_up_dir:new a.Uniform3f(d)}),heatmapTexture:d=>({u_image:new a.Uniform1i(d),u_color_ramp:new a.Uniform1i(d),u_opacity:new a.Uniform1f(d)}),hillshade:d=>({u_matrix:new a.UniformMatrix4f(d),u_image:new a.Uniform1i(d),u_latrange:new a.Uniform2f(d),u_light:new a.Uniform2f(d),u_shadow:new a.UniformColor(d),u_highlight:new a.UniformColor(d),u_accent:new a.UniformColor(d)}),hillshadePrepare:d=>({u_matrix:new a.UniformMatrix4f(d),u_image:new a.Uniform1i(d),u_dimension:new a.Uniform2f(d),u_zoom:new a.Uniform1f(d),u_unpack:new a.Uniform4f(d)}),line:d=>({u_matrix:new a.UniformMatrix4f(d),u_pixels_to_tile_units:new a.UniformMatrix2f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_units_to_pixels:new a.Uniform2f(d),u_dash_image:new a.Uniform1i(d),u_gradient_image:new a.Uniform1i(d),u_image_height:new a.Uniform1f(d),u_texsize:new a.Uniform2f(d),u_tile_units_to_pixels:new a.Uniform1f(d),u_alpha_discard_threshold:new a.Uniform1f(d),u_trim_offset:new a.Uniform2f(d)}),linePattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_texsize:new a.Uniform2f(d),u_pixels_to_tile_units:new a.UniformMatrix2f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_image:new a.Uniform1i(d),u_units_to_pixels:new a.Uniform2f(d),u_tile_units_to_pixels:new a.Uniform1f(d),u_alpha_discard_threshold:new a.Uniform1f(d)}),raster:d=>({u_matrix:new a.UniformMatrix4f(d),u_tl_parent:new a.Uniform2f(d),u_scale_parent:new a.Uniform1f(d),u_fade_t:new a.Uniform1f(d),u_opacity:new a.Uniform1f(d),u_image0:new a.Uniform1i(d),u_image1:new a.Uniform1i(d),u_brightness_low:new a.Uniform1f(d),u_brightness_high:new a.Uniform1f(d),u_saturation_factor:new a.Uniform1f(d),u_contrast_factor:new a.Uniform1f(d),u_spin_weights:new a.Uniform3f(d),u_perspective_transform:new a.Uniform2f(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new a.Uniform1i(d),u_is_size_feature_constant:new a.Uniform1i(d),u_size_t:new a.Uniform1f(d),u_size:new a.Uniform1f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_rotate_symbol:new a.Uniform1i(d),u_aspect_ratio:new a.Uniform1f(d),u_fade_change:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_label_plane_matrix:new a.UniformMatrix4f(d),u_coord_matrix:new a.UniformMatrix4f(d),u_is_text:new a.Uniform1i(d),u_pitch_with_map:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_camera_forward:new a.Uniform3f(d),u_tile_matrix:new a.UniformMatrix4f(d),u_up_vector:new a.Uniform3f(d),u_ecef_origin:new a.Uniform3f(d),u_texture:new a.Uniform1i(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new a.Uniform1i(d),u_is_size_feature_constant:new a.Uniform1i(d),u_size_t:new a.Uniform1f(d),u_size:new a.Uniform1f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_rotate_symbol:new a.Uniform1i(d),u_aspect_ratio:new a.Uniform1f(d),u_fade_change:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_label_plane_matrix:new a.UniformMatrix4f(d),u_coord_matrix:new a.UniformMatrix4f(d),u_is_text:new a.Uniform1i(d),u_pitch_with_map:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_texture:new a.Uniform1i(d),u_gamma_scale:new a.Uniform1f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_camera_forward:new a.Uniform3f(d),u_tile_matrix:new a.UniformMatrix4f(d),u_up_vector:new a.Uniform3f(d),u_ecef_origin:new a.Uniform3f(d),u_is_halo:new a.Uniform1i(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new a.Uniform1i(d),u_is_size_feature_constant:new a.Uniform1i(d),u_size_t:new a.Uniform1f(d),u_size:new a.Uniform1f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_rotate_symbol:new a.Uniform1i(d),u_aspect_ratio:new a.Uniform1f(d),u_fade_change:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_label_plane_matrix:new a.UniformMatrix4f(d),u_coord_matrix:new a.UniformMatrix4f(d),u_is_text:new a.Uniform1i(d),u_pitch_with_map:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_texsize_icon:new a.Uniform2f(d),u_texture:new a.Uniform1i(d),u_texture_icon:new a.Uniform1i(d),u_gamma_scale:new a.Uniform1f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_is_halo:new a.Uniform1i(d)}),background:d=>({u_matrix:new a.UniformMatrix4f(d),u_opacity:new a.Uniform1f(d),u_color:new a.UniformColor(d)}),backgroundPattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_opacity:new a.Uniform1f(d),u_image:new a.Uniform1i(d),u_pattern_tl:new a.Uniform2f(d),u_pattern_br:new a.Uniform2f(d),u_texsize:new a.Uniform2f(d),u_pattern_size:new a.Uniform2f(d),u_pixel_coord_upper:new a.Uniform2f(d),u_pixel_coord_lower:new a.Uniform2f(d),u_tile_units_to_pixels:new a.Uniform1f(d)}),terrainRaster:fa,terrainDepth:fa,skybox:d=>({u_matrix:new a.UniformMatrix4f(d),u_sun_direction:new a.Uniform3f(d),u_cubemap:new a.Uniform1i(d),u_opacity:new a.Uniform1f(d),u_temporal_offset:new a.Uniform1f(d)}),skyboxGradient:d=>({u_matrix:new a.UniformMatrix4f(d),u_color_ramp:new a.Uniform1i(d),u_center_direction:new a.Uniform3f(d),u_radius:new a.Uniform1f(d),u_opacity:new a.Uniform1f(d),u_temporal_offset:new a.Uniform1f(d)}),skyboxCapture:d=>({u_matrix_3f:new a.UniformMatrix3f(d),u_sun_direction:new a.Uniform3f(d),u_sun_intensity:new a.Uniform1f(d),u_color_tint_r:new a.Uniform4f(d),u_color_tint_m:new a.Uniform4f(d),u_luminance:new a.Uniform1f(d)}),globeRaster:d=>({u_proj_matrix:new a.UniformMatrix4f(d),u_globe_matrix:new a.UniformMatrix4f(d),u_normalize_matrix:new a.UniformMatrix4f(d),u_merc_matrix:new a.UniformMatrix4f(d),u_zoom_transition:new a.Uniform1f(d),u_merc_center:new a.Uniform2f(d),u_image0:new a.Uniform1i(d),u_grid_matrix:new a.UniformMatrix3f(d),u_skirt_height:new a.Uniform1f(d),u_frustum_tl:new a.Uniform3f(d),u_frustum_tr:new a.Uniform3f(d),u_frustum_br:new a.Uniform3f(d),u_frustum_bl:new a.Uniform3f(d),u_globe_pos:new a.Uniform3f(d),u_globe_radius:new a.Uniform1f(d),u_viewport:new a.Uniform2f(d)}),globeAtmosphere:d=>({u_frustum_tl:new a.Uniform3f(d),u_frustum_tr:new a.Uniform3f(d),u_frustum_br:new a.Uniform3f(d),u_frustum_bl:new a.Uniform3f(d),u_horizon:new a.Uniform1f(d),u_transition:new a.Uniform1f(d),u_fadeout_range:new a.Uniform1f(d),u_color:new a.Uniform4f(d),u_high_color:new a.Uniform4f(d),u_space_color:new a.Uniform4f(d),u_star_intensity:new a.Uniform1f(d),u_star_density:new a.Uniform1f(d),u_star_size:new a.Uniform1f(d),u_temporal_offset:new a.Uniform1f(d),u_horizon_angle:new a.Uniform1f(d),u_rotation_matrix:new a.UniformMatrix4f(d)})};let sa;function Es(d,n,c,m,v,b,I){const M=d.context,N=M.gl,Z=d.transform,$=d.useProgram("collisionBox"),re=[];let Re=0,Fe=0;for(let gt=0;gt<m.length;gt++){const Pt=m[gt],Ft=n.getTile(Pt),Rt=Ft.getBucket(c);if(!Rt)continue;const qt=ft(Pt,Rt,Z);let Wt=qt;0===v[0]&&0===v[1]||(Wt=d.translatePosMatrix(qt,Ft,v,b));const an=I?Rt.textCollisionBox:Rt.iconCollisionBox,Yn=Rt.collisionCircleArray;if(Yn.length>0){const tn=a.create(),Pn=Wt;a.mul(tn,Rt.placementInvProjMatrix,Z.glCoordMatrix),a.mul(tn,tn,Rt.placementViewportMatrix),re.push({circleArray:Yn,circleOffset:Fe,transform:Pn,invTransform:tn,projection:Rt.getProjection()}),Re+=Yn.length/4,Fe=Re}an&&(d.terrain&&d.terrain.setupElevationDraw(Ft,$),$.draw(M,N.LINES,a.DepthMode.disabled,a.StencilMode.disabled,d.colorModeForRenderPass(),a.CullFaceMode.disabled,Ni(Wt,Z,Ft,Rt.getProjection()),c.id,an.layoutVertexBuffer,an.indexBuffer,an.segments,null,Z.zoom,null,[an.collisionVertexBuffer,an.collisionVertexBufferExt]))}if(!I||!re.length)return;const et=d.useProgram("collisionCircle"),Qe=new a.StructArrayLayout2f1f2i16;Qe.resize(4*Re),Qe._trim();let nt=0;for(const gt of re)for(let Pt=0;Pt<gt.circleArray.length/4;Pt++){const Ft=4*Pt,Rt=gt.circleArray[Ft+0],qt=gt.circleArray[Ft+1],Wt=gt.circleArray[Ft+2],an=gt.circleArray[Ft+3];Qe.emplace(nt++,Rt,qt,Wt,an,0),Qe.emplace(nt++,Rt,qt,Wt,an,1),Qe.emplace(nt++,Rt,qt,Wt,an,2),Qe.emplace(nt++,Rt,qt,Wt,an,3)}(!sa||sa.length<2*Re)&&(sa=function(gt){const Pt=2*gt,Ft=new a.StructArrayLayout3ui6;Ft.resize(Pt),Ft._trim();for(let Rt=0;Rt<Pt;Rt++){const qt=6*Rt;Ft.uint16[qt+0]=4*Rt+0,Ft.uint16[qt+1]=4*Rt+1,Ft.uint16[qt+2]=4*Rt+2,Ft.uint16[qt+3]=4*Rt+2,Ft.uint16[qt+4]=4*Rt+3,Ft.uint16[qt+5]=4*Rt+0}return Ft}(Re));const ce=M.createIndexBuffer(sa,!0),We=M.createVertexBuffer(Qe,a.collisionCircleLayout.members,!0);for(const gt of re){const Pt={u_matrix:gt.transform,u_inv_matrix:gt.invTransform,u_camera_to_center_distance:(pt=Z).getCameraToCenterDistance(gt.projection),u_viewport_size:[pt.width,pt.height]};et.draw(M,N.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,d.colorModeForRenderPass(),a.CullFaceMode.disabled,Pt,c.id,We,ce,a.SegmentVector.simpleSegment(0,2*gt.circleOffset,gt.circleArray.length,gt.circleArray.length/2),null,Z.zoom)}var pt;We.destroy(),ce.destroy()}const Ll=a.create();function _a({width:d,height:n,anchor:c,textOffset:m,textScale:v},b){const{horizontalAlign:I,verticalAlign:M}=a.getAnchorAlignment(c),N=-(I-.5)*d,Z=-(M-.5)*n,$=a.evaluateVariableOffset(c,m);return new a.Point((N/v+$[0])*b,(Z/v+$[1])*b)}function er(d,n,c,m,v,b,I,M,N,Z,$){const re=d.text.placedSymbolArray,Re=d.text.dynamicLayoutVertexArray,Fe=d.icon.dynamicLayoutVertexArray,et={},Qe=d.getProjection(),nt=mt(M,Qe,b),ce=b.elevation,We=Qe.upVectorScale(M.canonical,b.center.lat,b.worldSize).metersToTile;Re.clear();for(let pt=0;pt<re.length;pt++){const gt=re.get(pt),{tileAnchorX:Pt,tileAnchorY:Ft,numGlyphs:Rt}=gt,qt=gt.hidden||!gt.crossTileID||d.allowVerticalPlacement&&!gt.placedOrientation?null:m[gt.crossTileID];if(qt){let Wt=0,an=0,Yn=0;if(ce){const ei=ce?ce.getAtTileOffset(M,Pt,Ft):0,[Ai,Ji,wi]=Qe.upVector(M.canonical,Pt,Ft);Wt=ei*Ai*We,an=ei*Ji*We,Yn=ei*wi*We}let[tn,Pn,dn,Zn]=Wn(gt.projectedAnchorX+Wt,gt.projectedAnchorY+an,gt.projectedAnchorZ+Yn,c?nt:I);const ln=lr(b.getCameraToCenterDistance(Qe),Zn);let An=v.evaluateSizeForFeature(d.textSizeData,Z,gt)*ln/a.ONE_EM;c&&(An*=d.tilePixelRatio/N);const Qn=_a(qt,An);c?(({x:tn,y:Pn,z:dn}=Qe.projectTilePoint(Pt+Qn.x,Ft+Qn.y,M.canonical)),[tn,Pn,dn]=Wn(tn+Wt,Pn+an,dn+Yn,I)):(n&&Qn._rotate(-b.angle),tn+=Qn.x,Pn+=Qn.y,dn=0);const jn=d.allowVerticalPlacement&&gt.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let ei=0;ei<Rt;ei++)a.addDynamicAttributes(Re,tn,Pn,dn,jn);$&&gt.associatedIconIndex>=0&&(et[gt.associatedIconIndex]={x:tn,y:Pn,z:dn,angle:jn})}else di(Rt,Re)}if($){Fe.clear();const pt=d.icon.placedSymbolArray;for(let gt=0;gt<pt.length;gt++){const Pt=pt.get(gt),{numGlyphs:Ft}=Pt,Rt=et[gt];if(Pt.hidden||!Rt)di(Ft,Fe);else{const{x:qt,y:Wt,z:an,angle:Yn}=Rt;for(let tn=0;tn<Ft;tn++)a.addDynamicAttributes(Fe,qt,Wt,an,Yn)}}d.icon.dynamicLayoutVertexBuffer.updateData(Fe)}d.text.dynamicLayoutVertexBuffer.updateData(Re)}function Ka(d,n,c){return c.iconsInText&&n?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function ml(d,n,c,m,v,b,I,M,N,Z,$,re){const Re=d.context,Fe=Re.gl,et=d.transform,Qe="map"===M,nt="map"===N,ce=Qe&&"point"!==c.layout.get("symbol-placement"),We=Qe&&!nt&&!ce,pt=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let gt=!1;const Pt=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),Ft=[a.mercatorXfromLng(et.center.lng),a.mercatorYfromLat(et.center.lat)],Rt=c.layout.get("text-variable-anchor"),qt="globe"===et.projection.name,Wt=[],an=[0,-1,0];let Yn=an;!qt&&!et.mercatorFromTransition||Qe||(Yn=function(tn){const Pn=tn._camera.getWorldToCamera(tn.worldSize,1),dn=a.multiply([],Pn,tn.globeMatrix);a.invert(dn,dn);const Zn=[0,0,0],ln=[0,1,0,0];return a.transformMat4$1(ln,ln,dn),Zn[0]=ln[0],Zn[1]=ln[1],Zn[2]=ln[2],a.normalize(Zn,Zn),Zn}(et));for(const tn of m){const Pn=n.getTile(tn),dn=Pn.getBucket(c);if(!dn||"mercator"===dn.projection.name&&qt)continue;const Zn=v?dn.text:dn.icon;if(!Zn||dn.fullyClipped||!Zn.segments.get().length)continue;const ln=Zn.programConfigurations.get(c.id),An=v||dn.sdfIcons,Qn=v?dn.textSizeData:dn.iconSizeData,jn=nt||0!==et.pitch,ei=a.evaluateSizeForZoom(Qn,et.zoom);let Ai,Ji,wi,Si,fr=[0,0],tr=null;if(v)Ji=Pn.glyphAtlasTexture,wi=Fe.LINEAR,Ai=Pn.glyphAtlasTexture.size,dn.iconsInText&&(fr=Pn.imageAtlasTexture.size,tr=Pn.imageAtlasTexture,Si=jn||d.options.rotating||d.options.zooming||"composite"===Qn.kind||"camera"===Qn.kind?Fe.LINEAR:Fe.NEAREST);else{const Ca=1!==c.layout.get("icon-size").constantOr(0)||dn.iconsNeedLinear;Ji=Pn.imageAtlasTexture,wi=An||d.options.rotating||d.options.zooming||Ca||jn?Fe.LINEAR:Fe.NEAREST,Ai=Pn.imageAtlasTexture.size}const Di="globe"===dn.projection.name,Dr=Di?Yn:an,Qr=Di?a.globeToMercatorTransition(et.zoom):0,Vr=mt(tn,dn.getProjection(),et),$r=et.calculatePixelsToTileUnitsMatrix(Pn),gs=It(Vr,Pn.tileID.canonical,nt,Qe,et,dn.getProjection(),$r),oo=d.terrain&&nt&&ce?a.invert(a.create(),gs):Ll,wa=ui(Vr,Pn.tileID.canonical,nt,Qe,et,dn.getProjection(),$r),ca=Rt&&dn.hasTextData(),no="none"!==c.layout.get("icon-text-fit")&&ca&&dn.hasIconData();if(ce){const Ca=et.elevation,Ys=Ca?Ca.getAtTileOffsetFunc(tn,et.center.lat,et.worldSize,dn.getProjection()):null,cc=Xn(Vr,Pn.tileID.canonical,nt,Qe,et,dn.getProjection(),$r);rt(dn,Vr,d,v,cc,wa,nt,Z,Ys,tn)}const Zr=ce||v&&Rt||no,br=d.translatePosMatrix(Vr,Pn,b,I),Eo=Zr?Ll:gs,Is=d.translatePosMatrix(wa,Pn,b,I,!0),io=dn.getProjection().createInversionMatrix(et,tn.canonical),Ms=[];d.terrainRenderModeElevated()&&nt&&Ms.push("PITCH_WITH_MAP_TERRAIN"),Di&&Ms.push("PROJECTION_GLOBE_VIEW"),Zr&&Ms.push("PROJECTED_POS_ON_VIEWPORT");const iu=An&&0!==c.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1);let Nl;Nl=An?dn.iconsInText?Ja(Qn.kind,ei,We,nt,d,br,Eo,Is,Ai,fr,tn,Qr,Ft,io,Dr,dn.getProjection()):Xr(Qn.kind,ei,We,nt,d,br,Eo,Is,v,Ai,!0,tn,Qr,Ft,io,Dr,dn.getProjection()):ds(Qn.kind,ei,We,nt,d,br,Eo,Is,v,Ai,tn,Qr,Ft,io,Dr,dn.getProjection());const ru={program:d.useProgram(Ka(An,v,dn),ln,Ms),buffers:Zn,uniformValues:Nl,atlasTexture:Ji,atlasTextureIcon:tr,atlasInterpolation:wi,atlasInterpolationIcon:Si,isSDF:An,hasHalo:iu,tile:Pn,labelPlaneMatrixInv:oo};if(pt&&dn.canOverlap){gt=!0;const Ca=Zn.segments.get();for(const Ys of Ca)Wt.push({segments:new a.SegmentVector([Ys]),sortKey:Ys.sortKey,state:ru})}else Wt.push({segments:Zn.segments,sortKey:0,state:ru})}gt&&Wt.sort((tn,Pn)=>tn.sortKey-Pn.sortKey);for(const tn of Wt){const Pn=tn.state;if(d.terrain&&d.terrain.setupElevationDraw(Pn.tile,Pn.program,{useDepthForOcclusion:!qt,labelPlaneMatrixInv:Pn.labelPlaneMatrixInv}),Re.activeTexture.set(Fe.TEXTURE0),Pn.atlasTexture.bind(Pn.atlasInterpolation,Fe.CLAMP_TO_EDGE),Pn.atlasTextureIcon&&(Re.activeTexture.set(Fe.TEXTURE1),Pn.atlasTextureIcon&&Pn.atlasTextureIcon.bind(Pn.atlasInterpolationIcon,Fe.CLAMP_TO_EDGE)),Pn.isSDF){const dn=Pn.uniformValues;Pn.hasHalo&&(dn.u_is_halo=1,Wo(Pn.buffers,tn.segments,c,d,Pn.program,Pt,$,re,dn)),dn.u_is_halo=0}Wo(Pn.buffers,tn.segments,c,d,Pn.program,Pt,$,re,Pn.uniformValues)}}function Wo(d,n,c,m,v,b,I,M,N){const Z=m.context,$=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.globeExtVertexBuffer];v.draw(Z,Z.gl.TRIANGLES,b,I,M,a.CullFaceMode.disabled,N,c.id,d.layoutVertexBuffer,d.indexBuffer,n,c.paint,m.transform.zoom,d.programConfigurations.get(c.id),$)}function gl(d,n,c,m,v,b,I){const M=d.context.gl,N=c.paint.get("fill-pattern"),Z=N&&N.constantOr(1);let $,re,Re,Fe,et;I?(re=Z&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=M.LINES):(re=Z?"fillPattern":"fill",$=M.TRIANGLES);for(const Qe of m){const nt=n.getTile(Qe);if(Z&&!nt.patternsLoaded())continue;const ce=nt.getBucket(c);if(!ce)continue;d.prepareDrawTile();const We=ce.programConfigurations.get(c.id),pt=d.useProgram(re,We);Z&&(d.context.activeTexture.set(M.TEXTURE0),nt.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),We.updatePaintBuffers());const gt=N.constantOr(null);if(gt&&nt.imageAtlas){const Ft=nt.imageAtlas.patternPositions[gt.toString()];Ft&&We.setConstantPatternPositions(Ft)}const Pt=d.translatePosMatrix(Qe.projMatrix,nt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(I){Fe=ce.indexBuffer2,et=ce.segments2;const Ft=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];Re="fillOutlinePattern"===re&&Z?vi(Pt,d,nt,Ft):zt(Pt,Ft)}else Fe=ce.indexBuffer,et=ce.segments,Re=Z?He(Pt,d,nt):W(Pt);d.prepareDrawProgram(d.context,pt,Qe.toUnwrapped()),pt.draw(d.context,$,v,d.stencilModeForClipping(Qe),b,a.CullFaceMode.disabled,Re,c.id,ce.layoutVertexBuffer,Fe,et,c.paint,d.transform.zoom,We)}}function aa(d,n,c,m,v,b,I){const M=d.context,N=M.gl,Z=d.transform,$=c.paint.get("fill-extrusion-pattern"),re=$.constantOr(1),Re=c.paint.get("fill-extrusion-opacity"),Fe=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],et=c.layout.get("fill-extrusion-edge-radius"),Qe=et>0&&!c.paint.get("fill-extrusion-rounded-roof"),nt=Qe?0:et,ce="globe"===Z.projection.name?a.fillExtrusionHeightLift():0,We="globe"===Z.projection.name,pt=We?a.globeToMercatorTransition(Z.zoom):0,gt=[a.mercatorXfromLng(Z.center.lng),a.mercatorYfromLat(Z.center.lat)],Pt=[];We&&Pt.push("PROJECTION_GLOBE_VIEW"),Fe[0]>0&&Pt.push("FAUX_AO"),Qe&&Pt.push("ZERO_ROOF_RADIUS");for(const Ft of m){const Rt=n.getTile(Ft),qt=Rt.getBucket(c);if(!qt||qt.projection.name!==Z.projection.name)continue;const Wt=qt.programConfigurations.get(c.id),an=d.useProgram(re?"fillExtrusionPattern":"fillExtrusion",Wt,Pt);if(d.terrain){const An=d.terrain;if(d.style.terrainSetForDrapingOnly())An.setupElevationDraw(Rt,an,{useMeterToDem:!0});else{if(!qt.enableTerrain)continue;if(An.setupElevationDraw(Rt,an,{useMeterToDem:!0}),mo(M,n,Ft,qt,c,An),!qt.centroidVertexBuffer){const Qn=an.attributes.a_centroid_pos;void 0!==Qn&&N.vertexAttrib2f(Qn,0,0)}}}re&&(d.context.activeTexture.set(N.TEXTURE0),Rt.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Wt.updatePaintBuffers());const Yn=$.constantOr(null);if(Yn&&Rt.imageAtlas){const An=Rt.imageAtlas.patternPositions[Yn.toString()];An&&Wt.setConstantPatternPositions(An)}const tn=d.translatePosMatrix(Ft.projMatrix,Rt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Pn=Z.projection.createInversionMatrix(Z,Ft.canonical),dn=c.paint.get("fill-extrusion-vertical-gradient"),Zn=re?ue(tn,d,dn,Re,Fe,nt,Ft,Rt,ce,pt,gt,Pn):le(tn,d,dn,Re,Fe,nt,Ft,ce,pt,gt,Pn);d.prepareDrawProgram(M,an,Ft.toUnwrapped());const ln=[];d.terrain&&ln.push(qt.centroidVertexBuffer),We&&ln.push(qt.layoutVertexExtBuffer),an.draw(M,M.gl.TRIANGLES,v,b,I,a.CullFaceMode.backCCW,Zn,c.id,qt.layoutVertexBuffer,qt.indexBuffer,qt.segments,c.paint,d.transform.zoom,Wt,ln)}}function mo(d,n,c,m,v,b){const I=[ce=>{let We=ce.canonical.x-1,pt=ce.wrap;return We<0&&(We=(1<<ce.canonical.z)-1,pt--),new a.OverscaledTileID(ce.overscaledZ,pt,ce.canonical.z,We,ce.canonical.y)},ce=>{let We=ce.canonical.x+1,pt=ce.wrap;return We===1<<ce.canonical.z&&(We=0,pt++),new a.OverscaledTileID(ce.overscaledZ,pt,ce.canonical.z,We,ce.canonical.y)},ce=>new a.OverscaledTileID(ce.overscaledZ,ce.wrap,ce.canonical.z,ce.canonical.x,(0===ce.canonical.y?1<<ce.canonical.z:ce.canonical.y)-1),ce=>new a.OverscaledTileID(ce.overscaledZ,ce.wrap,ce.canonical.z,ce.canonical.x,ce.canonical.y===(1<<ce.canonical.z)-1?0:ce.canonical.y+1)],M=ce=>{const We=n.getSource().minzoom,pt=Pt=>{const Ft=n.getTileByID(Pt);if(Ft&&Ft.hasData())return Ft.getBucket(v)},gt=[0,-1,1];for(const Pt of gt){if(ce.overscaledZ+Pt<We)continue;const Ft=pt(ce.calculateScaledKey(ce.overscaledZ+Pt));if(Ft)return Ft}},N=[0,0,0],Z=(ce,We)=>(N[0]=Math.min(ce.min.y,We.min.y),N[1]=Math.max(ce.max.y,We.max.y),N[2]=a.EXTENT-We.min.x>ce.max.x?We.min.x-a.EXTENT:ce.max.x,N),$=(ce,We)=>(N[0]=Math.min(ce.min.x,We.min.x),N[1]=Math.max(ce.max.x,We.max.x),N[2]=a.EXTENT-We.min.y>ce.max.y?We.min.y-a.EXTENT:ce.max.y,N),re=[(ce,We)=>Z(ce,We),(ce,We)=>Z(We,ce),(ce,We)=>$(ce,We),(ce,We)=>$(We,ce)],Re=new a.Point(0,0);let Fe,et,Qe;const nt=(ce,We,pt,gt,Pt)=>{const Ft=[[gt?pt:ce,gt?ce:pt,0],[gt?pt:We,gt?We:pt,0]],Rt=Pt<0?a.EXTENT+Pt:Pt,qt=[gt?Rt:(ce+We)/2,gt?(ce+We)/2:Rt,0];return 0===pt&&Pt<0||0!==pt&&Pt>0?b.getForTilePoints(Qe,[qt],!0,et):Ft.push(qt),b.getForTilePoints(c,Ft,!0,Fe),Math.max(Ft[0][2],Ft[1][2],qt[2])/b.exaggeration()};for(let ce=0;ce<4;ce++){const We=(ce<2?1:5)-ce,pt=m.borders[ce];if(0===pt.length)continue;const gt=Qe=I[ce](c),Pt=M(gt);if(!(Pt&&Pt instanceof a.FillExtrusionBucket&&Pt.enableTerrain)||m.borderDoneWithNeighborZ[ce]===Pt.canonical.z&&Pt.borderDoneWithNeighborZ[We]===m.canonical.z||(et=b.findDEMTileFor(gt),!et||!et.dem))continue;if(!Fe){const Wt=b.findDEMTileFor(c);if(!Wt||!Wt.dem)return;Fe=Wt}const Ft=Pt.borders[We];let Rt=0;const qt=Pt.borderDoneWithNeighborZ[We]!==m.canonical.z;if(m.canonical.z===Pt.canonical.z){for(let Wt=0;Wt<pt.length;Wt++){const an=m.featuresOnBorder[pt[Wt]],Yn=an.borders[ce];let tn;for(;Rt<Ft.length&&(tn=Pt.featuresOnBorder[Ft[Rt]],!(tn.borders[We][1]>Yn[0]+3));)qt&&Pt.encodeCentroid(void 0,tn,!1),Rt++;if(tn&&Rt<Ft.length){const Pn=Rt;let dn=0;for(;!(tn.borders[We][0]>Yn[1]-3)&&(dn++,++Rt!==Ft.length);)tn=Pt.featuresOnBorder[Ft[Rt]];if(tn=Pt.featuresOnBorder[Ft[Pn]],an.intersectsCount()>1||tn.intersectsCount()>1||1!==dn){1!==dn&&(Rt=Pn),m.encodeCentroid(void 0,an,!1),qt&&Pt.encodeCentroid(void 0,tn,!1);continue}const Zn=re[ce](an,tn),ln=ce%2?a.EXTENT-1:0;Re.x=nt(Zn[0],Math.min(a.EXTENT-1,Zn[1]),ln,ce<2,Zn[2]),Re.y=0,m.encodeCentroid(Re,an,!1),qt&&Pt.encodeCentroid(Re,tn,!1)}else m.encodeCentroid(void 0,an,!1)}m.borderDoneWithNeighborZ[ce]=Pt.canonical.z,m.needsCentroidUpdate=!0,qt&&(Pt.borderDoneWithNeighborZ[We]=m.canonical.z,Pt.needsCentroidUpdate=!0)}else{for(const Wt of pt)m.encodeCentroid(void 0,m.featuresOnBorder[Wt],!1);if(qt){for(const Wt of Ft)Pt.encodeCentroid(void 0,Pt.featuresOnBorder[Wt],!1);Pt.borderDoneWithNeighborZ[We]=m.canonical.z,Pt.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[ce]=Pt.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(d)}const Ts=new a.Color(1,0,0,1),ko=new a.Color(0,1,0,1),go=new a.Color(0,0,1,1),bc=new a.Color(1,0,1,1),Xa=new a.Color(0,1,1,1);function ec(d,n,c){const m=d.context,v=d.transform,b=m.gl,I="globe"===v.projection.name,M=I?["PROJECTION_GLOBE_VIEW"]:null;let N=c.projMatrix;if(I&&a.globeToMercatorTransition(v.zoom)>0){const an=a.transitionTileAABBinECEF(c.canonical,v),Yn=a.globeDenormalizeECEF(an);N=a.multiply(new Float32Array(16),v.globeMatrix,Yn),a.multiply(N,v.projMatrix,N)}const Z=d.useProgram("debug",null,M),$=n.getTileByID(c.key);d.terrain&&d.terrain.setupElevationDraw($,Z);const re=a.DepthMode.disabled,Re=a.StencilMode.disabled,Fe=d.colorModeForRenderPass();m.activeTexture.set(b.TEXTURE0),d.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),I?$._makeGlobeTileDebugBuffers(d.context,v):$._makeDebugTileBoundsBuffers(d.context,v.projection);const Qe=$._tileDebugBuffer||d.debugBuffer,nt=$._tileDebugIndexBuffer||d.debugIndexBuffer,ce=$._tileDebugSegments||d.debugSegments;Z.draw(m,b.LINE_STRIP,re,Re,Fe,a.CullFaceMode.disabled,Jr(N,a.Color.red),"$debug",Qe,nt,ce,null,null,null,[$._globeTileDebugBorderBuffer]);const We=$.latestRawTileData,pt=Math.floor((We&&We.byteLength||0)/1024),gt=n.getTile(c).tileSize,Pt=512/Math.min(gt,512)*(c.overscaledZ/v.zoom)*.5;let Ft=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ft+=` => ${c.overscaledZ}`),Ft+=` ${pt}kb`,function(an,Yn){an.initDebugOverlayCanvas();const tn=an.debugOverlayCanvas,Pn=an.context.gl,dn=an.debugOverlayCanvas.getContext("2d");dn.clearRect(0,0,tn.width,tn.height),dn.shadowColor="white",dn.shadowBlur=2,dn.lineWidth=1.5,dn.strokeStyle="white",dn.textBaseline="top",dn.font="bold 36px Open Sans, sans-serif",dn.fillText(Yn,5,5),dn.strokeText(Yn,5,5),an.debugOverlayTexture.update(tn),an.debugOverlayTexture.bind(Pn.LINEAR,Pn.CLAMP_TO_EDGE)}(d,Ft);const Rt=$._tileDebugTextBuffer||d.debugBuffer,qt=$._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Wt=$._tileDebugTextSegments||d.debugSegments;Z.draw(m,b.TRIANGLES,re,Re,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,Jr(N,a.Color.transparent,Pt),"$debug",Rt,qt,Wt,null,null,null,[$._globeTileDebugTextBuffer])}function Ds(d,n,c,m){yl(d,0,n+c/2,d.transform.width,c,m)}function _l(d,n,c,m){yl(d,n-c/2,0,c,d.transform.height,m)}function yl(d,n,c,m,v,b){const I=d.context,M=I.gl;M.enable(M.SCISSOR_TEST),M.scissor(n*a.exported.devicePixelRatio,c*a.exported.devicePixelRatio,m*a.exported.devicePixelRatio,v*a.exported.devicePixelRatio),I.clear({color:b}),M.disable(M.SCISSOR_TEST)}const Jc=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:tc}=Jc;function Vs(d,n,c,m){d.emplaceBack(n,c,m)}class Qa{constructor(n){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,Vs(this.vertexArray,-1,-1,1),Vs(this.vertexArray,1,-1,1),Vs(this.vertexArray,-1,1,1),Vs(this.vertexArray,1,1,1),Vs(this.vertexArray,-1,-1,-1),Vs(this.vertexArray,1,-1,-1),Vs(this.vertexArray,-1,1,-1),Vs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,tc),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function rs(d,n,c,m,v,b){const I=d.gl,M=n.paint.get("sky-atmosphere-color"),N=n.paint.get("sky-atmosphere-halo-color"),Z=n.paint.get("sky-atmosphere-sun-intensity"),$={u_matrix_3f:a.fromMat4(a.create$1(),m),u_sun_direction:v,u_sun_intensity:Z,u_color_tint_r:[(et=M).r,et.g,et.b,et.a],u_color_tint_m:[(Qe=N).r,Qe.g,Qe.b,Qe.a],u_luminance:5e-5};var et,Qe;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),c.draw(d,I.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,$,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const F=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Me{constructor(n){const c=new a.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const m=new a.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(c,F.members),this.indexBuffer=n.createIndexBuffer(m),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const q={symbol:function(d,n,c,m,v){if("translucent"!==d.renderPass)return;const b=a.StencilMode.disabled,I=d.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(M,N,Z,$,re,Re,Fe){const et=N.transform,Qe="map"===re,nt="map"===Re;for(const ce of M){const We=$.getTile(ce),pt=We.getBucket(Z);if(!pt||!pt.text||!pt.text.segments.get().length)continue;const gt=a.evaluateSizeForZoom(pt.textSizeData,et.zoom),Pt=mt(ce,pt.getProjection(),et),Ft=et.calculatePixelsToTileUnitsMatrix(We),Rt=It(Pt,We.tileID.canonical,nt,Qe,et,pt.getProjection(),Ft),qt="none"!==Z.layout.get("icon-text-fit")&&pt.hasIconData();if(gt){const Wt=Math.pow(2,et.zoom-We.tileID.overscaledZ);er(pt,Qe,nt,Fe,a.symbolSize,et,Rt,ce,Wt,gt,qt)}}}(m,d,c,n,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),v),0!==c.paint.get("icon-opacity").constantOr(1)&&ml(d,n,c,m,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),b,I),0!==c.paint.get("text-opacity").constantOr(1)&&ml(d,n,c,m,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),b,I),n.map.showCollisionBoxes&&(Es(d,n,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Es(d,n,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(d,n,c,m){if("translucent"!==d.renderPass)return;const v=c.paint.get("circle-opacity"),b=c.paint.get("circle-stroke-width"),I=c.paint.get("circle-stroke-opacity"),M=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===v.constantOr(1)&&(0===b.constantOr(1)||0===I.constantOr(1)))return;const N=d.context,Z=N.gl,$=d.transform,re=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),Re=a.StencilMode.disabled,Fe=d.colorModeForRenderPass(),et="globe"===$.projection.name,Qe=[a.mercatorXfromLng($.center.lng),a.mercatorYfromLat($.center.lat)],nt=[];for(let We=0;We<m.length;We++){const pt=m[We],gt=n.getTile(pt),Pt=gt.getBucket(c);if(!Pt||Pt.projection.name!==$.projection.name)continue;const Ft=Pt.programConfigurations.get(c.id),Rt=ai(c);et&&Rt.push("PROJECTION_GLOBE_VIEW");const qt=d.useProgram("circle",Ft,Rt),Wt=Pt.layoutVertexBuffer,an=Pt.globeExtVertexBuffer,Yn=Pt.indexBuffer,tn=$.projection.createInversionMatrix($,pt.canonical),Pn={programConfiguration:Ft,program:qt,layoutVertexBuffer:Wt,globeExtVertexBuffer:an,indexBuffer:Yn,uniformValues:wr(d,pt,gt,tn,Qe,c),tile:gt};if(M){const dn=Pt.segments.get();for(const Zn of dn)nt.push({segments:new a.SegmentVector([Zn]),sortKey:Zn.sortKey,state:Pn})}else nt.push({segments:Pt.segments,sortKey:0,state:Pn})}M&&nt.sort((We,pt)=>We.sortKey-pt.sortKey);const ce={useDepthForOcclusion:!et};for(const We of nt){const{programConfiguration:pt,program:gt,layoutVertexBuffer:Pt,globeExtVertexBuffer:Ft,indexBuffer:Rt,uniformValues:qt,tile:Wt}=We.state,an=We.segments;d.terrain&&d.terrain.setupElevationDraw(Wt,gt,ce),d.prepareDrawProgram(N,gt,Wt.tileID.toUnwrapped()),gt.draw(N,Z.TRIANGLES,re,Re,Fe,a.CullFaceMode.disabled,qt,c.id,Pt,Rt,an,c.paint,$.zoom,pt,[Ft])}},heatmap:function(d,n,c,m){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===d.renderPass){const v=d.context,b=v.gl,I=a.StencilMode.disabled,M=new a.ColorMode([b.ONE,b.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(Fe,et,Qe,nt){const ce=Fe.gl,We=et.width*nt,pt=et.height*nt;Fe.activeTexture.set(ce.TEXTURE1),Fe.viewport.set([0,0,We,pt]);let gt=Qe.heatmapFbo;if(!gt||gt&&(gt.width!==We||gt.height!==pt)){gt&&gt.destroy();const Pt=ce.createTexture();ce.bindTexture(ce.TEXTURE_2D,Pt),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MAG_FILTER,ce.LINEAR),gt=Qe.heatmapFbo=Fe.createFramebuffer(We,pt,!1),function(Ft,Rt,qt,Wt,an,Yn){const tn=Ft.gl;tn.texImage2D(tn.TEXTURE_2D,0,Ft.isWebGL2&&Ft.extRenderToTextureHalfFloat?tn.RGBA16F:tn.RGBA,an,Yn,0,tn.RGBA,Ft.extRenderToTextureHalfFloat?Ft.isWebGL2?tn.HALF_FLOAT:Ft.extTextureHalfFloat.HALF_FLOAT_OES:tn.UNSIGNED_BYTE,null),Wt.colorAttachment.set(qt)}(Fe,0,Pt,gt,We,pt)}else ce.bindTexture(ce.TEXTURE_2D,gt.colorAttachment.get()),Fe.bindFramebuffer.set(gt.framebuffer)})(v,d,c,"globe"===d.transform.projection.name?.5:.25),v.clear({color:a.Color.transparent});const N=d.transform,Z="globe"===N.projection.name,$=Z?["PROJECTION_GLOBE_VIEW"]:null,re=Z?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,Re=[a.mercatorXfromLng(N.center.lng),a.mercatorYfromLat(N.center.lat)];for(let Fe=0;Fe<m.length;Fe++){const et=m[Fe];if(n.hasRenderableParent(et))continue;const Qe=n.getTile(et),nt=Qe.getBucket(c);if(!nt||nt.projection.name!==N.projection.name)continue;const ce=nt.programConfigurations.get(c.id),We=d.useProgram("heatmap",ce,$),{zoom:pt}=d.transform;d.terrain&&d.terrain.setupElevationDraw(Qe,We),d.prepareDrawProgram(v,We,et.toUnwrapped());const gt=N.projection.createInversionMatrix(N,et.canonical);We.draw(v,b.TRIANGLES,a.DepthMode.disabled,I,M,re,wo(d,et,Qe,gt,Re,pt,c.paint.get("heatmap-intensity")),c.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,c.paint,d.transform.zoom,ce,Z?[nt.globeExtVertexBuffer]:null)}v.viewport.set([0,0,d.width,d.height])}else"translucent"===d.renderPass&&(d.context.setColorMode(d.colorModeForRenderPass()),function(v,b){const I=v.context,M=I.gl,N=b.heatmapFbo;if(!N)return;I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,N.colorAttachment.get()),I.activeTexture.set(M.TEXTURE1);let Z=b.colorRampTexture;Z||(Z=b.colorRampTexture=new a.Texture(I,b.colorRamp,M.RGBA)),Z.bind(M.LINEAR,M.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(I,M.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,v.colorModeForRenderPass(),a.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")},b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(d,c))},line:function(d,n,c,m){if("translucent"!==d.renderPass)return;const v=c.paint.get("line-opacity"),b=c.paint.get("line-width");if(0===v.constantOr(1)||0===b.constantOr(1))return;const I=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),M=d.colorModeForRenderPass(),N=d.terrain&&d.terrain.renderingToTexture?1:a.exported.devicePixelRatio,Z=c.paint.get("line-dasharray"),$=Z.constantOr(1),re=c.layout.get("line-cap"),Re=c.paint.get("line-pattern"),Fe=Re.constantOr(1),et=c.paint.get("line-gradient"),Qe=Fe?"linePattern":"line",nt=d.context,ce=nt.gl,We=(gt=>{const Pt=[];Cs(gt)&&Pt.push("RENDER_LINE_DASH"),gt.paint.get("line-gradient")&&Pt.push("RENDER_LINE_GRADIENT");const Ft=gt.paint.get("line-trim-offset");0===Ft[0]&&0===Ft[1]||Pt.push("RENDER_LINE_TRIM_OFFSET");const Rt=gt.paint.get("line-pattern").constantOr(1),qt=1!==gt.paint.get("line-opacity").constantOr(1);return!Rt&&qt&&Pt.push("RENDER_LINE_ALPHA_DISCARD"),Pt})(c);let pt=We.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(pt=!1);for(const gt of m){const Pt=n.getTile(gt);if(Fe&&!Pt.patternsLoaded())continue;const Ft=Pt.getBucket(c);if(!Ft)continue;d.prepareDrawTile();const Rt=Ft.programConfigurations.get(c.id),qt=d.useProgram(Qe,Rt,We),Wt=Re.constantOr(null);if(Wt&&Pt.imageAtlas){const An=Pt.imageAtlas.patternPositions[Wt.toString()];An&&Rt.setConstantPatternPositions(An)}const an=Z.constantOr(null),Yn=re.constantOr(null);if(!Fe&&an&&Yn&&Pt.lineAtlas){const An=Pt.lineAtlas.getDash(an,Yn);An&&Rt.setConstantPatternPositions(An)}let[tn,Pn]=c.paint.get("line-trim-offset");("round"===Yn||"square"===Yn)&&tn!==Pn&&(0===tn&&(tn-=1),1===Pn&&(Pn+=1));const dn=d.terrain?gt.projMatrix:null,Zn=Fe?ra(d,Pt,c,dn,N):Ho(d,Pt,c,dn,Ft.lineClipsArray.length,N,[tn,Pn]);if(et){const An=Ft.gradients[c.id];let Qn=An.texture;if(c.gradientVersion!==An.version){let jn=256;if(c.stepInterpolant){const ei=n.getSource().maxzoom,Ai=gt.canonical.z===ei?Math.ceil(1<<d.transform.maxZoom-gt.canonical.z):1;jn=a.clamp(a.nextPowerOfTwo(Ft.maxLineLength/a.EXTENT*1024*Ai),256,nt.maxTextureSize)}An.gradient=a.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:jn,image:An.gradient||void 0,clips:Ft.lineClipsArray}),An.texture?An.texture.update(An.gradient):An.texture=new a.Texture(nt,An.gradient,ce.RGBA),An.version=c.gradientVersion,Qn=An.texture}nt.activeTexture.set(ce.TEXTURE1),Qn.bind(c.stepInterpolant?ce.NEAREST:ce.LINEAR,ce.CLAMP_TO_EDGE)}$&&(nt.activeTexture.set(ce.TEXTURE0),Pt.lineAtlasTexture.bind(ce.LINEAR,ce.REPEAT),Rt.updatePaintBuffers()),Fe&&(nt.activeTexture.set(ce.TEXTURE0),Pt.imageAtlasTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE),Rt.updatePaintBuffers()),d.prepareDrawProgram(nt,qt,gt.toUnwrapped());const ln=An=>{qt.draw(nt,ce.TRIANGLES,I,An,M,a.CullFaceMode.disabled,Zn,c.id,Ft.layoutVertexBuffer,Ft.indexBuffer,Ft.segments,c.paint,d.transform.zoom,Rt,[Ft.layoutVertexBuffer2])};if(pt){const An=d.stencilModeForClipping(gt).ref;0===An&&d.terrain&&nt.clear({stencil:0});const Qn={func:ce.EQUAL,mask:255};Zn.u_alpha_discard_threshold=.8,ln(new a.StencilMode(Qn,An,255,ce.KEEP,ce.KEEP,ce.INVERT)),Zn.u_alpha_discard_threshold=0,ln(new a.StencilMode(Qn,An,255,ce.KEEP,ce.KEEP,ce.KEEP))}else ln(d.stencilModeForClipping(gt))}pt&&(d.resetStencilClippingMasks(),d.terrain&&nt.clear({stencil:0}))},fill:function(d,n,c,m){const v=c.paint.get("fill-color"),b=c.paint.get("fill-opacity");if(0===b.constantOr(1))return;const I=d.colorModeForRenderPass(),M=c.paint.get("fill-pattern"),N=d.opaquePassEnabledForLayer()&&!M.constantOr(1)&&1===v.constantOr(a.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(d.renderPass===N){const Z=d.depthModeForSublayer(1,"opaque"===d.renderPass?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);gl(d,n,c,m,Z,I,!1)}if("translucent"===d.renderPass&&c.paint.get("fill-antialias")){const Z=d.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);gl(d,n,c,m,Z,I,!0)}},"fill-extrusion":function(d,n,c,m){const v=c.paint.get("fill-extrusion-opacity");if(0!==v&&"translucent"===d.renderPass){const b=new a.DepthMode(d.context.gl.LEQUAL,a.DepthMode.ReadWrite,d.depthRangeFor3D);if(1!==v||c.paint.get("fill-extrusion-pattern").constantOr(1))aa(d,n,c,m,b,a.StencilMode.disabled,a.ColorMode.disabled),aa(d,n,c,m,b,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const I=d.colorModeForRenderPass();aa(d,n,c,m,b,a.StencilMode.disabled,I)}}},hillshade:function(d,n,c,m){if("offscreen"!==d.renderPass&&"translucent"!==d.renderPass)return;const v=d.context,b=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),I=d.colorModeForRenderPass(),M=d.terrain&&d.terrain.renderingToTexture,[N,Z]="translucent"!==d.renderPass||M?[{},m]:d.stencilConfigForOverlap(m);for(const $ of Z){const re=n.getTile($);if(re.needsHillshadePrepare&&"offscreen"===d.renderPass)Pl(d,re,c,b,a.StencilMode.disabled,I);else if("translucent"===d.renderPass){const Re=M&&d.terrain?d.terrain.stencilModeForRTTOverlap($):N[$.overscaledZ];Ql(d,$,re,c,b,Re,I)}}v.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,n,c,m,v,b){if("translucent"!==d.renderPass||0===c.paint.get("raster-opacity")||!m.length)return;const I=d.context,M=I.gl,N=n.getSource(),Z=d.useProgram("raster"),$=d.colorModeForRenderPass(),re=d.terrain&&d.terrain.renderingToTexture,[Re,Fe]=N instanceof G||re?[{},m]:d.stencilConfigForOverlap(m),et=Fe[Fe.length-1].overscaledZ,Qe=!d.options.moving;for(const nt of Fe){const ce=re?a.DepthMode.disabled:d.depthModeForSublayer(nt.overscaledZ-et,1===c.paint.get("raster-opacity")?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,M.LESS),We=nt.toUnwrapped(),pt=n.getTile(nt);if(re&&(!pt||!pt.hasData()))continue;const gt=re?nt.projMatrix:d.transform.calculateProjMatrix(We,Qe),Pt=d.terrain&&re?d.terrain.stencilModeForRTTOverlap(nt):Re[nt.overscaledZ],Ft=b?0:c.paint.get("raster-fade-duration");pt.registerFadeDuration(Ft);const Rt=n.findLoadedParent(nt,0),qt=Rl(pt,Rt,n,d.transform,Ft);let Wt,an;d.terrain&&d.terrain.prepareDrawTile();const Yn="nearest"===c.paint.get("raster-resampling")?M.NEAREST:M.LINEAR;I.activeTexture.set(M.TEXTURE0),pt.texture.bind(Yn,M.CLAMP_TO_EDGE),I.activeTexture.set(M.TEXTURE1),Rt?(Rt.texture.bind(Yn,M.CLAMP_TO_EDGE),Wt=Math.pow(2,Rt.tileID.overscaledZ-pt.tileID.overscaledZ),an=[pt.tileID.canonical.x*Wt%1,pt.tileID.canonical.y*Wt%1]):pt.texture.bind(Yn,M.CLAMP_TO_EDGE),pt.texture.useMipmap&&I.extTextureFilterAnisotropic&&d.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const tn=Yi(gt,an||[0,0],Wt||1,qt,c,N instanceof G?N.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(I,Z,We),N instanceof G)N.boundsBuffer&&N.boundsSegments&&Z.draw(I,M.TRIANGLES,ce,a.StencilMode.disabled,$,a.CullFaceMode.disabled,tn,c.id,N.boundsBuffer,d.quadTriangleIndexBuffer,N.boundsSegments);else{const{tileBoundsBuffer:Pn,tileBoundsIndexBuffer:dn,tileBoundsSegments:Zn}=d.getTileBoundsBuffers(pt);Z.draw(I,M.TRIANGLES,ce,Pt,$,a.CullFaceMode.disabled,tn,c.id,Pn,dn,Zn)}}d.resetStencilClippingMasks()},background:function(d,n,c,m){const v=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(0===b)return;const I=d.context,M=I.gl,N=d.transform,Z=N.tileSize,$=c.paint.get("background-pattern");if(d.isPatternMissing($))return;const re=!$&&1===v.a&&1===b&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==re)return;const Re=a.StencilMode.disabled,Fe=d.depthModeForSublayer(0,"opaque"===re?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),et=d.colorModeForRenderPass(),Qe=d.useProgram($?"backgroundPattern":"background");let nt,ce=m;ce||(nt=d.getBackgroundTiles(),ce=Object.values(nt).map(We=>We.tileID)),$&&(I.activeTexture.set(M.TEXTURE0),d.imageManager.bind(d.context));for(const We of ce){const pt=We.toUnwrapped(),gt=m?We.projMatrix:d.transform.calculateProjMatrix(pt);d.prepareDrawTile();const Pt=n?n.getTile(We):nt?nt[We.key]:new a.Tile(We,Z,N.zoom,d),Ft=$?is(gt,b,d,$,{tileID:We,tileSize:Z}):oa(gt,b,v);d.prepareDrawProgram(I,Qe,pt);const{tileBoundsBuffer:Rt,tileBoundsIndexBuffer:qt,tileBoundsSegments:Wt}=d.getTileBoundsBuffers(Pt);Qe.draw(I,M.TRIANGLES,Fe,Re,et,a.CullFaceMode.disabled,Ft,c.id,Rt,qt,Wt)}},sky:function(d,n,c){const m=d.transform,v="mercator"===m.projection.name||"globe"===m.projection.name?1:a.smoothstep(7,8,m.zoom),b=c.paint.get("sky-opacity")*v;if(0===b)return;const I=d.context,M=c.paint.get("sky-type"),N=new a.DepthMode(I.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),Z=d.frameCounter/1e3%1;"atmosphere"===M?"offscreen"===d.renderPass?c.needsSkyboxCapture(d)&&(function($,re,Re,Fe){const et=$.context,Qe=et.gl;let nt=re.skyboxFbo;if(!nt){nt=re.skyboxFbo=et.createFramebuffer(32,32,!1),re.skyboxGeometry=new Qa(et),re.skyboxTexture=et.gl.createTexture(),Qe.bindTexture(Qe.TEXTURE_CUBE_MAP,re.skyboxTexture),Qe.texParameteri(Qe.TEXTURE_CUBE_MAP,Qe.TEXTURE_WRAP_S,Qe.CLAMP_TO_EDGE),Qe.texParameteri(Qe.TEXTURE_CUBE_MAP,Qe.TEXTURE_WRAP_T,Qe.CLAMP_TO_EDGE),Qe.texParameteri(Qe.TEXTURE_CUBE_MAP,Qe.TEXTURE_MIN_FILTER,Qe.LINEAR),Qe.texParameteri(Qe.TEXTURE_CUBE_MAP,Qe.TEXTURE_MAG_FILTER,Qe.LINEAR);for(let gt=0;gt<6;++gt)Qe.texImage2D(Qe.TEXTURE_CUBE_MAP_POSITIVE_X+gt,0,Qe.RGBA,32,32,0,Qe.RGBA,Qe.UNSIGNED_BYTE,null)}et.bindFramebuffer.set(nt.framebuffer),et.viewport.set([0,0,32,32]);const ce=re.getCenter($,!0),We=$.useProgram("skyboxCapture"),pt=new Float64Array(16);a.identity(pt),a.rotateY(pt,pt,.5*-Math.PI),rs(et,re,We,pt,ce,0),a.identity(pt),a.rotateY(pt,pt,.5*Math.PI),rs(et,re,We,pt,ce,1),a.identity(pt),a.rotateX(pt,pt,.5*-Math.PI),rs(et,re,We,pt,ce,2),a.identity(pt),a.rotateX(pt,pt,.5*Math.PI),rs(et,re,We,pt,ce,3),a.identity(pt),rs(et,re,We,pt,ce,4),a.identity(pt),a.rotateY(pt,pt,Math.PI),rs(et,re,We,pt,ce,5),et.viewport.set([0,0,$.width,$.height])}(d,c),c.markSkyboxValid(d)):"sky"===d.renderPass&&function($,re,Re,Fe,et){const Qe=$.context,nt=Qe.gl,ce=$.transform,We=$.useProgram("skybox");Qe.activeTexture.set(nt.TEXTURE0),nt.bindTexture(nt.TEXTURE_CUBE_MAP,re.skyboxTexture);const pt={u_matrix:ce.skyboxMatrix,u_sun_direction:re.getCenter($,!1),u_cubemap:0,u_opacity:Fe,u_temporal_offset:et};$.prepareDrawProgram(Qe,We),We.draw(Qe,nt.TRIANGLES,Re,a.StencilMode.disabled,$.colorModeForRenderPass(),a.CullFaceMode.backCW,pt,"skybox",re.skyboxGeometry.vertexBuffer,re.skyboxGeometry.indexBuffer,re.skyboxGeometry.segment)}(d,c,N,b,Z):"gradient"===M&&"sky"===d.renderPass&&function($,re,Re,Fe,et){const Qe=$.context,nt=Qe.gl,ce=$.transform,We=$.useProgram("skyboxGradient");re.skyboxGeometry||(re.skyboxGeometry=new Qa(Qe)),Qe.activeTexture.set(nt.TEXTURE0);let pt=re.colorRampTexture;pt||(pt=re.colorRampTexture=new a.Texture(Qe,re.colorRamp,nt.RGBA)),pt.bind(nt.LINEAR,nt.CLAMP_TO_EDGE);const gt=(Pt=ce.skyboxMatrix,Ft=re.getCenter($,!1),Rt=re.paint.get("sky-gradient-radius"),qt=Fe,Wt=et,{u_matrix:Pt,u_color_ramp:0,u_center_direction:Ft,u_radius:a.degToRad(Rt),u_opacity:qt,u_temporal_offset:Wt});var Pt,Ft,Rt,qt,Wt;$.prepareDrawProgram(Qe,We),We.draw(Qe,nt.TRIANGLES,Re,a.StencilMode.disabled,$.colorModeForRenderPass(),a.CullFaceMode.backCW,gt,"skyboxGradient",re.skyboxGeometry.vertexBuffer,re.skyboxGeometry.indexBuffer,re.skyboxGeometry.segment)}(d,c,N,b,Z)},debug:function(d,n,c){for(let m=0;m<c.length;m++)ec(d,n,c[m])},custom:function(d,n,c,m){const v=d.context,b=c.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||"offscreen"===d.renderPass)&&c.isLayerDraped()){if("offscreen"===d.renderPass){const I=b.prerender;if(I){if(d.setCustomLayerDefaults(),v.setColorMode(d.colorModeForRenderPass()),"globe"===d.transform.projection.name){const M=d.transform.pointMerc;I.call(b,v.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(d.transform.zoom),[M.x,M.y],d.transform.pixelsPerMeterRatio)}else I.call(b,v.gl,d.transform.customLayerMatrix());v.setDirty(),d.setBaseState()}}else if("translucent"===d.renderPass){if(d.terrain&&d.terrain.renderingToTexture){const M=b.renderToTile;if(M){const N=m[0].canonical,Z=new a.MercatorCoordinate(N.x+m[0].wrap*(1<<N.z),N.y,N.z);v.setDepthMode(a.DepthMode.disabled),v.setStencilMode(a.StencilMode.disabled),v.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),M.call(b,v.gl,Z),v.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),v.setColorMode(d.colorModeForRenderPass()),v.setStencilMode(a.StencilMode.disabled);const I="3d"===b.renderingMode?new a.DepthMode(d.context.gl.LEQUAL,a.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,a.DepthMode.ReadOnly);if(v.setDepthMode(I),"globe"===d.transform.projection.name){const M=d.transform.pointMerc;b.render(v.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(d.transform.zoom),[M.x,M.y],d.transform.pixelsPerMeterRatio)}else b.render(v.gl,d.transform.customLayerMatrix());v.setDirty(),d.setBaseState(),v.bindFramebuffer.set(null)}}else a.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class fe{constructor(n,c,m=!1){this.context=new Bn(n,m),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,c){const m=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new pl(this,n));const v=this._terrain;this.transform.elevation=m?v:null,v.update(n,this.transform,c)}_updateFog(n){const c=n.fog;if(!c||"globe"===this.transform.projection.name||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,v]=c.getFovAdjustedRange(this.transform._fov);if(m>v)return void(this.transform.fogCullDistSq=null);const b=m+.78*(v-m);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,c){if(this.width=n*a.exported.devicePixelRatio,this.height=c*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const n=this.context,c=new a.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(a.EXTENT,0),c.emplaceBack(0,a.EXTENT),c.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(c,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const m=new a.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(a.EXTENT,0),m.emplaceBack(0,a.EXTENT),m.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=n.createVertexBuffer(m,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const v=new a.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(v,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const b=new a.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(a.EXTENT,0,a.EXTENT,0),b.emplaceBack(0,a.EXTENT,0,a.EXTENT),b.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(b,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const I=new a.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(I);const M=new a.StructArrayLayout1ui2;for(const Z of[0,1,3,2,0])M.emplaceBack(Z);this.debugIndexBuffer=n.createIndexBuffer(M),this.emptyTexture=new a.Texture(n,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=a.create();const N=this.context.gl;this.stencilClearMode=new a.StencilMode({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new Me(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,c=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,c.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,Wa(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,c,m){if(!c||this.currentStencilSource===c.id||!n.isTileClipped()||!m||0===m.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const N of m)if(void 0===this._tileClippingMaskIDs[N.key]){M=!0;break}if(!M)return}this.currentStencilSource=c.id;const v=this.context,b=v.gl;this.nextStencilID+m.length>256&&this.clearStencil(),v.setColorMode(a.ColorMode.disabled),v.setDepthMode(a.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of m){const N=c.getTile(M),Z=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:$,tileBoundsIndexBuffer:re,tileBoundsSegments:Re}=this.getTileBoundsBuffers(N);I.draw(v,b.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:b.ALWAYS,mask:0},Z,255,b.KEEP,b.KEEP,b.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Wa(M.projMatrix),"$clipping",$,re,Re)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,c=this.context.gl;return new a.StencilMode({func:c.NOTEQUAL,mask:255},n,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const c=this.context.gl;return new a.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(n){const c=this.context.gl,m=n.sort((I,M)=>M.overscaledZ-I.overscaledZ),v=m[m.length-1].overscaledZ,b=m[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const I={};for(let M=0;M<b;M++)I[M+v]=new a.StencilMode({func:c.GEQUAL,mask:255},M+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=b,[I,m]}return[{[v]:a.StencilMode.disabled},m]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([n.CONSTANT_COLOR,n.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(n,c,m){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new a.DepthMode(m||this.context.gl.LEQUAL,c,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,c){this.style=n,this.options=c,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const m=this.style.order,v=this.style._sourceCaches;for(const Z in v){const $=v[Z];$.used&&$.prepare(this.context)}const b={},I={},M={};for(const Z in v){const $=v[Z];b[Z]=$.getVisibleCoordinates(),I[Z]=b[Z].slice().reverse(),M[Z]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Z=0;Z<m.length;Z++)if(this.style._layers[m[Z]].is3D()){this.opaquePassCutoff=Z;break}if(this.terrain&&(this.terrain.updateTileBinding(M),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),!a.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const Z of m){const $=this.style._layers[Z],re=n._getLayerSourceCache($);if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const Re=re?I[re.id]:void 0;("custom"===$.type||$.isSky()||Re&&Re.length)&&this.renderLayer(this,re,$,Re)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon];const N=this.terrain;if(N&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&N.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const Z=this.style._layers[m[this.currentLayer]],$=n._getLayerSourceCache(Z);if(Z.isSky())continue;const re=$?I[$.id]:void 0;this._renderTileClippingMasks(Z,$,re),this.renderLayer(this,$,Z,re)}if(this.style.fog&&this.transform.projection.supportsFog&&function(Z,$){const re=Z.context,Re=re.gl,Fe=Z.transform,et=new a.DepthMode(Re.LEQUAL,a.DepthMode.ReadOnly,[0,1]),Qe=Z.useProgram("globeAtmosphere",null,"globe"===Fe.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),nt=a.globeToMercatorTransition(Fe.zoom),ce=$.properties.get("color").toArray01(),We=$.properties.get("high-color").toArray01(),pt=$.properties.get("space-color").toArray01PremultipliedAlpha(),gt=a.identity$1([]);a.rotateY$1(gt,gt,-a.degToRad(Fe._center.lng)),a.rotateX$1(gt,gt,a.degToRad(Fe._center.lat)),a.rotateZ$1(gt,gt,Fe.angle),a.rotateX$1(gt,gt,-Fe._pitch);const Pt=a.fromQuat(new Float32Array(16),gt),Ft=a.mapValue($.properties.get("star-intensity"),0,1,0,.25),qt=a.mapValue($.properties.get("horizon-blend"),0,1,5e-4,.25),Wt=a.globeUseCustomAntiAliasing(Z,re,Fe)&&5e-4===qt?Fe.worldSize/(2*Math.PI*1.025)-1:Fe.globeRadius,an=Z.frameCounter/1e3%1,Yn=a.length(Fe.globeCenterInViewSpace),tn=Math.sqrt(Math.pow(Yn,2)-Math.pow(Wt,2)),Pn=Math.acos(tn/Yn),dn={u_frustum_tl:Fe.frustumCorners.TL,u_frustum_tr:Fe.frustumCorners.TR,u_frustum_br:Fe.frustumCorners.BR,u_frustum_bl:Fe.frustumCorners.BL,u_horizon:Fe.frustumCorners.horizon,u_transition:nt,u_fadeout_range:qt,u_color:ce,u_high_color:We,u_space_color:pt,u_star_intensity:Ft,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:an,u_horizon_angle:Pn,u_rotation_matrix:Pt};Z.prepareDrawProgram(re,Qe);const Zn=Z.atmosphereBuffer;Zn&&Qe.draw(re,Re.TRIANGLES,et,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,dn,"skybox",Zn.vertexBuffer,Zn.indexBuffer,Zn.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const Z=this.style._layers[m[this.currentLayer]],$=n._getLayerSourceCache(Z);Z.isSky()&&this.renderLayer(this,$,Z,$?I[$.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const Z=this.style._layers[m[this.currentLayer]],$=n._getLayerSourceCache(Z);if(Z.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(Z)){if(Z.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const re=$?("symbol"===Z.type?M:I)[$.id]:void 0;this._renderTileClippingMasks(Z,$,$?b[$.id]:void 0),this.renderLayer(this,$,Z,re),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Z=null;a.values(this.style._layers).forEach($=>{const re=n._getLayerSourceCache($);re&&!$.isHidden(this.transform.zoom)&&(!Z||Z.getSource().maxzoom<re.getSource().maxzoom)&&(Z=re)}),Z&&this.options.showTileBoundaries&&q.debug(this,Z,Z.getVisibleCoordinates())}this.options.showPadding&&function(Z){const $=Z.transform.padding;Ds(Z,Z.transform.height-($.top||0),3,Ts),Ds(Z,$.bottom||0,3,ko),_l(Z,$.left||0,3,go),_l(Z,Z.transform.width-($.right||0),3,bc);const re=Z.transform.centerPoint;var Re,Fe,et,Qe;yl(Re=Z,(Fe=re.x)-1,(et=Z.transform.height-re.y)-10,2,20,Qe=Xa),yl(Re,Fe-10,et-1,20,2,Qe)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,c,m,v){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||v&&v.length)&&(this.id=m.id,this.gpuTimingStart(m),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(m.type)||n.terrain&&"custom"===m.type)&&q[m.type](n,c,m,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let m=this.gpuTimers[n.id];m||(m=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),m.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,c=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),n.beginQueryEXT(n.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const c={};for(const m in n){const v=n[m],b=this.context.extTimerQuery,I=b.getQueryObjectEXT(v.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(v.query),c[m]=I}return c}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let m=0;for(const v of n)m+=c.getQueryObjectEXT(v,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(v);return m}translatePosMatrix(n,c,m,v,b){if(!m[0]&&!m[1])return n;const I=b?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(I){const Z=Math.sin(I),$=Math.cos(I);m=[m[0]*$-m[1]*Z,m[0]*Z+m[1]*$]}const M=[b?m[0]:xn(c,m[0],this.transform.zoom),b?m[1]:xn(c,m[1],this.transform.zoom),0],N=new Float32Array(16);return a.translate(N,n,M),N}saveTileTexture(n){const c=this._tileTextures[n.size[0]];c?c.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const c=this._tileTextures[n];return c&&c.length>0?c.pop():null}isPatternMissing(n){return null===n||void 0!==n&&!this.imageManager.getPattern(n.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,c=this.terrain&&0===this.terrain.exaggeration(),m=this.style&&this.style.fog,v=[];return this.terrainRenderModeElevated()&&v.push("TERRAIN"),"globe"===this.transform.projection.name&&v.push("GLOBE"),c&&v.push("ZERO_EXAGGERATION"),m&&!n&&0!==m.getOpacity(this.transform.pitch)&&v.push("FOG"),n&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}useProgram(n,c,m){this.cache=this.cache||{};const v=m||[],b=this.currentGlobalDefines().concat(v),I=_i.cacheKey(fl[n],n,b,c);return this.cache[I]||(this.cache[I]=new _i(this.context,n,fl[n],c,ga[n],b)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,c,m){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch),I=((M,N,Z,$,re,Re,Fe,et,Qe,nt,ce)=>{const We=M.transform,pt=N.properties.get("color").toArray01();pt[3]=$;const gt=M.frameCounter/1e3%1;return{u_fog_matrix:Z?We.calculateFogTileMatrix(Z):M.identityMat,u_fog_range:N.getFovAdjustedRange(We._fov),u_fog_color:pt,u_fog_horizon_blend:N.properties.get("horizon-blend"),u_fog_temporal_offset:gt,u_frustum_tl:re,u_frustum_tr:Re,u_frustum_br:Fe,u_frustum_bl:et,u_globe_pos:Qe,u_globe_radius:nt,u_viewport:ce,u_globe_transition:a.globeToMercatorTransition(We.zoom),u_is_globe:+("globe"===We.projection.name)}})(this,v,m,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);c.setFogUniformValues(n,I)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,c=n.createTexture();return n.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&0!==n.getOpacity(this.transform.pitch)}getBackgroundTiles(){const n=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const v of m)c[v.key]=n[v.key]||new a.Tile(v,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class xt{constructor(n=0,c=0,m=0,v=0){if(isNaN(n)||n<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=c,this.left=m,this.right=v}interpolate(n,c,m){return null!=c.top&&null!=n.top&&(this.top=a.number(n.top,c.top,m)),null!=c.bottom&&null!=n.bottom&&(this.bottom=a.number(n.bottom,c.bottom,m)),null!=c.left&&null!=n.left&&(this.left=a.number(n.left,c.left,m)),null!=c.right&&null!=n.right&&(this.right=a.number(n.right,c.right,m)),this}getCenter(n,c){const m=a.clamp((this.left+n-this.right)/2,0,n),v=a.clamp((this.top+c-this.bottom)/2,0,c);return new a.Point(m,v)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new xt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function vn(d,n){const c=a.getColumn(d,3);a.fromQuat(d,n),a.setColumn(d,3,c)}function bn(d,n){const c=a.identity$1([]);return a.rotateZ$1(c,c,-n),a.rotateX$1(c,c,-d),c}function Ti(d,n){const c=[d[0],d[1],0],m=[n[0],n[1],0];if(a.length(c)>=1e-15){const I=a.normalize([],c);a.scale$2(m,I,a.dot(m,I)),n[0]=m[0],n[1]=m[1]}const v=a.cross([],n,d);if(a.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return bn(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),b)}class Ur{constructor(n,c){this.position=n,this.orientation=c}get position(){return this._position}set position(n){if(n){const c=n instanceof a.MercatorCoordinate?n:new a.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(c.x=a.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(n,c){if(this.orientation=null,!this.position)return;const m=this.position,v=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(n)):0,b=a.MercatorCoordinate.fromLngLat(n,v),I=[b.x-m.x,b.y-m.y,b.z-m.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Ti(I,c)}setPitchBearing(n,c){this.orientation=bn(a.degToRad(n),a.degToRad(-c))}}class Lr{constructor(n,c){this._transform=a.identity([]),this.orientation=c,this.position=n}get mercatorPosition(){const n=this.position;return new a.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=a.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var c;n&&a.setColumn(this._transform,3,[(c=n)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||a.identity$1([]),n&&vn(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,c){this._orientation=bn(n,c),vn(this._transform,this._orientation)}forward(){const n=a.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=a.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=a.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,c){const m=new Float64Array(16);return a.invert(m,this.getWorldToCamera(n,c)),m}getWorldToCameraPosition(n,c,m){const v=this.position;a.scale$2(v,v,-n);const b=new Float64Array(16);return a.fromScaling(b,[m,m,m]),a.translate(b,b,v),b[10]*=c,b}getWorldToCamera(n,c){const m=new Float64Array(16),v=new Float64Array(4),b=this.position;return a.conjugate(v,this._orientation),a.scale$2(b,b,-n),a.fromQuat(m,v),a.translate(m,m,b),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(n,c,m,v){const b=new Float64Array(16);return a.perspective(b,n,c,m,v),b}getDistanceToElevation(n,c=!1){const m=0===n?0:a.mercatorZfromAltitude(n,c?a.latFromMercatorY(this.position[1]):this.position[1]),v=this.forward();return(m-this.position[2])/v[2]}clone(){return new Lr([...this.position],[...this.orientation])}}function Sr(d,n){const c=Pr(d.projection,d.zoom,d.width,d.height),m=function(b,I,M,N,Z){const $=new a.LngLat(M.lng-180*hr,M.lat),re=new a.LngLat(M.lng+180*hr,M.lat),Re=b.project($.lng,$.lat),Fe=b.project(re.lng,re.lat),et=-Math.atan2(Fe.y-Re.y,Fe.x-Re.x),Qe=a.MercatorCoordinate.fromLngLat(M);Qe.y=a.clamp(Qe.y,-1+hr,1-hr);const nt=Qe.toLngLat(),ce=b.project(nt.lng,nt.lat),We=a.MercatorCoordinate.fromLngLat(nt);We.x+=hr;const pt=We.toLngLat(),gt=b.project(pt.lng,pt.lat),Pt=$s(gt.x-ce.x,gt.y-ce.y,et),Ft=a.MercatorCoordinate.fromLngLat(nt);Ft.y+=hr;const Rt=Ft.toLngLat(),qt=b.project(Rt.lng,Rt.lat),Wt=$s(qt.x-ce.x,qt.y-ce.y,et),an=Math.abs(Pt.x)/Math.abs(Wt.y),Yn=a.identity([]);a.rotateZ(Yn,Yn,-et*(1-(Z?0:N)));const tn=a.identity([]);return a.scale(tn,tn,[1,1-(1-an)*N,1]),tn[4]=-Wt.x/Wt.y*N,a.rotateZ(tn,tn,et),a.multiply(tn,Yn,tn),tn}(d.projection,0,d.center,c,n),v=sr(d);return a.scale(m,m,[v,v,1]),m}function sr(d){const n=d.projection,c=Pr(d.projection,d.zoom,d.width,d.height),m=So(n,d.center),v=So(n,a.LngLat.convert(n.center));return Math.pow(2,m*c+(1-c)*v)}function Pr(d,n,c,m,v=1/0){const b=d.range;if(!b)return 0;const I=Math.min(v,Math.max(c,m)),M=Math.log(I/1024)/Math.LN2;return a.smoothstep(b[0]+M,b[1]+M,n)}const hr=1/4e4;function So(d,n){const c=a.clamp(n.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),m=new a.LngLat(n.lng-180*hr,c),v=new a.LngLat(n.lng+180*hr,c),b=d.project(m.lng,c),I=d.project(v.lng,c),M=a.MercatorCoordinate.fromLngLat(m),N=a.MercatorCoordinate.fromLngLat(v),Z=I.x-b.x,$=I.y-b.y,re=N.x-M.x,Re=N.y-M.y,Fe=Math.sqrt((re*re+Re*Re)/(Z*Z+$*$));return Math.log(Fe)/Math.LN2}function $s(d,n,c){const m=Math.cos(c),v=Math.sin(c);return{x:d*m-n*v,y:d*v+n*m}}class qo{constructor(n,c,m,v,b,I,M){this.tileSize=512,this._renderWorldCopies=void 0===b||b,this._minZoom=n||0,this._maxZoom=c||22,this._minPitch=m??0,this._maxPitch=v??60,this.setProjection(I),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new xt,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Lr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new qo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n,c=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||m)&&this._updateCameraOnTerrain(),(n||m)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const m=!j(c,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.getProjection({name:"mercator"});const c=n!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(n){void 0===n?n=!0:null===n&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.Point(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const c=-n*Math.PI/180;var m,v,b,I,M,N,Z,$,re,Re;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(m=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),v=this.rotationMatrix,I=this.angle,M=(b=this.rotationMatrix)[0],N=b[1],Z=b[2],$=b[3],re=Math.sin(I),Re=Math.cos(I),v[0]=M*Re+Z*re,v[1]=N*Re+$*re,v[2]=M*-re+Z*Re,v[3]=N*-re+$*Re)}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const c=a.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=a.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const c=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let v=0,b=0;for(let I=0;I<c.length;I++){const M=new a.Point(c[I][0]*this.width,m+c[I][1]*(this.height-m)),N=n.pointCoordinate(M);if(!N)continue;const Z=1/Math.hypot(N[0]-this._camera.position[0],N[1]-this._camera.position[1]);v+=N[3]*Z,b+=Z}return 0===b?NaN:v/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const n=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,v=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),I=Math.max(v-m,b);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let m;m=n.z<this._camera.position[2]?[c.x,c.y,c.z]:[n.x,n.y,n.z];const v=a.length(a.sub([],this._camera.position,m));return a.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let c=!1;if(n.orientation&&!a.exactEquals(n.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(n.orientation)),n.position){const m=[n.position.x,n.position.y,n.position.z];a.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,c=new Ur;return c.position=new a.MercatorCoordinate(n[0],n[1],n[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(n){if(!a.length$1(n))return!1;a.normalize$1(n,n);const c=a.transformQuat([],[0,0,-1],n),m=a.transformQuat([],[0,-1,0],n);if(m[2]<0)return!1;const v=Ti(c,m);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(n){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;n[2]=a.clamp(n[2],v/m,v/c),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,c,m){this._unmodified=!1,this._edgeInsets.interpolate(n,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const c=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(n){const c=[new a.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const m=this.pointCoordinate(new a.Point(0,0)),v=this.pointCoordinate(new a.Point(this.width,0)),b=this.pointCoordinate(new a.Point(this.width,this.height)),I=this.pointCoordinate(new a.Point(0,this.height)),M=Math.floor(Math.min(m.x,v.x,b.x,I.x)),N=Math.floor(Math.max(m.x,v.x,b.x,I.x)),Z=1;for(let $=M-Z;$<=N+Z;$++)0!==$&&c.push(new a.UnwrappedTileID($,n))}return c}coveringTiles(n){let c=this.coveringZoomLevel(n);const m=c,v=this.elevation&&!n.isTerrainDEM,b="mercator"===this.projection.name;if(void 0!==n.minzoom&&c<n.minzoom)return[];void 0!==n.maxzoom&&c>n.maxzoom&&(c=n.maxzoom);const I=this.locationCoordinate(this.center),M=this.center.lat,N=1<<c,Z=[N*I.x,N*I.y,0],$="globe"===this.projection.name,re=!$,Re=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,re),Fe=$?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),et=N*a.mercatorZfromAltitude(1,this.center.lat),Qe=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),nt=[N*Fe.x,N*Fe.y,Qe*(re?1:et)],ce=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),We=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,pt=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,gt=n.isTerrainDEM?-pt:this._elevation?this._elevation.getMinElevationBelowMSL():0,Pt=this.projection.isReprojectedInTileSpace?sr(this):1,Ft=ln=>{const Qn=new a.MercatorCoordinate(ln.x+25e-6,ln.y,ln.z),jn=new a.MercatorCoordinate(ln.x,ln.y+25e-6,ln.z),ei=ln.toLngLat(),Ai=Qn.toLngLat(),Ji=jn.toLngLat(),wi=this.locationCoordinate(ei),Si=this.locationCoordinate(Ai),fr=this.locationCoordinate(Ji),tr=Math.hypot(Si.x-wi.x,Si.y-wi.y),Di=Math.hypot(fr.x-wi.x,fr.y-wi.y);return Math.sqrt(tr*Di)*Pt/25e-6},Rt=ln=>{const An=pt,Qn=gt;return{aabb:a.tileAABB(this,N,0,0,0,ln,Qn,An,this.projection),zoom:0,x:0,y:0,minZ:Qn,maxZ:An,wrap:ln,fullyVisible:!1}},qt=[];let Wt=[];const an=c,Yn=n.reparseOverscaled?m:c,tn=ln=>ln*ln,Pn=tn((Qe-this._centerAltitude)*et),dn=ln=>{if(!this._elevation||!ln.tileID||!b)return;const An=this._elevation.getMinMaxForTile(ln.tileID),Qn=ln.aabb;An?(Qn.min[2]=An.min,Qn.max[2]=An.max,Qn.center[2]=(Qn.min[2]+Qn.max[2])/2):(ln.shouldSplit=Zn(ln),ln.shouldSplit||(Qn.min[2]=Qn.max[2]=Qn.center[2]=this._centerAltitude))},Zn=ln=>{if(ln.zoom<We)return!0;if(ln.zoom===an)return!1;if(null!=ln.shouldSplit)return ln.shouldSplit;const An=ln.aabb.distanceX(nt),Qn=ln.aabb.distanceY(nt);let jn=Pn,ei=1;if($){jn=tn(ln.aabb.distanceZ(nt));const wi=Math.pow(2,ln.zoom),Si=a.latFromMercatorY((ln.y+1)/wi),fr=a.latFromMercatorY(ln.y/wi),tr=Math.min(Math.max(M,Si),fr),Di=a.circumferenceAtLatitude(tr)/a.circumferenceAtLatitude(M);if(ei=tr===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Di/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&ln.zoom===an-1&&Di>=.9)return!0}else if(v&&(jn=tn(ln.aabb.distanceZ(nt)*et)),this.projection.isReprojectedInTileSpace&&m<=5){const wi=Math.pow(2,ln.zoom),Si=Ft(new a.MercatorCoordinate((ln.x+.5)/wi,(ln.y+.5)/wi));ei=Si>.85?1:Si}const Ai=An*An+Qn*Qn+jn;return Ai<tn((1<<an-ln.zoom)*ce*ei*((wi,Si)=>{if(Si*tn(.707)<wi)return 1;const fr=Math.sqrt(Si/wi);return fr/(1.4144271570014144+(Math.pow(1.1,fr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(jn,Pn),Ai))};if(this.renderWorldCopies)for(let ln=1;ln<=3;ln++)qt.push(Rt(-ln)),qt.push(Rt(ln));for(qt.push(Rt(0));qt.length>0;){const ln=qt.pop(),An=ln.x,Qn=ln.y;let jn=ln.fullyVisible;if(!jn){const ei=ln.aabb.intersects(Re);if(0===ei)continue;jn=2===ei}if(ln.zoom!==an&&Zn(ln))for(let ei=0;ei<4;ei++){const Ai=(An<<1)+ei%2,Ji=(Qn<<1)+(ei>>1),wi={aabb:b?ln.aabb.quadrant(ei):a.tileAABB(this,N,ln.zoom+1,Ai,Ji,ln.wrap,ln.minZ,ln.maxZ,this.projection),zoom:ln.zoom+1,x:Ai,y:Ji,wrap:ln.wrap,fullyVisible:jn,tileID:void 0,shouldSplit:void 0,minZ:ln.minZ,maxZ:ln.maxZ};v&&!$&&(wi.tileID=new a.OverscaledTileID(ln.zoom+1===an?Yn:ln.zoom+1,ln.wrap,ln.zoom+1,Ai,Ji),dn(wi)),qt.push(wi)}else{const ei=ln.zoom===an?Yn:ln.zoom;if(n.minzoom&&n.minzoom>ei)continue;const Ai=Z[0]-(.5+An+(ln.wrap<<ln.zoom))*(1<<c-ln.zoom),Ji=Z[1]-.5-Qn,wi=ln.tileID?ln.tileID:new a.OverscaledTileID(ei,ln.wrap,ln.zoom,An,Qn);Wt.push({tileID:wi,distanceSq:Ai*Ai+Ji*Ji})}}if(this.fogCullDistSq){const ln=this.fogCullDistSq,An=this.horizonLineFromTop();Wt=Wt.filter(Qn=>{const jn=[0,0,0,1],ei=[a.EXTENT,a.EXTENT,0,1],Ai=this.calculateFogTileMatrix(Qn.tileID.toUnwrapped());a.transformMat4$1(jn,jn,Ai),a.transformMat4$1(ei,ei,Ai);const Ji=a.getAABBPointSquareDist(jn,ei);if(0===Ji)return!0;let wi=!1;const Si=this._elevation;if(Si&&Ji>ln&&0!==An){const fr=this.calculateProjMatrix(Qn.tileID.toUnwrapped());let tr;n.isTerrainDEM||(tr=Si.getMinMaxForTile(Qn.tileID)),tr||(tr={min:gt,max:pt});const Di=a.furthestTileCorner(this.rotation),Dr=[Di[0]*a.EXTENT,Di[1]*a.EXTENT,tr.max];a.transformMat4(Dr,Dr,fr),wi=(1-Dr[1])*this.height*.5<An}return Ji<ln||wi})}return Wt.sort((ln,An)=>ln.distanceSq-An.distanceSq).map(ln=>ln.tileID)}resize(n,c){this.width=n,this.height=c,this.pixelsToGLUnits=[2/n,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const c=a.clamp(n.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),m=this.projection.project(n.lng,c);return new a.Point(m.x*this.worldSize,m.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,c){let m,v;const b=this.centerPoint;if("globe"===this.projection.name){const M=this.worldSize;m=(c.x-b.x)/M,v=(c.y-b.y)/M}else{const M=this.pointCoordinate(c),N=this.pointCoordinate(b);m=M.x-N.x,v=M.y-N.y}const I=this.locationCoordinate(n);this.setLocation(new a.MercatorCoordinate(I.x-m,I.y-v))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,c){const m=c?a.mercatorZfromAltitude(c,n.lat):void 0,v=this.projection.project(n.lng,n.lat);return new a.MercatorCoordinate(v.x,v.y,m)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,c){const m=c??this._centerAltitude,v=[n.x,n.y,0,1],b=[n.x,n.y,1,1];a.transformMat4$1(v,v,this.pixelMatrixInverse),a.transformMat4$1(b,b,this.pixelMatrixInverse);const I=b[3];a.scale$1(v,v,1/v[3]),a.scale$1(b,b,1/I);const M=v[2],N=b[2];return{p0:v,p1:b,t:M===N?0:(m-M)/(N-M)}}screenPointToMercatorRay(n){const c=[n.x,n.y,0,1],m=[n.x,n.y,1,1];return a.transformMat4$1(c,c,this.pixelMatrixInverse),a.transformMat4$1(m,m,this.pixelMatrixInverse),a.scale$1(c,c,1/c[3]),a.scale$1(m,m,1/m[3]),c[2]=a.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,m[2]=a.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,a.scale$1(c,c,1/this.worldSize),a.scale$1(m,m,1/this.worldSize),new a.Ray([c[0],c[1],c[2]],a.normalize([],a.sub([],m,c)))}rayIntersectionCoordinate(n){const{p0:c,p1:m,t:v}=n,b=a.mercatorZfromAltitude(c[2],this._center.lat),I=a.mercatorZfromAltitude(m[2],this._center.lat);return new a.MercatorCoordinate(a.number(c[0],m[0],v)/this.worldSize,a.number(c[1],m[1],v)/this.worldSize,a.number(b,I,v))}pointCoordinate(n,c=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,c)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let c=this.projection.pointCoordinate3D(this,n.x,n.y);if(c)return new a.MercatorCoordinate(c[0],c[1],c[2]);let m=0,v=this.horizonLineFromTop();if(n.y>v)return this.pointCoordinate(n);const b=.02*v,I=n.clone();for(let M=0;M<10&&v-m>b;M++){I.y=a.number(m,v,.66);const N=this.projection.pointCoordinate3D(this,I.x,I.y);N?(v=I.y,c=N):m=I.y}return c?new a.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(n);const c=this.pointCoordinate(n);return c.y>=0&&c.y<=1}_coordinatePoint(n,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,v=[n.x*this.worldSize,n.y*this.worldSize,m+n.toAltitude(),1];return a.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new a.Point(v[0]/v[3],v[1]/v[3]):new a.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:c}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,b=this.pointLocation3D(new a.Point(c,n)),I=this.pointLocation3D(new a.Point(v,n)),M=this.pointLocation3D(new a.Point(v,m)),N=this.pointLocation3D(new a.Point(c,m));let Z=Math.min(b.lng,I.lng,M.lng,N.lng),$=Math.max(b.lng,I.lng,M.lng,N.lng),re=Math.min(b.lat,I.lat,M.lat,N.lat),Re=Math.max(b.lat,I.lat,M.lat,N.lat);const Fe=Math.pow(2,-this.zoom)/16*270,et="globe"===this.projection.name?1:4,Qe=(nt,ce,We,pt,gt)=>{const Pt=(nt+We)/2,Ft=(ce+pt)/2,Rt=new a.Point(Pt,Ft),{lng:qt,lat:Wt}=this.pointLocation3D(Rt),an=Math.max(0,Z-qt,re-Wt,qt-$,Wt-Re);Z=Math.min(Z,qt),$=Math.max($,qt),re=Math.min(re,Wt),Re=Math.max(Re,Wt),(gt<et||an>Fe)&&(Qe(nt,ce,Pt,Ft,gt+1),Qe(Pt,Ft,We,pt,gt+1))};if(Qe(c,n,v,n,1),Qe(v,n,v,m,1),Qe(v,m,c,m,1),Qe(c,m,c,n,1),"globe"===this.projection.name){const[nt,ce]=a.polesInViewport(this);nt?(Re=90,$=180,Z=-180):ce&&(re=-90,$=180,Z=-180)}return new a.LngLatBounds(new a.LngLat(Z,re),new a.LngLat($,Re))}_getBoundsRectangular(n,c){const{top:m,left:v}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,M=new a.Point(v,m),N=new a.Point(I,m),Z=new a.Point(I,b),$=new a.Point(v,b);let re=this.pointCoordinate(M,n),Re=this.pointCoordinate(N,n);const Fe=this.pointCoordinate(Z,c),et=this.pointCoordinate($,c),Qe=(nt,ce)=>(ce.y-nt.y)/(ce.x-nt.x);return re.y>1&&Re.y>=0?re=new a.MercatorCoordinate((1-et.y)/Qe(et,re)+et.x,1):re.y<0&&Re.y<=1&&(re=new a.MercatorCoordinate(-et.y/Qe(et,re)+et.x,0)),Re.y>1&&re.y>=0?Re=new a.MercatorCoordinate((1-Fe.y)/Qe(Fe,Re)+Fe.x,1):Re.y<0&&re.y<=1&&(Re=new a.MercatorCoordinate(-Fe.y/Qe(Fe,Re)+Fe.x,0)),(new a.LngLatBounds).extend(this.coordinateLocation(re)).extend(this.coordinateLocation(Re)).extend(this.coordinateLocation(et)).extend(this.coordinateLocation(Fe))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=n.visibleDemTiles.reduce((m,v)=>{if(v.dem){const b=v.dem.tree;m.min=Math.min(m.min,b.minimums[0]),m.max=Math.max(m.max,b.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*n.exaggeration(),c.max*n.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return n?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,c){return this.projection.createTileMatrix(this,c,n)}calculateDistanceTileData(n){const c=n.key,m=this._distanceTileDataCache;if(m[c])return m[c];const v=n.canonical,b=1/this.height,I=this.cameraWorldSize,M=I/this.zoomScale(v.z),N=(v.x+Math.pow(2,v.z)*n.wrap)*M,Z=v.y*M,$=this.point;$.x*=I/this.worldSize,$.y*=I/this.worldSize;const re=this.angle,Re=Math.sin(-re),Fe=-Math.cos(-re);return m[c]={bearing:[Re,Fe],center:[($.x-N)*b,($.y-Z)*b],scale:M/a.EXTENT*b},m[c]}calculateFogTileMatrix(n){const c=n.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return a.multiply(v,this.worldToFogMatrix,v),m[c]=new Float32Array(v),m[c]}calculateProjMatrix(n,c=!1){const m=n.key,v=c?this._alignedProjMatrixCache:this._projMatrixCache;if(v[m])return v[m];const b=this.calculatePosMatrix(n,this.worldSize);return a.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,b),v[m]=new Float32Array(b),v[m]}calculatePixelsToTileUnitsMatrix(n){const c=n.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const v=function(b,I){const{scale:M}=b.tileTransform,N=M*a.EXTENT/(b.tileSize*Math.pow(2,I.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return Z=new Float32Array(4),Re=($=I.inverseAdjustmentMatrix)[1],Fe=$[2],et=$[3],nt=(re=[N,N])[1],Z[0]=$[0]*(Qe=re[0]),Z[1]=Re*Qe,Z[2]=Fe*nt,Z[3]=et*nt,Z;var Z,$,re,Re,Fe,et,Qe,nt}(n,this);return m[c]=v,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const n=1/this.worldSize,c=a.fromScaling([],[n,n,n]);return a.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const n=this._elevation;this._updateCameraState();const c=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),v=this._camera.forward(),b=a.mercatorZfromAltitude(1,this._center.lat);m[2]/=b,v[2]/=b,a.normalize(v,v);const I=n.raycast(m,v,n.exaggeration());if(I){const M=a.scaleAndAdd([],m,v,I),N=new a.MercatorCoordinate(M[0],M[1],a.mercatorZfromAltitude(M[2],a.latFromMercatorY(M[1]))),Z=(N.z+a.length([N.x-m[0],N.y-m[1],N.z-m[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(Z),this._centerAltitude=N.toAltitude(),this._center=this.coordinateLocation(N),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const c=this._elevation,m=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(m),b=c.getAtPointOrZero(new a.MercatorCoordinate(...v)),I=this.pixelsPerMeter/this.worldSize*b,M=this._minimumHeightOverTerrain(),N=v[2]-I;if(N<=M)if(N<0||n){const Z=this.locationCoordinate(this._center,this._centerAltitude),$=[v[0],v[1],Z.z-v[2]],re=a.length($);$[2]-=(M-N)/this._pixelsPerMercatorPixel;const Re=a.length($);if(0===Re)return;a.scale$2($,$,re/Re*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],Z.z*this._pixelsPerMercatorPixel-$[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const Re=this.center;return Re.lat=a.clamp(Re.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(Re.lng=a.clamp(Re.lng,this.minLng,this.maxLng)),this.center=Re,void(this._constraining=!1)}const c=this._unmodified,{x:m,y:v}=this.point;let b=0,I=m,M=v;const N=this.width/2,Z=this.height/2,$=this.worldMinY*this.scale,re=this.worldMaxY*this.scale;if(v-Z<$&&(M=$+Z),v+Z>re&&(M=re-Z),re-$<this.height&&(b=Math.max(b,this.height/(re-$)),M=(re+$)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Re=this.worldMinX*this.scale,Fe=this.worldMaxX*this.scale,et=this.worldSize/2-(Re+Fe)/2;I=(m+et+this.worldSize)%this.worldSize-et,I-N<Re&&(I=Re+N),I+N>Fe&&(I=Fe-N),Fe-Re<this.width&&(b=Math.max(b,this.width/(Fe-Re)),I=(Fe+Re)/2)}I===m&&M===v||(this.center=this.unproject(new a.Point(I,M))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,c=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=a.mercatorZfromAltitude(1,this.center.lat)/a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE));const m=Pr(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v="meters"===this.projection.zAxisUnit?c:1,b=this._camera.getWorldToCamera(this.worldSize,v),I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);I[8]=2*-n.x/this.width,I[9]=2*n.y/this.height;let M=a.mul([],I,b);if(this.projection.isReprojectedInTileSpace){const Ft=this.locationCoordinate(this.center),Rt=a.identity([]);a.translate(Rt,Rt,[Ft.x*this.worldSize,Ft.y*this.worldSize,0]),a.multiply(Rt,Rt,Sr(this)),a.translate(Rt,Rt,[-Ft.x*this.worldSize,-Ft.y*this.worldSize,0]),a.multiply(M,M,Rt),this.inverseAdjustmentMatrix=function(qt){const Wt=Sr(qt,!0);return Ae([],[Wt[0],Wt[1],Wt[4],Wt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],M,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=M,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const N=a.invert([],I);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height);const Z=new Float32Array(16);a.identity(Z),a.scale(Z,Z,[1,-1,1]),a.rotateX(Z,Z,this._pitch),a.rotateZ(Z,Z,this.angle);const $=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),re=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-n.x/this.width,$[9]=2*(n.y+re)/this.height,this.skyboxMatrix=a.multiply(Z,$,Z);const Re=this.point,Fe=Re.x,et=Re.y,Qe=this.width%2/2,nt=this.height%2/2,ce=Math.cos(this.angle),We=Math.sin(this.angle),pt=Fe-Math.round(Fe)+ce*Qe+We*nt,gt=et-Math.round(et)+ce*nt+We*Qe,Pt=new Float64Array(M);if(a.translate(Pt,Pt,[pt>.5?pt-1:pt,gt>.5?gt-1:gt,0]),this.alignedProjMatrix=Pt,M=a.create(),a.scale(M,M,[this.width/2,-this.height/2,1]),a.translate(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=a.create(),a.scale(M,M,[1,-1,1]),a.translate(M,M,[-1,-1,0]),a.scale(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},M=a.invert(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=M,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const Ft=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4(Ft,Ft,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=M;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,m=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,b=[n,n,c];a.scale$2(b,b,v),a.scale$2(m,m,-1),a.multiply$2(m,m,b);const I=a.create();a.translate(I,I,m),a.scale(I,I,b),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,c,v)}_computeCameraPosition(n){const c=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-n/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-m[0]*b,v.y/this.worldSize-m[1]*b,n/this.worldSize*this._centerAltitude-m[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],v=n[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(b=Math.min((c-m)/v,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,n,b),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:v}=this._camera.getPitchBearing(),b=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),M=Math.max((n[2]-b)/Math.cos(m),I),N=this._zoomFromMercatorZ(M);a.scaleAndAdd(n,n,c,M),this._pitch=a.clamp(m,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(v,-Math.PI,Math.PI),this._setZoom(a.clamp(N,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let c=0,m=a.GLOBE_ZOOM_THRESHOLD_MAX,v=0,b=1/0;for(;m-c>1e-6&&m>c;){const I=c+.5*(m-c),M=this.tileSize*Math.pow(2,I),N=this.getCameraToCenterDistance(this.projection,I,M),Z=this.scaleZoom(N/(n*this.tileSize)),$=Math.abs(I-Z);$<b&&(b=$,v=I),I<Z?c=I:m=I}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,c){const m=Math.min(n.x,c.x),v=Math.max(n.x,c.x),b=Math.min(n.y,c.y),I=Math.max(n.y,c.y);if(b<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const M=[new a.Point(m,b),new a.Point(v,I),new a.Point(m,I),new a.Point(v,b)],N=this.renderWorldCopies?-3:0,Z=this.renderWorldCopies?4:1;for(const $ of M){const re=this.pointRayIntersection($);if(re.t<0)return!0;const Re=this.rayIntersectionCoordinate(re);if(Re.x<N||Re.y<0||Re.x>Z||Re.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.Point(0,0),new a.Point(this.width,this.height))}zoomDeltaToMovement(n,c){const m=a.length(a.sub([],this._camera.position,n)),v=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(v)}getCameraPoint(){if("globe"===this.projection.name){const n=function([c,m,v],b){const I=[c,m,v,1];a.transformMat4$1(I,I,b);const M=I[3]=Math.max(I[3],1e-6);return I[0]/=M,I[1]/=M,I[2]/=M,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.Point(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.Point(0,n))}}getCameraToCenterDistance(n,c=this.zoom,m=this.worldSize){const v=Pr(n,c,this.width,this.height,1024),b=n.pixelSpaceConversion(this.center.lat,m,v);return.5/Math.tan(.5*this._fov)*this.height*b}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&a.multiply(n,n,this.globeMatrix),n}}function hs(d,n){let c=!1,m=null;const v=()=>{m=null,c&&(d(),m=setTimeout(v,n),c=!1)};return()=>(c=!0,m||v(),m)}class $o{constructor(n){this._hashName=n&&encodeURIComponent(n),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=hs(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,a.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const c=fs(n);if(this._hashName){const m=this._hashName;let v=!1;const b=a.window.location.hash.slice(1).split("&").map(I=>{const M=I.split("=")[0];return M===m?(v=!0,`${M}=${c}`):I}).filter(I=>I);return v||b.push(`${m}=${c}`),`#${b.join("&")}`}return`#${c}`}_getCurrentHash(){const n=a.window.location.hash.replace("#","");if(this._hashName){let c;return n.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(m=>isNaN(m))){const m=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(c[3]||0):n.getBearing();return n.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:m,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,n)}}function fs(d,n){const c=d.getCenter(),m=Math.round(100*d.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,v),I=Math.round(c.lng*b)/b,M=Math.round(c.lat*b)/b,N=d.getBearing(),Z=d.getPitch();let $=n?`/${I}/${M}/${m}`:`${m}/${M}/${I}`;return(N||Z)&&($+="/"+Math.round(10*N)/10),Z&&($+=`/${Math.round(Z)}`),$}const Yo={linearity:.3,easing:a.bezier(0,0,.3,1)},Zs=a.extend({deceleration:2500,maxSpeed:1400},Yo),el=a.extend({deceleration:20,maxSpeed:1400},Yo),fi=a.extend({deceleration:1e3,maxSpeed:360},Yo),Gs=a.extend({deceleration:1e3,maxSpeed:90},Yo);class wc{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,c=a.exported.now();for(;n.length>0&&c-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new a.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)c.zoom+=b.zoomDelta||0,c.bearing+=b.bearingDelta||0,c.pitch+=b.pitchDelta||0,b.panDelta&&c.pan._add(b.panDelta),b.around&&(c.around=b.around),b.pinchAround&&(c.pinchAround=b.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(c.pan.mag()){const b=vl(c.pan.mag(),m,a.extend({},Zs,n||{}));v.offset=c.pan.mult(b.amount/c.pan.mag()),v.center=this._map.transform.center,nc(v,b)}if(c.zoom){const b=vl(c.zoom,m,el);v.zoom=this._map.transform.zoom+b.amount,nc(v,b)}if(c.bearing){const b=vl(c.bearing,m,fi);v.bearing=this._map.transform.bearing+a.clamp(b.amount,-179,179),nc(v,b)}if(c.pitch){const b=vl(c.pitch,m,Gs);v.pitch=this._map.transform.pitch+b.amount,nc(v,b)}if(v.zoom||v.bearing){const b=void 0===c.pinchAround?c.around:c.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function nc(d,n){(!d.duration||d.duration<n.duration)&&(d.duration=n.duration,d.easing=n.easing)}function vl(d,n,c){const{maxSpeed:m,linearity:v,deceleration:b}=c,I=a.clamp(d*v/(n/1e3),-m,m),M=Math.abs(I)/(b*v);return{easing:c.easing,duration:1e3*M,amount:I*(M/2)}}class Fo extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,m,v={}){const b=de(c.getCanvasContainer(),m),I=c.unproject(b);super(n,a.extend({point:b,lngLat:I,originalEvent:m},v)),this._defaultPrevented=!1,this.target=c}}class ps extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,m){const v="touchend"===n?m.changedTouches:m.touches,b=Pe(c.getCanvasContainer(),v),I=b.map(N=>c.unproject(N)),M=b.reduce((N,Z,$,re)=>N.add(Z.div(re.length)),new a.Point(0,0));super(n,{points:b,point:M,lngLats:I,lngLat:c.unproject(M),originalEvent:m}),this._defaultPrevented=!1}}class Oa extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,m){super(n,{originalEvent:m}),this._defaultPrevented=!1}}class ic{constructor(n,c){this._map=n,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Oa(n.type,this._map,n))}mousedown(n,c){return this._mousedownPos=c,this._firePreventable(new Fo(n.type,this._map,n))}mouseup(n){this._map.fire(new Fo(n.type,this._map,n))}preclick(n){const c=a.extend({},n);c.type="preclick",this._map.fire(new Fo(c.type,this._map,c))}click(n,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Fo(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Fo(n.type,this._map,n))}mouseover(n){this._map.fire(new Fo(n.type,this._map,n))}mouseout(n){this._map.fire(new Fo(n.type,this._map,n))}touchstart(n){return this._firePreventable(new ps(n.type,this._map,n))}touchmove(n){this._map.fire(new ps(n.type,this._map,n))}touchend(n){this._map.fire(new ps(n.type,this._map,n))}touchcancel(n){this._map.fire(new ps(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jr{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Fo(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Fo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Fo(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Cc{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,c){this.isEnabled()&&n.shiftKey&&0===n.button&&(De(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(n,c){if(!this._active)return;const m=c,v=this._startPos,b=this._lastPos;if(!v||!b||b.equals(m)||!this._box&&m.dist(v)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=_e("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const I=Math.min(v.x,m.x),M=Math.max(v.x,m.x),N=Math.min(v.y,m.y),Z=Math.max(v.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${N}px)`,this._box.style.width=M-I+"px",this._box.style.height=Z-N+"px")})}mouseupWindow(n,c){if(!this._active)return;const m=this._startPos,v=c;if(m&&0===n.button){if(this.reset(),Ce(),m.x!==v.x||m.y!==v.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&27===n.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),me(),delete this._startPos,delete this._lastPos}_fireEvent(n,c){return this._map.fire(new a.Event(n,{originalEvent:c}))}}function tl(d,n){const c={};for(let m=0;m<d.length;m++)c[d[m].identifier]=n[m];return c}class Nr{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=n.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){const b=new a.Point(0,0);for(const I of v)b._add(I);return b.div(v.length)}(c),this.touches=tl(m,c)))}touchmove(n,c,m){if(this.aborted||!this.centroid)return;const v=tl(m,c);for(const b in this.touches){const I=v[b];(!I||I.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,c,m){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Kc{constructor(n){this.singleTap=new Nr(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,c,m){this.singleTap.touchstart(n,c,m)}touchmove(n,c,m){this.singleTap.touchmove(n,c,m)}touchend(n,c,m){const v=this.singleTap.touchend(n,c,m);if(v){const b=n.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(v)<30;if(b&&I||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class rc{constructor(){this._zoomIn=new Kc({numTouches:1,numTaps:2}),this._zoomOut=new Kc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,c,m){this._zoomIn.touchstart(n,c,m),this._zoomOut.touchstart(n,c,m)}touchmove(n,c,m){this._zoomIn.touchmove(n,c,m),this._zoomOut.touchmove(n,c,m)}touchend(n,c,m){const v=this._zoomIn.touchend(n,c,m),b=this._zoomOut.touchend(n,c,m);return v?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(v)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ya={0:1,2:2};class Zo{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,c){return!1}_move(n,c){return{}}mousedown(n,c){if(this._lastPoint)return;const m=Be(n);this._correctButton(n,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(n,c){const m=this._lastPoint;if(m)if(n.preventDefault(),null!=this._eventButton&&function(v,b){const I=ya[b];return void 0===v.buttons||(v.buttons&I)!==I}(n,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}mouseupWindow(n){this._lastPoint&&Be(n)===this._eventButton&&(this._moved&&Ce(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xc extends Zo{mousedown(n,c){super.mousedown(n,c),this._lastPoint&&(this._active=!0)}_correctButton(n,c){return 0===c&&!n.ctrlKey}_move(n,c){return{around:c,panDelta:c.sub(n)}}}class kl extends Zo{_correctButton(n,c){return 0===c&&n.ctrlKey||2===c}_move(n,c){const m=.8*(c.x-n.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(n){n.preventDefault()}}class Lu extends Zo{_correctButton(n,c){return 0===c&&n.ctrlKey||2===c}_move(n,c){const m=-.5*(c.y-n.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(n){n.preventDefault()}}class Hs{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.Point(0,0)}touchstart(n,c,m){return this._calculateTransform(n,c,m)}touchmove(n,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length&&!a.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,c,m)}}touchend(n,c,m){this._calculateTransform(n,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,c,m){m.length>0&&(this._active=!0);const v=tl(m,c),b=new a.Point(0,0),I=new a.Point(0,0);let M=0;for(const Z in v){const $=v[Z],re=this._touches[Z];re&&(b._add($),I._add($.sub(re)),M++,v[Z]=$)}if(this._touches=v,M<this._minTouches||!I.mag())return;const N=I.div(M);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:N}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=_e("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Fl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,c,m){return{}}touchstart(n,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(n,c,m){const v=this._firstTwoTouches;if(!v)return;n.preventDefault();const[b,I]=v,M=xl(m,c,b),N=xl(m,c,I);if(!M||!N)return;const Z=this._aroundCenter?null:M.add(N).div(2);return this._move([M,N],Z,n)}touchend(n,c,m){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,I=xl(m,c,v),M=xl(m,c,b);I&&M||(this._active&&Ce(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function xl(d,n,c){for(let m=0;m<d.length;m++)if(d[m].identifier===c)return n[m]}function oc(d,n){return Math.log(d/n)/Math.LN2}class ku extends Fl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,c){const m=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(oc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:oc(this._distance,m),pinchAround:c}}}function bl(d,n){return 180*d.angleWith(n)/Math.PI}class ms extends Fl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,c){const m=this._vector;if(this._vector=n[0].sub(n[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:bl(this._vector,m),pinchAround:c}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const c=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const v=bl(n,m);return Math.abs(v)<c}}function va(d){return Math.abs(d.y)>Math.abs(d.x)}class Ki extends Fl{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,va(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,c,m){const v=this._lastPoints;if(!v)return;const b=n[0].sub(v[0]),I=n[1].sub(v[1]);return this._map._cooperativeGestures&&!a.isFullscreen()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(b,I,m.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+I.y)/2*-.5})}gestureBeginsVertically(n,c,m){if(void 0!==this._valid)return this._valid;const v=n.mag()>=2,b=c.mag()>=2;if(!v&&!b)return;if(!v||!b)return null==this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const I=n.y>0==c.y>0;return va(n)&&va(c)&&I}}const Fu={panStep:100,bearingStep:15,pitchStep:10};class up{constructor(){const n=Fu;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let c=0,m=0,v=0,b=0,I=0;switch(n.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:n.shiftKey?m=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?m=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?v=1:(n.preventDefault(),I=-1);break;case 40:n.shiftKey?v=-1:(n.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:M=>{const N=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Qc,zoom:c?Math.round(N)+c*(n.shiftKey?2:1):N,bearing:M.getBearing()+m*this._bearingStep,pitch:M.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-I*this._panStep],center:M.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qc(d){return d*(2-d)}const Ec=4.000244140625;class Tc{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||a.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=n.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const m=a.exported.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==c&&c%Ec==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(v*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),n.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=n,this._delta-=c,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=de(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;"wheel"===this._type&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(0!==this._delta){const N="wheel"===this._type&&Math.abs(this._delta)>Ec?this._wheelZoomRate:this._defaultZoomRate;let Z=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&0!==Z&&(Z=1/Z);const $=c(),re=Math.pow(2,$),Re="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):re;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(Re*Z))),"wheel"===this._type&&(this._startZoom=$,this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:c(),v=this._startZoom,b=this._easing;let I,M=!1;if("wheel"===this._type&&v&&b){const N=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),Z=b(N);I=a.number(v,m,Z),N<1?this._frameId||(this._frameId=!0):M=!0}else I=m,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:I-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let c=a.ease;if(this._prevEase){const m=this._prevEase,v=(a.exported.now()-m.start)/m.duration,b=m.easing(v+.01)-m.easing(v),I=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-I*I);c=a.bezier(I,M,.25,1)}return this._prevEase={start:a.exported.now(),duration:n,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=_e("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class eu{constructor(n,c){this._clickZoom=n,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Co{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,c){return n.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(n.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xh{constructor(){this._tap=new Kc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,c,m){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(n,c,m))}touchmove(n,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=c[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,c,m)}touchend(n,c,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(n,c,m)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tu{constructor(n,c,m){this._el=n,this._mousePan=c,this._touchPan=m}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Td{constructor(n,c,m){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class bh{constructor(n,c,m,v){this._el=n,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const la=d=>d.zoom||d.drag||d.pitch||d.rotate;class Nn extends a.Event{}class Cr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,c){const m=a.sub([],c,n);this.radius=a.length(m[2]<0?a.div([],m,this.constants):[m[0],m[1],0])}projectRay(n){a.div(n,n,this.constants),a.normalize(n,n),a.mul$1(n,n,this.constants);const c=a.scale$2([],n,this.radius);if(c[2]>0){const m=a.scale$2([],[0,0,1],a.dot(c,[0,0,1])),v=a.scale$2([],a.normalize([],[c[0],c[1],0]),this.radius),b=a.add([],c,a.scale$2([],a.sub([],a.add([],v,m),c),2));c[0]=b[0],c[1]=b[1]}return c}}function Ws(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class xa{constructor(n,c){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wc(n),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Cr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),a.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[v,b,I]of this._listeners)v.addEventListener(b,v===a.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[n,c,m]of this._listeners)n.removeEventListener(c,n===a.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(n){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new ic(c,n));const v=c.boxZoom=new Cc(c,n);this._add("boxZoom",v);const b=new rc,I=new Co;c.doubleClickZoom=new eu(I,b),this._add("tapZoom",b),this._add("clickZoom",I);const M=new xh;this._add("tapDragZoom",M);const N=c.touchPitch=new Ki(c);this._add("touchPitch",N);const Z=new kl(n),$=new Lu(n);c.dragRotate=new Td(n,Z,$),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]);const re=new Xc(n),Re=new Hs(c,n);c.dragPan=new tu(m,re,Re),this._add("mousePan",re),this._add("touchPan",Re,["touchZoom","touchRotate"]);const Fe=new ms,et=new ku;c.touchZoomRotate=new bh(m,et,Fe,M),this._add("touchRotate",Fe,["touchPan","touchZoom"]),this._add("touchZoom",et,["touchPan","touchRotate"]),this._add("blockableMapEvent",new jr(c));const Qe=c.scrollZoom=new Tc(c,this);this._add("scrollZoom",Qe,["mousePan"]);const nt=c.keyboard=new up;this._add("keyboard",nt);for(const ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[ce]&&c[ce].enable(n[ce])}_add(n,c,m){this._handlers.push({handlerName:n,handler:c,allowed:m}),this._handlersById[n]=c}stop(n){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!la(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,c,m){for(const v in n)if(v!==m&&(!c||c.indexOf(v)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const c=[];for(const m of n)this._el.contains(m.target)&&c.push(m);return c}handleEvent(n,c){this._updatingCamera=!0;const m="renderFrame"===n.type,v=m?void 0:n,b={needsRenderFrame:!1},I={},M={},N=n.touches?this._getMapTouches(n.touches):void 0,Z=N?Pe(this._el,N):m?void 0:de(this._el,n);for(const{handlerName:Re,handler:Fe,allowed:et}of this._handlers){if(!Fe.isEnabled())continue;let Qe;this._blockedByActive(M,et,Re)?Fe.reset():Fe[c||n.type]&&(Qe=Fe[c||n.type](n,Z,N),this.mergeHandlerResult(b,I,Qe,Re,v),Qe&&Qe.needsRenderFrame&&this._triggerRenderFrame()),(Qe||Fe.isActive())&&(M[Re]=Fe)}const $={};for(const Re in this._previousActiveHandlers)M[Re]||($[Re]=v);this._previousActiveHandlers=M,(Object.keys($).length||Ws(b))&&(this._changes.push([b,I,$]),this._triggerRenderFrame()),(Object.keys(M).length||Ws(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:re}=b;re&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],re(this._map))}mergeHandlerResult(n,c,m,v,b){if(!m)return;a.extend(n,m);const I={handlerName:v,originalEvent:m.originalEvent||b};void 0!==m.zoomDelta&&(c.zoom=I),void 0!==m.panDelta&&(c.drag=I),void 0!==m.pitchDelta&&(c.pitch=I),void 0!==m.bearingDelta&&(c.rotate=I)}_applyChanges(){const n={},c={},m={};for(const[v,b,I]of this._changes)v.panDelta&&(n.panDelta=(n.panDelta||new a.Point(0,0))._add(v.panDelta)),v.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(n.around=v.around),void 0!==v.aroundCoord&&(n.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(n.pinchAround=v.pinchAround),v.noInertia&&(n.noInertia=v.noInertia),a.extend(c,b),a.extend(m,I);this._updateMapTransform(n,c,m),this._changes=[]}_updateMapTransform(n,c,m){const v=this._map,b=v.transform,I=We=>[We.x,We.y,We.z];if((We=>{const pt=this._eventsInProgress.drag;return pt&&!this._handlersById[pt.handlerName].isActive()})()&&!Ws(n)){const We=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",We!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&v._stop(!0),!Ws(n))return void this._fireEvents(c,m,!0);let{panDelta:M,zoomDelta:N,bearingDelta:Z,pitchDelta:$,around:re,aroundCoord:Re,pinchAround:Fe}=n;b._isCameraConstrained&&(N>0&&(N=0),b._isCameraConstrained=!1),void 0!==Fe&&(re=Fe),(N||(We=>c.drag&&!this._eventsInProgress.drag)())&&re&&(this._dragOrigin=I(b.pointCoordinate3D(re)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),re=re||v.transform.centerPoint,Z&&(b.bearing+=Z),$&&(b.pitch+=$),b._updateCameraState();const et=[0,0,0];if(M)if("mercator"===b.projection.name){const We=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(re).dir),pt=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(re.sub(M)).dir);et[0]=pt[0]-We[0],et[1]=pt[1]-We[1]}else{const We=b.pointCoordinate(re);if("globe"===b.projection.name){M=M.rotate(-b.angle);const pt=b._pixelsPerMercatorPixel/b.worldSize;et[0]=-M.x*a.mercatorScale(a.latFromMercatorY(We.y))*pt,et[1]=-M.y*a.mercatorScale(b.center.lat)*pt}else{const pt=b.pointCoordinate(re.sub(M));We&&pt&&(et[0]=pt.x-We.x,et[1]=pt.y-We.y)}}const Qe=b.zoom,nt=[0,0,0];if(N){const We=I(Re||b.pointCoordinate3D(re)),pt={dir:a.normalize([],a.sub([],We,b._camera.position))};if(pt.dir[2]<0){const gt=b.zoomDeltaToMovement(We,N);a.scale$2(nt,pt.dir,gt)}}const ce=a.add(et,et,nt);b._translateCameraConstrained(ce),N&&Math.abs(b.zoom-Qe)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(c,m,!0)}_fireEvents(n,c,m){const v=la(this._eventsInProgress),b=la(n),I={};for(const $ in n){const{originalEvent:re}=n[$];this._eventsInProgress[$]||(I[`${$}start`]=re),this._eventsInProgress[$]=n[$]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const $ in I)this._fireEvent($,I[$]);b&&this._fireEvent("move",b.originalEvent);for(const $ in n){const{originalEvent:re}=n[$];this._fireEvent($,re)}const M={};let N;for(const $ in this._eventsInProgress){const{handlerName:re,originalEvent:Re}=this._eventsInProgress[$];this._handlersById[re].isActive()||(delete this._eventsInProgress[$],N=c[re]||Re,M[`${$}end`]=N)}for(const $ in M)this._fireEvent($,M[$]);const Z=la(this._eventsInProgress);if(m&&(v||b)&&!Z){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),re=Re=>0!==Re&&-this._bearingSnap<Re&&Re<this._bearingSnap;$?(re($.bearing||this._map.getBearing())&&($.bearing=0),this._map.easeTo($,{originalEvent:N})):(this._map.fire(new a.Event("moveend",{originalEvent:N})),re(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,c){this._map.fire(new a.Event(n,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Nn("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Er="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class sc extends a.Evented{constructor(n,c){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=!1!==c.respectPrefersReducedMotion,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,c){return this.jumpTo({center:n},c)}panBy(n,c,m){return n=a.Point.convert(n).mult(-1),this.panTo(this.transform.center,a.extend({offset:n},c),m)}panTo(n,c,m){return this.easeTo(a.extend({center:n},c),m)}getZoom(){return this.transform.zoom}setZoom(n,c){return this.jumpTo({zoom:n},c),this}zoomTo(n,c,m){return this.easeTo(a.extend({zoom:n},c),m)}zoomIn(n,c){return this.zoomTo(this.getZoom()+1,n,c),this}zoomOut(n,c){return this.zoomTo(this.getZoom()-1,n,c),this}getBearing(){return this.transform.bearing}setBearing(n,c){return this.jumpTo({bearing:n},c),this}getPadding(){return this.transform.padding}setPadding(n,c){return this.jumpTo({padding:n},c),this}rotateTo(n,c,m){return this.easeTo(a.extend({bearing:n},c),m)}resetNorth(n,c){return this.rotateTo(0,a.extend({duration:1e3},n),c),this}resetNorthPitch(n,c){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},n),c),this}snapToNorth(n,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,c):this}getPitch(){return this.transform.pitch}setPitch(n,c){return this.jumpTo({pitch:n},c),this}cameraForBounds(n,c){n=a.LngLatBounds.convert(n);const m=c&&c.bearing||0,v=c&&c.pitch||0,b=n.getNorthWest(),I=n.getSouthEast();return this._cameraForBounds(this.transform,b,I,m,v,c)}_extendCameraOptions(n){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=a.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const m=n.padding;n.padding={top:m,bottom:m,right:m,left:m}}return n.padding=a.extend(c,n.padding),n}_minimumAABBFrustumDistance(n,c){const m=c.max[0]-c.min[0],v=c.max[1]-c.min[1];return m/v>n.aspect?m/(2*Math.tan(.5*n.fovX)*n.aspect):v/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,c,m,v,b,I){const M=n.clone(),N=this._extendCameraOptions(I);M.bearing=v,M.pitch=b;const Z=a.LngLat.convert(c),$=a.LngLat.convert(m),re=.5*(Z.lat+$.lat),Re=.5*(Z.lng+$.lng),Fe=a.latLngToECEF(re,Re),et=a.normalize([],Fe),Qe=a.normalize([],a.cross([],et,[0,1,0])),nt=a.cross([],Qe,et),ce=[Qe[0],Qe[1],Qe[2],0,nt[0],nt[1],nt[2],0,et[0],et[1],et[2],0,0,0,0,1],We=[Fe,a.latLngToECEF(Z.lat,Z.lng),a.latLngToECEF($.lat,Z.lng),a.latLngToECEF($.lat,$.lng),a.latLngToECEF(Z.lat,$.lng),a.latLngToECEF(re,Z.lng),a.latLngToECEF(re,$.lng),a.latLngToECEF(Z.lat,Re),a.latLngToECEF($.lat,Re)];let pt=a.Aabb.fromPoints(We.map(jn=>[a.dot(Qe,jn),a.dot(nt,jn),a.dot(et,jn)]));const gt=a.transformMat4([],pt.center,ce);0===a.squaredLength(gt)&&a.set(gt,0,0,1),a.normalize(gt,gt),a.scale$2(gt,gt,a.GLOBE_RADIUS),M.center=a.ecefToLatLng(gt);const Pt=M.getWorldToCameraMatrix(),Ft=a.invert(new Float64Array(16),Pt);pt=a.Aabb.applyTransform(pt,a.multiply([],Pt,ce)),a.transformMat4(gt,gt,Pt);const Rt=.5*(pt.max[2]-pt.min[2]),qt=this._minimumAABBFrustumDistance(M,pt),Wt=a.scale$2([],[0,0,1],Rt),an=a.add(Wt,gt,Wt),Yn=qt+(0===M.pitch?0:a.distance(gt,an)),tn=M.globeCenterInViewSpace,Pn=a.sub([],gt,[tn[0],tn[1],tn[2]]);a.normalize(Pn,Pn),a.scale$2(Pn,Pn,Yn);const dn=a.add([],gt,Pn);a.transformMat4(dn,dn,Ft);const Zn=a.earthRadius/a.GLOBE_RADIUS,ln=a.length(dn),An=a.mercatorZfromAltitude(Math.max(ln*Zn-a.earthRadius,Number.EPSILON),0),Qn=Math.min(M.zoomFromMercatorZAdjusted(An),N.maxZoom);return Qn>.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(M.setProjection({name:"mercator"}),M.zoom=Qn,this._cameraForBounds(M,c,m,v,b,I)):{center:M.center,zoom:Qn,bearing:v,pitch:b}}queryTerrainElevation(n,c){const m=this.transform.elevation;return m?(c=a.extend({},{exaggerated:!0},c),m.getAtPoint(a.MercatorCoordinate.fromLngLat(n),null,c.exaggerated)):null}_cameraForBounds(n,c,m,v,b,I){if("globe"===n.projection.name)return this._cameraForBoundsOnGlobe(n,c,m,v,b,I);const M=n.clone(),N=this._extendCameraOptions(I),Z=M.padding;M.bearing=v,M.pitch=b;const $=a.LngLat.convert(c),re=a.LngLat.convert(m),Re=new a.LngLat($.lng,re.lat),Fe=new a.LngLat(re.lng,$.lat),et=M.project($),Qe=M.project(re),nt=this.queryTerrainElevation($),ce=this.queryTerrainElevation(re),We=this.queryTerrainElevation(Re),pt=this.queryTerrainElevation(Fe),gt=[[et.x,et.y,Math.min(nt||0,ce||0,We||0,pt||0)],[Qe.x,Qe.y,Math.max(nt||0,ce||0,We||0,pt||0)]];let Pt=a.Aabb.fromPoints(gt);const Ft=M.getWorldToCameraMatrix(),Rt=a.invert(new Float64Array(16),Ft);Pt=a.Aabb.applyTransform(Pt,Ft);const qt=a.sub([],Pt.max,Pt.min),Wt=Z.left||0,an=Z.right||0,Yn=Z.bottom||0,tn=Z.top||0,{left:Pn,right:dn,top:Zn,bottom:ln}=N.padding,An=.5*(Wt+an),Qn=.5*(tn+Yn),jn=Math.min(M.scaleZoom(M.scale*Math.min((M.width-(Wt+an+Pn+dn))/qt[0],(M.height-(Yn+tn+ln+Zn))/qt[1])),N.maxZoom),ei=M.scale/M.zoomScale(jn);Pt=new a.Aabb([Pt.min[0]-(Pn+An)*ei,Pt.min[1]-(ln+Qn)*ei,Pt.min[2]],[Pt.max[0]+(dn+An)*ei,Pt.max[1]+(Zn+Qn)*ei,Pt.max[2]]);const Ai=.5*qt[2],Ji=this._minimumAABBFrustumDistance(M,Pt),wi=[0,0,1,0];a.transformMat4$1(wi,wi,Ft),a.normalize$2(wi,wi);const Si=a.scale$2([],wi,Ji+Ai),fr=a.add([],Pt.center,Si),tr=("number"==typeof N.offset.x&&"number"==typeof N.offset.y?new a.Point(N.offset.x,N.offset.y):a.Point.convert(N.offset)).rotate(-a.degToRad(v));Pt.center[0]-=tr.x*ei,Pt.center[1]+=tr.y*ei,a.transformMat4(Pt.center,Pt.center,Rt),a.transformMat4(fr,fr,Rt);const Di=[Pt.center[0],Pt.center[1],fr[2]*M.pixelsPerMeter];a.scale$2(Di,Di,1/M.worldSize);const Dr=a.lngFromMercatorX(Di[0]),Qr=a.latFromMercatorY(Di[1]),Vr=Math.min(M._zoomFromMercatorZ(Di[2]),N.maxZoom),$r=new a.LngLat(Dr,Qr);return M.mercatorFromTransition&&Vr<.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(M.setProjection({name:"globe"}),M.zoom=Vr,this._cameraForBounds(M,c,m,v,b,I)):{center:$r,zoom:Vr,bearing:v,pitch:b}}fitBounds(n,c,m){const v=this.cameraForBounds(n,c);return this._fitInternal(v,c,m)}fitScreenCoordinates(n,c,m,v,b){const I=a.Point.convert(n),M=a.Point.convert(c),N=new a.Point(Math.min(I.x,M.x),Math.min(I.y,M.y)),Z=new a.Point(Math.max(I.x,M.x),Math.max(I.y,M.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(I,M))return this;const $=this.transform.pointLocation3D(N),re=this.transform.pointLocation3D(Z),Re=this.transform.pointLocation3D(new a.Point(N.x,Z.y)),Fe=this.transform.pointLocation3D(new a.Point(Z.x,N.y)),et=[Math.min($.lng,re.lng,Re.lng,Fe.lng),Math.min($.lat,re.lat,Re.lat,Fe.lat)],Qe=[Math.max($.lng,re.lng,Re.lng,Fe.lng),Math.max($.lat,re.lat,Re.lat,Fe.lat)],nt=v&&v.pitch?v.pitch:this.getPitch(),ce=this._cameraForBounds(this.transform,et,Qe,m,nt,v);return this._fitInternal(ce,v,b)}_fitInternal(n,c,m){return n?(delete(c=a.extend(n,c)).padding,c.linear?this.easeTo(c,m):this.flyTo(c,m)):this}jumpTo(n,c){this.stop();const m=n.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,I=!1;return"zoom"in n&&m.zoom!==+n.zoom&&(v=!0,m.zoom=+n.zoom),void 0!==n.center&&(m.center=a.LngLat.convert(n.center)),"bearing"in n&&m.bearing!==+n.bearing&&(b=!0,m.bearing=+n.bearing),"pitch"in n&&m.pitch!==+n.pitch&&(I=!0,m.pitch=+n.pitch),null==n.padding||m.isPaddingEqual(n.padding)||(m.padding=n.padding),n.preloadOnly?(this._preloadTiles(m),this):(this.fire(new a.Event("movestart",c)).fire(new a.Event("move",c)),v&&this.fire(new a.Event("zoomstart",c)).fire(new a.Event("zoom",c)).fire(new a.Event("zoomend",c)),b&&this.fire(new a.Event("rotatestart",c)).fire(new a.Event("rotate",c)).fire(new a.Event("rotateend",c)),I&&this.fire(new a.Event("pitchstart",c)).fire(new a.Event("pitch",c)).fire(new a.Event("pitchend",c)),this.fire(new a.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(Er),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,c){const m=this.transform;if(!m.projection.supportsFreeCamera)return a.warnOnce(Er),this;this.stop();const v=m.zoom,b=m.pitch,I=m.bearing;m.setFreeCameraOptions(n);const M=v!==m.zoom,N=b!==m.pitch,Z=I!==m.bearing;return this.fire(new a.Event("movestart",c)).fire(new a.Event("move",c)),M&&this.fire(new a.Event("zoomstart",c)).fire(new a.Event("zoom",c)).fire(new a.Event("zoomend",c)),Z&&this.fire(new a.Event("rotatestart",c)).fire(new a.Event("rotate",c)).fire(new a.Event("rotateend",c)),N&&this.fire(new a.Event("pitchstart",c)).fire(new a.Event("pitch",c)).fire(new a.Event("pitchend",c)),this.fire(new a.Event("moveend",c)),this}easeTo(n,c){this._stop(!1,n.easeId),(!1===(n=a.extend({offset:[0,0],duration:500,easing:a.ease},n)).animate||this._prefersReducedMotion(n))&&(n.duration=0);const m=this.transform,v=this.getZoom(),b=this.getBearing(),I=this.getPitch(),M=this.getPadding(),N="zoom"in n?+n.zoom:v,Z="bearing"in n?this._normalizeBearing(n.bearing,b):b,$="pitch"in n?+n.pitch:I,re="padding"in n?n.padding:m.padding,Re=a.Point.convert(n.offset);let Fe,et,Qe;if("globe"===m.projection.name){const Wt=a.MercatorCoordinate.fromLngLat(m.center),an=Re.rotate(-m.angle);Wt.x+=an.x/m.worldSize,Wt.y+=an.y/m.worldSize;const Yn=Wt.toLngLat(),tn=a.LngLat.convert(n.center||Yn);this._normalizeCenter(tn),Fe=m.centerPoint.add(an),et=new a.Point(Wt.x,Wt.y).mult(m.worldSize),Qe=new a.Point(a.mercatorXfromLng(tn.lng),a.mercatorYfromLat(tn.lat)).mult(m.worldSize).sub(et)}else{Fe=m.centerPoint.add(Re);const Wt=m.pointLocation(Fe),an=a.LngLat.convert(n.center||Wt);this._normalizeCenter(an),et=m.project(Wt),Qe=m.project(an).sub(et)}const nt=m.zoomScale(N-v);let ce,We;n.around&&(ce=a.LngLat.convert(n.around),We=m.locationPoint(ce));const pt=this._zooming||N!==v,gt=this._rotating||b!==Z,Pt=this._pitching||$!==I,Ft=!m.isPaddingEqual(re),Rt=Wt=>an=>{if(pt&&(Wt.zoom=a.number(v,N,an)),gt&&(Wt.bearing=a.number(b,Z,an)),Pt&&(Wt.pitch=a.number(I,$,an)),Ft&&(Wt.interpolatePadding(M,re,an),Fe=Wt.centerPoint.add(Re)),ce)Wt.setLocationAtPoint(ce,We);else{const Yn=Wt.zoomScale(Wt.zoom-v),tn=N>v?Math.min(2,nt):Math.max(.5,nt),Pn=Math.pow(tn,1-an),dn=Wt.unproject(et.add(Qe.mult(an*Pn)).mult(Yn));Wt.setLocationAtPoint(Wt.renderWorldCopies?dn.wrap():dn,Fe)}return n.preloadOnly||this._fireMoveEvents(c),Wt};if(n.preloadOnly){const Wt=this._emulate(Rt,n.duration,m);return this._preloadTiles(Wt),this}const qt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pt,this._rotating=gt,this._pitching=Pt,this._padding=Ft,this._easeId=n.easeId,this._prepareEase(c,n.noMoveStart,qt),this._ease(Rt(m),Wt=>{m.recenterOnTerrain(),this._afterEase(c,Wt)},n),this}_prepareEase(n,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||m.moving||this.fire(new a.Event("movestart",n)),this._zooming&&!m.zooming&&this.fire(new a.Event("zoomstart",n)),this._rotating&&!m.rotating&&this.fire(new a.Event("rotatestart",n)),this._pitching&&!m.pitching&&this.fire(new a.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new a.Event("move",n)),this._zooming&&this.fire(new a.Event("zoom",n)),this._rotating&&this.fire(new a.Event("rotate",n)),this._pitching&&this.fire(new a.Event("pitch",n))}_afterEase(n,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new a.Event("zoomend",n)),v&&this.fire(new a.Event("rotateend",n)),b&&this.fire(new a.Event("pitchend",n)),this.fire(new a.Event("moveend",n))}flyTo(n,c){if(this._prefersReducedMotion(n)){const jn=a.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(jn,c)}this.stop(),n=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},n);const m=this.transform,v=this.getZoom(),b=this.getBearing(),I=this.getPitch(),M=this.getPadding(),N="zoom"in n?a.clamp(+n.zoom,m.minZoom,m.maxZoom):v,Z="bearing"in n?this._normalizeBearing(n.bearing,b):b,$="pitch"in n?+n.pitch:I,re="padding"in n?n.padding:m.padding,Re=m.zoomScale(N-v),Fe=a.Point.convert(n.offset);let et=m.centerPoint.add(Fe);const Qe=m.pointLocation(et),nt=a.LngLat.convert(n.center||Qe);this._normalizeCenter(nt);const ce=m.project(Qe),We=m.project(nt).sub(ce);let pt=n.curve;const gt=Math.max(m.width,m.height),Pt=gt/Re,Ft=We.mag();if("minZoom"in n){const jn=a.clamp(Math.min(n.minZoom,v,N),m.minZoom,m.maxZoom),ei=gt/m.zoomScale(jn-v);pt=Math.sqrt(ei/Ft*2)}const Rt=pt*pt;function qt(jn){const ei=(Pt*Pt-gt*gt+(jn?-1:1)*Rt*Rt*Ft*Ft)/(2*(jn?Pt:gt)*Rt*Ft);return Math.log(Math.sqrt(ei*ei+1)-ei)}function Wt(jn){return(Math.exp(jn)-Math.exp(-jn))/2}function an(jn){return(Math.exp(jn)+Math.exp(-jn))/2}const Yn=qt(0);let tn=function(jn){return an(Yn)/an(Yn+pt*jn)},Pn=function(jn){return gt*((an(Yn)*(Wt(ei=Yn+pt*jn)/an(ei))-Wt(Yn))/Rt)/Ft;var ei},dn=(qt(1)-Yn)/pt;if(Math.abs(Ft)<1e-6||!isFinite(dn)){if(Math.abs(gt-Pt)<1e-6)return this.easeTo(n,c);const jn=Pt<gt?-1:1;dn=Math.abs(Math.log(Pt/gt))/pt,Pn=function(){return 0},tn=function(ei){return Math.exp(jn*pt*ei)}}n.duration="duration"in n?+n.duration:1e3*dn/("screenSpeed"in n?+n.screenSpeed/pt:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const Zn=b!==Z,ln=$!==I,An=!m.isPaddingEqual(re),Qn=jn=>ei=>{const Ai=ei*dn,Ji=1/tn(Ai);jn.zoom=1===ei?N:v+jn.scaleZoom(Ji),Zn&&(jn.bearing=a.number(b,Z,ei)),ln&&(jn.pitch=a.number(I,$,ei)),An&&(jn.interpolatePadding(M,re,ei),et=jn.centerPoint.add(Fe));const wi=1===ei?nt:jn.unproject(ce.add(We.mult(Pn(Ai))).mult(Ji));return jn.setLocationAtPoint(jn.renderWorldCopies?wi.wrap():wi,et),jn._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(c),jn};if(n.preloadOnly){const jn=this._emulate(Qn,n.duration,m);return this._preloadTiles(jn),this}return this._zooming=!0,this._rotating=Zn,this._pitching=ln,this._padding=An,this._prepareEase(c,!1),this._ease(Qn(m),()=>this._afterEase(c),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,c)}if(!n){const m=this.handlers;m&&m.stop(!1)}return this}_ease(n,c,m){!1===m.animate||0===m.duration?(n(1),c()):(this._easeStart=a.exported.now(),this._easeOptions=m,this._onEaseFrame=n,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,c){n=a.wrap(n,-180,180);const m=Math.abs(n-c);return Math.abs(n-360-c)<m&&(n-=360),Math.abs(n+360-c)<m&&(n+=360),n}_normalizeCenter(n){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const m=n.lng-c.center.lng;n.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&a.exported.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,c,m){const v=Math.ceil(15*c/1e3),b=[],I=n(m.clone());for(let M=0;M<=v;M++){const N=I(M/v);b.push(N.clone())}return b}}class yi{constructor(n={}){this.options=n,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const c=this.options&&this.options.compact;return this._map=n,this._container=_e("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=_e("button","mapboxgl-ctrl-attrib-button",this._container),_e("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=_e("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,c){const m=this._map._getUIString(`AttributionControl.${c}`);n.setAttribute("aria-label",m),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(n){const m=c.reduce((v,b,I)=>(b.value&&(v+=`${b.key}=${b.value}${I<c.length-1?"&":""}`),v),"?");n.href=`${a.config.FEEDBACK_URL}/${m}#${fs(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||"metadata"!==n.sourceDataType&&"visibility"!==n.sourceDataType&&"style"!==n.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const c=this._map.style._sourceCaches;for(const v in c){const b=c[v];if(b.used){const I=b.getSource();I.attribution&&n.indexOf(I.attribution)<0&&n.push(I.attribution)}}n.sort((v,b)=>v.length-b.length),n=n.filter((v,b)=>{for(let I=b+1;I<n.length;I++)if(n[I].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const m=n.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,n.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class qs{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=_e("div","mapboxgl-ctrl");const c=_e("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&"metadata"!==n.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(0===Object.entries(n).length)return!0;for(const c in n){const m=n[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const c=n[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class ac{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const c=++this._id;return this._queue.push({callback:n,id:c,cancelled:!1}),c}remove(n){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const v of m)if(v.id===n)return void(v.cancelled=!0)}run(n=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function nl(d,n,c){if(d=new a.LngLat(d.lng,d.lat),n){const m=new a.LngLat(d.lng-360,d.lat),v=new a.LngLat(d.lng+360,d.lat),b=360*Math.ceil(Math.abs(d.lng-c.center.lng)/360),I=c.locationPoint(d).distSqr(n),M=n.x<0||n.y<0||n.x>c.width||n.y>c.height;c.locationPoint(m).distSqr(n)<I&&(M||Math.abs(m.lng-c.center.lng)<b)?d=m:c.locationPoint(v).distSqr(n)<I&&(M||Math.abs(v.lng-c.center.lng)<b)&&(d=v)}for(;Math.abs(d.lng-c.center.lng)>180;){const m=c.locationPoint(d);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;d.lng>c.center.lng?d.lng-=360:d.lng+=360}return d}const wl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class pi extends a.Evented{constructor(n,c){if(super(),(n instanceof a.window.HTMLElement||c)&&(n=a.extend({element:n},c)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=a.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=_e("div");const v=41,b=27,I=Le("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),M=Le("radialGradient",{id:"shadowGradient"},Le("defs",{},I));Le("stop",{offset:"10%","stop-opacity":.4},M),Le("stop",{offset:"100%","stop-opacity":.05},M),Le("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),Le("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),Le("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),Le("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=a.Point.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const m=this._element.classList;for(const v in wl)m.remove(`mapboxgl-marker-anchor-${v}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=a.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(24.6+v)],"bottom-right":[-v,-1*(24.6+v)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const c=n.code,m=n.charCode||n.keyCode;"Space"!==c&&"Enter"!==c&&32!==m&&13!==m||this.togglePopup()}_onMapClick(n){const c=n.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,c=this._pos;if(!n||!c)return!1;const m=n.unproject(c),v=n.getFreeCameraOptions();if(!v.position)return!1;const b=v.position.toLngLat();return b.distanceTo(m)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const c=this._pos;if(!c||c.x<0||c.x>n.transform.width||c.y<0||c.y>n.transform.height)return void this._clearFadeTimer();const m=n.unproject(c);let v;n._showingGlobe()&&a.isLngLatBehindGlobe(n.transform,this._lngLat)?v=0:(v=1-n._queryFogOpacity(m),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${n.x}px,${n.y}px)\n            ${wl[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${c.x}px,${c.y}px)\n        `}_calculateXYTransform(){const n=this._pos,c=this._map,m=this.getPitchAlignment();if(!c||!n||"map"!==m)return"";if(!c._showingGlobe()){const N=c.getPitch();return N?`rotateX(${N}deg)`:""}const v=a.radToDeg(a.globeTiltAtLngLat(c.transform,this._lngLat)),b=n.sub(a.globeCenterToScreenPoint(c.transform)),I=Math.abs(b.x)+Math.abs(b.y);if(0===I)return"";const M=v/I;return`rotateX(${-b.y*M}deg) rotateY(${b.x*M}deg)`}_calculateZTransform(){const n=this._pos,c=this._map;if(!c||!n)return"";let m=0;const v=this.getRotationAlignment();if("map"===v)if(c._showingGlobe()){const b=c.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),I=c.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);m=a.radToDeg(Math.atan2(I.y,I.x))-90}else m=-c.getBearing();else if("horizon"===v){const b=a.smoothstep(4,6,c.getZoom()),I=a.globeCenterToScreenPoint(c.transform);I.y+=b*c.transform.height;const M=n.sub(I),N=a.radToDeg(Math.atan2(M.y,M.x));m=(N>90?N-270:N+90)*(1-b)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(n){a.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=nl(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),!0===n?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=a.Point.convert(n),this._update(),this}_onMove(n){const c=this._map;if(!c)return;const m=this._pointerdownPos,v=this._positionDelta;if(m&&v){if(!this._isDragging){const b=this._clickTolerance||c._clickTolerance;if(n.point.dist(m)<b)return;this._isDragging=!0}this._pos=n.point.sub(v),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(n){const c=this._map,m=this._pos;c&&m&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(m),this._pointerdownPos=n.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const c=this._map;return c&&(n?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const lc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},os=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ra(d=new a.Point(0,0),n="bottom"){if("number"==typeof d){const c=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(n){case"top":return new a.Point(0,d);case"top-left":return new a.Point(c,c);case"top-right":return new a.Point(-c,c);case"bottom":return new a.Point(0,-d);case"bottom-left":return new a.Point(c,-c);case"bottom-right":return new a.Point(-c,-c);case"left":return new a.Point(d,0);case"right":return new a.Point(-d,0)}return new a.Point(0,0)}return d instanceof a.Point||Array.isArray(d)?a.Point.convert(d):a.Point.convert(d[n]||[0,0])}class nu{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const c=a.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,c,m){this._start=this.getValue(c),this._end=n,this._startTime=c,this._endTime=c+m}}const ba={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},La={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},wh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Dd{constructor(n,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new kl({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,m&&(this.mousePitch=new Lu({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(n,c){this.mouseRotate.mousedown(n,c),this.mousePitch&&this.mousePitch.mousedown(n,c),De()}move(n,c){const m=this.map,v=this.mouseRotate.mousemoveWindow(n,c),b=v&&v.bearingDelta;if(b&&m.setBearing(m.getBearing()+b),this.mousePitch){const I=this.mousePitch.mousemoveWindow(n,c),M=I&&I.pitchDelta;M&&m.setPitch(m.getPitch()+M)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){me(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(a.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),de(this.element,n)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,de(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){1!==n.targetTouches.length?this.reset():(this._startPos=this._lastPos=Pe(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){1!==n.targetTouches.length?this.reset():(this._lastPos=Pe(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){0===n.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const P={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},U={maxWidth:100,unit:"metric"},O={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},z={version:a.version,supported:K,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends sc{constructor(d){if(a.LivePerformanceUtils.mark(a.PerformanceMarkers.create),null!=(d=a.extend({},La,d)).minZoom&&null!=d.maxZoom&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=d.minPitch&&null!=d.maxPitch&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=d.minPitch&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=d.maxPitch&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(d.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new qo(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._useWebGL2=d.useWebGL2,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new ac,this._domRenderTaskQueue=new ac,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.uniqueId(),this._locale=a.extend({},ba,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new nu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new a.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,"string"==typeof d.container){if(this._container=a.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==a.window&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new xa(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new $o("string"==typeof d.hash&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,a.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new yi({customAttribution:d.customAttribution})),this._logoControl=new qs,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update("style"===n.dataType),this.fire(new a.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new a.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(d,n){if(void 0===n&&(n=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=d.onAdd(this);this._controls.push(d);const m=this._controlPositions[n];return-1!==n.indexOf("bottom")?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(d);return n>-1&&this._controls.splice(n,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new a.Event("movestart",d)).fire(new a.Event("move",d)),this.fire(new a.Event("resize",d)),n&&this.fire(new a.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(a.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return"auto"===d?a.window.navigator.language:Array.isArray(d)?0===d.length?void 0:d.map(n=>"auto"===n?a.window.navigator.language:n):d}setLanguage(d){const n=this._parseLanguage(d);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(d){return this._lazyInitEmptyStyle(),d?"string"==typeof d&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const d=this.transform,n=d.projection.name;let c;"globe"===n&&d.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(d.setMercatorFromTransition(),c=!0):"mercator"===n&&d.zoom<a.GLOBE_ZOOM_THRESHOLD_MAX&&(d.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,n){return this._updateProjection(d||n||{name:"mercator"})}_updateProjection(d){let n;if(n="globe"===d.name&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(d){return this.transform.locationPoint3D(a.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(a.Point.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,n,c){if("mouseenter"===d||"mouseover"===d){let m=!1;const v=I=>{const M=n.filter(Z=>this.getLayer(Z)),N=M.length?this.queryRenderedFeatures(I.point,{layers:M}):[];N.length?m||(m=!0,c.call(this,new Fo(d,this,I.originalEvent,{features:N}))):m=!1},b=()=>{m=!1};return{layers:new Set(n),listener:c,delegates:{mousemove:v,mouseout:b}}}if("mouseleave"===d||"mouseout"===d){let m=!1;const v=I=>{const M=n.filter(N=>this.getLayer(N));(M.length?this.queryRenderedFeatures(I.point,{layers:M}):[]).length?m=!0:m&&(m=!1,c.call(this,new Fo(d,this,I.originalEvent)))},b=I=>{m&&(m=!1,c.call(this,new Fo(d,this,I.originalEvent)))};return{layers:new Set(n),listener:c,delegates:{mousemove:v,mouseout:b}}}{const m=v=>{const b=n.filter(M=>this.getLayer(M)),I=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];I.length&&(v.features=I,c.call(this,v),delete v.features)};return{layers:new Set(n),listener:c,delegates:{[d]:m}}}}on(d,n,c){if(void 0===c)return super.on(d,n);Array.isArray(n)||(n=[n]);const m=this._createDelegatedListener(d,n,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(d,n,c){if(void 0===c)return super.once(d,n);Array.isArray(n)||(n=[n]);const m=this._createDelegatedListener(d,n,c);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(d,n,c){if(void 0===c)return super.off(d,n);n=new Set(Array.isArray(n)?n:[n]);const m=(b,I)=>{if(b.size!==I.size)return!1;for(const M of b)if(!I.has(M))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[d]:void 0;return v&&(b=>{for(let I=0;I<b.length;I++){const M=b[I];if(M.listener===c&&m(M.layers,n)){for(const N in M.delegates)this.off(N,M.delegates[N]);return b.splice(I,1),this}}})(v),this}queryRenderedFeatures(d,n){return this.style?(void 0!==n||void 0===d||d instanceof a.Point||Array.isArray(d)||(n=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(d,n){return this.style.querySourceFeatures(d,n)}isPointOnSurface(d){const{name:n}=this.transform.projection;return"globe"!==n&&"mercator"!==n&&a.warnOnce(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.Point.convert(d))}setStyle(d,n){return!1!==(n=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(d,n))}_getUIString(d){const n=this._locale[d];if(null==n)throw new Error(`Missing UI string '${d}'`);return n}_updateStyle(d,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new lo(this,n||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof d?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new lo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,n){if("string"==typeof d){const c=this._requestManager.normalizeStyleURL(d),m=this._requestManager.transformRequest(c,a.ResourceType.Style);a.getJSON(m,(v,b)=>{v?this.fire(new a.ErrorEvent(v)):b&&this._updateDiff(b,n)})}else"object"==typeof d&&this._updateDiff(d,n)}_updateDiff(d,n){try{this.style.setState(d)&&this._update(!0)}catch(c){a.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(d,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(d,n){return this._lazyInitEmptyStyle(),this.style.addSource(d,n),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const n in d){const c=d[n]._tiles;for(const m in c){const v=c[m];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}addSourceType(d,n,c){this._lazyInitEmptyStyle(),this.style.addSourceType(d,n,c)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,n,{pixelRatio:c=1,sdf:m=!1,stretchX:v,stretchY:b,content:I}={}){if(this._lazyInitEmptyStyle(),n instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&n instanceof a.window.ImageBitmap){const{width:M,height:N,data:Z}=a.exported.getImageData(n);this.style.addImage(d,{data:new a.RGBAImage({width:M,height:N},Z),pixelRatio:c,stretchX:v,stretchY:b,content:I,sdf:m,version:0})}else if(void 0===n.width||void 0===n.height)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:N}=n,Z=n;this.style.addImage(d,{data:new a.RGBAImage({width:M,height:N},new Uint8Array(Z.data)),pixelRatio:c,stretchX:v,stretchY:b,content:I,sdf:m,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,d)}}updateImage(d,n){const c=this.style.getImage(d);if(!c)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=n instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&n instanceof a.window.ImageBitmap?a.exported.getImageData(n):n,{width:v,height:b}=m;void 0!==v&&void 0!==b?v===c.data.width&&b===c.data.height?(c.data.replace(m.data,!(n instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&n instanceof a.window.ImageBitmap)),this.style.updateImage(d,c)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${v}, ${b})\n                must be that same as the previous version of the image\n                (${c.data.width}, ${c.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,n){a.getImage(this._requestManager.transformRequest(d,a.ResourceType.Image),(c,m)=>{n(c,m instanceof a.window.HTMLImageElement?a.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(d,n){return this._lazyInitEmptyStyle(),this.style.addLayer(d,n),this._update(!0)}moveLayer(d,n){return this.style.moveLayer(d,n),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,n,c){return this.style.setLayerZoomRange(d,n,c),this._update(!0)}setFilter(d,n,c={}){return this.style.setFilter(d,n,c),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,n,c,m={}){return this.style.setPaintProperty(d,n,c,m),this._update(!0)}getPaintProperty(d,n){return this.style.getPaintProperty(d,n)}setLayoutProperty(d,n,c,m={}){return this.style.setLayoutProperty(d,n,c,m),this._update(!0)}getLayoutProperty(d,n){return this.style.getLayoutProperty(d,n)}setLight(d,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(d),this.transform):0}setFeatureState(d,n){return this.style.setFeatureState(d,n),this._update()}removeFeatureState(d,n){return this.style.removeFeatureState(d,n),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let c,m,v,b=this._container;for(;b&&(!m||!v);){const I=a.window.getComputedStyle(b).transform;I&&"none"!==I&&(c=I.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&"0"!==c[0]&&"1"!==c[0]&&(m=c[0]),c[3]&&"0"!==c[3]&&"1"!==c[3]&&(v=c[3])),b=b.parentElement}this._containerWidth=m?Math.abs(d/m):d,this._containerHeight=v?Math.abs(n/v):n}_detectMissingCSS(){"rgb(250, 128, 114)"!==a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=_e("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=_e("div","mapboxgl-canvas-container",d);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=_e("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=_e("div","mapboxgl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=_e("div",`mapboxgl-ctrl-${v}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,n){const c=a.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(d),this._canvas.height=c*Math.ceil(n),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${n}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const n=this._markers.indexOf(d);-1!==n&&this._markers.splice(n,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const n=this._popups.indexOf(d);-1!==n&&this._popups.splice(n,1)}_setupPainter(){const d=a.extend({},K.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",d),c=n||this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);c?(this._useWebGL2&&!n&&a.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),a.storeAuthState(c,!0),this.painter=new fe(c,this.transform,!!n),this.on("data",m=>{"source"===m.dataType&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(c)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let n;const c=this.painter.context.extTimerQuery,m=a.exported.now();if(this.listens("gpu-timing-frame")&&(n=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],a.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],a.window.performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,N=this.transform.pitch,Z=a.exported.now(),$=new a.EvaluationParameters(M,{now:Z,fadeDuration:v,pitch:N,transition:this.style.getTransition()});this.style.update($)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const M=a.exported.now()-m;c.endQueryEXT(c.TIME_ELAPSED_EXT,n),setTimeout(()=>{const N=c.getQueryObjectEXT(n,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(n),this.fire(new a.Event("gpu-timing-frame",{cpuTime:M,gpuTime:N})),a.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:N}})},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const N=this.painter.queryGpuTimers(M);this.fire(new a.Event("gpu-timing-layer",{layerTimes:N}))},50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const N=this.painter.queryGpuTimeDeferredRender(M);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:N}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(I||this._repaint)this.triggerRepaint();else{const M=!this.isMoving()&&this.loaded();if(M&&(b=this._updateAverageElevation(m,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const N=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:N})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,a.LivePerformanceUtils.mark(a.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&a.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const n of this._markers)d&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!d||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(d,n=!1){const c=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((n||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const m=this.transform.averageElevation;let v=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=d;const I=Math.abs(m-v);if(I>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(v),c(v);this._averageElevation.easeTo(v,d,300)}else if(I>1e-4)return this._averageElevation.jumpTo(v),c(v)}return!!this._averageElevation.isEasing(d)&&c(this._averageElevation.getValue(d))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===a.AUTH_ERR_MSG||401===d.status)){const n=this.painter.context.gl;a.storeAuthState(n,!1),this._logoControl instanceof qs&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function v(b){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b,0);const I=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,I),I}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(v(d),n.canvasCopies.map(v),n.timeStamps)}_canvasPixelComparison(d,n,c){let m=c[1]-c[0];const v=d.length/4;for(let b=0;b<n.length;b++){const I=n[b];let M=0;for(let N=0;N<I.length;N+=4)I[N]===d[N]&&I[N+1]===d[N+1]&&I[N+2]===d[N+2]&&I[N+3]===d[N+3]&&(M+=1);m+=(c[b+2]-c[b+1])*(1-M/v)}return m}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==a.window&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1),a.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=a.exported.frame(n=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(n)}))}_preloadTiles(d){const n=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(n,(c,m)=>c._preloadTiles(d,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){"hidden"===a.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,n){a.setCacheLimits(d,n)}get version(){return a.version}},NavigationControl:class{constructor(d){this.options=a.extend({},wh,d),this._container=_e("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),_e("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),_e("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:n}):c.resetNorth({},{originalEvent:n}))}),this._compassIcon=_e("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const n=d.getZoom(),c=n===d.getMaxZoom(),m=n===d.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Dd(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,n){const c=_e("button",d,this._container);return c.type="button",c.addEventListener("click",n),c}_setButtonTitle(d,n){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${n}`);d.setAttribute("aria-label",c),d.firstElementChild&&d.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends a.Evented{constructor(d){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},P,d),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=hs(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=_e("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const n=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,d(c)};void 0!==this._supportsGeolocation?d(this._supportsGeolocation):void 0!==a.window.navigator.permissions?a.window.navigator.permissions.query({name:"geolocation"}).then(c=>n("denied"!==c.state)).catch(()=>n()):n()}_isOutOfMapMaxBounds(d){const n=this._map.getMaxBounds(),c=d.coords;return!!n&&(c.longitude<n.getWest()||c.longitude>n.getEast()||c.latitude<n.getSouth()||c.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(d),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",d)),this._finish()}}_updateCamera(d){const n=new a.LngLat(d.coords.longitude,d.coords.latitude),c=d.coords.accuracy,m=this._map.getBearing(),v=a.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(c),v,{geolocateSource:!0})}_updateMarker(d){if(d){const n=new a.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,n=a.mercatorZfromAltitude(1,d._center.lat)*d.worldSize,c=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(1===d.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===d.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=_e("button","mapboxgl-ctrl-geolocate",this._container),_e("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===d){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=_e("div","mapboxgl-user-location"),this._dotElement.appendChild(_e("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(_e("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new pi({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=_e("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new pi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n.originalEvent&&"resize"===n.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:!0===d.absolute&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==a.window.DeviceMotionEvent&&"function"==typeof a.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(n=>{"granted"===n&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:yi,ScaleControl:class{constructor(d){this.options=a.extend({},U,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,n=this._map,c=n._containerHeight/2,m=n._containerWidth/2-d/2,v=n.unproject([m,c]),b=n.unproject([m+d,c]),I=v.distanceTo(b);if("imperial"===this.options.unit){const M=3.2808*I;M>5280?this._setScale(d,M/5280,"mile"):this._setScale(d,M,"foot")}else"nautical"===this.options.unit?this._setScale(d,I/1852,"nautical-mile"):I>=1e3?this._setScale(d,I/1e3,"kilometer"):this._setScale(d,I,"meter")}_setScale(d,n,c){this._map._requestDomTask(()=>{const m=function(b){const I=Math.pow(10,`${Math.floor(b)}`.length-1);let M=b/I;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(N){const Z=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*Z)/Z}(M),I*M}(n),v=m/n;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==c?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(m):`${m}&nbsp;${O[c]}`,this._container.style.width=d*v+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=_e("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof a.window.HTMLElement?this._container=d.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=_e("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=_e("button","mapboxgl-ctrl-fullscreen",this._controlContainer);_e("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(d){super(),this.options=a.extend(Object.create(lc),d),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=a.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(a.window.document.createTextNode(d))}setHTML(d){const n=a.window.document.createDocumentFragment(),c=a.window.document.createElement("body");let m;for(c.innerHTML=d;m=c.firstChild,m;)n.appendChild(m);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=_e("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(d),this.options.closeButton){const c=this._closeButton=_e("button","mapboxgl-popup-close-button",n);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let n;return this._classList.delete(d)?n=!1:(this._classList.add(d),n=!0),this._updateClassList(),n}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const n=this._map,c=this._container,m=this._pos;if(!n||!c||!m)return"bottom";const v=c.offsetWidth,b=c.offsetHeight,I=m.x<v/2,M=m.x>n.transform.width-v/2;if(m.y+d<b)return I?"top-left":M?"top-right":"top";if(m.y>n.transform.height-b){if(I)return"bottom-left";if(M)return"bottom-right"}return I?"left":M?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),d.className=n.join(" ")}_update(d){const n=this._map,c=this._content;if(!n||!this._lngLat&&!this._trackPointer||!c)return;let m=this._container;if(m||(m=this._container=_e("div","mapboxgl-popup",n.getContainer()),this._tip=_e("div","mapboxgl-popup-tip",m),m.appendChild(c)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=nl(this._lngLat,this._pos,n.transform)),!this._trackPointer||d){const v=this._pos=this._trackPointer&&d?d:n.project(this._lngLat),b=Ra(this.options.offset),I=this._anchor=this._getAnchor(b.y),M=Ra(this.options.offset,I),N=v.add(M).round();n._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${wl[I]} translate(${N.x}px,${N.y}px)`)})}if(!this._marker&&n._showingGlobe()){const v=a.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(os);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:pi,Style:lo,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.Point,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:Ur,Evented:a.Evented,config:a.config,prewarm:function(){ho().acquire(yr)},clearPrewarmedResources:function(){const d=Fr;d&&(d.isPreloaded()&&1===d.numActive()?(d.release(yr),Fr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(d){a.config.ACCESS_TOKEN=d},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(d){a.config.API_URL=d},get workerCount(){return Ui.workerCount},set workerCount(d){Ui.workerCount=d},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){a.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){a.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return z}),h}()},5619:(zn,wt,S)=>{"use strict";S.d(wt,{X:()=>p});var h=S(8645);class p extends h.x{constructor(a){super(),this._value=a}get value(){return this.getValue()}_subscribe(a){const j=super._subscribe(a);return!j.closed&&a.next(this._value),j}getValue(){const{hasError:a,thrownError:j,_value:K}=this;if(a)throw j;return this._throwIfClosed(),K}next(a){super.next(this._value=a)}}},5592:(zn,wt,S)=>{"use strict";S.d(wt,{y:()=>oe});var h=S(305),p=S(7394),X=S(4850),a=S(8407),j=S(2653),K=S(4674),C=S(1441);let oe=(()=>{class Te{constructor(De){De&&(this._subscribe=De)}lift(De){const me=new Te;return me.source=this,me.operator=De,me}subscribe(De,me,Ye){const Ce=function ee(Te){return Te&&Te instanceof h.Lv||function Le(Te){return Te&&(0,K.m)(Te.next)&&(0,K.m)(Te.error)&&(0,K.m)(Te.complete)}(Te)&&(0,p.Nn)(Te)}(De)?De:new h.Hp(De,me,Ye);return(0,C.x)(()=>{const{operator:de,source:Pe}=this;Ce.add(de?de.call(Ce,Pe):Pe?this._subscribe(Ce):this._trySubscribe(Ce))}),Ce}_trySubscribe(De){try{return this._subscribe(De)}catch(me){De.error(me)}}forEach(De,me){return new(me=_e(me))((Ye,Ce)=>{const de=new h.Hp({next:Pe=>{try{De(Pe)}catch(Be){Ce(Be),de.unsubscribe()}},error:Ce,complete:Ye});this.subscribe(de)})}_subscribe(De){var me;return null===(me=this.source)||void 0===me?void 0:me.subscribe(De)}[X.L](){return this}pipe(...De){return(0,a.U)(De)(this)}toPromise(De){return new(De=_e(De))((me,Ye)=>{let Ce;this.subscribe(de=>Ce=de,de=>Ye(de),()=>me(Ce))})}}return Te.create=ye=>new Te(ye),Te})();function _e(Te){var ye;return null!==(ye=Te??j.config.Promise)&&void 0!==ye?ye:Promise}},8645:(zn,wt,S)=>{"use strict";S.d(wt,{x:()=>C});var h=S(5592),p=S(7394);const a=(0,S(2306).d)(_e=>function(){_e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var j=S(9039),K=S(1441);let C=(()=>{class _e extends h.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(ee){const Te=new oe(this,this);return Te.operator=ee,Te}_throwIfClosed(){if(this.closed)throw new a}next(ee){(0,K.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const Te of this.currentObservers)Te.next(ee)}})}error(ee){(0,K.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=ee;const{observers:Te}=this;for(;Te.length;)Te.shift().error(ee)}})}complete(){(0,K.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:ee}=this;for(;ee.length;)ee.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var ee;return(null===(ee=this.observers)||void 0===ee?void 0:ee.length)>0}_trySubscribe(ee){return this._throwIfClosed(),super._trySubscribe(ee)}_subscribe(ee){return this._throwIfClosed(),this._checkFinalizedStatuses(ee),this._innerSubscribe(ee)}_innerSubscribe(ee){const{hasError:Te,isStopped:ye,observers:De}=this;return Te||ye?p.Lc:(this.currentObservers=null,De.push(ee),new p.w0(()=>{this.currentObservers=null,(0,j.P)(De,ee)}))}_checkFinalizedStatuses(ee){const{hasError:Te,thrownError:ye,isStopped:De}=this;Te?ee.error(ye):De&&ee.complete()}asObservable(){const ee=new h.y;return ee.source=this,ee}}return _e.create=(Le,ee)=>new oe(Le,ee),_e})();class oe extends C{constructor(Le,ee){super(),this.destination=Le,this.source=ee}next(Le){var ee,Te;null===(Te=null===(ee=this.destination)||void 0===ee?void 0:ee.next)||void 0===Te||Te.call(ee,Le)}error(Le){var ee,Te;null===(Te=null===(ee=this.destination)||void 0===ee?void 0:ee.error)||void 0===Te||Te.call(ee,Le)}complete(){var Le,ee;null===(ee=null===(Le=this.destination)||void 0===Le?void 0:Le.complete)||void 0===ee||ee.call(Le)}_subscribe(Le){var ee,Te;return null!==(Te=null===(ee=this.source)||void 0===ee?void 0:ee.subscribe(Le))&&void 0!==Te?Te:p.Lc}}},305:(zn,wt,S)=>{"use strict";S.d(wt,{Hp:()=>Ye,Lv:()=>Te});var h=S(4674),p=S(7394),X=S(2653),a=S(3894),j=S(2420);const K=_e("C",void 0,void 0);function _e(Ne,Ae,Ge){return{kind:Ne,value:Ae,error:Ge}}var Le=S(7599),ee=S(1441);class Te extends p.w0{constructor(Ae){super(),this.isStopped=!1,Ae?(this.destination=Ae,(0,p.Nn)(Ae)&&Ae.add(this)):this.destination=Be}static create(Ae,Ge,lt){return new Ye(Ae,Ge,lt)}next(Ae){this.isStopped?Pe(function oe(Ne){return _e("N",Ne,void 0)}(Ae),this):this._next(Ae)}error(Ae){this.isStopped?Pe(function C(Ne){return _e("E",void 0,Ne)}(Ae),this):(this.isStopped=!0,this._error(Ae))}complete(){this.isStopped?Pe(K,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Ae){this.destination.next(Ae)}_error(Ae){try{this.destination.error(Ae)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ye=Function.prototype.bind;function De(Ne,Ae){return ye.call(Ne,Ae)}class me{constructor(Ae){this.partialObserver=Ae}next(Ae){const{partialObserver:Ge}=this;if(Ge.next)try{Ge.next(Ae)}catch(lt){Ce(lt)}}error(Ae){const{partialObserver:Ge}=this;if(Ge.error)try{Ge.error(Ae)}catch(lt){Ce(lt)}else Ce(Ae)}complete(){const{partialObserver:Ae}=this;if(Ae.complete)try{Ae.complete()}catch(Ge){Ce(Ge)}}}class Ye extends Te{constructor(Ae,Ge,lt){let ne;if(super(),(0,h.m)(Ae)||!Ae)ne={next:Ae??void 0,error:Ge??void 0,complete:lt??void 0};else{let Ee;this&&X.config.useDeprecatedNextContext?(Ee=Object.create(Ae),Ee.unsubscribe=()=>this.unsubscribe(),ne={next:Ae.next&&De(Ae.next,Ee),error:Ae.error&&De(Ae.error,Ee),complete:Ae.complete&&De(Ae.complete,Ee)}):ne=Ae}this.destination=new me(ne)}}function Ce(Ne){X.config.useDeprecatedSynchronousErrorHandling?(0,ee.O)(Ne):(0,a.h)(Ne)}function Pe(Ne,Ae){const{onStoppedNotification:Ge}=X.config;Ge&&Le.z.setTimeout(()=>Ge(Ne,Ae))}const Be={closed:!0,next:j.Z,error:function de(Ne){throw Ne},complete:j.Z}},7394:(zn,wt,S)=>{"use strict";S.d(wt,{Lc:()=>K,w0:()=>j,Nn:()=>C});var h=S(4674);const X=(0,S(2306).d)(_e=>function(ee){_e(this),this.message=ee?`${ee.length} errors occurred during unsubscription:\n${ee.map((Te,ye)=>`${ye+1}) ${Te.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=ee});var a=S(9039);class j{constructor(Le){this.initialTeardown=Le,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let Le;if(!this.closed){this.closed=!0;const{_parentage:ee}=this;if(ee)if(this._parentage=null,Array.isArray(ee))for(const De of ee)De.remove(this);else ee.remove(this);const{initialTeardown:Te}=this;if((0,h.m)(Te))try{Te()}catch(De){Le=De instanceof X?De.errors:[De]}const{_finalizers:ye}=this;if(ye){this._finalizers=null;for(const De of ye)try{oe(De)}catch(me){Le=Le??[],me instanceof X?Le=[...Le,...me.errors]:Le.push(me)}}if(Le)throw new X(Le)}}add(Le){var ee;if(Le&&Le!==this)if(this.closed)oe(Le);else{if(Le instanceof j){if(Le.closed||Le._hasParent(this))return;Le._addParent(this)}(this._finalizers=null!==(ee=this._finalizers)&&void 0!==ee?ee:[]).push(Le)}}_hasParent(Le){const{_parentage:ee}=this;return ee===Le||Array.isArray(ee)&&ee.includes(Le)}_addParent(Le){const{_parentage:ee}=this;this._parentage=Array.isArray(ee)?(ee.push(Le),ee):ee?[ee,Le]:Le}_removeParent(Le){const{_parentage:ee}=this;ee===Le?this._parentage=null:Array.isArray(ee)&&(0,a.P)(ee,Le)}remove(Le){const{_finalizers:ee}=this;ee&&(0,a.P)(ee,Le),Le instanceof j&&Le._removeParent(this)}}j.EMPTY=(()=>{const _e=new j;return _e.closed=!0,_e})();const K=j.EMPTY;function C(_e){return _e instanceof j||_e&&"closed"in _e&&(0,h.m)(_e.remove)&&(0,h.m)(_e.add)&&(0,h.m)(_e.unsubscribe)}function oe(_e){(0,h.m)(_e)?_e():_e.unsubscribe()}},2653:(zn,wt,S)=>{"use strict";S.d(wt,{config:()=>h});const h={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},2572:(zn,wt,S)=>{"use strict";S.d(wt,{a:()=>Le});var h=S(5592),p=S(7453),X=S(7715),a=S(2737),j=S(7400),K=S(4564),C=S(2714),oe=S(8251),_e=S(7103);function Le(...ye){const De=(0,K.yG)(ye),me=(0,K.jO)(ye),{args:Ye,keys:Ce}=(0,p.D)(ye);if(0===Ye.length)return(0,X.D)([],De);const de=new h.y(function ee(ye,De,me=a.y){return Ye=>{Te(De,()=>{const{length:Ce}=ye,de=new Array(Ce);let Pe=Ce,Be=Ce;for(let Ne=0;Ne<Ce;Ne++)Te(De,()=>{const Ae=(0,X.D)(ye[Ne],De);let Ge=!1;Ae.subscribe((0,oe.x)(Ye,lt=>{de[Ne]=lt,Ge||(Ge=!0,Be--),Be||Ye.next(me(de.slice()))},()=>{--Pe||Ye.complete()}))},Ye)},Ye)}}(Ye,De,Ce?Pe=>(0,C.n)(Ce,Pe):a.y));return me?de.pipe((0,j.Z)(me)):de}function Te(ye,De,me){ye?(0,_e.f)(me,ye,De):De()}},5211:(zn,wt,S)=>{"use strict";S.d(wt,{z:()=>j});var h=S(7537),X=S(4564),a=S(7715);function j(...K){return function p(){return(0,h.J)(1)}()((0,a.D)(K,(0,X.yG)(K)))}},4911:(zn,wt,S)=>{"use strict";S.d(wt,{P:()=>X});var h=S(5592),p=S(4829);function X(a){return new h.y(j=>{(0,p.Xf)(a()).subscribe(j)})}},6232:(zn,wt,S)=>{"use strict";S.d(wt,{E:()=>p});const p=new(S(5592).y)(j=>j.complete())},9315:(zn,wt,S)=>{"use strict";S.d(wt,{D:()=>oe});var h=S(5592),p=S(7453),X=S(4829),a=S(4564),j=S(8251),K=S(7400),C=S(2714);function oe(..._e){const Le=(0,a.jO)(_e),{args:ee,keys:Te}=(0,p.D)(_e),ye=new h.y(De=>{const{length:me}=ee;if(!me)return void De.complete();const Ye=new Array(me);let Ce=me,de=me;for(let Pe=0;Pe<me;Pe++){let Be=!1;(0,X.Xf)(ee[Pe]).subscribe((0,j.x)(De,Ne=>{Be||(Be=!0,de--),Ye[Pe]=Ne},()=>Ce--,void 0,()=>{(!Ce||!Be)&&(de||De.next(Te?(0,C.n)(Te,Ye):Ye),De.complete())}))}});return Le?ye.pipe((0,K.Z)(Le)):ye}},7715:(zn,wt,S)=>{"use strict";S.d(wt,{D:()=>lt});var h=S(4829),p=S(7103),X=S(9360),a=S(8251);function j(ne,Ee=0){return(0,X.e)((xe,je)=>{xe.subscribe((0,a.x)(je,Se=>(0,p.f)(je,ne,()=>je.next(Se),Ee),()=>(0,p.f)(je,ne,()=>je.complete(),Ee),Se=>(0,p.f)(je,ne,()=>je.error(Se),Ee)))})}function K(ne,Ee=0){return(0,X.e)((xe,je)=>{je.add(ne.schedule(()=>xe.subscribe(je),Ee))})}var _e=S(5592),ee=S(4971),Te=S(4674);function De(ne,Ee){if(!ne)throw new Error("Iterable cannot be null");return new _e.y(xe=>{(0,p.f)(xe,Ee,()=>{const je=ne[Symbol.asyncIterator]();(0,p.f)(xe,Ee,()=>{je.next().then(Se=>{Se.done?xe.complete():xe.next(Se.value)})},0,!0)})})}var me=S(8382),Ye=S(4026),Ce=S(4266),de=S(3664),Pe=S(5726),Be=S(9853),Ne=S(541);function lt(ne,Ee){return Ee?function Ge(ne,Ee){if(null!=ne){if((0,me.c)(ne))return function C(ne,Ee){return(0,h.Xf)(ne).pipe(K(Ee),j(Ee))}(ne,Ee);if((0,Ce.z)(ne))return function Le(ne,Ee){return new _e.y(xe=>{let je=0;return Ee.schedule(function(){je===ne.length?xe.complete():(xe.next(ne[je++]),xe.closed||this.schedule())})})}(ne,Ee);if((0,Ye.t)(ne))return function oe(ne,Ee){return(0,h.Xf)(ne).pipe(K(Ee),j(Ee))}(ne,Ee);if((0,Pe.D)(ne))return De(ne,Ee);if((0,de.T)(ne))return function ye(ne,Ee){return new _e.y(xe=>{let je;return(0,p.f)(xe,Ee,()=>{je=ne[ee.h](),(0,p.f)(xe,Ee,()=>{let Se,Ve;try{({value:Se,done:Ve}=je.next())}catch(Xe){return void xe.error(Xe)}Ve?xe.complete():xe.next(Se)},0,!0)}),()=>(0,Te.m)(je?.return)&&je.return()})}(ne,Ee);if((0,Ne.L)(ne))return function Ae(ne,Ee){return De((0,Ne.Q)(ne),Ee)}(ne,Ee)}throw(0,Be.z)(ne)}(ne,Ee):(0,h.Xf)(ne)}},2438:(zn,wt,S)=>{"use strict";S.d(wt,{R:()=>Le});var h=S(4829),p=S(5592),X=S(1631),a=S(4266),j=S(4674),K=S(7400);const C=["addListener","removeListener"],oe=["addEventListener","removeEventListener"],_e=["on","off"];function Le(me,Ye,Ce,de){if((0,j.m)(Ce)&&(de=Ce,Ce=void 0),de)return Le(me,Ye,Ce).pipe((0,K.Z)(de));const[Pe,Be]=function De(me){return(0,j.m)(me.addEventListener)&&(0,j.m)(me.removeEventListener)}(me)?oe.map(Ne=>Ae=>me[Ne](Ye,Ae,Ce)):function Te(me){return(0,j.m)(me.addListener)&&(0,j.m)(me.removeListener)}(me)?C.map(ee(me,Ye)):function ye(me){return(0,j.m)(me.on)&&(0,j.m)(me.off)}(me)?_e.map(ee(me,Ye)):[];if(!Pe&&(0,a.z)(me))return(0,X.z)(Ne=>Le(Ne,Ye,Ce))((0,h.Xf)(me));if(!Pe)throw new TypeError("Invalid event target");return new p.y(Ne=>{const Ae=(...Ge)=>Ne.next(1<Ge.length?Ge:Ge[0]);return Pe(Ae),()=>Be(Ae)})}function ee(me,Ye){return Ce=>de=>me[Ce](Ye,de)}},4829:(zn,wt,S)=>{"use strict";S.d(wt,{Xf:()=>ye});var h=S(7582),p=S(4266),X=S(4026),a=S(5592),j=S(8382),K=S(5726),C=S(9853),oe=S(3664),_e=S(541),Le=S(4674),ee=S(3894),Te=S(4850);function ye(Ne){if(Ne instanceof a.y)return Ne;if(null!=Ne){if((0,j.c)(Ne))return function De(Ne){return new a.y(Ae=>{const Ge=Ne[Te.L]();if((0,Le.m)(Ge.subscribe))return Ge.subscribe(Ae);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(Ne);if((0,p.z)(Ne))return function me(Ne){return new a.y(Ae=>{for(let Ge=0;Ge<Ne.length&&!Ae.closed;Ge++)Ae.next(Ne[Ge]);Ae.complete()})}(Ne);if((0,X.t)(Ne))return function Ye(Ne){return new a.y(Ae=>{Ne.then(Ge=>{Ae.closed||(Ae.next(Ge),Ae.complete())},Ge=>Ae.error(Ge)).then(null,ee.h)})}(Ne);if((0,K.D)(Ne))return de(Ne);if((0,oe.T)(Ne))return function Ce(Ne){return new a.y(Ae=>{for(const Ge of Ne)if(Ae.next(Ge),Ae.closed)return;Ae.complete()})}(Ne);if((0,_e.L)(Ne))return function Pe(Ne){return de((0,_e.Q)(Ne))}(Ne)}throw(0,C.z)(Ne)}function de(Ne){return new a.y(Ae=>{(function Be(Ne,Ae){var Ge,lt,ne,Ee;return(0,h.mG)(this,void 0,void 0,function*(){try{for(Ge=(0,h.KL)(Ne);!(lt=yield Ge.next()).done;)if(Ae.next(lt.value),Ae.closed)return}catch(xe){ne={error:xe}}finally{try{lt&&!lt.done&&(Ee=Ge.return)&&(yield Ee.call(Ge))}finally{if(ne)throw ne.error}}Ae.complete()})})(Ne,Ae).catch(Ge=>Ae.error(Ge))})}},2096:(zn,wt,S)=>{"use strict";S.d(wt,{of:()=>X});var h=S(4564),p=S(7715);function X(...a){const j=(0,h.yG)(a);return(0,p.D)(a,j)}},8251:(zn,wt,S)=>{"use strict";S.d(wt,{x:()=>p});var h=S(305);function p(a,j,K,C,oe){return new X(a,j,K,C,oe)}class X extends h.Lv{constructor(j,K,C,oe,_e,Le){super(j),this.onFinalize=_e,this.shouldUnsubscribe=Le,this._next=K?function(ee){try{K(ee)}catch(Te){j.error(Te)}}:super._next,this._error=oe?function(ee){try{oe(ee)}catch(Te){j.error(Te)}finally{this.unsubscribe()}}:super._error,this._complete=C?function(){try{C()}catch(ee){j.error(ee)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var j;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:K}=this;super.unsubscribe(),!K&&(null===(j=this.onFinalize)||void 0===j||j.call(this))}}}},6328:(zn,wt,S)=>{"use strict";S.d(wt,{b:()=>X});var h=S(1631),p=S(4674);function X(a,j){return(0,p.m)(j)?(0,h.z)(a,j,1):(0,h.z)(a,1)}},3997:(zn,wt,S)=>{"use strict";S.d(wt,{x:()=>a});var h=S(2737),p=S(9360),X=S(8251);function a(K,C=h.y){return K=K??j,(0,p.e)((oe,_e)=>{let Le,ee=!0;oe.subscribe((0,X.x)(_e,Te=>{const ye=C(Te);(ee||!K(Le,ye))&&(ee=!1,Le=ye,_e.next(Te))}))})}function j(K,C){return K===C}},2181:(zn,wt,S)=>{"use strict";S.d(wt,{h:()=>X});var h=S(9360),p=S(8251);function X(a,j){return(0,h.e)((K,C)=>{let oe=0;K.subscribe((0,p.x)(C,_e=>a.call(j,_e,oe++)&&C.next(_e)))})}},4716:(zn,wt,S)=>{"use strict";S.d(wt,{x:()=>p});var h=S(9360);function p(X){return(0,h.e)((a,j)=>{try{a.subscribe(j)}finally{j.add(X)}})}},7398:(zn,wt,S)=>{"use strict";S.d(wt,{U:()=>X});var h=S(9360),p=S(8251);function X(a,j){return(0,h.e)((K,C)=>{let oe=0;K.subscribe((0,p.x)(C,_e=>{C.next(a.call(j,_e,oe++))}))})}},7537:(zn,wt,S)=>{"use strict";S.d(wt,{J:()=>X});var h=S(1631),p=S(2737);function X(a=1/0){return(0,h.z)(p.y,a)}},1631:(zn,wt,S)=>{"use strict";S.d(wt,{z:()=>oe});var h=S(7398),p=S(4829),X=S(9360),a=S(7103),j=S(8251),C=S(4674);function oe(_e,Le,ee=1/0){return(0,C.m)(Le)?oe((Te,ye)=>(0,h.U)((De,me)=>Le(Te,De,ye,me))((0,p.Xf)(_e(Te,ye))),ee):("number"==typeof Le&&(ee=Le),(0,X.e)((Te,ye)=>function K(_e,Le,ee,Te,ye,De,me,Ye){const Ce=[];let de=0,Pe=0,Be=!1;const Ne=()=>{Be&&!Ce.length&&!de&&Le.complete()},Ae=lt=>de<Te?Ge(lt):Ce.push(lt),Ge=lt=>{De&&Le.next(lt),de++;let ne=!1;(0,p.Xf)(ee(lt,Pe++)).subscribe((0,j.x)(Le,Ee=>{ye?.(Ee),De?Ae(Ee):Le.next(Ee)},()=>{ne=!0},void 0,()=>{if(ne)try{for(de--;Ce.length&&de<Te;){const Ee=Ce.shift();me?(0,a.f)(Le,me,()=>Ge(Ee)):Ge(Ee)}Ne()}catch(Ee){Le.error(Ee)}}))};return _e.subscribe((0,j.x)(Le,Ae,()=>{Be=!0,Ne()})),()=>{Ye?.()}}(Te,ye,_e,ee)))}},3020:(zn,wt,S)=>{"use strict";S.d(wt,{B:()=>j});var h=S(4829),p=S(8645),X=S(305),a=S(9360);function j(C={}){const{connector:oe=(()=>new p.x),resetOnError:_e=!0,resetOnComplete:Le=!0,resetOnRefCountZero:ee=!0}=C;return Te=>{let ye,De,me,Ye=0,Ce=!1,de=!1;const Pe=()=>{De?.unsubscribe(),De=void 0},Be=()=>{Pe(),ye=me=void 0,Ce=de=!1},Ne=()=>{const Ae=ye;Be(),Ae?.unsubscribe()};return(0,a.e)((Ae,Ge)=>{Ye++,!de&&!Ce&&Pe();const lt=me=me??oe();Ge.add(()=>{Ye--,0===Ye&&!de&&!Ce&&(De=K(Ne,ee))}),lt.subscribe(Ge),!ye&&Ye>0&&(ye=new X.Hp({next:ne=>lt.next(ne),error:ne=>{de=!0,Pe(),De=K(Be,_e,ne),lt.error(ne)},complete:()=>{Ce=!0,Pe(),De=K(Be,Le),lt.complete()}}),(0,h.Xf)(Ae).subscribe(ye))})(Te)}}function K(C,oe,..._e){if(!0===oe)return void C();if(!1===oe)return;const Le=new X.Hp({next:()=>{Le.unsubscribe(),C()}});return(0,h.Xf)(oe(..._e)).subscribe(Le)}},4664:(zn,wt,S)=>{"use strict";S.d(wt,{w:()=>a});var h=S(4829),p=S(9360),X=S(8251);function a(j,K){return(0,p.e)((C,oe)=>{let _e=null,Le=0,ee=!1;const Te=()=>ee&&!_e&&oe.complete();C.subscribe((0,X.x)(oe,ye=>{_e?.unsubscribe();let De=0;const me=Le++;(0,h.Xf)(j(ye,me)).subscribe(_e=(0,X.x)(oe,Ye=>oe.next(K?K(ye,Ye,me,De++):Ye),()=>{_e=null,Te()}))},()=>{ee=!0,Te()}))})}},8180:(zn,wt,S)=>{"use strict";S.d(wt,{q:()=>a});var h=S(6232),p=S(9360),X=S(8251);function a(j){return j<=0?()=>h.E:(0,p.e)((K,C)=>{let oe=0;K.subscribe((0,X.x)(C,_e=>{++oe<=j&&(C.next(_e),j<=oe&&C.complete())}))})}},4552:(zn,wt,S)=>{"use strict";S.d(wt,{l:()=>h});const h={now:()=>(h.delegate||Date).now(),delegate:void 0}},7599:(zn,wt,S)=>{"use strict";S.d(wt,{z:()=>h});const h={setTimeout(p,X,...a){const{delegate:j}=h;return j?.setTimeout?j.setTimeout(p,X,...a):setTimeout(p,X,...a)},clearTimeout(p){const{delegate:X}=h;return(X?.clearTimeout||clearTimeout)(p)},delegate:void 0}},4971:(zn,wt,S)=>{"use strict";S.d(wt,{h:()=>p});const p=function h(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},4850:(zn,wt,S)=>{"use strict";S.d(wt,{L:()=>h});const h="function"==typeof Symbol&&Symbol.observable||"@@observable"},4564:(zn,wt,S)=>{"use strict";S.d(wt,{_6:()=>K,jO:()=>a,yG:()=>j});var h=S(4674);function X(C){return C[C.length-1]}function a(C){return(0,h.m)(X(C))?C.pop():void 0}function j(C){return function p(C){return C&&(0,h.m)(C.schedule)}(X(C))?C.pop():void 0}function K(C,oe){return"number"==typeof X(C)?C.pop():oe}},7453:(zn,wt,S)=>{"use strict";S.d(wt,{D:()=>j});const{isArray:h}=Array,{getPrototypeOf:p,prototype:X,keys:a}=Object;function j(C){if(1===C.length){const oe=C[0];if(h(oe))return{args:oe,keys:null};if(function K(C){return C&&"object"==typeof C&&p(C)===X}(oe)){const _e=a(oe);return{args:_e.map(Le=>oe[Le]),keys:_e}}}return{args:C,keys:null}}},9039:(zn,wt,S)=>{"use strict";function h(p,X){if(p){const a=p.indexOf(X);0<=a&&p.splice(a,1)}}S.d(wt,{P:()=>h})},2306:(zn,wt,S)=>{"use strict";function h(p){const a=p(j=>{Error.call(j),j.stack=(new Error).stack});return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a}S.d(wt,{d:()=>h})},2714:(zn,wt,S)=>{"use strict";function h(p,X){return p.reduce((a,j,K)=>(a[j]=X[K],a),{})}S.d(wt,{n:()=>h})},1441:(zn,wt,S)=>{"use strict";S.d(wt,{O:()=>a,x:()=>X});var h=S(2653);let p=null;function X(j){if(h.config.useDeprecatedSynchronousErrorHandling){const K=!p;if(K&&(p={errorThrown:!1,error:null}),j(),K){const{errorThrown:C,error:oe}=p;if(p=null,C)throw oe}}else j()}function a(j){h.config.useDeprecatedSynchronousErrorHandling&&p&&(p.errorThrown=!0,p.error=j)}},7103:(zn,wt,S)=>{"use strict";function h(p,X,a,j=0,K=!1){const C=X.schedule(function(){a(),K?p.add(this.schedule(null,j)):this.unsubscribe()},j);if(p.add(C),!K)return C}S.d(wt,{f:()=>h})},2737:(zn,wt,S)=>{"use strict";function h(p){return p}S.d(wt,{y:()=>h})},4266:(zn,wt,S)=>{"use strict";S.d(wt,{z:()=>h});const h=p=>p&&"number"==typeof p.length&&"function"!=typeof p},5726:(zn,wt,S)=>{"use strict";S.d(wt,{D:()=>p});var h=S(4674);function p(X){return Symbol.asyncIterator&&(0,h.m)(X?.[Symbol.asyncIterator])}},4674:(zn,wt,S)=>{"use strict";function h(p){return"function"==typeof p}S.d(wt,{m:()=>h})},8382:(zn,wt,S)=>{"use strict";S.d(wt,{c:()=>X});var h=S(4850),p=S(4674);function X(a){return(0,p.m)(a[h.L])}},3664:(zn,wt,S)=>{"use strict";S.d(wt,{T:()=>X});var h=S(4971),p=S(4674);function X(a){return(0,p.m)(a?.[h.h])}},2664:(zn,wt,S)=>{"use strict";S.d(wt,{b:()=>X});var h=S(5592),p=S(4674);function X(a){return!!a&&(a instanceof h.y||(0,p.m)(a.lift)&&(0,p.m)(a.subscribe))}},4026:(zn,wt,S)=>{"use strict";S.d(wt,{t:()=>p});var h=S(4674);function p(X){return(0,h.m)(X?.then)}},541:(zn,wt,S)=>{"use strict";S.d(wt,{L:()=>a,Q:()=>X});var h=S(7582),p=S(4674);function X(j){return(0,h.FC)(this,arguments,function*(){const C=j.getReader();try{for(;;){const{value:oe,done:_e}=yield(0,h.qq)(C.read());if(_e)return yield(0,h.qq)(void 0);yield yield(0,h.qq)(oe)}}finally{C.releaseLock()}})}function a(j){return(0,p.m)(j?.getReader)}},9360:(zn,wt,S)=>{"use strict";S.d(wt,{A:()=>p,e:()=>X});var h=S(4674);function p(a){return(0,h.m)(a?.lift)}function X(a){return j=>{if(p(j))return j.lift(function(K){try{return a(K,this)}catch(C){this.error(C)}});throw new TypeError("Unable to lift unknown Observable type")}}},7400:(zn,wt,S)=>{"use strict";S.d(wt,{Z:()=>a});var h=S(7398);const{isArray:p}=Array;function a(j){return(0,h.U)(K=>function X(j,K){return p(K)?j(...K):j(K)}(j,K))}},2420:(zn,wt,S)=>{"use strict";function h(){}S.d(wt,{Z:()=>h})},8407:(zn,wt,S)=>{"use strict";S.d(wt,{U:()=>X,z:()=>p});var h=S(2737);function p(...a){return X(a)}function X(a){return 0===a.length?h.y:1===a.length?a[0]:function(K){return a.reduce((C,oe)=>oe(C),K)}}},3894:(zn,wt,S)=>{"use strict";S.d(wt,{h:()=>X});var h=S(2653),p=S(7599);function X(a){p.z.setTimeout(()=>{const{onUnhandledError:j}=h.config;if(!j)throw a;j(a)})}},9853:(zn,wt,S)=>{"use strict";function h(p){return new TypeError(`You provided ${null!==p&&"object"==typeof p?"an invalid object":`'${p}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}S.d(wt,{z:()=>h})},863:(zn,wt,S)=>{var h={"./ion-accordion_2.entry.js":[8484,8592,8484],"./ion-action-sheet.entry.js":[9882,8592,9882],"./ion-alert.entry.js":[6304,8592,6304],"./ion-app_8.entry.js":[5860,8592,5860],"./ion-avatar_3.entry.js":[3544,3544],"./ion-back-button.entry.js":[505,8592,505],"./ion-backdrop.entry.js":[469,469],"./ion-breadcrumb_2.entry.js":[9857,8592,9857],"./ion-button_2.entry.js":[1372,1372],"./ion-card_5.entry.js":[3150,3150],"./ion-checkbox.entry.js":[7635,8592,7635],"./ion-chip.entry.js":[6673,6673],"./ion-col_3.entry.js":[1315,1315],"./ion-datetime-button.entry.js":[433,9302,433],"./ion-datetime_3.entry.js":[7059,9302,8592,7059],"./ion-fab_3.entry.js":[4087,8592,4087],"./ion-img.entry.js":[1745,1745],"./ion-infinite-scroll_2.entry.js":[9352,8592,9352],"./ion-input.entry.js":[4530,8592,4530],"./ion-item-option_3.entry.js":[8633,8592,8633],"./ion-item_8.entry.js":[5962,8592,5962],"./ion-loading.entry.js":[3483,8592,3483],"./ion-menu_3.entry.js":[2939,8592,8382],"./ion-modal.entry.js":[8577,8592,8577],"./ion-nav_2.entry.js":[5675,8592,5675],"./ion-picker-column-internal.entry.js":[9992,8592,9992],"./ion-picker-internal.entry.js":[9820,9820],"./ion-popover.entry.js":[185,8592,185],"./ion-progress-bar.entry.js":[5454,5454],"./ion-radio_2.entry.js":[4458,8592,4458],"./ion-range.entry.js":[7666,8592,7666],"./ion-refresher_2.entry.js":[7219,8592,7219],"./ion-reorder_2.entry.js":[2975,8592,2975],"./ion-ripple-effect.entry.js":[7465,7465],"./ion-route_4.entry.js":[4764,4764],"./ion-searchbar.entry.js":[3998,8592,3998],"./ion-segment_2.entry.js":[3672,8592,3672],"./ion-select_3.entry.js":[6754,8592,6754],"./ion-spinner.entry.js":[9588,8592,9588],"./ion-split-pane.entry.js":[9793,9793],"./ion-tab-bar_2.entry.js":[4090,8592,4090],"./ion-tab_2.entry.js":[2841,2841],"./ion-text.entry.js":[8811,8811],"./ion-textarea.entry.js":[3734,8592,3734],"./ion-toast.entry.js":[6642,8592,6642],"./ion-toggle.entry.js":[8866,8592,8866]};function p(X){if(!S.o(h,X))return Promise.resolve().then(()=>{var K=new Error("Cannot find module '"+X+"'");throw K.code="MODULE_NOT_FOUND",K});var a=h[X],j=a[0];return Promise.all(a.slice(1).map(S.e)).then(()=>S(j))}p.keys=()=>Object.keys(h),p.id=863,zn.exports=p},6814:(zn,wt,S)=>{"use strict";S.d(wt,{Do:()=>Ye,EM:()=>na,HT:()=>a,JF:()=>cs,JJ:()=>Bs,K0:()=>K,Mx:()=>Mt,O5:()=>we,PM:()=>Lo,S$:()=>ye,V_:()=>oe,Ye:()=>Ce,b0:()=>me,bD:()=>lo,ez:()=>zs,q:()=>X,sg:()=>lr,tP:()=>yn,uU:()=>Bt,w_:()=>j});var h=S(8564);let p=null;function X(){return p}function a(F){p||(p=F)}class j{}const K=new h.OlP("DocumentToken");let C=(()=>{class F{historyGo(q){throw new Error("Not implemented")}static#e=this.\u0275fac=function(fe){return new(fe||F)};static#t=this.\u0275prov=h.Yz7({token:F,factory:()=>(0,h.f3M)(_e),providedIn:"platform"})}return F})();const oe=new h.OlP("Location Initialized");let _e=(()=>{class F extends C{constructor(){super(),this._doc=(0,h.f3M)(K),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return X().getBaseHref(this._doc)}onPopState(q){const fe=X().getGlobalEventTarget(this._doc,"window");return fe.addEventListener("popstate",q,!1),()=>fe.removeEventListener("popstate",q)}onHashChange(q){const fe=X().getGlobalEventTarget(this._doc,"window");return fe.addEventListener("hashchange",q,!1),()=>fe.removeEventListener("hashchange",q)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(q){this._location.pathname=q}pushState(q,fe,xt){this._history.pushState(q,fe,xt)}replaceState(q,fe,xt){this._history.replaceState(q,fe,xt)}forward(){this._history.forward()}back(){this._history.back()}historyGo(q=0){this._history.go(q)}getState(){return this._history.state}static#e=this.\u0275fac=function(fe){return new(fe||F)};static#t=this.\u0275prov=h.Yz7({token:F,factory:()=>new F,providedIn:"platform"})}return F})();function Le(F,Me){if(0==F.length)return Me;if(0==Me.length)return F;let q=0;return F.endsWith("/")&&q++,Me.startsWith("/")&&q++,2==q?F+Me.substring(1):1==q?F+Me:F+"/"+Me}function ee(F){const Me=F.match(/#|\?|$/),q=Me&&Me.index||F.length;return F.slice(0,q-("/"===F[q-1]?1:0))+F.slice(q)}function Te(F){return F&&"?"!==F[0]?"?"+F:F}let ye=(()=>{class F{historyGo(q){throw new Error("Not implemented")}static#e=this.\u0275fac=function(fe){return new(fe||F)};static#t=this.\u0275prov=h.Yz7({token:F,factory:()=>(0,h.f3M)(me),providedIn:"root"})}return F})();const De=new h.OlP("appBaseHref");let me=(()=>{class F extends ye{constructor(q,fe){super(),this._platformLocation=q,this._removeListenerFns=[],this._baseHref=fe??this._platformLocation.getBaseHrefFromDOM()??(0,h.f3M)(K).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(q){this._removeListenerFns.push(this._platformLocation.onPopState(q),this._platformLocation.onHashChange(q))}getBaseHref(){return this._baseHref}prepareExternalUrl(q){return Le(this._baseHref,q)}path(q=!1){const fe=this._platformLocation.pathname+Te(this._platformLocation.search),xt=this._platformLocation.hash;return xt&&q?`${fe}${xt}`:fe}pushState(q,fe,xt,vn){const bn=this.prepareExternalUrl(xt+Te(vn));this._platformLocation.pushState(q,fe,bn)}replaceState(q,fe,xt,vn){const bn=this.prepareExternalUrl(xt+Te(vn));this._platformLocation.replaceState(q,fe,bn)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(q=0){this._platformLocation.historyGo?.(q)}static#e=this.\u0275fac=function(fe){return new(fe||F)(h.LFG(C),h.LFG(De,8))};static#t=this.\u0275prov=h.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"})}return F})(),Ye=(()=>{class F extends ye{constructor(q,fe){super(),this._platformLocation=q,this._baseHref="",this._removeListenerFns=[],null!=fe&&(this._baseHref=fe)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(q){this._removeListenerFns.push(this._platformLocation.onPopState(q),this._platformLocation.onHashChange(q))}getBaseHref(){return this._baseHref}path(q=!1){let fe=this._platformLocation.hash;return null==fe&&(fe="#"),fe.length>0?fe.substring(1):fe}prepareExternalUrl(q){const fe=Le(this._baseHref,q);return fe.length>0?"#"+fe:fe}pushState(q,fe,xt,vn){let bn=this.prepareExternalUrl(xt+Te(vn));0==bn.length&&(bn=this._platformLocation.pathname),this._platformLocation.pushState(q,fe,bn)}replaceState(q,fe,xt,vn){let bn=this.prepareExternalUrl(xt+Te(vn));0==bn.length&&(bn=this._platformLocation.pathname),this._platformLocation.replaceState(q,fe,bn)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(q=0){this._platformLocation.historyGo?.(q)}static#e=this.\u0275fac=function(fe){return new(fe||F)(h.LFG(C),h.LFG(De,8))};static#t=this.\u0275prov=h.Yz7({token:F,factory:F.\u0275fac})}return F})(),Ce=(()=>{class F{constructor(q){this._subject=new h.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=q;const fe=this._locationStrategy.getBaseHref();this._basePath=function Ne(F){if(new RegExp("^(https?:)?//").test(F)){const[,q]=F.split(/\/\/[^\/]+/);return q}return F}(ee(Be(fe))),this._locationStrategy.onPopState(xt=>{this._subject.emit({url:this.path(!0),pop:!0,state:xt.state,type:xt.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(q=!1){return this.normalize(this._locationStrategy.path(q))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(q,fe=""){return this.path()==this.normalize(q+Te(fe))}normalize(q){return F.stripTrailingSlash(function Pe(F,Me){if(!F||!Me.startsWith(F))return Me;const q=Me.substring(F.length);return""===q||["/",";","?","#"].includes(q[0])?q:Me}(this._basePath,Be(q)))}prepareExternalUrl(q){return q&&"/"!==q[0]&&(q="/"+q),this._locationStrategy.prepareExternalUrl(q)}go(q,fe="",xt=null){this._locationStrategy.pushState(xt,"",q,fe),this._notifyUrlChangeListeners(this.prepareExternalUrl(q+Te(fe)),xt)}replaceState(q,fe="",xt=null){this._locationStrategy.replaceState(xt,"",q,fe),this._notifyUrlChangeListeners(this.prepareExternalUrl(q+Te(fe)),xt)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(q=0){this._locationStrategy.historyGo?.(q)}onUrlChange(q){return this._urlChangeListeners.push(q),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(fe=>{this._notifyUrlChangeListeners(fe.url,fe.state)})),()=>{const fe=this._urlChangeListeners.indexOf(q);this._urlChangeListeners.splice(fe,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(q="",fe){this._urlChangeListeners.forEach(xt=>xt(q,fe))}subscribe(q,fe,xt){return this._subject.subscribe({next:q,error:fe,complete:xt})}static#e=this.normalizeQueryParams=Te;static#t=this.joinWithSlash=Le;static#n=this.stripTrailingSlash=ee;static#i=this.\u0275fac=function(fe){return new(fe||F)(h.LFG(ye))};static#r=this.\u0275prov=h.Yz7({token:F,factory:()=>function de(){return new Ce((0,h.LFG)(ye))}(),providedIn:"root"})}return F})();function Be(F){return F.replace(/\/index.html$/,"")}var Ge=function(F){return F[F.Decimal=0]="Decimal",F[F.Percent=1]="Percent",F[F.Currency=2]="Currency",F[F.Scientific=3]="Scientific",F}(Ge||{}),ne=function(F){return F[F.Format=0]="Format",F[F.Standalone=1]="Standalone",F}(ne||{}),Ee=function(F){return F[F.Narrow=0]="Narrow",F[F.Abbreviated=1]="Abbreviated",F[F.Wide=2]="Wide",F[F.Short=3]="Short",F}(Ee||{}),xe=function(F){return F[F.Short=0]="Short",F[F.Medium=1]="Medium",F[F.Long=2]="Long",F[F.Full=3]="Full",F}(xe||{}),je=function(F){return F[F.Decimal=0]="Decimal",F[F.Group=1]="Group",F[F.List=2]="List",F[F.PercentSign=3]="PercentSign",F[F.PlusSign=4]="PlusSign",F[F.MinusSign=5]="MinusSign",F[F.Exponential=6]="Exponential",F[F.SuperscriptingExponent=7]="SuperscriptingExponent",F[F.PerMille=8]="PerMille",F[F.Infinity=9]="Infinity",F[F.NaN=10]="NaN",F[F.TimeSeparator=11]="TimeSeparator",F[F.CurrencyDecimal=12]="CurrencyDecimal",F[F.CurrencyGroup=13]="CurrencyGroup",F}(je||{});function pe(F,Me){return on((0,h.cg1)(F)[h.wAp.DateFormat],Me)}function Oe(F,Me){return on((0,h.cg1)(F)[h.wAp.TimeFormat],Me)}function ie(F,Me){return on((0,h.cg1)(F)[h.wAp.DateTimeFormat],Me)}function it(F,Me){const q=(0,h.cg1)(F),fe=q[h.wAp.NumberSymbols][Me];if(typeof fe>"u"){if(Me===je.CurrencyDecimal)return q[h.wAp.NumberSymbols][je.Decimal];if(Me===je.CurrencyGroup)return q[h.wAp.NumberSymbols][je.Group]}return fe}function en(F){if(!F[h.wAp.ExtraData])throw new Error(`Missing extra locale data for the locale "${F[h.wAp.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function on(F,Me){for(let q=Me;q>-1;q--)if(typeof F[q]<"u")return F[q];throw new Error("Locale data API: locale data undefined")}function Rn(F){const[Me,q]=F.split(":");return{hours:+Me,minutes:+q}}const qe=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Nt={},Xt=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Tn=function(F){return F[F.Short=0]="Short",F[F.ShortGMT=1]="ShortGMT",F[F.Long=2]="Long",F[F.Extended=3]="Extended",F}(Tn||{}),oi=function(F){return F[F.FullYear=0]="FullYear",F[F.Month=1]="Month",F[F.Date=2]="Date",F[F.Hours=3]="Hours",F[F.Minutes=4]="Minutes",F[F.Seconds=5]="Seconds",F[F.FractionalSeconds=6]="FractionalSeconds",F[F.Day=7]="Day",F}(oi||{}),xi=function(F){return F[F.DayPeriods=0]="DayPeriods",F[F.Days=1]="Days",F[F.Months=2]="Months",F[F.Eras=3]="Eras",F}(xi||{});function Oi(F,Me,q,fe){let xt=function ae(F){if(G(F))return F;if("number"==typeof F&&!isNaN(F))return new Date(F);if("string"==typeof F){if(F=F.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(F)){const[xt,vn=1,bn=1]=F.split("-").map(Ti=>+Ti);return gr(xt,vn-1,bn)}const q=parseFloat(F);if(!isNaN(F-q))return new Date(q);let fe;if(fe=F.match(qe))return function ht(F){const Me=new Date(0);let q=0,fe=0;const xt=F[8]?Me.setUTCFullYear:Me.setFullYear,vn=F[8]?Me.setUTCHours:Me.setHours;F[9]&&(q=Number(F[9]+F[10]),fe=Number(F[9]+F[11])),xt.call(Me,Number(F[1]),Number(F[2])-1,Number(F[3]));const bn=Number(F[4]||0)-q,Ti=Number(F[5]||0)-fe,Ur=Number(F[6]||0),Lr=Math.floor(1e3*parseFloat("0."+(F[7]||0)));return vn.call(Me,bn,Ti,Ur,Lr),Me}(fe)}const Me=new Date(F);if(!G(Me))throw new Error(`Unable to convert "${F}" into a date`);return Me}(F);Me=ki(q,Me)||Me;let Ti,bn=[];for(;Me;){if(Ti=Xt.exec(Me),!Ti){bn.push(Me);break}{bn=bn.concat(Ti.slice(1));const Sr=bn.pop();if(!Sr)break;Me=Sr}}let Ur=xt.getTimezoneOffset();fe&&(Ur=Jt(fe,Ur),xt=function mn(F,Me,q){const fe=q?-1:1,xt=F.getTimezoneOffset();return function Bn(F,Me){return(F=new Date(F.getTime())).setMinutes(F.getMinutes()+Me),F}(F,fe*(Jt(Me,xt)-xt))}(xt,fe,!0));let Lr="";return bn.forEach(Sr=>{const sr=function Et(F){if(Vt[F])return Vt[F];let Me;switch(F){case"G":case"GG":case"GGG":Me=Cn(xi.Eras,Ee.Abbreviated);break;case"GGGG":Me=Cn(xi.Eras,Ee.Wide);break;case"GGGGG":Me=Cn(xi.Eras,Ee.Narrow);break;case"y":Me=pn(oi.FullYear,1,0,!1,!0);break;case"yy":Me=pn(oi.FullYear,2,0,!0,!0);break;case"yyy":Me=pn(oi.FullYear,3,0,!1,!0);break;case"yyyy":Me=pn(oi.FullYear,4,0,!1,!0);break;case"Y":Me=Gt(1);break;case"YY":Me=Gt(2,!0);break;case"YYY":Me=Gt(3);break;case"YYYY":Me=Gt(4);break;case"M":case"L":Me=pn(oi.Month,1,1);break;case"MM":case"LL":Me=pn(oi.Month,2,1);break;case"MMM":Me=Cn(xi.Months,Ee.Abbreviated);break;case"MMMM":Me=Cn(xi.Months,Ee.Wide);break;case"MMMMM":Me=Cn(xi.Months,Ee.Narrow);break;case"LLL":Me=Cn(xi.Months,Ee.Abbreviated,ne.Standalone);break;case"LLLL":Me=Cn(xi.Months,Ee.Wide,ne.Standalone);break;case"LLLLL":Me=Cn(xi.Months,Ee.Narrow,ne.Standalone);break;case"w":Me=Ot(1);break;case"ww":Me=Ot(2);break;case"W":Me=Ot(1,!0);break;case"d":Me=pn(oi.Date,1);break;case"dd":Me=pn(oi.Date,2);break;case"c":case"cc":Me=pn(oi.Day,1);break;case"ccc":Me=Cn(xi.Days,Ee.Abbreviated,ne.Standalone);break;case"cccc":Me=Cn(xi.Days,Ee.Wide,ne.Standalone);break;case"ccccc":Me=Cn(xi.Days,Ee.Narrow,ne.Standalone);break;case"cccccc":Me=Cn(xi.Days,Ee.Short,ne.Standalone);break;case"E":case"EE":case"EEE":Me=Cn(xi.Days,Ee.Abbreviated);break;case"EEEE":Me=Cn(xi.Days,Ee.Wide);break;case"EEEEE":Me=Cn(xi.Days,Ee.Narrow);break;case"EEEEEE":Me=Cn(xi.Days,Ee.Short);break;case"a":case"aa":case"aaa":Me=Cn(xi.DayPeriods,Ee.Abbreviated);break;case"aaaa":Me=Cn(xi.DayPeriods,Ee.Wide);break;case"aaaaa":Me=Cn(xi.DayPeriods,Ee.Narrow);break;case"b":case"bb":case"bbb":Me=Cn(xi.DayPeriods,Ee.Abbreviated,ne.Standalone,!0);break;case"bbbb":Me=Cn(xi.DayPeriods,Ee.Wide,ne.Standalone,!0);break;case"bbbbb":Me=Cn(xi.DayPeriods,Ee.Narrow,ne.Standalone,!0);break;case"B":case"BB":case"BBB":Me=Cn(xi.DayPeriods,Ee.Abbreviated,ne.Format,!0);break;case"BBBB":Me=Cn(xi.DayPeriods,Ee.Wide,ne.Format,!0);break;case"BBBBB":Me=Cn(xi.DayPeriods,Ee.Narrow,ne.Format,!0);break;case"h":Me=pn(oi.Hours,1,-12);break;case"hh":Me=pn(oi.Hours,2,-12);break;case"H":Me=pn(oi.Hours,1);break;case"HH":Me=pn(oi.Hours,2);break;case"m":Me=pn(oi.Minutes,1);break;case"mm":Me=pn(oi.Minutes,2);break;case"s":Me=pn(oi.Seconds,1);break;case"ss":Me=pn(oi.Seconds,2);break;case"S":Me=pn(oi.FractionalSeconds,1);break;case"SS":Me=pn(oi.FractionalSeconds,2);break;case"SSS":Me=pn(oi.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":Me=ct(Tn.Short);break;case"ZZZZZ":Me=ct(Tn.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":Me=ct(Tn.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":Me=ct(Tn.Long);break;default:return null}return Vt[F]=Me,Me}(Sr);Lr+=sr?sr(xt,q,Ur):"''"===Sr?"'":Sr.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),Lr}function gr(F,Me,q){const fe=new Date(0);return fe.setFullYear(F,Me,q),fe.setHours(0,0,0),fe}function ki(F,Me){const q=function Ve(F){return(0,h.cg1)(F)[h.wAp.LocaleId]}(F);if(Nt[q]=Nt[q]||{},Nt[q][Me])return Nt[q][Me];let fe="";switch(Me){case"shortDate":fe=pe(F,xe.Short);break;case"mediumDate":fe=pe(F,xe.Medium);break;case"longDate":fe=pe(F,xe.Long);break;case"fullDate":fe=pe(F,xe.Full);break;case"shortTime":fe=Oe(F,xe.Short);break;case"mediumTime":fe=Oe(F,xe.Medium);break;case"longTime":fe=Oe(F,xe.Long);break;case"fullTime":fe=Oe(F,xe.Full);break;case"short":const xt=ki(F,"shortTime"),vn=ki(F,"shortDate");fe=Wi(ie(F,xe.Short),[xt,vn]);break;case"medium":const bn=ki(F,"mediumTime"),Ti=ki(F,"mediumDate");fe=Wi(ie(F,xe.Medium),[bn,Ti]);break;case"long":const Ur=ki(F,"longTime"),Lr=ki(F,"longDate");fe=Wi(ie(F,xe.Long),[Ur,Lr]);break;case"full":const Sr=ki(F,"fullTime"),sr=ki(F,"fullDate");fe=Wi(ie(F,xe.Full),[Sr,sr])}return fe&&(Nt[q][Me]=fe),fe}function Wi(F,Me){return Me&&(F=F.replace(/\{([^}]+)}/g,function(q,fe){return null!=Me&&fe in Me?Me[fe]:q})),F}function _n(F,Me,q="-",fe,xt){let vn="";(F<0||xt&&F<=0)&&(xt?F=1-F:(F=-F,vn=q));let bn=String(F);for(;bn.length<Me;)bn="0"+bn;return fe&&(bn=bn.slice(bn.length-Me)),vn+bn}function pn(F,Me,q=0,fe=!1,xt=!1){return function(vn,bn){let Ti=function sn(F,Me){switch(F){case oi.FullYear:return Me.getFullYear();case oi.Month:return Me.getMonth();case oi.Date:return Me.getDate();case oi.Hours:return Me.getHours();case oi.Minutes:return Me.getMinutes();case oi.Seconds:return Me.getSeconds();case oi.FractionalSeconds:return Me.getMilliseconds();case oi.Day:return Me.getDay();default:throw new Error(`Unknown DateType value "${F}".`)}}(F,vn);if((q>0||Ti>-q)&&(Ti+=q),F===oi.Hours)0===Ti&&-12===q&&(Ti=12);else if(F===oi.FractionalSeconds)return function Bi(F,Me){return _n(F,3).substring(0,Me)}(Ti,Me);const Ur=it(bn,je.MinusSign);return _n(Ti,Me,Ur,fe,xt)}}function Cn(F,Me,q=ne.Format,fe=!1){return function(xt,vn){return function $i(F,Me,q,fe,xt,vn){switch(q){case xi.Months:return function cn(F,Me,q){const fe=(0,h.cg1)(F),vn=on([fe[h.wAp.MonthsFormat],fe[h.wAp.MonthsStandalone]],Me);return on(vn,q)}(Me,xt,fe)[F.getMonth()];case xi.Days:return function Ht(F,Me,q){const fe=(0,h.cg1)(F),vn=on([fe[h.wAp.DaysFormat],fe[h.wAp.DaysStandalone]],Me);return on(vn,q)}(Me,xt,fe)[F.getDay()];case xi.DayPeriods:const bn=F.getHours(),Ti=F.getMinutes();if(vn){const Lr=function Dt(F){const Me=(0,h.cg1)(F);return en(Me),(Me[h.wAp.ExtraData][2]||[]).map(fe=>"string"==typeof fe?Rn(fe):[Rn(fe[0]),Rn(fe[1])])}(Me),Sr=function Ie(F,Me,q){const fe=(0,h.cg1)(F);en(fe);const vn=on([fe[h.wAp.ExtraData][0],fe[h.wAp.ExtraData][1]],Me)||[];return on(vn,q)||[]}(Me,xt,fe),sr=Lr.findIndex(Pr=>{if(Array.isArray(Pr)){const[hr,So]=Pr,$s=bn>=hr.hours&&Ti>=hr.minutes,qo=bn<So.hours||bn===So.hours&&Ti<So.minutes;if(hr.hours<So.hours){if($s&&qo)return!0}else if($s||qo)return!0}else if(Pr.hours===bn&&Pr.minutes===Ti)return!0;return!1});if(-1!==sr)return Sr[sr]}return function Xe(F,Me,q){const fe=(0,h.cg1)(F),vn=on([fe[h.wAp.DayPeriodsFormat],fe[h.wAp.DayPeriodsStandalone]],Me);return on(vn,q)}(Me,xt,fe)[bn<12?0:1];case xi.Eras:return function xn(F,Me){return on((0,h.cg1)(F)[h.wAp.Eras],Me)}(Me,fe)[F.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${q}`)}}(xt,vn,F,Me,q,fe)}}function ct(F){return function(Me,q,fe){const xt=-1*fe,vn=it(q,je.MinusSign),bn=xt>0?Math.floor(xt/60):Math.ceil(xt/60);switch(F){case Tn.Short:return(xt>=0?"+":"")+_n(bn,2,vn)+_n(Math.abs(xt%60),2,vn);case Tn.ShortGMT:return"GMT"+(xt>=0?"+":"")+_n(bn,1,vn);case Tn.Long:return"GMT"+(xt>=0?"+":"")+_n(bn,2,vn)+":"+_n(Math.abs(xt%60),2,vn);case Tn.Extended:return 0===fe?"Z":(xt>=0?"+":"")+_n(bn,2,vn)+":"+_n(Math.abs(xt%60),2,vn);default:throw new Error(`Unknown zone width "${F}"`)}}}const ge=0,se=4;function yt(F){return gr(F.getFullYear(),F.getMonth(),F.getDate()+(se-F.getDay()))}function Ot(F,Me=!1){return function(q,fe){let xt;if(Me){const vn=new Date(q.getFullYear(),q.getMonth(),1).getDay()-1,bn=q.getDate();xt=1+Math.floor((bn+vn)/7)}else{const vn=yt(q),bn=function tt(F){const Me=gr(F,ge,1).getDay();return gr(F,0,1+(Me<=se?se:se+7)-Me)}(vn.getFullYear()),Ti=vn.getTime()-bn.getTime();xt=1+Math.round(Ti/6048e5)}return _n(xt,F,it(fe,je.MinusSign))}}function Gt(F,Me=!1){return function(q,fe){return _n(yt(q).getFullYear(),F,it(fe,je.MinusSign),Me)}}const Vt={};function Jt(F,Me){F=F.replace(/:/g,"");const q=Date.parse("Jan 01, 1970 00:00:00 "+F)/6e4;return isNaN(q)?Me:q}function G(F){return F instanceof Date&&!isNaN(F.valueOf())}const ze=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function qi(F){const Me=parseInt(F);if(isNaN(Me))throw new Error("Invalid integer literal when parsing "+F);return Me}function Mt(F,Me){Me=encodeURIComponent(Me);for(const q of F.split(";")){const fe=q.indexOf("="),[xt,vn]=-1==fe?[q,""]:[q.slice(0,fe),q.slice(fe+1)];if(xt.trim()===Me)return decodeURIComponent(vn)}return null}class Wn{constructor(Me,q,fe,xt){this.$implicit=Me,this.ngForOf=q,this.index=fe,this.count=xt}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let lr=(()=>{class F{set ngForOf(q){this._ngForOf=q,this._ngForOfDirty=!0}set ngForTrackBy(q){this._trackByFn=q}get ngForTrackBy(){return this._trackByFn}constructor(q,fe,xt){this._viewContainer=q,this._template=fe,this._differs=xt,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(q){q&&(this._template=q)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const q=this._ngForOf;!this._differ&&q&&(this._differ=this._differs.find(q).create(this.ngForTrackBy))}if(this._differ){const q=this._differ.diff(this._ngForOf);q&&this._applyChanges(q)}}_applyChanges(q){const fe=this._viewContainer;q.forEachOperation((xt,vn,bn)=>{if(null==xt.previousIndex)fe.createEmbeddedView(this._template,new Wn(xt.item,this._ngForOf,-1,-1),null===bn?void 0:bn);else if(null==bn)fe.remove(null===vn?void 0:vn);else if(null!==vn){const Ti=fe.get(vn);fe.move(Ti,bn),Je(Ti,xt)}});for(let xt=0,vn=fe.length;xt<vn;xt++){const Ti=fe.get(xt).context;Ti.index=xt,Ti.count=vn,Ti.ngForOf=this._ngForOf}q.forEachIdentityChange(xt=>{Je(fe.get(xt.currentIndex),xt)})}static ngTemplateContextGuard(q,fe){return!0}static#e=this.\u0275fac=function(fe){return new(fe||F)(h.Y36(h.s_b),h.Y36(h.Rgc),h.Y36(h.ZZ4))};static#t=this.\u0275dir=h.lG2({type:F,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return F})();function Je(F,Me){F.context.$implicit=Me.item}let we=(()=>{class F{constructor(q,fe){this._viewContainer=q,this._context=new ut,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=fe}set ngIf(q){this._context.$implicit=this._context.ngIf=q,this._updateView()}set ngIfThen(q){dt("ngIfThen",q),this._thenTemplateRef=q,this._thenViewRef=null,this._updateView()}set ngIfElse(q){dt("ngIfElse",q),this._elseTemplateRef=q,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(q,fe){return!0}static#e=this.\u0275fac=function(fe){return new(fe||F)(h.Y36(h.s_b),h.Y36(h.Rgc))};static#t=this.\u0275dir=h.lG2({type:F,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return F})();class ut{constructor(){this.$implicit=null,this.ngIf=null}}function dt(F,Me){if(Me&&!Me.createEmbeddedView)throw new Error(`${F} must be a TemplateRef, but received '${(0,h.AaK)(Me)}'.`)}let yn=(()=>{class F{constructor(q){this._viewContainerRef=q,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(q){if(this._shouldRecreateView(q)){const fe=this._viewContainerRef;if(this._viewRef&&fe.remove(fe.indexOf(this._viewRef)),!this.ngTemplateOutlet)return void(this._viewRef=null);const xt=this._createContextForwardProxy();this._viewRef=fe.createEmbeddedView(this.ngTemplateOutlet,xt,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(q){return!!q.ngTemplateOutlet||!!q.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(q,fe,xt)=>!!this.ngTemplateOutletContext&&Reflect.set(this.ngTemplateOutletContext,fe,xt),get:(q,fe,xt)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,fe,xt)}})}static#e=this.\u0275fac=function(fe){return new(fe||F)(h.Y36(h.s_b))};static#t=this.\u0275dir=h.lG2({type:F,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[h.TTD]})}return F})();function Fn(F,Me){return new h.vHH(2100,!1)}const H=new h.OlP("DATE_PIPE_DEFAULT_TIMEZONE"),Ze=new h.OlP("DATE_PIPE_DEFAULT_OPTIONS");let Bt=(()=>{class F{constructor(q,fe,xt){this.locale=q,this.defaultTimezone=fe,this.defaultOptions=xt}transform(q,fe,xt,vn){if(null==q||""===q||q!=q)return null;try{return Oi(q,fe??this.defaultOptions?.dateFormat??"mediumDate",vn||this.locale,xt??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(bn){throw Fn()}}static#e=this.\u0275fac=function(fe){return new(fe||F)(h.Y36(h.soG,16),h.Y36(H,24),h.Y36(Ze,24))};static#t=this.\u0275pipe=h.Yjl({name:"date",type:F,pure:!0,standalone:!0})}return F})(),Bs=(()=>{class F{constructor(q){this._locale=q}transform(q,fe,xt){if(!function jo(F){return!(null==F||""===F||F!=F)}(q))return null;xt=xt||this._locale;try{return function Io(F,Me,q){return function Fr(F,Me,q,fe,xt,vn,bn=!1){let Ti="",Ur=!1;if(isFinite(F)){let Lr=function Ro(F){let fe,xt,vn,bn,Ti,Me=Math.abs(F)+"",q=0;for((xt=Me.indexOf("."))>-1&&(Me=Me.replace(".","")),(vn=Me.search(/e/i))>0?(xt<0&&(xt=vn),xt+=+Me.slice(vn+1),Me=Me.substring(0,vn)):xt<0&&(xt=Me.length),vn=0;"0"===Me.charAt(vn);vn++);if(vn===(Ti=Me.length))fe=[0],xt=1;else{for(Ti--;"0"===Me.charAt(Ti);)Ti--;for(xt-=vn,fe=[],bn=0;vn<=Ti;vn++,bn++)fe[bn]=Number(Me.charAt(vn))}return xt>22&&(fe=fe.splice(0,21),q=xt-1,xt=1),{digits:fe,exponent:q,integerLen:xt}}(F);bn&&(Lr=function ao(F){if(0===F.digits[0])return F;const Me=F.digits.length-F.integerLen;return F.exponent?F.exponent+=2:(0===Me?F.digits.push(0,0):1===Me&&F.digits.push(0),F.integerLen+=2),F}(Lr));let Sr=Me.minInt,sr=Me.minFrac,Pr=Me.maxFrac;if(vn){const $o=vn.match(ze);if(null===$o)throw new Error(`${vn} is not a valid digit info`);const fs=$o[1],Yo=$o[3],Zs=$o[5];null!=fs&&(Sr=qi(fs)),null!=Yo&&(sr=qi(Yo)),null!=Zs?Pr=qi(Zs):null!=Yo&&sr>Pr&&(Pr=sr)}!function xo(F,Me,q){if(Me>q)throw new Error(`The minimum number of digits after fraction (${Me}) is higher than the maximum (${q}).`);let fe=F.digits,xt=fe.length-F.integerLen;const vn=Math.min(Math.max(Me,xt),q);let bn=vn+F.integerLen,Ti=fe[bn];if(bn>0){fe.splice(Math.max(F.integerLen,bn));for(let sr=bn;sr<fe.length;sr++)fe[sr]=0}else{xt=Math.max(0,xt),F.integerLen=1,fe.length=Math.max(1,bn=vn+1),fe[0]=0;for(let sr=1;sr<bn;sr++)fe[sr]=0}if(Ti>=5)if(bn-1<0){for(let sr=0;sr>bn;sr--)fe.unshift(0),F.integerLen++;fe.unshift(1),F.integerLen++}else fe[bn-1]++;for(;xt<Math.max(0,vn);xt++)fe.push(0);let Ur=0!==vn;const Lr=Me+F.integerLen,Sr=fe.reduceRight(function(sr,Pr,hr,So){return So[hr]=(Pr+=sr)<10?Pr:Pr-10,Ur&&(0===So[hr]&&hr>=Lr?So.pop():Ur=!1),Pr>=10?1:0},0);Sr&&(fe.unshift(Sr),F.integerLen++)}(Lr,sr,Pr);let hr=Lr.digits,So=Lr.integerLen;const $s=Lr.exponent;let qo=[];for(Ur=hr.every($o=>!$o);So<Sr;So++)hr.unshift(0);for(;So<0;So++)hr.unshift(0);So>0?qo=hr.splice(So,hr.length):(qo=hr,hr=[0]);const hs=[];for(hr.length>=Me.lgSize&&hs.unshift(hr.splice(-Me.lgSize,hr.length).join(""));hr.length>Me.gSize;)hs.unshift(hr.splice(-Me.gSize,hr.length).join(""));hr.length&&hs.unshift(hr.join("")),Ti=hs.join(it(q,fe)),qo.length&&(Ti+=it(q,xt)+qo.join("")),$s&&(Ti+=it(q,je.Exponential)+"+"+$s)}else Ti=it(q,je.Infinity);return Ti=F<0&&!Ur?Me.negPre+Ti+Me.negSuf:Me.posPre+Ti+Me.posSuf,Ti}(F,function Zi(F,Me="-"){const q={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},fe=F.split(";"),xt=fe[0],vn=fe[1],bn=-1!==xt.indexOf(".")?xt.split("."):[xt.substring(0,xt.lastIndexOf("0")+1),xt.substring(xt.lastIndexOf("0")+1)],Ti=bn[0],Ur=bn[1]||"";q.posPre=Ti.substring(0,Ti.indexOf("#"));for(let Sr=0;Sr<Ur.length;Sr++){const sr=Ur.charAt(Sr);"0"===sr?q.minFrac=q.maxFrac=Sr+1:"#"===sr?q.maxFrac=Sr+1:q.posSuf+=sr}const Lr=Ti.split(",");if(q.gSize=Lr[1]?Lr[1].length:0,q.lgSize=Lr[2]||Lr[1]?(Lr[2]||Lr[1]).length:0,vn){const Sr=xt.length-q.posPre.length-q.posSuf.length,sr=vn.indexOf("#");q.negPre=vn.substring(0,sr).replace(/'/g,""),q.negSuf=vn.slice(sr+Sr).replace(/'/g,"")}else q.negPre=Me+q.posPre,q.negSuf=q.posSuf;return q}(function _t(F,Me){return(0,h.cg1)(F)[h.wAp.NumberFormats][Me]}(Me,Ge.Decimal),it(Me,je.MinusSign)),Me,je.Group,je.Decimal,q)}(function Go(F){if("string"==typeof F&&!isNaN(Number(F)-parseFloat(F)))return Number(F);if("number"!=typeof F)throw new Error(`${F} is not a number`);return F}(q),xt,fe)}catch(vn){throw Fn()}}static#e=this.\u0275fac=function(fe){return new(fe||F)(h.Y36(h.soG,16))};static#t=this.\u0275pipe=h.Yjl({name:"number",type:F,pure:!0,standalone:!0})}return F})();let zs=(()=>{class F{static#e=this.\u0275fac=function(fe){return new(fe||F)};static#t=this.\u0275mod=h.oAB({type:F});static#n=this.\u0275inj=h.cJS({})}return F})();const lo="browser",Aa="server";function Lo(F){return F===Aa}let na=(()=>{class F{static#e=this.\u0275prov=(0,h.Yz7)({token:F,providedIn:"root",factory:()=>new Us((0,h.LFG)(K),window)})}return F})();class Us{constructor(Me,q){this.document=Me,this.window=q,this.offset=()=>[0,0]}setOffset(Me){this.offset=Array.isArray(Me)?()=>Me:Me}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(Me){this.supportsScrolling()&&this.window.scrollTo(Me[0],Me[1])}scrollToAnchor(Me){if(!this.supportsScrolling())return;const q=function Za(F,Me){const q=F.getElementById(Me)||F.getElementsByName(Me)[0];if(q)return q;if("function"==typeof F.createTreeWalker&&F.body&&"function"==typeof F.body.attachShadow){const fe=F.createTreeWalker(F.body,NodeFilter.SHOW_ELEMENT);let xt=fe.currentNode;for(;xt;){const vn=xt.shadowRoot;if(vn){const bn=vn.getElementById(Me)||vn.querySelector(`[name="${Me}"]`);if(bn)return bn}xt=fe.nextNode()}}return null}(this.document,Me);q&&(this.scrollToElement(q),q.focus())}setHistoryScrollRestoration(Me){this.supportsScrolling()&&(this.window.history.scrollRestoration=Me)}scrollToElement(Me){const q=Me.getBoundingClientRect(),fe=q.left+this.window.pageXOffset,xt=q.top+this.window.pageYOffset,vn=this.offset();this.window.scrollTo(fe-vn[0],xt-vn[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class cs{}},9862:(zn,wt,S)=>{"use strict";S.d(wt,{JF:()=>gi,TP:()=>Dt,WM:()=>De,eN:()=>pe}),S(5861);var p=S(8564),X=S(2096),a=S(5592),j=S(7715),K=S(6328),C=S(2181),oe=S(7398),_e=S(4716),Le=S(4664),ee=S(6814);class Te{}class ye{}class De{constructor(Tt){this.normalizedNames=new Map,this.lazyUpdate=null,Tt?"string"==typeof Tt?this.lazyInit=()=>{this.headers=new Map,Tt.split("\n").forEach(Mt=>{const Qt=Mt.indexOf(":");if(Qt>0){const wn=Mt.slice(0,Qt),It=wn.toLowerCase(),Xn=Mt.slice(Qt+1).trim();this.maybeSetNormalizedName(wn,It),this.headers.has(It)?this.headers.get(It).push(Xn):this.headers.set(It,[Xn])}})}:typeof Headers<"u"&&Tt instanceof Headers?(this.headers=new Map,Tt.forEach((Mt,Qt)=>{this.setHeaderEntries(Qt,Mt)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(Tt).forEach(([Mt,Qt])=>{this.setHeaderEntries(Mt,Qt)})}:this.headers=new Map}has(Tt){return this.init(),this.headers.has(Tt.toLowerCase())}get(Tt){this.init();const Mt=this.headers.get(Tt.toLowerCase());return Mt&&Mt.length>0?Mt[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(Tt){return this.init(),this.headers.get(Tt.toLowerCase())||null}append(Tt,Mt){return this.clone({name:Tt,value:Mt,op:"a"})}set(Tt,Mt){return this.clone({name:Tt,value:Mt,op:"s"})}delete(Tt,Mt){return this.clone({name:Tt,value:Mt,op:"d"})}maybeSetNormalizedName(Tt,Mt){this.normalizedNames.has(Mt)||this.normalizedNames.set(Mt,Tt)}init(){this.lazyInit&&(this.lazyInit instanceof De?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(Tt=>this.applyUpdate(Tt)),this.lazyUpdate=null))}copyFrom(Tt){Tt.init(),Array.from(Tt.headers.keys()).forEach(Mt=>{this.headers.set(Mt,Tt.headers.get(Mt)),this.normalizedNames.set(Mt,Tt.normalizedNames.get(Mt))})}clone(Tt){const Mt=new De;return Mt.lazyInit=this.lazyInit&&this.lazyInit instanceof De?this.lazyInit:this,Mt.lazyUpdate=(this.lazyUpdate||[]).concat([Tt]),Mt}applyUpdate(Tt){const Mt=Tt.name.toLowerCase();switch(Tt.op){case"a":case"s":let Qt=Tt.value;if("string"==typeof Qt&&(Qt=[Qt]),0===Qt.length)return;this.maybeSetNormalizedName(Tt.name,Mt);const wn=("a"===Tt.op?this.headers.get(Mt):void 0)||[];wn.push(...Qt),this.headers.set(Mt,wn);break;case"d":const It=Tt.value;if(It){let Xn=this.headers.get(Mt);if(!Xn)return;Xn=Xn.filter(ui=>-1===It.indexOf(ui)),0===Xn.length?(this.headers.delete(Mt),this.normalizedNames.delete(Mt)):this.headers.set(Mt,Xn)}else this.headers.delete(Mt),this.normalizedNames.delete(Mt)}}setHeaderEntries(Tt,Mt){const Qt=(Array.isArray(Mt)?Mt:[Mt]).map(It=>It.toString()),wn=Tt.toLowerCase();this.headers.set(wn,Qt),this.maybeSetNormalizedName(Tt,wn)}forEach(Tt){this.init(),Array.from(this.normalizedNames.keys()).forEach(Mt=>Tt(this.normalizedNames.get(Mt),this.headers.get(Mt)))}}class Ye{encodeKey(Tt){return Be(Tt)}encodeValue(Tt){return Be(Tt)}decodeKey(Tt){return decodeURIComponent(Tt)}decodeValue(Tt){return decodeURIComponent(Tt)}}const de=/%(\d[a-f0-9])/gi,Pe={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Be(Yt){return encodeURIComponent(Yt).replace(de,(Tt,Mt)=>Pe[Mt]??Tt)}function Ne(Yt){return`${Yt}`}class Ae{constructor(Tt={}){if(this.updates=null,this.cloneFrom=null,this.encoder=Tt.encoder||new Ye,Tt.fromString){if(Tt.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function Ce(Yt,Tt){const Mt=new Map;return Yt.length>0&&Yt.replace(/^\?/,"").split("&").forEach(wn=>{const It=wn.indexOf("="),[Xn,ui]=-1==It?[Tt.decodeKey(wn),""]:[Tt.decodeKey(wn.slice(0,It)),Tt.decodeValue(wn.slice(It+1))],Wn=Mt.get(Xn)||[];Wn.push(ui),Mt.set(Xn,Wn)}),Mt}(Tt.fromString,this.encoder)}else Tt.fromObject?(this.map=new Map,Object.keys(Tt.fromObject).forEach(Mt=>{const Qt=Tt.fromObject[Mt],wn=Array.isArray(Qt)?Qt.map(Ne):[Ne(Qt)];this.map.set(Mt,wn)})):this.map=null}has(Tt){return this.init(),this.map.has(Tt)}get(Tt){this.init();const Mt=this.map.get(Tt);return Mt?Mt[0]:null}getAll(Tt){return this.init(),this.map.get(Tt)||null}keys(){return this.init(),Array.from(this.map.keys())}append(Tt,Mt){return this.clone({param:Tt,value:Mt,op:"a"})}appendAll(Tt){const Mt=[];return Object.keys(Tt).forEach(Qt=>{const wn=Tt[Qt];Array.isArray(wn)?wn.forEach(It=>{Mt.push({param:Qt,value:It,op:"a"})}):Mt.push({param:Qt,value:wn,op:"a"})}),this.clone(Mt)}set(Tt,Mt){return this.clone({param:Tt,value:Mt,op:"s"})}delete(Tt,Mt){return this.clone({param:Tt,value:Mt,op:"d"})}toString(){return this.init(),this.keys().map(Tt=>{const Mt=this.encoder.encodeKey(Tt);return this.map.get(Tt).map(Qt=>Mt+"="+this.encoder.encodeValue(Qt)).join("&")}).filter(Tt=>""!==Tt).join("&")}clone(Tt){const Mt=new Ae({encoder:this.encoder});return Mt.cloneFrom=this.cloneFrom||this,Mt.updates=(this.updates||[]).concat(Tt),Mt}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(Tt=>this.map.set(Tt,this.cloneFrom.map.get(Tt))),this.updates.forEach(Tt=>{switch(Tt.op){case"a":case"s":const Mt=("a"===Tt.op?this.map.get(Tt.param):void 0)||[];Mt.push(Ne(Tt.value)),this.map.set(Tt.param,Mt);break;case"d":if(void 0===Tt.value){this.map.delete(Tt.param);break}{let Qt=this.map.get(Tt.param)||[];const wn=Qt.indexOf(Ne(Tt.value));-1!==wn&&Qt.splice(wn,1),Qt.length>0?this.map.set(Tt.param,Qt):this.map.delete(Tt.param)}}}),this.cloneFrom=this.updates=null)}}class lt{constructor(){this.map=new Map}set(Tt,Mt){return this.map.set(Tt,Mt),this}get(Tt){return this.map.has(Tt)||this.map.set(Tt,Tt.defaultValue()),this.map.get(Tt)}delete(Tt){return this.map.delete(Tt),this}has(Tt){return this.map.has(Tt)}keys(){return this.map.keys()}}function Ee(Yt){return typeof ArrayBuffer<"u"&&Yt instanceof ArrayBuffer}function xe(Yt){return typeof Blob<"u"&&Yt instanceof Blob}function je(Yt){return typeof FormData<"u"&&Yt instanceof FormData}class Ve{constructor(Tt,Mt,Qt,wn){let It;if(this.url=Mt,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=Tt.toUpperCase(),function ne(Yt){switch(Yt){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||wn?(this.body=void 0!==Qt?Qt:null,It=wn):It=Qt,It&&(this.reportProgress=!!It.reportProgress,this.withCredentials=!!It.withCredentials,It.responseType&&(this.responseType=It.responseType),It.headers&&(this.headers=It.headers),It.context&&(this.context=It.context),It.params&&(this.params=It.params),this.transferCache=It.transferCache),this.headers||(this.headers=new De),this.context||(this.context=new lt),this.params){const Xn=this.params.toString();if(0===Xn.length)this.urlWithParams=Mt;else{const ui=Mt.indexOf("?");this.urlWithParams=Mt+(-1===ui?"?":ui<Mt.length-1?"&":"")+Xn}}else this.params=new Ae,this.urlWithParams=Mt}serializeBody(){return null===this.body?null:Ee(this.body)||xe(this.body)||je(this.body)||function Se(Yt){return typeof URLSearchParams<"u"&&Yt instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Ae?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||je(this.body)?null:xe(this.body)?this.body.type||null:Ee(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Ae?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(Tt={}){const Mt=Tt.method||this.method,Qt=Tt.url||this.url,wn=Tt.responseType||this.responseType,It=void 0!==Tt.body?Tt.body:this.body,Xn=void 0!==Tt.withCredentials?Tt.withCredentials:this.withCredentials,ui=void 0!==Tt.reportProgress?Tt.reportProgress:this.reportProgress;let Wn=Tt.headers||this.headers,lr=Tt.params||this.params;const Je=Tt.context??this.context;return void 0!==Tt.setHeaders&&(Wn=Object.keys(Tt.setHeaders).reduce((rt,we)=>rt.set(we,Tt.setHeaders[we]),Wn)),Tt.setParams&&(lr=Object.keys(Tt.setParams).reduce((rt,we)=>rt.set(we,Tt.setParams[we]),lr)),new Ve(Mt,Qt,It,{params:lr,headers:Wn,context:Je,reportProgress:ui,responseType:wn,withCredentials:Xn})}}var Xe=function(Yt){return Yt[Yt.Sent=0]="Sent",Yt[Yt.UploadProgress=1]="UploadProgress",Yt[Yt.ResponseHeader=2]="ResponseHeader",Yt[Yt.DownloadProgress=3]="DownloadProgress",Yt[Yt.Response=4]="Response",Yt[Yt.User=5]="User",Yt}(Xe||{});class Ht{constructor(Tt,Mt=200,Qt="OK"){this.headers=Tt.headers||new De,this.status=void 0!==Tt.status?Tt.status:Mt,this.statusText=Tt.statusText||Qt,this.url=Tt.url||null,this.ok=this.status>=200&&this.status<300}}class cn extends Ht{constructor(Tt={}){super(Tt),this.type=Xe.ResponseHeader}clone(Tt={}){return new cn({headers:Tt.headers||this.headers,status:void 0!==Tt.status?Tt.status:this.status,statusText:Tt.statusText||this.statusText,url:Tt.url||this.url||void 0})}}class xn extends Ht{constructor(Tt={}){super(Tt),this.type=Xe.Response,this.body=void 0!==Tt.body?Tt.body:null}clone(Tt={}){return new xn({body:void 0!==Tt.body?Tt.body:this.body,headers:Tt.headers||this.headers,status:void 0!==Tt.status?Tt.status:this.status,statusText:Tt.statusText||this.statusText,url:Tt.url||this.url||void 0})}}class $t extends Ht{constructor(Tt){super(Tt,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${Tt.url||"(unknown url)"}`:`Http failure response for ${Tt.url||"(unknown url)"}: ${Tt.status} ${Tt.statusText}`,this.error=Tt.error||null}}function ke(Yt,Tt){return{body:Tt,headers:Yt.headers,context:Yt.context,observe:Yt.observe,params:Yt.params,reportProgress:Yt.reportProgress,responseType:Yt.responseType,withCredentials:Yt.withCredentials,transferCache:Yt.transferCache}}let pe=(()=>{class Yt{constructor(Mt){this.handler=Mt}request(Mt,Qt,wn={}){let It;if(Mt instanceof Ve)It=Mt;else{let Wn,lr;Wn=wn.headers instanceof De?wn.headers:new De(wn.headers),wn.params&&(lr=wn.params instanceof Ae?wn.params:new Ae({fromObject:wn.params})),It=new Ve(Mt,Qt,void 0!==wn.body?wn.body:null,{headers:Wn,context:wn.context,params:lr,reportProgress:wn.reportProgress,responseType:wn.responseType||"json",withCredentials:wn.withCredentials,transferCache:wn.transferCache})}const Xn=(0,X.of)(It).pipe((0,K.b)(Wn=>this.handler.handle(Wn)));if(Mt instanceof Ve||"events"===wn.observe)return Xn;const ui=Xn.pipe((0,C.h)(Wn=>Wn instanceof xn));switch(wn.observe||"body"){case"body":switch(It.responseType){case"arraybuffer":return ui.pipe((0,oe.U)(Wn=>{if(null!==Wn.body&&!(Wn.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return Wn.body}));case"blob":return ui.pipe((0,oe.U)(Wn=>{if(null!==Wn.body&&!(Wn.body instanceof Blob))throw new Error("Response is not a Blob.");return Wn.body}));case"text":return ui.pipe((0,oe.U)(Wn=>{if(null!==Wn.body&&"string"!=typeof Wn.body)throw new Error("Response is not a string.");return Wn.body}));default:return ui.pipe((0,oe.U)(Wn=>Wn.body))}case"response":return ui;default:throw new Error(`Unreachable: unhandled observe type ${wn.observe}}`)}}delete(Mt,Qt={}){return this.request("DELETE",Mt,Qt)}get(Mt,Qt={}){return this.request("GET",Mt,Qt)}head(Mt,Qt={}){return this.request("HEAD",Mt,Qt)}jsonp(Mt,Qt){return this.request("JSONP",Mt,{params:(new Ae).append(Qt,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Mt,Qt={}){return this.request("OPTIONS",Mt,Qt)}patch(Mt,Qt,wn={}){return this.request("PATCH",Mt,ke(wn,Qt))}post(Mt,Qt,wn={}){return this.request("POST",Mt,ke(wn,Qt))}put(Mt,Qt,wn={}){return this.request("PUT",Mt,ke(wn,Qt))}static#e=this.\u0275fac=function(Qt){return new(Qt||Yt)(p.LFG(Te))};static#t=this.\u0275prov=p.Yz7({token:Yt,factory:Yt.\u0275fac})}return Yt})();function qn(Yt,Tt){return Tt(Yt)}function li(Yt,Tt){return(Mt,Qt)=>Tt.intercept(Mt,{handle:wn=>Yt(wn,Qt)})}const Dt=new p.OlP(""),Ie=new p.OlP(""),Ct=new p.OlP(""),on=new p.OlP("");function Rn(){let Yt=null;return(Tt,Mt)=>{null===Yt&&(Yt=((0,p.f3M)(Dt,{optional:!0})??[]).reduceRight(li,qn));const Qt=(0,p.f3M)(p.HDt),wn=Qt.add();return Yt(Tt,Mt).pipe((0,_e.x)(()=>Qt.remove(wn)))}}let Hn=(()=>{class Yt extends Te{constructor(Mt,Qt){super(),this.backend=Mt,this.injector=Qt,this.chain=null,this.pendingTasks=(0,p.f3M)(p.HDt);const wn=(0,p.f3M)(on,{optional:!0});this.backend=wn??Mt}handle(Mt){if(null===this.chain){const wn=Array.from(new Set([...this.injector.get(Ie),...this.injector.get(Ct,[])]));this.chain=wn.reduceRight((It,Xn)=>function en(Yt,Tt,Mt){return(Qt,wn)=>Mt.runInContext(()=>Tt(Qt,It=>Yt(It,wn)))}(It,Xn,this.injector),qn)}const Qt=this.pendingTasks.add();return this.chain(Mt,wn=>this.backend.handle(wn)).pipe((0,_e.x)(()=>this.pendingTasks.remove(Qt)))}static#e=this.\u0275fac=function(Qt){return new(Qt||Yt)(p.LFG(ye),p.LFG(p.lqb))};static#t=this.\u0275prov=p.Yz7({token:Yt,factory:Yt.\u0275fac})}return Yt})();const Bi=/^\)\]\}',?\n/;let sn=(()=>{class Yt{constructor(Mt){this.xhrFactory=Mt}handle(Mt){if("JSONP"===Mt.method)throw new p.vHH(-2800,!1);const Qt=this.xhrFactory;return(Qt.\u0275loadImpl?(0,j.D)(Qt.\u0275loadImpl()):(0,X.of)(null)).pipe((0,Le.w)(()=>new a.y(It=>{const Xn=Qt.build();if(Xn.open(Mt.method,Mt.urlWithParams),Mt.withCredentials&&(Xn.withCredentials=!0),Mt.headers.forEach((Lt,gn)=>Xn.setRequestHeader(Lt,gn.join(","))),Mt.headers.has("Accept")||Xn.setRequestHeader("Accept","application/json, text/plain, */*"),!Mt.headers.has("Content-Type")){const Lt=Mt.detectContentTypeHeader();null!==Lt&&Xn.setRequestHeader("Content-Type",Lt)}if(Mt.responseType){const Lt=Mt.responseType.toLowerCase();Xn.responseType="json"!==Lt?Lt:"text"}const ui=Mt.serializeBody();let Wn=null;const lr=()=>{if(null!==Wn)return Wn;const Lt=Xn.statusText||"OK",gn=new De(Xn.getAllResponseHeaders()),ti=function pn(Yt){return"responseURL"in Yt&&Yt.responseURL?Yt.responseURL:/^X-Request-URL:/m.test(Yt.getAllResponseHeaders())?Yt.getResponseHeader("X-Request-URL"):null}(Xn)||Mt.url;return Wn=new cn({headers:gn,status:Xn.status,statusText:Lt,url:ti}),Wn},Je=()=>{let{headers:Lt,status:gn,statusText:ti,url:di}=lr(),Kn=null;204!==gn&&(Kn=typeof Xn.response>"u"?Xn.responseText:Xn.response),0===gn&&(gn=Kn?200:0);let Xi=gn>=200&&gn<300;if("json"===Mt.responseType&&"string"==typeof Kn){const J=Kn;Kn=Kn.replace(Bi,"");try{Kn=""!==Kn?JSON.parse(Kn):null}catch(be){Kn=J,Xi&&(Xi=!1,Kn={error:be,text:Kn})}}Xi?(It.next(new xn({body:Kn,headers:Lt,status:gn,statusText:ti,url:di||void 0})),It.complete()):It.error(new $t({error:Kn,headers:Lt,status:gn,statusText:ti,url:di||void 0}))},rt=Lt=>{const{url:gn}=lr(),ti=new $t({error:Lt,status:Xn.status||0,statusText:Xn.statusText||"Unknown Error",url:gn||void 0});It.error(ti)};let we=!1;const ut=Lt=>{we||(It.next(lr()),we=!0);let gn={type:Xe.DownloadProgress,loaded:Lt.loaded};Lt.lengthComputable&&(gn.total=Lt.total),"text"===Mt.responseType&&Xn.responseText&&(gn.partialText=Xn.responseText),It.next(gn)},dt=Lt=>{let gn={type:Xe.UploadProgress,loaded:Lt.loaded};Lt.lengthComputable&&(gn.total=Lt.total),It.next(gn)};return Xn.addEventListener("load",Je),Xn.addEventListener("error",rt),Xn.addEventListener("timeout",rt),Xn.addEventListener("abort",rt),Mt.reportProgress&&(Xn.addEventListener("progress",ut),null!==ui&&Xn.upload&&Xn.upload.addEventListener("progress",dt)),Xn.send(ui),It.next({type:Xe.Sent}),()=>{Xn.removeEventListener("error",rt),Xn.removeEventListener("abort",rt),Xn.removeEventListener("load",Je),Xn.removeEventListener("timeout",rt),Mt.reportProgress&&(Xn.removeEventListener("progress",ut),null!==ui&&Xn.upload&&Xn.upload.removeEventListener("progress",dt)),Xn.readyState!==Xn.DONE&&Xn.abort()}})))}static#e=this.\u0275fac=function(Qt){return new(Qt||Yt)(p.LFG(ee.JF))};static#t=this.\u0275prov=p.Yz7({token:Yt,factory:Yt.\u0275fac})}return Yt})();const Cn=new p.OlP("XSRF_ENABLED"),ct=new p.OlP("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),se=new p.OlP("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class tt{}let yt=(()=>{class Yt{constructor(Mt,Qt,wn){this.doc=Mt,this.platform=Qt,this.cookieName=wn,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Mt=this.doc.cookie||"";return Mt!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,ee.Mx)(Mt,this.cookieName),this.lastCookieString=Mt),this.lastToken}static#e=this.\u0275fac=function(Qt){return new(Qt||Yt)(p.LFG(ee.K0),p.LFG(p.Lbi),p.LFG(ct))};static#t=this.\u0275prov=p.Yz7({token:Yt,factory:Yt.\u0275fac})}return Yt})();function Ot(Yt,Tt){const Mt=Yt.url.toLowerCase();if(!(0,p.f3M)(Cn)||"GET"===Yt.method||"HEAD"===Yt.method||Mt.startsWith("http://")||Mt.startsWith("https://"))return Tt(Yt);const Qt=(0,p.f3M)(tt).getToken(),wn=(0,p.f3M)(se);return null!=Qt&&!Yt.headers.has(wn)&&(Yt=Yt.clone({headers:Yt.headers.set(wn,Qt)})),Tt(Yt)}var Vt=function(Yt){return Yt[Yt.Interceptors=0]="Interceptors",Yt[Yt.LegacyInterceptors=1]="LegacyInterceptors",Yt[Yt.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",Yt[Yt.NoXsrfProtection=3]="NoXsrfProtection",Yt[Yt.JsonpSupport=4]="JsonpSupport",Yt[Yt.RequestsMadeViaParent=5]="RequestsMadeViaParent",Yt[Yt.Fetch=6]="Fetch",Yt}(Vt||{});function Jt(...Yt){const Tt=[pe,sn,Hn,{provide:Te,useExisting:Hn},{provide:ye,useExisting:sn},{provide:Ie,useValue:Ot,multi:!0},{provide:Cn,useValue:!0},{provide:tt,useClass:yt}];for(const Mt of Yt)Tt.push(...Mt.\u0275providers);return(0,p.MR2)(Tt)}const mn=new p.OlP("LEGACY_INTERCEPTOR_FN");function ae(){return function Et(Yt,Tt){return{\u0275kind:Yt,\u0275providers:Tt}}(Vt.LegacyInterceptors,[{provide:mn,useFactory:Rn},{provide:Ie,useExisting:mn,multi:!0}])}let gi=(()=>{class Yt{static#e=this.\u0275fac=function(Qt){return new(Qt||Yt)};static#t=this.\u0275mod=p.oAB({type:Yt});static#n=this.\u0275inj=p.cJS({providers:[Jt(ae())]})}return Yt})()},8564:(zn,wt,S)=>{"use strict";S.d(wt,{tb:()=>A0,AFp:()=>Ip,ip1:()=>ww,hGG:()=>jM,z2F:()=>lp,Ojb:()=>Ap,sBO:()=>kn,Sil:()=>XI,EJc:()=>HI,Xts:()=>fu,SBq:()=>mc,lqb:()=>Fa,qLn:()=>$c,vpe:()=>kr,XFs:()=>Lt,OlP:()=>mt,zs3:()=>al,ZZ4:()=>xm,aQg:()=>yd,soG:()=>iy,YKP:()=>Ob,h0i:()=>_h,R0b:()=>xr,FiY:()=>dc,Lbi:()=>Lc,g9A:()=>Mp,Qsj:()=>o_,FYo:()=>mm,JOm:()=>td,tp0:()=>Zu,Rgc:()=>sg,dDg:()=>CM,eoX:()=>Ow,GfV:()=>s_,s_b:()=>B_,ifc:()=>fo,T8G:()=>Fm,VuI:()=>lA,LMc:()=>uA,MMx:()=>Lb,Lck:()=>jD,eFA:()=>Fw,G48:()=>kM,Gpc:()=>pn,f3M:()=>_r,$WT:()=>le,MR2:()=>_p,_c5:()=>UM,qFp:()=>dA,r_H:()=>Wu,rg0:()=>nh,c2e:()=>Cw,zSh:()=>fc,HDt:()=>Tw,wAp:()=>rp,vHH:()=>se,lri:()=>Sw,rWj:()=>Pw,cg1:()=>Jv,kuF:()=>tt,kL8:()=>E1,dqk:()=>J,Z0I:()=>ui,eJc:()=>pc,QGY:()=>Qv,F4k:()=>K1,RDi:()=>Ba,AaK:()=>ki,qOj:()=>yv,Xq5:()=>ux,TTD:()=>Yo,_Bn:()=>Pb,jDz:()=>kb,xp6:()=>Em,uIk:()=>vv,ekj:()=>Dv,Suo:()=>nw,Xpm:()=>Ol,lG2:()=>Ya,Yz7:()=>Qt,cJS:()=>It,oAB:()=>qa,Yjl:()=>pl,Y36:()=>Zc,_UZ:()=>qv,GkF:()=>Yv,BQk:()=>W_,ynx:()=>H_,qZA:()=>G_,TgZ:()=>Z_,EpF:()=>b1,n5z:()=>Ch,LFG:()=>cr,$8M:()=>Bu,$Z:()=>__,NdJ:()=>e0,CRH:()=>iw,oxw:()=>nb,ALo:()=>Yb,lcZ:()=>Jb,xi3:()=>Kb,Hsn:()=>rb,F$t:()=>ib,Q6J:()=>Cv,s9C:()=>t0,DdM:()=>$b,iGM:()=>ew,MAs:()=>fb,KtG:()=>xa,CHM:()=>Ws,LSH:()=>Ss,P3R:()=>wu,Udp:()=>Tv,YNc:()=>Jf,_uU:()=>Cb,Oqu:()=>r0,hij:()=>X_,AsE:()=>o0,lnq:()=>s0,HOy:()=>a0,Gf:()=>tw});let p=null,a=1;function K(t){const i=p;return p=t,i}function ye(t){if((!Ge(t)||t.dirty)&&(t.dirty||t.lastCleanEpoch!==a)){if(!t.producerMustRecompute(t)&&!Pe(t))return t.dirty=!1,void(t.lastCleanEpoch=a);t.producerRecomputeValue(t),t.dirty=!1,t.lastCleanEpoch=a}}function Pe(t){lt(t);for(let i=0;i<t.producerNode.length;i++){const s=t.producerNode[i],u=t.producerLastReadVersion[i];if(u!==s.version||(ye(s),u!==s.version))return!0}return!1}function Ae(t,i){if(function ne(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}(t),lt(t),1===t.liveConsumerNode.length)for(let u=0;u<t.producerNode.length;u++)Ae(t.producerNode[u],t.producerIndexOfThis[u]);const s=t.liveConsumerNode.length-1;if(t.liveConsumerNode[i]=t.liveConsumerNode[s],t.liveConsumerIndexOfThis[i]=t.liveConsumerIndexOfThis[s],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,i<t.liveConsumerNode.length){const u=t.liveConsumerIndexOfThis[i],g=t.liveConsumerNode[i];lt(g),g.producerIndexOfThis[u]=i}}function Ge(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function lt(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}let Ht=null;var Dt=S(8645),Ie=S(7394),Ct=S(5592),on=S(7537),Rn=S(4829),Vn=S(6232),Ut=S(4564),Hn=S(7715),Nt=S(5619),Xt=S(2096),Tn=S(3020),oi=S(4664),xi=S(3997);function Oi(t){for(let i in t)if(t[i]===Oi)return i;throw Error("Could not find renamed property on target object.")}function gr(t,i){for(const s in i)i.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(t[s]=i[s])}function ki(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(ki).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const i=t.toString();if(null==i)return""+i;const s=i.indexOf("\n");return-1===s?i:i.substring(0,s)}function Wi(t,i){return null==t||""===t?null===i?"":i:null==i||""===i?t:t+" "+i}const Bi=Oi({__forward_ref__:Oi});function pn(t){return t.__forward_ref__=pn,t.toString=function(){return ki(this())},t}function sn(t){return Cn(t)?t():t}function Cn(t){return"function"==typeof t&&t.hasOwnProperty(Bi)&&t.__forward_ref__===pn}function $i(t){return t&&!!t.\u0275providers}const ge="https://g.co/ng/security#xss";class se extends Error{constructor(i,s){super(tt(i,s)),this.code=i}}function tt(t,i){return`NG0${Math.abs(t)}${i?": "+i:""}`}const yt=Oi({\u0275cmp:Oi}),Ot=Oi({\u0275dir:Oi}),Gt=Oi({\u0275pipe:Oi}),Vt=Oi({\u0275mod:Oi}),Et=Oi({\u0275fac:Oi}),Jt=Oi({__NG_ELEMENT_ID__:Oi}),Bn=Oi({__NG_ENV_ID__:Oi});function mn(t){return"string"==typeof t?t:null==t?"":String(t)}function Dn(t,i){throw new se(-201,!1)}function qi(t,i){null==t&&function Ci(t,i,s,u){throw new Error(`ASSERTION ERROR: ${t}`+(null==u?"":` [Expected=> ${s} ${u} ${i} <=Actual]`))}(i,t,null,"!=")}function Qt(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function It(t){return{providers:t.providers||[],imports:t.imports||[]}}function Xn(t){return Wn(t,rt)||Wn(t,ut)}function ui(t){return null!==Xn(t)}function Wn(t,i){return t.hasOwnProperty(i)?t[i]:null}function Je(t){return t&&(t.hasOwnProperty(we)||t.hasOwnProperty(dt))?t[we]:null}const rt=Oi({\u0275prov:Oi}),we=Oi({\u0275inj:Oi}),ut=Oi({ngInjectableDef:Oi}),dt=Oi({ngInjectorDef:Oi});var Lt=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(Lt||{});let gn;function ti(){return gn}function di(t){const i=gn;return gn=t,i}function Kn(t,i,s){const u=Xn(t);return u&&"root"==u.providedIn?void 0===u.value?u.value=u.factory():u.value:s&Lt.Optional?null:void 0!==i?i:void Dn(ki(t))}const J=globalThis;class mt{constructor(i,s){this._desc=i,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof s?this.__NG_ELEMENT_ID__=s:void 0!==s&&(this.\u0275prov=Qt({token:this,providedIn:s.providedIn||"root",factory:s.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const R={},$e="__NG_DI_FLAG__",H="ngTempTokenPath",Bt=/\n/gm,Tr="__source";let ji;function Mo(t){const i=ji;return ji=t,i}function Ns(t,i=Lt.Default){if(void 0===ji)throw new se(-203,!1);return null===ji?Kn(t,void 0,i):ji.get(t,i&Lt.Optional?null:void 0,i)}function cr(t,i=Lt.Default){return(ti()||Ns)(sn(t),i)}function _r(t,i=Lt.Default){return cr(t,Uo(i))}function Uo(t){return typeof t>"u"||"number"==typeof t?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function jo(t){const i=[];for(let s=0;s<t.length;s++){const u=sn(t[s]);if(Array.isArray(u)){if(0===u.length)throw new se(900,!1);let g,x=Lt.Default;for(let T=0;T<u.length;T++){const A=u[T],k=Al(A);"number"==typeof k?-1===k?g=A.token:x|=k:g=A}i.push(cr(g,x))}else i.push(cr(u))}return i}function Go(t,i){return t[$e]=i,t.prototype[$e]=i,t}function Al(t){return t[$e]}function lo(t){return{toString:t}.toString()}var Aa=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(Aa||{}),fo=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(fo||{});const po={},mr=[];function Lo(t,i,s){let u=t.length;for(;;){const g=t.indexOf(i,s);if(-1===g)return g;if(0===g||t.charCodeAt(g-1)<=32){const x=i.length;if(g+x===u||t.charCodeAt(g+x)<=32)return g}s=g+1}}function ns(t,i,s){let u=0;for(;u<s.length;){const g=s[u];if("number"==typeof g){if(0!==g)break;u++;const x=s[u++],T=s[u++],A=s[u++];t.setAttribute(i,T,A,x)}else{const x=g,T=s[++u];ws(x)?t.setProperty(i,x,T):t.setAttribute(i,x,T),u++}}return u}function ha(t){return 3===t||4===t||6===t}function ws(t){return 64===t.charCodeAt(0)}function na(t,i){if(null!==i&&0!==i.length)if(null===t||0===t.length)t=i.slice();else{let s=-1;for(let u=0;u<i.length;u++){const g=i[u];"number"==typeof g?s=g:0===s||Us(t,s,g,null,-1===s||2===s?i[++u]:null)}}return t}function Us(t,i,s,u,g){let x=0,T=t.length;if(-1===i)T=-1;else for(;x<t.length;){const A=t[x++];if("number"==typeof A){if(A===i){T=-1;break}if(A>i){T=x-1;break}}}for(;x<t.length;){const A=t[x];if("number"==typeof A)break;if(A===s){if(null===u)return void(null!==g&&(t[x+1]=g));if(u===t[x+1])return void(t[x+2]=g)}x++,null!==u&&x++,null!==g&&x++}-1!==T&&(t.splice(T,0,i),x=T+1),t.splice(x++,0,s),null!==u&&t.splice(x++,0,u),null!==g&&t.splice(x++,0,g)}const Za="ng-template";function fl(t,i,s){let u=0,g=!0;for(;u<t.length;){let x=t[u++];if("string"==typeof x&&g){const T=t[u++];if(s&&"class"===x&&-1!==Lo(T.toLowerCase(),i,0))return!0}else{if(1===x){for(;u<t.length&&"string"==typeof(x=t[u++]);)if(x.toLowerCase()===i)return!0;return!1}"number"==typeof x&&(g=!1)}}return!1}function cs(t){return 4===t.type&&t.value!==Za}function vr(t,i,s){return i===(4!==t.type||s?t.value:Za)}function Sl(t,i,s){let u=4;const g=t.attrs||[],x=function fa(t){for(let i=0;i<t.length;i++)if(ha(t[i]))return i;return t.length}(g);let T=!1;for(let A=0;A<i.length;A++){const k=i[A];if("number"!=typeof k){if(!T)if(4&u){if(u=2|1&u,""!==k&&!vr(t,k,s)||""===k&&1===i.length){if(Xo(u))return!1;T=!0}}else{const te=8&u?k:i[++A];if(8&u&&null!==t.attrs){if(!fl(t.attrs,te,s)){if(Xo(u))return!1;T=!0}continue}const Ke=Ql(8&u?"class":k,g,cs(t),s);if(-1===Ke){if(Xo(u))return!1;T=!0;continue}if(""!==te){let kt;kt=Ke>x?"":g[Ke+1].toLowerCase();const Zt=8&u?kt:null;if(Zt&&-1!==Lo(Zt,te,0)||2&u&&te!==kt){if(Xo(u))return!1;T=!0}}}}else{if(!T&&!Xo(u)&&!Xo(k))return!1;if(T&&Xo(k))continue;T=!1,u=k|1&u}}return Xo(u)||T}function Xo(t){return 0==(1&t)}function Ql(t,i,s,u){if(null===i)return-1;let g=0;if(u||!s){let x=!1;for(;g<i.length;){const T=i[g];if(T===t)return g;if(3===T||6===T)x=!0;else{if(1===T||2===T){let A=i[++g];for(;"string"==typeof A;)A=i[++g];continue}if(4===T)break;if(0===T){g+=4;continue}}g+=x?1:2}return-1}return function pa(t,i){let s=t.indexOf(4);if(s>-1)for(s++;s<t.length;){const u=t[s];if("number"==typeof u)return-1;if(u===i)return s;s++}return-1}(i,t)}function Ga(t,i,s=!1){for(let u=0;u<i.length;u++)if(Sl(t,i[u],s))return!0;return!1}function Ha(t,i){e:for(let s=0;s<i.length;s++){const u=i[s];if(t.length===u.length){for(let g=0;g<t.length;g++)if(t[g]!==u[g])continue e;return!0}}return!1}function js(t,i){return t?":not("+i.trim()+")":i}function bo(t){let i=t[0],s=1,u=2,g="",x=!1;for(;s<t.length;){let T=t[s];if("string"==typeof T)if(2&u){const A=t[++s];g+="["+T+(A.length>0?'="'+A+'"':"")+"]"}else 8&u?g+="."+T:4&u&&(g+=" "+T);else""!==g&&!Xo(T)&&(i+=js(x,g),g=""),u=T,x=x||!Xo(u);s++}return""!==g&&(i+=js(x,g)),i}function Ol(t){return lo(()=>{const i=W(t),s={...i,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===Aa.OnPush,directiveDefs:null,pipeDefs:null,dependencies:i.standalone&&t.dependencies||null,getStandaloneInjector:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||fo.Emulated,styles:t.styles||mr,_:null,schemas:t.schemas||null,tView:null,id:""};He(s);const u=t.dependencies;return s.directiveDefs=zt(u,!1),s.pipeDefs=zt(u,!0),s.id=function dr(t){let i=0;const s=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(const g of s)i=Math.imul(31,i)+g.charCodeAt(0)<<0;return i+=2147483648,"c"+i}(s),s})}function Wa(t){return _i(t)||Br(t)}function Rl(t){return null!==t}function qa(t){return lo(()=>({type:t.type,bootstrap:t.bootstrap||mr,declarations:t.declarations||mr,imports:t.imports||mr,exports:t.exports||mr,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function ma(t,i){if(null==t)return po;const s={};for(const u in t)if(t.hasOwnProperty(u)){let g=t[u],x=g;Array.isArray(g)&&(x=g[1],g=g[0]),s[g]=u,i&&(i[g]=x)}return s}function Ya(t){return lo(()=>{const i=W(t);return He(i),i})}function pl(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,standalone:!0===t.standalone,onDestroy:t.type.prototype.ngOnDestroy||null}}function _i(t){return t[yt]||null}function Br(t){return t[Ot]||null}function Ao(t){return t[Gt]||null}function le(t){const i=_i(t)||Br(t)||Ao(t);return null!==i&&i.standalone}function ue(t,i){const s=t[Vt]||null;if(!s&&!0===i)throw new Error(`Type ${ki(t)} does not have '\u0275mod' property.`);return s}function W(t){const i={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:i,inputTransforms:null,inputConfig:t.inputs||po,exportAs:t.exportAs||null,standalone:!0===t.standalone,signals:!0===t.signals,selectors:t.selectors||mr,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:ma(t.inputs,i),outputs:ma(t.outputs),debugInfo:null}}function He(t){t.features?.forEach(i=>i(t))}function zt(t,i){if(!t)return null;const s=i?Ao:Wa;return()=>("function"==typeof t?t():t).map(u=>s(u)).filter(Rl)}const wr=0,ai=1,Ni=2,Jr=3,us=4,wo=5,Ho=6,ra=7,Ar=8,Vo=9,Cs=10,Yi=11,Qo=12,Pa=13,ds=14,Xr=15,Ja=16,oa=17,is=18,ga=19,sa=20,Es=21,Ll=22,_a=23,er=25,Ka=1,Wo=7,aa=9,mo=10;var Ts=function(t){return t[t.None=0]="None",t[t.HasTransplantedViews=2]="HasTransplantedViews",t[t.HasChildViewsToRefresh=4]="HasChildViewsToRefresh",t}(Ts||{});function ko(t){return Array.isArray(t)&&"object"==typeof t[Ka]}function go(t){return Array.isArray(t)&&!0===t[Ka]}function bc(t){return 0!=(4&t.flags)}function Xa(t){return t.componentOffset>-1}function ec(t){return 1==(1&t.flags)}function Ds(t){return!!t.template}function _l(t){return 0!=(512&t[Ni])}function $o(t,i){return t.hasOwnProperty(Et)?t[Et]:null}class fs{constructor(i,s,u){this.previousValue=i,this.currentValue=s,this.firstChange=u}isFirstChange(){return this.firstChange}}function Yo(){return Zs}function Zs(t){return t.type.prototype.ngOnChanges&&(t.setInput=fi),el}function el(){const t=wc(this),i=t?.current;if(i){const s=t.previous;if(s===po)t.previous=i;else for(let u in i)s[u]=i[u];t.current=null,this.ngOnChanges(i)}}function fi(t,i,s,u){const g=this.declaredInputs[s],x=wc(t)||function nc(t,i){return t[Gs]=i}(t,{previous:po,current:null}),T=x.current||(x.current={}),A=x.previous,k=A[g];T[g]=new fs(k&&k.currentValue,i,A===po),t[u]=i}Yo.ngInherit=!0;const Gs="__ngSimpleChanges__";function wc(t){return t[Gs]||null}const ps=function(t,i,s){};function jr(t){for(;Array.isArray(t);)t=t[wr];return t}function tl(t,i){return jr(i[t])}function Nr(t,i){return jr(i[t.index])}function rc(t,i){return t.data[i]}function ya(t,i){return t[i]}function Zo(t,i){const s=i[t];return ko(s)?s:s[wr]}function kl(t){return 128==(128&t[Ni])}function Hs(t,i){return null==i?null:t[i]}function Fl(t){t[oa]=0}function xl(t){1024&t[Ni]||(t[Ni]|=1024,kl(t)&&bl(t))}function ku(t){9216&t[Ni]&&bl(t)}function bl(t){let i=t[Jr];for(;null!==i&&!(go(i)&&i[Ni]&Ts.HasChildViewsToRefresh||ko(i)&&8192&i[Ni]);){if(go(i))i[Ni]|=Ts.HasChildViewsToRefresh;else if(i[Ni]|=8192,!kl(i))break;i=i[Jr]}}function ms(t,i){if(256==(256&t[Ni]))throw new se(911,!1);null===t[Es]&&(t[Es]=[]),t[Es].push(i)}const Ki={lFrame:I(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function eu(){return Ki.bindingsEnabled}function Co(){return null!==Ki.skipHydrationRootTNode}function Nn(){return Ki.lFrame.lView}function Cr(){return Ki.lFrame.tView}function Ws(t){return Ki.lFrame.contextLView=t,t[Ar]}function xa(t){return Ki.lFrame.contextLView=null,t}function Er(){let t=sc();for(;null!==t&&64===t.type;)t=t.parent;return t}function sc(){return Ki.lFrame.currentTNode}function qs(t,i){const s=Ki.lFrame;s.currentTNode=t,s.isParent=i}function ac(){return Ki.lFrame.isParent}function nl(){Ki.lFrame.isParent=!1}function os(){const t=Ki.lFrame;let i=t.bindingRootIndex;return-1===i&&(i=t.bindingRootIndex=t.tView.bindingStartIndex),i}function Ra(){return Ki.lFrame.bindingIndex}function ba(){return Ki.lFrame.bindingIndex++}function La(t){const i=Ki.lFrame,s=i.bindingIndex;return i.bindingIndex=i.bindingIndex+t,s}function P(t,i){const s=Ki.lFrame;s.bindingIndex=s.bindingRootIndex=t,O(i)}function O(t){Ki.lFrame.currentDirectiveIndex=t}function d(){return Ki.lFrame.currentQueryIndex}function n(t){Ki.lFrame.currentQueryIndex=t}function c(t){const i=t[ai];return 2===i.type?i.declTNode:1===i.type?t[wo]:null}function m(t,i,s){if(s&Lt.SkipSelf){let g=i,x=t;for(;!(g=g.parent,null!==g||s&Lt.Host||(g=c(x),null===g||(x=x[ds],10&g.type))););if(null===g)return!1;i=g,t=x}const u=Ki.lFrame=b();return u.currentTNode=i,u.lView=t,!0}function v(t){const i=b(),s=t[ai];Ki.lFrame=i,i.currentTNode=s.firstChild,i.lView=t,i.tView=s,i.contextLView=t,i.bindingIndex=s.bindingStartIndex,i.inI18n=!1}function b(){const t=Ki.lFrame,i=null===t?null:t.child;return null===i?I(t):i}function I(t){const i={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=i),i}function M(){const t=Ki.lFrame;return Ki.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const N=M;function Z(){const t=M();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function re(){return Ki.lFrame.selectedIndex}function Re(t){Ki.lFrame.selectedIndex=t}function Fe(){const t=Ki.lFrame;return rc(t.tView,t.selectedIndex)}let pt=!0;function gt(){return pt}function Pt(t){pt=t}function Rt(t,i){for(let s=i.directiveStart,u=i.directiveEnd;s<u;s++){const x=t.data[s].type.prototype,{ngAfterContentInit:T,ngAfterContentChecked:A,ngAfterViewInit:k,ngAfterViewChecked:te,ngOnDestroy:ve}=x;T&&(t.contentHooks??=[]).push(-s,T),A&&((t.contentHooks??=[]).push(s,A),(t.contentCheckHooks??=[]).push(s,A)),k&&(t.viewHooks??=[]).push(-s,k),te&&((t.viewHooks??=[]).push(s,te),(t.viewCheckHooks??=[]).push(s,te)),null!=ve&&(t.destroyHooks??=[]).push(s,ve)}}function qt(t,i,s){Yn(t,i,3,s)}function Wt(t,i,s,u){(3&t[Ni])===s&&Yn(t,i,s,u)}function an(t,i){let s=t[Ni];(3&s)===i&&(s&=16383,s+=1,t[Ni]=s)}function Yn(t,i,s,u){const x=u??-1,T=i.length-1;let A=0;for(let k=void 0!==u?65535&t[oa]:0;k<T;k++)if("number"==typeof i[k+1]){if(A=i[k],null!=u&&A>=u)break}else i[k]<0&&(t[oa]+=65536),(A<x||-1==x)&&(Pn(t,s,i,k),t[oa]=(4294901760&t[oa])+k+2),k++}function tn(t,i){ps(4,t,i);const s=K(null);try{i.call(t)}finally{K(s),ps(5,t,i)}}function Pn(t,i,s,u){const g=s[u]<0,x=s[u+1],A=t[g?-s[u]:s[u]];g?t[Ni]>>14<t[oa]>>16&&(3&t[Ni])===i&&(t[Ni]+=16384,tn(A,x)):tn(A,x)}const dn=-1;class Zn{constructor(i,s,u){this.factory=i,this.resolving=!1,this.canSeeViewProviders=s,this.injectImpl=u}}function wi(t){return t!==dn}function Si(t){return 32767&t}function tr(t,i){let s=function fr(t){return t>>16}(t),u=i;for(;s>0;)u=u[ds],s--;return u}let Di=!0;function Dr(t){const i=Di;return Di=t,i}const Vr=255,$r=5;let gs=0;const oo={};function ca(t,i){const s=Zr(t,i);if(-1!==s)return s;const u=i[ai];u.firstCreatePass&&(t.injectorIndex=i.length,no(u.data,t),no(i,null),no(u.blueprint,null));const g=br(t,i),x=t.injectorIndex;if(wi(g)){const T=Si(g),A=tr(g,i),k=A[ai].data;for(let te=0;te<8;te++)i[x+te]=A[T+te]|k[T+te]}return i[x+8]=g,x}function no(t,i){t.push(0,0,0,0,0,0,0,0,i)}function Zr(t,i){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===i[t.injectorIndex+8]?-1:t.injectorIndex}function br(t,i){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let s=0,u=null,g=i;for(;null!==g;){if(u=Eh(g),null===u)return dn;if(s++,g=g[ds],-1!==u.injectorIndex)return u.injectorIndex|s<<16}return dn}function Eo(t,i,s){!function wa(t,i,s){let u;"string"==typeof s?u=s.charCodeAt(0)||0:s.hasOwnProperty(Jt)&&(u=s[Jt]),null==u&&(u=s[Jt]=gs++);const g=u&Vr;i.data[t+(g>>$r)]|=1<<g}(t,i,s)}function io(t,i,s){if(s&Lt.Optional||void 0!==t)return t;Dn()}function Ms(t,i,s,u){if(s&Lt.Optional&&void 0===u&&(u=null),!(s&(Lt.Self|Lt.Host))){const g=t[Vo],x=di(void 0);try{return g?g.get(i,u,s&Lt.Optional):Kn(i,u,s&Lt.Optional)}finally{di(x)}}return io(u,0,s)}function iu(t,i,s,u=Lt.Default,g){if(null!==t){if(2048&i[Ni]&&!(u&Lt.Self)){const T=function dg(t,i,s,u,g){let x=t,T=i;for(;null!==x&&null!==T&&2048&T[Ni]&&!(512&T[Ni]);){const A=Nl(x,T,s,u|Lt.Self,oo);if(A!==oo)return A;let k=x.parent;if(!k){const te=T[sa];if(te){const ve=te.get(s,oo,u);if(ve!==oo)return ve}k=Eh(T),T=T[ds]}x=k}return g}(t,i,s,u,oo);if(T!==oo)return T}const x=Nl(t,i,s,u,oo);if(x!==oo)return x}return Ms(i,s,u,g)}function Nl(t,i,s,u,g){const x=function cc(t){if("string"==typeof t)return t.charCodeAt(0)||0;const i=t.hasOwnProperty(Jt)?t[Jt]:void 0;return"number"==typeof i?i>=0?i&Vr:fy:i}(s);if("function"==typeof x){if(!m(i,t,u))return u&Lt.Host?io(g,0,u):Ms(i,s,u,g);try{let T;if(T=x(u),null!=T||u&Lt.Optional)return T;Dn()}finally{N()}}else if("number"==typeof x){let T=null,A=Zr(t,i),k=dn,te=u&Lt.Host?i[Xr][wo]:null;for((-1===A||u&Lt.SkipSelf)&&(k=-1===A?br(t,i):i[A+8],k!==dn&&Dc(u,!1)?(T=i[ai],A=Si(k),i=tr(k,i)):A=-1);-1!==A;){const ve=i[ai];if(ou(x,A,ve.data)){const Ke=ru(A,i,s,T,u,te);if(Ke!==oo)return Ke}k=i[A+8],k!==dn&&Dc(u,i[ai].data[A+8]===te)&&ou(x,A,i)?(T=ve,A=Si(k),i=tr(k,i)):A=-1}}return g}function ru(t,i,s,u,g,x){const T=i[ai],A=T.data[t+8],ve=Ca(A,T,s,null==u?Xa(A)&&Di:u!=T&&0!=(3&A.type),g&Lt.Host&&x===A);return null!==ve?Ys(i,T,ve,A):oo}function Ca(t,i,s,u,g){const x=t.providerIndexes,T=i.data,A=1048575&x,k=t.directiveStart,ve=x>>20,kt=g?A+ve:t.directiveEnd;for(let Zt=u?A:A+ve;Zt<kt;Zt++){const Sn=T[Zt];if(Zt<k&&s===Sn||Zt>=k&&Sn.type===s)return Zt}if(g){const Zt=T[k];if(Zt&&Ds(Zt)&&Zt.type===s)return k}return null}function Ys(t,i,s,u){let g=t[s];const x=i.data;if(function ln(t){return t instanceof Zn}(g)){const T=g;T.resolving&&function ze(t,i){const s=i?`. Dependency path: ${i.join(" > ")} > ${t}`:"";throw new se(-200,`Circular dependency in DI detected for ${t}${s}`)}(function ae(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():mn(t)}(x[s]));const A=Dr(T.canSeeViewProviders);T.resolving=!0;const te=T.injectImpl?di(T.injectImpl):null;m(t,u,Lt.Default);try{g=t[s]=T.factory(void 0,x,t,u),i.firstCreatePass&&s>=u.directiveStart&&function Ft(t,i,s){const{ngOnChanges:u,ngOnInit:g,ngDoCheck:x}=i.type.prototype;if(u){const T=Zs(i);(s.preOrderHooks??=[]).push(t,T),(s.preOrderCheckHooks??=[]).push(t,T)}g&&(s.preOrderHooks??=[]).push(0-t,g),x&&((s.preOrderHooks??=[]).push(t,x),(s.preOrderCheckHooks??=[]).push(t,x))}(s,x[s],i)}finally{null!==te&&di(te),Dr(A),T.resolving=!1,N()}}return g}function ou(t,i,s){return!!(s[i+(t>>$r)]&1<<t)}function Dc(t,i){return!(t&Lt.Self||t&Lt.Host&&i)}class es{constructor(i,s){this._tNode=i,this._lView=s}get(i,s,u){return iu(this._tNode,this._lView,i,Uo(u),s)}}function fy(){return new es(Er(),Nn())}function Ch(t){return lo(()=>{const i=t.prototype.constructor,s=i[Et]||Nu(i),u=Object.prototype;let g=Object.getPrototypeOf(t.prototype).constructor;for(;g&&g!==u;){const x=g[Et]||Nu(g);if(x&&x!==s)return x;g=Object.getPrototypeOf(g)}return x=>new x})}function Nu(t){return Cn(t)?()=>{const i=Nu(sn(t));return i&&i()}:$o(t)}function Eh(t){const i=t[ai],s=i.type;return 2===s?i.declTNode:1===s?t[wo]:null}function Bu(t){return function Is(t,i){if("class"===i)return t.classes;if("style"===i)return t.styles;const s=t.attrs;if(s){const u=s.length;let g=0;for(;g<u;){const x=s[g];if(ha(x))break;if(0===x)g+=2;else if("number"==typeof x)for(g++;g<u&&"string"==typeof s[g];)g++;else{if(x===i)return s[g+1];g+=2}}}return null}(Er(),t)}const uc="__parameters__";function zu(t,i,s){return lo(()=>{const u=function hp(t){return function(...s){if(t){const u=t(...s);for(const g in u)this[g]=u[g]}}}(i);function g(...x){if(this instanceof g)return u.apply(this,x),this;const T=new g(...x);return A.annotation=T,A;function A(k,te,ve){const Ke=k.hasOwnProperty(uc)?k[uc]:Object.defineProperty(k,uc,{value:[]})[uc];for(;Ke.length<=ve;)Ke.push(null);return(Ke[ve]=Ke[ve]||[]).push(T),k}}return s&&(g.prototype=Object.create(s.prototype)),g.prototype.ngMetadataName=t,g.annotationCls=g,g})}function ju(t,i){t.forEach(s=>Array.isArray(s)?ju(s,i):i(s))}function fg(t,i,s){i>=t.length?t.push(s):t.splice(i,0,s)}function _o(t,i){return i>=t.length-1?t.pop():t.splice(i,1)[0]}function Ii(t,i){const s=[];for(let u=0;u<t;u++)s.push(i);return s}function Ta(t,i,s){let u=Mc(t,i);return u>=0?t[1|u]=s:(u=~u,function ua(t,i,s,u){let g=t.length;if(g==i)t.push(s,u);else if(1===g)t.push(u,t[0]),t[0]=s;else{for(g--,t.push(t[g-1],t[g]);g>i;)t[g]=t[g-2],g--;t[i]=s,t[i+1]=u}}(t,u,i,s)),u}function ka(t,i){const s=Mc(t,i);if(s>=0)return t[1|s]}function Mc(t,i){return function $u(t,i,s){let u=0,g=t.length>>s;for(;g!==u;){const x=u+(g-u>>1),T=t[x<<s];if(i===T)return x<<s;T>i?g=x:u=x+1}return~(g<<s)}(t,i,1)}const dc=Go(zu("Optional"),8),Zu=Go(zu("SkipSelf"),4),fu=new mt("ENVIRONMENT_INITIALIZER"),gp=new mt("INJECTOR",-1),Mh=new mt("INJECTOR_DEF_TYPES");class Pd{get(i,s=R){if(s===R){const u=new Error(`NullInjectorError: No provider for ${ki(i)}!`);throw u.name="NullInjectorError",u}return s}}function _p(t){return{\u0275providers:t}}function xy(...t){return{\u0275providers:yp(0,t),\u0275fromNgModule:!0}}function yp(t,...i){const s=[],u=new Set;let g;const x=T=>{s.push(T)};return ju(i,T=>{const A=T;Sc(A,x,[],u)&&(g||=[],g.push(A))}),void 0!==g&&vp(g,x),s}function vp(t,i){for(let s=0;s<t.length;s++){const{ngModule:u,providers:g}=t[s];Od(g,x=>{i(x,u)})}}function Sc(t,i,s,u){if(!(t=sn(t)))return!1;let g=null,x=Je(t);const T=!x&&_i(t);if(x||T){if(T&&!T.standalone)return!1;g=t}else{const k=t.ngModule;if(x=Je(k),!x)return!1;g=k}const A=u.has(g);if(T){if(A)return!1;if(u.add(g),T.dependencies){const k="function"==typeof T.dependencies?T.dependencies():T.dependencies;for(const te of k)Sc(te,i,s,u)}}else{if(!x)return!1;{if(null!=x.imports&&!A){let te;u.add(g);try{ju(x.imports,ve=>{Sc(ve,i,s,u)&&(te||=[],te.push(ve))})}finally{}void 0!==te&&vp(te,i)}if(!A){const te=$o(g)||(()=>new g);i({provide:g,useFactory:te,deps:mr},g),i({provide:Mh,useValue:g,multi:!0},g),i({provide:fu,useValue:()=>cr(g),multi:!0},g)}const k=x.providers;if(null!=k&&!A){const te=t;Od(k,ve=>{i(ve,te)})}}}return g!==t&&void 0!==t.providers}function Od(t,i){for(let s of t)$i(s)&&(s=s.\u0275providers),Array.isArray(s)?Od(s,i):i(s)}const xp=Oi({provide:String,useValue:Oi});function _s(t){return null!==t&&"object"==typeof t&&xp in t}function Xs(t){return"function"==typeof t}const fc=new mt("Set Injector scope."),Pc={},sl={};let Da;function Sh(){return void 0===Da&&(Da=new Pd),Da}class Fa{}class pu extends Fa{get destroyed(){return this._destroyed}constructor(i,s,u,g){super(),this.parent=s,this.source=u,this.scopes=g,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Rd(i,T=>this.processProvider(T)),this.records.set(gp,mu(void 0,this)),g.has("environment")&&this.records.set(Fa,mu(void 0,this));const x=this.records.get(fc);null!=x&&"string"==typeof x.value&&this.scopes.add(x.value),this.injectorDefTypes=new Set(this.get(Mh,mr,Lt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const s of this._ngOnDestroyHooks)s.ngOnDestroy();const i=this._onDestroyHooks;this._onDestroyHooks=[];for(const s of i)s()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(i){return this.assertNotDestroyed(),this._onDestroyHooks.push(i),()=>this.removeOnDestroy(i)}runInContext(i){this.assertNotDestroyed();const s=Mo(this),u=di(void 0);try{return i()}finally{Mo(s),di(u)}}get(i,s=R,u=Lt.Default){if(this.assertNotDestroyed(),i.hasOwnProperty(Bn))return i[Bn](this);u=Uo(u);const x=Mo(this),T=di(void 0);try{if(!(u&Lt.SkipSelf)){let k=this.records.get(i);if(void 0===k){const te=function Ph(t){return"function"==typeof t||"object"==typeof t&&t instanceof mt}(i)&&Xn(i);k=te&&this.injectableDefInScope(te)?mu(wp(i),Pc):null,this.records.set(i,k)}if(null!=k)return this.hydrate(i,k)}return(u&Lt.Self?Sh():this.parent).get(i,s=u&Lt.Optional&&s===R?null:s)}catch(A){if("NullInjectorError"===A.name){if((A[H]=A[H]||[]).unshift(ki(i)),x)throw A;return function $a(t,i,s,u){const g=t[H];throw i[Tr]&&g.unshift(i[Tr]),t.message=function zs(t,i,s,u=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.slice(2):t;let g=ki(i);if(Array.isArray(i))g=i.map(ki).join(" -> ");else if("object"==typeof i){let x=[];for(let T in i)if(i.hasOwnProperty(T)){let A=i[T];x.push(T+":"+("string"==typeof A?JSON.stringify(A):ki(A)))}g=`{${x.join(", ")}}`}return`${s}${u?"("+u+")":""}[${g}]: ${t.replace(Bt,"\n  ")}`}("\n"+t.message,g,s,u),t.ngTokenPath=g,t[H]=null,t}(A,i,"R3InjectorError",this.source)}throw A}finally{di(T),Mo(x)}}resolveInjectorInitializers(){const i=Mo(this),s=di(void 0);try{const g=this.get(fu,mr,Lt.Self);for(const x of g)x()}finally{Mo(i),di(s)}}toString(){const i=[],s=this.records;for(const u of s.keys())i.push(ki(u));return`R3Injector[${i.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new se(205,!1)}processProvider(i){let s=Xs(i=sn(i))?i:sn(i&&i.provide);const u=function jl(t){return _s(t)?mu(void 0,t.useValue):mu(Oc(t),Pc)}(i);if(Xs(i)||!0!==i.multi)this.records.get(s);else{let g=this.records.get(s);g||(g=mu(void 0,Pc,!0),g.factory=()=>jo(g.multi),this.records.set(s,g)),s=i,g.multi.push(i)}this.records.set(s,u)}hydrate(i,s){return s.value===Pc&&(s.value=sl,s.value=s.factory()),"object"==typeof s.value&&s.value&&function wy(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(s.value)&&this._ngOnDestroyHooks.add(s.value),s.value}injectableDefInScope(i){if(!i.providedIn)return!1;const s=sn(i.providedIn);return"string"==typeof s?"any"===s||this.scopes.has(s):this.injectorDefTypes.has(s)}removeOnDestroy(i){const s=this._onDestroyHooks.indexOf(i);-1!==s&&this._onDestroyHooks.splice(s,1)}}function wp(t){const i=Xn(t),s=null!==i?i.factory:$o(t);if(null!==s)return s;if(t instanceof mt)throw new se(204,!1);if(t instanceof Function)return function Cp(t){const i=t.length;if(i>0)throw Ii(i,"?"),new se(204,!1);const s=function lr(t){return t&&(t[rt]||t[ut])||null}(t);return null!==s?()=>s.factory(t):()=>new t}(t);throw new se(204,!1)}function Oc(t,i,s){let u;if(Xs(t)){const g=sn(t);return $o(g)||wp(g)}if(_s(t))u=()=>sn(t.useValue);else if(function bp(t){return!(!t||!t.useFactory)}(t))u=()=>t.useFactory(...jo(t.deps||[]));else if(function Ah(t){return!(!t||!t.useExisting)}(t))u=()=>cr(sn(t.useExisting));else{const g=sn(t&&(t.useClass||t.provide));if(!function bg(t){return!!t.deps}(t))return $o(g)||wp(g);u=()=>new g(...jo(t.deps))}return u}function mu(t,i,s=!1){return{factory:t,value:i,multi:s?[]:void 0}}function Rd(t,i){for(const s of t)Array.isArray(s)?Rd(s,i):s&&$i(s)?Rd(s.\u0275providers,i):i(s)}function Wu(t,i){t instanceof pu&&t.assertNotDestroyed();const u=Mo(t),g=di(void 0);try{return i()}finally{Mo(u),di(g)}}function Dp(t,i=null,s=null,u){const g=Tg(t,i,s,u);return g.resolveInjectorInitializers(),g}function Tg(t,i=null,s=null,u,g=new Set){const x=[s||mr,xy(t)];return u=u||("object"==typeof t?void 0:ki(t)),new pu(x,i||Sh(),u||null,g)}let Na,al=(()=>{class t{static#e=this.THROW_IF_NOT_FOUND=R;static#t=this.NULL=new Pd;static create(s,u){if(Array.isArray(s))return Dp({name:""},u,s,"");{const g=s.name??"";return Dp({name:g},s.parent,s.providers,g)}}static#n=this.\u0275prov=Qt({token:t,providedIn:"any",factory:()=>cr(gp)});static#i=this.__NG_ELEMENT_ID__=-1}return t})();function pc(t){return!!ue(t)}function Ba(t){Na=t}const Ip=new mt("AppId",{providedIn:"root",factory:()=>ys}),ys="ng",Mp=new mt("Platform Initializer"),Lc=new mt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Ap=new mt("CSP nonce",{providedIn:"root",factory:()=>function To(){if(void 0!==Na)return Na;if(typeof document<"u")return document;throw new se(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function Qs(t){return t instanceof Function?t():t}function Fh(t){return 128==(128&t.flags)}var td=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(td||{});const Bh=/^>|^->|<!--|-->|--!>|<!-$/g,Sg=/(<|>)/g,yu="\u200b$1\u200b";const kp=new Map;let ky=0;const Np="__ngContext__";function Ir(t,i){ko(i)?(t[Np]=i[ga],function Ny(t){kp.set(t[ga],t)}(i)):t[Np]=i}let Vp;function jh(t,i){return Vp(t,i)}function Ud(t){const i=t[Jr];return go(i)?i[Jr]:i}function Vh(t){return jd(t[Qo])}function $h(t){return jd(t[us])}function jd(t){for(;null!==t&&!go(t);)t=t[us];return t}function rd(t,i,s,u,g){if(null!=u){let x,T=!1;go(u)?x=u:ko(u)&&(T=!0,u=u[wr]);const A=jr(u);0===t&&null!==s?null==g?Zd(i,s,A):Hl(i,s,A,g||null,!0):1===t&&null!==s?Hl(i,s,A,g||null,!0):2===t?function Xh(t,i,s){const u=Bc(t,i);u&&function Hy(t,i,s,u){t.removeChild(i,s,u)}(t,u,i,s)}(i,A,T):3===t&&i.destroyNode(A),null!=x&&function Hd(t,i,s,u,g){const x=s[Wo];x!==jr(s)&&rd(i,t,u,x,g);for(let A=mo;A<s.length;A++){const k=s[A];zc(k[ai],k,t,i,u,x)}}(i,t,x,s,g)}}function Zp(t,i){return t.createComment(function nd(t){return t.replace(Bh,i=>i.replace(Sg,yu))}(i))}function Gh(t,i,s){return t.createElement(i,s)}function kg(t,i){const s=t[aa],u=s.indexOf(i);s.splice(u,1)}function Vd(t,i){if(t.length<=mo)return;const s=mo+i,u=t[s];if(u){const g=u[Ja];null!==g&&g!==t&&kg(g,u),i>0&&(t[s-1][us]=u[us]);const x=_o(t,mo+i);!function jy(t,i){zc(t,i,i[Yi],2,null,null),i[wr]=null,i[wo]=null}(u[ai],u);const T=x[is];null!==T&&T.detachView(x[ai]),u[Jr]=null,u[us]=null,u[Ni]&=-129}return u}function $d(t,i){if(!(256&i[Ni])){const s=i[Yi];i[_a]&&function Be(t){if(lt(t),Ge(t))for(let i=0;i<t.producerNode.length;i++)Ae(t.producerNode[i],t.producerIndexOfThis[i]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}(i[_a]),s.destroyNode&&zc(t,i,s,3,null,null),function Lg(t){let i=t[Qo];if(!i)return Wh(t[ai],t);for(;i;){let s=null;if(ko(i))s=i[Qo];else{const u=i[mo];u&&(s=u)}if(!s){for(;i&&!i[us]&&i!==t;)ko(i)&&Wh(i[ai],i),i=i[Jr];null===i&&(i=t),ko(i)&&Wh(i[ai],i),s=i&&i[us]}i=s}}(i)}}function Wh(t,i){if(!(256&i[Ni])){i[Ni]&=-129,i[Ni]|=256,function Gy(t,i){let s;if(null!=t&&null!=(s=t.destroyHooks))for(let u=0;u<s.length;u+=2){const g=i[s[u]];if(!(g instanceof Zn)){const x=s[u+1];if(Array.isArray(x))for(let T=0;T<x.length;T+=2){const A=g[x[T]],k=x[T+1];ps(4,A,k);try{k.call(A)}finally{ps(5,A,k)}}else{ps(4,g,x);try{x.call(g)}finally{ps(5,g,x)}}}}}(t,i),function Zy(t,i){const s=t.cleanup,u=i[ra];if(null!==s)for(let x=0;x<s.length-1;x+=2)if("string"==typeof s[x]){const T=s[x+3];T>=0?u[T]():u[-T].unsubscribe(),x+=2}else s[x].call(u[s[x+1]]);null!==u&&(i[ra]=null);const g=i[Es];if(null!==g){i[Es]=null;for(let x=0;x<g.length;x++)(0,g[x])()}}(t,i),1===i[ai].type&&i[Yi].destroy();const s=i[Ja];if(null!==s&&go(i[Jr])){s!==i[Jr]&&kg(s,i);const u=i[is];null!==u&&u.detachView(t)}!function By(t){kp.delete(t[ga])}(i)}}function Gp(t,i,s){return function qh(t,i,s){let u=i;for(;null!==u&&40&u.type;)u=(i=u).parent;if(null===u)return s[wr];{const{componentOffset:g}=u;if(g>-1){const{encapsulation:x}=t.data[u.directiveStart+g];if(x===fo.None||x===fo.Emulated)return null}return Nr(u,s)}}(t,i.parent,s)}function Hl(t,i,s,u,g){t.insertBefore(i,s,u,g)}function Zd(t,i,s){t.appendChild(i,s)}function Fg(t,i,s,u,g){null!==u?Hl(t,i,s,u,g):Zd(t,i,s)}function Bc(t,i){return t.parentNode(i)}function sd(t,i,s){return Bg(t,i,s)}let Jh,nf,Bg=function Hp(t,i,s){return 40&t.type?Nr(t,s):null};function Gd(t,i,s,u){const g=Gp(t,u,i),x=i[Yi],A=sd(u.parent||i[wo],u,i);if(null!=g)if(Array.isArray(s))for(let k=0;k<s.length;k++)Fg(x,g,s[k],A,!1);else Fg(x,g,s,A,!1);void 0!==Jh&&Jh(x,u,i,s,g)}function ad(t,i){if(null!==i){const s=i.type;if(3&s)return Nr(i,t);if(4&s)return Kh(-1,t[i.index]);if(8&s){const u=i.child;if(null!==u)return ad(t,u);{const g=t[i.index];return go(g)?Kh(-1,g):jr(g)}}if(32&s)return jh(i,t)()||jr(t[i.index]);{const u=qp(t,i);return null!==u?Array.isArray(u)?u[0]:ad(Ud(t[Xr]),u):ad(t,i.next)}}return null}function qp(t,i){return null!==i?t[Xr][wo].projection[i.projection]:null}function Kh(t,i){const s=mo+t+1;if(s<i.length){const u=i[s],g=u[ai].firstChild;if(null!==g)return ad(u,g)}return i[Wo]}function Qh(t,i,s,u,g,x,T){for(;null!=s;){const A=u[s.index],k=s.type;if(T&&0===i&&(A&&Ir(jr(A),u),s.flags|=2),32!=(32&s.flags))if(8&k)Qh(t,i,s.child,u,g,x,!1),rd(i,t,g,A,x);else if(32&k){const te=jh(s,u);let ve;for(;ve=te();)rd(i,t,g,ve,x);rd(i,t,g,A,x)}else 16&k?As(t,i,u,s,g,x):rd(i,t,g,A,x);s=T?s.projectionNext:s.next}}function zc(t,i,s,u,g,x){Qh(s,u,t.firstChild,i,g,x,!1)}function As(t,i,s,u,g,x){const T=s[Xr],k=T[wo].projection[u.projection];if(Array.isArray(k))for(let te=0;te<k.length;te++)rd(i,t,g,k[te],x);else{let te=k;const ve=T[Jr];Fh(u)&&(te.flags|=128),Qh(t,i,te,ve,g,x,!0)}}function Yp(t,i,s){""===s?t.removeAttribute(i,"class"):t.setAttribute(i,"class",s)}function Jp(t,i,s){const{mergedAttrs:u,classes:g,styles:x}=s;null!==u&&ns(t,i,u),null!==g&&Yp(t,i,g),null!==x&&function Wd(t,i,s){t.setAttribute(i,"style",s)}(t,i,x)}function jg(t){return function rf(){if(void 0===nf&&(nf=null,J.trustedTypes))try{nf=J.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return nf}()?.createScriptURL(t)||t}class Vg{constructor(i){this.changingThisBreaksApplicationSecurity=i}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${ge})`}}function yo(t){return t instanceof Vg?t.changingThisBreaksApplicationSecurity:t}function da(t,i){const s=function em(t){return t instanceof Vg&&t.getTypeName()||null}(t);if(null!=s&&s!==i){if("ResourceURL"===s&&"URL"===i)return!0;throw new Error(`Required a safe ${i}, got a ${s} (see ${ge})`)}return s===i}const Wg=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var hd=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(hd||{});function Ss(t){const i=Jd();return i?i.sanitize(hd.URL,t)||"":da(t,"URL")?yo(t):function Hr(t){return(t=String(t)).match(Wg)?t:"unsafe:"+t}(mn(t))}function lf(t){const i=Jd();if(i)return jg(i.sanitize(hd.RESOURCE_URL,t)||"");if(da(t,"ResourceURL"))return jg(yo(t));throw new se(904,!1)}function wu(t,i,s){return function Yd(t,i){return"src"===i&&("embed"===t||"frame"===t||"iframe"===t||"media"===t||"script"===t)||"href"===i&&("base"===t||"link"===t)?lf:Ss}(i,s)(t)}function Jd(){const t=Nn();return t&&t[Cs].sanitizer}let dm=(t,i,s)=>null;function eh(t,i,s=!1){return dm(t,i,s)}class av{}class Iu{}class r_{resolveComponentFactory(i){throw function gd(t){const i=Error(`No component factory found for ${ki(t)}.`);return i.ngComponent=t,i}(i)}}let yf=(()=>{class t{static#e=this.NULL=new r_}return t})();function pm(){return _d(Er(),Nn())}function _d(t,i){return new mc(Nr(t,i))}let mc=(()=>{class t{constructor(s){this.nativeElement=s}static#e=this.__NG_ELEMENT_ID__=pm}return t})();function Uc(t){return t instanceof mc?t.nativeElement:t}class mm{}let o_=(()=>{class t{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function vf(){const t=Nn(),s=Zo(Er().index,t);return(ko(s)?s:t)[Yi]}()}return t})(),gm=(()=>{class t{static#e=this.\u0275prov=Qt({token:t,providedIn:"root",factory:()=>null})}return t})();class s_{constructor(i){this.full=i,this.major=i.split(".")[0],this.minor=i.split(".")[1],this.patch=i.split(".").slice(2).join(".")}}const a_=new s_("17.0.4"),gc={};function nh(t){const i=K(null);try{return t()}finally{K(i)}}function jc(t){return!!_m(t)&&(Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t)}function _m(t){return null!==t&&("function"==typeof t||"object"==typeof t)}class Au{constructor(){}supports(i){return jc(i)}create(i){return new cv(i)}}const wf=(t,i)=>i;class cv{constructor(i){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=i||wf}forEachItem(i){let s;for(s=this._itHead;null!==s;s=s._next)i(s)}forEachOperation(i){let s=this._itHead,u=this._removalsHead,g=0,x=null;for(;s||u;){const T=!u||s&&s.currentIndex<ym(u,g,x)?s:u,A=ym(T,g,x),k=T.currentIndex;if(T===u)g--,u=u._nextRemoved;else if(s=s._next,null==T.previousIndex)g++;else{x||(x=[]);const te=A-g,ve=k-g;if(te!=ve){for(let kt=0;kt<te;kt++){const Zt=kt<x.length?x[kt]:x[kt]=0,Sn=Zt+kt;ve<=Sn&&Sn<te&&(x[kt]=Zt+1)}x[T.previousIndex]=ve-te}}A!==k&&i(T,A,k)}}forEachPreviousItem(i){let s;for(s=this._previousItHead;null!==s;s=s._nextPrevious)i(s)}forEachAddedItem(i){let s;for(s=this._additionsHead;null!==s;s=s._nextAdded)i(s)}forEachMovedItem(i){let s;for(s=this._movesHead;null!==s;s=s._nextMoved)i(s)}forEachRemovedItem(i){let s;for(s=this._removalsHead;null!==s;s=s._nextRemoved)i(s)}forEachIdentityChange(i){let s;for(s=this._identityChangesHead;null!==s;s=s._nextIdentityChange)i(s)}diff(i){if(null==i&&(i=[]),!jc(i))throw new se(900,!1);return this.check(i)?this:null}onDestroy(){}check(i){this._reset();let g,x,T,s=this._itHead,u=!1;if(Array.isArray(i)){this.length=i.length;for(let A=0;A<this.length;A++)x=i[A],T=this._trackByFn(A,x),null!==s&&Object.is(s.trackById,T)?(u&&(s=this._verifyReinsertion(s,x,T,A)),Object.is(s.item,x)||this._addIdentityChange(s,x)):(s=this._mismatch(s,x,T,A),u=!0),s=s._next}else g=0,function lv(t,i){if(Array.isArray(t))for(let s=0;s<t.length;s++)i(t[s]);else{const s=t[Symbol.iterator]();let u;for(;!(u=s.next()).done;)i(u.value)}}(i,A=>{T=this._trackByFn(g,A),null!==s&&Object.is(s.trackById,T)?(u&&(s=this._verifyReinsertion(s,A,T,g)),Object.is(s.item,A)||this._addIdentityChange(s,A)):(s=this._mismatch(s,A,T,g),u=!0),s=s._next,g++}),this.length=g;return this._truncate(s),this.collection=i,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let i;for(i=this._previousItHead=this._itHead;null!==i;i=i._next)i._nextPrevious=i._next;for(i=this._additionsHead;null!==i;i=i._nextAdded)i.previousIndex=i.currentIndex;for(this._additionsHead=this._additionsTail=null,i=this._movesHead;null!==i;i=i._nextMoved)i.previousIndex=i.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(i,s,u,g){let x;return null===i?x=this._itTail:(x=i._prev,this._remove(i)),null!==(i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(u,null))?(Object.is(i.item,s)||this._addIdentityChange(i,s),this._reinsertAfter(i,x,g)):null!==(i=null===this._linkedRecords?null:this._linkedRecords.get(u,g))?(Object.is(i.item,s)||this._addIdentityChange(i,s),this._moveAfter(i,x,g)):i=this._addAfter(new l_(s,u),x,g),i}_verifyReinsertion(i,s,u,g){let x=null===this._unlinkedRecords?null:this._unlinkedRecords.get(u,null);return null!==x?i=this._reinsertAfter(x,i._prev,g):i.currentIndex!=g&&(i.currentIndex=g,this._addToMoves(i,g)),i}_truncate(i){for(;null!==i;){const s=i._next;this._addToRemovals(this._unlink(i)),i=s}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(i,s,u){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(i);const g=i._prevRemoved,x=i._nextRemoved;return null===g?this._removalsHead=x:g._nextRemoved=x,null===x?this._removalsTail=g:x._prevRemoved=g,this._insertAfter(i,s,u),this._addToMoves(i,u),i}_moveAfter(i,s,u){return this._unlink(i),this._insertAfter(i,s,u),this._addToMoves(i,u),i}_addAfter(i,s,u){return this._insertAfter(i,s,u),this._additionsTail=null===this._additionsTail?this._additionsHead=i:this._additionsTail._nextAdded=i,i}_insertAfter(i,s,u){const g=null===s?this._itHead:s._next;return i._next=g,i._prev=s,null===g?this._itTail=i:g._prev=i,null===s?this._itHead=i:s._next=i,null===this._linkedRecords&&(this._linkedRecords=new u_),this._linkedRecords.put(i),i.currentIndex=u,i}_remove(i){return this._addToRemovals(this._unlink(i))}_unlink(i){null!==this._linkedRecords&&this._linkedRecords.remove(i);const s=i._prev,u=i._next;return null===s?this._itHead=u:s._next=u,null===u?this._itTail=s:u._prev=s,i}_addToMoves(i,s){return i.previousIndex===s||(this._movesTail=null===this._movesTail?this._movesHead=i:this._movesTail._nextMoved=i),i}_addToRemovals(i){return null===this._unlinkedRecords&&(this._unlinkedRecords=new u_),this._unlinkedRecords.put(i),i.currentIndex=null,i._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=i,i._prevRemoved=null):(i._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=i),i}_addIdentityChange(i,s){return i.item=s,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=i:this._identityChangesTail._nextIdentityChange=i,i}}class l_{constructor(i,s){this.item=i,this.trackById=s,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class c_{constructor(){this._head=null,this._tail=null}add(i){null===this._head?(this._head=this._tail=i,i._nextDup=null,i._prevDup=null):(this._tail._nextDup=i,i._prevDup=this._tail,i._nextDup=null,this._tail=i)}get(i,s){let u;for(u=this._head;null!==u;u=u._nextDup)if((null===s||s<=u.currentIndex)&&Object.is(u.trackById,i))return u;return null}remove(i){const s=i._prevDup,u=i._nextDup;return null===s?this._head=u:s._nextDup=u,null===u?this._tail=s:u._prevDup=s,null===this._head}}class u_{constructor(){this.map=new Map}put(i){const s=i.trackById;let u=this.map.get(s);u||(u=new c_,this.map.set(s,u)),u.add(i)}get(i,s){const g=this.map.get(i);return g?g.get(i,s):null}remove(i){const s=i.trackById;return this.map.get(s).remove(i)&&this.map.delete(s),i}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function ym(t,i,s){const u=t.previousIndex;if(null===u)return u;let g=0;return s&&u<s.length&&(g=s[u]),u+i+g}class d_{constructor(){}supports(i){return i instanceof Map||_m(i)}create(){return new h_}}class h_{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(i){let s;for(s=this._mapHead;null!==s;s=s._next)i(s)}forEachPreviousItem(i){let s;for(s=this._previousMapHead;null!==s;s=s._nextPrevious)i(s)}forEachChangedItem(i){let s;for(s=this._changesHead;null!==s;s=s._nextChanged)i(s)}forEachAddedItem(i){let s;for(s=this._additionsHead;null!==s;s=s._nextAdded)i(s)}forEachRemovedItem(i){let s;for(s=this._removalsHead;null!==s;s=s._nextRemoved)i(s)}diff(i){if(i){if(!(i instanceof Map||_m(i)))throw new se(900,!1)}else i=new Map;return this.check(i)?this:null}onDestroy(){}check(i){this._reset();let s=this._mapHead;if(this._appendAfter=null,this._forEach(i,(u,g)=>{if(s&&s.key===g)this._maybeAddToChanges(s,u),this._appendAfter=s,s=s._next;else{const x=this._getOrCreateRecordForKey(g,u);s=this._insertBeforeOrAppend(s,x)}}),s){s._prev&&(s._prev._next=null),this._removalsHead=s;for(let u=s;null!==u;u=u._nextRemoved)u===this._mapHead&&(this._mapHead=null),this._records.delete(u.key),u._nextRemoved=u._next,u.previousValue=u.currentValue,u.currentValue=null,u._prev=null,u._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(i,s){if(i){const u=i._prev;return s._next=i,s._prev=u,i._prev=s,u&&(u._next=s),i===this._mapHead&&(this._mapHead=s),this._appendAfter=i,i}return this._appendAfter?(this._appendAfter._next=s,s._prev=this._appendAfter):this._mapHead=s,this._appendAfter=s,null}_getOrCreateRecordForKey(i,s){if(this._records.has(i)){const g=this._records.get(i);this._maybeAddToChanges(g,s);const x=g._prev,T=g._next;return x&&(x._next=T),T&&(T._prev=x),g._next=null,g._prev=null,g}const u=new uv(i);return this._records.set(i,u),u.currentValue=s,this._addToAdditions(u),u}_reset(){if(this.isDirty){let i;for(this._previousMapHead=this._mapHead,i=this._previousMapHead;null!==i;i=i._next)i._nextPrevious=i._next;for(i=this._changesHead;null!==i;i=i._nextChanged)i.previousValue=i.currentValue;for(i=this._additionsHead;null!=i;i=i._nextAdded)i.previousValue=i.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(i,s){Object.is(s,i.currentValue)||(i.previousValue=i.currentValue,i.currentValue=s,this._addToChanges(i))}_addToAdditions(i){null===this._additionsHead?this._additionsHead=this._additionsTail=i:(this._additionsTail._nextAdded=i,this._additionsTail=i)}_addToChanges(i){null===this._changesHead?this._changesHead=this._changesTail=i:(this._changesTail._nextChanged=i,this._changesTail=i)}_forEach(i,s){i instanceof Map?i.forEach(s):Object.keys(i).forEach(u=>s(i[u],u))}}class uv{constructor(i){this.key=i,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function vm(){return new xm([new Au])}let xm=(()=>{class t{static#e=this.\u0275prov=Qt({token:t,providedIn:"root",factory:vm});constructor(s){this.factories=s}static create(s,u){if(null!=u){const g=u.factories.slice();s=s.concat(g)}return new t(s)}static extend(s){return{provide:t,useFactory:u=>t.create(s,u||vm()),deps:[[t,new Zu,new dc]]}}find(s){const u=this.factories.find(g=>g.supports(s));if(null!=u)return u;throw new se(901,!1)}}return t})();function ih(){return new yd([new d_])}let yd=(()=>{class t{static#e=this.\u0275prov=Qt({token:t,providedIn:"root",factory:ih});constructor(s){this.factories=s}static create(s,u){if(u){const g=u.factories.slice();s=s.concat(g)}return new t(s)}static extend(s){return{provide:t,useFactory:u=>t.create(s,u||ih()),deps:[[t,new Zu,new dc]]}}find(s){const u=this.factories.find(g=>g.supports(s));if(u)return u;throw new se(901,!1)}}return t})();function rh(t,i,s,u,g=!1){for(;null!==s;){const x=i[s.index];null!==x&&u.push(jr(x)),go(x)&&Ef(x,u);const T=s.type;if(8&T)rh(t,i,s.child,u);else if(32&T){const A=jh(s,i);let k;for(;k=A();)u.push(k)}else if(16&T){const A=qp(i,s);if(Array.isArray(A))u.push(...A);else{const k=Ud(i[Xr]);rh(k[ai],k,A,u,!0)}}s=g?s.projectionNext:s.next}return u}function Ef(t,i){for(let s=mo;s<t.length;s++){const u=t[s],g=u[ai].firstChild;null!==g&&rh(u[ai],u,g,i)}t[Wo]!==t[wr]&&i.push(t[Wo])}let Tf=[];const f_={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{},consumerIsAlwaysLive:!0,consumerMarkedDirty:t=>{bl(t.lView)},consumerOnSignalRead(){this.lView[_a]=this}};function wm(t){return t.ngOriginalError}class $c{constructor(){this._console=console}handleError(i){const s=this._findOriginalError(i);this._console.error("ERROR",i),s&&this._console.error("ORIGINAL ERROR",s)}_findOriginalError(i){let s=i&&wm(i);for(;s&&wm(s);)s=wm(s);return s||null}}const p_=new mt("",{providedIn:"root",factory:()=>!1}),pr={};function Em(t){Tm(Cr(),Nn(),re()+t,!1)}function Tm(t,i,s,u){if(!u)if(3==(3&i[Ni])){const x=t.preOrderCheckHooks;null!==x&&qt(i,x,s)}else{const x=t.preOrderHooks;null!==x&&Wt(i,x,0,s)}Re(s)}function Zc(t,i=Lt.Default){const s=Nn();return null===s?cr(t,i):iu(Er(),s,sn(t),i)}function __(){throw new Error("invalid")}function ah(t,i,s,u,g,x,T,A,k,te,ve){const Ke=i.blueprint.slice();return Ke[wr]=g,Ke[Ni]=140|u,(null!==te||t&&2048&t[Ni])&&(Ke[Ni]|=2048),Fl(Ke),Ke[Jr]=Ke[ds]=t,Ke[Ar]=s,Ke[Cs]=T||t&&t[Cs],Ke[Yi]=A||t&&t[Yi],Ke[Vo]=k||t&&t[Vo]||null,Ke[wo]=x,Ke[ga]=function Fy(){return ky++}(),Ke[Ho]=ve,Ke[sa]=te,Ke[Xr]=2==i.type?t[Xr]:Ke,Ke}function Pu(t,i,s,u,g){let x=t.data[i];if(null===x)x=function Mf(t,i,s,u,g){const x=sc(),T=ac(),k=t.data[i]=function Sm(t,i,s,u,g,x){let T=i?i.injectorIndex:-1,A=0;return Co()&&(A|=128),{type:s,index:u,insertBeforeIndex:null,injectorIndex:T,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:A,providerIndexes:0,value:g,attrs:x,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:i,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,T?x:x&&x.parent,s,i,u,g);return null===t.firstChild&&(t.firstChild=k),null!==x&&(T?null==x.child&&null!==k.parent&&(x.child=k):null===x.next&&(x.next=k,k.prev=x)),k}(t,i,s,u,g),function wh(){return Ki.lFrame.inI18n}()&&(x.flags|=32);else if(64&x.type){x.type=s,x.value=u,x.attrs=g;const T=function yi(){const t=Ki.lFrame,i=t.currentTNode;return t.isParent?i:i.parent}();x.injectorIndex=null===T?-1:T.injectorIndex}return qs(x,!0),x}function vd(t,i,s,u){if(0===s)return-1;const g=i.length;for(let x=0;x<s;x++)i.push(u),t.blueprint.push(u),t.data.push(null);return g}function Dm(t,i,s,u,g){const x=re(),T=2&u;try{Re(-1),T&&i.length>er&&Tm(t,i,er,!1),ps(T?2:0,g),s(u,g)}finally{Re(x),ps(T?3:1,g)}}function Af(t,i,s){if(bc(i)){const u=K(null);try{const x=i.directiveEnd;for(let T=i.directiveStart;T<x;T++){const A=t.data[T];A.contentQueries&&A.contentQueries(1,s[T],T)}}finally{K(u)}}}function ql(t,i,s){eu()&&(function _v(t,i,s,u){const g=s.directiveStart,x=s.directiveEnd;Xa(s)&&function km(t,i,s){const u=Nr(i,t),g=v_(s);let T=16;s.signals?T=4096:s.onPush&&(T=64);const A=y(t,ah(t,g,null,T,u,i,null,t[Cs].rendererFactory.createRenderer(u,s),null,null,null));t[i.index]=A}(i,s,t.data[g+s.componentOffset]),t.firstCreatePass||ca(s,i),Ir(u,i);const T=s.initialInputs;for(let A=g;A<x;A++){const k=t.data[A],te=Ys(i,t,A,s);Ir(te,i),null!==T&&e(0,A-g,te,k,0,T),Ds(k)&&(Zo(s.index,i)[Ar]=Ys(i,t,A,s))}}(t,i,s,Nr(s,i)),64==(64&s.flags)&&Lf(t,i,s))}function Sf(t,i,s=Nr){const u=i.localNames;if(null!==u){let g=i.index+1;for(let x=0;x<u.length;x+=2){const T=u[x+1],A=-1===T?s(i,t):t[T];t[g++]=A}}}function v_(t){const i=t.tView;return null===i||i.incompleteFirstPass?t.tView=Im(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):i}function Im(t,i,s,u,g,x,T,A,k,te,ve){const Ke=er+u,kt=Ke+g,Zt=function Pf(t,i){const s=[];for(let u=0;u<i;u++)s.push(u<t?null:pr);return s}(Ke,kt),Sn="function"==typeof te?te():te;return Zt[ai]={type:t,blueprint:Zt,template:s,queries:null,viewQuery:A,declTNode:i,data:Zt.slice().fill(null,Ke),bindingStartIndex:Ke,expandoStartIndex:kt,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof x?x():x,pipeRegistry:"function"==typeof T?T():T,firstChild:null,schemas:k,consts:Sn,incompleteFirstPass:!1,ssrId:ve}}let Of=t=>null;function ul(t,i,s,u){for(let g in t)if(t.hasOwnProperty(g)){s=null===s?{}:s;const x=t[g];null===u?Gc(s,i,g,x):u.hasOwnProperty(g)&&Gc(s,i,u[g],x)}return s}function Gc(t,i,s,u){t.hasOwnProperty(s)?t[s].push(i,u):t[s]=[i,u]}function Ps(t,i,s,u,g,x,T,A){const k=Nr(i,s);let ve,te=i.inputs;!A&&null!=te&&(ve=te[u])?(Y(t,s,ve,u,g),Xa(i)&&function Rf(t,i){const s=Zo(i,t);16&s[Ni]||(s[Ni]|=64)}(s,i.index)):3&i.type&&(u=function b_(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(u),g=null!=T?T(g,i.value||"",u):g,x.setProperty(k,u,g))}function Pm(t,i,s,u){if(eu()){const g=null===u?null:{"":-1},x=function D_(t,i){const s=t.directiveRegistry;let u=null,g=null;if(s)for(let x=0;x<s.length;x++){const T=s[x];if(Ga(i,T.selectors,!1))if(u||(u=[]),Ds(T))if(null!==T.findHostDirectiveDefs){const A=[];g=g||new Map,T.findHostDirectiveDefs(T,A,g),u.unshift(...A,T),kf(t,i,A.length)}else u.unshift(T),kf(t,i,0);else g=g||new Map,T.findHostDirectiveDefs?.(T,u,g),u.push(T)}return null===u?null:[u,g]}(t,s);let T,A;null===x?T=A=null:[T,A]=x,null!==T&&Om(t,i,s,T,g,A),g&&function Rm(t,i,s){if(i){const u=t.localNames=[];for(let g=0;g<i.length;g+=2){const x=s[i[g+1]];if(null==x)throw new se(-301,!1);u.push(i[g],x)}}}(s,u,g)}s.mergedAttrs=na(s.mergedAttrs,s.attrs)}function Om(t,i,s,u,g,x){for(let te=0;te<u.length;te++)Eo(ca(s,i),t,u[te].type);!function I_(t,i,s){t.flags|=1,t.directiveStart=i,t.directiveEnd=i+s,t.providerIndexes=i}(s,t.data.length,u.length);for(let te=0;te<u.length;te++){const ve=u[te];ve.providersResolver&&ve.providersResolver(ve)}let T=!1,A=!1,k=vd(t,i,u.length,null);for(let te=0;te<u.length;te++){const ve=u[te];s.mergedAttrs=na(s.mergedAttrs,ve.hostAttrs),lh(t,s,i,k,ve),Lm(k,ve,g),null!==ve.contentQueries&&(s.flags|=4),(null!==ve.hostBindings||null!==ve.hostAttrs||0!==ve.hostVars)&&(s.flags|=64);const Ke=ve.type.prototype;!T&&(Ke.ngOnChanges||Ke.ngOnInit||Ke.ngDoCheck)&&((t.preOrderHooks??=[]).push(s.index),T=!0),!A&&(Ke.ngOnChanges||Ke.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(s.index),A=!0),k++}!function x_(t,i,s){const g=i.directiveEnd,x=t.data,T=i.attrs,A=[];let k=null,te=null;for(let ve=i.directiveStart;ve<g;ve++){const Ke=x[ve],kt=s?s.get(Ke):null,Sn=kt?kt.outputs:null;k=ul(Ke.inputs,ve,k,kt?kt.inputs:null),te=ul(Ke.outputs,ve,te,Sn);const si=null===k||null===T||cs(i)?null:l(k,ve,T);A.push(si)}null!==k&&(k.hasOwnProperty("class")&&(i.flags|=8),k.hasOwnProperty("style")&&(i.flags|=16)),i.initialInputs=A,i.inputs=k,i.outputs=te}(t,s,x)}function Lf(t,i,s){const u=s.directiveStart,g=s.directiveEnd,x=s.index,T=function U(){return Ki.lFrame.currentDirectiveIndex}();try{Re(x);for(let A=u;A<g;A++){const k=t.data[A],te=i[A];O(A),(null!==k.hostBindings||0!==k.hostVars||null!==k.hostAttrs)&&T_(k,te)}}finally{Re(-1),O(T)}}function T_(t,i){null!==t.hostBindings&&t.hostBindings(1,i)}function kf(t,i,s){i.componentOffset=s,(t.components??=[]).push(i.index)}function Lm(t,i,s){if(s){if(i.exportAs)for(let u=0;u<i.exportAs.length;u++)s[i.exportAs[u]]=t;Ds(i)&&(s[""]=t)}}function lh(t,i,s,u,g){t.data[u]=g;const x=g.factory||(g.factory=$o(g.type)),T=new Zn(x,Ds(g),Zc);t.blueprint[u]=T,s[u]=T,function C_(t,i,s,u,g){const x=g.hostBindings;if(x){let T=t.hostBindingOpCodes;null===T&&(T=t.hostBindingOpCodes=[]);const A=~i.index;(function E_(t){let i=t.length;for(;i>0;){const s=t[--i];if("number"==typeof s&&s<0)return s}return 0})(T)!=A&&T.push(A),T.push(s,u,x)}}(t,i,u,vd(t,s,g.hostVars,pr),g)}function Ml(t,i,s,u,g,x){const T=Nr(t,i);!function r(t,i,s,u,g,x,T){if(null==x)t.removeAttribute(i,g,s);else{const A=null==T?mn(x):T(x,u||"",g);t.setAttribute(i,g,A,s)}}(i[Yi],T,x,t.value,s,u,g)}function e(t,i,s,u,g,x){const T=x[i];if(null!==T)for(let A=0;A<T.length;)o(u,s,T[A++],T[A++],T[A++])}function o(t,i,s,u,g){const x=K(null);try{const T=t.inputTransforms;null!==T&&T.hasOwnProperty(u)&&(g=T[u].call(i,g)),null!==t.setInput?t.setInput(i,g,s,u):i[u]=g}finally{K(x)}}function l(t,i,s){let u=null,g=0;for(;g<s.length;){const x=s[g];if(0!==x)if(5!==x){if("number"==typeof x)break;if(t.hasOwnProperty(x)){null===u&&(u=[]);const T=t[x];for(let A=0;A<T.length;A+=2)if(T[A]===i){u.push(x,T[A+1],s[g+1]);break}}g+=2}else g+=2;else g+=4}return u}function f(t,i,s,u){return[t,!0,0,i,null,u,null,s,null,null]}function _(t,i){const s=t.contentQueries;if(null!==s){const u=K(null);try{for(let g=0;g<s.length;g+=2){const T=s[g+1];if(-1!==T){const A=t.data[T];n(s[g]),A.contentQueries(2,i[T],T)}}}finally{K(u)}}}function y(t,i){return t[Qo]?t[Pa][us]=i:t[Qo]=i,t[Pa]=i,i}function w(t,i,s){n(0);const u=K(null);try{i(t,s)}finally{K(u)}}function D(t){return t[ra]||(t[ra]=[])}function L(t){return t.cleanup||(t.cleanup=[])}function V(t,i){const s=t[Vo],u=s?s.get($c,null):null;u&&u.handleError(i)}function Y(t,i,s,u,g){for(let x=0;x<s.length;){const T=s[x++],A=s[x++];o(t.data[T],i[T],u,A,g)}}function Q(t,i,s){const u=tl(i,t);!function Rg(t,i,s){t.setValue(i,s)}(t[Yi],u,s)}function st(t,i,s,u){const g=i[Ni];if(256==(256&g))return;i[Cs].inlineEffectRunner?.flush(),v(i);let T=null,A=null;(function vt(t){return 2!==t.type})(t)&&(A=function Vc(t){return t[_a]??function dv(t){const i=Tf.pop()??Object.create(f_);return i.lView=t,i}(t)}(i),T=function Ce(t){return t&&(t.nextProducerIndex=0),K(t)}(A));try{Fl(i),function nu(t){return Ki.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==s&&Dm(t,i,s,2,u);const k=3==(3&g);if(k){const Ke=t.preOrderCheckHooks;null!==Ke&&qt(i,Ke,null)}else{const Ke=t.preOrderHooks;null!==Ke&&Wt(i,Ke,0,null),an(i,0)}if(function At(t){for(let i=Vh(t);null!==i;i=$h(i)){if(!(i[Ni]&Ts.HasTransplantedViews))continue;const s=i[aa];for(let u=0;u<s.length;u++){xl(s[u])}}}(i),St(i,0),null!==t.contentQueries&&_(t,i),k){const Ke=t.contentCheckHooks;null!==Ke&&qt(i,Ke)}else{const Ke=t.contentHooks;null!==Ke&&Wt(i,Ke,1),an(i,1)}!function y_(t,i){const s=t.hostBindingOpCodes;if(null!==s)try{for(let u=0;u<s.length;u++){const g=s[u];if(g<0)Re(~g);else{const x=g,T=s[++u],A=s[++u];P(T,x),A(2,i[x])}}}finally{Re(-1)}}(t,i);const te=t.components;null!==te&&Jn(i,te,0);const ve=t.viewQuery;if(null!==ve&&w(2,ve,u),k){const Ke=t.viewCheckHooks;null!==Ke&&qt(i,Ke)}else{const Ke=t.viewHooks;null!==Ke&&Wt(i,Ke,2),an(i,2)}if(!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),i[Ll]){for(const Ke of i[Ll])Ke();i[Ll]=null}i[Ni]&=-73}catch(k){throw bl(i),k}finally{null!==A&&(function de(t,i){if(K(i),t&&void 0!==t.producerNode&&void 0!==t.producerIndexOfThis&&void 0!==t.producerLastReadVersion){if(Ge(t))for(let s=t.nextProducerIndex;s<t.producerNode.length;s++)Ae(t.producerNode[s],t.producerIndexOfThis[s]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}(A,T),function bm(t){t.lView[_a]!==t&&(t.lView=null,Tf.push(t))}(A)),Z()}}function St(t,i){for(let s=Vh(t);null!==s;s=$h(s)){s[Ni]&=~Ts.HasChildViewsToRefresh;for(let u=mo;u<s.length;u++)nn(s[u],i)}}function un(t,i,s){nn(Zo(i,t),s)}function nn(t,i){kl(t)&&In(t,i)}function In(t,i){const u=t[ai],g=t[Ni],x=t[_a];let T=!!(0===i&&16&g);if(T||=!!(64&g&&0===i),T||=!!(1024&g),T||=!(!x?.dirty||!Pe(x)),x&&(x.dirty=!1),t[Ni]&=-9217,T)st(u,t,u.template,t[Ar]);else if(8192&g){St(t,1);const A=u.components;null!==A&&Jn(t,A,1)}}function Jn(t,i,s){for(let u=0;u<i.length;u++)un(t,i[u],s)}function hn(t){for(;t;){t[Ni]|=64;const i=Ud(t);if(_l(t)&&!i)return t;t=i}return null}class On{get rootNodes(){const i=this._lView,s=i[ai];return rh(s,i,s.firstChild,[])}constructor(i,s,u=!0){this._lView=i,this._cdRefInjectingView=s,this.notifyErrorHandler=u,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Ar]}set context(i){this._lView[Ar]=i}get destroyed(){return 256==(256&this._lView[Ni])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const i=this._lView[Jr];if(go(i)){const s=i[8],u=s?s.indexOf(this):-1;u>-1&&(Vd(i,u),_o(s,u))}this._attachedToViewContainer=!1}$d(this._lView[ai],this._lView)}onDestroy(i){ms(this._lView,i)}markForCheck(){hn(this._cdRefInjectingView||this._lView)}detach(){this._lView[Ni]&=-129}reattach(){ku(this._lView),this._lView[Ni]|=128}detectChanges(){!function Ue(t,i=!0){const s=t[Cs],u=s.rendererFactory,g=s.afterRenderEventManager;u.begin?.(),g?.begin();try{const T=t[ai];st(T,t,T.template,t[Ar]),function ot(t){let i=0;for(;9216&t[Ni]||t[_a]?.dirty;){if(100===i)throw new se(103,!1);i++,In(t,1)}}(t)}catch(T){throw i&&V(t,T),T}finally{u.end?.(),s.inlineEffectRunner?.flush(),g?.end()}}(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new se(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Vy(t,i){zc(t,i,i[Yi],2,null,null)}(this._lView[ai],this._lView)}attachToAppRef(i){if(this._attachedToViewContainer)throw new se(902,!1);this._appRef=i}}let kn=(()=>{class t{static#e=this.__NG_ELEMENT_ID__=Gn}return t})();function Gn(t){return function ii(t,i,s){if(Xa(t)&&!s){const u=Zo(t.index,i);return new On(u,u)}return 47&t.type?new On(i[Xr],i):null}(Er(),Nn(),16==(16&t))}let Hi=(()=>{class t{static#e=this.__NG_ELEMENT_ID__=Pi;static#t=this.__NG_ENV_ID__=s=>s}return t})();class ri extends Hi{constructor(i){super(),this._lView=i}onDestroy(i){return ms(this._lView,i),()=>function va(t,i){if(null===t[Es])return;const s=t[Es].indexOf(i);-1!==s&&t[Es].splice(s,1)}(this._lView,i)}}function Pi(){return new ri(Nn())}const Wr=new Set;function Or(t){Wr.has(t)||(Wr.add(t),performance?.mark?.("mark_use_counter",{detail:{feature:t}}))}function zr(t){return i=>{setTimeout(t,void 0,i)}}const kr=class eo extends Dt.x{constructor(i=!1){super(),this.__isAsync=i}emit(i){super.next(i)}subscribe(i,s,u){let g=i,x=s||(()=>null),T=u;if(i&&"object"==typeof i){const k=i;g=k.next?.bind(k),x=k.error?.bind(k),T=k.complete?.bind(k)}this.__isAsync&&(x=zr(x),g&&(g=zr(g)),T&&(T=zr(T)));const A=super.subscribe({next:g,error:x,complete:T});return i instanceof Ie.w0&&i.add(A),A}};function vo(...t){}class xr{constructor({enableLongStackTrace:i=!1,shouldCoalesceEventChangeDetection:s=!1,shouldCoalesceRunChangeDetection:u=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new kr(!1),this.onMicrotaskEmpty=new kr(!1),this.onStable=new kr(!1),this.onError=new kr(!1),typeof Zone>"u")throw new se(908,!1);Zone.assertZonePatched();const g=this;g._nesting=0,g._outer=g._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(g._inner=g._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(g._inner=g._inner.fork(Zone.longStackTraceZoneSpec)),g.shouldCoalesceEventChangeDetection=!u&&s,g.shouldCoalesceRunChangeDetection=u,g.lastRequestAnimationFrameId=-1,g.nativeRequestAnimationFrame=function No(){const t="function"==typeof J.requestAnimationFrame;let i=J[t?"requestAnimationFrame":"setTimeout"],s=J[t?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&i&&s){const u=i[Zone.__symbol__("OriginalDelegate")];u&&(i=u);const g=s[Zone.__symbol__("OriginalDelegate")];g&&(s=g)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:s}}().nativeRequestAnimationFrame,function zo(t){const i=()=>{!function Rr(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(J,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,qr(t),t.isCheckStableRunning=!0,uo(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),qr(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(s,u,g,x,T,A)=>{if(function ts(t){return!(!Array.isArray(t)||1!==t.length)&&!0===t[0].data?.__ignore_ng_zone__}(A))return s.invokeTask(g,x,T,A);try{return Os(t),s.invokeTask(g,x,T,A)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===x.type||t.shouldCoalesceRunChangeDetection)&&i(),Oo(t)}},onInvoke:(s,u,g,x,T,A,k)=>{try{return Os(t),s.invoke(g,x,T,A,k)}finally{t.shouldCoalesceRunChangeDetection&&i(),Oo(t)}},onHasTask:(s,u,g,x)=>{s.hasTask(g,x),u===g&&("microTask"==x.change?(t._hasPendingMicrotasks=x.microTask,qr(t),uo(t)):"macroTask"==x.change&&(t.hasPendingMacrotasks=x.macroTask))},onHandleError:(s,u,g,x)=>(s.handleError(g,x),t.runOutsideAngular(()=>t.onError.emit(x)),!1)})}(g)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!xr.isInAngularZone())throw new se(909,!1)}static assertNotInAngularZone(){if(xr.isInAngularZone())throw new se(909,!1)}run(i,s,u){return this._inner.run(i,s,u)}runTask(i,s,u,g){const x=this._inner,T=x.scheduleEventTask("NgZoneEvent: "+g,i,Bo,vo,vo);try{return x.runTask(T,s,u)}finally{x.cancelTask(T)}}runGuarded(i,s,u){return this._inner.runGuarded(i,s,u)}runOutsideAngular(i){return this._outer.run(i)}}const Bo={};function uo(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function qr(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function Os(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Oo(t){t._nesting--,uo(t)}class as{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new kr,this.onMicrotaskEmpty=new kr,this.onStable=new kr,this.onError=new kr}run(i,s,u){return i.apply(s,u)}runGuarded(i,s,u){return i.apply(s,u)}runOutsideAngular(i){return i()}runTask(i,s,u,g){return i.apply(s,u)}}const Jo=new mt("",{providedIn:"root",factory:Rs});function Rs(){const t=_r(xr);let i=!0;return function qe(...t){const i=(0,Ut.yG)(t),s=(0,Ut._6)(t,1/0),u=t;return u.length?1===u.length?(0,Rn.Xf)(u[0]):(0,on.J)(s)((0,Hn.D)(u,i)):Vn.E}(new Ct.y(g=>{i=t.isStable&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks,t.runOutsideAngular(()=>{g.next(i),g.complete()})}),new Ct.y(g=>{let x;t.runOutsideAngular(()=>{x=t.onStable.subscribe(()=>{xr.assertNotInAngularZone(),queueMicrotask(()=>{!i&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks&&(i=!0,g.next(!0))})})});const T=t.onUnstable.subscribe(()=>{xr.assertInAngularZone(),i&&(i=!1,t.runOutsideAngular(()=>{g.next(!1)}))});return()=>{x.unsubscribe(),T.unsubscribe()}}).pipe((0,Tn.B)()))}var Ls=function(t){return t[t.EarlyRead=0]="EarlyRead",t[t.Write=1]="Write",t[t.MixedReadWrite=2]="MixedReadWrite",t[t.Read=3]="Read",t}(Ls||{});const Ou={destroy(){}};function Fm(t,i){!i&&function Rc(t){if(!ti()&&!function Ko(){return ji}())throw new se(-203,!1)}();const s=i?.injector??_r(al);if(!function El(t){return"browser"===(t??_r(al)).get(Lc)}(s))return Ou;Or("NgAfterNextRender");const u=s.get(uh),g=u.handler??=new Bm,x=i?.phase??Ls.MixedReadWrite,T=()=>{g.unregister(k),A()},A=s.get(Hi).onDestroy(T),k=new Nm(s,x,()=>{T(),t()});return g.register(k),{destroy:T}}class Nm{constructor(i,s,u){this.phase=s,this.callbackFn=u,this.zone=i.get(xr),this.errorHandler=i.get($c,null,{optional:!0})}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(i){this.errorHandler?.handleError(i)}}}class Bm{constructor(){this.executingCallbacks=!1,this.buckets={[Ls.EarlyRead]:new Set,[Ls.Write]:new Set,[Ls.MixedReadWrite]:new Set,[Ls.Read]:new Set},this.deferredCallbacks=new Set}validateBegin(){if(this.executingCallbacks)throw new se(102,!1)}register(i){(this.executingCallbacks?this.deferredCallbacks:this.buckets[i.phase]).add(i)}unregister(i){this.buckets[i.phase].delete(i),this.deferredCallbacks.delete(i)}execute(){this.executingCallbacks=!0;for(const i of Object.values(this.buckets))for(const s of i)s.invoke();this.executingCallbacks=!1;for(const i of this.deferredCallbacks)this.buckets[i.phase].add(i);this.deferredCallbacks.clear()}destroy(){for(const i of Object.values(this.buckets))i.clear();this.deferredCallbacks.clear()}}let uh=(()=>{class t{constructor(){this.renderDepth=0,this.handler=null,this.internalCallbacks=[]}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){if(this.renderDepth--,0===this.renderDepth){for(const s of this.internalCallbacks)s();this.internalCallbacks.length=0,this.handler?.execute()}}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static#e=this.\u0275prov=Qt({token:t,providedIn:"root",factory:()=>new t})}return t})();function zm(t,i){const s=Zo(i,t),u=s[ai];!function Um(t,i){for(let s=i.length;s<t.blueprint.length;s++)i.push(t.blueprint[s])}(u,s);const g=s[wr];null!==g&&null===s[Ho]&&(s[Ho]=eh(g,s[Vo])),dl(u,s,s[Ar])}function dl(t,i,s){v(i);try{const u=t.viewQuery;null!==u&&w(1,u,s);const g=t.template;null!==g&&Dm(t,i,g,1,s),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&_(t,i),t.staticViewQueries&&w(2,t.viewQuery,s);const x=t.components;null!==x&&function M_(t,i){for(let s=0;s<i.length;s++)zm(t,i[s])}(i,x)}catch(u){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),u}finally{i[Ni]&=-5,Z()}}function Jl(t,i,s){let u=s?t.styles:null,g=s?t.classes:null,x=0;if(null!==i)for(let T=0;T<i.length;T++){const A=i[T];"number"==typeof A?x=A:1==x?g=Wi(g,A):2==x&&(u=Wi(u,A+": "+i[++T]+";"))}s?t.styles=u:t.stylesWithoutHost=u,s?t.classes=g:t.classesWithoutHost=g}class Ff extends yf{constructor(i){super(),this.ngModule=i}resolveComponentFactory(i){const s=_i(i);return new dh(s,this.ngModule)}}function Nf(t){const i=[];for(let s in t)t.hasOwnProperty(s)&&i.push({propName:t[s],templateName:s});return i}class jm{constructor(i,s){this.injector=i,this.parentInjector=s}get(i,s,u){u=Uo(u);const g=this.injector.get(i,gc,u);return g!==gc||s===gc?g:this.parentInjector.get(i,s,u)}}class dh extends Iu{get inputs(){const i=this.componentDef,s=i.inputTransforms,u=Nf(i.inputs);if(null!==s)for(const g of u)s.hasOwnProperty(g.propName)&&(g.transform=s[g.propName]);return u}get outputs(){return Nf(this.componentDef.outputs)}constructor(i,s){super(),this.componentDef=i,this.ngModule=s,this.componentType=i.type,this.selector=function Sa(t){return t.map(bo).join(",")}(i.selectors),this.ngContentSelectors=i.ngContentSelectors?i.ngContentSelectors:[],this.isBoundToModule=!!s}create(i,s,u,g){let x=(g=g||this.ngModule)instanceof Fa?g:g?.injector;x&&null!==this.componentDef.getStandaloneInjector&&(x=this.componentDef.getStandaloneInjector(x)||x);const T=x?new jm(i,x):i,A=T.get(mm,null);if(null===A)throw new se(407,!1);const ve={rendererFactory:A,sanitizer:T.get(gm,null),inlineEffectRunner:null,afterRenderEventManager:T.get(uh,null)},Ke=A.createRenderer(null,this.componentDef),kt=this.componentDef.selectors[0][0]||"div",Zt=u?function mv(t,i,s,u){const x=u.get(p_,!1)||s===fo.ShadowDom,T=t.selectRootElement(i,x);return function xd(t){Of(t)}(T),T}(Ke,u,this.componentDef.encapsulation,T):Gh(Ke,kt,function Hc(t){const i=t.toLowerCase();return"svg"===i?"svg":"math"===i?"math":null}(kt)),bi=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let Fi=null;null!==Zt&&(Fi=eh(Zt,T,!0));const ni=Im(0,null,null,1,0,null,null,null,null,null,null),ar=ah(null,ni,null,bi,null,null,ve,Ke,T,null,Fi);let Yr,so;v(ar);try{const ta=this.componentDef;let vh,U0=null;ta.findHostDirectiveDefs?(vh=[],U0=new Map,ta.findHostDirectiveDefs(ta,vh,U0),vh.push(ta)):vh=[ta];const hA=function Ma(t,i){const s=t[ai],u=er;return t[u]=i,Pu(s,u,2,"#host",null)}(ar,Zt),fA=function hh(t,i,s,u,g,x,T){const A=g[ai];!function Vm(t,i,s,u){for(const g of t)i.mergedAttrs=na(i.mergedAttrs,g.hostAttrs);null!==i.mergedAttrs&&(Jl(i,i.mergedAttrs,!0),null!==s&&Jp(u,s,i))}(u,t,i,T);let k=null;null!==i&&(k=eh(i,g[Vo]));const te=x.rendererFactory.createRenderer(i,s);let ve=16;s.signals?ve=4096:s.onPush&&(ve=64);const Ke=ah(g,v_(s),null,ve,g[t.index],t,x,te,null,null,k);return A.firstCreatePass&&kf(A,t,u.length-1),y(g,Ke),g[t.index]=Ke}(hA,Zt,ta,vh,ar,ve,Ke);so=rc(ni,er),Zt&&function Ru(t,i,s,u){if(u)ns(t,s,["ng-version",a_.full]);else{const{attrs:g,classes:x}=function ia(t){const i=[],s=[];let u=1,g=2;for(;u<t.length;){let x=t[u];if("string"==typeof x)2===g?""!==x&&i.push(x,t[++u]):8===g&&s.push(x);else{if(!Xo(g))break;g=x}u++}return{attrs:i,classes:s}}(i.selectors[0]);g&&ns(t,s,g),x&&x.length>0&&Yp(t,s,x.join(" "))}}(Ke,ta,Zt,u),void 0!==s&&function pC(t,i,s){const u=t.projection=[];for(let g=0;g<i.length;g++){const x=s[g];u.push(null!=x?Array.from(x):null)}}(so,this.ngContentSelectors,s),Yr=function A_(t,i,s,u,g,x){const T=Er(),A=g[ai],k=Nr(T,g);Om(A,g,T,s,null,u);for(let ve=0;ve<s.length;ve++)Ir(Ys(g,A,T.directiveStart+ve,T),g);Lf(A,g,T),k&&Ir(k,g);const te=Ys(g,A,T.directiveStart+T.componentOffset,T);if(t[Ar]=g[Ar]=te,null!==x)for(const ve of x)ve(te,i);return Af(A,T,t),te}(fA,ta,vh,U0,ar,[mC]),dl(ni,ar,null)}finally{Z()}return new Ia(this.componentType,Yr,_d(so,ar),ar,so)}}class Ia extends av{constructor(i,s,u,g,x){super(),this.location=u,this._rootLView=g,this._tNode=x,this.previousInputValues=null,this.instance=s,this.hostView=this.changeDetectorRef=new On(g,void 0,!1),this.componentType=i}setInput(i,s){const u=this._tNode.inputs;let g;if(null!==u&&(g=u[i])){if(this.previousInputValues??=new Map,this.previousInputValues.has(i)&&Object.is(this.previousInputValues.get(i),s))return;const x=this._rootLView;Y(x[ai],x,g,i,s),this.previousInputValues.set(i,s),hn(Zo(this._tNode.index,x))}}get injector(){return new es(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(i){this.hostView.onDestroy(i)}}function mC(){const t=Er();Rt(Nn()[ai],t)}function yv(t){let i=function sx(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),s=!0;const u=[t];for(;i;){let g;if(Ds(t))g=i.\u0275cmp||i.\u0275dir;else{if(i.\u0275cmp)throw new se(903,!1);g=i.\u0275dir}if(g){if(s){u.push(g);const T=t;T.inputs=S_(t.inputs),T.inputTransforms=S_(t.inputTransforms),T.declaredInputs=S_(t.declaredInputs),T.outputs=S_(t.outputs);const A=g.hostBindings;A&&vC(t,A);const k=g.viewQuery,te=g.contentQueries;if(k&&_C(t,k),te&&yC(t,te),gr(t.inputs,g.inputs),gr(t.declaredInputs,g.declaredInputs),gr(t.outputs,g.outputs),null!==g.inputTransforms&&(null===T.inputTransforms&&(T.inputTransforms={}),gr(T.inputTransforms,g.inputTransforms)),Ds(g)&&g.data.animation){const ve=t.data;ve.animation=(ve.animation||[]).concat(g.data.animation)}}const x=g.features;if(x)for(let T=0;T<x.length;T++){const A=x[T];A&&A.ngInherit&&A(t),A===yv&&(s=!1)}}i=Object.getPrototypeOf(i)}!function gC(t){let i=0,s=null;for(let u=t.length-1;u>=0;u--){const g=t[u];g.hostVars=i+=g.hostVars,g.hostAttrs=na(g.hostAttrs,s=na(s,g.hostAttrs))}}(u)}function S_(t){return t===po?{}:t===mr?[]:t}function _C(t,i){const s=t.viewQuery;t.viewQuery=s?(u,g)=>{i(u,g),s(u,g)}:i}function yC(t,i){const s=t.contentQueries;t.contentQueries=s?(u,g,x)=>{i(u,g,x),s(u,g,x)}:i}function vC(t,i){const s=t.hostBindings;t.hostBindings=s?(u,g)=>{i(u,g),s(u,g)}:i}function ux(t){const i=t.inputConfig,s={};for(const u in i)if(i.hasOwnProperty(u)){const g=i[u];Array.isArray(g)&&g[2]&&(s[u]=g[2])}t.inputTransforms=s}function Wc(t,i,s){return t[i]=s}function xs(t,i,s){return!Object.is(t[i],s)&&(t[i]=s,!0)}function fh(t,i,s,u){const g=xs(t,i,s);return xs(t,i+1,u)||g}function vv(t,i,s,u){const g=Nn();return xs(g,ba(),i)&&(Cr(),Ml(Fe(),g,t,i,s,u)),vv}function zf(t,i,s,u){return xs(t,ba(),s)?i+mn(s)+u:pr}function jf(t,i,s,u,g,x,T,A){const te=function P_(t,i,s,u,g){const x=fh(t,i,s,u);return xs(t,i+2,g)||x}(t,Ra(),s,g,T);return La(3),te?i+mn(s)+u+mn(g)+x+mn(T)+A:pr}function Vf(t,i,s,u,g,x,T,A,k,te){const Ke=function Kl(t,i,s,u,g,x){const T=fh(t,i,s,u);return fh(t,i+2,g,x)||T}(t,Ra(),s,g,T,k);return La(4),Ke?i+mn(s)+u+mn(g)+x+mn(T)+A+mn(k)+te:pr}function O_(t,i){return t<<17|i<<2}function wd(t){return t>>17&32767}function xv(t){return 2|t}function ph(t){return(131068&t)>>2}function bv(t,i){return-131069&t|i<<2}function wv(t){return 1|t}function xx(t,i,s,u,g){const x=t[s+1],T=null===i;let A=u?wd(x):ph(x),k=!1;for(;0!==A&&(!1===k||T);){const ve=t[A+1];SC(t[A],i)&&(k=!0,t[A+1]=u?wv(ve):xv(ve)),A=u?wd(ve):ph(ve)}k&&(t[s+1]=u?xv(x):wv(x))}function SC(t,i){return null===t||null==i||(Array.isArray(t)?t[1]:t)===i||!(!Array.isArray(t)||"string"!=typeof i)&&Mc(t,i)>=0}function Cv(t,i,s){const u=Nn();return xs(u,ba(),i)&&Ps(Cr(),Fe(),u,t,i,u[Yi],s,!1),Cv}function Ev(t,i,s,u,g){const T=g?"class":"style";Y(t,s,i.inputs[T],T,u)}function Tv(t,i,s){return vc(t,i,s,!1),Tv}function Dv(t,i){return vc(t,i,null,!0),Dv}function vc(t,i,s,u){const g=Nn(),x=Cr(),T=La(2);x.firstUpdatePass&&function Mx(t,i,s,u){const g=t.data;if(null===g[s+1]){const x=g[re()],T=function Ix(t,i){return i>=t.expandoStartIndex}(t,s);(function Ox(t,i){return 0!=(t.flags&(i?8:16))})(x,u)&&null===i&&!T&&(i=!1),i=function zC(t,i,s,u){const g=function z(t){const i=Ki.lFrame.currentDirectiveIndex;return-1===i?null:t[i]}(t);let x=u?i.residualClasses:i.residualStyles;if(null===g)0===(u?i.classBindings:i.styleBindings)&&(s=Zm(s=Iv(null,t,i,s,u),i.attrs,u),x=null);else{const T=i.directiveStylingLast;if(-1===T||t[T]!==g)if(s=Iv(g,t,i,s,u),null===x){let k=function UC(t,i,s){const u=s?i.classBindings:i.styleBindings;if(0!==ph(u))return t[wd(u)]}(t,i,u);void 0!==k&&Array.isArray(k)&&(k=Iv(null,t,i,k[1],u),k=Zm(k,i.attrs,u),function jC(t,i,s,u){t[wd(s?i.classBindings:i.styleBindings)]=u}(t,i,u,k))}else x=function VC(t,i,s){let u;const g=i.directiveEnd;for(let x=1+i.directiveStylingLast;x<g;x++)u=Zm(u,t[x].hostAttrs,s);return Zm(u,i.attrs,s)}(t,i,u)}return void 0!==x&&(u?i.residualClasses=x:i.residualStyles=x),s}(g,x,i,u),function MC(t,i,s,u,g,x){let T=x?i.classBindings:i.styleBindings,A=wd(T),k=ph(T);t[u]=s;let ve,te=!1;if(Array.isArray(s)?(ve=s[1],(null===ve||Mc(s,ve)>0)&&(te=!0)):ve=s,g)if(0!==k){const kt=wd(t[A+1]);t[u+1]=O_(kt,A),0!==kt&&(t[kt+1]=bv(t[kt+1],u)),t[A+1]=function DC(t,i){return 131071&t|i<<17}(t[A+1],u)}else t[u+1]=O_(A,0),0!==A&&(t[A+1]=bv(t[A+1],u)),A=u;else t[u+1]=O_(k,0),0===A?A=u:t[k+1]=bv(t[k+1],u),k=u;te&&(t[u+1]=xv(t[u+1])),xx(t,ve,u,!0),xx(t,ve,u,!1),function AC(t,i,s,u,g){const x=g?t.residualClasses:t.residualStyles;null!=x&&"string"==typeof i&&Mc(x,i)>=0&&(s[u+1]=wv(s[u+1]))}(i,ve,t,u,x),T=O_(A,k),x?i.classBindings=T:i.styleBindings=T}(g,x,i,s,T,u)}}(x,t,T,u),i!==pr&&xs(g,T,i)&&function Sx(t,i,s,u,g,x,T,A){if(!(3&i.type))return;const k=t.data,te=k[A+1],ve=function IC(t){return 1==(1&t)}(te)?Px(k,i,s,g,ph(te),T):void 0;R_(ve)||(R_(x)||function TC(t){return 2==(2&t)}(te)&&(x=Px(k,null,s,g,A,T)),function ld(t,i,s,u,g){if(i)g?t.addClass(s,u):t.removeClass(s,u);else{let x=-1===u.indexOf("-")?void 0:td.DashCase;null==g?t.removeStyle(s,u,x):("string"==typeof g&&g.endsWith("!important")&&(g=g.slice(0,-10),x|=td.Important),t.setStyle(s,u,g,x))}}(u,T,tl(re(),s),g,x))}(x,x.data[re()],g,g[Yi],t,g[T+1]=function HC(t,i){return null==t||""===t||("string"==typeof i?t+=i:"object"==typeof t&&(t=ki(yo(t)))),t}(i,s),u,T)}function Iv(t,i,s,u,g){let x=null;const T=s.directiveEnd;let A=s.directiveStylingLast;for(-1===A?A=s.directiveStart:A++;A<T&&(x=i[A],u=Zm(u,x.hostAttrs,g),x!==t);)A++;return null!==t&&(s.directiveStylingLast=A),u}function Zm(t,i,s){const u=s?1:2;let g=-1;if(null!==i)for(let x=0;x<i.length;x++){const T=i[x];"number"==typeof T?g=T:g===u&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),Ta(t,T,!!s||i[++x]))}return void 0===t?null:t}function Px(t,i,s,u,g,x){const T=null===i;let A;for(;g>0;){const k=t[g],te=Array.isArray(k),ve=te?k[1]:k,Ke=null===ve;let kt=s[g+1];kt===pr&&(kt=Ke?mr:void 0);let Zt=Ke?ka(kt,u):ve===u?kt:void 0;if(te&&!R_(Zt)&&(Zt=ka(k,u)),R_(Zt)&&(A=Zt,T))return A;const Sn=t[g+1];g=T?wd(Sn):ph(Sn)}if(null!==i){let k=x?i.residualClasses:i.residualStyles;null!=k&&(A=ka(k,u))}return A}function R_(t){return void 0!==t}function Yf(t,i){return!i||Fh(t)}function Ym(t,i,s,u=!0){const g=i[ai];if(function od(t,i,s,u){const g=mo+u,x=s.length;u>0&&(s[g-1][us]=i),u<x-mo?(i[us]=s[g],fg(s,mo+u,i)):(s.push(i),i[us]=null),i[Jr]=s;const T=i[Ja];null!==T&&s!==T&&function $y(t,i){const s=t[aa];i[Xr]!==i[Jr][Jr][Xr]&&(t[Ni]|=Ts.HasTransplantedViews),null===s?t[aa]=[i]:s.push(i)}(T,i);const A=i[is];null!==A&&A.insertView(t),ku(i),i[Ni]|=128}(g,i,t,s),u){const x=Kh(s,t),T=i[Yi],A=Bc(T,t[Wo]);null!==A&&function Hh(t,i,s,u,g,x){u[wr]=g,u[wo]=i,zc(t,u,s,1,g,x)}(g,t[wo],T,i,A,x)}}let B_=(()=>{class t{static#e=this.__NG_ELEMENT_ID__=DE}return t})();function DE(){return Gx(Er(),Nn())}const IE=B_,$x=class extends IE{constructor(i,s,u){super(),this._lContainer=i,this._hostTNode=s,this._hostLView=u}get element(){return _d(this._hostTNode,this._hostLView)}get injector(){return new es(this._hostTNode,this._hostLView)}get parentInjector(){const i=br(this._hostTNode,this._hostLView);if(wi(i)){const s=tr(i,this._hostLView),u=Si(i);return new es(s[ai].data[u+8],s)}return new es(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(i){const s=Zx(this._lContainer);return null!==s&&s[i]||null}get length(){return this._lContainer.length-mo}createEmbeddedView(i,s,u){let g,x;"number"==typeof u?g=u:null!=u&&(g=u.index,x=u.injector);const A=i.createEmbeddedViewImpl(s||{},x,null);return this.insertImpl(A,g,Yf(this._hostTNode,null)),A}createComponent(i,s,u,g,x){const T=i&&!function Uu(t){return"function"==typeof t}(i);let A;if(T)A=s;else{const Sn=s||{};A=Sn.index,u=Sn.injector,g=Sn.projectableNodes,x=Sn.environmentInjector||Sn.ngModuleRef}const k=T?i:new dh(_i(i)),te=u||this.parentInjector;if(!x&&null==k.ngModule){const si=(T?te:this.parentInjector).get(Fa,null);si&&(x=si)}_i(k.componentType??{});const Zt=k.create(te,g,null,x);return this.insertImpl(Zt.hostView,A,Yf(this._hostTNode,null)),Zt}insert(i,s){return this.insertImpl(i,s,!0)}insertImpl(i,s,u){const g=i._lView;if(function Lu(t){return go(t[Jr])}(g)){const A=this.indexOf(i);if(-1!==A)this.detach(A);else{const k=g[Jr],te=new $x(k,k[wo],k[Jr]);te.detach(te.indexOf(i))}}const x=this._adjustIndex(s),T=this._lContainer;return Ym(T,g,x,u),i.attachToViewContainerRef(),fg(Fv(T),x,i),i}move(i,s){return this.insert(i,s)}indexOf(i){const s=Zx(this._lContainer);return null!==s?s.indexOf(i):-1}remove(i){const s=this._adjustIndex(i,-1),u=Vd(this._lContainer,s);u&&(_o(Fv(this._lContainer),s),$d(u[ai],u))}detach(i){const s=this._adjustIndex(i,-1),u=Vd(this._lContainer,s);return u&&null!=_o(Fv(this._lContainer),s)?new On(u):null}_adjustIndex(i,s=0){return i??this.length+s}};function Zx(t){return t[8]}function Fv(t){return t[8]||(t[8]=[])}function Gx(t,i){let s;const u=i[t.index];return go(u)?s=u:(s=f(u,i,null,t),i[t.index]=s,y(i,s)),Hx(s,i,t,u),new $x(s,t,i)}let Hx=function qx(t,i,s,u){if(t[Wo])return;let g;g=8&s.type?jr(u):function ME(t,i){const s=t[Yi],u=s.createComment(""),g=Nr(i,t);return Hl(s,Bc(s,g),u,function Ng(t,i){return t.nextSibling(i)}(s,g),!1),u}(i,s),t[Wo]=g},Nv=(t,i,s)=>!1;function Jf(t,i,s,u,g,x,T,A){const k=Nn(),te=Cr(),ve=t+er,Ke=te.firstCreatePass?function OE(t,i,s,u,g,x,T,A,k){const te=i.consts,ve=Pu(i,t,4,T||null,Hs(te,A));Pm(i,s,ve,Hs(te,k)),Rt(i,ve);const Ke=ve.tView=Im(2,ve,u,g,x,i.directiveRegistry,i.pipeRegistry,null,i.schemas,te,null);return null!==i.queries&&(i.queries.template(i,ve),Ke.queries=i.queries.embeddedTView(ve)),ve}(ve,te,k,i,s,u,g,x,T):te.data[ve];qs(Ke,!1);const kt=Yx(te,k,Ke,t);gt()&&Gd(te,k,kt,Ke),Ir(kt,k);const Zt=f(kt,k,kt,Ke);return k[ve]=Zt,y(k,Zt),function Wx(t,i,s){return Nv(t,i,s)}(Zt,Ke,k),ec(Ke)&&ql(te,k,Ke),null!=T&&Sf(k,Ke,A),Jf}let Yx=function Jx(t,i,s,u){return Pt(!0),i[Yi].createComment("")};function Z_(t,i,s,u){const g=Nn(),x=Cr(),T=er+t,A=g[Yi],k=x.firstCreatePass?function bT(t,i,s,u,g,x){const T=i.consts,k=Pu(i,t,2,u,Hs(T,g));return Pm(i,s,k,Hs(T,x)),null!==k.attrs&&Jl(k,k.attrs,!1),null!==k.mergedAttrs&&Jl(k,k.mergedAttrs,!0),null!==i.queries&&i.queries.elementStart(i,k),k}(T,x,g,i,s,u):x.data[T],te=v1(x,g,k,A,i,t);g[T]=te;const ve=ec(k);return qs(k,!0),Jp(A,te,k),32!=(32&k.flags)&&gt()&&Gd(x,g,te,k),0===function Qc(){return Ki.lFrame.elementDepthCount}()&&Ir(te,g),function Ec(){Ki.lFrame.elementDepthCount++}(),ve&&(ql(x,g,k),Af(x,k,g)),null!==u&&Sf(g,k),Z_}function G_(){let t=Er();ac()?nl():(t=t.parent,qs(t,!1));const i=t;(function xh(t){return Ki.skipHydrationRootTNode===t})(i)&&function la(){Ki.skipHydrationRootTNode=null}(),function Tc(){Ki.lFrame.elementDepthCount--}();const s=Cr();return s.firstCreatePass&&(Rt(s,t),bc(t)&&s.queries.elementEnd(t)),null!=i.classesWithoutHost&&function jn(t){return 0!=(8&t.flags)}(i)&&Ev(s,i,Nn(),i.classesWithoutHost,!0),null!=i.stylesWithoutHost&&function ei(t){return 0!=(16&t.flags)}(i)&&Ev(s,i,Nn(),i.stylesWithoutHost,!1),G_}function qv(t,i,s,u){return Z_(t,i,s,u),G_(),qv}let v1=(t,i,s,u,g,x)=>(Pt(!0),Gh(u,g,function We(){return Ki.lFrame.currentNamespace}()));function H_(t,i,s){const u=Nn(),g=Cr(),x=t+er,T=g.firstCreatePass?function ET(t,i,s,u,g){const x=i.consts,T=Hs(x,u),A=Pu(i,t,8,"ng-container",T);return null!==T&&Jl(A,T,!0),Pm(i,s,A,Hs(x,g)),null!==i.queries&&i.queries.elementStart(i,A),A}(x,g,u,i,s):g.data[x];qs(T,!0);const A=x1(g,u,T,t);return u[x]=A,gt()&&Gd(g,u,A,T),Ir(A,u),ec(T)&&(ql(g,u,T),Af(g,T,u)),null!=s&&Sf(u,T),H_}function W_(){let t=Er();const i=Cr();return ac()?nl():(t=t.parent,qs(t,!1)),i.firstCreatePass&&(Rt(i,t),bc(t)&&i.queries.elementEnd(t)),W_}function Yv(t,i,s){return H_(t,i,s),W_(),Yv}let x1=(t,i,s,u)=>(Pt(!0),Zp(i[Yi],""));function b1(){return Nn()}const gh=void 0;var MT=["en",[["a","p"],["AM","PM"],gh],[["AM","PM"],gh,gh],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],gh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],gh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",gh,"{1} 'at' {0}",gh],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function IT(t){const s=Math.floor(Math.abs(t)),u=t.toString().replace(/^[^.]*\.?/,"").length;return 1===s&&0===u?1:5}];let ip={};function Jv(t){const i=function AT(t){return t.toLowerCase().replace(/_/g,"-")}(t);let s=T1(i);if(s)return s;const u=i.split("-")[0];if(s=T1(u),s)return s;if("en"===u)return MT;throw new se(701,!1)}function E1(t){return Jv(t)[rp.PluralCase]}function T1(t){return t in ip||(ip[t]=J.ng&&J.ng.common&&J.ng.common.locales&&J.ng.common.locales[t]),ip[t]}var rp=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}(rp||{});const op="en-US";let D1=op;function Qv(t){return!!t&&"function"==typeof t.then}function K1(t){return!!t&&"function"==typeof t.subscribe}function e0(t,i,s,u){const g=Nn(),x=Cr(),T=Er();return function Q1(t,i,s,u,g,x,T){const A=ec(u),te=t.firstCreatePass&&L(t),ve=i[Ar],Ke=D(i);let kt=!0;if(3&u.type||T){const si=Nr(u,i),bi=T?T(si):si,Fi=Ke.length,ni=T?Yr=>T(jr(Yr[u.index])):u.index;let ar=null;if(!T&&A&&(ar=function CD(t,i,s,u){const g=t.cleanup;if(null!=g)for(let x=0;x<g.length-1;x+=2){const T=g[x];if(T===s&&g[x+1]===u){const A=i[ra],k=g[x+2];return A.length>k?A[k]:null}"string"==typeof T&&(x+=2)}return null}(t,i,g,u.index)),null!==ar)(ar.__ngLastListenerFn__||ar).__ngNextListenerFn__=x,ar.__ngLastListenerFn__=x,kt=!1;else{x=tb(u,i,ve,x,!1);const Yr=s.listen(bi,g,x);Ke.push(x,Yr),te&&te.push(g,ni,Fi,Fi+1)}}else x=tb(u,i,ve,x,!1);const Zt=u.outputs;let Sn;if(kt&&null!==Zt&&(Sn=Zt[g])){const si=Sn.length;if(si)for(let bi=0;bi<si;bi+=2){const so=i[Sn[bi]][Sn[bi+1]].subscribe(x),ta=Ke.length;Ke.push(x,so),te&&te.push(g,u.index,ta,-(ta+1))}}}(x,g,g[Yi],T,t,i,u),e0}function eb(t,i,s,u){try{return ps(6,i,s),!1!==s(u)}catch(g){return V(t,g),!1}finally{ps(7,i,s)}}function tb(t,i,s,u,g){return function x(T){if(T===Function)return u;hn(t.componentOffset>-1?Zo(t.index,i):i);let k=eb(i,s,u,T),te=x.__ngNextListenerFn__;for(;te;)k=eb(i,s,te,T)&&k,te=te.__ngNextListenerFn__;return g&&!1===k&&T.preventDefault(),k}}function nb(t=1){return function $(t){return(Ki.lFrame.contextLView=function oc(t,i){for(;t>0;)i=i[ds],t--;return i}(t,Ki.lFrame.contextLView))[Ar]}(t)}function ED(t,i){let s=null;const u=function Pl(t){const i=t.attrs;if(null!=i){const s=i.indexOf(5);if(!(1&s))return i[s+1]}return null}(t);for(let g=0;g<i.length;g++){const x=i[g];if("*"!==x){if(null===u?Ga(t,x,!0):Ha(u,x))return g}else s=g}return s}function ib(t){const i=Nn()[Xr][wo];if(!i.projection){const u=i.projection=Ii(t?t.length:1,null),g=u.slice();let x=i.child;for(;null!==x;){const T=t?ED(x,t):0;null!==T&&(g[T]?g[T].projectionNext=x:u[T]=x,g[T]=x),x=x.next}}}function rb(t,i=0,s){const u=Nn(),g=Cr(),x=Pu(g,er+t,16,null,s||null);null===x.projection&&(x.projection=i),nl(),(!u[Ho]||Co())&&32!=(32&x.flags)&&function Ug(t,i,s){As(i[Yi],0,i,s,Gp(t,s,i),sd(s.parent||i[wo],s,i))}(g,u,x)}function t0(t,i,s){return n0(t,"",i,"",s),t0}function n0(t,i,s,u,g){const x=Nn(),T=zf(x,i,s,u);return T!==pr&&Ps(Cr(),Fe(),x,t,T,x[Yi],g,!1),n0}function fb(t){return ya(function wl(){return Ki.lFrame.contextLView}(),er+t)}function Cb(t,i=""){const s=Nn(),u=Cr(),g=t+er,x=u.firstCreatePass?Pu(u,g,1,i,null):u.data[g],T=Eb(u,s,x,i,t);s[g]=T,gt()&&Gd(u,s,T,x),qs(x,!1)}let Eb=(t,i,s,u,g)=>(Pt(!0),function Zh(t,i){return t.createText(i)}(i[Yi],u));function r0(t){return X_("",t,""),r0}function X_(t,i,s){const u=Nn(),g=zf(u,t,i,s);return g!==pr&&Q(u,re(),g),X_}function o0(t,i,s,u,g){const x=Nn(),T=function Uf(t,i,s,u,g,x){const A=fh(t,Ra(),s,g);return La(2),A?i+mn(s)+u+mn(g)+x:pr}(x,t,i,s,u,g);return T!==pr&&Q(x,re(),T),o0}function s0(t,i,s,u,g,x,T){const A=Nn(),k=jf(A,t,i,s,u,g,x,T);return k!==pr&&Q(A,re(),k),s0}function a0(t,i,s,u,g,x,T,A,k){const te=Nn(),ve=Vf(te,t,i,s,u,g,x,T,A,k);return ve!==pr&&Q(te,re(),ve),a0}function l0(t,i,s,u,g){if(t=sn(t),Array.isArray(t))for(let x=0;x<t.length;x++)l0(t[x],i,s,u,g);else{const x=Cr(),T=Nn(),A=Er();let k=Xs(t)?t:sn(t.provide);const te=Oc(t),ve=1048575&A.providerIndexes,Ke=A.directiveStart,kt=A.providerIndexes>>20;if(Xs(t)||!t.multi){const Zt=new Zn(te,g,Zc),Sn=u0(k,i,g?ve:ve+kt,Ke);-1===Sn?(Eo(ca(A,T),x,k),c0(x,t,i.length),i.push(k),A.directiveStart++,A.directiveEnd++,g&&(A.providerIndexes+=1048576),s.push(Zt),T.push(Zt)):(s[Sn]=Zt,T[Sn]=Zt)}else{const Zt=u0(k,i,ve+kt,Ke),Sn=u0(k,i,ve,ve+kt),bi=Sn>=0&&s[Sn];if(g&&!bi||!g&&!(Zt>=0&&s[Zt])){Eo(ca(A,T),x,k);const Fi=function UD(t,i,s,u,g){const x=new Zn(t,s,Zc);return x.multi=[],x.index=i,x.componentProviders=0,Sb(x,g,u&&!s),x}(g?zD:BD,s.length,g,u,te);!g&&bi&&(s[Sn].providerFactory=Fi),c0(x,t,i.length,0),i.push(k),A.directiveStart++,A.directiveEnd++,g&&(A.providerIndexes+=1048576),s.push(Fi),T.push(Fi)}else c0(x,t,Zt>-1?Zt:Sn,Sb(s[g?Sn:Zt],te,!g&&u));!g&&u&&bi&&s[Sn].componentProviders++}}}function c0(t,i,s,u){const g=Xs(i),x=function by(t){return!!t.useClass}(i);if(g||x){const k=(x?sn(i.useClass):i).prototype.ngOnDestroy;if(k){const te=t.destroyHooks||(t.destroyHooks=[]);if(!g&&i.multi){const ve=te.indexOf(s);-1===ve?te.push(s,[u,k]):te[ve+1].push(u,k)}else te.push(s,k)}}}function Sb(t,i,s){return s&&t.componentProviders++,t.multi.push(i)-1}function u0(t,i,s,u){for(let g=s;g<u;g++)if(i[g]===t)return g;return-1}function BD(t,i,s,u){return d0(this.multi,[])}function zD(t,i,s,u){const g=this.multi;let x;if(this.providerFactory){const T=this.providerFactory.componentProviders,A=Ys(s,s[ai],this.providerFactory.index,u);x=A.slice(0,T),d0(g,x);for(let k=T;k<A.length;k++)x.push(A[k])}else x=[],d0(g,x);return x}function d0(t,i){for(let s=0;s<t.length;s++)i.push((0,t[s])());return i}function Pb(t,i=[]){return s=>{s.providersResolver=(u,g)=>function ND(t,i,s){const u=Cr();if(u.firstCreatePass){const g=Ds(t);l0(s,u.data,u.blueprint,g,!0),l0(i,u.data,u.blueprint,g,!1)}}(u,g?g(t):t,i)}}class _h{}class Ob{}function jD(t,i){return new h0(t,i??null,[])}class h0 extends _h{constructor(i,s,u){super(),this._parent=s,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Ff(this);const g=ue(i);this._bootstrapComponents=Qs(g.bootstrap),this._r3Injector=Tg(i,s,[{provide:_h,useValue:this},{provide:yf,useValue:this.componentFactoryResolver},...u],ki(i),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(i)}get injector(){return this._r3Injector}destroy(){const i=this._r3Injector;!i.destroyed&&i.destroy(),this.destroyCbs.forEach(s=>s()),this.destroyCbs=null}onDestroy(i){this.destroyCbs.push(i)}}class f0 extends Ob{constructor(i){super(),this.moduleType=i}create(i){return new h0(this.moduleType,i,[])}}class Rb extends _h{constructor(i){super(),this.componentFactoryResolver=new Ff(this),this.instance=null;const s=new pu([...i.providers,{provide:_h,useValue:this},{provide:yf,useValue:this.componentFactoryResolver}],i.parent||Sh(),i.debugName,new Set(["environment"]));this.injector=s,i.runEnvironmentInitializers&&s.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(i){this.injector.onDestroy(i)}}function Lb(t,i,s=null){return new Rb({providers:t,parent:i,debugName:s,runEnvironmentInitializers:!0}).injector}let $D=(()=>{class t{constructor(s){this._injector=s,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(s){if(!s.standalone)return null;if(!this.cachedInjectors.has(s)){const u=yp(0,s.type),g=u.length>0?Lb([u],this._injector,`Standalone[${s.type.name}]`):null;this.cachedInjectors.set(s,g)}return this.cachedInjectors.get(s)}ngOnDestroy(){try{for(const s of this.cachedInjectors.values())null!==s&&s.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=Qt({token:t,providedIn:"environment",factory:()=>new t(cr(Fa))})}return t})();function kb(t){Or("NgStandalone"),t.getStandaloneInjector=i=>i.get($D).getOrCreateStandaloneInjector(t)}function $b(t,i,s){const u=os()+t,g=Nn();return g[u]===pr?Wc(g,u,s?i.call(s):i()):function $m(t,i){return t[i]}(g,u)}function rg(t,i){const s=t[i];return s===pr?void 0:s}function Yb(t,i){const s=Cr();let u;const g=t+er;s.firstCreatePass?(u=function cI(t,i){if(i)for(let s=i.length-1;s>=0;s--){const u=i[s];if(t===u.name)return u}}(i,s.pipeRegistry),s.data[g]=u,u.onDestroy&&(s.destroyHooks??=[]).push(g,u.onDestroy)):u=s.data[g];const x=u.factory||(u.factory=$o(u.type)),A=di(Zc);try{const k=Dr(!1),te=x();return Dr(k),function TD(t,i,s,u){s>=t.data.length&&(t.data[s]=null,t.blueprint[s]=null),i[s]=u}(s,Nn(),g,te),te}finally{di(A)}}function Jb(t,i,s){const u=t+er,g=Nn(),x=ya(g,u);return og(g,u)?function Zb(t,i,s,u,g,x){const T=i+s;return xs(t,T,g)?Wc(t,T+1,x?u.call(x,g):u(g)):rg(t,T+1)}(g,os(),i,x.transform,s,x):x.transform(s)}function Kb(t,i,s,u){const g=t+er,x=Nn(),T=ya(x,g);return og(x,g)?function Gb(t,i,s,u,g,x,T){const A=i+s;return fh(t,A,g,x)?Wc(t,A+2,T?u.call(T,g,x):u(g,x)):rg(t,A+2)}(x,os(),i,T.transform,s,u,T):T.transform(s,u)}function og(t,i){return t[ai].data[i].pure}function fI(){return this._results[Symbol.iterator]()}class m0{static#e=Symbol.iterator;get changes(){return this._changes||(this._changes=new kr)}constructor(i=!1){this._emitDistinctChangesOnly=i,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const s=m0.prototype;s[Symbol.iterator]||(s[Symbol.iterator]=fI)}get(i){return this._results[i]}map(i){return this._results.map(i)}filter(i){return this._results.filter(i)}find(i){return this._results.find(i)}reduce(i,s){return this._results.reduce(i,s)}forEach(i){this._results.forEach(i)}some(i){return this._results.some(i)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(i,s){this.dirty=!1;const u=function Po(t){return t.flat(Number.POSITIVE_INFINITY)}(i);(this._changesDetected=!function hg(t,i,s){if(t.length!==i.length)return!1;for(let u=0;u<t.length;u++){let g=t[u],x=i[u];if(s&&(g=s(g),x=s(x)),x!==g)return!1}return!0}(this._results,u,s))&&(this._results=u,this.length=u.length,this.last=u[this.length-1],this.first=u[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let sg=(()=>{class t{static#e=this.__NG_ELEMENT_ID__=gI}return t})();const pI=sg,mI=class extends pI{constructor(i,s,u){super(),this._declarationLView=i,this._declarationTContainer=s,this.elementRef=u}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(i,s){return this.createEmbeddedViewImpl(i,s)}createEmbeddedViewImpl(i,s,u){const g=function qm(t,i,s,u){const g=i.tView,A=ah(t,g,s,4096&t[Ni]?4096:16,null,i,null,null,null,u?.injector??null,u?.dehydratedView??null);A[Ja]=t[i.index];const te=t[is];return null!==te&&(A[is]=te.createEmbeddedView(g)),dl(g,A,s),A}(this._declarationLView,this._declarationTContainer,i,{injector:s,dehydratedView:u});return new On(g)}};function gI(){return ty(Er(),Nn())}function ty(t,i){return 4&t.type?new mI(i,t,_d(t,i)):null}class g0{constructor(i){this.queryList=i,this.matches=null}clone(){return new g0(this.queryList)}setDirty(){this.queryList.setDirty()}}class _0{constructor(i=[]){this.queries=i}createEmbeddedView(i){const s=i.queries;if(null!==s){const u=null!==i.contentQueries?i.contentQueries[0]:s.length,g=[];for(let x=0;x<u;x++){const T=s.getByIndex(x);g.push(this.queries[T.indexInDeclarationView].clone())}return new _0(g)}return null}insertView(i){this.dirtyQueriesWithMatches(i)}detachView(i){this.dirtyQueriesWithMatches(i)}dirtyQueriesWithMatches(i){for(let s=0;s<this.queries.length;s++)null!==sw(i,s).matches&&this.queries[s].setDirty()}}class Xb{constructor(i,s,u=null){this.predicate=i,this.flags=s,this.read=u}}class y0{constructor(i=[]){this.queries=i}elementStart(i,s){for(let u=0;u<this.queries.length;u++)this.queries[u].elementStart(i,s)}elementEnd(i){for(let s=0;s<this.queries.length;s++)this.queries[s].elementEnd(i)}embeddedTView(i){let s=null;for(let u=0;u<this.length;u++){const g=null!==s?s.length:0,x=this.getByIndex(u).embeddedTView(i,g);x&&(x.indexInDeclarationView=u,null!==s?s.push(x):s=[x])}return null!==s?new y0(s):null}template(i,s){for(let u=0;u<this.queries.length;u++)this.queries[u].template(i,s)}getByIndex(i){return this.queries[i]}get length(){return this.queries.length}track(i){this.queries.push(i)}}class v0{constructor(i,s=-1){this.metadata=i,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=s}elementStart(i,s){this.isApplyingToNode(s)&&this.matchTNode(i,s)}elementEnd(i){this._declarationNodeIndex===i.index&&(this._appliesToNextNode=!1)}template(i,s){this.elementStart(i,s)}embeddedTView(i,s){return this.isApplyingToNode(i)?(this.crossesNgTemplate=!0,this.addMatch(-i.index,s),new v0(this.metadata)):null}isApplyingToNode(i){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const s=this._declarationNodeIndex;let u=i.parent;for(;null!==u&&8&u.type&&u.index!==s;)u=u.parent;return s===(null!==u?u.index:-1)}return this._appliesToNextNode}matchTNode(i,s){const u=this.metadata.predicate;if(Array.isArray(u))for(let g=0;g<u.length;g++){const x=u[g];this.matchTNodeWithReadOption(i,s,_I(s,x)),this.matchTNodeWithReadOption(i,s,Ca(s,i,x,!1,!1))}else u===sg?4&s.type&&this.matchTNodeWithReadOption(i,s,-1):this.matchTNodeWithReadOption(i,s,Ca(s,i,u,!1,!1))}matchTNodeWithReadOption(i,s,u){if(null!==u){const g=this.metadata.read;if(null!==g)if(g===mc||g===B_||g===sg&&4&s.type)this.addMatch(s.index,-2);else{const x=Ca(s,i,g,!1,!1);null!==x&&this.addMatch(s.index,x)}else this.addMatch(s.index,u)}}addMatch(i,s){null===this.matches?this.matches=[i,s]:this.matches.push(i,s)}}function _I(t,i){const s=t.localNames;if(null!==s)for(let u=0;u<s.length;u+=2)if(s[u]===i)return s[u+1];return null}function vI(t,i,s,u){return-1===s?function yI(t,i){return 11&t.type?_d(t,i):4&t.type?ty(t,i):null}(i,t):-2===s?function xI(t,i,s){return s===mc?_d(i,t):s===sg?ty(i,t):s===B_?Gx(i,t):void 0}(t,i,u):Ys(t,t[ai],s,i)}function Qb(t,i,s,u){const g=i[is].queries[u];if(null===g.matches){const x=t.data,T=s.matches,A=[];for(let k=0;k<T.length;k+=2){const te=T[k];A.push(te<0?null:vI(i,x[te],T[k+1],s.metadata.read))}g.matches=A}return g.matches}function x0(t,i,s,u){const g=t.queries.getByIndex(s),x=g.matches;if(null!==x){const T=Qb(t,i,g,s);for(let A=0;A<x.length;A+=2){const k=x[A];if(k>0)u.push(T[A/2]);else{const te=x[A+1],ve=i[-k];for(let Ke=mo;Ke<ve.length;Ke++){const kt=ve[Ke];kt[Ja]===kt[Jr]&&x0(kt[ai],kt,te,u)}if(null!==ve[aa]){const Ke=ve[aa];for(let kt=0;kt<Ke.length;kt++){const Zt=Ke[kt];x0(Zt[ai],Zt,te,u)}}}}}return u}function ew(t){const i=Nn(),s=Cr(),u=d();n(u+1);const g=sw(s,u);if(t.dirty&&function Xc(t){return 4==(4&t[Ni])}(i)===(2==(2&g.metadata.flags))){if(null===g.matches)t.reset([]);else{const x=g.crossesNgTemplate?x0(s,i,u,[]):Qb(s,i,g,u);t.reset(x,Uc),t.notifyOnChanges()}return!0}return!1}function tw(t,i,s){const u=Cr();u.firstCreatePass&&(ow(u,new Xb(t,i,s),-1),2==(2&i)&&(u.staticViewQueries=!0)),rw(u,Nn(),i)}function nw(t,i,s,u){const g=Cr();if(g.firstCreatePass){const x=Er();ow(g,new Xb(i,s,u),x.index),function wI(t,i){const s=t.contentQueries||(t.contentQueries=[]);i!==(s.length?s[s.length-1]:-1)&&s.push(t.queries.length-1,i)}(g,t),2==(2&s)&&(g.staticContentQueries=!0)}rw(g,Nn(),s)}function iw(){return function bI(t,i){return t[is].queries[i].queryList}(Nn(),d())}function rw(t,i,s){const u=new m0(4==(4&s));(function Am(t,i,s,u){const g=D(i);g.push(s),t.firstCreatePass&&L(t).push(u,g.length-1)})(t,i,u,u.destroy),null===i[is]&&(i[is]=new _0),i[is].queries.push(new g0(u))}function ow(t,i,s){null===t.queries&&(t.queries=new y0),t.queries.track(new v0(i,s))}function sw(t,i){return t.queries.getByIndex(i)}const ww=new mt("Application Initializer");let T0=(()=>{class t{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((s,u)=>{this.resolve=s,this.reject=u}),this.appInits=_r(ww,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const s=[];for(const g of this.appInits){const x=g();if(Qv(x))s.push(x);else if(K1(x)){const T=new Promise((A,k)=>{x.subscribe({complete:A,error:k})});s.push(T)}}const u=()=>{this.done=!0,this.resolve()};Promise.all(s).then(()=>{u()}).catch(g=>{this.reject(g)}),0===s.length&&u(),this.initialized=!0}static#e=this.\u0275fac=function(u){return new(u||t)};static#t=this.\u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Cw=(()=>{class t{log(s){console.log(s)}warn(s){console.warn(s)}static#e=this.\u0275fac=function(u){return new(u||t)};static#t=this.\u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();const iy=new mt("LocaleId",{providedIn:"root",factory:()=>_r(iy,Lt.Optional|Lt.SkipSelf)||function GI(){return typeof $localize<"u"&&$localize.locale||op}()}),HI=new mt("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});let Tw=(()=>{class t{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Nt.X(!1)}add(){this.hasPendingTasks.next(!0);const s=this.taskId++;return this.pendingTasks.add(s),s}remove(s){this.pendingTasks.delete(s),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(u){return new(u||t)};static#t=this.\u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();class KI{constructor(i,s){this.ngModuleFactory=i,this.componentFactories=s}}let XI=(()=>{class t{compileModuleSync(s){return new f0(s)}compileModuleAsync(s){return Promise.resolve(this.compileModuleSync(s))}compileModuleAndAllComponentsSync(s){const u=this.compileModuleSync(s),x=Qs(ue(s).declarations).reduce((T,A)=>{const k=_i(A);return k&&T.push(new dh(k)),T},[]);return new KI(u,x)}compileModuleAndAllComponentsAsync(s){return Promise.resolve(this.compileModuleAndAllComponentsSync(s))}clearCache(){}clearCacheFor(s){}getModuleId(s){}static#e=this.\u0275fac=function(u){return new(u||t)};static#t=this.\u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const Sw=new mt(""),Pw=new mt("");let I0,CM=(()=>{class t{constructor(s,u,g){this._ngZone=s,this.registry=u,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,I0||(function EM(t){I0=t}(g),g.addToWindow(u)),this._watchAngularEvents(),s.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{xr.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let s=this._callbacks.pop();clearTimeout(s.timeoutId),s.doneCb(this._didWork)}this._didWork=!1});else{let s=this.getPendingTasks();this._callbacks=this._callbacks.filter(u=>!u.updateCb||!u.updateCb(s)||(clearTimeout(u.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(s=>({source:s.source,creationLocation:s.creationLocation,data:s.data})):[]}addCallback(s,u,g){let x=-1;u&&u>0&&(x=setTimeout(()=>{this._callbacks=this._callbacks.filter(T=>T.timeoutId!==x),s(this._didWork,this.getPendingTasks())},u)),this._callbacks.push({doneCb:s,timeoutId:x,updateCb:g})}whenStable(s,u,g){if(g&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(s,u,g),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(s){this.registry.registerApplication(s,this)}unregisterApplication(s){this.registry.unregisterApplication(s)}findProviders(s,u,g){return[]}static#e=this.\u0275fac=function(u){return new(u||t)(cr(xr),cr(Ow),cr(Pw))};static#t=this.\u0275prov=Qt({token:t,factory:t.\u0275fac})}return t})(),Ow=(()=>{class t{constructor(){this._applications=new Map}registerApplication(s,u){this._applications.set(s,u)}unregisterApplication(s){this._applications.delete(s)}unregisterAllApplications(){this._applications.clear()}getTestability(s){return this._applications.get(s)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(s,u=!0){return I0?.findTestabilityInTree(this,s,u)??null}static#e=this.\u0275fac=function(u){return new(u||t)};static#t=this.\u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})(),Ed=null;const Rw=new mt("AllowMultipleToken"),M0=new mt("PlatformDestroyListeners"),A0=new mt("appBootstrapListener");function Fw(t,i,s=[]){const u=`Platform: ${i}`,g=new mt(u);return(x=[])=>{let T=S0();if(!T||T.injector.get(Rw,!1)){const A=[...s,...x,{provide:g,useValue:!0}];t?t(A):function IM(t){if(Ed&&!Ed.get(Rw,!1))throw new se(400,!1);(function Lw(){!function xn(t){Ht=t}(()=>{throw new se(600,!1)})})(),Ed=t;const i=t.get(Bw);(function kw(t){t.get(Mp,null)?.forEach(s=>s())})(t)}(function Nw(t=[],i){return al.create({name:i,providers:[{provide:fc,useValue:"platform"},{provide:M0,useValue:new Set([()=>Ed=null])},...t]})}(A,u))}return function AM(t){const i=S0();if(!i)throw new se(401,!1);return i}()}}function S0(){return Ed?.get(Bw)??null}let Bw=(()=>{class t{constructor(s){this._injector=s,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(s,u){const g=function SM(t="zone.js",i){return"noop"===t?new as:"zone.js"===t?new xr(i):t}(u?.ngZone,function zw(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}({eventCoalescing:u?.ngZoneEventCoalescing,runCoalescing:u?.ngZoneRunCoalescing}));return g.run(()=>{const x=function VD(t,i,s){return new h0(t,i,s)}(s.moduleType,this.injector,function Zw(t){return[{provide:xr,useFactory:t},{provide:fu,multi:!0,useFactory:()=>{const i=_r(OM,{optional:!0});return()=>i.initialize()}},{provide:$w,useFactory:PM},{provide:Jo,useFactory:Rs}]}(()=>g)),T=x.injector.get($c,null);return g.runOutsideAngular(()=>{const A=g.onError.subscribe({next:k=>{T.handleError(k)}});x.onDestroy(()=>{oy(this._modules,x),A.unsubscribe()})}),function Uw(t,i,s){try{const u=s();return Qv(u)?u.catch(g=>{throw i.runOutsideAngular(()=>t.handleError(g)),g}):u}catch(u){throw i.runOutsideAngular(()=>t.handleError(u)),u}}(T,g,()=>{const A=x.injector.get(T0);return A.runInitializers(),A.donePromise.then(()=>(function I1(t){qi(t,"Expected localeId to be defined"),"string"==typeof t&&(D1=t.toLowerCase().replace(/_/g,"-"))}(x.injector.get(iy,op)||op),this._moduleDoBootstrap(x),x))})})}bootstrapModule(s,u=[]){const g=jw({},u);return function TM(t,i,s){const u=new f0(s);return Promise.resolve(u)}(0,0,s).then(x=>this.bootstrapModuleFactory(x,g))}_moduleDoBootstrap(s){const u=s.injector.get(lp);if(s._bootstrapComponents.length>0)s._bootstrapComponents.forEach(g=>u.bootstrap(g));else{if(!s.instance.ngDoBootstrap)throw new se(-403,!1);s.instance.ngDoBootstrap(u)}this._modules.push(s)}onDestroy(s){this._destroyListeners.push(s)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new se(404,!1);this._modules.slice().forEach(u=>u.destroy()),this._destroyListeners.forEach(u=>u());const s=this._injector.get(M0,null);s&&(s.forEach(u=>u()),s.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(u){return new(u||t)(cr(al))};static#t=this.\u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();function jw(t,i){return Array.isArray(i)?i.reduce(jw,t):{...t,...i}}let lp=(()=>{class t{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=_r($w),this.zoneIsStable=_r(Jo),this.componentTypes=[],this.components=[],this.isStable=_r(Tw).hasPendingTasks.pipe((0,oi.w)(s=>s?(0,Xt.of)(!1):this.zoneIsStable),(0,xi.x)(),(0,Tn.B)()),this._injector=_r(Fa)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(s,u){const g=s instanceof Iu;if(!this._injector.get(T0).done)throw!g&&le(s),new se(405,!1);let T;T=g?s:this._injector.get(yf).resolveComponentFactory(s),this.componentTypes.push(T.componentType);const A=function DM(t){return t.isBoundToModule}(T)?void 0:this._injector.get(_h),te=T.create(al.NULL,[],u||T.selector,A),ve=te.location.nativeElement,Ke=te.injector.get(Sw,null);return Ke?.registerApplication(ve),te.onDestroy(()=>{this.detachView(te.hostView),oy(this.components,te),Ke?.unregisterApplication(ve)}),this._loadComponent(te),te}tick(){if(this._runningTick)throw new se(101,!1);try{this._runningTick=!0;for(let s of this._views)s.detectChanges()}catch(s){this.internalErrorHandler(s)}finally{this._runningTick=!1}}attachView(s){const u=s;this._views.push(u),u.attachToAppRef(this)}detachView(s){const u=s;oy(this._views,u),u.detachFromAppRef()}_loadComponent(s){this.attachView(s.hostView),this.tick(),this.components.push(s);const u=this._injector.get(A0,[]);[...this._bootstrapListeners,...u].forEach(g=>g(s))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(s=>s()),this._views.slice().forEach(s=>s.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(s){return this._destroyListeners.push(s),()=>oy(this._destroyListeners,s)}destroy(){if(this._destroyed)throw new se(406,!1);const s=this._injector;s.destroy&&!s.destroyed&&s.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(u){return new(u||t)};static#t=this.\u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function oy(t,i){const s=t.indexOf(i);s>-1&&t.splice(s,1)}const $w=new mt("",{providedIn:"root",factory:()=>_r($c).handleError.bind(void 0)});function PM(){const t=_r(xr),i=_r($c);return s=>t.runOutsideAngular(()=>i.handleError(s))}let OM=(()=>{class t{constructor(){this.zone=_r(xr),this.applicationRef=_r(lp)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(u){return new(u||t)};static#t=this.\u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function kM(){}const UM=Fw(null,"core",[]);let jM=(()=>{class t{constructor(s){}static#e=this.\u0275fac=function(u){return new(u||t)(cr(lp))};static#t=this.\u0275mod=qa({type:t});static#n=this.\u0275inj=It({})}return t})();function lA(t){return"boolean"==typeof t?t:null!=t&&"false"!==t}function uA(t,i){const s=_i(t),u=i.elementInjector||Sh();return new dh(s).create(u,i.projectableNodes,i.hostElement,i.environmentInjector)}function dA(t){const i=_i(t);if(!i)return null;const s=new dh(i);return{get selector(){return s.selector},get type(){return s.componentType},get inputs(){return s.inputs},get outputs(){return s.outputs},get ngContentSelectors(){return s.ngContentSelectors},get isStandalone(){return i.standalone},get isSignal(){return i.signals}}}},6223:(zn,wt,S)=>{"use strict";S.d(wt,{Cf:()=>Ce,Fd:()=>ws,Fj:()=>De,JJ:()=>Vn,JU:()=>oe,On:()=>jt,a5:()=>Ie,qQ:()=>Us,u5:()=>Br,wV:()=>Un});var h=S(8564),p=S(6814),X=S(7715),a=S(9315),j=S(7398);let K=(()=>{class le{constructor(W,He){this._renderer=W,this._elementRef=He,this.onChange=zt=>{},this.onTouched=()=>{}}setProperty(W,He){this._renderer.setProperty(this._elementRef.nativeElement,W,He)}registerOnTouched(W){this.onTouched=W}registerOnChange(W){this.onChange=W}setDisabledState(W){this.setProperty("disabled",W)}static#e=this.\u0275fac=function(He){return new(He||le)(h.Y36(h.Qsj),h.Y36(h.SBq))};static#t=this.\u0275dir=h.lG2({type:le})}return le})(),C=(()=>{class le extends K{static#e=this.\u0275fac=(()=>{let W;return function(zt){return(W||(W=h.n5z(le)))(zt||le)}})();static#t=this.\u0275dir=h.lG2({type:le,features:[h.qOj]})}return le})();const oe=new h.OlP("NgValueAccessor"),ee={provide:oe,useExisting:(0,h.Gpc)(()=>De),multi:!0},ye=new h.OlP("CompositionEventMode");let De=(()=>{class le extends K{constructor(W,He,zt){super(W,He),this._compositionMode=zt,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Te(){const le=(0,p.q)()?(0,p.q)().getUserAgent():"";return/android (\d+)/.test(le.toLowerCase())}())}writeValue(W){this.setProperty("value",W??"")}_handleInput(W){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(W)}_compositionStart(){this._composing=!0}_compositionEnd(W){this._composing=!1,this._compositionMode&&this.onChange(W)}static#e=this.\u0275fac=function(He){return new(He||le)(h.Y36(h.Qsj),h.Y36(h.SBq),h.Y36(ye,8))};static#t=this.\u0275dir=h.lG2({type:le,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(He,zt){1&He&&h.NdJ("input",function(dr){return zt._handleInput(dr.target.value)})("blur",function(){return zt.onTouched()})("compositionstart",function(){return zt._compositionStart()})("compositionend",function(dr){return zt._compositionEnd(dr.target.value)})},features:[h._Bn([ee]),h.qOj]})}return le})();function me(le){return null==le||("string"==typeof le||Array.isArray(le))&&0===le.length}const Ce=new h.OlP("NgValidators"),de=new h.OlP("NgAsyncValidators");function Se(le){return null}function Ve(le){return null!=le}function Xe(le){return(0,h.QGY)(le)?(0,X.D)(le):le}function Ht(le){let ue={};return le.forEach(W=>{ue=null!=W?{...ue,...W}:ue}),0===Object.keys(ue).length?null:ue}function cn(le,ue){return ue.map(W=>W(le))}function $t(le){return le.map(ue=>function xn(le){return!le.validate}(ue)?ue:W=>ue.validate(W))}function pe(le){return null!=le?function ke(le){if(!le)return null;const ue=le.filter(Ve);return 0==ue.length?null:function(W){return Ht(cn(W,ue))}}($t(le)):null}function ie(le){return null!=le?function Oe(le){if(!le)return null;const ue=le.filter(Ve);return 0==ue.length?null:function(W){const He=cn(W,ue).map(Xe);return(0,a.D)(He).pipe((0,j.U)(Ht))}}($t(le)):null}function it(le,ue){return null===le?[ue]:Array.isArray(le)?[...le,ue]:[le,ue]}function Mn(le){return le?Array.isArray(le)?le:[le]:[]}function fn(le,ue){return Array.isArray(le)?le.includes(ue):le===ue}function qn(le,ue){const W=Mn(ue);return Mn(le).forEach(zt=>{fn(W,zt)||W.push(zt)}),W}function li(le,ue){return Mn(ue).filter(W=>!fn(le,W))}class en{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(ue){this._rawValidators=ue||[],this._composedValidatorFn=pe(this._rawValidators)}_setAsyncValidators(ue){this._rawAsyncValidators=ue||[],this._composedAsyncValidatorFn=ie(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(ue){this._onDestroyCallbacks.push(ue)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(ue=>ue()),this._onDestroyCallbacks=[]}reset(ue=void 0){this.control&&this.control.reset(ue)}hasError(ue,W){return!!this.control&&this.control.hasError(ue,W)}getError(ue,W){return this.control?this.control.getError(ue,W):null}}class Dt extends en{get formDirective(){return null}get path(){return null}}class Ie extends en{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Ct{constructor(ue){this._cd=ue}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Vn=(()=>{class le extends Ct{constructor(W){super(W)}static#e=this.\u0275fac=function(He){return new(He||le)(h.Y36(Ie,2))};static#t=this.\u0275dir=h.lG2({type:le,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(He,zt){2&He&&h.ekj("ng-untouched",zt.isUntouched)("ng-touched",zt.isTouched)("ng-pristine",zt.isPristine)("ng-dirty",zt.isDirty)("ng-valid",zt.isValid)("ng-invalid",zt.isInvalid)("ng-pending",zt.isPending)},features:[h.qOj]})}return le})();const ct="VALID",ge="INVALID",se="PENDING",tt="DISABLED";function Et(le){return null!=le&&!Array.isArray(le)&&"object"==typeof le}class mn{constructor(ue,W){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(ue),this._assignAsyncValidators(W)}get validator(){return this._composedValidatorFn}set validator(ue){this._rawValidators=this._composedValidatorFn=ue}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(ue){this._rawAsyncValidators=this._composedAsyncValidatorFn=ue}get parent(){return this._parent}get valid(){return this.status===ct}get invalid(){return this.status===ge}get pending(){return this.status==se}get disabled(){return this.status===tt}get enabled(){return this.status!==tt}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(ue){this._assignValidators(ue)}setAsyncValidators(ue){this._assignAsyncValidators(ue)}addValidators(ue){this.setValidators(qn(ue,this._rawValidators))}addAsyncValidators(ue){this.setAsyncValidators(qn(ue,this._rawAsyncValidators))}removeValidators(ue){this.setValidators(li(ue,this._rawValidators))}removeAsyncValidators(ue){this.setAsyncValidators(li(ue,this._rawAsyncValidators))}hasValidator(ue){return fn(this._rawValidators,ue)}hasAsyncValidator(ue){return fn(this._rawAsyncValidators,ue)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(ue={}){this.touched=!0,this._parent&&!ue.onlySelf&&this._parent.markAsTouched(ue)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(ue=>ue.markAllAsTouched())}markAsUntouched(ue={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(W=>{W.markAsUntouched({onlySelf:!0})}),this._parent&&!ue.onlySelf&&this._parent._updateTouched(ue)}markAsDirty(ue={}){this.pristine=!1,this._parent&&!ue.onlySelf&&this._parent.markAsDirty(ue)}markAsPristine(ue={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(W=>{W.markAsPristine({onlySelf:!0})}),this._parent&&!ue.onlySelf&&this._parent._updatePristine(ue)}markAsPending(ue={}){this.status=se,!1!==ue.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!ue.onlySelf&&this._parent.markAsPending(ue)}disable(ue={}){const W=this._parentMarkedDirty(ue.onlySelf);this.status=tt,this.errors=null,this._forEachChild(He=>{He.disable({...ue,onlySelf:!0})}),this._updateValue(),!1!==ue.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...ue,skipPristineCheck:W}),this._onDisabledChange.forEach(He=>He(!0))}enable(ue={}){const W=this._parentMarkedDirty(ue.onlySelf);this.status=ct,this._forEachChild(He=>{He.enable({...ue,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:ue.emitEvent}),this._updateAncestors({...ue,skipPristineCheck:W}),this._onDisabledChange.forEach(He=>He(!1))}_updateAncestors(ue){this._parent&&!ue.onlySelf&&(this._parent.updateValueAndValidity(ue),ue.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(ue){this._parent=ue}getRawValue(){return this.value}updateValueAndValidity(ue={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ct||this.status===se)&&this._runAsyncValidator(ue.emitEvent)),!1!==ue.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!ue.onlySelf&&this._parent.updateValueAndValidity(ue)}_updateTreeValidity(ue={emitEvent:!0}){this._forEachChild(W=>W._updateTreeValidity(ue)),this.updateValueAndValidity({onlySelf:!0,emitEvent:ue.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?tt:ct}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(ue){if(this.asyncValidator){this.status=se,this._hasOwnPendingAsyncValidator=!0;const W=Xe(this.asyncValidator(this));this._asyncValidationSubscription=W.subscribe(He=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(He,{emitEvent:ue})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(ue,W={}){this.errors=ue,this._updateControlsErrors(!1!==W.emitEvent)}get(ue){let W=ue;return null==W||(Array.isArray(W)||(W=W.split(".")),0===W.length)?null:W.reduce((He,zt)=>He&&He._find(zt),this)}getError(ue,W){const He=W?this.get(W):this;return He&&He.errors?He.errors[ue]:null}hasError(ue,W){return!!this.getError(ue,W)}get root(){let ue=this;for(;ue._parent;)ue=ue._parent;return ue}_updateControlsErrors(ue){this.status=this._calculateStatus(),ue&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(ue)}_initObservables(){this.valueChanges=new h.vpe,this.statusChanges=new h.vpe}_calculateStatus(){return this._allControlsDisabled()?tt:this.errors?ge:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(se)?se:this._anyControlsHaveStatus(ge)?ge:ct}_anyControlsHaveStatus(ue){return this._anyControls(W=>W.status===ue)}_anyControlsDirty(){return this._anyControls(ue=>ue.dirty)}_anyControlsTouched(){return this._anyControls(ue=>ue.touched)}_updatePristine(ue={}){this.pristine=!this._anyControlsDirty(),this._parent&&!ue.onlySelf&&this._parent._updatePristine(ue)}_updateTouched(ue={}){this.touched=this._anyControlsTouched(),this._parent&&!ue.onlySelf&&this._parent._updateTouched(ue)}_registerOnCollectionChange(ue){this._onCollectionChange=ue}_setUpdateStrategy(ue){Et(ue)&&null!=ue.updateOn&&(this._updateOn=ue.updateOn)}_parentMarkedDirty(ue){return!ue&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(ue){return null}_assignValidators(ue){this._rawValidators=Array.isArray(ue)?ue.slice():ue,this._composedValidatorFn=function Ot(le){return Array.isArray(le)?pe(le):le||null}(this._rawValidators)}_assignAsyncValidators(ue){this._rawAsyncValidators=Array.isArray(ue)?ue.slice():ue,this._composedAsyncValidatorFn=function Vt(le){return Array.isArray(le)?ie(le):le||null}(this._rawAsyncValidators)}}const Dn=new h.OlP("CallSetDisabledState",{providedIn:"root",factory:()=>gi}),gi="always";function Li(le,ue,W=gi){(function ho(le,ue){const W=function _t(le){return le._rawValidators}(le);null!==ue.validator?le.setValidators(it(W,ue.validator)):"function"==typeof W&&le.setValidators([W]);const He=function Kt(le){return le._rawAsyncValidators}(le);null!==ue.asyncValidator?le.setAsyncValidators(it(He,ue.asyncValidator)):"function"==typeof He&&le.setAsyncValidators([He]);const zt=()=>le.updateValueAndValidity();Ui(ue._rawValidators,zt),Ui(ue._rawAsyncValidators,zt)})(le,ue),ue.valueAccessor.writeValue(le.value),(le.disabled||"always"===W)&&ue.valueAccessor.setDisabledState?.(le.disabled),function Io(le,ue){ue.valueAccessor.registerOnChange(W=>{le._pendingValue=W,le._pendingChange=!0,le._pendingDirty=!0,"change"===le.updateOn&&ao(le,ue)})}(le,ue),function Ro(le,ue){const W=(He,zt)=>{ue.valueAccessor.writeValue(He),zt&&ue.viewToModelUpdate(He)};le.registerOnChange(W),ue._registerOnDestroy(()=>{le._unregisterOnChange(W)})}(le,ue),function Zi(le,ue){ue.valueAccessor.registerOnTouched(()=>{le._pendingTouched=!0,"blur"===le.updateOn&&le._pendingChange&&ao(le,ue),"submit"!==le.updateOn&&le.markAsTouched()})}(le,ue),function Fr(le,ue){if(ue.valueAccessor.setDisabledState){const W=He=>{ue.valueAccessor.setDisabledState(He)};le.registerOnDisabledChange(W),ue._registerOnDestroy(()=>{le._unregisterOnDisabledChange(W)})}}(le,ue)}function Ui(le,ue){le.forEach(W=>{W.registerOnValidatorChange&&W.registerOnValidatorChange(ue)})}function ao(le,ue){le._pendingDirty&&le.markAsDirty(),le.setValue(le._pendingValue,{emitModelToViewChange:!1}),ue.viewToModelUpdate(le._pendingValue),le._pendingChange=!1}function we(le,ue){const W=le.indexOf(ue);W>-1&&le.splice(W,1)}function ut(le){return"object"==typeof le&&null!==le&&2===Object.keys(le).length&&"value"in le&&"disabled"in le}const dt=class extends mn{constructor(ue=null,W,He){super(function yt(le){return(Et(le)?le.validators:le)||null}(W),function Gt(le,ue){return(Et(ue)?ue.asyncValidators:le)||null}(He,W)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(ue),this._setUpdateStrategy(W),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Et(W)&&(W.nonNullable||W.initialValueIsDefault)&&(this.defaultValue=ut(ue)?ue.value:ue)}setValue(ue,W={}){this.value=this._pendingValue=ue,this._onChange.length&&!1!==W.emitModelToViewChange&&this._onChange.forEach(He=>He(this.value,!1!==W.emitViewToModelChange)),this.updateValueAndValidity(W)}patchValue(ue,W={}){this.setValue(ue,W)}reset(ue=this.defaultValue,W={}){this._applyFormState(ue),this.markAsPristine(W),this.markAsUntouched(W),this.setValue(this.value,W),this._pendingChange=!1}_updateValue(){}_anyControls(ue){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(ue){this._onChange.push(ue)}_unregisterOnChange(ue){we(this._onChange,ue)}registerOnDisabledChange(ue){this._onDisabledChange.push(ue)}_unregisterOnDisabledChange(ue){we(this._onDisabledChange,ue)}_forEachChild(ue){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(ue){ut(ue)?(this.value=this._pendingValue=ue.value,ue.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=ue}},mt={provide:Ie,useExisting:(0,h.Gpc)(()=>jt)},yn=(()=>Promise.resolve())();let jt=(()=>{class le extends Ie{constructor(W,He,zt,vi,dr,wr){super(),this._changeDetectorRef=dr,this.callSetDisabledState=wr,this.control=new dt,this._registered=!1,this.name="",this.update=new h.vpe,this._parent=W,this._setValidators(He),this._setAsyncValidators(zt),this.valueAccessor=function Xn(le,ue){if(!ue)return null;let W,He,zt;return Array.isArray(ue),ue.forEach(vi=>{vi.constructor===De?W=vi:function wn(le){return Object.getPrototypeOf(le.constructor)===C}(vi)?He=vi:zt=vi}),zt||He||W||null}(0,vi)}ngOnChanges(W){if(this._checkForErrors(),!this._registered||"name"in W){if(this._registered&&(this._checkName(),this.formDirective)){const He=W.name.previousValue;this.formDirective.removeControl({name:He,path:this._getPath(He)})}this._setUpControl()}"isDisabled"in W&&this._updateDisabled(W),function Qt(le,ue){if(!le.hasOwnProperty("model"))return!1;const W=le.model;return!!W.isFirstChange()||!Object.is(ue,W.currentValue)}(W,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(W){this.viewModel=W,this.update.emit(W)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Li(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(W){yn.then(()=>{this.control.setValue(W,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(W){const He=W.isDisabled.currentValue,zt=0!==He&&(0,h.VuI)(He);yn.then(()=>{zt&&!this.control.disabled?this.control.disable():!zt&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(W){return this._parent?function Mi(le,ue){return[...ue.path,le]}(W,this._parent):[W]}static#e=this.\u0275fac=function(He){return new(He||le)(h.Y36(Dt,9),h.Y36(Ce,10),h.Y36(de,10),h.Y36(oe,10),h.Y36(h.sBO,8),h.Y36(Dn,8))};static#t=this.\u0275dir=h.lG2({type:le,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[h._Bn([mt]),h.qOj,h.TTD]})}return le})();const $n={provide:oe,useExisting:(0,h.Gpc)(()=>Un),multi:!0};let Un=(()=>{class le extends C{writeValue(W){this.setProperty("value",W??"")}registerOnChange(W){this.onChange=He=>{W(""==He?null:parseFloat(He))}}static#e=this.\u0275fac=(()=>{let W;return function(zt){return(W||(W=h.n5z(le)))(zt||le)}})();static#t=this.\u0275dir=h.lG2({type:le,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(He,zt){1&He&&h.NdJ("input",function(dr){return zt.onChange(dr.target.value)})("blur",function(){return zt.onTouched()})},features:[h._Bn([$n]),h.qOj]})}return le})(),Ri=(()=>{class le{static#e=this.\u0275fac=function(He){return new(He||le)};static#t=this.\u0275mod=h.oAB({type:le});static#n=this.\u0275inj=h.cJS({})}return le})();function Lo(le){return"number"==typeof le?le:parseFloat(le)}let ns=(()=>{class le{constructor(){this._validator=Se}ngOnChanges(W){if(this.inputName in W){const He=this.normalizeInput(W[this.inputName].currentValue);this._enabled=this.enabled(He),this._validator=this._enabled?this.createValidator(He):Se,this._onChange&&this._onChange()}}validate(W){return this._validator(W)}registerOnValidatorChange(W){this._onChange=W}enabled(W){return null!=W}static#e=this.\u0275fac=function(He){return new(He||le)};static#t=this.\u0275dir=h.lG2({type:le,features:[h.TTD]})}return le})();const ha={provide:Ce,useExisting:(0,h.Gpc)(()=>ws),multi:!0};let ws=(()=>{class le extends ns{constructor(){super(...arguments),this.inputName="max",this.normalizeInput=W=>Lo(W),this.createValidator=W=>function Ae(le){return ue=>{if(me(ue.value)||me(le))return null;const W=parseFloat(ue.value);return!isNaN(W)&&W>le?{max:{max:le,actual:ue.value}}:null}}(W)}static#e=this.\u0275fac=(()=>{let W;return function(zt){return(W||(W=h.n5z(le)))(zt||le)}})();static#t=this.\u0275dir=h.lG2({type:le,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(He,zt){2&He&&h.uIk("max",zt._enabled?zt.max:null)},inputs:{max:"max"},features:[h._Bn([ha]),h.qOj]})}return le})();const na={provide:Ce,useExisting:(0,h.Gpc)(()=>Us),multi:!0};let Us=(()=>{class le extends ns{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=W=>Lo(W),this.createValidator=W=>function Ne(le){return ue=>{if(me(ue.value)||me(le))return null;const W=parseFloat(ue.value);return!isNaN(W)&&W<le?{min:{min:le,actual:ue.value}}:null}}(W)}static#e=this.\u0275fac=(()=>{let W;return function(zt){return(W||(W=h.n5z(le)))(zt||le)}})();static#t=this.\u0275dir=h.lG2({type:le,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(He,zt){2&He&&h.uIk("min",zt._enabled?zt.min:null)},inputs:{min:"min"},features:[h._Bn([na]),h.qOj]})}return le})(),ia=(()=>{class le{static#e=this.\u0275fac=function(He){return new(He||le)};static#t=this.\u0275mod=h.oAB({type:le});static#n=this.\u0275inj=h.cJS({imports:[Ri]})}return le})(),Br=(()=>{class le{static withConfig(W){return{ngModule:le,providers:[{provide:Dn,useValue:W.callSetDisabledState??gi}]}}static#e=this.\u0275fac=function(He){return new(He||le)};static#t=this.\u0275mod=h.oAB({type:le});static#n=this.\u0275inj=h.cJS({imports:[ia]})}return le})()},6593:(zn,wt,S)=>{"use strict";S.d(wt,{Dx:()=>qe,b2:()=>on,q6:()=>en});var h=S(8564),p=S(6814);class X extends p.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class a extends X{static makeCurrent(){(0,p.HT)(new a)}onAndCancel(ht,G,ze){return ht.addEventListener(G,ze),()=>{ht.removeEventListener(G,ze)}}dispatchEvent(ht,G){ht.dispatchEvent(G)}remove(ht){ht.parentNode&&ht.parentNode.removeChild(ht)}createElement(ht,G){return(G=G||this.getDefaultDocument()).createElement(ht)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(ht){return ht.nodeType===Node.ELEMENT_NODE}isShadowRoot(ht){return ht instanceof DocumentFragment}getGlobalEventTarget(ht,G){return"window"===G?window:"document"===G?ht:"body"===G?ht.body:null}getBaseHref(ht){const G=function K(){return j=j||document.querySelector("base"),j?j.getAttribute("href"):null}();return null==G?null:function oe(ae){C=C||document.createElement("a"),C.setAttribute("href",ae);const ht=C.pathname;return"/"===ht.charAt(0)?ht:`/${ht}`}(G)}resetBaseElement(){j=null}getUserAgent(){return window.navigator.userAgent}getCookie(ht){return(0,p.Mx)(document.cookie,ht)}}let C,j=null,Le=(()=>{class ae{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(ze){return new(ze||ae)};static#t=this.\u0275prov=h.Yz7({token:ae,factory:ae.\u0275fac})}return ae})();const ee=new h.OlP("EventManagerPlugins");let Te=(()=>{class ae{constructor(G,ze){this._zone=ze,this._eventNameToPlugin=new Map,G.forEach(at=>{at.manager=this}),this._plugins=G.slice().reverse()}addEventListener(G,ze,at){return this._findPluginFor(ze).addEventListener(G,ze,at)}getZone(){return this._zone}_findPluginFor(G){let ze=this._eventNameToPlugin.get(G);if(ze)return ze;if(ze=this._plugins.find(rn=>rn.supports(G)),!ze)throw new h.vHH(5101,!1);return this._eventNameToPlugin.set(G,ze),ze}static#e=this.\u0275fac=function(ze){return new(ze||ae)(h.LFG(ee),h.LFG(h.R0b))};static#t=this.\u0275prov=h.Yz7({token:ae,factory:ae.\u0275fac})}return ae})();class ye{constructor(ht){this._doc=ht}}const De="ng-app-id";let me=(()=>{class ae{constructor(G,ze,at,rn={}){this.doc=G,this.appId=ze,this.nonce=at,this.platformId=rn,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=(0,p.PM)(rn),this.resetHostNodes()}addStyles(G){for(const ze of G)1===this.changeUsageCount(ze,1)&&this.onStyleAdded(ze)}removeStyles(G){for(const ze of G)this.changeUsageCount(ze,-1)<=0&&this.onStyleRemoved(ze)}ngOnDestroy(){const G=this.styleNodesInDOM;G&&(G.forEach(ze=>ze.remove()),G.clear());for(const ze of this.getAllStyles())this.onStyleRemoved(ze);this.resetHostNodes()}addHost(G){this.hostNodes.add(G);for(const ze of this.getAllStyles())this.addStyleToHost(G,ze)}removeHost(G){this.hostNodes.delete(G)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(G){for(const ze of this.hostNodes)this.addStyleToHost(ze,G)}onStyleRemoved(G){const ze=this.styleRef;ze.get(G)?.elements?.forEach(at=>at.remove()),ze.delete(G)}collectServerRenderedStyles(){const G=this.doc.head?.querySelectorAll(`style[${De}="${this.appId}"]`);if(G?.length){const ze=new Map;return G.forEach(at=>{null!=at.textContent&&ze.set(at.textContent,at)}),ze}return null}changeUsageCount(G,ze){const at=this.styleRef;if(at.has(G)){const rn=at.get(G);return rn.usage+=ze,rn.usage}return at.set(G,{usage:ze,elements:[]}),ze}getStyleElement(G,ze){const at=this.styleNodesInDOM,rn=at?.get(ze);if(rn?.parentNode===G)return at.delete(ze),rn.removeAttribute(De),rn;{const Dn=this.doc.createElement("style");return this.nonce&&Dn.setAttribute("nonce",this.nonce),Dn.textContent=ze,this.platformIsServer&&Dn.setAttribute(De,this.appId),G.appendChild(Dn),Dn}}addStyleToHost(G,ze){const at=this.getStyleElement(G,ze),rn=this.styleRef,Dn=rn.get(ze)?.elements;Dn?Dn.push(at):rn.set(ze,{elements:[at],usage:1})}resetHostNodes(){const G=this.hostNodes;G.clear(),G.add(this.doc.head)}static#e=this.\u0275fac=function(ze){return new(ze||ae)(h.LFG(p.K0),h.LFG(h.AFp),h.LFG(h.Ojb,8),h.LFG(h.Lbi))};static#t=this.\u0275prov=h.Yz7({token:ae,factory:ae.\u0275fac})}return ae})();const Ye={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Ce=/%COMP%/g,Ae=new h.OlP("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!0});function ne(ae,ht){return ht.map(G=>G.replace(Ce,ae))}let Ee=(()=>{class ae{constructor(G,ze,at,rn,Dn,gi,Mi,Li=null){this.eventManager=G,this.sharedStylesHost=ze,this.appId=at,this.removeStylesOnCompDestroy=rn,this.doc=Dn,this.platformId=gi,this.ngZone=Mi,this.nonce=Li,this.rendererByCompId=new Map,this.platformIsServer=(0,p.PM)(gi),this.defaultRenderer=new xe(G,Dn,Mi,this.platformIsServer)}createRenderer(G,ze){if(!G||!ze)return this.defaultRenderer;this.platformIsServer&&ze.encapsulation===h.ifc.ShadowDom&&(ze={...ze,encapsulation:h.ifc.Emulated});const at=this.getOrCreateRenderer(G,ze);return at instanceof cn?at.applyToHost(G):at instanceof Ht&&at.applyStyles(),at}getOrCreateRenderer(G,ze){const at=this.rendererByCompId;let rn=at.get(ze.id);if(!rn){const Dn=this.doc,gi=this.ngZone,Mi=this.eventManager,Li=this.sharedStylesHost,yr=this.removeStylesOnCompDestroy,Ui=this.platformIsServer;switch(ze.encapsulation){case h.ifc.Emulated:rn=new cn(Mi,Li,ze,this.appId,yr,Dn,gi,Ui);break;case h.ifc.ShadowDom:return new Xe(Mi,Li,G,ze,Dn,gi,this.nonce,Ui);default:rn=new Ht(Mi,Li,ze,yr,Dn,gi,Ui)}at.set(ze.id,rn)}return rn}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(ze){return new(ze||ae)(h.LFG(Te),h.LFG(me),h.LFG(h.AFp),h.LFG(Ae),h.LFG(p.K0),h.LFG(h.Lbi),h.LFG(h.R0b),h.LFG(h.Ojb))};static#t=this.\u0275prov=h.Yz7({token:ae,factory:ae.\u0275fac})}return ae})();class xe{constructor(ht,G,ze,at){this.eventManager=ht,this.doc=G,this.ngZone=ze,this.platformIsServer=at,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(ht,G){return G?this.doc.createElementNS(Ye[G]||G,ht):this.doc.createElement(ht)}createComment(ht){return this.doc.createComment(ht)}createText(ht){return this.doc.createTextNode(ht)}appendChild(ht,G){(Ve(ht)?ht.content:ht).appendChild(G)}insertBefore(ht,G,ze){ht&&(Ve(ht)?ht.content:ht).insertBefore(G,ze)}removeChild(ht,G){ht&&ht.removeChild(G)}selectRootElement(ht,G){let ze="string"==typeof ht?this.doc.querySelector(ht):ht;if(!ze)throw new h.vHH(-5104,!1);return G||(ze.textContent=""),ze}parentNode(ht){return ht.parentNode}nextSibling(ht){return ht.nextSibling}setAttribute(ht,G,ze,at){if(at){G=at+":"+G;const rn=Ye[at];rn?ht.setAttributeNS(rn,G,ze):ht.setAttribute(G,ze)}else ht.setAttribute(G,ze)}removeAttribute(ht,G,ze){if(ze){const at=Ye[ze];at?ht.removeAttributeNS(at,G):ht.removeAttribute(`${ze}:${G}`)}else ht.removeAttribute(G)}addClass(ht,G){ht.classList.add(G)}removeClass(ht,G){ht.classList.remove(G)}setStyle(ht,G,ze,at){at&(h.JOm.DashCase|h.JOm.Important)?ht.style.setProperty(G,ze,at&h.JOm.Important?"important":""):ht.style[G]=ze}removeStyle(ht,G,ze){ze&h.JOm.DashCase?ht.style.removeProperty(G):ht.style[G]=""}setProperty(ht,G,ze){null!=ht&&(ht[G]=ze)}setValue(ht,G){ht.nodeValue=G}listen(ht,G,ze){if("string"==typeof ht&&!(ht=(0,p.q)().getGlobalEventTarget(this.doc,ht)))throw new Error(`Unsupported event target ${ht} for event ${G}`);return this.eventManager.addEventListener(ht,G,this.decoratePreventDefault(ze))}decoratePreventDefault(ht){return G=>{if("__ngUnwrap__"===G)return ht;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>ht(G)):ht(G))&&G.preventDefault()}}}function Ve(ae){return"TEMPLATE"===ae.tagName&&void 0!==ae.content}class Xe extends xe{constructor(ht,G,ze,at,rn,Dn,gi,Mi){super(ht,rn,Dn,Mi),this.sharedStylesHost=G,this.hostEl=ze,this.shadowRoot=ze.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const Li=ne(at.id,at.styles);for(const yr of Li){const Ui=document.createElement("style");gi&&Ui.setAttribute("nonce",gi),Ui.textContent=yr,this.shadowRoot.appendChild(Ui)}}nodeOrShadowRoot(ht){return ht===this.hostEl?this.shadowRoot:ht}appendChild(ht,G){return super.appendChild(this.nodeOrShadowRoot(ht),G)}insertBefore(ht,G,ze){return super.insertBefore(this.nodeOrShadowRoot(ht),G,ze)}removeChild(ht,G){return super.removeChild(this.nodeOrShadowRoot(ht),G)}parentNode(ht){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(ht)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Ht extends xe{constructor(ht,G,ze,at,rn,Dn,gi,Mi){super(ht,rn,Dn,gi),this.sharedStylesHost=G,this.removeStylesOnCompDestroy=at,this.styles=Mi?ne(Mi,ze.styles):ze.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class cn extends Ht{constructor(ht,G,ze,at,rn,Dn,gi,Mi){const Li=at+"-"+ze.id;super(ht,G,ze,rn,Dn,gi,Mi,Li),this.contentAttr=function Ge(ae){return"_ngcontent-%COMP%".replace(Ce,ae)}(Li),this.hostAttr=function lt(ae){return"_nghost-%COMP%".replace(Ce,ae)}(Li)}applyToHost(ht){this.applyStyles(),this.setAttribute(ht,this.hostAttr,"")}createElement(ht,G){const ze=super.createElement(ht,G);return super.setAttribute(ze,this.contentAttr,""),ze}}let xn=(()=>{class ae extends ye{constructor(G){super(G)}supports(G){return!0}addEventListener(G,ze,at){return G.addEventListener(ze,at,!1),()=>this.removeEventListener(G,ze,at)}removeEventListener(G,ze,at){return G.removeEventListener(ze,at)}static#e=this.\u0275fac=function(ze){return new(ze||ae)(h.LFG(p.K0))};static#t=this.\u0275prov=h.Yz7({token:ae,factory:ae.\u0275fac})}return ae})();const $t=["alt","control","meta","shift"],ke={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},pe={alt:ae=>ae.altKey,control:ae=>ae.ctrlKey,meta:ae=>ae.metaKey,shift:ae=>ae.shiftKey};let Oe=(()=>{class ae extends ye{constructor(G){super(G)}supports(G){return null!=ae.parseEventName(G)}addEventListener(G,ze,at){const rn=ae.parseEventName(ze),Dn=ae.eventCallback(rn.fullKey,at,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,p.q)().onAndCancel(G,rn.domEventName,Dn))}static parseEventName(G){const ze=G.toLowerCase().split("."),at=ze.shift();if(0===ze.length||"keydown"!==at&&"keyup"!==at)return null;const rn=ae._normalizeKey(ze.pop());let Dn="",gi=ze.indexOf("code");if(gi>-1&&(ze.splice(gi,1),Dn="code."),$t.forEach(Li=>{const yr=ze.indexOf(Li);yr>-1&&(ze.splice(yr,1),Dn+=Li+".")}),Dn+=rn,0!=ze.length||0===rn.length)return null;const Mi={};return Mi.domEventName=at,Mi.fullKey=Dn,Mi}static matchEventFullKeyCode(G,ze){let at=ke[G.key]||G.key,rn="";return ze.indexOf("code.")>-1&&(at=G.code,rn="code."),!(null==at||!at)&&(at=at.toLowerCase()," "===at?at="space":"."===at&&(at="dot"),$t.forEach(Dn=>{Dn!==at&&(0,pe[Dn])(G)&&(rn+=Dn+".")}),rn+=at,rn===ze)}static eventCallback(G,ze,at){return rn=>{ae.matchEventFullKeyCode(rn,G)&&at.runGuarded(()=>ze(rn))}}static _normalizeKey(G){return"esc"===G?"escape":G}static#e=this.\u0275fac=function(ze){return new(ze||ae)(h.LFG(p.K0))};static#t=this.\u0275prov=h.Yz7({token:ae,factory:ae.\u0275fac})}return ae})();const en=(0,h.eFA)(h._c5,"browser",[{provide:h.Lbi,useValue:p.bD},{provide:h.g9A,useValue:function Mn(){a.makeCurrent()},multi:!0},{provide:p.K0,useFactory:function qn(){return(0,h.RDi)(document),document},deps:[]}]),Dt=new h.OlP(""),Ie=[{provide:h.rWj,useClass:class _e{addToWindow(ht){h.dqk.getAngularTestability=(ze,at=!0)=>{const rn=ht.findTestabilityInTree(ze,at);if(null==rn)throw new h.vHH(5103,!1);return rn},h.dqk.getAllAngularTestabilities=()=>ht.getAllTestabilities(),h.dqk.getAllAngularRootElements=()=>ht.getAllRootElements(),h.dqk.frameworkStabilizers||(h.dqk.frameworkStabilizers=[]),h.dqk.frameworkStabilizers.push(ze=>{const at=h.dqk.getAllAngularTestabilities();let rn=at.length,Dn=!1;const gi=function(Mi){Dn=Dn||Mi,rn--,0==rn&&ze(Dn)};at.forEach(Mi=>{Mi.whenStable(gi)})})}findTestabilityInTree(ht,G,ze){return null==G?null:ht.getTestability(G)??(ze?(0,p.q)().isShadowRoot(G)?this.findTestabilityInTree(ht,G.host,!0):this.findTestabilityInTree(ht,G.parentElement,!0):null)}},deps:[]},{provide:h.lri,useClass:h.dDg,deps:[h.R0b,h.eoX,h.rWj]},{provide:h.dDg,useClass:h.dDg,deps:[h.R0b,h.eoX,h.rWj]}],Ct=[{provide:h.zSh,useValue:"root"},{provide:h.qLn,useFactory:function fn(){return new h.qLn},deps:[]},{provide:ee,useClass:xn,multi:!0,deps:[p.K0,h.R0b,h.Lbi]},{provide:ee,useClass:Oe,multi:!0,deps:[p.K0]},Ee,me,Te,{provide:h.FYo,useExisting:Ee},{provide:p.JF,useClass:Le,deps:[]},[]];let on=(()=>{class ae{constructor(G){}static withServerTransition(G){return{ngModule:ae,providers:[{provide:h.AFp,useValue:G.appId}]}}static#e=this.\u0275fac=function(ze){return new(ze||ae)(h.LFG(Dt,12))};static#t=this.\u0275mod=h.oAB({type:ae});static#n=this.\u0275inj=h.cJS({providers:[...Ct,...Ie],imports:[p.ez,h.hGG]})}return ae})(),qe=(()=>{class ae{constructor(G){this._doc=G}getTitle(){return this._doc.title}setTitle(G){this._doc.title=G||""}static#e=this.\u0275fac=function(ze){return new(ze||ae)(h.LFG(p.K0))};static#t=this.\u0275prov=h.Yz7({token:ae,factory:function(ze){let at=null;return at=ze?new ze:function Hn(){return new qe((0,h.LFG)(p.K0))}(),at},providedIn:"root"})}return ae})();typeof window<"u"&&window},6800:(zn,wt,S)=>{"use strict";S.d(wt,{gz:()=>cr,y6:()=>H,OD:()=>ti,eC:()=>Ie,wN:()=>wc,F0:()=>Nr,rH:()=>ya,Bz:()=>yi,Hx:()=>tt});var h=S(8564),p=S(2664),X=S(7715),a=S(2096),j=S(5619),K=S(2572);const oe=(0,S(2306).d)(P=>function(){P(this),this.name="EmptyError",this.message="no elements in sequence"});var _e=S(5211),Le=S(4911),ee=S(8407),Te=S(5592),ye=S(4674);function De(P,U){const O=(0,ye.m)(P)?P:()=>P,z=d=>d.error(O());return new Te.y(U?d=>U.schedule(z,0,d):z)}var me=S(6232),Ye=S(7394),Ce=S(9360),de=S(8251);function Pe(){return(0,Ce.e)((P,U)=>{let O=null;P._refCount++;const z=(0,de.x)(U,void 0,void 0,void 0,()=>{if(!P||P._refCount<=0||0<--P._refCount)return void(O=null);const d=P._connection,n=O;O=null,d&&(!n||d===n)&&d.unsubscribe(),U.unsubscribe()});P.subscribe(z),z.closed||(O=P.connect())})}class Be extends Te.y{constructor(U,O){super(),this.source=U,this.subjectFactory=O,this._subject=null,this._refCount=0,this._connection=null,(0,Ce.A)(U)&&(this.lift=U.lift)}_subscribe(U){return this.getSubject().subscribe(U)}getSubject(){const U=this._subject;return(!U||U.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:U}=this;this._subject=this._connection=null,U?.unsubscribe()}connect(){let U=this._connection;if(!U){U=this._connection=new Ye.w0;const O=this.getSubject();U.add(this.source.subscribe((0,de.x)(O,void 0,()=>{this._teardown(),O.complete()},z=>{this._teardown(),O.error(z)},()=>this._teardown()))),U.closed&&(this._connection=null,U=Ye.w0.EMPTY)}return U}refCount(){return Pe()(this)}}var Ne=S(8645),Ae=S(6814),Ge=S(7398),lt=S(4664),ne=S(8180),Ee=S(4564),je=S(2181),Se=S(1631);function Ve(P){return(0,Ce.e)((U,O)=>{let z=!1;U.subscribe((0,de.x)(O,d=>{z=!0,O.next(d)},()=>{z||O.next(P),O.complete()}))})}function Xe(P=Ht){return(0,Ce.e)((U,O)=>{let z=!1;U.subscribe((0,de.x)(O,d=>{z=!0,O.next(d)},()=>z?O.complete():O.error(P())))})}function Ht(){return new oe}var cn=S(2737);function xn(P,U){const O=arguments.length>=2;return z=>z.pipe(P?(0,je.h)((d,n)=>P(d,n,z)):cn.y,(0,ne.q)(1),O?Ve(U):Xe(()=>new oe))}var $t=S(6328);function ke(P,U,O){const z=(0,ye.m)(P)||U||O?{next:P,error:U,complete:O}:P;return z?(0,Ce.e)((d,n)=>{var c;null===(c=z.subscribe)||void 0===c||c.call(z);let m=!0;d.subscribe((0,de.x)(n,v=>{var b;null===(b=z.next)||void 0===b||b.call(z,v),n.next(v)},()=>{var v;m=!1,null===(v=z.complete)||void 0===v||v.call(z),n.complete()},v=>{var b;m=!1,null===(b=z.error)||void 0===b||b.call(z,v),n.error(v)},()=>{var v,b;m&&(null===(v=z.unsubscribe)||void 0===v||v.call(z)),null===(b=z.finalize)||void 0===b||b.call(z)}))}):cn.y}var pe=S(4829);function Oe(P){return(0,Ce.e)((U,O)=>{let n,z=null,d=!1;z=U.subscribe((0,de.x)(O,void 0,void 0,c=>{n=(0,pe.Xf)(P(c,Oe(P)(U))),z?(z.unsubscribe(),z=null,n.subscribe(O)):d=!0})),d&&(z.unsubscribe(),z=null,n.subscribe(O))})}function _t(P){return P<=0?()=>me.E:(0,Ce.e)((U,O)=>{let z=[];U.subscribe((0,de.x)(O,d=>{z.push(d),P<z.length&&z.shift()},()=>{for(const d of z)O.next(d);O.complete()},void 0,()=>{z=null}))})}var fn=S(4716),qn=S(2420),en=S(7537),Dt=S(6593);const Ie="primary",Ct=Symbol("RouteTitle");class on{constructor(U){this.params=U||{}}has(U){return Object.prototype.hasOwnProperty.call(this.params,U)}get(U){if(this.has(U)){const O=this.params[U];return Array.isArray(O)?O[0]:O}return null}getAll(U){if(this.has(U)){const O=this.params[U];return Array.isArray(O)?O:[O]}return[]}get keys(){return Object.keys(this.params)}}function Rn(P){return new on(P)}function Vn(P,U,O){const z=O.path.split("/");if(z.length>P.length||"full"===O.pathMatch&&(U.hasChildren()||z.length<P.length))return null;const d={};for(let n=0;n<z.length;n++){const c=z[n],m=P[n];if(c.startsWith(":"))d[c.substring(1)]=m;else if(c!==m.path)return null}return{consumed:P.slice(0,z.length),posParams:d}}function Hn(P,U){const O=P?qe(P):void 0,z=U?qe(U):void 0;if(!O||!z||O.length!=z.length)return!1;let d;for(let n=0;n<O.length;n++)if(d=O[n],!Nt(P[d],U[d]))return!1;return!0}function qe(P){return[...Object.keys(P),...Object.getOwnPropertySymbols(P)]}function Nt(P,U){if(Array.isArray(P)&&Array.isArray(U)){if(P.length!==U.length)return!1;const O=[...P].sort(),z=[...U].sort();return O.every((d,n)=>z[n]===d)}return P===U}function Xt(P){return P.length>0?P[P.length-1]:null}function Tn(P){return(0,p.b)(P)?P:(0,h.QGY)(P)?(0,X.D)(Promise.resolve(P)):(0,a.of)(P)}const oi={exact:function ki(P,U,O){if(!ge(P.segments,U.segments)||!pn(P.segments,U.segments,O)||P.numberOfChildren!==U.numberOfChildren)return!1;for(const z in U.children)if(!P.children[z]||!ki(P.children[z],U.children[z],O))return!1;return!0},subset:_n},xi={exact:function gr(P,U){return Hn(P,U)},subset:function Wi(P,U){return Object.keys(U).length<=Object.keys(P).length&&Object.keys(U).every(O=>Nt(P[O],U[O]))},ignored:()=>!0};function Oi(P,U,O){return oi[O.paths](P.root,U.root,O.matrixParams)&&xi[O.queryParams](P.queryParams,U.queryParams)&&!("exact"===O.fragment&&P.fragment!==U.fragment)}function _n(P,U,O){return Bi(P,U,U.segments,O)}function Bi(P,U,O,z){if(P.segments.length>O.length){const d=P.segments.slice(0,O.length);return!(!ge(d,O)||U.hasChildren()||!pn(d,O,z))}if(P.segments.length===O.length){if(!ge(P.segments,O)||!pn(P.segments,O,z))return!1;for(const d in U.children)if(!P.children[d]||!_n(P.children[d],U.children[d],z))return!1;return!0}{const d=O.slice(0,P.segments.length),n=O.slice(P.segments.length);return!!(ge(P.segments,d)&&pn(P.segments,d,z)&&P.children[Ie])&&Bi(P.children[Ie],U,n,z)}}function pn(P,U,O){return U.every((z,d)=>xi[O](P[d].parameters,z.parameters))}class sn{constructor(U=new Cn([],{}),O={},z=null){this.root=U,this.queryParams=O,this.fragment=z}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Rn(this.queryParams)),this._queryParamMap}toString(){return Ot.serialize(this)}}class Cn{constructor(U,O){this.segments=U,this.children=O,this.parent=null,Object.values(O).forEach(z=>z.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Gt(this)}}class $i{constructor(U,O){this.path=U,this.parameters=O}get parameterMap(){return this._parameterMap||(this._parameterMap=Rn(this.parameters)),this._parameterMap}toString(){return G(this)}}function ge(P,U){return P.length===U.length&&P.every((O,z)=>O.path===U[z].path)}let tt=(()=>{class P{static#e=this.\u0275fac=function(z){return new(z||P)};static#t=this.\u0275prov=h.Yz7({token:P,factory:()=>new yt,providedIn:"root"})}return P})();class yt{parse(U){const O=new ho(U);return new sn(O.parseRootSegment(),O.parseQueryParams(),O.parseFragment())}serialize(U){const O=`/${Vt(U.root,!0)}`,z=function at(P){const U=Object.keys(P).map(O=>{const z=P[O];return Array.isArray(z)?z.map(d=>`${Jt(O)}=${Jt(d)}`).join("&"):`${Jt(O)}=${Jt(z)}`}).filter(O=>!!O);return U.length?`?${U.join("&")}`:""}(U.queryParams);return`${O}${z}${"string"==typeof U.fragment?`#${function Bn(P){return encodeURI(P)}(U.fragment)}`:""}`}}const Ot=new yt;function Gt(P){return P.segments.map(U=>G(U)).join("/")}function Vt(P,U){if(!P.hasChildren())return Gt(P);if(U){const O=P.children[Ie]?Vt(P.children[Ie],!1):"",z=[];return Object.entries(P.children).forEach(([d,n])=>{d!==Ie&&z.push(`${d}:${Vt(n,!1)}`)}),z.length>0?`${O}(${z.join("//")})`:O}{const O=function se(P,U){let O=[];return Object.entries(P.children).forEach(([z,d])=>{z===Ie&&(O=O.concat(U(d,z)))}),Object.entries(P.children).forEach(([z,d])=>{z!==Ie&&(O=O.concat(U(d,z)))}),O}(P,(z,d)=>d===Ie?[Vt(P.children[Ie],!1)]:[`${d}:${Vt(z,!1)}`]);return 1===Object.keys(P.children).length&&null!=P.children[Ie]?`${Gt(P)}/${O[0]}`:`${Gt(P)}/(${O.join("//")})`}}function Et(P){return encodeURIComponent(P).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Jt(P){return Et(P).replace(/%3B/gi,";")}function mn(P){return Et(P).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function ae(P){return decodeURIComponent(P)}function ht(P){return ae(P.replace(/\+/g,"%20"))}function G(P){return`${mn(P.path)}${function ze(P){return Object.keys(P).map(U=>`;${mn(U)}=${mn(P[U])}`).join("")}(P.parameters)}`}const rn=/^[^\/()?;#]+/;function Dn(P){const U=P.match(rn);return U?U[0]:""}const gi=/^[^\/()?;=#]+/,Li=/^[^=?&#]+/,Ui=/^[^&#]+/;class ho{constructor(U){this.url=U,this.remaining=U}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Cn([],{}):new Cn([],this.parseChildren())}parseQueryParams(){const U={};if(this.consumeOptional("?"))do{this.parseQueryParam(U)}while(this.consumeOptional("&"));return U}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const U=[];for(this.peekStartsWith("(")||U.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),U.push(this.parseSegment());let O={};this.peekStartsWith("/(")&&(this.capture("/"),O=this.parseParens(!0));let z={};return this.peekStartsWith("(")&&(z=this.parseParens(!1)),(U.length>0||Object.keys(O).length>0)&&(z[Ie]=new Cn(U,O)),z}parseSegment(){const U=Dn(this.remaining);if(""===U&&this.peekStartsWith(";"))throw new h.vHH(4009,!1);return this.capture(U),new $i(ae(U),this.parseMatrixParams())}parseMatrixParams(){const U={};for(;this.consumeOptional(";");)this.parseParam(U);return U}parseParam(U){const O=function Mi(P){const U=P.match(gi);return U?U[0]:""}(this.remaining);if(!O)return;this.capture(O);let z="";if(this.consumeOptional("=")){const d=Dn(this.remaining);d&&(z=d,this.capture(z))}U[ae(O)]=ae(z)}parseQueryParam(U){const O=function yr(P){const U=P.match(Li);return U?U[0]:""}(this.remaining);if(!O)return;this.capture(O);let z="";if(this.consumeOptional("=")){const c=function Fr(P){const U=P.match(Ui);return U?U[0]:""}(this.remaining);c&&(z=c,this.capture(z))}const d=ht(O),n=ht(z);if(U.hasOwnProperty(d)){let c=U[d];Array.isArray(c)||(c=[c],U[d]=c),c.push(n)}else U[d]=n}parseParens(U){const O={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const z=Dn(this.remaining),d=this.remaining[z.length];if("/"!==d&&")"!==d&&";"!==d)throw new h.vHH(4010,!1);let n;z.indexOf(":")>-1?(n=z.slice(0,z.indexOf(":")),this.capture(n),this.capture(":")):U&&(n=Ie);const c=this.parseChildren();O[n]=1===Object.keys(c).length?c[Ie]:new Cn([],c),this.consumeOptional("//")}return O}peekStartsWith(U){return this.remaining.startsWith(U)}consumeOptional(U){return!!this.peekStartsWith(U)&&(this.remaining=this.remaining.substring(U.length),!0)}capture(U){if(!this.consumeOptional(U))throw new h.vHH(4011,!1)}}function Do(P){return P.segments.length>0?new Cn([],{[Ie]:P}):P}function Io(P){const U={};for(const z of Object.keys(P.children)){const n=Io(P.children[z]);if(z===Ie&&0===n.segments.length&&n.hasChildren())for(const[c,m]of Object.entries(n.children))U[c]=m;else(n.segments.length>0||n.hasChildren())&&(U[z]=n)}return function Zi(P){if(1===P.numberOfChildren&&P.children[Ie]){const U=P.children[Ie];return new Cn(P.segments.concat(U.segments),U.children)}return P}(new Cn(P.segments,U))}function ao(P){return P instanceof sn}function xo(P){let U;const d=Do(function O(n){const c={};for(const v of n.children){const b=O(v);c[v.outlet]=b}const m=new Cn(n.url,c);return n===P&&(U=m),m}(P.root));return U??d}function qi(P,U,O,z){let d=P;for(;d.parent;)d=d.parent;if(0===U.length)return Yt(d,d,d,O,z);const n=function Qt(P){if("string"==typeof P[0]&&1===P.length&&"/"===P[0])return new Mt(!0,0,P);let U=0,O=!1;const z=P.reduce((d,n,c)=>{if("object"==typeof n&&null!=n){if(n.outlets){const m={};return Object.entries(n.outlets).forEach(([v,b])=>{m[v]="string"==typeof b?b.split("/"):b}),[...d,{outlets:m}]}if(n.segmentPath)return[...d,n.segmentPath]}return"string"!=typeof n?[...d,n]:0===c?(n.split("/").forEach((m,v)=>{0==v&&"."===m||(0==v&&""===m?O=!0:".."===m?U++:""!=m&&d.push(m))}),d):[...d,n]},[]);return new Mt(O,U,z)}(U);if(n.toRoot())return Yt(d,d,new Cn([],{}),O,z);const c=function It(P,U,O){if(P.isAbsolute)return new wn(U,!0,0);if(!O)return new wn(U,!1,NaN);if(null===O.parent)return new wn(O,!0,0);const z=Ci(P.commands[0])?0:1;return function Xn(P,U,O){let z=P,d=U,n=O;for(;n>d;){if(n-=d,z=z.parent,!z)throw new h.vHH(4005,!1);d=z.segments.length}return new wn(z,!1,d-n)}(O,O.segments.length-1+z,P.numberOfDoubleDots)}(n,d,P),m=c.processChildren?lr(c.segmentGroup,c.index,n.commands):Wn(c.segmentGroup,c.index,n.commands);return Yt(d,c.segmentGroup,m,O,z)}function Ci(P){return"object"==typeof P&&null!=P&&!P.outlets&&!P.segmentPath}function Kr(P){return"object"==typeof P&&null!=P&&P.outlets}function Yt(P,U,O,z,d){let c,n={};z&&Object.entries(z).forEach(([v,b])=>{n[v]=Array.isArray(b)?b.map(I=>`${I}`):`${b}`}),c=P===U?O:Tt(P,U,O);const m=Do(Io(c));return new sn(m,n,d)}function Tt(P,U,O){const z={};return Object.entries(P.children).forEach(([d,n])=>{z[d]=n===U?O:Tt(n,U,O)}),new Cn(P.segments,z)}class Mt{constructor(U,O,z){if(this.isAbsolute=U,this.numberOfDoubleDots=O,this.commands=z,U&&z.length>0&&Ci(z[0]))throw new h.vHH(4003,!1);const d=z.find(Kr);if(d&&d!==Xt(z))throw new h.vHH(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class wn{constructor(U,O,z){this.segmentGroup=U,this.processChildren=O,this.index=z}}function Wn(P,U,O){if(P||(P=new Cn([],{})),0===P.segments.length&&P.hasChildren())return lr(P,U,O);const z=function Je(P,U,O){let z=0,d=U;const n={match:!1,pathIndex:0,commandIndex:0};for(;d<P.segments.length;){if(z>=O.length)return n;const c=P.segments[d],m=O[z];if(Kr(m))break;const v=`${m}`,b=z<O.length-1?O[z+1]:null;if(d>0&&void 0===v)break;if(v&&b&&"object"==typeof b&&void 0===b.outlets){if(!dt(v,b,c))return n;z+=2}else{if(!dt(v,{},c))return n;z++}d++}return{match:!0,pathIndex:d,commandIndex:z}}(P,U,O),d=O.slice(z.commandIndex);if(z.match&&z.pathIndex<P.segments.length){const n=new Cn(P.segments.slice(0,z.pathIndex),{});return n.children[Ie]=new Cn(P.segments.slice(z.pathIndex),P.children),lr(n,0,d)}return z.match&&0===d.length?new Cn(P.segments,{}):z.match&&!P.hasChildren()?rt(P,U,O):z.match?lr(P,0,d):rt(P,U,O)}function lr(P,U,O){if(0===O.length)return new Cn(P.segments,{});{const z=function ui(P){return Kr(P[0])?P[0].outlets:{[Ie]:P}}(O),d={};if(Object.keys(z).some(n=>n!==Ie)&&P.children[Ie]&&1===P.numberOfChildren&&0===P.children[Ie].segments.length){const n=lr(P.children[Ie],U,O);return new Cn(P.segments,n.children)}return Object.entries(z).forEach(([n,c])=>{"string"==typeof c&&(c=[c]),null!==c&&(d[n]=Wn(P.children[n],U,c))}),Object.entries(P.children).forEach(([n,c])=>{void 0===z[n]&&(d[n]=c)}),new Cn(P.segments,d)}}function rt(P,U,O){const z=P.segments.slice(0,U);let d=0;for(;d<O.length;){const n=O[d];if(Kr(n)){const v=we(n.outlets);return new Cn(z,v)}if(0===d&&Ci(O[0])){z.push(new $i(P.segments[U].path,ut(O[0]))),d++;continue}const c=Kr(n)?n.outlets[Ie]:`${n}`,m=d<O.length-1?O[d+1]:null;c&&m&&Ci(m)?(z.push(new $i(c,ut(m))),d+=2):(z.push(new $i(c,{})),d++)}return new Cn(z,{})}function we(P){const U={};return Object.entries(P).forEach(([O,z])=>{"string"==typeof z&&(z=[z]),null!==z&&(U[O]=rt(new Cn([],{}),0,z))}),U}function ut(P){const U={};return Object.entries(P).forEach(([O,z])=>U[O]=`${z}`),U}function dt(P,U,O){return P==O.path&&Hn(U,O.parameters)}const Lt="imperative";class gn{constructor(U,O){this.id=U,this.url=O}}class ti extends gn{constructor(U,O,z="imperative",d=null){super(U,O),this.type=0,this.navigationTrigger=z,this.restoredState=d}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class di extends gn{constructor(U,O,z){super(U,O),this.urlAfterRedirects=z,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Kn extends gn{constructor(U,O,z,d){super(U,O),this.reason=z,this.code=d,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Xi extends gn{constructor(U,O,z,d){super(U,O),this.reason=z,this.code=d,this.type=16}}class J extends gn{constructor(U,O,z,d){super(U,O),this.error=z,this.target=d,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class be extends gn{constructor(U,O,z,d){super(U,O),this.urlAfterRedirects=z,this.state=d,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ft extends gn{constructor(U,O,z,d){super(U,O),this.urlAfterRedirects=z,this.state=d,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class mt extends gn{constructor(U,O,z,d,n){super(U,O),this.urlAfterRedirects=z,this.state=d,this.shouldActivate=n,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class yn extends gn{constructor(U,O,z,d){super(U,O),this.urlAfterRedirects=z,this.state=d,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class jt extends gn{constructor(U,O,z,d){super(U,O),this.urlAfterRedirects=z,this.state=d,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Fn{constructor(U){this.route=U,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class $n{constructor(U){this.route=U,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Un{constructor(U){this.snapshot=U,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ln{constructor(U){this.snapshot=U,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ci{constructor(U){this.snapshot=U,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ri{constructor(U){this.snapshot=U,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Gi{constructor(U,O,z){this.routerEvent=U,this.position=O,this.anchor=z,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class or{}class ur{constructor(U){this.url=U}}class $e{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new H,this.attachRef=null}}let H=(()=>{class P{constructor(){this.contexts=new Map}onChildOutletCreated(O,z){const d=this.getOrCreateContext(O);d.outlet=z,this.contexts.set(O,d)}onChildOutletDestroyed(O){const z=this.getContext(O);z&&(z.outlet=null,z.attachRef=null)}onOutletDeactivated(){const O=this.contexts;return this.contexts=new Map,O}onOutletReAttached(O){this.contexts=O}getOrCreateContext(O){let z=this.getContext(O);return z||(z=new $e,this.contexts.set(O,z)),z}getContext(O){return this.contexts.get(O)||null}static#e=this.\u0275fac=function(z){return new(z||P)};static#t=this.\u0275prov=h.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})();class Ze{constructor(U){this._root=U}get root(){return this._root.value}parent(U){const O=this.pathFromRoot(U);return O.length>1?O[O.length-2]:null}children(U){const O=Bt(U,this._root);return O?O.children.map(z=>z.value):[]}firstChild(U){const O=Bt(U,this._root);return O&&O.children.length>0?O.children[0].value:null}siblings(U){const O=Vi(U,this._root);return O.length<2?[]:O[O.length-2].children.map(d=>d.value).filter(d=>d!==U)}pathFromRoot(U){return Vi(U,this._root).map(O=>O.value)}}function Bt(P,U){if(P===U.value)return U;for(const O of U.children){const z=Bt(P,O);if(z)return z}return null}function Vi(P,U){if(P===U.value)return[U];for(const O of U.children){const z=Vi(P,O);if(z.length)return z.unshift(U),z}return[]}class Tr{constructor(U,O){this.value=U,this.children=O}toString(){return`TreeNode(${this.value})`}}function ji(P){const U={};return P&&P.children.forEach(O=>U[O.value.outlet]=O),U}class Ko extends Ze{constructor(U,O){super(U),this.snapshot=O,jo(this,U)}toString(){return this.snapshot.toString()}}function Mo(P,U){const O=function Ns(P,U){const c=new _r([],{},{},"",{},Ie,U,null,{});return new Uo("",new Tr(c,[]))}(0,U),z=new j.X([new $i("",{})]),d=new j.X({}),n=new j.X({}),c=new j.X({}),m=new j.X(""),v=new cr(z,d,c,m,n,Ie,U,O.root);return v.snapshot=O.root,new Ko(new Tr(v,[]),O)}class cr{constructor(U,O,z,d,n,c,m,v){this.urlSubject=U,this.paramsSubject=O,this.queryParamsSubject=z,this.fragmentSubject=d,this.dataSubject=n,this.outlet=c,this.component=m,this._futureSnapshot=v,this.title=this.dataSubject?.pipe((0,Ge.U)(b=>b[Ct]))??(0,a.of)(void 0),this.url=U,this.params=O,this.queryParams=z,this.fragment=d,this.data=n}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Ge.U)(U=>Rn(U)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Ge.U)(U=>Rn(U)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Bs(P,U,O="emptyOnly"){let z;const{routeConfig:d}=P;return z=null===U||"always"!==O&&""!==d?.path&&(U.component||U.routeConfig?.loadComponent)?{params:P.params,data:P.data,resolve:{...P.data,...P._resolvedData??{}}}:{params:{...U.params,...P.params},data:{...U.data,...P.data},resolve:{...P.data,...U.data,...d?.data,...P._resolvedData}},d&&zs(d)&&(z.resolve[Ct]=d.title),z}class _r{get title(){return this.data?.[Ct]}constructor(U,O,z,d,n,c,m,v,b){this.url=U,this.params=O,this.queryParams=z,this.fragment=d,this.data=n,this.outlet=c,this.component=m,this.routeConfig=v,this._resolve=b}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Rn(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Rn(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(z=>z.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Uo extends Ze{constructor(U,O){super(O),this.url=U,jo(this,O)}toString(){return Go(this._root)}}function jo(P,U){U.value._routerState=P,U.children.forEach(O=>jo(P,O))}function Go(P){const U=P.children.length>0?` { ${P.children.map(Go).join(", ")} } `:"";return`${P.value}${U}`}function Al(P){if(P.snapshot){const U=P.snapshot,O=P._futureSnapshot;P.snapshot=O,Hn(U.queryParams,O.queryParams)||P.queryParamsSubject.next(O.queryParams),U.fragment!==O.fragment&&P.fragmentSubject.next(O.fragment),Hn(U.params,O.params)||P.paramsSubject.next(O.params),function Ut(P,U){if(P.length!==U.length)return!1;for(let O=0;O<P.length;++O)if(!Hn(P[O],U[O]))return!1;return!0}(U.url,O.url)||P.urlSubject.next(O.url),Hn(U.data,O.data)||P.dataSubject.next(O.data)}else P.snapshot=P._futureSnapshot,P.dataSubject.next(P._futureSnapshot.data)}function $a(P,U){const O=Hn(P.params,U.params)&&function ct(P,U){return ge(P,U)&&P.every((O,z)=>Hn(O.parameters,U[z].parameters))}(P.url,U.url);return O&&!(!P.parent!=!U.parent)&&(!P.parent||$a(P.parent,U.parent))}function zs(P){return"string"==typeof P.title||null===P.title}let lo=(()=>{class P{constructor(){this.activated=null,this._activatedRoute=null,this.name=Ie,this.activateEvents=new h.vpe,this.deactivateEvents=new h.vpe,this.attachEvents=new h.vpe,this.detachEvents=new h.vpe,this.parentContexts=(0,h.f3M)(H),this.location=(0,h.f3M)(h.s_b),this.changeDetector=(0,h.f3M)(h.sBO),this.environmentInjector=(0,h.f3M)(h.lqb),this.inputBinder=(0,h.f3M)(fo,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(O){if(O.name){const{firstChange:z,previousValue:d}=O.name;if(z)return;this.isTrackedInParentContexts(d)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(d)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(O){return this.parentContexts.getContext(O)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const O=this.parentContexts.getContext(this.name);O?.route&&(O.attachRef?this.attach(O.attachRef,O.route):this.activateWith(O.route,O.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new h.vHH(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new h.vHH(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new h.vHH(4012,!1);this.location.detach();const O=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(O.instance),O}attach(O,z){this.activated=O,this._activatedRoute=z,this.location.insert(O.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(O.instance)}deactivate(){if(this.activated){const O=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(O)}}activateWith(O,z){if(this.isActivated)throw new h.vHH(4013,!1);this._activatedRoute=O;const d=this.location,c=O.snapshot.component,m=this.parentContexts.getOrCreateContext(this.name).children,v=new Aa(O,m,d.injector);this.activated=d.createComponent(c,{index:d.length,injector:v,environmentInjector:z??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(z){return new(z||P)};static#t=this.\u0275dir=h.lG2({type:P,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[h.TTD]})}return P})();class Aa{constructor(U,O,z){this.route=U,this.childContexts=O,this.parent=z}get(U,O){return U===cr?this.route:U===H?this.childContexts:this.parent.get(U,O)}}const fo=new h.OlP("");let po=(()=>{class P{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(O){this.unsubscribeFromRouteData(O),this.subscribeToRouteData(O)}unsubscribeFromRouteData(O){this.outletDataSubscriptions.get(O)?.unsubscribe(),this.outletDataSubscriptions.delete(O)}subscribeToRouteData(O){const{activatedRoute:z}=O,d=(0,K.a)([z.queryParams,z.params,z.data]).pipe((0,lt.w)(([n,c,m],v)=>(m={...n,...c,...m},0===v?(0,a.of)(m):Promise.resolve(m)))).subscribe(n=>{if(!O.isActivated||!O.activatedComponentRef||O.activatedRoute!==z||null===z.component)return void this.unsubscribeFromRouteData(O);const c=(0,h.qFp)(z.component);if(c)for(const{templateName:m}of c.inputs)O.activatedComponentRef.setInput(m,n[m]);else this.unsubscribeFromRouteData(O)});this.outletDataSubscriptions.set(O,d)}static#e=this.\u0275fac=function(z){return new(z||P)};static#t=this.\u0275prov=h.Yz7({token:P,factory:P.\u0275fac})}return P})();function Lo(P,U,O){if(O&&P.shouldReuseRoute(U.value,O.value.snapshot)){const z=O.value;z._futureSnapshot=U.value;const d=function ns(P,U,O){return U.children.map(z=>{for(const d of O.children)if(P.shouldReuseRoute(z.value,d.value.snapshot))return Lo(P,z,d);return Lo(P,z)})}(P,U,O);return new Tr(z,d)}{if(P.shouldAttach(U.value)){const n=P.retrieve(U.value);if(null!==n){const c=n.route;return c.value._futureSnapshot=U.value,c.children=U.children.map(m=>Lo(P,m)),c}}const z=function ha(P){return new cr(new j.X(P.url),new j.X(P.params),new j.X(P.queryParams),new j.X(P.fragment),new j.X(P.data),P.outlet,P.component,P)}(U.value),d=U.children.map(n=>Lo(P,n));return new Tr(z,d)}}const ws="ngNavigationCancelingError";function na(P,U){const{redirectTo:O,navigationBehaviorOptions:z}=ao(U)?{redirectTo:U,navigationBehaviorOptions:void 0}:U,d=Us(!1,0,U);return d.url=O,d.navigationBehaviorOptions=z,d}function Us(P,U,O){const z=new Error("NavigationCancelingError: "+(P||""));return z[ws]=!0,z.cancellationCode=U,O&&(z.url=O),z}function fl(P){return P&&P[ws]}let cs=(()=>{class P{static#e=this.\u0275fac=function(z){return new(z||P)};static#t=this.\u0275cmp=h.Xpm({type:P,selectors:[["ng-component"]],standalone:!0,features:[h.jDz],decls:1,vars:0,template:function(z,d){1&z&&h._UZ(0,"router-outlet")},dependencies:[lo],encapsulation:2})}return P})();function js(P){const U=P.children&&P.children.map(js),O=U?{...P,children:U}:{...P};return!O.component&&!O.loadComponent&&(U||O.loadChildren)&&O.outlet&&O.outlet!==Ie&&(O.component=cs),O}function bo(P){return P.outlet||Ie}function ia(P){if(!P)return null;if(P.routeConfig?._injector)return P.routeConfig._injector;for(let U=P.parent;U;U=U.parent){const O=U.routeConfig;if(O?._loadedInjector)return O._loadedInjector;if(O?._injector)return O._injector}return null}class Rl{constructor(U,O,z,d,n){this.routeReuseStrategy=U,this.futureState=O,this.currState=z,this.forwardEvent=d,this.inputBindingEnabled=n}activate(U){const O=this.futureState._root,z=this.currState?this.currState._root:null;this.deactivateChildRoutes(O,z,U),Al(this.futureState.root),this.activateChildRoutes(O,z,U)}deactivateChildRoutes(U,O,z){const d=ji(O);U.children.forEach(n=>{const c=n.value.outlet;this.deactivateRoutes(n,d[c],z),delete d[c]}),Object.values(d).forEach(n=>{this.deactivateRouteAndItsChildren(n,z)})}deactivateRoutes(U,O,z){const d=U.value,n=O?O.value:null;if(d===n)if(d.component){const c=z.getContext(d.outlet);c&&this.deactivateChildRoutes(U,O,c.children)}else this.deactivateChildRoutes(U,O,z);else n&&this.deactivateRouteAndItsChildren(O,z)}deactivateRouteAndItsChildren(U,O){U.value.component&&this.routeReuseStrategy.shouldDetach(U.value.snapshot)?this.detachAndStoreRouteSubtree(U,O):this.deactivateRouteAndOutlet(U,O)}detachAndStoreRouteSubtree(U,O){const z=O.getContext(U.value.outlet),d=z&&U.value.component?z.children:O,n=ji(U);for(const c of Object.keys(n))this.deactivateRouteAndItsChildren(n[c],d);if(z&&z.outlet){const c=z.outlet.detach(),m=z.children.onOutletDeactivated();this.routeReuseStrategy.store(U.value.snapshot,{componentRef:c,route:U,contexts:m})}}deactivateRouteAndOutlet(U,O){const z=O.getContext(U.value.outlet),d=z&&U.value.component?z.children:O,n=ji(U);for(const c of Object.keys(n))this.deactivateRouteAndItsChildren(n[c],d);z&&(z.outlet&&(z.outlet.deactivate(),z.children.onOutletDeactivated()),z.attachRef=null,z.route=null)}activateChildRoutes(U,O,z){const d=ji(O);U.children.forEach(n=>{this.activateRoutes(n,d[n.value.outlet],z),this.forwardEvent(new Ri(n.value.snapshot))}),U.children.length&&this.forwardEvent(new Ln(U.value.snapshot))}activateRoutes(U,O,z){const d=U.value,n=O?O.value:null;if(Al(d),d===n)if(d.component){const c=z.getOrCreateContext(d.outlet);this.activateChildRoutes(U,O,c.children)}else this.activateChildRoutes(U,O,z);else if(d.component){const c=z.getOrCreateContext(d.outlet);if(this.routeReuseStrategy.shouldAttach(d.snapshot)){const m=this.routeReuseStrategy.retrieve(d.snapshot);this.routeReuseStrategy.store(d.snapshot,null),c.children.onOutletReAttached(m.contexts),c.attachRef=m.componentRef,c.route=m.route.value,c.outlet&&c.outlet.attach(m.componentRef,m.route.value),Al(m.route.value),this.activateChildRoutes(U,null,c.children)}else{const m=ia(d.snapshot);c.attachRef=null,c.route=d,c.injector=m,c.outlet&&c.outlet.activateWith(d,c.injector),this.activateChildRoutes(U,null,c.children)}}else this.activateChildRoutes(U,null,z)}}class qa{constructor(U){this.path=U,this.route=this.path[this.path.length-1]}}class ma{constructor(U,O){this.component=U,this.route=O}}function Ya(P,U,O){const z=P._root;return Br(z,U?U._root:null,O,[z.value])}function _i(P,U){const O=Symbol(),z=U.get(P,O);return z===O?"function"!=typeof P||(0,h.Z0I)(P)?U.get(P):P:z}function Br(P,U,O,z,d={canDeactivateChecks:[],canActivateChecks:[]}){const n=ji(U);return P.children.forEach(c=>{(function Ao(P,U,O,z,d={canDeactivateChecks:[],canActivateChecks:[]}){const n=P.value,c=U?U.value:null,m=O?O.getContext(P.value.outlet):null;if(c&&n.routeConfig===c.routeConfig){const v=function le(P,U,O){if("function"==typeof O)return O(P,U);switch(O){case"pathParamsChange":return!ge(P.url,U.url);case"pathParamsOrQueryParamsChange":return!ge(P.url,U.url)||!Hn(P.queryParams,U.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!$a(P,U)||!Hn(P.queryParams,U.queryParams);default:return!$a(P,U)}}(c,n,n.routeConfig.runGuardsAndResolvers);v?d.canActivateChecks.push(new qa(z)):(n.data=c.data,n._resolvedData=c._resolvedData),Br(P,U,n.component?m?m.children:null:O,z,d),v&&m&&m.outlet&&m.outlet.isActivated&&d.canDeactivateChecks.push(new ma(m.outlet.component,c))}else c&&ue(U,m,d),d.canActivateChecks.push(new qa(z)),Br(P,null,n.component?m?m.children:null:O,z,d)})(c,n[c.value.outlet],O,z.concat([c.value]),d),delete n[c.value.outlet]}),Object.entries(n).forEach(([c,m])=>ue(m,O.getContext(c),d)),d}function ue(P,U,O){const z=ji(P),d=P.value;Object.entries(z).forEach(([n,c])=>{ue(c,d.component?U?U.children.getContext(n):null:U,O)}),O.canDeactivateChecks.push(new ma(d.component&&U&&U.outlet&&U.outlet.isActivated?U.outlet.component:null,d))}function W(P){return"function"==typeof P}function us(P){return P instanceof oe||"EmptyError"===P?.name}const wo=Symbol("INITIAL_VALUE");function Ho(){return(0,lt.w)(P=>(0,K.a)(P.map(U=>U.pipe((0,ne.q)(1),function xe(...P){const U=(0,Ee.yG)(P);return(0,Ce.e)((O,z)=>{(U?(0,_e.z)(P,O,U):(0,_e.z)(P,O)).subscribe(z)})}(wo)))).pipe((0,Ge.U)(U=>{for(const O of U)if(!0!==O){if(O===wo)return wo;if(!1===O||O instanceof sn)return O}return!0}),(0,je.h)(U=>U!==wo),(0,ne.q)(1)))}function Ja(P){return(0,ee.z)(ke(U=>{if(ao(U))throw na(0,U)}),(0,Ge.U)(U=>!0===U))}class is{constructor(U){this.segmentGroup=U||null}}class ga extends Error{constructor(U){super(),this.urlTree=U}}function sa(P){return De(new is(P))}class er{constructor(U,O){this.urlSerializer=U,this.urlTree=O}noMatchError(U){return new h.vHH(4002,!1)}lineralizeSegments(U,O){let z=[],d=O.root;for(;;){if(z=z.concat(d.segments),0===d.numberOfChildren)return(0,a.of)(z);if(d.numberOfChildren>1||!d.children[Ie])return De(new h.vHH(4e3,!1));d=d.children[Ie]}}applyRedirectCommands(U,O,z){const d=this.applyRedirectCreateUrlTree(O,this.urlSerializer.parse(O),U,z);if(O.startsWith("/"))throw new ga(d);return d}applyRedirectCreateUrlTree(U,O,z,d){const n=this.createSegmentGroup(U,O.root,z,d);return new sn(n,this.createQueryParams(O.queryParams,this.urlTree.queryParams),O.fragment)}createQueryParams(U,O){const z={};return Object.entries(U).forEach(([d,n])=>{if("string"==typeof n&&n.startsWith(":")){const m=n.substring(1);z[d]=O[m]}else z[d]=n}),z}createSegmentGroup(U,O,z,d){const n=this.createSegments(U,O.segments,z,d);let c={};return Object.entries(O.children).forEach(([m,v])=>{c[m]=this.createSegmentGroup(U,v,z,d)}),new Cn(n,c)}createSegments(U,O,z,d){return O.map(n=>n.path.startsWith(":")?this.findPosParam(U,n,d):this.findOrReturn(n,z))}findPosParam(U,O,z){const d=z[O.path.substring(1)];if(!d)throw new h.vHH(4001,!1);return d}findOrReturn(U,O){let z=0;for(const d of O){if(d.path===U.path)return O.splice(z),d;z++}return U}}const Ka={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function ml(P,U,O,z,d){const n=Wo(P,U,O);return n.matched?(z=function vr(P,U){return P.providers&&!P._injector&&(P._injector=(0,h.MMx)(P.providers,U,`Route: ${P.path}`)),P._injector??U}(U,z),function oa(P,U,O,z){const d=U.canMatch;if(!d||0===d.length)return(0,a.of)(!0);const n=d.map(c=>{const m=_i(c,P);return Tn(function ai(P){return P&&W(P.canMatch)}(m)?m.canMatch(U,O):P.runInContext(()=>m(U,O)))});return(0,a.of)(n).pipe(Ho(),Ja())}(z,U,O).pipe((0,Ge.U)(c=>!0===c?n:{...Ka}))):(0,a.of)(n)}function Wo(P,U,O){if(""===U.path)return"full"===U.pathMatch&&(P.hasChildren()||O.length>0)?{...Ka}:{matched:!0,consumedSegments:[],remainingSegments:O,parameters:{},positionalParamSegments:{}};const d=(U.matcher||Vn)(O,P,U);if(!d)return{...Ka};const n={};Object.entries(d.posParams??{}).forEach(([m,v])=>{n[m]=v.path});const c=d.consumed.length>0?{...n,...d.consumed[d.consumed.length-1].parameters}:n;return{matched:!0,consumedSegments:d.consumed,remainingSegments:O.slice(d.consumed.length),parameters:c,positionalParamSegments:d.posParams??{}}}function gl(P,U,O,z){return O.length>0&&function Ts(P,U,O){return O.some(z=>go(P,U,z)&&bo(z)!==Ie)}(P,O,z)?{segmentGroup:new Cn(U,mo(z,new Cn(O,P.children))),slicedSegments:[]}:0===O.length&&function ko(P,U,O){return O.some(z=>go(P,U,z))}(P,O,z)?{segmentGroup:new Cn(P.segments,aa(P,0,O,z,P.children)),slicedSegments:O}:{segmentGroup:new Cn(P.segments,P.children),slicedSegments:O}}function aa(P,U,O,z,d){const n={};for(const c of z)if(go(P,O,c)&&!d[bo(c)]){const m=new Cn([],{});n[bo(c)]=m}return{...d,...n}}function mo(P,U){const O={};O[Ie]=U;for(const z of P)if(""===z.path&&bo(z)!==Ie){const d=new Cn([],{});O[bo(z)]=d}return O}function go(P,U,O){return(!(P.hasChildren()||U.length>0)||"full"!==O.pathMatch)&&""===O.path}class ec{}class yl{constructor(U,O,z,d,n,c,m){this.injector=U,this.configLoader=O,this.rootComponentType=z,this.config=d,this.urlTree=n,this.paramsInheritanceStrategy=c,this.urlSerializer=m,this.applyRedirects=new er(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(U){return new h.vHH(4002,!1)}recognize(){const U=gl(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(U).pipe((0,Ge.U)(O=>{const z=new _r([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Ie,this.rootComponentType,null,{}),d=new Tr(z,O),n=new Uo("",d),c=function Ro(P,U,O=null,z=null){return qi(xo(P),U,O,z)}(z,[],this.urlTree.queryParams,this.urlTree.fragment);return c.queryParams=this.urlTree.queryParams,n.url=this.urlSerializer.serialize(c),this.inheritParamsAndData(n._root,null),{state:n,tree:c}}))}match(U){return this.processSegmentGroup(this.injector,this.config,U,Ie).pipe(Oe(z=>{if(z instanceof ga)return this.urlTree=z.urlTree,this.match(z.urlTree.root);throw z instanceof is?this.noMatchError(z):z}))}inheritParamsAndData(U,O){const z=U.value,d=Bs(z,O,this.paramsInheritanceStrategy);z.params=Object.freeze(d.params),z.data=Object.freeze(d.data),U.children.forEach(n=>this.inheritParamsAndData(n,z))}processSegmentGroup(U,O,z,d){return 0===z.segments.length&&z.hasChildren()?this.processChildren(U,O,z):this.processSegment(U,O,z,z.segments,d,!0).pipe((0,Ge.U)(n=>n instanceof Tr?[n]:[]))}processChildren(U,O,z){const d=[];for(const n of Object.keys(z.children))"primary"===n?d.unshift(n):d.push(n);return(0,X.D)(d).pipe((0,$t.b)(n=>{const c=z.children[n],m=function Sa(P,U){const O=P.filter(z=>bo(z)===U);return O.push(...P.filter(z=>bo(z)!==U)),O}(O,n);return this.processSegmentGroup(U,m,c,n)}),function it(P,U){return(0,Ce.e)(function ie(P,U,O,z,d){return(n,c)=>{let m=O,v=U,b=0;n.subscribe((0,de.x)(c,I=>{const M=b++;v=m?P(v,I,M):(m=!0,I),z&&c.next(v)},d&&(()=>{m&&c.next(v),c.complete()})))}}(P,U,arguments.length>=2,!0))}((n,c)=>(n.push(...c),n)),Ve(null),function Kt(P,U){const O=arguments.length>=2;return z=>z.pipe(P?(0,je.h)((d,n)=>P(d,n,z)):cn.y,_t(1),O?Ve(U):Xe(()=>new oe))}(),(0,Se.z)(n=>{if(null===n)return sa(z);const c=Vs(n);return function Jc(P){P.sort((U,O)=>U.value.outlet===Ie?-1:O.value.outlet===Ie?1:U.value.outlet.localeCompare(O.value.outlet))}(c),(0,a.of)(c)}))}processSegment(U,O,z,d,n,c){return(0,X.D)(O).pipe((0,$t.b)(m=>this.processSegmentAgainstRoute(m._injector??U,O,m,z,d,n,c).pipe(Oe(v=>{if(v instanceof is)return(0,a.of)(null);throw v}))),xn(m=>!!m),Oe(m=>{if(us(m))return function Xa(P,U,O){return 0===U.length&&!P.children[O]}(z,d,n)?(0,a.of)(new ec):sa(z);throw m}))}processSegmentAgainstRoute(U,O,z,d,n,c,m){return function bc(P,U,O,z){return!!(bo(P)===z||z!==Ie&&go(U,O,P))&&("**"===P.path||Wo(U,P,O).matched)}(z,d,n,c)?void 0===z.redirectTo?this.matchSegmentAgainstRoute(U,d,z,n,c):this.allowRedirects&&m?this.expandSegmentAgainstRouteUsingRedirect(U,d,O,z,n,c):sa(d):sa(d)}expandSegmentAgainstRouteUsingRedirect(U,O,z,d,n,c){const{matched:m,consumedSegments:v,positionalParamSegments:b,remainingSegments:I}="**"===d.path?Me(n):Wo(O,d,n);if(!m)return sa(O);d.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const M=this.applyRedirects.applyRedirectCommands(v,d.redirectTo,b);return this.applyRedirects.lineralizeSegments(d,M).pipe((0,Se.z)(N=>this.processSegment(U,z,O,N.concat(I),c,!1)))}matchSegmentAgainstRoute(U,O,z,d,n){let c;return"**"===z.path?(c=(0,a.of)(Me(d)),O.children={}):c=ml(O,z,d,U),c.pipe((0,lt.w)(m=>m.matched?this.getChildConfig(U=z._injector??U,z,d).pipe((0,lt.w)(({routes:v})=>{const b=z._loadedInjector??U,{consumedSegments:I,remainingSegments:M,parameters:N}=m,Z=new _r(I,N,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,function rs(P){return P.data||{}}(z),bo(z),z.component??z._loadedComponent??null,z,function F(P){return P.resolve||{}}(z)),{segmentGroup:$,slicedSegments:re}=gl(O,I,M,v);if(0===re.length&&$.hasChildren())return this.processChildren(b,v,$).pipe((0,Ge.U)(Fe=>null===Fe?null:new Tr(Z,Fe)));if(0===v.length&&0===re.length)return(0,a.of)(new Tr(Z,[]));const Re=bo(z)===n;return this.processSegment(b,v,$,re,Re?Ie:n,!0).pipe((0,Ge.U)(Fe=>new Tr(Z,Fe instanceof Tr?[Fe]:[])))})):sa(O)))}getChildConfig(U,O,z){return O.children?(0,a.of)({routes:O.children,injector:U}):O.loadChildren?void 0!==O._loadedRoutes?(0,a.of)({routes:O._loadedRoutes,injector:O._loadedInjector}):function Xr(P,U,O,z){const d=U.canLoad;if(void 0===d||0===d.length)return(0,a.of)(!0);const n=d.map(c=>{const m=_i(c,P);return Tn(function zt(P){return P&&W(P.canLoad)}(m)?m.canLoad(U,O):P.runInContext(()=>m(U,O)))});return(0,a.of)(n).pipe(Ho(),Ja())}(U,O,z).pipe((0,Se.z)(d=>d?this.configLoader.loadChildren(U,O).pipe(ke(n=>{O._loadedRoutes=n.routes,O._loadedInjector=n.injector})):function _a(P){return De(Us(!1,3))}())):(0,a.of)({routes:[],injector:U})}}function tc(P){const U=P.value.routeConfig;return U&&""===U.path}function Vs(P){const U=[],O=new Set;for(const z of P){if(!tc(z)){U.push(z);continue}const d=U.find(n=>z.value.routeConfig===n.value.routeConfig);void 0!==d?(d.children.push(...z.children),O.add(d)):U.push(z)}for(const z of O){const d=Vs(z.children);U.push(new Tr(z.value,d))}return U.filter(z=>!O.has(z))}function Me(P){return{matched:!0,parameters:P.length>0?Xt(P).parameters:{},consumedSegments:P,remainingSegments:[],positionalParamSegments:{}}}function fe(P,U){return(0,Se.z)(O=>{const{targetSnapshot:z,guards:{canActivateChecks:d}}=O;if(!d.length)return(0,a.of)(O);const n=d.map(b=>b.route),c=new Set(n),m=xt(n[0].parent).slice(1);let v=0;return(0,X.D)(m).pipe((0,$t.b)(b=>c.has(b)?function vn(P,U,O,z){const d=P.routeConfig,n=P._resolve;return void 0!==d?.title&&!zs(d)&&(n[Ct]=d.title),function bn(P,U,O,z){const d=qe(P);if(0===d.length)return(0,a.of)({});const n={};return(0,X.D)(d).pipe((0,Se.z)(c=>function Ti(P,U,O,z){const d=ia(U)??z,n=_i(P,d);return Tn(n.resolve?n.resolve(U,O):d.runInContext(()=>n(U,O)))}(P[c],U,O,z).pipe(xn(),ke(m=>{n[c]=m}))),_t(1),function Mn(P){return(0,Ge.U)(()=>P)}(n),Oe(c=>us(c)?me.E:De(c)))}(n,P,U,z).pipe((0,Ge.U)(c=>(P._resolvedData=c,P.data=Bs(P,P.parent,O).resolve,null)))}(b,z,P,U):(b.data=Bs(b,b.parent,P).resolve,(0,a.of)(void 0))),ke(()=>v++),_t(1),(0,Se.z)(b=>v===m.length?(0,a.of)(O):me.E))})}function xt(P){const U=P.children.map(O=>xt(O)).flat();return[P,...U]}function Ur(P){return(0,lt.w)(U=>{const O=P(U);return O?(0,X.D)(O).pipe((0,Ge.U)(()=>U)):(0,a.of)(U)})}let Lr=(()=>{class P{buildTitle(O){let z,d=O.root;for(;void 0!==d;)z=this.getResolvedTitleForRoute(d)??z,d=d.children.find(n=>n.outlet===Ie);return z}getResolvedTitleForRoute(O){return O.data[Ct]}static#e=this.\u0275fac=function(z){return new(z||P)};static#t=this.\u0275prov=h.Yz7({token:P,factory:()=>(0,h.f3M)(Sr),providedIn:"root"})}return P})(),Sr=(()=>{class P extends Lr{constructor(O){super(),this.title=O}updateTitle(O){const z=this.buildTitle(O);void 0!==z&&this.title.setTitle(z)}static#e=this.\u0275fac=function(z){return new(z||P)(h.LFG(Dt.Dx))};static#t=this.\u0275prov=h.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})();const sr=new h.OlP("",{providedIn:"root",factory:()=>({})}),Pr=new h.OlP("ROUTES");let hr=(()=>{class P{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,h.f3M)(h.Sil)}loadComponent(O){if(this.componentLoaders.get(O))return this.componentLoaders.get(O);if(O._loadedComponent)return(0,a.of)(O._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(O);const z=Tn(O.loadComponent()).pipe((0,Ge.U)(qo),ke(n=>{this.onLoadEndListener&&this.onLoadEndListener(O),O._loadedComponent=n}),(0,fn.x)(()=>{this.componentLoaders.delete(O)})),d=new Be(z,()=>new Ne.x).pipe(Pe());return this.componentLoaders.set(O,d),d}loadChildren(O,z){if(this.childrenLoaders.get(z))return this.childrenLoaders.get(z);if(z._loadedRoutes)return(0,a.of)({routes:z._loadedRoutes,injector:z._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(z);const n=function So(P,U,O,z){return Tn(P.loadChildren()).pipe((0,Ge.U)(qo),(0,Se.z)(d=>d instanceof h.YKP||Array.isArray(d)?(0,a.of)(d):(0,X.D)(U.compileModuleAsync(d))),(0,Ge.U)(d=>{z&&z(P);let n,c,m=!1;return Array.isArray(d)?(c=d,!0):(n=d.create(O).injector,c=n.get(Pr,[],{optional:!0,self:!0}).flat()),{routes:c.map(js),injector:n}}))}(z,this.compiler,O,this.onLoadEndListener).pipe((0,fn.x)(()=>{this.childrenLoaders.delete(z)})),c=new Be(n,()=>new Ne.x).pipe(Pe());return this.childrenLoaders.set(z,c),c}static#e=this.\u0275fac=function(z){return new(z||P)};static#t=this.\u0275prov=h.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})();function qo(P){return function $s(P){return P&&"object"==typeof P&&"default"in P}(P)?P.default:P}let hs=(()=>{class P{static#e=this.\u0275fac=function(z){return new(z||P)};static#t=this.\u0275prov=h.Yz7({token:P,factory:()=>(0,h.f3M)($o),providedIn:"root"})}return P})(),$o=(()=>{class P{shouldProcessUrl(O){return!0}extract(O){return O}merge(O,z){return O}static#e=this.\u0275fac=function(z){return new(z||P)};static#t=this.\u0275prov=h.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})();const fs=new h.OlP(""),Yo=new h.OlP("");function Zs(P,U,O){const z=P.get(Yo),d=P.get(Ae.K0);return P.get(h.R0b).runOutsideAngular(()=>{if(!d.startViewTransition||z.skipNextTransition)return z.skipNextTransition=!1,Promise.resolve();let n;const c=new Promise(b=>{n=b}),m=d.startViewTransition(()=>(n(),function el(P){return new Promise(U=>{(0,h.T8G)(U,{injector:P})})}(P))),{onViewTransitionCreated:v}=z;return v&&(0,h.r_H)(P,()=>v({transition:m,from:U,to:O})),c})}let fi=(()=>{class P{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Ne.x,this.transitionAbortSubject=new Ne.x,this.configLoader=(0,h.f3M)(hr),this.environmentInjector=(0,h.f3M)(h.lqb),this.urlSerializer=(0,h.f3M)(tt),this.rootContexts=(0,h.f3M)(H),this.location=(0,h.f3M)(Ae.Ye),this.inputBindingEnabled=null!==(0,h.f3M)(fo,{optional:!0}),this.titleStrategy=(0,h.f3M)(Lr),this.options=(0,h.f3M)(sr,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=(0,h.f3M)(hs),this.createViewTransition=(0,h.f3M)(fs,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>(0,a.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=d=>this.events.next(new $n(d)),this.configLoader.onLoadStartListener=d=>this.events.next(new Fn(d))}complete(){this.transitions?.complete()}handleNavigationRequest(O){const z=++this.navigationId;this.transitions?.next({...this.transitions.value,...O,id:z})}setupNavigations(O,z,d){return this.transitions=new j.X({id:0,currentUrlTree:z,currentRawUrl:z,extractedUrl:this.urlHandlingStrategy.extract(z),urlAfterRedirects:this.urlHandlingStrategy.extract(z),rawUrl:z,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Lt,restoredState:null,currentSnapshot:d.snapshot,targetSnapshot:null,currentRouterState:d,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,je.h)(n=>0!==n.id),(0,Ge.U)(n=>({...n,extractedUrl:this.urlHandlingStrategy.extract(n.rawUrl)})),(0,lt.w)(n=>{this.currentTransition=n;let c=!1,m=!1;return(0,a.of)(n).pipe(ke(v=>{this.currentNavigation={id:v.id,initialUrl:v.rawUrl,extractedUrl:v.extractedUrl,trigger:v.source,extras:v.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,lt.w)(v=>{const b=!O.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!b&&"reload"!==(v.extras.onSameUrlNavigation??O.onSameUrlNavigation)){const M="";return this.events.next(new Xi(v.id,this.urlSerializer.serialize(v.rawUrl),M,0)),v.resolve(null),me.E}if(this.urlHandlingStrategy.shouldProcessUrl(v.rawUrl))return(0,a.of)(v).pipe((0,lt.w)(M=>{const N=this.transitions?.getValue();return this.events.next(new ti(M.id,this.urlSerializer.serialize(M.extractedUrl),M.source,M.restoredState)),N!==this.transitions?.getValue()?me.E:Promise.resolve(M)}),function q(P,U,O,z,d,n){return(0,Se.z)(c=>function Ds(P,U,O,z,d,n,c="emptyOnly"){return new yl(P,U,O,z,d,c,n).recognize()}(P,U,O,z,c.extractedUrl,d,n).pipe((0,Ge.U)(({state:m,tree:v})=>({...c,targetSnapshot:m,urlAfterRedirects:v}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,O.config,this.urlSerializer,this.paramsInheritanceStrategy),ke(M=>{n.targetSnapshot=M.targetSnapshot,n.urlAfterRedirects=M.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:M.urlAfterRedirects};const N=new be(M.id,this.urlSerializer.serialize(M.extractedUrl),this.urlSerializer.serialize(M.urlAfterRedirects),M.targetSnapshot);this.events.next(N)}));if(b&&this.urlHandlingStrategy.shouldProcessUrl(v.currentRawUrl)){const{id:M,extractedUrl:N,source:Z,restoredState:$,extras:re}=v,Re=new ti(M,this.urlSerializer.serialize(N),Z,$);this.events.next(Re);const Fe=Mo(0,this.rootComponentType).snapshot;return this.currentTransition=n={...v,targetSnapshot:Fe,urlAfterRedirects:N,extras:{...re,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=N,(0,a.of)(n)}{const M="";return this.events.next(new Xi(v.id,this.urlSerializer.serialize(v.extractedUrl),M,1)),v.resolve(null),me.E}}),ke(v=>{const b=new ft(v.id,this.urlSerializer.serialize(v.extractedUrl),this.urlSerializer.serialize(v.urlAfterRedirects),v.targetSnapshot);this.events.next(b)}),(0,Ge.U)(v=>(this.currentTransition=n={...v,guards:Ya(v.targetSnapshot,v.currentSnapshot,this.rootContexts)},n)),function ra(P,U){return(0,Se.z)(O=>{const{targetSnapshot:z,currentSnapshot:d,guards:{canActivateChecks:n,canDeactivateChecks:c}}=O;return 0===c.length&&0===n.length?(0,a.of)({...O,guardsResult:!0}):function Ar(P,U,O,z){return(0,X.D)(P).pipe((0,Se.z)(d=>function ds(P,U,O,z,d){const n=U&&U.routeConfig?U.routeConfig.canDeactivate:null;if(!n||0===n.length)return(0,a.of)(!0);const c=n.map(m=>{const v=ia(U)??d,b=_i(m,v);return Tn(function wr(P){return P&&W(P.canDeactivate)}(b)?b.canDeactivate(P,U,O,z):v.runInContext(()=>b(P,U,O,z))).pipe(xn())});return(0,a.of)(c).pipe(Ho())}(d.component,d.route,O,U,z)),xn(d=>!0!==d,!0))}(c,z,d,P).pipe((0,Se.z)(m=>m&&function He(P){return"boolean"==typeof P}(m)?function Vo(P,U,O,z){return(0,X.D)(U).pipe((0,$t.b)(d=>(0,_e.z)(function Yi(P,U){return null!==P&&U&&U(new Un(P)),(0,a.of)(!0)}(d.route.parent,z),function Cs(P,U){return null!==P&&U&&U(new ci(P)),(0,a.of)(!0)}(d.route,z),function Pa(P,U,O){const z=U[U.length-1],n=U.slice(0,U.length-1).reverse().map(c=>function pl(P){const U=P.routeConfig?P.routeConfig.canActivateChild:null;return U&&0!==U.length?{node:P,guards:U}:null}(c)).filter(c=>null!==c).map(c=>(0,Le.P)(()=>{const m=c.guards.map(v=>{const b=ia(c.node)??O,I=_i(v,b);return Tn(function dr(P){return P&&W(P.canActivateChild)}(I)?I.canActivateChild(z,P):b.runInContext(()=>I(z,P))).pipe(xn())});return(0,a.of)(m).pipe(Ho())}));return(0,a.of)(n).pipe(Ho())}(P,d.path,O),function Qo(P,U,O){const z=U.routeConfig?U.routeConfig.canActivate:null;if(!z||0===z.length)return(0,a.of)(!0);const d=z.map(n=>(0,Le.P)(()=>{const c=ia(U)??O,m=_i(n,c);return Tn(function vi(P){return P&&W(P.canActivate)}(m)?m.canActivate(U,P):c.runInContext(()=>m(U,P))).pipe(xn())}));return(0,a.of)(d).pipe(Ho())}(P,d.route,O))),xn(d=>!0!==d,!0))}(z,n,P,U):(0,a.of)(m)),(0,Ge.U)(m=>({...O,guardsResult:m})))})}(this.environmentInjector,v=>this.events.next(v)),ke(v=>{if(n.guardsResult=v.guardsResult,ao(v.guardsResult))throw na(0,v.guardsResult);const b=new mt(v.id,this.urlSerializer.serialize(v.extractedUrl),this.urlSerializer.serialize(v.urlAfterRedirects),v.targetSnapshot,!!v.guardsResult);this.events.next(b)}),(0,je.h)(v=>!!v.guardsResult||(this.cancelNavigationTransition(v,"",3),!1)),Ur(v=>{if(v.guards.canActivateChecks.length)return(0,a.of)(v).pipe(ke(b=>{const I=new yn(b.id,this.urlSerializer.serialize(b.extractedUrl),this.urlSerializer.serialize(b.urlAfterRedirects),b.targetSnapshot);this.events.next(I)}),(0,lt.w)(b=>{let I=!1;return(0,a.of)(b).pipe(fe(this.paramsInheritanceStrategy,this.environmentInjector),ke({next:()=>I=!0,complete:()=>{I||this.cancelNavigationTransition(b,"",2)}}))}),ke(b=>{const I=new jt(b.id,this.urlSerializer.serialize(b.extractedUrl),this.urlSerializer.serialize(b.urlAfterRedirects),b.targetSnapshot);this.events.next(I)}))}),Ur(v=>{const b=I=>{const M=[];I.routeConfig?.loadComponent&&!I.routeConfig._loadedComponent&&M.push(this.configLoader.loadComponent(I.routeConfig).pipe(ke(N=>{I.component=N}),(0,Ge.U)(()=>{})));for(const N of I.children)M.push(...b(N));return M};return(0,K.a)(b(v.targetSnapshot.root)).pipe(Ve(),(0,ne.q)(1))}),Ur(()=>this.afterPreactivation()),(0,lt.w)(()=>{const{currentSnapshot:v,targetSnapshot:b}=n,I=this.createViewTransition?.(this.environmentInjector,v.root,b.root);return I?(0,X.D)(I).pipe((0,Ge.U)(()=>n)):(0,a.of)(n)}),(0,Ge.U)(v=>{const b=function mr(P,U,O){const z=Lo(P,U._root,O?O._root:void 0);return new Ko(z,U)}(O.routeReuseStrategy,v.targetSnapshot,v.currentRouterState);return this.currentTransition=n={...v,targetRouterState:b},this.currentNavigation.targetRouterState=b,n}),ke(()=>{this.events.next(new or)}),((P,U,O,z)=>(0,Ge.U)(d=>(new Rl(U,d.targetRouterState,d.currentRouterState,O,z).activate(P),d)))(this.rootContexts,O.routeReuseStrategy,v=>this.events.next(v),this.inputBindingEnabled),(0,ne.q)(1),ke({next:v=>{c=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new di(v.id,this.urlSerializer.serialize(v.extractedUrl),this.urlSerializer.serialize(v.urlAfterRedirects))),this.titleStrategy?.updateTitle(v.targetRouterState.snapshot),v.resolve(!0)},complete:()=>{c=!0}}),function li(P){return(0,Ce.e)((U,O)=>{(0,pe.Xf)(P).subscribe((0,de.x)(O,()=>O.complete(),qn.Z)),!O.closed&&U.subscribe(O)})}(this.transitionAbortSubject.pipe(ke(v=>{throw v}))),(0,fn.x)(()=>{c||m||this.cancelNavigationTransition(n,"",1),this.currentNavigation?.id===n.id&&(this.currentNavigation=null)}),Oe(v=>{if(m=!0,fl(v))this.events.next(new Kn(n.id,this.urlSerializer.serialize(n.extractedUrl),v.message,v.cancellationCode)),function Za(P){return fl(P)&&ao(P.url)}(v)?this.events.next(new ur(v.url)):n.resolve(!1);else{this.events.next(new J(n.id,this.urlSerializer.serialize(n.extractedUrl),v,n.targetSnapshot??void 0));try{n.resolve(O.errorHandler(v))}catch(b){n.reject(b)}}return me.E}))}))}cancelNavigationTransition(O,z,d){const n=new Kn(O.id,this.urlSerializer.serialize(O.extractedUrl),z,d);this.events.next(n),O.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}static#e=this.\u0275fac=function(z){return new(z||P)};static#t=this.\u0275prov=h.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})();function Gs(P){return P!==Lt}let wc=(()=>{class P{static#e=this.\u0275fac=function(z){return new(z||P)};static#t=this.\u0275prov=h.Yz7({token:P,factory:()=>(0,h.f3M)(vl),providedIn:"root"})}return P})();class nc{shouldDetach(U){return!1}store(U,O){}shouldAttach(U){return!1}retrieve(U){return null}shouldReuseRoute(U,O){return U.routeConfig===O.routeConfig}}let vl=(()=>{class P extends nc{static#e=this.\u0275fac=(()=>{let O;return function(d){return(O||(O=h.n5z(P)))(d||P)}})();static#t=this.\u0275prov=h.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})(),Fo=(()=>{class P{static#e=this.\u0275fac=function(z){return new(z||P)};static#t=this.\u0275prov=h.Yz7({token:P,factory:()=>(0,h.f3M)(ps),providedIn:"root"})}return P})(),ps=(()=>{class P extends Fo{constructor(){super(...arguments),this.location=(0,h.f3M)(Ae.Ye),this.urlSerializer=(0,h.f3M)(tt),this.options=(0,h.f3M)(sr,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=(0,h.f3M)(hs),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new sn,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=Mo(0,null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(O){return this.location.subscribe(z=>{"popstate"===z.type&&O(z.url,z.state)})}handleRouterEvent(O,z){if(O instanceof ti)this.stateMemento=this.createStateMemento();else if(O instanceof Xi)this.rawUrlTree=z.initialUrl;else if(O instanceof be){if("eager"===this.urlUpdateStrategy&&!z.extras.skipLocationChange){const d=this.urlHandlingStrategy.merge(z.finalUrl,z.initialUrl);this.setBrowserUrl(d,z)}}else O instanceof or?(this.currentUrlTree=z.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(z.finalUrl,z.initialUrl),this.routerState=z.targetRouterState,"deferred"===this.urlUpdateStrategy&&(z.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,z))):O instanceof Kn&&(3===O.code||2===O.code)?this.restoreHistory(z):O instanceof J?this.restoreHistory(z,!0):O instanceof di&&(this.lastSuccessfulId=O.id,this.currentPageId=this.browserPageId)}setBrowserUrl(O,z){const d=this.urlSerializer.serialize(O);if(this.location.isCurrentPathEqualTo(d)||z.extras.replaceUrl){const c={...z.extras.state,...this.generateNgRouterState(z.id,this.browserPageId)};this.location.replaceState(d,"",c)}else{const n={...z.extras.state,...this.generateNgRouterState(z.id,this.browserPageId+1)};this.location.go(d,"",n)}}restoreHistory(O,z=!1){if("computed"===this.canceledNavigationResolution){const n=this.currentPageId-this.browserPageId;0!==n?this.location.historyGo(n):this.currentUrlTree===O.finalUrl&&0===n&&(this.resetState(O),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(z&&this.resetState(O),this.resetUrlToCurrentUrlTree())}resetState(O){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,O.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(O,z){return"computed"===this.canceledNavigationResolution?{navigationId:O,\u0275routerPageId:z}:{navigationId:O}}static#e=this.\u0275fac=(()=>{let O;return function(d){return(O||(O=h.n5z(P)))(d||P)}})();static#t=this.\u0275prov=h.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})();var Oa=function(P){return P[P.COMPLETE=0]="COMPLETE",P[P.FAILED=1]="FAILED",P[P.REDIRECTING=2]="REDIRECTING",P}(Oa||{});function ic(P,U){P.events.pipe((0,je.h)(O=>O instanceof di||O instanceof Kn||O instanceof J||O instanceof Xi),(0,Ge.U)(O=>O instanceof di||O instanceof Xi?Oa.COMPLETE:O instanceof Kn&&(0===O.code||1===O.code)?Oa.REDIRECTING:Oa.FAILED),(0,je.h)(O=>O!==Oa.REDIRECTING),(0,ne.q)(1)).subscribe(()=>{U()})}function jr(P){throw P}const Cc={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},tl={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Nr=(()=>{class P{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=(0,h.f3M)(h.c2e),this.stateManager=(0,h.f3M)(Fo),this.options=(0,h.f3M)(sr,{optional:!0})||{},this.pendingTasks=(0,h.f3M)(h.HDt),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=(0,h.f3M)(fi),this.urlSerializer=(0,h.f3M)(tt),this.location=(0,h.f3M)(Ae.Ye),this.urlHandlingStrategy=(0,h.f3M)(hs),this._events=new Ne.x,this.errorHandler=this.options.errorHandler||jr,this.navigated=!1,this.routeReuseStrategy=(0,h.f3M)(wc),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=(0,h.f3M)(Pr,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!(0,h.f3M)(fo,{optional:!0}),this.eventsSubscription=new Ye.w0,this.isNgZoneEnabled=(0,h.f3M)(h.R0b)instanceof h.R0b&&h.R0b.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:O=>{this.console.warn(O)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const O=this.navigationTransitions.events.subscribe(z=>{try{const d=this.navigationTransitions.currentTransition,n=this.navigationTransitions.currentNavigation;if(null!==d&&null!==n)if(this.stateManager.handleRouterEvent(z,n),z instanceof Kn&&0!==z.code&&1!==z.code)this.navigated=!0;else if(z instanceof di)this.navigated=!0;else if(z instanceof ur){const c=this.urlHandlingStrategy.merge(z.url,d.currentRawUrl),m={skipLocationChange:d.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Gs(d.source)};this.scheduleNavigation(c,Lt,null,m,{resolve:d.resolve,reject:d.reject,promise:d.promise})}(function rc(P){return!(P instanceof or||P instanceof ur)})(z)&&this._events.next(z)}catch(d){this.navigationTransitions.transitionAbortSubject.next(d)}});this.eventsSubscription.add(O)}resetRootComponentType(O){this.routerState.root.component=O,this.navigationTransitions.rootComponentType=O}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Lt,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription||(this.nonRouterCurrentEntryChangeSubscription=this.stateManager.registerNonRouterCurrentEntryChangeListener((O,z)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(O,"popstate",z)},0)}))}navigateToSyncWithBrowser(O,z,d){const n={replaceUrl:!0},c=d?.navigationId?d:null;if(d){const v={...d};delete v.navigationId,delete v.\u0275routerPageId,0!==Object.keys(v).length&&(n.state=v)}const m=this.parseUrl(O);this.scheduleNavigation(m,z,c,n)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(O){this.config=O.map(js),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(O,z={}){const{relativeTo:d,queryParams:n,fragment:c,queryParamsHandling:m,preserveFragment:v}=z,b=v?this.currentUrlTree.fragment:c;let M,I=null;switch(m){case"merge":I={...this.currentUrlTree.queryParams,...n};break;case"preserve":I=this.currentUrlTree.queryParams;break;default:I=n||null}null!==I&&(I=this.removeEmptyProps(I));try{M=xo(d?d.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof O[0]||!O[0].startsWith("/"))&&(O=[]),M=this.currentUrlTree.root}return qi(M,O,I,b??null)}navigateByUrl(O,z={skipLocationChange:!1}){const d=ao(O)?O:this.parseUrl(O),n=this.urlHandlingStrategy.merge(d,this.rawUrlTree);return this.scheduleNavigation(n,Lt,null,z)}navigate(O,z={skipLocationChange:!1}){return function Kc(P){for(let U=0;U<P.length;U++)if(null==P[U])throw new h.vHH(4008,!1)}(O),this.navigateByUrl(this.createUrlTree(O,z),z)}serializeUrl(O){return this.urlSerializer.serialize(O)}parseUrl(O){try{return this.urlSerializer.parse(O)}catch{return this.urlSerializer.parse("/")}}isActive(O,z){let d;if(d=!0===z?{...Cc}:!1===z?{...tl}:z,ao(O))return Oi(this.currentUrlTree,O,d);const n=this.parseUrl(O);return Oi(this.currentUrlTree,n,d)}removeEmptyProps(O){return Object.keys(O).reduce((z,d)=>{const n=O[d];return null!=n&&(z[d]=n),z},{})}scheduleNavigation(O,z,d,n,c){if(this.disposed)return Promise.resolve(!1);let m,v,b;c?(m=c.resolve,v=c.reject,b=c.promise):b=new Promise((M,N)=>{m=M,v=N});const I=this.pendingTasks.add();return ic(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(I))}),this.navigationTransitions.handleNavigationRequest({source:z,restoredState:d,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:O,extras:n,resolve:m,reject:v,promise:b,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),b.catch(M=>Promise.reject(M))}static#e=this.\u0275fac=function(z){return new(z||P)};static#t=this.\u0275prov=h.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})(),ya=(()=>{class P{constructor(O,z,d,n,c,m){this.router=O,this.route=z,this.tabIndexAttribute=d,this.renderer=n,this.el=c,this.locationStrategy=m,this.href=null,this.commands=null,this.onChanges=new Ne.x,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const v=c.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===v||"area"===v,this.isAnchorElement?this.subscription=O.events.subscribe(b=>{b instanceof di&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(O){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",O)}ngOnChanges(O){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(O){null!=O?(this.commands=Array.isArray(O)?O:[O],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(O,z,d,n,c){return!!(null===this.urlTree||this.isAnchorElement&&(0!==O||z||d||n||c||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const O=null===this.href?null:(0,h.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",O)}applyAttributeValue(O,z){const d=this.renderer,n=this.el.nativeElement;null!==z?d.setAttribute(n,O,z):d.removeAttribute(n,O)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static#e=this.\u0275fac=function(z){return new(z||P)(h.Y36(Nr),h.Y36(cr),h.$8M("tabindex"),h.Y36(h.Qsj),h.Y36(h.SBq),h.Y36(Ae.S$))};static#t=this.\u0275dir=h.lG2({type:P,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(z,d){1&z&&h.NdJ("click",function(c){return d.onClick(c.button,c.ctrlKey,c.shiftKey,c.altKey,c.metaKey)}),2&z&&h.uIk("target",d.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",h.VuI],skipLocationChange:["skipLocationChange","skipLocationChange",h.VuI],replaceUrl:["replaceUrl","replaceUrl",h.VuI],routerLink:"routerLink"},standalone:!0,features:[h.Xq5,h.TTD]})}return P})();class kl{}let Fl=(()=>{class P{constructor(O,z,d,n,c){this.router=O,this.injector=d,this.preloadingStrategy=n,this.loader=c}setUpPreloading(){this.subscription=this.router.events.pipe((0,je.h)(O=>O instanceof di),(0,$t.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(O,z){const d=[];for(const n of z){n.providers&&!n._injector&&(n._injector=(0,h.MMx)(n.providers,O,`Route: ${n.path}`));const c=n._injector??O,m=n._loadedInjector??c;(n.loadChildren&&!n._loadedRoutes&&void 0===n.canLoad||n.loadComponent&&!n._loadedComponent)&&d.push(this.preloadConfig(c,n)),(n.children||n._loadedRoutes)&&d.push(this.processRoutes(m,n.children??n._loadedRoutes))}return(0,X.D)(d).pipe((0,en.J)())}preloadConfig(O,z){return this.preloadingStrategy.preload(z,()=>{let d;d=z.loadChildren&&void 0===z.canLoad?this.loader.loadChildren(O,z):(0,a.of)(null);const n=d.pipe((0,Se.z)(c=>null===c?(0,a.of)(void 0):(z._loadedRoutes=c.routes,z._loadedInjector=c.injector,this.processRoutes(c.injector??O,c.routes))));if(z.loadComponent&&!z._loadedComponent){const c=this.loader.loadComponent(z);return(0,X.D)([n,c]).pipe((0,en.J)())}return n})}static#e=this.\u0275fac=function(z){return new(z||P)(h.LFG(Nr),h.LFG(h.Sil),h.LFG(h.lqb),h.LFG(kl),h.LFG(hr))};static#t=this.\u0275prov=h.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})();const xl=new h.OlP("");let oc=(()=>{class P{constructor(O,z,d,n,c={}){this.urlSerializer=O,this.transitions=z,this.viewportScroller=d,this.zone=n,this.options=c,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},c.scrollPositionRestoration=c.scrollPositionRestoration||"disabled",c.anchorScrolling=c.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(O=>{O instanceof ti?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=O.navigationTrigger,this.restoredId=O.restoredState?O.restoredState.navigationId:0):O instanceof di?(this.lastId=O.id,this.scheduleScrollEvent(O,this.urlSerializer.parse(O.urlAfterRedirects).fragment)):O instanceof Xi&&0===O.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(O,this.urlSerializer.parse(O.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(O=>{O instanceof Gi&&(O.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(O.position):O.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(O.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(O,z){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Gi(O,"popstate"===this.lastSource?this.store[this.restoredId]:null,z))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(z){h.$Z()};static#t=this.\u0275prov=h.Yz7({token:P,factory:P.\u0275fac})}return P})();function ms(P,U){return{\u0275kind:P,\u0275providers:U}}function Qc(){const P=(0,h.f3M)(h.zs3);return U=>{const O=P.get(h.z2F);if(U!==O.components[0])return;const z=P.get(Nr),d=P.get(Ec);1===P.get(Tc)&&z.initialNavigation(),P.get(tu,null,h.XFs.Optional)?.setUpPreloading(),P.get(xl,null,h.XFs.Optional)?.init(),z.resetRootComponentType(O.componentTypes[0]),d.closed||(d.next(),d.complete(),d.unsubscribe())}}const Ec=new h.OlP("",{factory:()=>new Ne.x}),Tc=new h.OlP("",{providedIn:"root",factory:()=>1}),tu=new h.OlP("");function Td(P){return ms(0,[{provide:tu,useExisting:Fl},{provide:kl,useExisting:P}])}function Ws(P){return ms(9,[{provide:fs,useValue:Zs},{provide:Yo,useValue:{skipNextTransition:!!P?.skipInitialTransition,...P}}])}const Er=new h.OlP("ROUTER_FORROOT_GUARD"),sc=[Ae.Ye,{provide:tt,useClass:yt},Nr,H,{provide:cr,useFactory:function bl(P){return P.routerState.root},deps:[Nr]},hr,[]];let yi=(()=>{class P{constructor(O){}static forRoot(O,z){return{ngModule:P,providers:[sc,[],{provide:Pr,multi:!0,useValue:O},{provide:Er,useFactory:wl,deps:[[Nr,new h.FiY,new h.tp0]]},{provide:sr,useValue:z||{}},z?.useHash?{provide:Ae.S$,useClass:Ae.Do}:{provide:Ae.S$,useClass:Ae.b0},{provide:xl,useFactory:()=>{const P=(0,h.f3M)(Ae.EM),U=(0,h.f3M)(h.R0b),O=(0,h.f3M)(sr),z=(0,h.f3M)(fi),d=(0,h.f3M)(tt);return O.scrollOffset&&P.setOffset(O.scrollOffset),new oc(d,z,P,U,O)}},z?.preloadingStrategy?Td(z.preloadingStrategy).\u0275providers:[],z?.initialNavigation?pi(z):[],z?.bindToComponentInputs?ms(8,[po,{provide:fo,useExisting:po}]).\u0275providers:[],z?.enableViewTransitions?Ws().\u0275providers:[],[{provide:lc,useFactory:Qc},{provide:h.tb,multi:!0,useExisting:lc}]]}}static forChild(O){return{ngModule:P,providers:[{provide:Pr,multi:!0,useValue:O}]}}static#e=this.\u0275fac=function(z){return new(z||P)(h.LFG(Er,8))};static#t=this.\u0275mod=h.oAB({type:P});static#n=this.\u0275inj=h.cJS({})}return P})();function wl(P){return"guarded"}function pi(P){return["disabled"===P.initialNavigation?ms(3,[{provide:h.ip1,multi:!0,useFactory:()=>{const U=(0,h.f3M)(Nr);return()=>{U.setUpLocationChangeListener()}}},{provide:Tc,useValue:2}]).\u0275providers:[],"enabledBlocking"===P.initialNavigation?ms(2,[{provide:Tc,useValue:0},{provide:h.ip1,multi:!0,deps:[h.zs3],useFactory:U=>{const O=U.get(Ae.V_,Promise.resolve());return()=>O.then(()=>new Promise(z=>{const d=U.get(Nr),n=U.get(Ec);ic(d,()=>{z(!0)}),U.get(fi).afterPreactivation=()=>(z(!0),n.closed?(0,a.of)(void 0):n),d.initialNavigation()}))}}]).\u0275providers:[]]}const lc=new h.OlP("")},703:(zn,wt,S)=>{"use strict";S.d(wt,{Ar:()=>Te,N0:()=>_e});var h=S(8564),p=S(6814),X=S(7398),a=S(1631),j=S(4911),K=S(2096),C=S(9862);const oe=new h.OlP("JWT_OPTIONS");let _e=(()=>{class ye{constructor(me=null){this.tokenGetter=me&&me.tokenGetter||function(){}}urlBase64Decode(me){let Ye=me.replace(/-/g,"+").replace(/_/g,"/");switch(Ye.length%4){case 0:break;case 2:Ye+="==";break;case 3:Ye+="=";break;default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(Ye)}b64decode(me){let Ce="";if((me=String(me).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let Pe,Be,de=0,Ne=0;Be=me.charAt(Ne++);~Be&&(Pe=de%4?64*Pe+Be:Be,de++%4)?Ce+=String.fromCharCode(255&Pe>>(-2*de&6)):0)Be="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(Be);return Ce}b64DecodeUnicode(me){return decodeURIComponent(Array.prototype.map.call(this.b64decode(me),Ye=>"%"+("00"+Ye.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(me=this.tokenGetter()){return me instanceof Promise?me.then(Ye=>this._decodeToken(Ye)):this._decodeToken(me)}_decodeToken(me){if(!me||""===me)return null;const Ye=me.split(".");if(3!==Ye.length)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");const Ce=this.urlBase64Decode(Ye[1]);if(!Ce)throw new Error("Cannot decode the token.");return JSON.parse(Ce)}getTokenExpirationDate(me=this.tokenGetter()){return me instanceof Promise?me.then(Ye=>this._getTokenExpirationDate(Ye)):this._getTokenExpirationDate(me)}_getTokenExpirationDate(me){let Ye;if(Ye=this.decodeToken(me),!Ye||!Ye.hasOwnProperty("exp"))return null;const Ce=new Date(0);return Ce.setUTCSeconds(Ye.exp),Ce}isTokenExpired(me=this.tokenGetter(),Ye){return me instanceof Promise?me.then(Ce=>this._isTokenExpired(Ce,Ye)):this._isTokenExpired(me,Ye)}_isTokenExpired(me,Ye){if(!me||""===me)return!0;const Ce=this.getTokenExpirationDate(me);return Ye=Ye||0,null!==Ce&&!(Ce.valueOf()>(new Date).valueOf()+1e3*Ye)}getAuthScheme(me,Ye){return"function"==typeof me?me(Ye):me}}return ye.\u0275fac=function(me){return new(me||ye)(h.LFG(oe))},ye.\u0275prov=h.Yz7({token:ye,factory:ye.\u0275fac}),ye})();const Le=ye=>ye instanceof Promise?(0,j.P)(()=>ye):(0,K.of)(ye);let ee=(()=>{class ye{constructor(me,Ye,Ce){this.jwtHelper=Ye,this.document=Ce,this.standardPorts=["80","443"],this.tokenGetter=me.tokenGetter,this.headerName=me.headerName||"Authorization",this.authScheme=me.authScheme||""===me.authScheme?me.authScheme:"Bearer ",this.allowedDomains=me.allowedDomains||[],this.disallowedRoutes=me.disallowedRoutes||[],this.throwNoTokenError=me.throwNoTokenError||!1,this.skipWhenExpired=me.skipWhenExpired}isAllowedDomain(me){const Ye=new URL(me.url,this.document.location.origin);if(Ye.host===this.document.location.host)return!0;const Ce=`${Ye.hostname}${Ye.port&&!this.standardPorts.includes(Ye.port)?":"+Ye.port:""}`;return this.allowedDomains.findIndex(de=>"string"==typeof de?de===Ce:de instanceof RegExp&&de.test(Ce))>-1}isDisallowedRoute(me){const Ye=new URL(me.url,this.document.location.origin);return this.disallowedRoutes.findIndex(Ce=>{if("string"==typeof Ce){const de=new URL(Ce,this.document.location.origin);return de.hostname===Ye.hostname&&de.pathname===Ye.pathname}return Ce instanceof RegExp&&Ce.test(me.url)})>-1}handleInterception(me,Ye,Ce){const de=this.jwtHelper.getAuthScheme(this.authScheme,Ye);if(!me&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");let Pe=(0,K.of)(!1);return this.skipWhenExpired&&(Pe=me?Le(this.jwtHelper.isTokenExpired(me)):(0,K.of)(!0)),me?Pe.pipe((0,X.U)(Be=>Be&&this.skipWhenExpired?Ye.clone():Ye.clone({setHeaders:{[this.headerName]:`${de}${me}`}})),(0,a.z)(Be=>Ce.handle(Be))):Ce.handle(Ye)}intercept(me,Ye){if(!this.isAllowedDomain(me)||this.isDisallowedRoute(me))return Ye.handle(me);const Ce=this.tokenGetter(me);return Le(Ce).pipe((0,a.z)(de=>this.handleInterception(de,me,Ye)))}}return ye.\u0275fac=function(me){return new(me||ye)(h.LFG(oe),h.LFG(_e),h.LFG(p.K0))},ye.\u0275prov=h.Yz7({token:ye,factory:ye.\u0275fac}),ye})(),Te=(()=>{class ye{constructor(me){if(me)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(me){return{ngModule:ye,providers:[{provide:C.TP,useClass:ee,multi:!0},me.jwtOptionsProvider||{provide:oe,useValue:me.config},_e]}}}return ye.\u0275fac=function(me){return new(me||ye)(h.LFG(ye,12))},ye.\u0275mod=h.oAB({type:ye}),ye.\u0275inj=h.cJS({}),ye})()},5472:(zn,wt,S)=>{"use strict";S.d(wt,{y4:()=>Wi,De:()=>xi,dy:()=>Oi,oU:()=>Ro,ki:()=>Bn,O1:()=>Yt,d8:()=>Vt,jP:()=>Ui,UN:()=>Tt,r4:()=>Wn,SH:()=>Nt,X1:()=>ki,xs:()=>lr,t4:()=>Ut,j:()=>xo,H:()=>qi,bk:()=>Qt,DN:()=>Io,Wn:()=>Mt,vk:()=>wn});var h=S(5861),p=S(8564),X=S(6800),a=S(6814);class j{constructor(){this.m=new Map}reset(rt){this.m=new Map(Object.entries(rt))}get(rt,we){const ut=this.m.get(rt);return void 0!==ut?ut:we}getBoolean(rt,we=!1){const ut=this.m.get(rt);return void 0===ut?we:"string"==typeof ut?"true"===ut:!!ut}getNumber(rt,we){const ut=parseFloat(this.m.get(rt));return isNaN(ut)?void 0!==we?we:NaN:ut}set(rt,we){this.m.set(rt,we)}}const K=new j,ye=Je=>me(Je),me=(Je=window)=>{if(typeof Je>"u")return[];Je.Ionic=Je.Ionic||{};let rt=Je.Ionic.platforms;return null==rt&&(rt=Je.Ionic.platforms=Ye(Je),rt.forEach(we=>Je.document.documentElement.classList.add(`plt-${we}`))),rt},Ye=Je=>{const rt=K.get("platform");return Object.keys(xn).filter(we=>{const ut=rt?.[we];return"function"==typeof ut?ut(Je):xn[we](Je)})},de=Je=>!!(Ht(Je,/iPad/i)||Ht(Je,/Macintosh/i)&&ne(Je)),Ne=Je=>Ht(Je,/android|sink/i),ne=Je=>cn(Je,"(any-pointer:coarse)"),xe=Je=>je(Je)||Se(Je),je=Je=>!!(Je.cordova||Je.phonegap||Je.PhoneGap),Se=Je=>{const rt=Je.Capacitor;return!!rt?.isNative},Ht=(Je,rt)=>rt.test(Je.navigator.userAgent),cn=(Je,rt)=>{var we;return null===(we=Je.matchMedia)||void 0===we?void 0:we.call(Je,rt).matches},xn={ipad:de,iphone:Je=>Ht(Je,/iPhone/i),ios:Je=>Ht(Je,/iPhone|iPod/i)||de(Je),android:Ne,phablet:Je=>{const rt=Je.innerWidth,we=Je.innerHeight,ut=Math.min(rt,we),dt=Math.max(rt,we);return ut>390&&ut<520&&dt>620&&dt<800},tablet:Je=>{const rt=Je.innerWidth,we=Je.innerHeight,ut=Math.min(rt,we),dt=Math.max(rt,we);return de(Je)||(Je=>Ne(Je)&&!Ht(Je,/mobile/i))(Je)||ut>460&&ut<820&&dt>780&&dt<1400},cordova:je,capacitor:Se,electron:Je=>Ht(Je,/electron/i),pwa:Je=>{var rt;return!!(null!==(rt=Je.matchMedia)&&void 0!==rt&&rt.call(Je,"(display-mode: standalone)").matches||Je.navigator.standalone)},mobile:ne,mobileweb:Je=>ne(Je)&&!xe(Je),desktop:Je=>!ne(Je),hybrid:xe};var Oe=S(191),ie=S(3630),it=S(8645),_t=S(2438),Kt=S(5619),Mn=S(2572),fn=S(2096),qn=S(7582),li=S(2181),en=S(4664),Dt=S(3997),Ie=S(6223);const Ct=["tabsInner"];let Ut=(()=>{class Je{constructor(we,ut){this.doc=we,this.backButton=new it.x,this.keyboardDidShow=new it.x,this.keyboardDidHide=new it.x,this.pause=new it.x,this.resume=new it.x,this.resize=new it.x,ut.run(()=>{let dt;this.win=we.defaultView,this.backButton.subscribeWithPriority=function(Lt,gn){return this.subscribe(ti=>ti.register(Lt,di=>ut.run(()=>gn(di))))},qe(this.pause,we,"pause",ut),qe(this.resume,we,"resume",ut),qe(this.backButton,we,"ionBackButton",ut),qe(this.resize,this.win,"resize",ut),qe(this.keyboardDidShow,this.win,"ionKeyboardDidShow",ut),qe(this.keyboardDidHide,this.win,"ionKeyboardDidHide",ut),this._readyPromise=new Promise(Lt=>{dt=Lt}),this.win?.cordova?we.addEventListener("deviceready",()=>{dt("cordova")},{once:!0}):dt("dom")})}is(we){return((Je,rt)=>("string"==typeof Je&&(rt=Je,Je=void 0),ye(Je).includes(rt)))(this.win,we)}platforms(){return ye(this.win)}ready(){return this._readyPromise}get isRTL(){return"rtl"===this.doc.dir}getQueryParam(we){return Hn(this.win.location.href,we)}isLandscape(){return!this.isPortrait()}isPortrait(){return this.win.matchMedia?.("(orientation: portrait)").matches}testUserAgent(we){const ut=this.win.navigator;return!!(ut?.userAgent&&ut.userAgent.indexOf(we)>=0)}url(){return this.win.location.href}width(){return this.win.innerWidth}height(){return this.win.innerHeight}}return Je.\u0275fac=function(we){return new(we||Je)(p.LFG(a.K0),p.LFG(p.R0b))},Je.\u0275prov=p.Yz7({token:Je,factory:Je.\u0275fac,providedIn:"root"}),Je})();const Hn=(Je,rt)=>{rt=rt.replace(/[[\]\\]/g,"\\$&");const ut=new RegExp("[\\?&]"+rt+"=([^&#]*)").exec(Je);return ut?decodeURIComponent(ut[1].replace(/\+/g," ")):null},qe=(Je,rt,we,ut)=>{rt&&rt.addEventListener(we,dt=>{ut.run(()=>{const Lt=dt?.detail;Je.next(Lt)})})};let Nt=(()=>{class Je{constructor(we,ut,dt,Lt){this.location=ut,this.serializer=dt,this.router=Lt,this.direction=Tn,this.animated=oi,this.guessDirection="forward",this.lastNavId=-1,Lt&&Lt.events.subscribe(gn=>{if(gn instanceof X.OD){const ti=gn.restoredState?gn.restoredState.navigationId:gn.id;this.guessDirection=ti<this.lastNavId?"back":"forward",this.guessAnimation=gn.restoredState?void 0:this.guessDirection,this.lastNavId="forward"===this.guessDirection?gn.id:ti}}),we.backButton.subscribeWithPriority(0,gn=>{this.pop(),gn()})}navigateForward(we,ut={}){return this.setDirection("forward",ut.animated,ut.animationDirection,ut.animation),this.navigate(we,ut)}navigateBack(we,ut={}){return this.setDirection("back",ut.animated,ut.animationDirection,ut.animation),this.navigate(we,ut)}navigateRoot(we,ut={}){return this.setDirection("root",ut.animated,ut.animationDirection,ut.animation),this.navigate(we,ut)}back(we={animated:!0,animationDirection:"back"}){return this.setDirection("back",we.animated,we.animationDirection,we.animation),this.location.back()}pop(){var we=this;return(0,h.Z)(function*(){let ut=we.topOutlet;for(;ut;){if(yield ut.pop())return!0;ut=ut.parentOutlet}return!1})()}setDirection(we,ut,dt,Lt){this.direction=we,this.animated=Xt(we,ut,dt),this.animationBuilder=Lt}setTopOutlet(we){this.topOutlet=we}consumeTransition(){let ut,we="root";const dt=this.animationBuilder;return"auto"===this.direction?(we=this.guessDirection,ut=this.guessAnimation):(ut=this.animated,we=this.direction),this.direction=Tn,this.animated=oi,this.animationBuilder=void 0,{direction:we,animation:ut,animationBuilder:dt}}navigate(we,ut){if(Array.isArray(we))return this.router.navigate(we,ut);{const dt=this.serializer.parse(we.toString());return void 0!==ut.queryParams&&(dt.queryParams={...ut.queryParams}),void 0!==ut.fragment&&(dt.fragment=ut.fragment),this.router.navigateByUrl(dt,ut)}}}return Je.\u0275fac=function(we){return new(we||Je)(p.LFG(Ut),p.LFG(a.Ye),p.LFG(X.Hx),p.LFG(X.F0,8))},Je.\u0275prov=p.Yz7({token:Je,factory:Je.\u0275fac,providedIn:"root"}),Je})();const Xt=(Je,rt,we)=>{if(!1!==rt){if(void 0!==we)return we;if("forward"===Je||"back"===Je)return Je;if("root"===Je&&!0===rt)return"forward"}},Tn="auto",oi=void 0;let xi=(()=>{class Je{get(we,ut){const dt=gr();return dt?dt.get(we,ut):null}getBoolean(we,ut){const dt=gr();return!!dt&&dt.getBoolean(we,ut)}getNumber(we,ut){const dt=gr();return dt?dt.getNumber(we,ut):0}}return Je.\u0275fac=function(we){return new(we||Je)},Je.\u0275prov=p.Yz7({token:Je,factory:Je.\u0275fac,providedIn:"root"}),Je})();const Oi=new p.OlP("USERCONFIG"),gr=()=>{if(typeof window<"u"){const Je=window.Ionic;if(Je?.config)return Je.config}return null};class ki{constructor(rt={}){this.data=rt}get(rt){return this.data[rt]}}let Wi=(()=>{class Je{constructor(){this.zone=(0,p.f3M)(p.R0b),this.applicationRef=(0,p.f3M)(p.z2F)}create(we,ut,dt){return new _n(we,ut,this.applicationRef,this.zone,dt)}}return Je.\u0275fac=function(we){return new(we||Je)},Je.\u0275prov=p.Yz7({token:Je,factory:Je.\u0275fac}),Je})();class _n{constructor(rt,we,ut,dt,Lt){this.environmentInjector=rt,this.injector=we,this.applicationRef=ut,this.zone=dt,this.elementReferenceKey=Lt,this.elRefMap=new WeakMap,this.elEventsMap=new WeakMap}attachViewToDom(rt,we,ut,dt){return this.zone.run(()=>new Promise(Lt=>{const gn={...ut};void 0!==this.elementReferenceKey&&(gn[this.elementReferenceKey]=rt),Lt(Bi(this.zone,this.environmentInjector,this.injector,this.applicationRef,this.elRefMap,this.elEventsMap,rt,we,gn,dt,this.elementReferenceKey))}))}removeViewFromDom(rt,we){return this.zone.run(()=>new Promise(ut=>{const dt=this.elRefMap.get(we);if(dt){dt.destroy(),this.elRefMap.delete(we);const Lt=this.elEventsMap.get(we);Lt&&(Lt(),this.elEventsMap.delete(we))}ut()}))}}const Bi=(Je,rt,we,ut,dt,Lt,gn,ti,di,Kn,Xi)=>{const J=p.zs3.create({providers:$i(di),parent:we}),be=(0,p.LMc)(ti,{environmentInjector:rt,elementInjector:J}),ft=be.instance,mt=be.location.nativeElement;if(di&&(Xi&&void 0!==ft[Xi]&&console.error(`[Ionic Error]: ${Xi} is a reserved property when using ${gn.tagName.toLowerCase()}. Rename or remove the "${Xi}" property from ${ti.name}.`),Object.assign(ft,di)),Kn)for(const jt of Kn)mt.classList.add(jt);const yn=sn(Je,ft,mt);return gn.appendChild(mt),ut.attachView(be.hostView),dt.set(mt,be),Lt.set(mt,yn),mt},pn=[Oe.L,Oe.a,Oe.b,Oe.c,Oe.d],sn=(Je,rt,we)=>Je.run(()=>{const ut=pn.filter(dt=>"function"==typeof rt[dt]).map(dt=>{const Lt=gn=>rt[dt](gn.detail);return we.addEventListener(dt,Lt),()=>we.removeEventListener(dt,Lt)});return()=>ut.forEach(dt=>dt())}),Cn=new p.OlP("NavParamsToken"),$i=Je=>[{provide:Cn,useValue:Je},{provide:ki,useFactory:ct,deps:[Cn]}],ct=Je=>new ki(Je),ge=(Je,rt)=>{const we=Je.prototype;rt.forEach(ut=>{Object.defineProperty(we,ut,{get(){return this.el[ut]},set(dt){this.z.runOutsideAngular(()=>this.el[ut]=dt)}})})},se=(Je,rt)=>{const we=Je.prototype;rt.forEach(ut=>{we[ut]=function(){const dt=arguments;return this.z.runOutsideAngular(()=>this.el[ut].apply(this.el,dt))}})},tt=(Je,rt,we)=>{we.forEach(ut=>Je[ut]=(0,_t.R)(rt,ut))};function yt(Je){return function(we){const{defineCustomElementFn:ut,inputs:dt,methods:Lt}=Je;return void 0!==ut&&ut(),dt&&ge(we,dt),Lt&&se(we,Lt),we}}const Ot=["alignment","animated","arrow","keepContentsMounted","backdropDismiss","cssClass","dismissOnSelect","enterAnimation","event","isOpen","keyboardClose","leaveAnimation","mode","showBackdrop","translucent","trigger","triggerAction","reference","size","side"],Gt=["present","dismiss","onDidDismiss","onWillDismiss"];let Vt=(()=>{let Je=class{constructor(we,ut,dt){this.z=dt,this.isCmpOpen=!1,this.el=ut.nativeElement,this.el.addEventListener("ionMount",()=>{this.isCmpOpen=!0,we.detectChanges()}),this.el.addEventListener("didDismiss",()=>{this.isCmpOpen=!1,we.detectChanges()}),tt(this,this.el,["ionPopoverDidPresent","ionPopoverWillPresent","ionPopoverWillDismiss","ionPopoverDidDismiss","didPresent","willPresent","willDismiss","didDismiss"])}};return Je.\u0275fac=function(we){return new(we||Je)(p.Y36(p.sBO),p.Y36(p.SBq),p.Y36(p.R0b))},Je.\u0275dir=p.lG2({type:Je,selectors:[["ion-popover"]],contentQueries:function(we,ut,dt){if(1&we&&p.Suo(dt,p.Rgc,5),2&we){let Lt;p.iGM(Lt=p.CRH())&&(ut.template=Lt.first)}},inputs:{alignment:"alignment",animated:"animated",arrow:"arrow",keepContentsMounted:"keepContentsMounted",backdropDismiss:"backdropDismiss",cssClass:"cssClass",dismissOnSelect:"dismissOnSelect",enterAnimation:"enterAnimation",event:"event",isOpen:"isOpen",keyboardClose:"keyboardClose",leaveAnimation:"leaveAnimation",mode:"mode",showBackdrop:"showBackdrop",translucent:"translucent",trigger:"trigger",triggerAction:"triggerAction",reference:"reference",size:"size",side:"side"}}),Je=(0,qn.gn)([yt({inputs:Ot,methods:Gt})],Je),Je})();const Et=["animated","keepContentsMounted","backdropBreakpoint","backdropDismiss","breakpoints","canDismiss","cssClass","enterAnimation","event","handle","handleBehavior","initialBreakpoint","isOpen","keyboardClose","leaveAnimation","mode","presentingElement","showBackdrop","translucent","trigger"],Jt=["present","dismiss","onDidDismiss","onWillDismiss","setCurrentBreakpoint","getCurrentBreakpoint"];let Bn=(()=>{let Je=class{constructor(we,ut,dt){this.z=dt,this.isCmpOpen=!1,this.el=ut.nativeElement,this.el.addEventListener("ionMount",()=>{this.isCmpOpen=!0,we.detectChanges()}),this.el.addEventListener("didDismiss",()=>{this.isCmpOpen=!1,we.detectChanges()}),tt(this,this.el,["ionModalDidPresent","ionModalWillPresent","ionModalWillDismiss","ionModalDidDismiss","ionBreakpointDidChange","didPresent","willPresent","willDismiss","didDismiss"])}};return Je.\u0275fac=function(we){return new(we||Je)(p.Y36(p.sBO),p.Y36(p.SBq),p.Y36(p.R0b))},Je.\u0275dir=p.lG2({type:Je,selectors:[["ion-modal"]],contentQueries:function(we,ut,dt){if(1&we&&p.Suo(dt,p.Rgc,5),2&we){let Lt;p.iGM(Lt=p.CRH())&&(ut.template=Lt.first)}},inputs:{animated:"animated",keepContentsMounted:"keepContentsMounted",backdropBreakpoint:"backdropBreakpoint",backdropDismiss:"backdropDismiss",breakpoints:"breakpoints",canDismiss:"canDismiss",cssClass:"cssClass",enterAnimation:"enterAnimation",event:"event",handle:"handle",handleBehavior:"handleBehavior",initialBreakpoint:"initialBreakpoint",isOpen:"isOpen",keyboardClose:"keyboardClose",leaveAnimation:"leaveAnimation",mode:"mode",presentingElement:"presentingElement",showBackdrop:"showBackdrop",translucent:"translucent",trigger:"trigger"}}),Je=(0,qn.gn)([yt({inputs:Et,methods:Jt})],Je),Je})();const ae=(Je,rt)=>((Je=Je.filter(we=>we.stackId!==rt.stackId)).push(rt),Je),ze=(Je,rt)=>{const we=Je.createUrlTree(["."],{relativeTo:rt});return Je.serializeUrl(we)},at=(Je,rt)=>!rt||Je.stackId!==rt.stackId,rn=(Je,rt)=>{if(!Je)return;const we=Dn(rt);for(let ut=0;ut<we.length;ut++){if(ut>=Je.length)return we[ut];if(we[ut]!==Je[ut])return}},Dn=Je=>Je.split("/").map(rt=>rt.trim()).filter(rt=>""!==rt),gi=Je=>{Je&&(Je.ref.destroy(),Je.unlistenEvents())};class Mi{constructor(rt,we,ut,dt,Lt,gn){this.containerEl=we,this.router=ut,this.navCtrl=dt,this.zone=Lt,this.location=gn,this.views=[],this.skipTransition=!1,this.nextId=0,this.tabsPrefix=void 0!==rt?Dn(rt):void 0}createView(rt,we){const ut=ze(this.router,we),dt=rt?.location?.nativeElement,Lt=sn(this.zone,rt.instance,dt);return{id:this.nextId++,stackId:rn(this.tabsPrefix,ut),unlistenEvents:Lt,element:dt,ref:rt,url:ut}}getExistingView(rt){const we=ze(this.router,rt),ut=this.views.find(dt=>dt.url===we);return ut&&ut.ref.changeDetectorRef.reattach(),ut}setActive(rt){const we=this.navCtrl.consumeTransition();let{direction:ut,animation:dt,animationBuilder:Lt}=we;const gn=this.activeView,ti=at(rt,gn);ti&&(ut="back",dt=void 0);const di=this.views.slice();let Kn;const Xi=this.router;Xi.getCurrentNavigation?Kn=Xi.getCurrentNavigation():Xi.navigations?.value&&(Kn=Xi.navigations.value),Kn?.extras?.replaceUrl&&this.views.length>0&&this.views.splice(-1,1);const J=this.views.includes(rt),be=this.insertView(rt,ut);J||rt.ref.changeDetectorRef.detectChanges();const ft=rt.animationBuilder;return void 0===Lt&&"back"===ut&&!ti&&void 0!==ft&&(Lt=ft),gn&&(gn.animationBuilder=Lt),this.zone.runOutsideAngular(()=>this.wait(()=>(gn&&gn.ref.changeDetectorRef.detach(),rt.ref.changeDetectorRef.reattach(),this.transition(rt,gn,dt,this.canGoBack(1),!1,Lt).then(()=>Li(rt,be,di,this.location,this.zone)).then(()=>({enteringView:rt,direction:ut,animation:dt,tabSwitch:ti})))))}canGoBack(rt,we=this.getActiveStackId()){return this.getStack(we).length>rt}pop(rt,we=this.getActiveStackId()){return this.zone.run(()=>{const ut=this.getStack(we);if(ut.length<=rt)return Promise.resolve(!1);const dt=ut[ut.length-rt-1];let Lt=dt.url;const gn=dt.savedData;if(gn){const di=gn.get("primary");di?.route?._routerState?.snapshot.url&&(Lt=di.route._routerState.snapshot.url)}const{animationBuilder:ti}=this.navCtrl.consumeTransition();return this.navCtrl.navigateBack(Lt,{...dt.savedExtras,animation:ti}).then(()=>!0)})}startBackTransition(){const rt=this.activeView;if(rt){const we=this.getStack(rt.stackId),ut=we[we.length-2],dt=ut.animationBuilder;return this.wait(()=>this.transition(ut,rt,"back",this.canGoBack(2),!0,dt))}return Promise.resolve()}endBackTransition(rt){rt?(this.skipTransition=!0,this.pop(1)):this.activeView&&yr(this.activeView,this.views,this.views,this.location,this.zone)}getLastUrl(rt){const we=this.getStack(rt);return we.length>0?we[we.length-1]:void 0}getRootUrl(rt){const we=this.getStack(rt);return we.length>0?we[0]:void 0}getActiveStackId(){return this.activeView?this.activeView.stackId:void 0}getActiveView(){return this.activeView}hasRunningTask(){return void 0!==this.runningTask}destroy(){this.containerEl=void 0,this.views.forEach(gi),this.activeView=void 0,this.views=[]}getStack(rt){return this.views.filter(we=>we.stackId===rt)}insertView(rt,we){return this.activeView=rt,this.views=((Je,rt,we)=>"root"===we?ae(Je,rt):"forward"===we?((Je,rt)=>(Je.indexOf(rt)>=0?Je=Je.filter(ut=>ut.stackId!==rt.stackId||ut.id<=rt.id):Je.push(rt),Je))(Je,rt):((Je,rt)=>Je.indexOf(rt)>=0?Je.filter(ut=>ut.stackId!==rt.stackId||ut.id<=rt.id):ae(Je,rt))(Je,rt))(this.views,rt,we),this.views.slice()}transition(rt,we,ut,dt,Lt,gn){if(this.skipTransition)return this.skipTransition=!1,Promise.resolve(!1);if(we===rt)return Promise.resolve(!1);const ti=rt?rt.element:void 0,di=we?we.element:void 0,Kn=this.containerEl;return ti&&ti!==di&&(ti.classList.add("ion-page"),ti.classList.add("ion-page-invisible"),ti.parentElement!==Kn&&Kn.appendChild(ti),Kn.commit)?Kn.commit(ti,di,{duration:void 0===ut?0:void 0,direction:ut,showGoBack:dt,progressAnimation:Lt,animationBuilder:gn}):Promise.resolve(!1)}wait(rt){var we=this;return(0,h.Z)(function*(){void 0!==we.runningTask&&(yield we.runningTask,we.runningTask=void 0);const ut=we.runningTask=rt();return ut.finally(()=>we.runningTask=void 0),ut})()}}const Li=(Je,rt,we,ut,dt)=>"function"==typeof requestAnimationFrame?new Promise(Lt=>{requestAnimationFrame(()=>{yr(Je,rt,we,ut,dt),Lt()})}):Promise.resolve(),yr=(Je,rt,we,ut,dt)=>{dt.run(()=>we.filter(Lt=>!rt.includes(Lt)).forEach(gi)),rt.forEach(Lt=>{const ti=ut.path().split("?")[0].split("#")[0];if(Lt!==Je&&Lt.url!==ti){const di=Lt.element;di.setAttribute("aria-hidden","true"),di.classList.add("ion-page-hidden"),Lt.ref.changeDetectorRef.detach()}})};let Ui=(()=>{class Je{constructor(we,ut,dt,Lt,gn,ti,di,Kn){this.parentOutlet=Kn,this.activatedView=null,this.proxyMap=new WeakMap,this.currentActivatedRoute$=new Kt.X(null),this.activated=null,this._activatedRoute=null,this.name=X.eC,this.stackWillChange=new p.vpe,this.stackDidChange=new p.vpe,this.activateEvents=new p.vpe,this.deactivateEvents=new p.vpe,this.parentContexts=(0,p.f3M)(X.y6),this.location=(0,p.f3M)(p.s_b),this.environmentInjector=(0,p.f3M)(p.lqb),this.inputBinder=(0,p.f3M)(ho,{optional:!0}),this.supportsBindingToComponentInputs=!0,this.config=(0,p.f3M)(xi),this.navCtrl=(0,p.f3M)(Nt),this.nativeEl=Lt.nativeElement,this.name=we||X.eC,this.tabsPrefix="true"===ut?ze(gn,di):void 0,this.stackCtrl=new Mi(this.tabsPrefix,this.nativeEl,gn,this.navCtrl,ti,dt),this.parentContexts.onChildOutletCreated(this.name,this)}get activatedComponentRef(){return this.activated}set animation(we){this.nativeEl.animation=we}set animated(we){this.nativeEl.animated=we}set swipeGesture(we){this._swipeGesture=we,this.nativeEl.swipeHandler=we?{canStart:()=>this.stackCtrl.canGoBack(1)&&!this.stackCtrl.hasRunningTask(),onStart:()=>this.stackCtrl.startBackTransition(),onEnd:ut=>this.stackCtrl.endBackTransition(ut)}:void 0}ngOnDestroy(){this.stackCtrl.destroy(),this.inputBinder?.unsubscribeFromRouteData(this)}getContext(){return this.parentContexts.getContext(this.name)}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(!this.activated){const we=this.getContext();we?.route&&this.activateWith(we.route,we.injector)}new Promise(we=>(0,ie.c)(this.nativeEl,we)).then(()=>{void 0===this._swipeGesture&&(this.swipeGesture=this.config.getBoolean("swipeBackEnabled","ios"===this.nativeEl.mode))})}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){throw new Error("incompatible reuse strategy")}attach(we,ut){throw new Error("incompatible reuse strategy")}deactivate(){if(this.activated){if(this.activatedView){const ut=this.getContext();this.activatedView.savedData=new Map(ut.children.contexts);const dt=this.activatedView.savedData.get("primary");if(dt&&ut.route&&(dt.route={...ut.route}),this.activatedView.savedExtras={},ut.route){const Lt=ut.route.snapshot;this.activatedView.savedExtras.queryParams=Lt.queryParams,this.activatedView.savedExtras.fragment=Lt.fragment}}const we=this.component;this.activatedView=null,this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(we)}}activateWith(we,ut){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=we;let dt,Lt=this.stackCtrl.getExistingView(we);if(Lt){dt=this.activated=Lt.ref;const ti=Lt.savedData;ti&&(this.getContext().children.contexts=ti),this.updateActivatedRouteProxy(dt.instance,we)}else{const ti=we._futureSnapshot,di=this.parentContexts.getOrCreateContext(this.name).children,Kn=new Kt.X(null),Xi=this.createActivatedRouteProxy(Kn,we),J=new Fr(Xi,di,this.location.injector);dt=this.activated=this.location.createComponent(ti.routeConfig.component??ti.component,{index:this.location.length,injector:J,environmentInjector:ut??this.environmentInjector}),Kn.next(dt.instance),Lt=this.stackCtrl.createView(this.activated,we),this.proxyMap.set(dt.instance,Xi),this.currentActivatedRoute$.next({component:dt.instance,activatedRoute:we})}this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activatedView=Lt,this.navCtrl.setTopOutlet(this);const gn=this.stackCtrl.getActiveView();this.stackWillChange.emit({enteringView:Lt,tabSwitch:at(Lt,gn)}),this.stackCtrl.setActive(Lt).then(ti=>{this.activateEvents.emit(dt.instance),this.stackDidChange.emit(ti)})}canGoBack(we=1,ut){return this.stackCtrl.canGoBack(we,ut)}pop(we=1,ut){return this.stackCtrl.pop(we,ut)}getLastUrl(we){const ut=this.stackCtrl.getLastUrl(we);return ut?ut.url:void 0}getLastRouteView(we){return this.stackCtrl.getLastUrl(we)}getRootView(we){return this.stackCtrl.getRootUrl(we)}getActiveStackId(){return this.stackCtrl.getActiveStackId()}createActivatedRouteProxy(we,ut){const dt=new X.gz;return dt._futureSnapshot=ut._futureSnapshot,dt._routerState=ut._routerState,dt.snapshot=ut.snapshot,dt.outlet=ut.outlet,dt.component=ut.component,dt._paramMap=this.proxyObservable(we,"paramMap"),dt._queryParamMap=this.proxyObservable(we,"queryParamMap"),dt.url=this.proxyObservable(we,"url"),dt.params=this.proxyObservable(we,"params"),dt.queryParams=this.proxyObservable(we,"queryParams"),dt.fragment=this.proxyObservable(we,"fragment"),dt.data=this.proxyObservable(we,"data"),dt}proxyObservable(we,ut){return we.pipe((0,li.h)(dt=>!!dt),(0,en.w)(dt=>this.currentActivatedRoute$.pipe((0,li.h)(Lt=>null!==Lt&&Lt.component===dt),(0,en.w)(Lt=>Lt&&Lt.activatedRoute[ut]),(0,Dt.x)())))}updateActivatedRouteProxy(we,ut){const dt=this.proxyMap.get(we);if(!dt)throw new Error("Could not find activated route proxy for view");dt._futureSnapshot=ut._futureSnapshot,dt._routerState=ut._routerState,dt.snapshot=ut.snapshot,dt.outlet=ut.outlet,dt.component=ut.component,this.currentActivatedRoute$.next({component:we,activatedRoute:ut})}}return Je.\u0275fac=function(we){return new(we||Je)(p.$8M("name"),p.$8M("tabs"),p.Y36(a.Ye),p.Y36(p.SBq),p.Y36(X.F0),p.Y36(p.R0b),p.Y36(X.gz),p.Y36(Je,12))},Je.\u0275dir=p.lG2({type:Je,selectors:[["ion-router-outlet"]],inputs:{animated:"animated",animation:"animation",mode:"mode",swipeGesture:"swipeGesture",name:"name"},outputs:{stackWillChange:"stackWillChange",stackDidChange:"stackDidChange",activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),Je})();class Fr{constructor(rt,we,ut){this.route=rt,this.childContexts=we,this.parent=ut}get(rt,we){return rt===X.gz?this.route:rt===X.y6?this.childContexts:this.parent.get(rt,we)}}const ho=new p.OlP("");let Do=(()=>{class Je{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(we){this.unsubscribeFromRouteData(we),this.subscribeToRouteData(we)}unsubscribeFromRouteData(we){this.outletDataSubscriptions.get(we)?.unsubscribe(),this.outletDataSubscriptions.delete(we)}subscribeToRouteData(we){const{activatedRoute:ut}=we,dt=(0,Mn.a)([ut.queryParams,ut.params,ut.data]).pipe((0,en.w)(([Lt,gn,ti],di)=>(ti={...Lt,...gn,...ti},0===di?(0,fn.of)(ti):Promise.resolve(ti)))).subscribe(Lt=>{if(!we.isActivated||!we.activatedComponentRef||we.activatedRoute!==ut||null===ut.component)return void this.unsubscribeFromRouteData(we);const gn=(0,p.qFp)(ut.component);if(gn)for(const{templateName:ti}of gn.inputs)we.activatedComponentRef.setInput(ti,Lt[ti]);else this.unsubscribeFromRouteData(we)});this.outletDataSubscriptions.set(we,dt)}}return Je.\u0275fac=function(we){return new(we||Je)},Je.\u0275prov=p.Yz7({token:Je,factory:Je.\u0275fac}),Je})();const Io=()=>({provide:ho,useFactory:Zi,deps:[X.F0]});function Zi(Je){return Je?.componentInputBindingEnabled?new Do:null}const ao=["color","defaultHref","disabled","icon","mode","routerAnimation","text","type"];let Ro=(()=>{let Je=class{constructor(we,ut,dt,Lt,gn,ti){this.routerOutlet=we,this.navCtrl=ut,this.config=dt,this.r=Lt,this.z=gn,ti.detach(),this.el=this.r.nativeElement}onClick(we){const ut=this.defaultHref||this.config.get("backButtonDefaultHref");this.routerOutlet?.canGoBack()?(this.navCtrl.setDirection("back",void 0,void 0,this.routerAnimation),this.routerOutlet.pop(),we.preventDefault()):null!=ut&&(this.navCtrl.navigateBack(ut,{animation:this.routerAnimation}),we.preventDefault())}};return Je.\u0275fac=function(we){return new(we||Je)(p.Y36(Ui,8),p.Y36(Nt),p.Y36(xi),p.Y36(p.SBq),p.Y36(p.R0b),p.Y36(p.sBO))},Je.\u0275dir=p.lG2({type:Je,hostBindings:function(we,ut){1&we&&p.NdJ("click",function(Lt){return ut.onClick(Lt)})},inputs:{color:"color",defaultHref:"defaultHref",disabled:"disabled",icon:"icon",mode:"mode",routerAnimation:"routerAnimation",text:"text",type:"type"}}),Je=(0,qn.gn)([yt({inputs:ao})],Je),Je})(),xo=(()=>{class Je{constructor(we,ut,dt,Lt,gn){this.locationStrategy=we,this.navCtrl=ut,this.elementRef=dt,this.router=Lt,this.routerLink=gn,this.routerDirection="forward"}ngOnInit(){this.updateTargetUrlAndHref()}ngOnChanges(){this.updateTargetUrlAndHref()}updateTargetUrlAndHref(){if(this.routerLink?.urlTree){const we=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.routerLink.urlTree));this.elementRef.nativeElement.href=we}}onClick(we){this.navCtrl.setDirection(this.routerDirection,void 0,void 0,this.routerAnimation),we.preventDefault()}}return Je.\u0275fac=function(we){return new(we||Je)(p.Y36(a.S$),p.Y36(Nt),p.Y36(p.SBq),p.Y36(X.F0),p.Y36(X.rH,8))},Je.\u0275dir=p.lG2({type:Je,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(we,ut){1&we&&p.NdJ("click",function(Lt){return ut.onClick(Lt)})},inputs:{routerDirection:"routerDirection",routerAnimation:"routerAnimation"},features:[p.TTD]}),Je})(),qi=(()=>{class Je{constructor(we,ut,dt,Lt,gn){this.locationStrategy=we,this.navCtrl=ut,this.elementRef=dt,this.router=Lt,this.routerLink=gn,this.routerDirection="forward"}ngOnInit(){this.updateTargetUrlAndHref()}ngOnChanges(){this.updateTargetUrlAndHref()}updateTargetUrlAndHref(){if(this.routerLink?.urlTree){const we=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.routerLink.urlTree));this.elementRef.nativeElement.href=we}}onClick(){this.navCtrl.setDirection(this.routerDirection,void 0,void 0,this.routerAnimation)}}return Je.\u0275fac=function(we){return new(we||Je)(p.Y36(a.S$),p.Y36(Nt),p.Y36(p.SBq),p.Y36(X.F0),p.Y36(X.rH,8))},Je.\u0275dir=p.lG2({type:Je,selectors:[["a","routerLink",""],["area","routerLink",""]],hostBindings:function(we,ut){1&we&&p.NdJ("click",function(){return ut.onClick()})},inputs:{routerDirection:"routerDirection",routerAnimation:"routerAnimation"},features:[p.TTD]}),Je})();const Ci=["animated","animation","root","rootParams","swipeGesture"],Kr=["push","insert","insertPages","pop","popTo","popToRoot","removeIndex","setRoot","setPages","getActive","getByIndex","canGoBack","getPrevious"];let Yt=(()=>{let Je=class{constructor(we,ut,dt,Lt,gn,ti){this.z=gn,ti.detach(),this.el=we.nativeElement,we.nativeElement.delegate=Lt.create(ut,dt),tt(this,this.el,["ionNavDidChange","ionNavWillChange"])}};return Je.\u0275fac=function(we){return new(we||Je)(p.Y36(p.SBq),p.Y36(p.lqb),p.Y36(p.zs3),p.Y36(Wi),p.Y36(p.R0b),p.Y36(p.sBO))},Je.\u0275dir=p.lG2({type:Je,inputs:{animated:"animated",animation:"animation",root:"root",rootParams:"rootParams",swipeGesture:"swipeGesture"}}),Je=(0,qn.gn)([yt({inputs:Ci,methods:Kr})],Je),Je})(),Tt=(()=>{class Je{constructor(we){this.navCtrl=we,this.ionTabsWillChange=new p.vpe,this.ionTabsDidChange=new p.vpe,this.tabBarSlot="bottom"}ngAfterContentInit(){this.detectSlotChanges()}ngAfterContentChecked(){this.detectSlotChanges()}onStackWillChange({enteringView:we,tabSwitch:ut}){const dt=we.stackId;ut&&void 0!==dt&&this.ionTabsWillChange.emit({tab:dt})}onStackDidChange({enteringView:we,tabSwitch:ut}){const dt=we.stackId;ut&&void 0!==dt&&(this.tabBar&&(this.tabBar.selectedTab=dt),this.ionTabsDidChange.emit({tab:dt}))}select(we){const ut="string"==typeof we,dt=ut?we:we.detail.tab,Lt=this.outlet.getActiveStackId()===dt,gn=`${this.outlet.tabsPrefix}/${dt}`;if(ut||we.stopPropagation(),Lt){const ti=this.outlet.getActiveStackId();if(this.outlet.getLastRouteView(ti)?.url===gn)return;const Kn=this.outlet.getRootView(dt);return this.navCtrl.navigateRoot(gn,{...Kn&&gn===Kn.url&&Kn.savedExtras,animated:!0,animationDirection:"back"})}{const ti=this.outlet.getLastRouteView(dt),di=ti?.url||gn,Kn=ti?.savedExtras;return this.navCtrl.navigateRoot(di,{...Kn,animated:!0,animationDirection:"back"})}}getSelected(){return this.outlet.getActiveStackId()}detectSlotChanges(){this.tabBars.forEach(we=>{const ut=we.el.getAttribute("slot");ut!==this.tabBarSlot&&(this.tabBarSlot=ut,this.relocateTabBar())})}relocateTabBar(){const we=this.tabBar.el;"top"===this.tabBarSlot?this.tabsInner.nativeElement.before(we):this.tabsInner.nativeElement.after(we)}}return Je.\u0275fac=function(we){return new(we||Je)(p.Y36(Nt))},Je.\u0275dir=p.lG2({type:Je,selectors:[["ion-tabs"]],viewQuery:function(we,ut){if(1&we&&p.Gf(Ct,7,p.SBq),2&we){let dt;p.iGM(dt=p.CRH())&&(ut.tabsInner=dt.first)}},hostBindings:function(we,ut){1&we&&p.NdJ("ionTabButtonClick",function(Lt){return ut.select(Lt)})},outputs:{ionTabsWillChange:"ionTabsWillChange",ionTabsDidChange:"ionTabsDidChange"}}),Je})();const Mt=Je=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(Je):"function"==typeof requestAnimationFrame?requestAnimationFrame(Je):setTimeout(Je);let Qt=(()=>{class Je{constructor(we,ut){this.injector=we,this.elementRef=ut,this.onChange=()=>{},this.onTouched=()=>{}}writeValue(we){this.elementRef.nativeElement.value=this.lastValue=we,wn(this.elementRef)}handleValueChange(we,ut){we===this.elementRef.nativeElement&&(ut!==this.lastValue&&(this.lastValue=ut,this.onChange(ut)),wn(this.elementRef))}_handleBlurEvent(we){we===this.elementRef.nativeElement&&(this.onTouched(),wn(this.elementRef))}registerOnChange(we){this.onChange=we}registerOnTouched(we){this.onTouched=we}setDisabledState(we){this.elementRef.nativeElement.disabled=we}ngOnDestroy(){this.statusChanges&&this.statusChanges.unsubscribe()}ngAfterViewInit(){let we;try{we=this.injector.get(Ie.a5)}catch{}if(!we)return;we.statusChanges&&(this.statusChanges=we.statusChanges.subscribe(()=>wn(this.elementRef)));const ut=we.control;ut&&["markAsTouched","markAllAsTouched","markAsUntouched","markAsDirty","markAsPristine"].forEach(Lt=>{if(typeof ut[Lt]<"u"){const gn=ut[Lt].bind(ut);ut[Lt]=(...ti)=>{gn(...ti),wn(this.elementRef)}}})}}return Je.\u0275fac=function(we){return new(we||Je)(p.Y36(p.zs3),p.Y36(p.SBq))},Je.\u0275dir=p.lG2({type:Je,hostBindings:function(we,ut){1&we&&p.NdJ("ionBlur",function(Lt){return ut._handleBlurEvent(Lt.target)})}}),Je})();const wn=Je=>{Mt(()=>{const rt=Je.nativeElement,we=null!=rt.value&&rt.value.toString().length>0,ut=It(rt);Xn(rt,ut);const dt=rt.closest("ion-item");dt&&Xn(dt,we?[...ut,"item-has-value"]:ut)})},It=Je=>{const rt=Je.classList,we=[];for(let ut=0;ut<rt.length;ut++){const dt=rt.item(ut);null!==dt&&ui(dt,"ng-")&&we.push(`ion-${dt.substring(3)}`)}return we},Xn=(Je,rt)=>{const we=Je.classList;we.remove("ion-valid","ion-invalid","ion-touched","ion-untouched","ion-dirty","ion-pristine"),we.add(...rt)},ui=(Je,rt)=>Je.substring(0,rt.length)===rt;class Wn{shouldDetach(rt){return!1}shouldAttach(rt){return!1}store(rt,we){}retrieve(rt){return null}shouldReuseRoute(rt,we){if(rt.routeConfig!==we.routeConfig)return!1;const ut=rt.params,dt=we.params,Lt=Object.keys(ut),gn=Object.keys(dt);if(Lt.length!==gn.length)return!1;for(const ti of Lt)if(dt[ti]!==ut[ti])return!1;return!0}}class lr{constructor(rt){this.ctrl=rt}create(rt){return this.ctrl.create(rt||{})}dismiss(rt,we,ut){return this.ctrl.dismiss(rt,we,ut)}getTop(){return this.ctrl.getTop()}}},6728:(zn,wt,S)=>{"use strict";S.d(wt,{BX:()=>mt,Br:()=>be,w:()=>Ve,dr:()=>fn,BJ:()=>qn,oU:()=>we,yp:()=>en,YG:()=>Ct,Sm:()=>on,PM:()=>Rn,FN:()=>Vn,Zi:()=>Ut,tO:()=>Hn,hM:()=>Xt,wI:()=>Tn,W2:()=>oi,IJ:()=>gr,W4:()=>ki,zq:()=>Wi,fr:()=>_n,jY:()=>Bi,Gu:()=>pn,gu:()=>sn,pK:()=>ge,Ie:()=>se,Q$:()=>Et,q_:()=>Jt,yh:()=>Bn,Uj:()=>Kn,z0:()=>ae,fG:()=>ht,zc:()=>G,yf:()=>J,uN:()=>at,I_:()=>Li,nJ:()=>yr,Wo:()=>Ui,jP:()=>Je,Nd:()=>Io,VI:()=>Zi,cJ:()=>ao,GO:()=>Ro,t9:()=>xo,n0:()=>qi,PQ:()=>Kr,jI:()=>Yt,g2:()=>wn,Bs:()=>It,wd:()=>Xn,ho:()=>Wn,sr:()=>lr,Pc:()=>ur,HT:()=>jt,IN:()=>$n,as:()=>Xe,YI:()=>dt,QI:()=>cn,j9:()=>xn,yF:()=>ci});var h=S(8564),p=S(6223),X=S(5472),a=S(7582),j=S(2438),K=S(6814),C=S(6800),ye=(S(6410),S(448),S(2619),S(9023),S(9203),S(3882)),De=S(3365),Ye=(S(1783),S(7612)),de=(S(6225),S(5349));S(619);const Ae=ye.i,lt=["*"];let Ve=(()=>{class R extends X.bk{constructor(H,Ze){super(H,Ze)}writeValue(H){this.elementRef.nativeElement.checked=this.lastValue=H,(0,X.vk)(this.elementRef)}_handleIonChange(H){this.handleValueChange(H,H.checked)}}return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.zs3),h.Y36(h.SBq))},R.\u0275dir=h.lG2({type:R,selectors:[["ion-checkbox"],["ion-toggle"]],hostBindings:function(H,Ze){1&H&&h.NdJ("ionChange",function(Vi){return Ze._handleIonChange(Vi.target)})},features:[h._Bn([{provide:p.JU,useExisting:R,multi:!0}]),h.qOj]}),R})(),Xe=(()=>{class R extends X.bk{constructor(H,Ze){super(H,Ze)}handleInputEvent(H){this.handleValueChange(H,H.value)}registerOnChange(H){super.registerOnChange(Ze=>{H(""===Ze?null:parseFloat(Ze))})}}return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.zs3),h.Y36(h.SBq))},R.\u0275dir=h.lG2({type:R,selectors:[["ion-input","type","number"]],hostBindings:function(H,Ze){1&H&&h.NdJ("ionInput",function(Vi){return Ze.handleInputEvent(Vi.target)})},features:[h._Bn([{provide:p.JU,useExisting:R,multi:!0}]),h.qOj]}),R})(),cn=(()=>{class R extends X.bk{constructor(H,Ze){super(H,Ze)}_handleChangeEvent(H){this.handleValueChange(H,H.value)}}return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.zs3),h.Y36(h.SBq))},R.\u0275dir=h.lG2({type:R,selectors:[["ion-range"],["ion-select"],["ion-radio-group"],["ion-segment"],["ion-datetime"]],hostBindings:function(H,Ze){1&H&&h.NdJ("ionChange",function(Vi){return Ze._handleChangeEvent(Vi.target)})},features:[h._Bn([{provide:p.JU,useExisting:R,multi:!0}]),h.qOj]}),R})(),xn=(()=>{class R extends X.bk{constructor(H,Ze){super(H,Ze)}_handleInputEvent(H){this.handleValueChange(H,H.value)}}return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.zs3),h.Y36(h.SBq))},R.\u0275dir=h.lG2({type:R,selectors:[["ion-input",3,"type","number"],["ion-textarea"],["ion-searchbar"]],hostBindings:function(H,Ze){1&H&&h.NdJ("ionInput",function(Vi){return Ze._handleInputEvent(Vi.target)})},features:[h._Bn([{provide:p.JU,useExisting:R,multi:!0}]),h.qOj]}),R})();const $t=(R,$e)=>{const H=R.prototype;$e.forEach(Ze=>{Object.defineProperty(H,Ze,{get(){return this.el[Ze]},set(Bt){this.z.runOutsideAngular(()=>this.el[Ze]=Bt)},configurable:!0})})},ke=(R,$e)=>{const H=R.prototype;$e.forEach(Ze=>{H[Ze]=function(){const Bt=arguments;return this.z.runOutsideAngular(()=>this.el[Ze].apply(this.el,Bt))}})},pe=(R,$e,H)=>{H.forEach(Ze=>R[Ze]=(0,j.R)($e,Ze))};function ie(R){return function(H){const{defineCustomElementFn:Ze,inputs:Bt,methods:Vi}=R;return void 0!==Ze&&Ze(),Bt&&$t(H,Bt),Vi&&ke(H,Vi),H}}let fn=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-app"]],ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({})],R),R})(),qn=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-avatar"]],ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({})],R),R})(),en=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-badge"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["color","mode"]})],R),R})(),Ct=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement,pe(this,this.el,["ionFocus","ionBlur"])}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-button"]],inputs:{buttonType:"buttonType",color:"color",disabled:"disabled",download:"download",expand:"expand",fill:"fill",form:"form",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",size:"size",strong:"strong",target:"target",type:"type"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["buttonType","color","disabled","download","expand","fill","form","href","mode","rel","routerAnimation","routerDirection","shape","size","strong","target","type"]})],R),R})(),on=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-buttons"]],inputs:{collapse:"collapse"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["collapse"]})],R),R})(),Rn=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-card"]],inputs:{button:"button",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",target:"target",type:"type"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["button","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","target","type"]})],R),R})(),Vn=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-card-content"]],inputs:{mode:"mode"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["mode"]})],R),R})(),Ut=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-card-header"]],inputs:{color:"color",mode:"mode",translucent:"translucent"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["color","mode","translucent"]})],R),R})(),Hn=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-card-subtitle"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["color","mode"]})],R),R})(),Xt=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-chip"]],inputs:{color:"color",disabled:"disabled",mode:"mode",outline:"outline"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["color","disabled","mode","outline"]})],R),R})(),Tn=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-col"]],inputs:{offset:"offset",offsetLg:"offsetLg",offsetMd:"offsetMd",offsetSm:"offsetSm",offsetXl:"offsetXl",offsetXs:"offsetXs",pull:"pull",pullLg:"pullLg",pullMd:"pullMd",pullSm:"pullSm",pullXl:"pullXl",pullXs:"pullXs",push:"push",pushLg:"pushLg",pushMd:"pushMd",pushSm:"pushSm",pushXl:"pushXl",pushXs:"pushXs",size:"size",sizeLg:"sizeLg",sizeMd:"sizeMd",sizeSm:"sizeSm",sizeXl:"sizeXl",sizeXs:"sizeXs"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["offset","offsetLg","offsetMd","offsetSm","offsetXl","offsetXs","pull","pullLg","pullMd","pullSm","pullXl","pullXs","push","pushLg","pushMd","pushSm","pushXl","pushXs","size","sizeLg","sizeMd","sizeSm","sizeXl","sizeXs"]})],R),R})(),oi=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement,pe(this,this.el,["ionScrollStart","ionScroll","ionScrollEnd"])}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-content"]],inputs:{color:"color",forceOverscroll:"forceOverscroll",fullscreen:"fullscreen",scrollEvents:"scrollEvents",scrollX:"scrollX",scrollY:"scrollY"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["color","forceOverscroll","fullscreen","scrollEvents","scrollX","scrollY"],methods:["getScrollElement","scrollToTop","scrollToBottom","scrollByPoint","scrollToPoint"]})],R),R})(),gr=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-fab"]],inputs:{activated:"activated",edge:"edge",horizontal:"horizontal",vertical:"vertical"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["activated","edge","horizontal","vertical"],methods:["close"]})],R),R})(),ki=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement,pe(this,this.el,["ionFocus","ionBlur"])}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-fab-button"]],inputs:{activated:"activated",closeIcon:"closeIcon",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",show:"show",size:"size",target:"target",translucent:"translucent",type:"type"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["activated","closeIcon","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","show","size","target","translucent","type"]})],R),R})(),Wi=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-fab-list"]],inputs:{activated:"activated",side:"side"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["activated","side"]})],R),R})(),_n=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-footer"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["collapse","mode","translucent"]})],R),R})(),Bi=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-grid"]],inputs:{fixed:"fixed"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["fixed"]})],R),R})(),pn=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-header"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["collapse","mode","translucent"]})],R),R})(),sn=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-icon"]],inputs:{color:"color",flipRtl:"flipRtl",icon:"icon",ios:"ios",lazy:"lazy",md:"md",mode:"mode",name:"name",sanitize:"sanitize",size:"size",src:"src"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["color","flipRtl","icon","ios","lazy","md","mode","name","sanitize","size","src"]})],R),R})(),ge=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement,pe(this,this.el,["ionInput","ionChange","ionBlur","ionFocus"])}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-input"]],inputs:{accept:"accept",autocapitalize:"autocapitalize",autocomplete:"autocomplete",autocorrect:"autocorrect",autofocus:"autofocus",clearInput:"clearInput",clearOnEdit:"clearOnEdit",color:"color",counter:"counter",counterFormatter:"counterFormatter",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",errorText:"errorText",fill:"fill",helperText:"helperText",inputmode:"inputmode",label:"label",labelPlacement:"labelPlacement",legacy:"legacy",max:"max",maxlength:"maxlength",min:"min",minlength:"minlength",mode:"mode",multiple:"multiple",name:"name",pattern:"pattern",placeholder:"placeholder",readonly:"readonly",required:"required",shape:"shape",size:"size",spellcheck:"spellcheck",step:"step",type:"type",value:"value"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["accept","autocapitalize","autocomplete","autocorrect","autofocus","clearInput","clearOnEdit","color","counter","counterFormatter","debounce","disabled","enterkeyhint","errorText","fill","helperText","inputmode","label","labelPlacement","legacy","max","maxlength","min","minlength","mode","multiple","name","pattern","placeholder","readonly","required","shape","size","spellcheck","step","type","value"],methods:["setFocus","getInputElement"]})],R),R})(),se=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-item"]],inputs:{button:"button",color:"color",counter:"counter",counterFormatter:"counterFormatter",detail:"detail",detailIcon:"detailIcon",disabled:"disabled",download:"download",fill:"fill",href:"href",lines:"lines",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",target:"target",type:"type"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["button","color","counter","counterFormatter","detail","detailIcon","disabled","download","fill","href","lines","mode","rel","routerAnimation","routerDirection","shape","target","type"]})],R),R})(),Et=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-label"]],inputs:{color:"color",mode:"mode",position:"position"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["color","mode","position"]})],R),R})(),Jt=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-list"]],inputs:{inset:"inset",lines:"lines",mode:"mode"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["inset","lines","mode"],methods:["closeSlidingItems"]})],R),R})(),Bn=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-list-header"]],inputs:{color:"color",lines:"lines",mode:"mode"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["color","lines","mode"]})],R),R})(),ae=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement,pe(this,this.el,["ionWillOpen","ionWillClose","ionDidOpen","ionDidClose"])}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-menu"]],inputs:{contentId:"contentId",disabled:"disabled",maxEdgeStart:"maxEdgeStart",menuId:"menuId",side:"side",swipeGesture:"swipeGesture",type:"type"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["contentId","disabled","maxEdgeStart","menuId","side","swipeGesture","type"],methods:["isOpen","isActive","open","close","toggle","setOpen"]})],R),R})(),ht=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-menu-button"]],inputs:{autoHide:"autoHide",color:"color",disabled:"disabled",menu:"menu",mode:"mode",type:"type"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["autoHide","color","disabled","menu","mode","type"]})],R),R})(),G=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-menu-toggle"]],inputs:{autoHide:"autoHide",menu:"menu"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["autoHide","menu"]})],R),R})(),at=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-note"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["color","mode"]})],R),R})(),Li=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement,pe(this,this.el,["ionChange","ionInput","ionFocus","ionBlur","ionKnobMoveStart","ionKnobMoveEnd"])}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-range"]],inputs:{activeBarStart:"activeBarStart",color:"color",debounce:"debounce",disabled:"disabled",dualKnobs:"dualKnobs",label:"label",labelPlacement:"labelPlacement",legacy:"legacy",max:"max",min:"min",mode:"mode",name:"name",pin:"pin",pinFormatter:"pinFormatter",snaps:"snaps",step:"step",ticks:"ticks",value:"value"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["activeBarStart","color","debounce","disabled","dualKnobs","label","labelPlacement","legacy","max","min","mode","name","pin","pinFormatter","snaps","step","ticks","value"]})],R),R})(),yr=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement,pe(this,this.el,["ionRefresh","ionPull","ionStart"])}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-refresher"]],inputs:{closeDuration:"closeDuration",disabled:"disabled",pullFactor:"pullFactor",pullMax:"pullMax",pullMin:"pullMin",snapbackDuration:"snapbackDuration"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["closeDuration","disabled","pullFactor","pullMax","pullMin","snapbackDuration"],methods:["complete","cancel","getProgress"]})],R),R})(),Ui=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-refresher-content"]],inputs:{pullingIcon:"pullingIcon",pullingText:"pullingText",refreshingSpinner:"refreshingSpinner",refreshingText:"refreshingText"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["pullingIcon","pullingText","refreshingSpinner","refreshingText"]})],R),R})(),Io=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-row"]],ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({})],R),R})(),Zi=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement,pe(this,this.el,["ionInput","ionChange","ionCancel","ionClear","ionBlur","ionFocus"])}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-searchbar"]],inputs:{animated:"animated",autocomplete:"autocomplete",autocorrect:"autocorrect",cancelButtonIcon:"cancelButtonIcon",cancelButtonText:"cancelButtonText",clearIcon:"clearIcon",color:"color",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",mode:"mode",name:"name",placeholder:"placeholder",searchIcon:"searchIcon",showCancelButton:"showCancelButton",showClearButton:"showClearButton",spellcheck:"spellcheck",type:"type",value:"value"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["animated","autocomplete","autocorrect","cancelButtonIcon","cancelButtonText","clearIcon","color","debounce","disabled","enterkeyhint","inputmode","mode","name","placeholder","searchIcon","showCancelButton","showClearButton","spellcheck","type","value"],methods:["setFocus","getInputElement"]})],R),R})(),ao=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement,pe(this,this.el,["ionChange"])}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-segment"]],inputs:{color:"color",disabled:"disabled",mode:"mode",scrollable:"scrollable",selectOnFocus:"selectOnFocus",swipeGesture:"swipeGesture",value:"value"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["color","disabled","mode","scrollable","selectOnFocus","swipeGesture","value"]})],R),R})(),Ro=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-segment-button"]],inputs:{disabled:"disabled",layout:"layout",mode:"mode",type:"type",value:"value"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["disabled","layout","mode","type","value"]})],R),R})(),xo=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement,pe(this,this.el,["ionChange","ionCancel","ionDismiss","ionFocus","ionBlur"])}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-select"]],inputs:{cancelText:"cancelText",color:"color",compareWith:"compareWith",disabled:"disabled",expandedIcon:"expandedIcon",fill:"fill",interface:"interface",interfaceOptions:"interfaceOptions",justify:"justify",label:"label",labelPlacement:"labelPlacement",legacy:"legacy",mode:"mode",multiple:"multiple",name:"name",okText:"okText",placeholder:"placeholder",selectedText:"selectedText",shape:"shape",toggleIcon:"toggleIcon",value:"value"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["cancelText","color","compareWith","disabled","expandedIcon","fill","interface","interfaceOptions","justify","label","labelPlacement","legacy","mode","multiple","name","okText","placeholder","selectedText","shape","toggleIcon","value"],methods:["open"]})],R),R})(),qi=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-select-option"]],inputs:{disabled:"disabled",value:"value"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["disabled","value"]})],R),R})(),Kr=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-spinner"]],inputs:{color:"color",duration:"duration",name:"name",paused:"paused"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["color","duration","name","paused"]})],R),R})(),Yt=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement,pe(this,this.el,["ionSplitPaneVisible"])}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-split-pane"]],inputs:{contentId:"contentId",disabled:"disabled",when:"when"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["contentId","disabled","when"]})],R),R})(),wn=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement,pe(this,this.el,["ionChange","ionInput","ionBlur","ionFocus"])}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-textarea"]],inputs:{autoGrow:"autoGrow",autocapitalize:"autocapitalize",autofocus:"autofocus",clearOnEdit:"clearOnEdit",color:"color",cols:"cols",counter:"counter",counterFormatter:"counterFormatter",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",errorText:"errorText",fill:"fill",helperText:"helperText",inputmode:"inputmode",label:"label",labelPlacement:"labelPlacement",legacy:"legacy",maxlength:"maxlength",minlength:"minlength",mode:"mode",name:"name",placeholder:"placeholder",readonly:"readonly",required:"required",rows:"rows",shape:"shape",spellcheck:"spellcheck",value:"value",wrap:"wrap"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["autoGrow","autocapitalize","autofocus","clearOnEdit","color","cols","counter","counterFormatter","debounce","disabled","enterkeyhint","errorText","fill","helperText","inputmode","label","labelPlacement","legacy","maxlength","minlength","mode","name","placeholder","readonly","required","rows","shape","spellcheck","value","wrap"],methods:["setFocus","getInputElement"]})],R),R})(),It=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-thumbnail"]],ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({})],R),R})(),Xn=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-title"]],inputs:{color:"color",size:"size"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["color","size"]})],R),R})(),Wn=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement,pe(this,this.el,["ionChange","ionFocus","ionBlur"])}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-toggle"]],inputs:{alignment:"alignment",checked:"checked",color:"color",disabled:"disabled",enableOnOffLabels:"enableOnOffLabels",justify:"justify",labelPlacement:"labelPlacement",legacy:"legacy",mode:"mode",name:"name",value:"value"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["alignment","checked","color","disabled","enableOnOffLabels","justify","labelPlacement","legacy","mode","name","value"]})],R),R})(),lr=(()=>{let R=class{constructor(H,Ze,Bt){this.z=Bt,H.detach(),this.el=Ze.nativeElement}};return R.\u0275fac=function(H){return new(H||R)(h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(h.R0b))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-toolbar"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R=(0,a.gn)([ie({inputs:["color","mode"]})],R),R})(),Je=(()=>{class R extends X.jP{constructor(H,Ze,Bt,Vi,Tr,ji,Ko,Mo){super(H,Ze,Bt,Vi,Tr,ji,Ko,Mo),this.parentOutlet=Mo}}return R.\u0275fac=function(H){return new(H||R)(h.$8M("name"),h.$8M("tabs"),h.Y36(K.Ye),h.Y36(h.SBq),h.Y36(C.F0),h.Y36(h.R0b),h.Y36(C.gz),h.Y36(R,12))},R.\u0275dir=h.lG2({type:R,selectors:[["ion-router-outlet"]],features:[h.qOj]}),R})(),we=(()=>{class R extends X.oU{constructor(H,Ze,Bt,Vi,Tr,ji){super(H,Ze,Bt,Vi,Tr,ji)}}return R.\u0275fac=function(H){return new(H||R)(h.Y36(Je,8),h.Y36(X.SH),h.Y36(X.De),h.Y36(h.SBq),h.Y36(h.R0b),h.Y36(h.sBO))},R.\u0275cmp=h.Xpm({type:R,selectors:[["ion-back-button"]],features:[h.qOj],ngContentSelectors:lt,decls:1,vars:0,template:function(H,Ze){1&H&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),R})(),dt=(()=>{class R extends X.j{}return R.\u0275fac=(()=>{let $e;return function(Ze){return($e||($e=h.n5z(R)))(Ze||R)}})(),R.\u0275dir=h.lG2({type:R,selectors:[["","routerLink","",5,"a",5,"area"]],features:[h.qOj]}),R})();const di={provide:p.Cf,useExisting:(0,h.Gpc)(()=>Kn),multi:!0};let Kn=(()=>{class R extends p.Fd{}return R.\u0275fac=(()=>{let $e;return function(Ze){return($e||($e=h.n5z(R)))(Ze||R)}})(),R.\u0275dir=h.lG2({type:R,selectors:[["ion-input","type","number","max","","formControlName",""],["ion-input","type","number","max","","formControl",""],["ion-input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(H,Ze){2&H&&h.uIk("max",Ze._enabled?Ze.max:null)},features:[h._Bn([di]),h.qOj]}),R})();const Xi={provide:p.Cf,useExisting:(0,h.Gpc)(()=>J),multi:!0};let J=(()=>{class R extends p.qQ{}return R.\u0275fac=(()=>{let $e;return function(Ze){return($e||($e=h.n5z(R)))(Ze||R)}})(),R.\u0275dir=h.lG2({type:R,selectors:[["ion-input","type","number","min","","formControlName",""],["ion-input","type","number","min","","formControl",""],["ion-input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(H,Ze){2&H&&h.uIk("min",Ze._enabled?Ze.min:null)},features:[h._Bn([Xi]),h.qOj]}),R})(),be=(()=>{class R extends X.xs{constructor(){super(Ye.a)}}return R.\u0275fac=function(H){return new(H||R)},R.\u0275prov=h.Yz7({token:R,factory:R.\u0275fac,providedIn:"root"}),R})(),mt=(()=>{class R extends X.xs{constructor(){super(Ye.b)}}return R.\u0275fac=function(H){return new(H||R)},R.\u0275prov=h.Yz7({token:R,factory:R.\u0275fac,providedIn:"root"}),R})(),jt=(()=>{class R extends X.xs{constructor(){super(Ye.l)}}return R.\u0275fac=function(H){return new(H||R)},R.\u0275prov=h.Yz7({token:R,factory:R.\u0275fac,providedIn:"root"}),R})(),$n=(()=>{class R extends X.xs{constructor(){super(Ye.m),this.angularDelegate=(0,h.f3M)(X.y4),this.injector=(0,h.f3M)(h.zs3),this.environmentInjector=(0,h.f3M)(h.lqb)}create(H){return super.create({...H,delegate:this.angularDelegate.create(this.environmentInjector,this.injector,"modal")})}}return R.\u0275fac=function(H){return new(H||R)},R.\u0275prov=h.Yz7({token:R,factory:R.\u0275fac}),R})();class Ln extends X.xs{constructor(){super(Ye.c),this.angularDelegate=(0,h.f3M)(X.y4),this.injector=(0,h.f3M)(h.zs3),this.environmentInjector=(0,h.f3M)(h.lqb)}create($e){return super.create({...$e,delegate:this.angularDelegate.create(this.environmentInjector,this.injector,"popover")})}}let ci=(()=>{class R extends X.xs{constructor(){super(Ye.t)}}return R.\u0275fac=function(H){return new(H||R)},R.\u0275prov=h.Yz7({token:R,factory:R.\u0275fac,providedIn:"root"}),R})();const Ri=(R,$e,H)=>()=>{if($e.defaultView&&typeof window<"u"){(0,De.s)({...R,_zoneGate:Vi=>H.run(Vi)});const Bt="__zone_symbol__addEventListener"in $e.body?"__zone_symbol__addEventListener":"addEventListener";return function Ne(){var R=[];if(typeof window<"u"){var $e=window;(!$e.customElements||$e.Element&&(!$e.Element.prototype.closest||!$e.Element.prototype.matches||!$e.Element.prototype.remove||!$e.Element.prototype.getRootNode))&&R.push(S.e(6748).then(S.t.bind(S,3342,23))),("function"!=typeof Object.assign||!Object.entries||!Array.prototype.find||!Array.prototype.includes||!String.prototype.startsWith||!String.prototype.endsWith||$e.NodeList&&!$e.NodeList.prototype.forEach||!$e.fetch||!function(){try{var Ze=new URL("b","http://a");return Ze.pathname="c%20d","http://a/c%20d"===Ze.href&&Ze.searchParams}catch{return!1}}()||typeof WeakMap>"u")&&R.push(S.e(2214).then(S.t.bind(S,2668,23)))}return Promise.all(R)}().then(()=>((R,$e)=>{if(!(typeof window>"u"))return Ae(),(0,de.b)(JSON.parse('[["ion-menu_3",[[33,"ion-menu-button",{"color":[513],"disabled":[4],"menu":[1],"autoHide":[4,"auto-hide"],"type":[1],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]],[33,"ion-menu",{"contentId":[513,"content-id"],"menuId":[513,"menu-id"],"type":[1025],"disabled":[1028],"side":[513],"swipeGesture":[4,"swipe-gesture"],"maxEdgeStart":[2,"max-edge-start"],"isPaneVisible":[32],"isEndSide":[32],"isOpen":[64],"isActive":[64],"open":[64],"close":[64],"toggle":[64],"setOpen":[64]},[[16,"ionSplitPaneVisible","onSplitPaneChanged"],[2,"click","onBackdropClick"],[0,"keydown","onKeydown"]],{"type":["typeChanged"],"disabled":["disabledChanged"],"side":["sideChanged"],"swipeGesture":["swipeGestureChanged"]}],[1,"ion-menu-toggle",{"menu":[1],"autoHide":[4,"auto-hide"],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]]]],["ion-fab_3",[[33,"ion-fab-button",{"color":[513],"activated":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1],"show":[4],"translucent":[4],"type":[1],"size":[1],"closeIcon":[1,"close-icon"]}],[1,"ion-fab",{"horizontal":[1],"vertical":[1],"edge":[4],"activated":[1028],"close":[64],"toggle":[64]},null,{"activated":["activatedChanged"]}],[1,"ion-fab-list",{"activated":[4],"side":[1]},null,{"activated":["activatedChanged"]}]]],["ion-refresher_2",[[0,"ion-refresher-content",{"pullingIcon":[1025,"pulling-icon"],"pullingText":[1,"pulling-text"],"refreshingSpinner":[1025,"refreshing-spinner"],"refreshingText":[1,"refreshing-text"]}],[32,"ion-refresher",{"pullMin":[2,"pull-min"],"pullMax":[2,"pull-max"],"closeDuration":[1,"close-duration"],"snapbackDuration":[1,"snapback-duration"],"pullFactor":[2,"pull-factor"],"disabled":[4],"nativeRefresher":[32],"state":[32],"complete":[64],"cancel":[64],"getProgress":[64]},null,{"disabled":["disabledChanged"]}]]],["ion-back-button",[[33,"ion-back-button",{"color":[513],"defaultHref":[1025,"default-href"],"disabled":[516],"icon":[1],"text":[1],"type":[1],"routerAnimation":[16]}]]],["ion-toast",[[33,"ion-toast",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"color":[513],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"duration":[2],"header":[1],"layout":[1],"message":[1],"keyboardClose":[4,"keyboard-close"],"position":[1],"positionAnchor":[1,"position-anchor"],"buttons":[16],"translucent":[4],"animated":[4],"icon":[1],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"revealContentToScreenReader":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},null,{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}]]],["ion-card_5",[[33,"ion-card",{"color":[513],"button":[4],"type":[1],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}],[32,"ion-card-content"],[33,"ion-card-header",{"color":[513],"translucent":[4]}],[33,"ion-card-subtitle",{"color":[513]}],[33,"ion-card-title",{"color":[513]}]]],["ion-item-option_3",[[33,"ion-item-option",{"color":[513],"disabled":[4],"download":[1],"expandable":[4],"href":[1],"rel":[1],"target":[1],"type":[1]}],[32,"ion-item-options",{"side":[1],"fireSwipeEvent":[64]}],[0,"ion-item-sliding",{"disabled":[4],"state":[32],"getOpenAmount":[64],"getSlidingRatio":[64],"open":[64],"close":[64],"closeOpened":[64]},null,{"disabled":["disabledChanged"]}]]],["ion-accordion_2",[[49,"ion-accordion",{"value":[1],"disabled":[4],"readonly":[4],"toggleIcon":[1,"toggle-icon"],"toggleIconSlot":[1,"toggle-icon-slot"],"state":[32],"isNext":[32],"isPrevious":[32]},null,{"value":["valueChanged"]}],[33,"ion-accordion-group",{"animated":[4],"multiple":[4],"value":[1025],"disabled":[4],"readonly":[4],"expand":[1],"requestAccordionToggle":[64],"getAccordions":[64]},[[0,"keydown","onKeydown"]],{"value":["valueChanged"],"disabled":["disabledChanged"],"readonly":["readonlyChanged"]}]]],["ion-infinite-scroll_2",[[32,"ion-infinite-scroll-content",{"loadingSpinner":[1025,"loading-spinner"],"loadingText":[1,"loading-text"]}],[0,"ion-infinite-scroll",{"threshold":[1],"disabled":[4],"position":[1],"isLoading":[32],"complete":[64]},null,{"threshold":["thresholdChanged"],"disabled":["disabledChanged"]}]]],["ion-reorder_2",[[33,"ion-reorder",null,[[2,"click","onClick"]]],[0,"ion-reorder-group",{"disabled":[4],"state":[32],"complete":[64]},null,{"disabled":["disabledChanged"]}]]],["ion-segment_2",[[33,"ion-segment-button",{"disabled":[1028],"layout":[1],"type":[1],"value":[8],"checked":[32],"setFocus":[64]},null,{"value":["valueChanged"]}],[33,"ion-segment",{"color":[513],"disabled":[4],"scrollable":[4],"swipeGesture":[4,"swipe-gesture"],"value":[1032],"selectOnFocus":[4,"select-on-focus"],"activated":[32]},[[0,"keydown","onKeyDown"]],{"color":["colorChanged"],"swipeGesture":["swipeGestureChanged"],"value":["valueChanged"],"disabled":["disabledChanged"]}]]],["ion-tab-bar_2",[[33,"ion-tab-button",{"disabled":[4],"download":[1],"href":[1],"rel":[1],"layout":[1025],"selected":[1028],"tab":[1],"target":[1]},[[8,"ionTabBarChanged","onTabBarChanged"]]],[33,"ion-tab-bar",{"color":[513],"selectedTab":[1,"selected-tab"],"translucent":[4],"keyboardVisible":[32]},null,{"selectedTab":["selectedTabChanged"]}]]],["ion-chip",[[33,"ion-chip",{"color":[513],"outline":[4],"disabled":[4]}]]],["ion-datetime-button",[[33,"ion-datetime-button",{"color":[513],"disabled":[516],"datetime":[1],"datetimePresentation":[32],"dateText":[32],"timeText":[32],"datetimeActive":[32],"selectedButton":[32]}]]],["ion-input",[[38,"ion-input",{"color":[513],"accept":[1],"autocapitalize":[1],"autocomplete":[1],"autocorrect":[1],"autofocus":[4],"clearInput":[4,"clear-input"],"clearOnEdit":[4,"clear-on-edit"],"counter":[4],"counterFormatter":[16],"debounce":[2],"disabled":[4],"enterkeyhint":[1],"errorText":[1,"error-text"],"fill":[1],"inputmode":[1],"helperText":[1,"helper-text"],"label":[1],"labelPlacement":[1,"label-placement"],"legacy":[4],"max":[8],"maxlength":[2],"min":[8],"minlength":[2],"multiple":[4],"name":[1],"pattern":[1],"placeholder":[1],"readonly":[4],"required":[4],"shape":[1],"spellcheck":[4],"step":[1],"size":[2],"type":[1],"value":[1032],"hasFocus":[32],"setFocus":[64],"getInputElement":[64]},null,{"debounce":["debounceChanged"],"disabled":["disabledChanged"],"placeholder":["placeholderChanged"],"value":["valueChanged"]}]]],["ion-searchbar",[[34,"ion-searchbar",{"color":[513],"animated":[4],"autocomplete":[1],"autocorrect":[1],"cancelButtonIcon":[1,"cancel-button-icon"],"cancelButtonText":[1,"cancel-button-text"],"clearIcon":[1,"clear-icon"],"debounce":[2],"disabled":[4],"inputmode":[1],"enterkeyhint":[1],"name":[1],"placeholder":[1],"searchIcon":[1,"search-icon"],"showCancelButton":[1,"show-cancel-button"],"showClearButton":[1,"show-clear-button"],"spellcheck":[4],"type":[1],"value":[1025],"focused":[32],"noAnimate":[32],"setFocus":[64],"getInputElement":[64]},null,{"debounce":["debounceChanged"],"value":["valueChanged"],"showCancelButton":["showCancelButtonChanged"]}]]],["ion-toggle",[[33,"ion-toggle",{"color":[513],"name":[1],"checked":[1028],"disabled":[4],"value":[1],"enableOnOffLabels":[4,"enable-on-off-labels"],"labelPlacement":[1,"label-placement"],"legacy":[4],"justify":[1],"alignment":[1],"activated":[32]},null,{"disabled":["disabledChanged"]}]]],["ion-nav_2",[[1,"ion-nav",{"delegate":[16],"swipeGesture":[1028,"swipe-gesture"],"animated":[4],"animation":[16],"rootParams":[16],"root":[1],"push":[64],"insert":[64],"insertPages":[64],"pop":[64],"popTo":[64],"popToRoot":[64],"removeIndex":[64],"setRoot":[64],"setPages":[64],"setRouteId":[64],"getRouteId":[64],"getActive":[64],"getByIndex":[64],"canGoBack":[64],"getPrevious":[64]},null,{"swipeGesture":["swipeGestureChanged"],"root":["rootChanged"]}],[0,"ion-nav-link",{"component":[1],"componentProps":[16],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}]]],["ion-textarea",[[38,"ion-textarea",{"color":[513],"autocapitalize":[1],"autofocus":[4],"clearOnEdit":[4,"clear-on-edit"],"debounce":[2],"disabled":[4],"fill":[1],"inputmode":[1],"enterkeyhint":[1],"maxlength":[2],"minlength":[2],"name":[1],"placeholder":[1],"readonly":[4],"required":[4],"spellcheck":[4],"cols":[514],"rows":[2],"wrap":[1],"autoGrow":[516,"auto-grow"],"value":[1025],"counter":[4],"counterFormatter":[16],"errorText":[1,"error-text"],"helperText":[1,"helper-text"],"label":[1],"labelPlacement":[1,"label-placement"],"legacy":[4],"shape":[1],"hasFocus":[32],"setFocus":[64],"getInputElement":[64]},null,{"debounce":["debounceChanged"],"disabled":["disabledChanged"],"value":["valueChanged"]}]]],["ion-backdrop",[[33,"ion-backdrop",{"visible":[4],"tappable":[4],"stopPropagation":[4,"stop-propagation"]},[[2,"click","onMouseDown"]]]]],["ion-loading",[[34,"ion-loading",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"message":[1],"cssClass":[1,"css-class"],"duration":[2],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"spinner":[1025],"translucent":[4],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},null,{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}]]],["ion-breadcrumb_2",[[33,"ion-breadcrumb",{"collapsed":[4],"last":[4],"showCollapsedIndicator":[4,"show-collapsed-indicator"],"color":[1],"active":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"separator":[4],"target":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}],[33,"ion-breadcrumbs",{"color":[513],"maxItems":[2,"max-items"],"itemsBeforeCollapse":[2,"items-before-collapse"],"itemsAfterCollapse":[2,"items-after-collapse"],"collapsed":[32],"activeChanged":[32]},[[0,"collapsedClick","onCollapsedClick"]],{"maxItems":["maxItemsChanged"],"itemsBeforeCollapse":["maxItemsChanged"],"itemsAfterCollapse":["maxItemsChanged"]}]]],["ion-modal",[[33,"ion-modal",{"hasController":[4,"has-controller"],"overlayIndex":[2,"overlay-index"],"delegate":[16],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"breakpoints":[16],"initialBreakpoint":[2,"initial-breakpoint"],"backdropBreakpoint":[2,"backdrop-breakpoint"],"handle":[4],"handleBehavior":[1,"handle-behavior"],"component":[1],"componentProps":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"animated":[4],"presentingElement":[16],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"keepContentsMounted":[4,"keep-contents-mounted"],"canDismiss":[4,"can-dismiss"],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"setCurrentBreakpoint":[64],"getCurrentBreakpoint":[64]},null,{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}]]],["ion-route_4",[[0,"ion-route",{"url":[1],"component":[1],"componentProps":[16],"beforeLeave":[16],"beforeEnter":[16]},null,{"url":["onUpdate"],"component":["onUpdate"],"componentProps":["onComponentProps"]}],[0,"ion-route-redirect",{"from":[1],"to":[1]},null,{"from":["propDidChange"],"to":["propDidChange"]}],[0,"ion-router",{"root":[1],"useHash":[4,"use-hash"],"canTransition":[64],"push":[64],"back":[64],"printDebug":[64],"navChanged":[64]},[[8,"popstate","onPopState"],[4,"ionBackButton","onBackButton"]]],[1,"ion-router-link",{"color":[513],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}]]],["ion-avatar_3",[[33,"ion-avatar"],[33,"ion-badge",{"color":[513]}],[1,"ion-thumbnail"]]],["ion-col_3",[[1,"ion-col",{"offset":[1],"offsetXs":[1,"offset-xs"],"offsetSm":[1,"offset-sm"],"offsetMd":[1,"offset-md"],"offsetLg":[1,"offset-lg"],"offsetXl":[1,"offset-xl"],"pull":[1],"pullXs":[1,"pull-xs"],"pullSm":[1,"pull-sm"],"pullMd":[1,"pull-md"],"pullLg":[1,"pull-lg"],"pullXl":[1,"pull-xl"],"push":[1],"pushXs":[1,"push-xs"],"pushSm":[1,"push-sm"],"pushMd":[1,"push-md"],"pushLg":[1,"push-lg"],"pushXl":[1,"push-xl"],"size":[1],"sizeXs":[1,"size-xs"],"sizeSm":[1,"size-sm"],"sizeMd":[1,"size-md"],"sizeLg":[1,"size-lg"],"sizeXl":[1,"size-xl"]},[[9,"resize","onResize"]]],[1,"ion-grid",{"fixed":[4]}],[1,"ion-row"]]],["ion-tab_2",[[1,"ion-tab",{"active":[1028],"delegate":[16],"tab":[1],"component":[1],"setActive":[64]},null,{"active":["changeActive"]}],[1,"ion-tabs",{"useRouter":[1028,"use-router"],"selectedTab":[32],"select":[64],"getTab":[64],"getSelected":[64],"setRouteId":[64],"getRouteId":[64]}]]],["ion-img",[[1,"ion-img",{"alt":[1],"src":[1],"loadSrc":[32],"loadError":[32]},null,{"src":["srcChanged"]}]]],["ion-progress-bar",[[33,"ion-progress-bar",{"type":[1],"reversed":[4],"value":[2],"buffer":[2],"color":[513]}]]],["ion-range",[[33,"ion-range",{"color":[513],"debounce":[2],"name":[1],"label":[1],"dualKnobs":[4,"dual-knobs"],"min":[2],"max":[2],"pin":[4],"pinFormatter":[16],"snaps":[4],"step":[2],"ticks":[4],"activeBarStart":[1026,"active-bar-start"],"disabled":[4],"value":[1026],"labelPlacement":[1,"label-placement"],"legacy":[4],"ratioA":[32],"ratioB":[32],"pressedKnob":[32]},null,{"debounce":["debounceChanged"],"min":["minChanged"],"max":["maxChanged"],"activeBarStart":["activeBarStartChanged"],"disabled":["disabledChanged"],"value":["valueChanged"]}]]],["ion-split-pane",[[33,"ion-split-pane",{"contentId":[513,"content-id"],"disabled":[4],"when":[8],"visible":[32]},null,{"visible":["visibleChanged"],"disabled":["updateState"],"when":["updateState"]}]]],["ion-text",[[1,"ion-text",{"color":[513]}]]],["ion-item_8",[[33,"ion-item-divider",{"color":[513],"sticky":[4]}],[32,"ion-item-group"],[1,"ion-skeleton-text",{"animated":[4]}],[32,"ion-list",{"lines":[1],"inset":[4],"closeSlidingItems":[64]}],[33,"ion-list-header",{"color":[513],"lines":[1]}],[49,"ion-item",{"color":[513],"button":[4],"detail":[4],"detailIcon":[1,"detail-icon"],"disabled":[4],"download":[1],"fill":[1],"shape":[1],"href":[1],"rel":[1],"lines":[1],"counter":[4],"routerAnimation":[16],"routerDirection":[1,"router-direction"],"target":[1],"type":[1],"counterFormatter":[16],"multipleInputs":[32],"focusable":[32],"counterString":[32]},[[0,"ionInput","handleIonInput"],[0,"ionColor","labelColorChanged"],[0,"ionStyle","itemStyle"]],{"counterFormatter":["counterFormatterChanged"]}],[34,"ion-label",{"color":[513],"position":[1],"noAnimate":[32]},null,{"color":["colorChanged"],"position":["positionChanged"]}],[33,"ion-note",{"color":[513]}]]],["ion-select_3",[[33,"ion-select",{"cancelText":[1,"cancel-text"],"color":[513],"compareWith":[1,"compare-with"],"disabled":[4],"fill":[1],"interface":[1],"interfaceOptions":[8,"interface-options"],"justify":[1],"label":[1],"labelPlacement":[1,"label-placement"],"legacy":[4],"multiple":[4],"name":[1],"okText":[1,"ok-text"],"placeholder":[1],"selectedText":[1,"selected-text"],"toggleIcon":[1,"toggle-icon"],"expandedIcon":[1,"expanded-icon"],"shape":[1],"value":[1032],"isExpanded":[32],"open":[64]},null,{"disabled":["styleChanged"],"isExpanded":["styleChanged"],"placeholder":["styleChanged"],"value":["styleChanged"]}],[1,"ion-select-option",{"disabled":[4],"value":[8]}],[34,"ion-select-popover",{"header":[1],"subHeader":[1,"sub-header"],"message":[1],"multiple":[4],"options":[16]}]]],["ion-picker-internal",[[33,"ion-picker-internal",{"exitInputMode":[64]},[[1,"touchstart","preventTouchStartPropagation"]]]]],["ion-datetime_3",[[33,"ion-datetime",{"color":[1],"name":[1],"disabled":[4],"readonly":[4],"isDateEnabled":[16],"min":[1025],"max":[1025],"presentation":[1],"cancelText":[1,"cancel-text"],"doneText":[1,"done-text"],"clearText":[1,"clear-text"],"yearValues":[8,"year-values"],"monthValues":[8,"month-values"],"dayValues":[8,"day-values"],"hourValues":[8,"hour-values"],"minuteValues":[8,"minute-values"],"locale":[1],"firstDayOfWeek":[2,"first-day-of-week"],"titleSelectedDatesFormatter":[16],"multiple":[4],"highlightedDates":[16],"value":[1025],"showDefaultTitle":[4,"show-default-title"],"showDefaultButtons":[4,"show-default-buttons"],"showClearButton":[4,"show-clear-button"],"showDefaultTimeLabel":[4,"show-default-time-label"],"hourCycle":[1,"hour-cycle"],"size":[1],"preferWheel":[4,"prefer-wheel"],"showMonthAndYear":[32],"activeParts":[32],"workingParts":[32],"isTimePopoverOpen":[32],"forceRenderDate":[32],"confirm":[64],"reset":[64],"cancel":[64]},null,{"disabled":["disabledChanged"],"min":["minChanged"],"max":["maxChanged"],"yearValues":["yearValuesChanged"],"monthValues":["monthValuesChanged"],"dayValues":["dayValuesChanged"],"hourValues":["hourValuesChanged"],"minuteValues":["minuteValuesChanged"],"value":["valueChanged"]}],[34,"ion-picker",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"columns":[16],"cssClass":[1,"css-class"],"duration":[2],"showBackdrop":[4,"show-backdrop"],"backdropDismiss":[4,"backdrop-dismiss"],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"getColumn":[64]},null,{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}],[32,"ion-picker-column",{"col":[16]},null,{"col":["colChanged"]}]]],["ion-radio_2",[[33,"ion-radio",{"color":[513],"name":[1],"disabled":[4],"value":[8],"labelPlacement":[1,"label-placement"],"legacy":[4],"justify":[1],"alignment":[1],"checked":[32],"buttonTabindex":[32],"setFocus":[64],"setButtonTabindex":[64]},null,{"value":["valueChanged"],"checked":["styleChanged"],"color":["styleChanged"],"disabled":["styleChanged"]}],[0,"ion-radio-group",{"allowEmptySelection":[4,"allow-empty-selection"],"name":[1],"value":[1032]},[[4,"keydown","onKeydown"]],{"value":["valueChanged"]}]]],["ion-ripple-effect",[[1,"ion-ripple-effect",{"type":[1],"addRipple":[64]}]]],["ion-button_2",[[33,"ion-button",{"color":[513],"buttonType":[1025,"button-type"],"disabled":[516],"expand":[513],"fill":[1537],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"download":[1],"href":[1],"rel":[1],"shape":[513],"size":[513],"strong":[4],"target":[1],"type":[1],"form":[1]},null,{"disabled":["disabledChanged"]}],[1,"ion-icon",{"mode":[1025],"color":[1],"ios":[1],"md":[1],"flipRtl":[4,"flip-rtl"],"name":[513],"src":[1],"icon":[8],"size":[1],"lazy":[4],"sanitize":[4],"svgContent":[32],"isVisible":[32]},null,{"name":["loadIcon"],"src":["loadIcon"],"icon":["loadIcon"],"ios":["loadIcon"],"md":["loadIcon"]}]]],["ion-action-sheet",[[34,"ion-action-sheet",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"header":[1],"subHeader":[1,"sub-header"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},null,{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}]]],["ion-alert",[[34,"ion-alert",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"header":[1],"subHeader":[1,"sub-header"],"message":[1],"buttons":[16],"inputs":[1040],"backdropDismiss":[4,"backdrop-dismiss"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},[[4,"keydown","onKeydown"]],{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"],"buttons":["buttonsChanged"],"inputs":["inputsChanged"]}]]],["ion-app_8",[[0,"ion-app",{"setFocus":[64]}],[1,"ion-content",{"color":[513],"fullscreen":[4],"forceOverscroll":[1028,"force-overscroll"],"scrollX":[4,"scroll-x"],"scrollY":[4,"scroll-y"],"scrollEvents":[4,"scroll-events"],"getScrollElement":[64],"getBackgroundElement":[64],"scrollToTop":[64],"scrollToBottom":[64],"scrollByPoint":[64],"scrollToPoint":[64]},[[9,"resize","onResize"]]],[36,"ion-footer",{"collapse":[1],"translucent":[4],"keyboardVisible":[32]}],[36,"ion-header",{"collapse":[1],"translucent":[4]}],[1,"ion-router-outlet",{"mode":[1025],"delegate":[16],"animated":[4],"animation":[16],"swipeHandler":[16],"commit":[64],"setRouteId":[64],"getRouteId":[64]},null,{"swipeHandler":["swipeHandlerChanged"]}],[33,"ion-title",{"color":[513],"size":[1]},null,{"size":["sizeChanged"]}],[33,"ion-toolbar",{"color":[513]},[[0,"ionStyle","childrenStyle"]]],[34,"ion-buttons",{"collapse":[4]}]]],["ion-picker-column-internal",[[33,"ion-picker-column-internal",{"items":[16],"value":[1032],"color":[513],"numericInput":[4,"numeric-input"],"isActive":[32],"scrollActiveItemIntoView":[64],"setValue":[64]},null,{"value":["valueChange"]}]]],["ion-popover",[[33,"ion-popover",{"hasController":[4,"has-controller"],"delegate":[16],"overlayIndex":[2,"overlay-index"],"enterAnimation":[16],"leaveAnimation":[16],"component":[1],"componentProps":[16],"keyboardClose":[4,"keyboard-close"],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"event":[8],"showBackdrop":[4,"show-backdrop"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"triggerAction":[1,"trigger-action"],"trigger":[1],"size":[1],"dismissOnSelect":[4,"dismiss-on-select"],"reference":[1],"side":[1],"alignment":[1025],"arrow":[4],"isOpen":[4,"is-open"],"keyboardEvents":[4,"keyboard-events"],"keepContentsMounted":[4,"keep-contents-mounted"],"presented":[32],"presentFromTrigger":[64],"present":[64],"dismiss":[64],"getParentPopover":[64],"onDidDismiss":[64],"onWillDismiss":[64]},null,{"trigger":["onTriggerChange"],"triggerAction":["onTriggerChange"],"isOpen":["onIsOpenChange"]}]]],["ion-checkbox",[[33,"ion-checkbox",{"color":[513],"name":[1],"checked":[1028],"indeterminate":[1028],"disabled":[4],"value":[8],"labelPlacement":[1,"label-placement"],"justify":[1],"alignment":[1],"legacy":[4]},null,{"checked":["styleChanged"],"disabled":["styleChanged"]}]]],["ion-spinner",[[1,"ion-spinner",{"color":[513],"duration":[2],"name":[1],"paused":[4]}]]]]'),$e)})(0,{exclude:["ion-tabs","ion-tab"],syncQueue:!0,raf:X.Wn,jmp:Vi=>H.runOutsideAngular(Vi),ael(Vi,Tr,ji,Ko){Vi[Bt](Tr,ji,Ko)},rel(Vi,Tr,ji,Ko){Vi.removeEventListener(Tr,ji,Ko)}}))}};let ur=(()=>{class R{static forRoot(H){return{ngModule:R,providers:[{provide:X.dy,useValue:H},{provide:h.ip1,useFactory:Ri,multi:!0,deps:[X.dy,K.K0,h.R0b]},(0,X.DN)()]}}}return R.\u0275fac=function(H){return new(H||R)},R.\u0275mod=h.oAB({type:R}),R.\u0275inj=h.cJS({providers:[X.y4,$n,Ln],imports:[K.ez]}),R})()},3999:(zn,wt,S)=>{"use strict";S.d(wt,{Zw:()=>Ye,aw:()=>ke,X$:()=>$t,sK:()=>cn});var h=S(8564),p=S(2096),X=S(2664),a=S(9315),j=S(5211),K=S(4911),C=S(8180),oe=S(8645),_e=S(4552);class Le extends oe.x{constructor(Oe=1/0,ie=1/0,it=_e.l){super(),this._bufferSize=Oe,this._windowTime=ie,this._timestampProvider=it,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=ie===1/0,this._bufferSize=Math.max(1,Oe),this._windowTime=Math.max(1,ie)}next(Oe){const{isStopped:ie,_buffer:it,_infiniteTimeWindow:_t,_timestampProvider:Kt,_windowTime:Mn}=this;ie||(it.push(Oe),!_t&&it.push(Kt.now()+Mn)),this._trimBuffer(),super.next(Oe)}_subscribe(Oe){this._throwIfClosed(),this._trimBuffer();const ie=this._innerSubscribe(Oe),{_infiniteTimeWindow:it,_buffer:_t}=this,Kt=_t.slice();for(let Mn=0;Mn<Kt.length&&!Oe.closed;Mn+=it?1:2)Oe.next(Kt[Mn]);return this._checkFinalizedStatuses(Oe),ie}_trimBuffer(){const{_bufferSize:Oe,_timestampProvider:ie,_buffer:it,_infiniteTimeWindow:_t}=this,Kt=(_t?1:2)*Oe;if(Oe<1/0&&Kt<it.length&&it.splice(0,it.length-Kt),!_t){const Mn=ie.now();let fn=0;for(let qn=1;qn<it.length&&it[qn]<=Mn;qn+=2)fn=qn;fn&&it.splice(0,fn+1)}}}var ee=S(3020);function Te(pe,Oe,ie){let it,_t=!1;return pe&&"object"==typeof pe?({bufferSize:it=1/0,windowTime:Oe=1/0,refCount:_t=!1,scheduler:ie}=pe):it=pe??1/0,(0,ee.B)({connector:()=>new Le(it,Oe,ie),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:_t})}var ye=S(7398),De=S(6328),me=S(4664);class Ye{}let Ce=(()=>{class pe extends Ye{getTranslation(ie){return(0,p.of)({})}static \u0275fac=(()=>{let ie;return function(_t){return(ie||(ie=h.n5z(pe)))(_t||pe)}})();static \u0275prov=h.Yz7({token:pe,factory:pe.\u0275fac})}return pe})();class de{}let Pe=(()=>{class pe{handle(ie){return ie.key}static \u0275fac=function(it){return new(it||pe)};static \u0275prov=h.Yz7({token:pe,factory:pe.\u0275fac})}return pe})();function Be(pe,Oe){if(pe===Oe)return!0;if(null===pe||null===Oe)return!1;if(pe!=pe&&Oe!=Oe)return!0;let _t,Kt,Mn,ie=typeof pe;if(ie==typeof Oe&&"object"==ie){if(!Array.isArray(pe)){if(Array.isArray(Oe))return!1;for(Kt in Mn=Object.create(null),pe){if(!Be(pe[Kt],Oe[Kt]))return!1;Mn[Kt]=!0}for(Kt in Oe)if(!(Kt in Mn)&&typeof Oe[Kt]<"u")return!1;return!0}if(!Array.isArray(Oe))return!1;if((_t=pe.length)==Oe.length){for(Kt=0;Kt<_t;Kt++)if(!Be(pe[Kt],Oe[Kt]))return!1;return!0}}return!1}function Ne(pe){return typeof pe<"u"&&null!==pe}function Ae(pe){return pe&&"object"==typeof pe&&!Array.isArray(pe)}function Ge(pe,Oe){let ie=Object.assign({},pe);return Ae(pe)&&Ae(Oe)&&Object.keys(Oe).forEach(it=>{Ae(Oe[it])?it in pe?ie[it]=Ge(pe[it],Oe[it]):Object.assign(ie,{[it]:Oe[it]}):Object.assign(ie,{[it]:Oe[it]})}),ie}class lt{}let ne=(()=>{class pe extends lt{templateMatcher=/{{\s?([^{}\s]*)\s?}}/g;interpolate(ie,it){let _t;return _t="string"==typeof ie?this.interpolateString(ie,it):"function"==typeof ie?this.interpolateFunction(ie,it):ie,_t}getValue(ie,it){let _t="string"==typeof it?it.split("."):[it];it="";do{it+=_t.shift(),!Ne(ie)||!Ne(ie[it])||"object"!=typeof ie[it]&&_t.length?_t.length?it+=".":ie=void 0:(ie=ie[it],it="")}while(_t.length);return ie}interpolateFunction(ie,it){return ie(it)}interpolateString(ie,it){return it?ie.replace(this.templateMatcher,(_t,Kt)=>{let Mn=this.getValue(it,Kt);return Ne(Mn)?Mn:_t}):ie}static \u0275fac=(()=>{let ie;return function(_t){return(ie||(ie=h.n5z(pe)))(_t||pe)}})();static \u0275prov=h.Yz7({token:pe,factory:pe.\u0275fac})}return pe})();class Ee{}let xe=(()=>{class pe extends Ee{compile(ie,it){return ie}compileTranslations(ie,it){return ie}static \u0275fac=(()=>{let ie;return function(_t){return(ie||(ie=h.n5z(pe)))(_t||pe)}})();static \u0275prov=h.Yz7({token:pe,factory:pe.\u0275fac})}return pe})();class je{defaultLang;currentLang=this.defaultLang;translations={};langs=[];onTranslationChange=new h.vpe;onLangChange=new h.vpe;onDefaultLangChange=new h.vpe}const Se=new h.OlP("USE_STORE"),Ve=new h.OlP("USE_DEFAULT_LANG"),Xe=new h.OlP("DEFAULT_LANGUAGE"),Ht=new h.OlP("USE_EXTEND");let cn=(()=>{class pe{store;currentLoader;compiler;parser;missingTranslationHandler;useDefaultLang;isolate;extend;loadingTranslations;pending=!1;_onTranslationChange=new h.vpe;_onLangChange=new h.vpe;_onDefaultLangChange=new h.vpe;_defaultLang;_currentLang;_langs=[];_translations={};_translationRequests={};get onTranslationChange(){return this.isolate?this._onTranslationChange:this.store.onTranslationChange}get onLangChange(){return this.isolate?this._onLangChange:this.store.onLangChange}get onDefaultLangChange(){return this.isolate?this._onDefaultLangChange:this.store.onDefaultLangChange}get defaultLang(){return this.isolate?this._defaultLang:this.store.defaultLang}set defaultLang(ie){this.isolate?this._defaultLang=ie:this.store.defaultLang=ie}get currentLang(){return this.isolate?this._currentLang:this.store.currentLang}set currentLang(ie){this.isolate?this._currentLang=ie:this.store.currentLang=ie}get langs(){return this.isolate?this._langs:this.store.langs}set langs(ie){this.isolate?this._langs=ie:this.store.langs=ie}get translations(){return this.isolate?this._translations:this.store.translations}set translations(ie){this.isolate?this._translations=ie:this.store.translations=ie}constructor(ie,it,_t,Kt,Mn,fn=!0,qn=!1,li=!1,en){this.store=ie,this.currentLoader=it,this.compiler=_t,this.parser=Kt,this.missingTranslationHandler=Mn,this.useDefaultLang=fn,this.isolate=qn,this.extend=li,en&&this.setDefaultLang(en)}setDefaultLang(ie){if(ie===this.defaultLang)return;let it=this.retrieveTranslations(ie);typeof it<"u"?(null==this.defaultLang&&(this.defaultLang=ie),it.pipe((0,C.q)(1)).subscribe(_t=>{this.changeDefaultLang(ie)})):this.changeDefaultLang(ie)}getDefaultLang(){return this.defaultLang}use(ie){if(ie===this.currentLang)return(0,p.of)(this.translations[ie]);let it=this.retrieveTranslations(ie);return typeof it<"u"?(this.currentLang||(this.currentLang=ie),it.pipe((0,C.q)(1)).subscribe(_t=>{this.changeLang(ie)}),it):(this.changeLang(ie),(0,p.of)(this.translations[ie]))}retrieveTranslations(ie){let it;return(typeof this.translations[ie]>"u"||this.extend)&&(this._translationRequests[ie]=this._translationRequests[ie]||this.getTranslation(ie),it=this._translationRequests[ie]),it}getTranslation(ie){this.pending=!0;const it=this.currentLoader.getTranslation(ie).pipe(Te(1),(0,C.q)(1));return this.loadingTranslations=it.pipe((0,ye.U)(_t=>this.compiler.compileTranslations(_t,ie)),Te(1),(0,C.q)(1)),this.loadingTranslations.subscribe({next:_t=>{this.translations[ie]=this.extend&&this.translations[ie]?{..._t,...this.translations[ie]}:_t,this.updateLangs(),this.pending=!1},error:_t=>{this.pending=!1}}),it}setTranslation(ie,it,_t=!1){it=this.compiler.compileTranslations(it,ie),this.translations[ie]=(_t||this.extend)&&this.translations[ie]?Ge(this.translations[ie],it):it,this.updateLangs(),this.onTranslationChange.emit({lang:ie,translations:this.translations[ie]})}getLangs(){return this.langs}addLangs(ie){ie.forEach(it=>{-1===this.langs.indexOf(it)&&this.langs.push(it)})}updateLangs(){this.addLangs(Object.keys(this.translations))}getParsedResult(ie,it,_t){let Kt;if(it instanceof Array){let Mn={},fn=!1;for(let qn of it)Mn[qn]=this.getParsedResult(ie,qn,_t),(0,X.b)(Mn[qn])&&(fn=!0);if(fn){const qn=it.map(li=>(0,X.b)(Mn[li])?Mn[li]:(0,p.of)(Mn[li]));return(0,a.D)(qn).pipe((0,ye.U)(li=>{let en={};return li.forEach((Dt,Ie)=>{en[it[Ie]]=Dt}),en}))}return Mn}if(ie&&(Kt=this.parser.interpolate(this.parser.getValue(ie,it),_t)),typeof Kt>"u"&&null!=this.defaultLang&&this.defaultLang!==this.currentLang&&this.useDefaultLang&&(Kt=this.parser.interpolate(this.parser.getValue(this.translations[this.defaultLang],it),_t)),typeof Kt>"u"){let Mn={key:it,translateService:this};typeof _t<"u"&&(Mn.interpolateParams=_t),Kt=this.missingTranslationHandler.handle(Mn)}return typeof Kt<"u"?Kt:it}get(ie,it){if(!Ne(ie)||!ie.length)throw new Error('Parameter "key" required');if(this.pending)return this.loadingTranslations.pipe((0,De.b)(_t=>(_t=this.getParsedResult(_t,ie,it),(0,X.b)(_t)?_t:(0,p.of)(_t))));{let _t=this.getParsedResult(this.translations[this.currentLang],ie,it);return(0,X.b)(_t)?_t:(0,p.of)(_t)}}getStreamOnTranslationChange(ie,it){if(!Ne(ie)||!ie.length)throw new Error('Parameter "key" required');return(0,j.z)((0,K.P)(()=>this.get(ie,it)),this.onTranslationChange.pipe((0,me.w)(_t=>{const Kt=this.getParsedResult(_t.translations,ie,it);return"function"==typeof Kt.subscribe?Kt:(0,p.of)(Kt)})))}stream(ie,it){if(!Ne(ie)||!ie.length)throw new Error('Parameter "key" required');return(0,j.z)((0,K.P)(()=>this.get(ie,it)),this.onLangChange.pipe((0,me.w)(_t=>{const Kt=this.getParsedResult(_t.translations,ie,it);return(0,X.b)(Kt)?Kt:(0,p.of)(Kt)})))}instant(ie,it){if(!Ne(ie)||!ie.length)throw new Error('Parameter "key" required');let _t=this.getParsedResult(this.translations[this.currentLang],ie,it);if((0,X.b)(_t)){if(ie instanceof Array){let Kt={};return ie.forEach((Mn,fn)=>{Kt[ie[fn]]=ie[fn]}),Kt}return ie}return _t}set(ie,it,_t=this.currentLang){this.translations[_t][ie]=this.compiler.compile(it,_t),this.updateLangs(),this.onTranslationChange.emit({lang:_t,translations:this.translations[_t]})}changeLang(ie){this.currentLang=ie,this.onLangChange.emit({lang:ie,translations:this.translations[ie]}),null==this.defaultLang&&this.changeDefaultLang(ie)}changeDefaultLang(ie){this.defaultLang=ie,this.onDefaultLangChange.emit({lang:ie,translations:this.translations[ie]})}reloadLang(ie){return this.resetLang(ie),this.getTranslation(ie)}resetLang(ie){this._translationRequests[ie]=void 0,this.translations[ie]=void 0}getBrowserLang(){if(typeof window>"u"||typeof window.navigator>"u")return;let ie=window.navigator.languages?window.navigator.languages[0]:null;return ie=ie||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,typeof ie>"u"?void 0:(-1!==ie.indexOf("-")&&(ie=ie.split("-")[0]),-1!==ie.indexOf("_")&&(ie=ie.split("_")[0]),ie)}getBrowserCultureLang(){if(typeof window>"u"||typeof window.navigator>"u")return;let ie=window.navigator.languages?window.navigator.languages[0]:null;return ie=ie||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,ie}static \u0275fac=function(it){return new(it||pe)(h.LFG(je),h.LFG(Ye),h.LFG(Ee),h.LFG(lt),h.LFG(de),h.LFG(Ve),h.LFG(Se),h.LFG(Ht),h.LFG(Xe))};static \u0275prov=h.Yz7({token:pe,factory:pe.\u0275fac})}return pe})(),$t=(()=>{class pe{translate;_ref;value="";lastKey=null;lastParams=[];onTranslationChange;onLangChange;onDefaultLangChange;constructor(ie,it){this.translate=ie,this._ref=it}updateValue(ie,it,_t){let Kt=Mn=>{this.value=void 0!==Mn?Mn:ie,this.lastKey=ie,this._ref.markForCheck()};if(_t){let Mn=this.translate.getParsedResult(_t,ie,it);(0,X.b)(Mn.subscribe)?Mn.subscribe(Kt):Kt(Mn)}this.translate.get(ie,it).subscribe(Kt)}transform(ie,...it){if(!ie||!ie.length)return ie;if(Be(ie,this.lastKey)&&Be(it,this.lastParams))return this.value;let _t;if(Ne(it[0])&&it.length)if("string"==typeof it[0]&&it[0].length){let Kt=it[0].replace(/(\')?([a-zA-Z0-9_]+)(\')?(\s)?:/g,'"$2":').replace(/:(\s)?(\')(.*?)(\')/g,':"$3"');try{_t=JSON.parse(Kt)}catch{throw new SyntaxError(`Wrong parameter in TranslatePipe. Expected a valid Object, received: ${it[0]}`)}}else"object"==typeof it[0]&&!Array.isArray(it[0])&&(_t=it[0]);return this.lastKey=ie,this.lastParams=it,this.updateValue(ie,_t),this._dispose(),this.onTranslationChange||(this.onTranslationChange=this.translate.onTranslationChange.subscribe(Kt=>{this.lastKey&&Kt.lang===this.translate.currentLang&&(this.lastKey=null,this.updateValue(ie,_t,Kt.translations))})),this.onLangChange||(this.onLangChange=this.translate.onLangChange.subscribe(Kt=>{this.lastKey&&(this.lastKey=null,this.updateValue(ie,_t,Kt.translations))})),this.onDefaultLangChange||(this.onDefaultLangChange=this.translate.onDefaultLangChange.subscribe(()=>{this.lastKey&&(this.lastKey=null,this.updateValue(ie,_t))})),this.value}_dispose(){typeof this.onTranslationChange<"u"&&(this.onTranslationChange.unsubscribe(),this.onTranslationChange=void 0),typeof this.onLangChange<"u"&&(this.onLangChange.unsubscribe(),this.onLangChange=void 0),typeof this.onDefaultLangChange<"u"&&(this.onDefaultLangChange.unsubscribe(),this.onDefaultLangChange=void 0)}ngOnDestroy(){this._dispose()}static \u0275fac=function(it){return new(it||pe)(h.Y36(cn,16),h.Y36(h.sBO,16))};static \u0275pipe=h.Yjl({name:"translate",type:pe,pure:!1});static \u0275prov=h.Yz7({token:pe,factory:pe.\u0275fac})}return pe})(),ke=(()=>{class pe{static forRoot(ie={}){return{ngModule:pe,providers:[ie.loader||{provide:Ye,useClass:Ce},ie.compiler||{provide:Ee,useClass:xe},ie.parser||{provide:lt,useClass:ne},ie.missingTranslationHandler||{provide:de,useClass:Pe},je,{provide:Se,useValue:ie.isolate},{provide:Ve,useValue:ie.useDefaultLang},{provide:Ht,useValue:ie.extend},{provide:Xe,useValue:ie.defaultLanguage},cn]}}static forChild(ie={}){return{ngModule:pe,providers:[ie.loader||{provide:Ye,useClass:Ce},ie.compiler||{provide:Ee,useClass:xe},ie.parser||{provide:lt,useClass:ne},ie.missingTranslationHandler||{provide:de,useClass:Pe},{provide:Se,useValue:ie.isolate},{provide:Ve,useValue:ie.useDefaultLang},{provide:Ht,useValue:ie.extend},{provide:Xe,useValue:ie.defaultLanguage},cn]}}static \u0275fac=function(it){return new(it||pe)};static \u0275mod=h.oAB({type:pe});static \u0275inj=h.cJS({})}return pe})()},5861:(zn,wt,S)=>{"use strict";function h(X,a,j,K,C,oe,_e){try{var Le=X[oe](_e),ee=Le.value}catch(Te){return void j(Te)}Le.done?a(ee):Promise.resolve(ee).then(K,C)}function p(X){return function(){var a=this,j=arguments;return new Promise(function(K,C){var oe=X.apply(a,j);function _e(ee){h(oe,K,C,_e,Le,"next",ee)}function Le(ee){h(oe,K,C,_e,Le,"throw",ee)}_e(void 0)})}}S.d(wt,{Z:()=>p})},7582:(zn,wt,S)=>{"use strict";function j(ke,pe,Oe,ie){var Kt,it=arguments.length,_t=it<3?pe:null===ie?ie=Object.getOwnPropertyDescriptor(pe,Oe):ie;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)_t=Reflect.decorate(ke,pe,Oe,ie);else for(var Mn=ke.length-1;Mn>=0;Mn--)(Kt=ke[Mn])&&(_t=(it<3?Kt(_t):it>3?Kt(pe,Oe,_t):Kt(pe,Oe))||_t);return it>3&&_t&&Object.defineProperty(pe,Oe,_t),_t}function Te(ke,pe,Oe,ie){return new(Oe||(Oe=Promise))(function(_t,Kt){function Mn(li){try{qn(ie.next(li))}catch(en){Kt(en)}}function fn(li){try{qn(ie.throw(li))}catch(en){Kt(en)}}function qn(li){li.done?_t(li.value):function it(_t){return _t instanceof Oe?_t:new Oe(function(Kt){Kt(_t)})}(li.value).then(Mn,fn)}qn((ie=ie.apply(ke,pe||[])).next())})}function Ne(ke){return this instanceof Ne?(this.v=ke,this):new Ne(ke)}function Ae(ke,pe,Oe){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var it,ie=Oe.apply(ke,pe||[]),_t=[];return it={},Kt("next"),Kt("throw"),Kt("return"),it[Symbol.asyncIterator]=function(){return this},it;function Kt(Dt){ie[Dt]&&(it[Dt]=function(Ie){return new Promise(function(Ct,on){_t.push([Dt,Ie,Ct,on])>1||Mn(Dt,Ie)})})}function Mn(Dt,Ie){try{!function fn(Dt){Dt.value instanceof Ne?Promise.resolve(Dt.value.v).then(qn,li):en(_t[0][2],Dt)}(ie[Dt](Ie))}catch(Ct){en(_t[0][3],Ct)}}function qn(Dt){Mn("next",Dt)}function li(Dt){Mn("throw",Dt)}function en(Dt,Ie){Dt(Ie),_t.shift(),_t.length&&Mn(_t[0][0],_t[0][1])}}function lt(ke){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Oe,pe=ke[Symbol.asyncIterator];return pe?pe.call(ke):(ke=function Ye(ke){var pe="function"==typeof Symbol&&Symbol.iterator,Oe=pe&&ke[pe],ie=0;if(Oe)return Oe.call(ke);if(ke&&"number"==typeof ke.length)return{next:function(){return ke&&ie>=ke.length&&(ke=void 0),{value:ke&&ke[ie++],done:!ke}}};throw new TypeError(pe?"Object is not iterable.":"Symbol.iterator is not defined.")}(ke),Oe={},ie("next"),ie("throw"),ie("return"),Oe[Symbol.asyncIterator]=function(){return this},Oe);function ie(_t){Oe[_t]=ke[_t]&&function(Kt){return new Promise(function(Mn,fn){!function it(_t,Kt,Mn,fn){Promise.resolve(fn).then(function(qn){_t({value:qn,done:Mn})},Kt)}(Mn,fn,(Kt=ke[_t](Kt)).done,Kt.value)})}}}S.d(wt,{FC:()=>Ae,KL:()=>lt,gn:()=>j,mG:()=>Te,qq:()=>Ne}),"function"==typeof SuppressedError&&SuppressedError}},zn=>{zn(zn.s=3108)}]);