(self.webpackChunkapp=self.webpackChunkapp||[]).push([[179],{4244:(Tn,Je,R)=>{"use strict";R.d(Je,{N0:()=>m,Ar:()=>ue});var u=R(6738),d=R(6895),j=R(1709),l=R(5254),L=R(529);const P=new u.OlP("JWT_OPTIONS");let m=(()=>{class V{constructor(K=null){this.tokenGetter=K&&K.tokenGetter||function(){}}urlBase64Decode(K){let re=K.replace(/-/g,"+").replace(/_/g,"/");switch(re.length%4){case 0:break;case 2:re+="==";break;case 3:re+="=";break;default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(re)}b64decode(K){let _e="";if((K=String(K).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let xe,je,ge=0,nt=0;je=K.charAt(nt++);~je&&(xe=ge%4?64*xe+je:je,ge++%4)?_e+=String.fromCharCode(255&xe>>(-2*ge&6)):0)je="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(je);return _e}b64DecodeUnicode(K){return decodeURIComponent(Array.prototype.map.call(this.b64decode(K),re=>"%"+("00"+re.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(K=this.tokenGetter()){if(!K||""===K)return null;const re=K.split(".");if(3!==re.length)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");const _e=this.urlBase64Decode(re[1]);if(!_e)throw new Error("Cannot decode the token.");return JSON.parse(_e)}getTokenExpirationDate(K=this.tokenGetter()){let re;if(re=this.decodeToken(K),!re||!re.hasOwnProperty("exp"))return null;const _e=new Date(0);return _e.setUTCSeconds(re.exp),_e}isTokenExpired(K=this.tokenGetter(),re){if(!K||""===K)return!0;const _e=this.getTokenExpirationDate(K);return re=re||0,null!==_e&&!(_e.valueOf()>(new Date).valueOf()+1e3*re)}getAuthScheme(K,re){return"function"==typeof K?K(re):K}}return V.\u0275fac=function(K){return new(K||V)(u.LFG(P))},V.\u0275prov=u.Yz7({token:V,factory:V.\u0275fac}),V})(),$=(()=>{class V{constructor(K,re,_e){this.jwtHelper=re,this.document=_e,this.standardPorts=["80","443"],this.tokenGetter=K.tokenGetter,this.headerName=K.headerName||"Authorization",this.authScheme=K.authScheme||""===K.authScheme?K.authScheme:"Bearer ",this.allowedDomains=K.allowedDomains||[],this.disallowedRoutes=K.disallowedRoutes||[],this.throwNoTokenError=K.throwNoTokenError||!1,this.skipWhenExpired=K.skipWhenExpired}isAllowedDomain(K){const re=new URL(K.url,this.document.location.origin);if(re.host===this.document.location.host)return!0;const _e=`${re.hostname}${re.port&&!this.standardPorts.includes(re.port)?":"+re.port:""}`;return this.allowedDomains.findIndex(ge=>"string"==typeof ge?ge===_e:ge instanceof RegExp&&ge.test(_e))>-1}isDisallowedRoute(K){const re=new URL(K.url,this.document.location.origin);return this.disallowedRoutes.findIndex(_e=>{if("string"==typeof _e){const ge=new URL(_e,this.document.location.origin);return ge.hostname===re.hostname&&ge.pathname===re.pathname}return _e instanceof RegExp&&_e.test(K.url)})>-1}handleInterception(K,re,_e){const ge=this.jwtHelper.getAuthScheme(this.authScheme,re);let xe=!1;if(!K&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");return this.skipWhenExpired&&(xe=!K||this.jwtHelper.isTokenExpired(K)),K&&xe&&this.skipWhenExpired?re=re.clone():K&&(re=re.clone({setHeaders:{[this.headerName]:`${ge}${K}`}})),_e.handle(re)}intercept(K,re){if(!this.isAllowedDomain(K)||this.isDisallowedRoute(K))return re.handle(K);const _e=this.tokenGetter(K);return _e instanceof Promise?(0,l.D)(_e).pipe((0,j.zg)(ge=>this.handleInterception(ge,K,re))):this.handleInterception(_e,K,re)}}return V.\u0275fac=function(K){return new(K||V)(u.LFG(P),u.LFG(m),u.LFG(d.K0))},V.\u0275prov=u.Yz7({token:V,factory:V.\u0275fac}),V})(),ue=(()=>{class V{constructor(K){if(K)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(K){return{ngModule:V,providers:[{provide:L.TP,useClass:$,multi:!0},K.jwtOptionsProvider||{provide:P,useValue:K.config},m]}}}return V.\u0275fac=function(K){return new(K||V)(u.LFG(V,12))},V.\u0275mod=u.oAB({type:V}),V.\u0275inj=u.cJS({}),V})()},7423:(Tn,Je,R)=>{"use strict";R.d(Je,{Uw:()=>je,fo:()=>_e});var u=R(6099);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global&&global;var $=(()=>{return(Fe=$||($={})).Unimplemented="UNIMPLEMENTED",Fe.Unavailable="UNAVAILABLE",$;var Fe})();class ue extends Error{constructor(ke,Ne){super(ke),this.message=ke,this.code=Ne}}const Z=Fe=>{var ke,Ne,$e,Re,_t;const Ge=Fe.CapacitorCustomPlatform||null,ot=Fe.Capacitor||{},yt=ot.Plugins=ot.Plugins||{},wt=Fe.CapacitorPlatforms,dt=(null===(ke=null==wt?void 0:wt.currentPlatform)||void 0===ke?void 0:ke.getPlatform)||(()=>null!==Ge?Ge.name:(Fe=>{var ke,Ne;return(null==Fe?void 0:Fe.androidBridge)?"android":(null===(Ne=null===(ke=null==Fe?void 0:Fe.webkit)||void 0===ke?void 0:ke.messageHandlers)||void 0===Ne?void 0:Ne.bridge)?"ios":"web"})(Fe)),Vt=(null===(Ne=null==wt?void 0:wt.currentPlatform)||void 0===Ne?void 0:Ne.isNativePlatform)||(()=>"web"!==dt()),St=(null===($e=null==wt?void 0:wt.currentPlatform)||void 0===$e?void 0:$e.isPluginAvailable)||(qt=>{const Gt=Kt.get(qt);return!(!(null==Gt?void 0:Gt.platforms.has(dt()))&&!zt(qt))}),zt=(null===(Re=null==wt?void 0:wt.currentPlatform)||void 0===Re?void 0:Re.getPluginHeader)||(qt=>{var Gt;return null===(Gt=ot.PluginHeaders)||void 0===Gt?void 0:Gt.find(ft=>ft.name===qt)}),Kt=new Map,Yt=(null===(_t=null==wt?void 0:wt.currentPlatform)||void 0===_t?void 0:_t.registerPlugin)||((qt,Gt={})=>{const ft=Kt.get(qt);if(ft)return console.warn(`Capacitor plugin "${qt}" already registered. Cannot register plugins twice.`),ft.proxy;const Ut=dt(),On=zt(qt);let fn;const Gn=function(){var _i=(0,u.Z)(function*(){return!fn&&Ut in Gt?fn=fn="function"==typeof Gt[Ut]?yield Gt[Ut]():Gt[Ut]:null!==Ge&&!fn&&"web"in Gt&&(fn=fn="function"==typeof Gt.web?yield Gt.web():Gt.web),fn});return function(){return _i.apply(this,arguments)}}(),$i=_i=>{let xi;const Qt=(...Ye)=>{const te=Gn().then(Ae=>{const ut=((_i,xi)=>{var Qt,Ye;if(!On){if(_i)return null===(Ye=_i[xi])||void 0===Ye?void 0:Ye.bind(_i);throw new ue(`"${qt}" plugin is not implemented on ${Ut}`,$.Unimplemented)}{const te=null==On?void 0:On.methods.find(Ae=>xi===Ae.name);if(te)return"promise"===te.rtype?Ae=>ot.nativePromise(qt,xi.toString(),Ae):(Ae,ut)=>ot.nativeCallback(qt,xi.toString(),Ae,ut);if(_i)return null===(Qt=_i[xi])||void 0===Qt?void 0:Qt.bind(_i)}})(Ae,_i);if(ut){const Pe=ut(...Ye);return xi=null==Pe?void 0:Pe.remove,Pe}throw new ue(`"${qt}.${_i}()" is not implemented on ${Ut}`,$.Unimplemented)});return"addListener"===_i&&(te.remove=(0,u.Z)(function*(){return xi()})),te};return Qt.toString=()=>`${_i.toString()}() { [capacitor code] }`,Object.defineProperty(Qt,"name",{value:_i,writable:!1,configurable:!1}),Qt},sr=$i("addListener"),zi=$i("removeListener"),yi=(_i,xi)=>{const Qt=sr({eventName:_i},xi),Ye=function(){var Ae=(0,u.Z)(function*(){const ut=yield Qt;zi({eventName:_i,callbackId:ut},xi)});return function(){return Ae.apply(this,arguments)}}(),te=new Promise(Ae=>Qt.then(()=>Ae({remove:Ye})));return te.remove=(0,u.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield Ye()}),te},ji=new Proxy({},{get(_i,xi){switch(xi){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return On?yi:sr;case"removeListener":return zi;default:return $i(xi)}}});return yt[qt]=ji,Kt.set(qt,{name:qt,proxy:ji,platforms:new Set([...Object.keys(Gt),...On?[Ut]:[]])}),ji});return ot.convertFileSrc||(ot.convertFileSrc=qt=>qt),ot.getPlatform=dt,ot.handleError=qt=>Fe.console.error(qt),ot.isNativePlatform=Vt,ot.isPluginAvailable=St,ot.pluginMethodNoop=(qt,Gt,ft)=>Promise.reject(`${ft} does not have an implementation of "${Gt}".`),ot.registerPlugin=Yt,ot.Exception=ue,ot.DEBUG=!!ot.DEBUG,ot.isLoggingEnabled=!!ot.isLoggingEnabled,ot.platform=ot.getPlatform(),ot.isNative=ot.isNativePlatform(),ot},re=(Fe=>Fe.Capacitor=Z(Fe))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),_e=re.registerPlugin;class je{constructor(ke){this.listeners={},this.windowListeners={},ke&&(console.warn(`Capacitor WebPlugin "${ke.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=ke)}addListener(ke,Ne){var $e=this;this.listeners[ke]||(this.listeners[ke]=[]),this.listeners[ke].push(Ne);const _t=this.windowListeners[ke];_t&&!_t.registered&&this.addWindowListener(_t);const Ge=function(){var yt=(0,u.Z)(function*(){return $e.removeListener(ke,Ne)});return function(){return yt.apply(this,arguments)}}(),ot=Promise.resolve({remove:Ge});return Object.defineProperty(ot,"remove",{value:(yt=(0,u.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield Ge()}),function(){return yt.apply(this,arguments)})}),ot;var yt}removeAllListeners(){var ke=this;return(0,u.Z)(function*(){ke.listeners={};for(const Ne in ke.windowListeners)ke.removeWindowListener(ke.windowListeners[Ne]);ke.windowListeners={}})()}notifyListeners(ke,Ne){const $e=this.listeners[ke];$e&&$e.forEach(Re=>Re(Ne))}hasListeners(ke){return!!this.listeners[ke].length}registerWindowListener(ke,Ne){this.windowListeners[Ne]={registered:!1,windowEventName:ke,pluginEventName:Ne,handler:$e=>{this.notifyListeners(Ne,$e)}}}unimplemented(ke="not implemented"){return new re.Exception(ke,$.Unimplemented)}unavailable(ke="not available"){return new re.Exception(ke,$.Unavailable)}removeListener(ke,Ne){var $e=this;return(0,u.Z)(function*(){const Re=$e.listeners[ke];if(!Re)return;const _t=Re.indexOf(Ne);$e.listeners[ke].splice(_t,1),$e.listeners[ke].length||$e.removeWindowListener($e.windowListeners[ke])})()}addWindowListener(ke){window.addEventListener(ke.windowEventName,ke.handler),ke.registered=!0}removeWindowListener(ke){!ke||(window.removeEventListener(ke.windowEventName,ke.handler),ke.registered=!1)}}},9064:(Tn,Je,R)=>{"use strict";R.d(Je,{BX:()=>nl,Br:()=>Aa,w:()=>gi,dr:()=>X,BJ:()=>F,oU:()=>he,cs:()=>Q,yp:()=>We,YG:()=>Xe,Sm:()=>kt,PM:()=>tn,FN:()=>rn,Zi:()=>pn,wI:()=>ii,W2:()=>Ui,IJ:()=>ci,W4:()=>Mn,zq:()=>mi,fr:()=>Ii,jY:()=>Zi,Gu:()=>cr,gu:()=>oi,pK:()=>go,Ie:()=>bi,Q$:()=>Vr,q_:()=>Ee,yh:()=>He,z0:()=>Ce,fG:()=>tt,zc:()=>It,uN:()=>dn,I_:()=>Ot,nJ:()=>cn,Wo:()=>ki,jP:()=>jr,Nd:()=>nr,VI:()=>vo,cJ:()=>_o,GO:()=>Zn,t9:()=>Wi,n0:()=>Ai,PQ:()=>Se,jI:()=>Ct,g2:()=>io,Bs:()=>ar,wd:()=>es,ho:()=>ts,sr:()=>cs,Pc:()=>ma,r4:()=>Us,HT:()=>br,IN:()=>ea,SH:()=>yr,X1:()=>Io,as:()=>fi,t4:()=>an,YI:()=>hn,QI:()=>Vi,j9:()=>gr,yF:()=>Sn});var u=R(6738),d=R(4006);function m(D,Y,E,H){var In,ve=arguments.length,vt=ve<3?Y:null===H?H=Object.getOwnPropertyDescriptor(Y,E):H;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)vt=Reflect.decorate(D,Y,E,H);else for(var Vn=D.length-1;Vn>=0;Vn--)(In=D[Vn])&&(vt=(ve<3?In(vt):ve>3?In(Y,E,vt):In(Y,E))||vt);return ve>3&&vt&&Object.defineProperty(Y,E,vt),vt}function V(D,Y,E,H){return new(E||(E=Promise))(function(vt,In){function Vn(er){try{ui(H.next(er))}catch(hr){In(hr)}}function wi(er){try{ui(H.throw(er))}catch(hr){In(hr)}}function ui(er){er.done?vt(er.value):function ve(vt){return vt instanceof E?vt:new E(function(In){In(vt)})}(er.value).then(Vn,wi)}ui((H=H.apply(D,Y||[])).next())})}var xt=R(3753),dt=R(8929),At=R(591),Vt=R(3334),zt=(R(5562),R(3126),R(1363),R(7639)),Ht=R(5359),en=R(2629),Wt=(R(4304),R(425)),qt=(R(2733),R(9533)),Gn=R(3489);class $i{constructor(Y,E){this.compare=Y,this.keySelector=E}call(Y,E){return E.subscribe(new sr(Y,this.compare,this.keySelector))}}class sr extends Gn.L{constructor(Y,E,H){super(Y),this.keySelector=H,this.hasKey=!1,"function"==typeof E&&(this.compare=E)}compare(Y,E){return Y===E}_next(Y){let E;try{const{keySelector:ve}=this;E=ve?ve(Y):Y}catch(ve){return this.destination.error(ve)}let H=!1;if(this.hasKey)try{const{compare:ve}=this;H=ve(this.key,E)}catch(ve){return this.destination.error(ve)}else this.hasKey=!0;H||(this.key=E,this.destination.next(Y))}}var zi=R(2198),yi=R(7545),ji=R(6895);const xi=zt.i,te=["*"],qe=D=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(D):"function"==typeof requestAnimationFrame?requestAnimationFrame(D):setTimeout(D);let Rt=(()=>{class D{constructor(E,H){this.injector=E,this.el=H,this.onChange=()=>{},this.onTouched=()=>{}}writeValue(E){this.el.nativeElement.value=this.lastValue=E??"",Xt(this.el)}handleChangeEvent(E,H){E===this.el.nativeElement&&(H!==this.lastValue&&(this.lastValue=H,this.onChange(H)),Xt(this.el))}_handleBlurEvent(E){E===this.el.nativeElement&&(this.onTouched(),Xt(this.el))}registerOnChange(E){this.onChange=E}registerOnTouched(E){this.onTouched=E}setDisabledState(E){this.el.nativeElement.disabled=E}ngOnDestroy(){this.statusChanges&&this.statusChanges.unsubscribe()}ngAfterViewInit(){let E;try{E=this.injector.get(d.a5)}catch{}if(!E)return;E.statusChanges&&(this.statusChanges=E.statusChanges.subscribe(()=>Xt(this.el)));const H=E.control;H&&["markAsTouched","markAllAsTouched","markAsUntouched","markAsDirty","markAsPristine"].forEach(vt=>{if(void 0!==H[vt]){const In=H[vt].bind(H);H[vt]=(...Vn)=>{In(...Vn),Xt(this.el)}}})}}return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.zs3),u.Y36(u.SBq))},D.\u0275dir=u.lG2({type:D,hostBindings:function(E,H){1&E&&u.NdJ("ionBlur",function(vt){return H._handleBlurEvent(vt.target)})}}),D})();const Xt=D=>{qe(()=>{const Y=D.nativeElement,E=Xn(Y);Ki(Y,E);const H=Y.closest("ion-item");H&&Ki(H,E)})},Xn=D=>{const Y=D.classList,E=[];for(let H=0;H<Y.length;H++){const ve=Y.item(H);null!==ve&&Di(ve,"ng-")&&E.push(`ion-${ve.substr(3)}`)}return E},Ki=(D,Y)=>{const E=D.classList;["ion-valid","ion-invalid","ion-touched","ion-untouched","ion-dirty","ion-pristine"].forEach(H=>E.remove(H)),Y.forEach(H=>E.add(H))},Di=(D,Y)=>D.substr(0,Y.length)===Y;let gi=(()=>{class D extends Rt{constructor(E,H){super(E,H)}writeValue(E){this.el.nativeElement.checked=this.lastValue=E??!1,Xt(this.el)}_handleIonChange(E){this.handleChangeEvent(E,E.checked)}}return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.zs3),u.Y36(u.SBq))},D.\u0275dir=u.lG2({type:D,selectors:[["ion-checkbox"],["ion-toggle"]],hostBindings:function(E,H){1&E&&u.NdJ("ionChange",function(vt){return H._handleIonChange(vt.target)})},features:[u._Bn([{provide:d.JU,useExisting:D,multi:!0}]),u.qOj]}),D})(),fi=(()=>{class D extends Rt{constructor(E,H){super(E,H)}_handleIonChange(E){this.handleChangeEvent(E,E.value)}registerOnChange(E){super.registerOnChange(H=>{E(""===H?null:parseFloat(H))})}}return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.zs3),u.Y36(u.SBq))},D.\u0275dir=u.lG2({type:D,selectors:[["ion-input","type","number"]],hostBindings:function(E,H){1&E&&u.NdJ("ionChange",function(vt){return H._handleIonChange(vt.target)})},features:[u._Bn([{provide:d.JU,useExisting:D,multi:!0}]),u.qOj]}),D})(),Vi=(()=>{class D extends Rt{constructor(E,H){super(E,H)}_handleChangeEvent(E){this.handleChangeEvent(E,E.value)}}return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.zs3),u.Y36(u.SBq))},D.\u0275dir=u.lG2({type:D,selectors:[["ion-range"],["ion-select"],["ion-radio-group"],["ion-segment"],["ion-datetime"]],hostBindings:function(E,H){1&E&&u.NdJ("ionChange",function(vt){return H._handleChangeEvent(vt.target)})},features:[u._Bn([{provide:d.JU,useExisting:D,multi:!0}]),u.qOj]}),D})(),gr=(()=>{class D extends Rt{constructor(E,H){super(E,H)}_handleInputEvent(E){this.handleChangeEvent(E,E.value)}}return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.zs3),u.Y36(u.SBq))},D.\u0275dir=u.lG2({type:D,selectors:[["ion-input",3,"type","number"],["ion-textarea"],["ion-searchbar"]],hostBindings:function(E,H){1&E&&u.NdJ("ionChange",function(vt){return H._handleInputEvent(vt.target)})},features:[u._Bn([{provide:d.JU,useExisting:D,multi:!0}]),u.qOj]}),D})();const Pi=(D,Y)=>{const E=D.prototype;Y.forEach(H=>{Object.defineProperty(E,H,{get(){return this.el[H]},set(ve){this.z.runOutsideAngular(()=>this.el[H]=ve)}})})},Br=(D,Y)=>{const E=D.prototype;Y.forEach(H=>{E[H]=function(){const ve=arguments;return this.z.runOutsideAngular(()=>this.el[H].apply(this.el,ve))}})},Ei=(D,Y,E)=>{E.forEach(H=>D[H]=(0,xt.R)(Y,H))};function _n(D){return function(E){const{defineCustomElementFn:H,inputs:ve,methods:vt}=D;return void 0!==H&&H(),ve&&Pi(E,ve),vt&&Br(E,vt),E}}let X=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-app"]],ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0})],D),D})(),F=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-avatar"]],ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0})],D),D})(),he=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-back-button"]],inputs:{color:"color",defaultHref:"defaultHref",disabled:"disabled",icon:"icon",mode:"mode",routerAnimation:"routerAnimation",text:"text",type:"type"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["color","defaultHref","disabled","icon","mode","routerAnimation","text","type"]})],D),D})(),We=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-badge"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["color","mode"]})],D),D})(),Xe=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement,Ei(this,this.el,["ionFocus","ionBlur"])}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-button"]],inputs:{buttonType:"buttonType",color:"color",disabled:"disabled",download:"download",expand:"expand",fill:"fill",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",size:"size",strong:"strong",target:"target",type:"type"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["buttonType","color","disabled","download","expand","fill","href","mode","rel","routerAnimation","routerDirection","shape","size","strong","target","type"]})],D),D})(),kt=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-buttons"]],inputs:{collapse:"collapse"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["collapse"]})],D),D})(),tn=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-card"]],inputs:{button:"button",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",target:"target",type:"type"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["button","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","target","type"]})],D),D})(),rn=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-card-content"]],inputs:{mode:"mode"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["mode"]})],D),D})(),pn=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-card-header"]],inputs:{color:"color",mode:"mode",translucent:"translucent"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["color","mode","translucent"]})],D),D})(),ii=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-col"]],inputs:{offset:"offset",offsetLg:"offsetLg",offsetMd:"offsetMd",offsetSm:"offsetSm",offsetXl:"offsetXl",offsetXs:"offsetXs",pull:"pull",pullLg:"pullLg",pullMd:"pullMd",pullSm:"pullSm",pullXl:"pullXl",pullXs:"pullXs",push:"push",pushLg:"pushLg",pushMd:"pushMd",pushSm:"pushSm",pushXl:"pushXl",pushXs:"pushXs",size:"size",sizeLg:"sizeLg",sizeMd:"sizeMd",sizeSm:"sizeSm",sizeXl:"sizeXl",sizeXs:"sizeXs"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["offset","offsetLg","offsetMd","offsetSm","offsetXl","offsetXs","pull","pullLg","pullMd","pullSm","pullXl","pullXs","push","pushLg","pushMd","pushSm","pushXl","pushXs","size","sizeLg","sizeMd","sizeSm","sizeXl","sizeXs"]})],D),D})(),Ui=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement,Ei(this,this.el,["ionScrollStart","ionScroll","ionScrollEnd"])}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-content"]],inputs:{color:"color",forceOverscroll:"forceOverscroll",fullscreen:"fullscreen",scrollEvents:"scrollEvents",scrollX:"scrollX",scrollY:"scrollY"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["color","forceOverscroll","fullscreen","scrollEvents","scrollX","scrollY"],methods:["getScrollElement","scrollToTop","scrollToBottom","scrollByPoint","scrollToPoint"]})],D),D})(),ci=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-fab"]],inputs:{activated:"activated",edge:"edge",horizontal:"horizontal",vertical:"vertical"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["activated","edge","horizontal","vertical"],methods:["close"]})],D),D})(),Mn=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement,Ei(this,this.el,["ionFocus","ionBlur"])}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-fab-button"]],inputs:{activated:"activated",closeIcon:"closeIcon",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",show:"show",size:"size",target:"target",translucent:"translucent",type:"type"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["activated","closeIcon","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","show","size","target","translucent","type"]})],D),D})(),mi=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-fab-list"]],inputs:{activated:"activated",side:"side"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["activated","side"]})],D),D})(),Ii=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-footer"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["collapse","mode","translucent"]})],D),D})(),Zi=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-grid"]],inputs:{fixed:"fixed"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["fixed"]})],D),D})(),cr=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-header"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["collapse","mode","translucent"]})],D),D})(),oi=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-icon"]],inputs:{color:"color",flipRtl:"flipRtl",icon:"icon",ios:"ios",lazy:"lazy",md:"md",mode:"mode",name:"name",sanitize:"sanitize",size:"size",src:"src"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["color","flipRtl","icon","ios","lazy","md","mode","name","sanitize","size","src"]})],D),D})(),go=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement,Ei(this,this.el,["ionInput","ionChange","ionBlur","ionFocus"])}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-input"]],inputs:{accept:"accept",autocapitalize:"autocapitalize",autocomplete:"autocomplete",autocorrect:"autocorrect",autofocus:"autofocus",clearInput:"clearInput",clearOnEdit:"clearOnEdit",color:"color",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",max:"max",maxlength:"maxlength",min:"min",minlength:"minlength",mode:"mode",multiple:"multiple",name:"name",pattern:"pattern",placeholder:"placeholder",readonly:"readonly",required:"required",size:"size",spellcheck:"spellcheck",step:"step",type:"type",value:"value"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["accept","autocapitalize","autocomplete","autocorrect","autofocus","clearInput","clearOnEdit","color","debounce","disabled","enterkeyhint","inputmode","max","maxlength","min","minlength","mode","multiple","name","pattern","placeholder","readonly","required","size","spellcheck","step","type","value"],methods:["setFocus","getInputElement"]})],D),D})(),bi=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-item"]],inputs:{button:"button",color:"color",counter:"counter",detail:"detail",detailIcon:"detailIcon",disabled:"disabled",download:"download",fill:"fill",href:"href",lines:"lines",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",target:"target",type:"type"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["button","color","counter","detail","detailIcon","disabled","download","fill","href","lines","mode","rel","routerAnimation","routerDirection","shape","target","type"]})],D),D})(),Vr=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-label"]],inputs:{color:"color",mode:"mode",position:"position"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["color","mode","position"]})],D),D})(),Ee=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-list"]],inputs:{inset:"inset",lines:"lines",mode:"mode"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["inset","lines","mode"],methods:["closeSlidingItems"]})],D),D})(),He=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-list-header"]],inputs:{color:"color",lines:"lines",mode:"mode"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["color","lines","mode"]})],D),D})(),Ce=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement,Ei(this,this.el,["ionWillOpen","ionWillClose","ionDidOpen","ionDidClose"])}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-menu"]],inputs:{contentId:"contentId",disabled:"disabled",maxEdgeStart:"maxEdgeStart",menuId:"menuId",side:"side",swipeGesture:"swipeGesture",type:"type"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["contentId","disabled","maxEdgeStart","menuId","side","swipeGesture","type"],methods:["isOpen","isActive","open","close","toggle","setOpen"]})],D),D})(),tt=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-menu-button"]],inputs:{autoHide:"autoHide",color:"color",disabled:"disabled",menu:"menu",mode:"mode",type:"type"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["autoHide","color","disabled","menu","mode","type"]})],D),D})(),It=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-menu-toggle"]],inputs:{autoHide:"autoHide",menu:"menu"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["autoHide","menu"]})],D),D})(),dn=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-note"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["color","mode"]})],D),D})(),Ot=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement,Ei(this,this.el,["ionChange","ionFocus","ionBlur"])}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-range"]],inputs:{color:"color",debounce:"debounce",disabled:"disabled",dualKnobs:"dualKnobs",max:"max",min:"min",mode:"mode",name:"name",pin:"pin",pinFormatter:"pinFormatter",snaps:"snaps",step:"step",ticks:"ticks",value:"value"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["color","debounce","disabled","dualKnobs","max","min","mode","name","pin","pinFormatter","snaps","step","ticks","value"]})],D),D})(),cn=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement,Ei(this,this.el,["ionRefresh","ionPull","ionStart"])}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-refresher"]],inputs:{closeDuration:"closeDuration",disabled:"disabled",pullFactor:"pullFactor",pullMax:"pullMax",pullMin:"pullMin",snapbackDuration:"snapbackDuration"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["closeDuration","disabled","pullFactor","pullMax","pullMin","snapbackDuration"],methods:["complete","cancel","getProgress"]})],D),D})(),ki=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-refresher-content"]],inputs:{pullingIcon:"pullingIcon",pullingText:"pullingText",refreshingSpinner:"refreshingSpinner",refreshingText:"refreshingText"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["pullingIcon","pullingText","refreshingSpinner","refreshingText"]})],D),D})(),nr=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-row"]],ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0})],D),D})(),vo=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement,Ei(this,this.el,["ionInput","ionChange","ionCancel","ionClear","ionBlur","ionFocus"])}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-searchbar"]],inputs:{animated:"animated",autocomplete:"autocomplete",autocorrect:"autocorrect",cancelButtonIcon:"cancelButtonIcon",cancelButtonText:"cancelButtonText",clearIcon:"clearIcon",color:"color",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",mode:"mode",placeholder:"placeholder",searchIcon:"searchIcon",showCancelButton:"showCancelButton",showClearButton:"showClearButton",spellcheck:"spellcheck",type:"type",value:"value"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["animated","autocomplete","autocorrect","cancelButtonIcon","cancelButtonText","clearIcon","color","debounce","disabled","enterkeyhint","inputmode","mode","placeholder","searchIcon","showCancelButton","showClearButton","spellcheck","type","value"],methods:["setFocus","getInputElement"]})],D),D})(),_o=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement,Ei(this,this.el,["ionChange"])}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-segment"]],inputs:{color:"color",disabled:"disabled",mode:"mode",scrollable:"scrollable",selectOnFocus:"selectOnFocus",swipeGesture:"swipeGesture",value:"value"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["color","disabled","mode","scrollable","selectOnFocus","swipeGesture","value"]})],D),D})(),Zn=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-segment-button"]],inputs:{disabled:"disabled",layout:"layout",mode:"mode",type:"type",value:"value"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["disabled","layout","mode","type","value"]})],D),D})(),Wi=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement,Ei(this,this.el,["ionChange","ionCancel","ionFocus","ionBlur"])}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-select"]],inputs:{cancelText:"cancelText",compareWith:"compareWith",disabled:"disabled",interface:"interface",interfaceOptions:"interfaceOptions",mode:"mode",multiple:"multiple",name:"name",okText:"okText",placeholder:"placeholder",selectedText:"selectedText",value:"value"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["cancelText","compareWith","disabled","interface","interfaceOptions","mode","multiple","name","okText","placeholder","selectedText","value"],methods:["open"]})],D),D})(),Ai=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-select-option"]],inputs:{disabled:"disabled",value:"value"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["disabled","value"]})],D),D})(),Se=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-spinner"]],inputs:{color:"color",duration:"duration",name:"name",paused:"paused"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["color","duration","name","paused"]})],D),D})(),Ct=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement,Ei(this,this.el,["ionSplitPaneVisible"])}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-split-pane"]],inputs:{contentId:"contentId",disabled:"disabled",when:"when"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["contentId","disabled","when"]})],D),D})(),io=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement,Ei(this,this.el,["ionChange","ionInput","ionBlur","ionFocus"])}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-textarea"]],inputs:{autoGrow:"autoGrow",autocapitalize:"autocapitalize",autofocus:"autofocus",clearOnEdit:"clearOnEdit",color:"color",cols:"cols",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",maxlength:"maxlength",minlength:"minlength",mode:"mode",name:"name",placeholder:"placeholder",readonly:"readonly",required:"required",rows:"rows",spellcheck:"spellcheck",value:"value",wrap:"wrap"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["autoGrow","autocapitalize","autofocus","clearOnEdit","color","cols","debounce","disabled","enterkeyhint","inputmode","maxlength","minlength","mode","name","placeholder","readonly","required","rows","spellcheck","value","wrap"],methods:["setFocus","getInputElement"]})],D),D})(),ar=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-thumbnail"]],ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0})],D),D})(),es=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-title"]],inputs:{color:"color",size:"size"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["color","size"]})],D),D})(),ts=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement,Ei(this,this.el,["ionChange","ionFocus","ionBlur"])}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-toggle"]],inputs:{checked:"checked",color:"color",disabled:"disabled",mode:"mode",name:"name",value:"value"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["checked","color","disabled","mode","name","value"]})],D),D})(),cs=(()=>{let D=class{constructor(E,H,ve){this.z=ve,E.detach(),this.el=H.nativeElement}};return D.\u0275fac=function(E){return new(E||D)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},D.\u0275cmp=u.Xpm({type:D,selectors:[["ion-toolbar"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:te,decls:1,vars:0,template:function(E,H){1&E&&(u.F$t(),u.Hsn(0))},encapsulation:2,changeDetection:0}),D=m([_n({defineCustomElementFn:void 0,inputs:["color","mode"]})],D),D})();class Io{constructor(Y={}){this.data=Y}get(Y){return this.data[Y]}}let Bi=(()=>{class D{constructor(E,H){this.zone=E,this.appRef=H}create(E,H,ve){return new ks(E,H,ve,this.appRef,this.zone)}}return D.\u0275fac=function(E){return new(E||D)(u.LFG(u.R0b),u.LFG(u.z2F))},D.\u0275prov=u.Yz7({token:D,factory:D.\u0275fac}),D})();class ks{constructor(Y,E,H,ve,vt){this.resolver=Y,this.injector=E,this.location=H,this.appRef=ve,this.zone=vt,this.elRefMap=new WeakMap,this.elEventsMap=new WeakMap}attachViewToDom(Y,E,H,ve){return this.zone.run(()=>new Promise(vt=>{vt(Fs(this.zone,this.resolver,this.injector,this.location,this.appRef,this.elRefMap,this.elEventsMap,Y,E,H,ve))}))}removeViewFromDom(Y,E){return this.zone.run(()=>new Promise(H=>{const ve=this.elRefMap.get(E);if(ve){ve.destroy(),this.elRefMap.delete(E);const vt=this.elEventsMap.get(E);vt&&(vt(),this.elEventsMap.delete(E))}H()}))}}const Fs=(D,Y,E,H,ve,vt,In,Vn,wi,ui,er)=>{const hr=Y.resolveComponentFactory(wi),Or=u.zs3.create({providers:bs(ui),parent:E}),eo=H?H.createComponent(hr,H.length,Or):hr.create(Or),Lo=eo.instance,rs=eo.location.nativeElement;if(ui&&Object.assign(Lo,ui),er)for(const Zs of er)rs.classList.add(Zs);const ga=ro(D,Lo,rs);return Vn.appendChild(rs),H||ve.attachView(eo.hostView),eo.changeDetectorRef.reattach(),vt.set(rs,eo),In.set(rs,ga),rs},Ni=[en.L,en.a,en.b,en.c,en.d],ro=(D,Y,E)=>D.run(()=>{const H=Ni.filter(ve=>"function"==typeof Y[ve]).map(ve=>{const vt=In=>Y[ve](In.detail);return E.addEventListener(ve,vt),()=>E.removeEventListener(ve,vt)});return()=>H.forEach(ve=>ve())}),Vo=new u.OlP("NavParamsToken"),bs=D=>[{provide:Vo,useValue:D},{provide:Io,useFactory:Wr,deps:[Vo]}],Wr=D=>new Io(D),$o=(D,Y)=>((D=D.filter(E=>E.stackId!==Y.stackId)).push(Y),D),uo=(D,Y)=>{const E=D.createUrlTree(["."],{relativeTo:Y});return D.serializeUrl(E)},ns=(D,Y)=>{if(!D)return;const E=xo(Y);for(let H=0;H<E.length;H++){if(H>=D.length)return E[H];if(E[H]!==D[H])return}},xo=D=>D.split("/").map(Y=>Y.trim()).filter(Y=>""!==Y),Ro=D=>{D&&(D.ref.destroy(),D.unlistenEvents())};class Qs{constructor(Y,E,H,ve,vt,In){this.containerEl=E,this.router=H,this.navCtrl=ve,this.zone=vt,this.location=In,this.views=[],this.skipTransition=!1,this.nextId=0,this.tabsPrefix=void 0!==Y?xo(Y):void 0}createView(Y,E){var H;const ve=uo(this.router,E),vt=null===(H=null==Y?void 0:Y.location)||void 0===H?void 0:H.nativeElement,In=ro(this.zone,Y.instance,vt);return{id:this.nextId++,stackId:ns(this.tabsPrefix,ve),unlistenEvents:In,element:vt,ref:Y,url:ve}}getExistingView(Y){const E=uo(this.router,Y),H=this.views.find(ve=>ve.url===E);return H&&H.ref.changeDetectorRef.reattach(),H}setActive(Y){var E,H;const ve=this.navCtrl.consumeTransition();let{direction:vt,animation:In,animationBuilder:Vn}=ve;const wi=this.activeView,ui=((D,Y)=>!Y||D.stackId!==Y.stackId)(Y,wi);ui&&(vt="back",In=void 0);const er=this.views.slice();let hr;const Or=this.router;Or.getCurrentNavigation?hr=Or.getCurrentNavigation():(null===(E=Or.navigations)||void 0===E?void 0:E.value)&&(hr=Or.navigations.value),(null===(H=null==hr?void 0:hr.extras)||void 0===H?void 0:H.replaceUrl)&&this.views.length>0&&this.views.splice(-1,1);const eo=this.views.includes(Y),Lo=this.insertView(Y,vt);eo||Y.ref.changeDetectorRef.detectChanges();const rs=Y.animationBuilder;return void 0===Vn&&"back"===vt&&!ui&&void 0!==rs&&(Vn=rs),wi&&(wi.animationBuilder=Vn),this.zone.runOutsideAngular(()=>this.wait(()=>(wi&&wi.ref.changeDetectorRef.detach(),Y.ref.changeDetectorRef.reattach(),this.transition(Y,wi,In,this.canGoBack(1),!1,Vn).then(()=>oe(Y,Lo,er,this.location)).then(()=>({enteringView:Y,direction:vt,animation:In,tabSwitch:ui})))))}canGoBack(Y,E=this.getActiveStackId()){return this.getStack(E).length>Y}pop(Y,E=this.getActiveStackId()){return this.zone.run(()=>{var H,ve;const vt=this.getStack(E);if(vt.length<=Y)return Promise.resolve(!1);const In=vt[vt.length-Y-1];let Vn=In.url;const wi=In.savedData;if(wi){const er=wi.get("primary");(null===(ve=null===(H=null==er?void 0:er.route)||void 0===H?void 0:H._routerState)||void 0===ve?void 0:ve.snapshot.url)&&(Vn=er.route._routerState.snapshot.url)}const{animationBuilder:ui}=this.navCtrl.consumeTransition();return this.navCtrl.navigateBack(Vn,Object.assign(Object.assign({},In.savedExtras),{animation:ui})).then(()=>!0)})}startBackTransition(){const Y=this.activeView;if(Y){const E=this.getStack(Y.stackId),H=E[E.length-2],ve=H.animationBuilder;return this.wait(()=>this.transition(H,Y,"back",this.canGoBack(2),!0,ve))}return Promise.resolve()}endBackTransition(Y){Y?(this.skipTransition=!0,this.pop(1)):this.activeView&&we(this.activeView,this.views,this.views,this.location)}getLastUrl(Y){const E=this.getStack(Y);return E.length>0?E[E.length-1]:void 0}getRootUrl(Y){const E=this.getStack(Y);return E.length>0?E[0]:void 0}getActiveStackId(){return this.activeView?this.activeView.stackId:void 0}hasRunningTask(){return void 0!==this.runningTask}destroy(){this.containerEl=void 0,this.views.forEach(Ro),this.activeView=void 0,this.views=[]}getStack(Y){return this.views.filter(E=>E.stackId===Y)}insertView(Y,E){return this.activeView=Y,this.views=((D,Y,E)=>"root"===E?$o(D,Y):"forward"===E?((D,Y)=>(D.indexOf(Y)>=0?D=D.filter(H=>H.stackId!==Y.stackId||H.id<=Y.id):D.push(Y),D))(D,Y):((D,Y)=>D.indexOf(Y)>=0?D.filter(H=>H.stackId!==Y.stackId||H.id<=Y.id):$o(D,Y))(D,Y))(this.views,Y,E),this.views.slice()}transition(Y,E,H,ve,vt,In){if(this.skipTransition)return this.skipTransition=!1,Promise.resolve(!1);if(E===Y)return Promise.resolve(!1);const Vn=Y?Y.element:void 0,wi=E?E.element:void 0,ui=this.containerEl;return Vn&&Vn!==wi&&(Vn.classList.add("ion-page"),Vn.classList.add("ion-page-invisible"),Vn.parentElement!==ui&&ui.appendChild(Vn),ui.commit)?ui.commit(Vn,wi,{deepWait:!0,duration:void 0===H?0:void 0,direction:H,showGoBack:ve,progressAnimation:vt,animationBuilder:In}):Promise.resolve(!1)}wait(Y){return V(this,void 0,void 0,function*(){void 0!==this.runningTask&&(yield this.runningTask,this.runningTask=void 0);const E=this.runningTask=Y();return E.finally(()=>this.runningTask=void 0),E})}}const oe=(D,Y,E,H)=>"function"==typeof requestAnimationFrame?new Promise(ve=>{requestAnimationFrame(()=>{we(D,Y,E,H),ve()})}):Promise.resolve(),we=(D,Y,E,H)=>{E.filter(ve=>!Y.includes(ve)).forEach(Ro),Y.forEach(ve=>{const In=H.path().split("?")[0].split("#")[0];if(ve!==D&&ve.url!==In){const Vn=ve.element;Vn.setAttribute("aria-hidden","true"),Vn.classList.add("ion-page-hidden"),ve.ref.changeDetectorRef.detach()}})};let se=(()=>{class D{get(E,H){const ve=Mt();return ve?ve.get(E,H):null}getBoolean(E,H){const ve=Mt();return!!ve&&ve.getBoolean(E,H)}getNumber(E,H){const ve=Mt();return ve?ve.getNumber(E,H):0}}return D.\u0275fac=function(E){return new(E||D)},D.\u0275prov=u.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})();const Le=new u.OlP("USERCONFIG"),Mt=()=>{if("undefined"!=typeof window){const D=window.Ionic;if(null==D?void 0:D.config)return D.config}return null};let an=(()=>{class D{constructor(E,H){this.doc=E,this.backButton=new dt.xQ,this.keyboardDidShow=new dt.xQ,this.keyboardDidHide=new dt.xQ,this.pause=new dt.xQ,this.resume=new dt.xQ,this.resize=new dt.xQ,H.run(()=>{var ve;let vt;this.win=E.defaultView,this.backButton.subscribeWithPriority=function(In,Vn){return this.subscribe(wi=>wi.register(In,ui=>H.run(()=>Vn(ui))))},Wn(this.pause,E,"pause"),Wn(this.resume,E,"resume"),Wn(this.backButton,E,"ionBackButton"),Wn(this.resize,this.win,"resize"),Wn(this.keyboardDidShow,this.win,"ionKeyboardDidShow"),Wn(this.keyboardDidHide,this.win,"ionKeyboardDidHide"),this._readyPromise=new Promise(In=>{vt=In}),(null===(ve=this.win)||void 0===ve?void 0:ve.cordova)?E.addEventListener("deviceready",()=>{vt("cordova")},{once:!0}):vt("dom")})}is(E){return(0,zt.a)(this.win,E)}platforms(){return(0,zt.g)(this.win)}ready(){return this._readyPromise}get isRTL(){return"rtl"===this.doc.dir}getQueryParam(E){return Bn(this.win.location.href,E)}isLandscape(){return!this.isPortrait()}isPortrait(){var E,H;return null===(H=(E=this.win).matchMedia)||void 0===H?void 0:H.call(E,"(orientation: portrait)").matches}testUserAgent(E){const H=this.win.navigator;return!!((null==H?void 0:H.userAgent)&&H.userAgent.indexOf(E)>=0)}url(){return this.win.location.href}width(){return this.win.innerWidth}height(){return this.win.innerHeight}}return D.\u0275fac=function(E){return new(E||D)(u.LFG(ji.K0),u.LFG(u.R0b))},D.\u0275prov=u.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})();const Bn=(D,Y)=>{Y=Y.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");const H=new RegExp("[\\?&]"+Y+"=([^&#]*)").exec(D);return H?decodeURIComponent(H[1].replace(/\+/g," ")):null},Wn=(D,Y,E)=>{Y&&Y.addEventListener(E,H=>{D.next(null!=H?H.detail:void 0)})};let yr=(()=>{class D{constructor(E,H,ve,vt){this.location=H,this.serializer=ve,this.router=vt,this.direction=Oi,this.animated=dr,this.guessDirection="forward",this.lastNavId=-1,vt&&vt.events.subscribe(In=>{if(In instanceof Vt.OD){const Vn=In.restoredState?In.restoredState.navigationId:In.id;this.guessDirection=Vn<this.lastNavId?"back":"forward",this.guessAnimation=In.restoredState?void 0:this.guessDirection,this.lastNavId="forward"===this.guessDirection?In.id:Vn}}),E.backButton.subscribeWithPriority(0,In=>{this.pop(),In()})}navigateForward(E,H={}){return this.setDirection("forward",H.animated,H.animationDirection,H.animation),this.navigate(E,H)}navigateBack(E,H={}){return this.setDirection("back",H.animated,H.animationDirection,H.animation),this.navigate(E,H)}navigateRoot(E,H={}){return this.setDirection("root",H.animated,H.animationDirection,H.animation),this.navigate(E,H)}back(E={animated:!0,animationDirection:"back"}){return this.setDirection("back",E.animated,E.animationDirection,E.animation),this.location.back()}pop(){return V(this,void 0,void 0,function*(){let E=this.topOutlet;for(;E&&!(yield E.pop());)E=E.parentOutlet})}setDirection(E,H,ve,vt){this.direction=E,this.animated=Dr(E,H,ve),this.animationBuilder=vt}setTopOutlet(E){this.topOutlet=E}consumeTransition(){let H,E="root";const ve=this.animationBuilder;return"auto"===this.direction?(E=this.guessDirection,H=this.guessAnimation):(H=this.animated,E=this.direction),this.direction=Oi,this.animated=dr,this.animationBuilder=void 0,{direction:E,animation:H,animationBuilder:ve}}navigate(E,H){if(Array.isArray(E))return this.router.navigate(E,H);{const ve=this.serializer.parse(E.toString());return void 0!==H.queryParams&&(ve.queryParams=Object.assign({},H.queryParams)),void 0!==H.fragment&&(ve.fragment=H.fragment),this.router.navigateByUrl(ve,H)}}}return D.\u0275fac=function(E){return new(E||D)(u.LFG(an),u.LFG(ji.Ye),u.LFG(Vt.Hx),u.LFG(Vt.F0,8))},D.\u0275prov=u.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})();const Dr=(D,Y,E)=>{if(!1!==Y){if(void 0!==E)return E;if("forward"===D||"back"===D)return D;if("root"===D&&!0===Y)return"forward"}},Oi="auto",dr=void 0;let jr=(()=>{class D{constructor(E,H,ve,vt,In,Vn,wi,ui,er,hr,Or,eo,Lo){this.parentContexts=E,this.location=H,this.resolver=ve,this.config=Vn,this.navCtrl=wi,this.parentOutlet=Lo,this.activated=null,this.activatedView=null,this._activatedRoute=null,this.proxyMap=new WeakMap,this.currentActivatedRoute$=new At.X(null),this.stackEvents=new u.vpe,this.activateEvents=new u.vpe,this.deactivateEvents=new u.vpe,this.nativeEl=er.nativeElement,this.name=vt||Vt.eC,this.tabsPrefix="true"===In?uo(hr,eo):void 0,this.stackCtrl=new Qs(this.tabsPrefix,this.nativeEl,hr,wi,Or,ui),E.onChildOutletCreated(this.name,this)}set animation(E){this.nativeEl.animation=E}set animated(E){this.nativeEl.animated=E}set swipeGesture(E){this._swipeGesture=E,this.nativeEl.swipeHandler=E?{canStart:()=>this.stackCtrl.canGoBack(1)&&!this.stackCtrl.hasRunningTask(),onStart:()=>this.stackCtrl.startBackTransition(),onEnd:H=>this.stackCtrl.endBackTransition(H)}:void 0}ngOnDestroy(){this.stackCtrl.destroy()}getContext(){return this.parentContexts.getContext(this.name)}ngOnInit(){if(!this.activated){const E=this.getContext();(null==E?void 0:E.route)&&this.activateWith(E.route,E.resolver||null)}new Promise(E=>(0,Ht.c)(this.nativeEl,E)).then(()=>{void 0===this._swipeGesture&&(this.swipeGesture=this.config.getBoolean("swipeBackEnabled","ios"===this.nativeEl.mode))})}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){throw new Error("incompatible reuse strategy")}attach(E,H){throw new Error("incompatible reuse strategy")}deactivate(){if(this.activated){if(this.activatedView){const H=this.getContext();this.activatedView.savedData=new Map(H.children.contexts);const ve=this.activatedView.savedData.get("primary");if(ve&&H.route&&(ve.route=Object.assign({},H.route)),this.activatedView.savedExtras={},H.route){const vt=H.route.snapshot;this.activatedView.savedExtras.queryParams=vt.queryParams,this.activatedView.savedExtras.fragment=vt.fragment}}const E=this.component;this.activatedView=null,this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(E)}}activateWith(E,H){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=E;let ve,vt=this.stackCtrl.getExistingView(E);if(vt){ve=this.activated=vt.ref;const In=vt.savedData;In&&(this.getContext().children.contexts=In),this.updateActivatedRouteProxy(ve.instance,E)}else{const wi=(H=H||this.resolver).resolveComponentFactory(E._futureSnapshot.routeConfig.component),ui=this.parentContexts.getOrCreateContext(this.name).children,er=new At.X(null),hr=this.createActivatedRouteProxy(er,E),Or=new ae(hr,ui,this.location.injector);ve=this.activated=this.location.createComponent(wi,this.location.length,Or),er.next(ve.instance),vt=this.stackCtrl.createView(this.activated,E),this.proxyMap.set(ve.instance,hr),this.currentActivatedRoute$.next({component:ve.instance,activatedRoute:E})}this.activatedView=vt,this.stackCtrl.setActive(vt).then(In=>{this.navCtrl.setTopOutlet(this),this.activateEvents.emit(ve.instance),this.stackEvents.emit(In)})}canGoBack(E=1,H){return this.stackCtrl.canGoBack(E,H)}pop(E=1,H){return this.stackCtrl.pop(E,H)}getLastUrl(E){const H=this.stackCtrl.getLastUrl(E);return H?H.url:void 0}getLastRouteView(E){return this.stackCtrl.getLastUrl(E)}getRootView(E){return this.stackCtrl.getRootUrl(E)}getActiveStackId(){return this.stackCtrl.getActiveStackId()}createActivatedRouteProxy(E,H){const ve=new Vt.gz;return ve._futureSnapshot=H._futureSnapshot,ve._routerState=H._routerState,ve.snapshot=H.snapshot,ve.outlet=H.outlet,ve.component=H.component,ve._paramMap=this.proxyObservable(E,"paramMap"),ve._queryParamMap=this.proxyObservable(E,"queryParamMap"),ve.url=this.proxyObservable(E,"url"),ve.params=this.proxyObservable(E,"params"),ve.queryParams=this.proxyObservable(E,"queryParams"),ve.fragment=this.proxyObservable(E,"fragment"),ve.data=this.proxyObservable(E,"data"),ve}proxyObservable(E,H){return E.pipe((0,zi.h)(ve=>!!ve),(0,yi.w)(ve=>this.currentActivatedRoute$.pipe((0,zi.h)(vt=>null!==vt&&vt.component===ve),(0,yi.w)(vt=>vt&&vt.activatedRoute[H]),function ei(D,Y){return E=>E.lift(new $i(D,Y))}())))}updateActivatedRouteProxy(E,H){const ve=this.proxyMap.get(E);if(!ve)throw new Error("Could not find activated route proxy for view");ve._futureSnapshot=H._futureSnapshot,ve._routerState=H._routerState,ve.snapshot=H.snapshot,ve.outlet=H.outlet,ve.component=H.component,this.currentActivatedRoute$.next({component:E,activatedRoute:H})}}return D.\u0275fac=function(E){return new(E||D)(u.Y36(Vt.y6),u.Y36(u.s_b),u.Y36(u._Vd),u.$8M("name"),u.$8M("tabs"),u.Y36(se),u.Y36(yr),u.Y36(ji.Ye),u.Y36(u.SBq),u.Y36(Vt.F0),u.Y36(u.R0b),u.Y36(Vt.gz),u.Y36(D,12))},D.\u0275dir=u.lG2({type:D,selectors:[["ion-router-outlet"]],inputs:{animated:"animated",animation:"animation",swipeGesture:"swipeGesture"},outputs:{stackEvents:"stackEvents",activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),D})();class ae{constructor(Y,E,H){this.route=Y,this.childContexts=E,this.parent=H}get(Y,E){return Y===Vt.gz?this.route:Y===Vt.y6?this.childContexts:this.parent.get(Y,E)}}let Q=(()=>{class D{constructor(E,H,ve){this.routerOutlet=E,this.navCtrl=H,this.config=ve}onClick(E){var H;const ve=this.defaultHref||this.config.get("backButtonDefaultHref");(null===(H=this.routerOutlet)||void 0===H?void 0:H.canGoBack())?(this.navCtrl.setDirection("back",void 0,void 0,this.routerAnimation),this.routerOutlet.pop(),E.preventDefault()):null!=ve&&(this.navCtrl.navigateBack(ve,{animation:this.routerAnimation}),E.preventDefault())}}return D.\u0275fac=function(E){return new(E||D)(u.Y36(jr,8),u.Y36(yr),u.Y36(se))},D.\u0275dir=u.lG2({type:D,selectors:[["ion-back-button"]],hostBindings:function(E,H){1&E&&u.NdJ("click",function(vt){return H.onClick(vt)})},inputs:{defaultHref:"defaultHref",routerAnimation:"routerAnimation"}}),D})(),hn=(()=>{class D{constructor(E,H,ve,vt,In){this.locationStrategy=E,this.navCtrl=H,this.elementRef=ve,this.router=vt,this.routerLink=In,this.routerDirection="forward"}ngOnInit(){this.updateTargetUrlAndHref()}ngOnChanges(){this.updateTargetUrlAndHref()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}updateTargetUrlAndHref(){var E;if(null===(E=this.routerLink)||void 0===E?void 0:E.urlTree){const H=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.routerLink.urlTree));this.elementRef.nativeElement.href=H}}onClick(E){this.navCtrl.setDirection(this.routerDirection,void 0,void 0,this.routerAnimation),E.preventDefault()}}return D.\u0275fac=function(E){return new(E||D)(u.Y36(ji.S$),u.Y36(yr),u.Y36(u.SBq),u.Y36(Vt.F0),u.Y36(Vt.rH,8))},D.\u0275dir=u.lG2({type:D,selectors:[["","routerLink",""]],hostBindings:function(E,H){1&E&&u.NdJ("click",function(vt){return H.onClick(vt)})},inputs:{routerDirection:"routerDirection",routerAnimation:"routerAnimation"},features:[u.TTD]}),D})();class Si{constructor(Y){this.ctrl=Y}create(Y){return this.ctrl.create(Y||{})}dismiss(Y,E,H){return this.ctrl.dismiss(Y,E,H)}getTop(){return this.ctrl.getTop()}}let nl=(()=>{class D extends Si{constructor(){super(Wt.b)}}return D.\u0275fac=function(E){return new(E||D)},D.\u0275prov=u.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})(),Aa=(()=>{class D extends Si{constructor(){super(Wt.a)}}return D.\u0275fac=function(E){return new(E||D)},D.\u0275prov=u.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})(),br=(()=>{class D extends Si{constructor(){super(Wt.l)}}return D.\u0275fac=function(E){return new(E||D)},D.\u0275prov=u.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})(),ea=(()=>{class D extends Si{constructor(E,H,ve){super(Wt.m),this.angularDelegate=E,this.resolver=H,this.injector=ve}create(E){return super.create(Object.assign(Object.assign({},E),{delegate:this.angularDelegate.create(this.resolver,this.injector)}))}}return D.\u0275fac=function(E){return new(E||D)(u.LFG(Bi),u.LFG(u._Vd),u.LFG(u.zs3))},D.\u0275prov=u.Yz7({token:D,factory:D.\u0275fac}),D})(),ta=(()=>{class D extends Si{constructor(E,H,ve){super(Wt.c),this.angularDelegate=E,this.resolver=H,this.injector=ve}create(E){return super.create(Object.assign(Object.assign({},E),{delegate:this.angularDelegate.create(this.resolver,this.injector)}))}}return D.\u0275fac=function(E){return new(E||D)(u.LFG(Bi),u.LFG(u._Vd),u.LFG(u.zs3))},D.\u0275prov=u.Yz7({token:D,factory:D.\u0275fac}),D})(),Sn=(()=>{class D extends Si{constructor(){super(Wt.t)}}return D.\u0275fac=function(E){return new(E||D)},D.\u0275prov=u.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})();class Us{shouldDetach(Y){return!1}shouldAttach(Y){return!1}store(Y,E){}retrieve(Y){return null}shouldReuseRoute(Y,E){if(Y.routeConfig!==E.routeConfig)return!1;const H=Y.params,ve=E.params,vt=Object.keys(H),In=Object.keys(ve);if(vt.length!==In.length)return!1;for(const Vn of vt)if(ve[Vn]!==H[Vn])return!1;return!0}}const is=(D,Y,E)=>()=>{if(Y.defaultView&&"undefined"!=typeof window){(D=>{const Y=window,E=Y.Ionic;E&&E.config&&"Object"!==E.config.constructor.name||(Y.Ionic=Y.Ionic||{},Y.Ionic.config=Object.assign(Object.assign({},Y.Ionic.config),D))})(Object.assign(Object.assign({},D),{_zoneGate:vt=>E.run(vt)}));const ve="__zone_symbol__addEventListener"in Y.body?"__zone_symbol__addEventListener":"addEventListener";return function _i(){var D=[];if("undefined"!=typeof window){var Y=window;(!Y.customElements||Y.Element&&(!Y.Element.prototype.closest||!Y.Element.prototype.matches||!Y.Element.prototype.remove||!Y.Element.prototype.getRootNode))&&D.push(R.e(6748).then(R.t.bind(R,723,23))),("function"!=typeof Object.assign||!Object.entries||!Array.prototype.find||!Array.prototype.includes||!String.prototype.startsWith||!String.prototype.endsWith||Y.NodeList&&!Y.NodeList.prototype.forEach||!Y.fetch||!function(){try{var H=new URL("b","http://a");return H.pathname="c%20d","http://a/c%20d"===H.href&&H.searchParams}catch{return!1}}()||"undefined"==typeof WeakMap)&&D.push(R.e(2214).then(R.t.bind(R,4144,23)))}return Promise.all(D)}().then(()=>((D,Y)=>"undefined"==typeof window?Promise.resolve():(0,qt.p)().then(()=>(xi(),(0,qt.b)(JSON.parse('[["ion-menu_3",[[33,"ion-menu-button",{"color":[513],"disabled":[4],"menu":[1],"autoHide":[4,"auto-hide"],"type":[1],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]],[33,"ion-menu",{"contentId":[513,"content-id"],"menuId":[513,"menu-id"],"type":[1025],"disabled":[1028],"side":[513],"swipeGesture":[4,"swipe-gesture"],"maxEdgeStart":[2,"max-edge-start"],"isPaneVisible":[32],"isEndSide":[32],"isOpen":[64],"isActive":[64],"open":[64],"close":[64],"toggle":[64],"setOpen":[64]},[[16,"ionSplitPaneVisible","onSplitPaneChanged"],[2,"click","onBackdropClick"],[0,"keydown","onKeydown"]]],[1,"ion-menu-toggle",{"menu":[1],"autoHide":[4,"auto-hide"],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]]]],["ion-action-sheet",[[34,"ion-action-sheet",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"header":[1],"subHeader":[1,"sub-header"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-fab_3",[[33,"ion-fab-button",{"color":[513],"activated":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1],"show":[4],"translucent":[4],"type":[1],"size":[1],"closeIcon":[1,"close-icon"]}],[1,"ion-fab",{"horizontal":[1],"vertical":[1],"edge":[4],"activated":[1028],"close":[64]}],[1,"ion-fab-list",{"activated":[4],"side":[1]}]]],["ion-refresher_2",[[0,"ion-refresher-content",{"pullingIcon":[1025,"pulling-icon"],"pullingText":[1,"pulling-text"],"refreshingSpinner":[1025,"refreshing-spinner"],"refreshingText":[1,"refreshing-text"]}],[32,"ion-refresher",{"pullMin":[2,"pull-min"],"pullMax":[2,"pull-max"],"closeDuration":[1,"close-duration"],"snapbackDuration":[1,"snapback-duration"],"pullFactor":[2,"pull-factor"],"disabled":[4],"nativeRefresher":[32],"state":[32],"complete":[64],"cancel":[64],"getProgress":[64]}]]],["ion-alert",[[34,"ion-alert",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"header":[1],"subHeader":[1,"sub-header"],"message":[1],"buttons":[16],"inputs":[1040],"backdropDismiss":[4,"backdrop-dismiss"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},[[4,"keydown","onKeydown"]]]]],["ion-back-button",[[33,"ion-back-button",{"color":[513],"defaultHref":[1025,"default-href"],"disabled":[516],"icon":[1],"text":[1],"type":[1],"routerAnimation":[16]}]]],["ion-loading",[[34,"ion-loading",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"message":[1],"cssClass":[1,"css-class"],"duration":[2],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"spinner":[1025],"translucent":[4],"animated":[4],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-toast",[[33,"ion-toast",{"overlayIndex":[2,"overlay-index"],"color":[513],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"duration":[2],"header":[1],"message":[1],"keyboardClose":[4,"keyboard-close"],"position":[1],"buttons":[16],"translucent":[4],"animated":[4],"icon":[1],"htmlAttributes":[16],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-card_5",[[33,"ion-card",{"color":[513],"button":[4],"type":[1],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}],[32,"ion-card-content"],[33,"ion-card-header",{"color":[513],"translucent":[4]}],[33,"ion-card-subtitle",{"color":[513]}],[33,"ion-card-title",{"color":[513]}]]],["ion-item-option_3",[[33,"ion-item-option",{"color":[513],"disabled":[4],"download":[1],"expandable":[4],"href":[1],"rel":[1],"target":[1],"type":[1]}],[32,"ion-item-options",{"side":[1],"fireSwipeEvent":[64]}],[0,"ion-item-sliding",{"disabled":[4],"state":[32],"getOpenAmount":[64],"getSlidingRatio":[64],"open":[64],"close":[64],"closeOpened":[64]}]]],["ion-accordion_2",[[49,"ion-accordion",{"value":[1],"disabled":[4],"readonly":[4],"toggleIcon":[1,"toggle-icon"],"toggleIconSlot":[1,"toggle-icon-slot"],"state":[32],"isNext":[32],"isPrevious":[32]}],[33,"ion-accordion-group",{"animated":[4],"multiple":[4],"value":[1025],"disabled":[4],"readonly":[4],"expand":[1],"requestAccordionToggle":[64],"getAccordions":[64]},[[0,"keydown","onKeydown"]]]]],["ion-breadcrumb_2",[[33,"ion-breadcrumb",{"collapsed":[4],"last":[4],"showCollapsedIndicator":[4,"show-collapsed-indicator"],"color":[1],"active":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"separator":[4],"target":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}],[33,"ion-breadcrumbs",{"color":[1],"maxItems":[2,"max-items"],"itemsBeforeCollapse":[2,"items-before-collapse"],"itemsAfterCollapse":[2,"items-after-collapse"],"collapsed":[32],"activeChanged":[32]},[[0,"collapsedClick","onCollapsedClick"]]]]],["ion-infinite-scroll_2",[[32,"ion-infinite-scroll-content",{"loadingSpinner":[1025,"loading-spinner"],"loadingText":[1,"loading-text"]}],[0,"ion-infinite-scroll",{"threshold":[1],"disabled":[4],"position":[1],"isLoading":[32],"complete":[64]}]]],["ion-reorder_2",[[33,"ion-reorder",null,[[2,"click","onClick"]]],[0,"ion-reorder-group",{"disabled":[4],"state":[32],"complete":[64]}]]],["ion-segment_2",[[33,"ion-segment-button",{"disabled":[4],"layout":[1],"type":[1],"value":[1],"checked":[32]}],[33,"ion-segment",{"color":[513],"disabled":[4],"scrollable":[4],"swipeGesture":[4,"swipe-gesture"],"value":[1025],"selectOnFocus":[4,"select-on-focus"],"activated":[32]},[[0,"keydown","onKeyDown"]]]]],["ion-tab-bar_2",[[33,"ion-tab-button",{"disabled":[4],"download":[1],"href":[1],"rel":[1],"layout":[1025],"selected":[1028],"tab":[1],"target":[1]},[[8,"ionTabBarChanged","onTabBarChanged"]]],[33,"ion-tab-bar",{"color":[513],"selectedTab":[1,"selected-tab"],"translucent":[4],"keyboardVisible":[32]}]]],["ion-chip",[[33,"ion-chip",{"color":[513],"outline":[4],"disabled":[4]}]]],["ion-modal",[[33,"ion-modal",{"hasController":[4,"has-controller"],"overlayIndex":[2,"overlay-index"],"delegate":[16],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"breakpoints":[16],"initialBreakpoint":[2,"initial-breakpoint"],"backdropBreakpoint":[2,"backdrop-breakpoint"],"handle":[4],"component":[1],"componentProps":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"animated":[4],"swipeToClose":[4,"swipe-to-close"],"presentingElement":[16],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-searchbar",[[34,"ion-searchbar",{"color":[513],"animated":[4],"autocomplete":[1],"autocorrect":[1],"cancelButtonIcon":[1,"cancel-button-icon"],"cancelButtonText":[1,"cancel-button-text"],"clearIcon":[1,"clear-icon"],"debounce":[2],"disabled":[4],"inputmode":[1],"enterkeyhint":[1],"placeholder":[1],"searchIcon":[1,"search-icon"],"showCancelButton":[1,"show-cancel-button"],"showClearButton":[1,"show-clear-button"],"spellcheck":[4],"type":[1],"value":[1025],"focused":[32],"noAnimate":[32],"setFocus":[64],"getInputElement":[64]}]]],["ion-route_4",[[0,"ion-route",{"url":[1],"component":[1],"componentProps":[16],"beforeLeave":[16],"beforeEnter":[16]}],[0,"ion-route-redirect",{"from":[1],"to":[1]}],[0,"ion-router",{"root":[1],"useHash":[4,"use-hash"],"canTransition":[64],"push":[64],"back":[64],"printDebug":[64],"navChanged":[64]},[[8,"popstate","onPopState"],[4,"ionBackButton","onBackButton"]]],[1,"ion-router-link",{"color":[513],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}]]],["ion-avatar_3",[[33,"ion-avatar"],[33,"ion-badge",{"color":[513]}],[1,"ion-thumbnail"]]],["ion-col_3",[[1,"ion-col",{"offset":[1],"offsetXs":[1,"offset-xs"],"offsetSm":[1,"offset-sm"],"offsetMd":[1,"offset-md"],"offsetLg":[1,"offset-lg"],"offsetXl":[1,"offset-xl"],"pull":[1],"pullXs":[1,"pull-xs"],"pullSm":[1,"pull-sm"],"pullMd":[1,"pull-md"],"pullLg":[1,"pull-lg"],"pullXl":[1,"pull-xl"],"push":[1],"pushXs":[1,"push-xs"],"pushSm":[1,"push-sm"],"pushMd":[1,"push-md"],"pushLg":[1,"push-lg"],"pushXl":[1,"push-xl"],"size":[1],"sizeXs":[1,"size-xs"],"sizeSm":[1,"size-sm"],"sizeMd":[1,"size-md"],"sizeLg":[1,"size-lg"],"sizeXl":[1,"size-xl"]},[[9,"resize","onResize"]]],[1,"ion-grid",{"fixed":[4]}],[1,"ion-row"]]],["ion-nav_2",[[1,"ion-nav",{"delegate":[16],"swipeGesture":[1028,"swipe-gesture"],"animated":[4],"animation":[16],"rootParams":[16],"root":[1],"push":[64],"insert":[64],"insertPages":[64],"pop":[64],"popTo":[64],"popToRoot":[64],"removeIndex":[64],"setRoot":[64],"setPages":[64],"setRouteId":[64],"getRouteId":[64],"getActive":[64],"getByIndex":[64],"canGoBack":[64],"getPrevious":[64]}],[0,"ion-nav-link",{"component":[1],"componentProps":[16],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}]]],["ion-slide_2",[[0,"ion-slide"],[36,"ion-slides",{"options":[8],"pager":[4],"scrollbar":[4],"update":[64],"updateAutoHeight":[64],"slideTo":[64],"slideNext":[64],"slidePrev":[64],"getActiveIndex":[64],"getPreviousIndex":[64],"length":[64],"isEnd":[64],"isBeginning":[64],"startAutoplay":[64],"stopAutoplay":[64],"lockSwipeToNext":[64],"lockSwipeToPrev":[64],"lockSwipes":[64],"getSwiper":[64]}]]],["ion-tab_2",[[1,"ion-tab",{"active":[1028],"delegate":[16],"tab":[1],"component":[1],"setActive":[64]}],[1,"ion-tabs",{"useRouter":[1028,"use-router"],"selectedTab":[32],"select":[64],"getTab":[64],"getSelected":[64],"setRouteId":[64],"getRouteId":[64]}]]],["ion-img",[[1,"ion-img",{"alt":[1],"src":[1],"loadSrc":[32],"loadError":[32]}]]],["ion-input",[[34,"ion-input",{"fireFocusEvents":[4,"fire-focus-events"],"color":[513],"accept":[1],"autocapitalize":[1],"autocomplete":[1],"autocorrect":[1],"autofocus":[4],"clearInput":[4,"clear-input"],"clearOnEdit":[4,"clear-on-edit"],"debounce":[2],"disabled":[4],"enterkeyhint":[1],"inputmode":[1],"max":[8],"maxlength":[2],"min":[8],"minlength":[2],"multiple":[4],"name":[1],"pattern":[1],"placeholder":[1],"readonly":[4],"required":[4],"spellcheck":[4],"step":[1],"size":[2],"type":[1],"value":[1032],"hasFocus":[32],"setFocus":[64],"setBlur":[64],"getInputElement":[64]}]]],["ion-progress-bar",[[33,"ion-progress-bar",{"type":[1],"reversed":[4],"value":[2],"buffer":[2],"color":[513]}]]],["ion-range",[[33,"ion-range",{"color":[513],"debounce":[2],"name":[1],"dualKnobs":[4,"dual-knobs"],"min":[2],"max":[2],"pin":[4],"pinFormatter":[16],"snaps":[4],"step":[2],"ticks":[4],"disabled":[4],"value":[1026],"ratioA":[32],"ratioB":[32],"pressedKnob":[32]}]]],["ion-split-pane",[[33,"ion-split-pane",{"contentId":[513,"content-id"],"disabled":[4],"when":[8],"visible":[32]}]]],["ion-text",[[1,"ion-text",{"color":[513]}]]],["ion-textarea",[[34,"ion-textarea",{"fireFocusEvents":[4,"fire-focus-events"],"color":[513],"autocapitalize":[1],"autofocus":[4],"clearOnEdit":[1028,"clear-on-edit"],"debounce":[2],"disabled":[4],"inputmode":[1],"enterkeyhint":[1],"maxlength":[2],"minlength":[2],"name":[1],"placeholder":[1],"readonly":[4],"required":[4],"spellcheck":[4],"cols":[2],"rows":[2],"wrap":[1],"autoGrow":[4,"auto-grow"],"value":[1025],"hasFocus":[32],"setFocus":[64],"setBlur":[64],"getInputElement":[64]}]]],["ion-toggle",[[33,"ion-toggle",{"color":[513],"name":[1],"checked":[1028],"disabled":[4],"value":[1],"activated":[32]}]]],["ion-virtual-scroll",[[0,"ion-virtual-scroll",{"approxItemHeight":[2,"approx-item-height"],"approxHeaderHeight":[2,"approx-header-height"],"approxFooterHeight":[2,"approx-footer-height"],"headerFn":[16],"footerFn":[16],"items":[16],"itemHeight":[16],"headerHeight":[16],"footerHeight":[16],"renderItem":[16],"renderHeader":[16],"renderFooter":[16],"nodeRender":[16],"domRender":[16],"totalHeight":[32],"positionForItem":[64],"checkRange":[64],"checkEnd":[64]},[[9,"resize","onResize"]]]]],["ion-picker-column-internal",[[33,"ion-picker-column-internal",{"items":[16],"value":[1032],"color":[513],"numericInput":[4,"numeric-input"],"isActive":[32],"scrollActiveItemIntoView":[64]}]]],["ion-picker-internal",[[33,"ion-picker-internal"]]],["ion-checkbox",[[33,"ion-checkbox",{"color":[513],"name":[1],"checked":[1028],"indeterminate":[1028],"disabled":[4],"value":[8]}]]],["ion-select_3",[[33,"ion-select",{"disabled":[4],"cancelText":[1,"cancel-text"],"okText":[1,"ok-text"],"placeholder":[1],"name":[1],"selectedText":[1,"selected-text"],"multiple":[4],"interface":[1],"interfaceOptions":[8,"interface-options"],"compareWith":[1,"compare-with"],"value":[1032],"isExpanded":[32],"open":[64]}],[1,"ion-select-option",{"disabled":[4],"value":[8]}],[34,"ion-select-popover",{"header":[1],"subHeader":[1,"sub-header"],"message":[1],"multiple":[4],"options":[16]},[[0,"ionChange","onSelect"]]]]],["ion-backdrop",[[33,"ion-backdrop",{"visible":[4],"tappable":[4],"stopPropagation":[4,"stop-propagation"]},[[2,"click","onMouseDown"]]]]],["ion-popover",[[33,"ion-popover",{"hasController":[4,"has-controller"],"delegate":[16],"overlayIndex":[2,"overlay-index"],"enterAnimation":[16],"leaveAnimation":[16],"component":[1],"componentProps":[16],"keyboardClose":[4,"keyboard-close"],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"event":[8],"showBackdrop":[4,"show-backdrop"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"triggerAction":[1,"trigger-action"],"trigger":[1],"size":[1],"dismissOnSelect":[4,"dismiss-on-select"],"reference":[1],"side":[1],"alignment":[1],"arrow":[4],"isOpen":[4,"is-open"],"keyboardEvents":[4,"keyboard-events"],"presented":[32],"presentFromTrigger":[64],"present":[64],"dismiss":[64],"getParentPopover":[64],"onDidDismiss":[64],"onWillDismiss":[64]}]]],["ion-app_8",[[0,"ion-app",{"setFocus":[64]}],[1,"ion-content",{"color":[513],"fullscreen":[4],"forceOverscroll":[1028,"force-overscroll"],"scrollX":[4,"scroll-x"],"scrollY":[4,"scroll-y"],"scrollEvents":[4,"scroll-events"],"getScrollElement":[64],"scrollToTop":[64],"scrollToBottom":[64],"scrollByPoint":[64],"scrollToPoint":[64]},[[8,"appload","onAppLoad"]]],[36,"ion-footer",{"collapse":[1],"translucent":[4]}],[36,"ion-header",{"collapse":[1],"translucent":[4]}],[1,"ion-router-outlet",{"mode":[1025],"delegate":[16],"animated":[4],"animation":[16],"swipeHandler":[16],"commit":[64],"setRouteId":[64],"getRouteId":[64]}],[33,"ion-title",{"color":[513],"size":[1]}],[33,"ion-toolbar",{"color":[513]},[[0,"ionStyle","childrenStyle"]]],[34,"ion-buttons",{"collapse":[4]}]]],["ion-item_8",[[33,"ion-item-divider",{"color":[513],"sticky":[4]}],[32,"ion-item-group"],[1,"ion-skeleton-text",{"animated":[4]}],[32,"ion-list",{"lines":[1],"inset":[4],"closeSlidingItems":[64]}],[33,"ion-list-header",{"color":[513],"lines":[1]}],[49,"ion-item",{"color":[513],"button":[4],"detail":[4],"detailIcon":[1,"detail-icon"],"disabled":[4],"download":[1],"fill":[1],"shape":[1],"href":[1],"rel":[1],"lines":[1],"counter":[4],"routerAnimation":[16],"routerDirection":[1,"router-direction"],"target":[1],"type":[1],"multipleInputs":[32],"focusable":[32],"counterString":[32]},[[0,"ionChange","handleIonChange"],[0,"ionColor","labelColorChanged"],[0,"ionStyle","itemStyle"]]],[34,"ion-label",{"color":[513],"position":[1],"noAnimate":[32]}],[33,"ion-note",{"color":[513]}]]],["ion-datetime_3",[[33,"ion-datetime",{"color":[1],"name":[1],"disabled":[4],"readonly":[4],"min":[1025],"max":[1025],"presentation":[1],"cancelText":[1,"cancel-text"],"doneText":[1,"done-text"],"clearText":[1,"clear-text"],"yearValues":[8,"year-values"],"monthValues":[8,"month-values"],"dayValues":[8,"day-values"],"hourValues":[8,"hour-values"],"minuteValues":[8,"minute-values"],"locale":[1],"firstDayOfWeek":[2,"first-day-of-week"],"value":[1025],"showDefaultTitle":[4,"show-default-title"],"showDefaultButtons":[4,"show-default-buttons"],"showClearButton":[4,"show-clear-button"],"showDefaultTimeLabel":[4,"show-default-time-label"],"hourCycle":[1,"hour-cycle"],"size":[1],"showMonthAndYear":[32],"activeParts":[32],"workingParts":[32],"isPresented":[32],"isTimePopoverOpen":[32],"confirm":[64],"reset":[64],"cancel":[64]}],[34,"ion-picker",{"overlayIndex":[2,"overlay-index"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"columns":[16],"cssClass":[1,"css-class"],"duration":[2],"showBackdrop":[4,"show-backdrop"],"backdropDismiss":[4,"backdrop-dismiss"],"animated":[4],"htmlAttributes":[16],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"getColumn":[64]}],[32,"ion-picker-column",{"col":[16]}]]],["ion-spinner",[[1,"ion-spinner",{"color":[513],"duration":[2],"name":[1],"paused":[4]}]]],["ion-radio_2",[[33,"ion-radio",{"color":[513],"name":[1],"disabled":[4],"value":[8],"checked":[32],"buttonTabindex":[32],"setFocus":[64],"setButtonTabindex":[64]}],[0,"ion-radio-group",{"allowEmptySelection":[4,"allow-empty-selection"],"name":[1],"value":[1032]},[[4,"keydown","onKeydown"]]]]],["ion-ripple-effect",[[1,"ion-ripple-effect",{"type":[1],"addRipple":[64]}]]],["ion-button_2",[[33,"ion-button",{"color":[513],"buttonType":[1025,"button-type"],"disabled":[516],"expand":[513],"fill":[1537],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"download":[1],"href":[1],"rel":[1],"shape":[513],"size":[513],"strong":[4],"target":[1],"type":[1]}],[1,"ion-icon",{"mode":[1025],"color":[1],"ios":[1],"md":[1],"flipRtl":[4,"flip-rtl"],"name":[513],"src":[1],"icon":[8],"size":[1],"lazy":[4],"sanitize":[4],"svgContent":[32],"isVisible":[32],"ariaLabel":[32]}]]]]'),Y))))(0,{exclude:["ion-tabs","ion-tab"],syncQueue:!0,raf:qe,jmp:vt=>E.runOutsideAngular(vt),ael(vt,In,Vn,wi){vt[ve](In,Vn,wi)},rel(vt,In,Vn,wi){vt.removeEventListener(In,Vn,wi)}}))}};let ma=(()=>{class D{static forRoot(E){return{ngModule:D,providers:[{provide:Le,useValue:E},{provide:u.ip1,useFactory:is,multi:!0,deps:[Le,ji.K0,u.R0b]}]}}}return D.\u0275fac=function(E){return new(E||D)},D.\u0275mod=u.oAB({type:D}),D.\u0275inj=u.cJS({providers:[Bi,ea,ta],imports:[[ji.ez]]}),D})()},6309:(Tn,Je,R)=>{"use strict";R.d(Je,{c:()=>ge});var u=R(5359);let d;const l=xe=>xe.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),L=xe=>{if(void 0===d){const nt=void 0!==xe.style.webkitAnimationName;d=void 0===xe.style.animationName&&nt?"-webkit-":""}return d},P=(xe,je,nt)=>{const Fe=je.startsWith("animation")?L(xe):"";xe.style.setProperty(Fe+je,nt)},m=(xe,je)=>{const nt=je.startsWith("animation")?L(xe):"";xe.style.removeProperty(nt+je)},V=[],_e=(xe=[],je)=>{if(void 0!==je){const nt=Array.isArray(je)?je:[je];return[...xe,...nt]}return xe},ge=xe=>{let je,nt,Fe,ke,Ne,$e,yt,$t,zt,Ht,en,qt,Gt,Re=[],_t=[],Ge=[],ot=!1,wt={},xt=[],dt=[],At={},Vt=0,Un=!1,St=!1,Kt=!0,Wt=!1,Yt=!0;const ft=xe,Ut=[],On=[],fn=[],Gn=[],ei=[],$i=[],sr=[],zi=[],yi=[],ji=[],_i="function"==typeof AnimationEffect||"function"==typeof window.AnimationEffect,xi="function"==typeof Element&&"function"==typeof Element.prototype.animate&&_i,Ye=()=>ji,Pe=(Ce,tt)=>((tt&&tt.oneTimeCallback?On:Ut).push({c:Ce,o:tt}),Gt),me=()=>{if(xi)ji.forEach(Ce=>{Ce.cancel()}),ji.length=0;else{const Ce=fn.slice();(0,u.r)(()=>{Ce.forEach(tt=>{m(tt,"animation-name"),m(tt,"animation-duration"),m(tt,"animation-timing-function"),m(tt,"animation-iteration-count"),m(tt,"animation-delay"),m(tt,"animation-play-state"),m(tt,"animation-fill-mode"),m(tt,"animation-direction")})})}},qe=()=>{ei.forEach(Ce=>{Ce&&Ce.parentNode&&Ce.parentNode.removeChild(Ce)}),ei.length=0},Ei=()=>void 0!==Ne?Ne:yt?yt.getFill():"both",Rr=()=>void 0!==zt?zt:void 0!==$e?$e:yt?yt.getDirection():"normal",_n=()=>Un?"linear":void 0!==Fe?Fe:yt?yt.getEasing():"linear",tr=()=>St?0:void 0!==Ht?Ht:void 0!==nt?nt:yt?yt.getDuration():0,ie=()=>void 0!==ke?ke:yt?yt.getIterations():1,X=()=>void 0!==en?en:void 0!==je?je:yt?yt.getDelay():0,Hn=()=>{0!==Vt&&(Vt--,0===Vt&&((()=>{go(),zi.forEach(nn=>nn()),yi.forEach(nn=>nn());const Ce=Kt?1:0,tt=xt,It=dt,Lt=At;fn.forEach(nn=>{const dn=nn.classList;tt.forEach(ln=>dn.add(ln)),It.forEach(ln=>dn.remove(ln));for(const ln in Lt)Lt.hasOwnProperty(ln)&&P(nn,ln,Lt[ln])}),Ut.forEach(nn=>nn.c(Ce,Gt)),On.forEach(nn=>nn.c(Ce,Gt)),On.length=0,Yt=!0,Kt&&(Wt=!0),Kt=!0})(),yt&&yt.animationFinish()))},ii=(Ce=!0)=>{qe();const tt=(xe=>(xe.forEach(je=>{for(const nt in je)if(je.hasOwnProperty(nt)){const Fe=je[nt];if("easing"===nt)je["animation-timing-function"]=Fe,delete je[nt];else{const ke=l(nt);ke!==nt&&(je[ke]=Fe,delete je[nt])}}}),xe))(Re);fn.forEach(It=>{if(tt.length>0){const Lt=((xe=[])=>xe.map(je=>{const nt=je.offset,Fe=[];for(const ke in je)je.hasOwnProperty(ke)&&"offset"!==ke&&Fe.push(`${ke}: ${je[ke]};`);return`${100*nt}% { ${Fe.join(" ")} }`}).join(" "))(tt);qt=void 0!==xe?xe:(xe=>{let je=V.indexOf(xe);return je<0&&(je=V.push(xe)-1),`ion-animation-${je}`})(Lt);const nn=((xe,je,nt)=>{const Fe=(xe=>{const je=xe.getRootNode();return je.head||je})(nt),ke=L(nt),Ne=Fe.querySelector("#"+xe);if(Ne)return Ne;const $e=(nt.ownerDocument||document).createElement("style");return $e.id=xe,$e.textContent=`@${ke}keyframes ${xe} { ${je} } @${ke}keyframes ${xe}-alt { ${je} }`,Fe.appendChild($e),$e})(qt,Lt,It);ei.push(nn),P(It,"animation-duration",`${tr()}ms`),P(It,"animation-timing-function",_n()),P(It,"animation-delay",`${X()}ms`),P(It,"animation-fill-mode",Ei()),P(It,"animation-direction",Rr());const dn=ie()===1/0?"infinite":ie().toString();P(It,"animation-iteration-count",dn),P(It,"animation-play-state","paused"),Ce&&P(It,"animation-name",`${nn.id}-alt`),(0,u.r)(()=>{P(It,"animation-name",nn.id||null)})}})},Fi=(Ce=!0)=>{(()=>{$i.forEach(Lt=>Lt()),sr.forEach(Lt=>Lt());const Ce=_t,tt=Ge,It=wt;fn.forEach(Lt=>{const nn=Lt.classList;Ce.forEach(dn=>nn.add(dn)),tt.forEach(dn=>nn.remove(dn));for(const dn in It)It.hasOwnProperty(dn)&&P(Lt,dn,It[dn])})})(),Re.length>0&&(xi?(fn.forEach(Ce=>{const tt=Ce.animate(Re,{id:ft,delay:X(),duration:tr(),easing:_n(),iterations:ie(),fill:Ei(),direction:Rr()});tt.pause(),ji.push(tt)}),ji.length>0&&(ji[0].onfinish=()=>{Hn()})):ii(Ce)),ot=!0},ci=Ce=>{if(Ce=Math.min(Math.max(Ce,0),.9999),xi)ji.forEach(tt=>{tt.currentTime=tt.effect.getComputedTiming().delay+tr()*Ce,tt.pause()});else{const tt=`-${tr()*Ce}ms`;fn.forEach(It=>{Re.length>0&&(P(It,"animation-delay",tt),P(It,"animation-play-state","paused"))})}},Mn=Ce=>{ji.forEach(tt=>{tt.effect.updateTiming({delay:X(),duration:tr(),easing:_n(),iterations:ie(),fill:Ei(),direction:Rr()})}),void 0!==Ce&&ci(Ce)},mi=(Ce=!0,tt)=>{(0,u.r)(()=>{fn.forEach(It=>{P(It,"animation-name",qt||null),P(It,"animation-duration",`${tr()}ms`),P(It,"animation-timing-function",_n()),P(It,"animation-delay",void 0!==tt?`-${tt*tr()}ms`:`${X()}ms`),P(It,"animation-fill-mode",Ei()||null),P(It,"animation-direction",Rr()||null);const Lt=ie()===1/0?"infinite":ie().toString();P(It,"animation-iteration-count",Lt),Ce&&P(It,"animation-name",`${qt}-alt`),(0,u.r)(()=>{P(It,"animation-name",qt||null)})})})},Ii=(Ce=!1,tt=!0,It)=>(Ce&&Gn.forEach(Lt=>{Lt.update(Ce,tt,It)}),xi?Mn(It):mi(tt,It),Gt),_r=()=>{ot&&(xi?ji.forEach(Ce=>{Ce.pause()}):fn.forEach(Ce=>{P(Ce,"animation-play-state","paused")}))},Nr=()=>{$t=void 0,Hn()},go=()=>{$t&&clearTimeout($t)},Pr=Ce=>new Promise(tt=>{Ce&&Ce.sync&&(St=!0,Pe(()=>St=!1,{oneTimeCallback:!0})),ot||Fi(),Wt&&(xi?(ci(0),Mn()):mi(),Wt=!1),Yt&&(Vt=Gn.length+1,Yt=!1),Pe(()=>tt(),{oneTimeCallback:!0}),Gn.forEach(It=>{It.play()}),xi?(ji.forEach(Ce=>{Ce.play()}),(0===Re.length||0===fn.length)&&Hn()):(()=>{if(go(),(0,u.r)(()=>{fn.forEach(Ce=>{Re.length>0&&P(Ce,"animation-play-state","running")})}),0===Re.length||0===fn.length)Hn();else{const Ce=X()||0,tt=tr()||0,It=ie()||1;isFinite(It)&&($t=setTimeout(Nr,Ce+tt*It+100)),((xe,je)=>{let nt;const Fe={passive:!0},Ne=$e=>{xe===$e.target&&(nt&&nt(),go(),(0,u.r)(()=>{fn.forEach(Ce=>{m(Ce,"animation-duration"),m(Ce,"animation-delay"),m(Ce,"animation-play-state")}),(0,u.r)(Hn)}))};xe&&(xe.addEventListener("webkitAnimationEnd",Ne,Fe),xe.addEventListener("animationend",Ne,Fe),nt=()=>{xe.removeEventListener("webkitAnimationEnd",Ne,Fe),xe.removeEventListener("animationend",Ne,Fe)})})(fn[0])}})()}),Vr=(Ce,tt)=>{const It=Re[0];return void 0===It||void 0!==It.offset&&0!==It.offset?Re=[{offset:0,[Ce]:tt},...Re]:It[Ce]=tt,Gt};return Gt={parentAnimation:yt,elements:fn,childAnimations:Gn,id:ft,animationFinish:Hn,from:Vr,to:(Ce,tt)=>{const It=Re[Re.length-1];return void 0===It||void 0!==It.offset&&1!==It.offset?Re=[...Re,{offset:1,[Ce]:tt}]:It[Ce]=tt,Gt},fromTo:(Ce,tt,It)=>Vr(Ce,tt).to(Ce,It),parent:Ce=>(yt=Ce,Gt),play:Pr,pause:()=>(Gn.forEach(Ce=>{Ce.pause()}),_r(),Gt),stop:()=>{Gn.forEach(Ce=>{Ce.stop()}),ot&&(me(),ot=!1),Un=!1,St=!1,Yt=!0,zt=void 0,Ht=void 0,en=void 0,Vt=0,Wt=!1,Kt=!0},destroy:Ce=>(Gn.forEach(tt=>{tt.destroy(Ce)}),(Ce=>{me(),Ce&&qe()})(Ce),fn.length=0,Gn.length=0,Re.length=0,Ut.length=0,On.length=0,ot=!1,Yt=!0,Gt),keyframes:Ce=>{const tt=Re!==Ce;return Re=Ce,tt&&(Ce=>{xi?Ye().forEach(tt=>{if(tt.effect.setKeyframes)tt.effect.setKeyframes(Ce);else{const It=new KeyframeEffect(tt.effect.target,Ce,tt.effect.getTiming());tt.effect=It}}):ii()})(Re),Gt},addAnimation:Ce=>{if(null!=Ce)if(Array.isArray(Ce))for(const tt of Ce)tt.parent(Gt),Gn.push(tt);else Ce.parent(Gt),Gn.push(Ce);return Gt},addElement:Ce=>{if(null!=Ce)if(1===Ce.nodeType)fn.push(Ce);else if(Ce.length>=0)for(let tt=0;tt<Ce.length;tt++)fn.push(Ce[tt]);else console.error("Invalid addElement value");return Gt},update:Ii,fill:Ce=>(Ne=Ce,Ii(!0),Gt),direction:Ce=>($e=Ce,Ii(!0),Gt),iterations:Ce=>(ke=Ce,Ii(!0),Gt),duration:Ce=>(!xi&&0===Ce&&(Ce=1),nt=Ce,Ii(!0),Gt),easing:Ce=>(Fe=Ce,Ii(!0),Gt),delay:Ce=>(je=Ce,Ii(!0),Gt),getWebAnimations:Ye,getKeyframes:()=>Re,getFill:Ei,getDirection:Rr,getDelay:X,getIterations:ie,getEasing:_n,getDuration:tr,afterAddRead:Ce=>(zi.push(Ce),Gt),afterAddWrite:Ce=>(yi.push(Ce),Gt),afterClearStyles:(Ce=[])=>{for(const tt of Ce)At[tt]="";return Gt},afterStyles:(Ce={})=>(At=Ce,Gt),afterRemoveClass:Ce=>(dt=_e(dt,Ce),Gt),afterAddClass:Ce=>(xt=_e(xt,Ce),Gt),beforeAddRead:Ce=>($i.push(Ce),Gt),beforeAddWrite:Ce=>(sr.push(Ce),Gt),beforeClearStyles:(Ce=[])=>{for(const tt of Ce)wt[tt]="";return Gt},beforeStyles:(Ce={})=>(wt=Ce,Gt),beforeRemoveClass:Ce=>(Ge=_e(Ge,Ce),Gt),beforeAddClass:Ce=>(_t=_e(_t,Ce),Gt),onFinish:Pe,progressStart:(Ce=!1,tt)=>(Gn.forEach(It=>{It.progressStart(Ce,tt)}),_r(),Un=Ce,ot||Fi(),Ii(!1,!0,tt),Gt),progressStep:Ce=>(Gn.forEach(tt=>{tt.progressStep(Ce)}),ci(Ce),Gt),progressEnd:(Ce,tt,It)=>(Un=!1,Gn.forEach(Lt=>{Lt.progressEnd(Ce,tt,It)}),void 0!==It&&(Ht=It),Wt=!1,Kt=!0,0===Ce?(zt="reverse"===Rr()?"normal":"reverse","reverse"===zt&&(Kt=!1),xi?(Ii(),ci(1-tt)):(en=(1-tt)*tr()*-1,Ii(!1,!1))):1===Ce&&(xi?(Ii(),ci(tt)):(en=tt*tr()*-1,Ii(!1,!1))),void 0!==Ce&&(Pe(()=>{Ht=void 0,zt=void 0,en=void 0},{oneTimeCallback:!0}),yt||Pr()),Gt)}}},2733:(Tn,Je,R)=>{"use strict";R.d(Je,{G:()=>L});class d{constructor(m,$,ue,V,Z){this.id=$,this.name=ue,this.disableScroll=Z,this.priority=1e6*V+$,this.ctrl=m}canStart(){return!!this.ctrl&&this.ctrl.canStart(this.name)}start(){return!!this.ctrl&&this.ctrl.start(this.name,this.id,this.priority)}capture(){if(!this.ctrl)return!1;const m=this.ctrl.capture(this.name,this.id,this.priority);return m&&this.disableScroll&&this.ctrl.disableScroll(this.id),m}release(){this.ctrl&&(this.ctrl.release(this.id),this.disableScroll&&this.ctrl.enableScroll(this.id))}destroy(){this.release(),this.ctrl=void 0}}class j{constructor(m,$,ue,V){this.id=$,this.disable=ue,this.disableScroll=V,this.ctrl=m}block(){if(this.ctrl){if(this.disable)for(const m of this.disable)this.ctrl.disableGesture(m,this.id);this.disableScroll&&this.ctrl.disableScroll(this.id)}}unblock(){if(this.ctrl){if(this.disable)for(const m of this.disable)this.ctrl.enableGesture(m,this.id);this.disableScroll&&this.ctrl.enableScroll(this.id)}}destroy(){this.unblock(),this.ctrl=void 0}}const l="backdrop-no-scroll",L=new class u{constructor(){this.gestureId=0,this.requestedStart=new Map,this.disabledGestures=new Map,this.disabledScroll=new Set}createGesture(m){return new d(this,this.newID(),m.name,m.priority||0,!!m.disableScroll)}createBlocker(m={}){return new j(this,this.newID(),m.disable,!!m.disableScroll)}start(m,$,ue){return this.canStart(m)?(this.requestedStart.set($,ue),!0):(this.requestedStart.delete($),!1)}capture(m,$,ue){if(!this.start(m,$,ue))return!1;const V=this.requestedStart;let Z=-1e4;if(V.forEach(K=>{Z=Math.max(Z,K)}),Z===ue){this.capturedId=$,V.clear();const K=new CustomEvent("ionGestureCaptured",{detail:{gestureName:m}});return document.dispatchEvent(K),!0}return V.delete($),!1}release(m){this.requestedStart.delete(m),this.capturedId===m&&(this.capturedId=void 0)}disableGesture(m,$){let ue=this.disabledGestures.get(m);void 0===ue&&(ue=new Set,this.disabledGestures.set(m,ue)),ue.add($)}enableGesture(m,$){const ue=this.disabledGestures.get(m);void 0!==ue&&ue.delete($)}disableScroll(m){this.disabledScroll.add(m),1===this.disabledScroll.size&&document.body.classList.add(l)}enableScroll(m){this.disabledScroll.delete(m),0===this.disabledScroll.size&&document.body.classList.remove(l)}canStart(m){return!(void 0!==this.capturedId||this.isDisabled(m))}isCaptured(){return void 0!==this.capturedId}isScrollDisabled(){return this.disabledScroll.size>0}isDisabled(m){const $=this.disabledGestures.get(m);return!!($&&$.size>0)}newID(){return this.gestureId++,this.gestureId}}},527:(Tn,Je,R)=>{"use strict";R.r(Je),R.d(Je,{MENU_BACK_BUTTON_PRIORITY:()=>L,OVERLAY_BACK_BUTTON_PRIORITY:()=>l,blockHardwareBackButton:()=>d,startHardwareBackButton:()=>j});var u=R(6099);const d=()=>{document.addEventListener("backbutton",()=>{})},j=()=>{const P=document;let m=!1;P.addEventListener("backbutton",()=>{if(m)return;let $=0,ue=[];const V=new CustomEvent("ionBackButton",{bubbles:!1,detail:{register(re,_e){ue.push({priority:re,handler:_e,id:$++})}}});P.dispatchEvent(V);const Z=function(){var re=(0,u.Z)(function*(_e){try{if(_e&&_e.handler){const ge=_e.handler(K);null!=ge&&(yield ge)}}catch(ge){console.error(ge)}});return function(ge){return re.apply(this,arguments)}}(),K=()=>{if(ue.length>0){let re={priority:Number.MIN_SAFE_INTEGER,handler:()=>{},id:-1};ue.forEach(_e=>{_e.priority>=re.priority&&(re=_e)}),m=!0,ue=ue.filter(_e=>_e.id!==re.id),Z(re).then(()=>m=!1)}};K()})},l=100,L=99},5359:(Tn,Je,R)=>{"use strict";R.d(Je,{a:()=>L,b:()=>P,c:()=>j,d:()=>K,e:()=>re,f:()=>Z,g:()=>m,h:()=>Fe,i:()=>l,j:()=>V,k:()=>_e,l:()=>ue,m:()=>ge,n:()=>nt,o:()=>ke,p:()=>je,q:()=>xe,r:()=>$,t:()=>u});const u=(Ne,$e=0)=>new Promise(Re=>{d(Ne,$e,Re)}),d=(Ne,$e=0,Re)=>{let _t,Ge;const ot={passive:!0},wt=()=>{_t&&_t()},xt=dt=>{(void 0===dt||Ne===dt.target)&&(wt(),Re(dt))};return Ne&&(Ne.addEventListener("webkitTransitionEnd",xt,ot),Ne.addEventListener("transitionend",xt,ot),Ge=setTimeout(xt,$e+500),_t=()=>{Ge&&(clearTimeout(Ge),Ge=void 0),Ne.removeEventListener("webkitTransitionEnd",xt,ot),Ne.removeEventListener("transitionend",xt,ot)}),wt},j=(Ne,$e)=>{Ne.componentOnReady?Ne.componentOnReady().then(Re=>$e(Re)):$(()=>$e(Ne))},l=(Ne,$e=[])=>{const Re={};return $e.forEach(_t=>{Ne.hasAttribute(_t)&&(null!==Ne.getAttribute(_t)&&(Re[_t]=Ne.getAttribute(_t)),Ne.removeAttribute(_t))}),Re},L=(Ne,$e,Re,_t)=>{if("undefined"!=typeof window){const Ge=window,ot=Ge&&Ge.Ionic&&Ge.Ionic.config;if(ot){const yt=ot.get("_ael");if(yt)return yt(Ne,$e,Re,_t);if(ot._ael)return ot._ael(Ne,$e,Re,_t)}}return Ne.addEventListener($e,Re,_t)},P=(Ne,$e,Re,_t)=>{if("undefined"!=typeof window){const Ge=window,ot=Ge&&Ge.Ionic&&Ge.Ionic.config;if(ot){const yt=ot.get("_rel");if(yt)return yt(Ne,$e,Re,_t);if(ot._rel)return ot._rel(Ne,$e,Re,_t)}}return Ne.removeEventListener($e,Re,_t)},m=(Ne,$e=Ne)=>Ne.shadowRoot||$e,$=Ne=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(Ne):"function"==typeof requestAnimationFrame?requestAnimationFrame(Ne):setTimeout(Ne),ue=Ne=>!!Ne.shadowRoot&&!!Ne.attachShadow,V=Ne=>{const $e=Ne.closest("ion-item");return $e?$e.querySelector("ion-label"):null},Z=Ne=>{if(Ne.focus(),Ne.classList.contains("ion-focusable")){const $e=Ne.closest("ion-app");$e&&$e.setFocus([Ne])}},K=(Ne,$e)=>{let Re;const _t=Ne.getAttribute("aria-labelledby"),Ge=Ne.id;let ot=null!==_t&&""!==_t.trim()?_t:$e+"-lbl",yt=null!==_t&&""!==_t.trim()?document.getElementById(_t):V(Ne);return yt?(null===_t&&(yt.id=ot),Re=yt.textContent,yt.setAttribute("aria-hidden","true")):""!==Ge.trim()&&(yt=document.querySelector(`label[for="${Ge}"]`),yt&&(""!==yt.id?ot=yt.id:yt.id=ot=`${Ge}-lbl`,Re=yt.textContent)),{label:yt,labelId:ot,labelText:Re}},re=(Ne,$e,Re,_t,Ge)=>{if(Ne||ue($e)){let ot=$e.querySelector("input.aux-input");ot||(ot=$e.ownerDocument.createElement("input"),ot.type="hidden",ot.classList.add("aux-input"),$e.appendChild(ot)),ot.disabled=Ge,ot.name=Re,ot.value=_t||""}},_e=(Ne,$e,Re)=>Math.max(Ne,Math.min($e,Re)),ge=(Ne,$e)=>{if(!Ne){const Re="ASSERT: "+$e;throw console.error(Re),new Error(Re)}},xe=Ne=>Ne.timeStamp||Date.now(),je=Ne=>{if(Ne){const $e=Ne.changedTouches;if($e&&$e.length>0){const Re=$e[0];return{x:Re.clientX,y:Re.clientY}}if(void 0!==Ne.pageX)return{x:Ne.pageX,y:Ne.pageY}}return{x:0,y:0}},nt=Ne=>{const $e="rtl"===document.dir;switch(Ne){case"start":return $e;case"end":return!$e;default:throw new Error(`"${Ne}" is not a valid value for [side]. Use "start" or "end" instead.`)}},Fe=(Ne,$e)=>{const Re=Ne._original||Ne;return{_original:Ne,emit:ke(Re.emit.bind(Re),$e)}},ke=(Ne,$e=0)=>{let Re;return(..._t)=>{clearTimeout(Re),Re=setTimeout(Ne,$e,..._t)}}},9533:(Tn,Je,R)=>{"use strict";R.d(Je,{B:()=>Vr,H:()=>ei,a:()=>Wt,b:()=>ii,c:()=>Lr,e:()=>Vi,f:()=>Pr,g:()=>Yt,h:()=>fn,i:()=>Cr,j:()=>ie,k:()=>Ui,p:()=>xe,r:()=>Mn,s:()=>_e});var u=R(6099);let j,l,L,P=!1,m=!1,$=!1,ue=!1,V=!1;const Z="undefined"!=typeof window?window:{},K=Z.document||{head:{}},re={$flags$:0,$resourcesUrl$:"",jmp:Ee=>Ee(),raf:Ee=>requestAnimationFrame(Ee),ael:(Ee,He,Ce,tt)=>Ee.addEventListener(He,Ce,tt),rel:(Ee,He,Ce,tt)=>Ee.removeEventListener(He,Ce,tt),ce:(Ee,He)=>new CustomEvent(Ee,He)},_e=Ee=>{Object.assign(re,Ee)},xe=Ee=>Promise.resolve(Ee),je=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replace}catch{}return!1})(),nt=(Ee,He,Ce,tt)=>{Ce&&Ce.map(([It,Lt,nn])=>{const dn=ke(Ee,It),ln=Fe(He,nn),En=Ne(It);re.ael(dn,Lt,ln,En),(He.$rmListeners$=He.$rmListeners$||[]).push(()=>re.rel(dn,Lt,ln,En))})},Fe=(Ee,He)=>Ce=>{try{256&Ee.$flags$?Ee.$lazyInstance$[He](Ce):(Ee.$queuedListeners$=Ee.$queuedListeners$||[]).push([He,Ce])}catch(tt){Zi(tt)}},ke=(Ee,He)=>4&He?K:8&He?Z:16&He?K.body:Ee,Ne=Ee=>0!=(2&Ee),ot="s-id",yt="sty-id",dt="http://www.w3.org/1999/xlink",Un=new WeakMap,St=(Ee,He,Ce)=>{let tt=_r.get(Ee);je&&Ce?(tt=tt||new CSSStyleSheet,tt.replace(He)):tt=He,_r.set(Ee,tt)},$t=(Ee,He,Ce,tt)=>{let It=Ht(He,Ce),Lt=_r.get(It);if(Ee=11===Ee.nodeType?Ee:K,Lt)if("string"==typeof Lt){let dn,nn=Un.get(Ee=Ee.head||Ee);nn||Un.set(Ee,nn=new Set),nn.has(It)||(Ee.host&&(dn=Ee.querySelector(`[${yt}="${It}"]`))?dn.innerHTML=Lt:(dn=K.createElement("style"),dn.innerHTML=Lt,Ee.insertBefore(dn,Ee.querySelector("link"))),nn&&nn.add(It))}else Ee.adoptedStyleSheets.includes(Lt)||(Ee.adoptedStyleSheets=[...Ee.adoptedStyleSheets,Lt]);return It},Ht=(Ee,He)=>"sc-"+(He&&32&Ee.$flags$?Ee.$tagName$+"-"+He:Ee.$tagName$),en=Ee=>Ee.replace(/\/\*!@([^\/]+)\*\/[^\{]+\{/g,"$1{"),Wt=Ee=>ur.push(Ee),Yt=Ee=>ci(Ee).$modeName$,qt={},On=Ee=>"object"==(Ee=typeof Ee)||"function"===Ee,fn=(Ee,He,...Ce)=>{let tt=null,It=null,Lt=null,nn=!1,dn=!1,ln=[];const En=Ot=>{for(let cn=0;cn<Ot.length;cn++)tt=Ot[cn],Array.isArray(tt)?En(tt):null!=tt&&"boolean"!=typeof tt&&((nn="function"!=typeof Ee&&!On(tt))&&(tt=String(tt)),nn&&dn?ln[ln.length-1].$text$+=tt:ln.push(nn?Gn(null,tt):tt),dn=nn)};if(En(Ce),He){He.key&&(It=He.key),He.name&&(Lt=He.name);{const Ot=He.className||He.class;Ot&&(He.class="object"!=typeof Ot?Ot:Object.keys(Ot).filter(cn=>Ot[cn]).join(" "))}}if("function"==typeof Ee)return Ee(null===He?{}:He,ln,sr);const $n=Gn(Ee,null);return $n.$attrs$=He,ln.length>0&&($n.$children$=ln),$n.$key$=It,$n.$name$=Lt,$n},Gn=(Ee,He)=>({$flags$:0,$tag$:Ee,$text$:He,$elm$:null,$children$:null,$attrs$:null,$key$:null,$name$:null}),ei={},sr={forEach:(Ee,He)=>Ee.map(zi).forEach(He),map:(Ee,He)=>Ee.map(zi).map(He).map(yi)},zi=Ee=>({vattrs:Ee.$attrs$,vchildren:Ee.$children$,vkey:Ee.$key$,vname:Ee.$name$,vtag:Ee.$tag$,vtext:Ee.$text$}),yi=Ee=>{if("function"==typeof Ee.vtag){const Ce=Object.assign({},Ee.vattrs);return Ee.vkey&&(Ce.key=Ee.vkey),Ee.vname&&(Ce.name=Ee.vname),fn(Ee.vtag,Ce,...Ee.vchildren||[])}const He=Gn(Ee.vtag,Ee.vtext);return He.$attrs$=Ee.vattrs,He.$children$=Ee.vchildren,He.$key$=Ee.vkey,He.$name$=Ee.vname,He},ji=(Ee,He,Ce,tt,It,Lt)=>{if(Ce!==tt){let nn=Ii(Ee,He),dn=He.toLowerCase();if("class"===He){const ln=Ee.classList,En=xi(Ce),$n=xi(tt);ln.remove(...En.filter(Ot=>Ot&&!$n.includes(Ot))),ln.add(...$n.filter(Ot=>Ot&&!En.includes(Ot)))}else if("style"===He){for(const ln in Ce)(!tt||null==tt[ln])&&(ln.includes("-")?Ee.style.removeProperty(ln):Ee.style[ln]="");for(const ln in tt)(!Ce||tt[ln]!==Ce[ln])&&(ln.includes("-")?Ee.style.setProperty(ln,tt[ln]):Ee.style[ln]=tt[ln])}else if("key"!==He)if("ref"===He)tt&&tt(Ee);else if(nn||"o"!==He[0]||"n"!==He[1]){const ln=On(tt);if((nn||ln&&null!==tt)&&!It)try{if(Ee.tagName.includes("-"))Ee[He]=tt;else{let $n=tt??"";"list"===He?nn=!1:(null==Ce||Ee[He]!=$n)&&(Ee[He]=$n)}}catch{}let En=!1;dn!==(dn=dn.replace(/^xlink\:?/,""))&&(He=dn,En=!0),null==tt||!1===tt?(!1!==tt||""===Ee.getAttribute(He))&&(En?Ee.removeAttributeNS(dt,He):Ee.removeAttribute(He)):(!nn||4&Lt||It)&&!ln&&(tt=!0===tt?"":tt,En?Ee.setAttributeNS(dt,He,tt):Ee.setAttribute(He,tt))}else He="-"===He[2]?He.slice(3):Ii(Z,dn)?dn.slice(2):dn[2]+He.slice(3),Ce&&re.rel(Ee,He,Ce,!1),tt&&re.ael(Ee,He,tt,!1)}},_i=/\s/,xi=Ee=>Ee?Ee.split(_i):[],Qt=(Ee,He,Ce,tt)=>{const It=11===He.$elm$.nodeType&&He.$elm$.host?He.$elm$.host:He.$elm$,Lt=Ee&&Ee.$attrs$||qt,nn=He.$attrs$||qt;for(tt in Lt)tt in nn||ji(It,tt,Lt[tt],void 0,Ce,He.$flags$);for(tt in nn)ji(It,tt,Lt[tt],nn[tt],Ce,He.$flags$)},Ye=(Ee,He,Ce,tt)=>{let nn,dn,ln,It=He.$children$[Ce],Lt=0;if(P||($=!0,"slot"===It.$tag$&&(j&&tt.classList.add(j+"-s"),It.$flags$|=It.$children$?2:1)),null!==It.$text$)nn=It.$elm$=K.createTextNode(It.$text$);else if(1&It.$flags$)nn=It.$elm$=K.createTextNode("");else{if(ue||(ue="svg"===It.$tag$),nn=It.$elm$=K.createElementNS(ue?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",2&It.$flags$?"slot-fb":It.$tag$),ue&&"foreignObject"===It.$tag$&&(ue=!1),Qt(null,It,ue),(Ee=>null!=Ee)(j)&&nn["s-si"]!==j&&nn.classList.add(nn["s-si"]=j),It.$children$)for(Lt=0;Lt<It.$children$.length;++Lt)dn=Ye(Ee,It,Lt,nn),dn&&nn.appendChild(dn);"svg"===It.$tag$?ue=!1:"foreignObject"===nn.tagName&&(ue=!0)}return nn["s-hn"]=L,3&It.$flags$&&(nn["s-sr"]=!0,nn["s-cr"]=l,nn["s-sn"]=It.$name$||"",ln=Ee&&Ee.$children$&&Ee.$children$[Ce],ln&&ln.$tag$===It.$tag$&&Ee.$elm$&&te(Ee.$elm$,!1)),nn},te=(Ee,He)=>{re.$flags$|=1;const Ce=Ee.childNodes;for(let tt=Ce.length-1;tt>=0;tt--){const It=Ce[tt];It["s-hn"]!==L&&It["s-ol"]&&(qe(It).insertBefore(It,me(It)),It["s-ol"].remove(),It["s-ol"]=void 0,$=!0),He&&te(It,He)}re.$flags$&=-2},Ae=(Ee,He,Ce,tt,It,Lt)=>{let dn,nn=Ee["s-cr"]&&Ee["s-cr"].parentNode||Ee;for(nn.shadowRoot&&nn.tagName===L&&(nn=nn.shadowRoot);It<=Lt;++It)tt[It]&&(dn=Ye(null,Ce,It,Ee),dn&&(tt[It].$elm$=dn,nn.insertBefore(dn,me(He))))},ut=(Ee,He,Ce,tt,It)=>{for(;He<=Ce;++He)(tt=Ee[He])&&(It=tt.$elm$,gi(tt),m=!0,It["s-ol"]?It["s-ol"].remove():te(It,!0),It.remove())},Nt=(Ee,He)=>Ee.$tag$===He.$tag$&&("slot"===Ee.$tag$?Ee.$name$===He.$name$:Ee.$key$===He.$key$),me=Ee=>Ee&&Ee["s-ol"]||Ee,qe=Ee=>(Ee["s-ol"]?Ee["s-ol"]:Ee).parentNode,Rt=(Ee,He)=>{const Ce=He.$elm$=Ee.$elm$,tt=Ee.$children$,It=He.$children$,Lt=He.$tag$,nn=He.$text$;let dn;null===nn?(ue="svg"===Lt||"foreignObject"!==Lt&&ue,"slot"===Lt||Qt(Ee,He,ue),null!==tt&&null!==It?((Ee,He,Ce,tt)=>{let $r,Hi,It=0,Lt=0,nn=0,dn=0,ln=He.length-1,En=He[0],$n=He[ln],Ot=tt.length-1,cn=tt[0],ki=tt[Ot];for(;It<=ln&&Lt<=Ot;)if(null==En)En=He[++It];else if(null==$n)$n=He[--ln];else if(null==cn)cn=tt[++Lt];else if(null==ki)ki=tt[--Ot];else if(Nt(En,cn))Rt(En,cn),En=He[++It],cn=tt[++Lt];else if(Nt($n,ki))Rt($n,ki),$n=He[--ln],ki=tt[--Ot];else if(Nt(En,ki))("slot"===En.$tag$||"slot"===ki.$tag$)&&te(En.$elm$.parentNode,!1),Rt(En,ki),Ee.insertBefore(En.$elm$,$n.$elm$.nextSibling),En=He[++It],ki=tt[--Ot];else if(Nt($n,cn))("slot"===En.$tag$||"slot"===ki.$tag$)&&te($n.$elm$.parentNode,!1),Rt($n,cn),Ee.insertBefore($n.$elm$,En.$elm$),$n=He[--ln],cn=tt[++Lt];else{for(nn=-1,dn=It;dn<=ln;++dn)if(He[dn]&&null!==He[dn].$key$&&He[dn].$key$===cn.$key$){nn=dn;break}nn>=0?(Hi=He[nn],Hi.$tag$!==cn.$tag$?$r=Ye(He&&He[Lt],Ce,nn,Ee):(Rt(Hi,cn),He[nn]=void 0,$r=Hi.$elm$),cn=tt[++Lt]):($r=Ye(He&&He[Lt],Ce,Lt,Ee),cn=tt[++Lt]),$r&&qe(En.$elm$).insertBefore($r,me(En.$elm$))}It>ln?Ae(Ee,null==tt[Ot+1]?null:tt[Ot+1].$elm$,Ce,tt,Lt,Ot):Lt>Ot&&ut(He,It,ln)})(Ce,tt,He,It):null!==It?(null!==Ee.$text$&&(Ce.textContent=""),Ae(Ce,null,He,It,0,It.length-1)):null!==tt&&ut(tt,0,tt.length-1),ue&&"svg"===Lt&&(ue=!1)):(dn=Ce["s-cr"])?dn.parentNode.textContent=nn:Ee.$text$!==nn&&(Ce.data=nn)},Xt=Ee=>{let Ce,tt,It,Lt,nn,dn,He=Ee.childNodes;for(tt=0,It=He.length;tt<It;tt++)if(Ce=He[tt],1===Ce.nodeType){if(Ce["s-sr"])for(nn=Ce["s-sn"],Ce.hidden=!1,Lt=0;Lt<It;Lt++)if(dn=He[Lt].nodeType,He[Lt]["s-hn"]!==Ce["s-hn"]||""!==nn){if(1===dn&&nn===He[Lt].getAttribute("slot")){Ce.hidden=!0;break}}else if(1===dn||3===dn&&""!==He[Lt].textContent.trim()){Ce.hidden=!0;break}Xt(Ce)}},Xn=[],Ki=Ee=>{let He,Ce,tt,It,Lt,nn,dn=0,ln=Ee.childNodes,En=ln.length;for(;dn<En;dn++){if(He=ln[dn],He["s-sr"]&&(Ce=He["s-cr"])&&Ce.parentNode)for(tt=Ce.parentNode.childNodes,It=He["s-sn"],nn=tt.length-1;nn>=0;nn--)Ce=tt[nn],!Ce["s-cn"]&&!Ce["s-nr"]&&Ce["s-hn"]!==He["s-hn"]&&(Di(Ce,It)?(Lt=Xn.find($n=>$n.$nodeToRelocate$===Ce),m=!0,Ce["s-sn"]=Ce["s-sn"]||It,Lt?Lt.$slotRefNode$=He:Xn.push({$slotRefNode$:He,$nodeToRelocate$:Ce}),Ce["s-sr"]&&Xn.map($n=>{Di($n.$nodeToRelocate$,Ce["s-sn"])&&(Lt=Xn.find(Ot=>Ot.$nodeToRelocate$===Ce),Lt&&!$n.$slotRefNode$&&($n.$slotRefNode$=Lt.$slotRefNode$))})):Xn.some($n=>$n.$nodeToRelocate$===Ce)||Xn.push({$nodeToRelocate$:Ce}));1===He.nodeType&&Ki(He)}},Di=(Ee,He)=>1===Ee.nodeType?null===Ee.getAttribute("slot")&&""===He||Ee.getAttribute("slot")===He:Ee["s-sn"]===He||""===He,gi=Ee=>{Ee.$attrs$&&Ee.$attrs$.ref&&Ee.$attrs$.ref(null),Ee.$children$&&Ee.$children$.map(gi)},Cr=Ee=>ci(Ee).$hostElement$,Vi=(Ee,He,Ce)=>{const tt=Cr(Ee);return{emit:It=>gr(tt,He,{bubbles:!!(4&Ce),composed:!!(2&Ce),cancelable:!!(1&Ce),detail:It})}},gr=(Ee,He,Ce)=>{const tt=re.ce(He,Ce);return Ee.dispatchEvent(tt),tt},Pi=(Ee,He)=>{He&&!Ee.$onRenderResolve$&&He["s-p"]&&He["s-p"].push(new Promise(Ce=>Ee.$onRenderResolve$=Ce))},Br=(Ee,He)=>{if(Ee.$flags$|=16,!(4&Ee.$flags$))return Pi(Ee,Ee.$ancestorComponent$),Lr(()=>Ei(Ee,He));Ee.$flags$|=512},Ei=(Ee,He)=>{const tt=Ee.$lazyInstance$;let It;return He&&(Ee.$flags$|=256,Ee.$queuedListeners$&&(Ee.$queuedListeners$.map(([Lt,nn])=>F(tt,Lt,nn)),Ee.$queuedListeners$=null),It=F(tt,"componentWillLoad")),It=he(It,()=>F(tt,"componentWillRender")),he(It,()=>Rr(Ee,tt,He))},Rr=function(){var Ee=(0,u.Z)(function*(He,Ce,tt){const It=He.$hostElement$,nn=It["s-rc"];tt&&(Ee=>{const He=Ee.$cmpMeta$,Ce=Ee.$hostElement$,tt=He.$flags$,Lt=$t(Ce.shadowRoot?Ce.shadowRoot:Ce.getRootNode(),He,Ee.$modeName$);10&tt&&(Ce["s-sc"]=Lt,Ce.classList.add(Lt+"-h"),2&tt&&Ce.classList.add(Lt+"-s"))})(He);_n(He,Ce),nn&&(nn.map(ln=>ln()),It["s-rc"]=void 0);{const ln=It["s-p"],En=()=>tr(He);0===ln.length?En():(Promise.all(ln).then(En),He.$flags$|=4,ln.length=0)}});return function(Ce,tt,It){return Ee.apply(this,arguments)}}(),_n=(Ee,He,Ce)=>{try{He=He.render&&He.render(),Ee.$flags$&=-17,Ee.$flags$|=2,((Ee,He)=>{const Ce=Ee.$hostElement$,tt=Ee.$cmpMeta$,It=Ee.$vnode$||Gn(null,null),Lt=(Ee=>Ee&&Ee.$tag$===ei)(He)?He:fn(null,null,He);if(L=Ce.tagName,tt.$attrsToReflect$&&(Lt.$attrs$=Lt.$attrs$||{},tt.$attrsToReflect$.map(([nn,dn])=>Lt.$attrs$[dn]=Ce[nn])),Lt.$tag$=null,Lt.$flags$|=4,Ee.$vnode$=Lt,Lt.$elm$=It.$elm$=Ce.shadowRoot||Ce,j=Ce["s-sc"],l=Ce["s-cr"],P=0!=(1&tt.$flags$),m=!1,Rt(It,Lt),re.$flags$|=1,$){Ki(Lt.$elm$);let nn,dn,ln,En,$n,Ot,cn=0;for(;cn<Xn.length;cn++)nn=Xn[cn],dn=nn.$nodeToRelocate$,dn["s-ol"]||(ln=K.createTextNode(""),ln["s-nr"]=dn,dn.parentNode.insertBefore(dn["s-ol"]=ln,dn));for(cn=0;cn<Xn.length;cn++)if(nn=Xn[cn],dn=nn.$nodeToRelocate$,nn.$slotRefNode$){for(En=nn.$slotRefNode$.parentNode,$n=nn.$slotRefNode$.nextSibling,ln=dn["s-ol"];ln=ln.previousSibling;)if(Ot=ln["s-nr"],Ot&&Ot["s-sn"]===dn["s-sn"]&&En===Ot.parentNode&&(Ot=Ot.nextSibling,!Ot||!Ot["s-nr"])){$n=Ot;break}(!$n&&En!==dn.parentNode||dn.nextSibling!==$n)&&dn!==$n&&(!dn["s-hn"]&&dn["s-ol"]&&(dn["s-hn"]=dn["s-ol"].parentNode.nodeName),En.insertBefore(dn,$n))}else 1===dn.nodeType&&(dn.hidden=!0)}m&&Xt(Lt.$elm$),re.$flags$&=-2,Xn.length=0})(Ee,He)}catch(tt){Zi(tt,Ee.$hostElement$)}return null},tr=Ee=>{const Ce=Ee.$hostElement$,It=Ee.$lazyInstance$,Lt=Ee.$ancestorComponent$;64&Ee.$flags$?F(It,"componentDidUpdate"):(Ee.$flags$|=64,Te(Ce),F(It,"componentDidLoad"),Ee.$onReadyResolve$(Ce),Lt||X()),Ee.$onInstanceResolve$(Ce),Ee.$onRenderResolve$&&(Ee.$onRenderResolve$(),Ee.$onRenderResolve$=void 0),512&Ee.$flags$&&Jr(()=>Br(Ee,!1)),Ee.$flags$&=-517},ie=Ee=>{{const He=ci(Ee),Ce=He.$hostElement$.isConnected;return Ce&&2==(18&He.$flags$)&&Br(He,!1),Ce}},X=Ee=>{Te(K.documentElement),Jr(()=>gr(Z,"appload",{detail:{namespace:"ionic"}}))},F=(Ee,He,Ce)=>{if(Ee&&Ee[He])try{return Ee[He](Ce)}catch(tt){Zi(tt)}},he=(Ee,He)=>Ee&&Ee.then?Ee.then(He):He(),Te=Ee=>Ee.classList.add("hydrated"),mt=(Ee,He,Ce,tt,It,Lt,nn)=>{let dn,ln,En,$n;if(1===Lt.nodeType){for(dn=Lt.getAttribute("c-id"),dn&&(ln=dn.split("."),(ln[0]===nn||"0"===ln[0])&&(En={$flags$:0,$hostId$:ln[0],$nodeId$:ln[1],$depth$:ln[2],$index$:ln[3],$tag$:Lt.tagName.toLowerCase(),$elm$:Lt,$attrs$:null,$children$:null,$key$:null,$name$:null,$text$:null},He.push(En),Lt.removeAttribute("c-id"),Ee.$children$||(Ee.$children$=[]),Ee.$children$[En.$index$]=En,Ee=En,tt&&"0"===En.$depth$&&(tt[En.$index$]=En.$elm$))),$n=Lt.childNodes.length-1;$n>=0;$n--)mt(Ee,He,Ce,tt,It,Lt.childNodes[$n],nn);if(Lt.shadowRoot)for($n=Lt.shadowRoot.childNodes.length-1;$n>=0;$n--)mt(Ee,He,Ce,tt,It,Lt.shadowRoot.childNodes[$n],nn)}else if(8===Lt.nodeType)ln=Lt.nodeValue.split("."),(ln[1]===nn||"0"===ln[1])&&(dn=ln[0],En={$flags$:0,$hostId$:ln[1],$nodeId$:ln[2],$depth$:ln[3],$index$:ln[4],$elm$:Lt,$attrs$:null,$children$:null,$key$:null,$name$:null,$tag$:null,$text$:null},"t"===dn?(En.$elm$=Lt.nextSibling,En.$elm$&&3===En.$elm$.nodeType&&(En.$text$=En.$elm$.textContent,He.push(En),Lt.remove(),Ee.$children$||(Ee.$children$=[]),Ee.$children$[En.$index$]=En,tt&&"0"===En.$depth$&&(tt[En.$index$]=En.$elm$))):En.$hostId$===nn&&("s"===dn?(En.$tag$="slot",Lt["s-sn"]=ln[5]?En.$name$=ln[5]:"",Lt["s-sr"]=!0,tt&&(En.$elm$=K.createElement(En.$tag$),En.$name$&&En.$elm$.setAttribute("name",En.$name$),Lt.parentNode.insertBefore(En.$elm$,Lt),Lt.remove(),"0"===En.$depth$&&(tt[En.$index$]=En.$elm$)),Ce.push(En),Ee.$children$||(Ee.$children$=[]),Ee.$children$[En.$index$]=En):"r"===dn&&(tt?Lt.remove():(It["s-cr"]=Lt,Lt["s-cn"]=!0))));else if(Ee&&"style"===Ee.$tag$){const Ot=Gn(null,Lt.textContent);Ot.$elm$=Lt,Ot.$index$="0",Ee.$children$=[Ot]}},Dt=(Ee,He)=>{if(1===Ee.nodeType){let Ce=0;for(;Ce<Ee.childNodes.length;Ce++)Dt(Ee.childNodes[Ce],He);if(Ee.shadowRoot)for(Ce=0;Ce<Ee.shadowRoot.childNodes.length;Ce++)Dt(Ee.shadowRoot.childNodes[Ce],He)}else if(8===Ee.nodeType){const Ce=Ee.nodeValue.split(".");"o"===Ce[0]&&(He.set(Ce[1]+"."+Ce[2],Ee),Ee.nodeValue="",Ee["s-en"]=Ce[3])}},rn=(Ee,He,Ce)=>{if(He.$members$){Ee.watchers&&(He.$watchers$=Ee.watchers);const tt=Object.entries(He.$members$),It=Ee.prototype;if(tt.map(([Lt,[nn]])=>{31&nn||2&Ce&&32&nn?Object.defineProperty(It,Lt,{get(){return((Ee,He)=>ci(this).$instanceValues$.get(He))(0,Lt)},set(dn){((Ee,He,Ce,tt)=>{const It=ci(Ee),Lt=It.$hostElement$,nn=It.$instanceValues$.get(He),dn=It.$flags$,ln=It.$lazyInstance$;if(Ce=((Ee,He)=>null==Ee||On(Ee)?Ee:4&He?"false"!==Ee&&(""===Ee||!!Ee):2&He?parseFloat(Ee):1&He?String(Ee):Ee)(Ce,tt.$members$[He][0]),(!(8&dn)||void 0===nn)&&Ce!==nn&&(It.$instanceValues$.set(He,Ce),ln)){if(tt.$watchers$&&128&dn){const En=tt.$watchers$[He];En&&En.map($n=>{try{ln[$n](Ce,nn,He)}catch(Ot){Zi(Ot,Lt)}})}2==(18&dn)&&Br(It,!1)}})(this,Lt,dn,He)},configurable:!0,enumerable:!0}):1&Ce&&64&nn&&Object.defineProperty(It,Lt,{value(...dn){const ln=ci(this);return ln.$onInstancePromise$.then(()=>ln.$lazyInstance$[Lt](...dn))}})}),1&Ce){const Lt=new Map;It.attributeChangedCallback=function(nn,dn,ln){re.jmp(()=>{const En=Lt.get(nn);if(this.hasOwnProperty(En))ln=this[En],delete this[En];else if(It.hasOwnProperty(En)&&"number"==typeof this[En]&&this[En]==ln)return;this[En]=(null!==ln||"boolean"!=typeof this[En])&&ln})},Ee.observedAttributes=tt.filter(([nn,dn])=>15&dn[0]).map(([nn,dn])=>{const ln=dn[1]||nn;return Lt.set(ln,nn),512&dn[0]&&He.$attrsToReflect$.push([nn,ln]),ln})}}return Ee},pn=function(){var Ee=(0,u.Z)(function*(He,Ce,tt,It,Lt){if(0==(32&Ce.$flags$)){{if(Ce.$flags$|=32,(Lt=oi(tt)).then){const En=()=>{};Lt=yield Lt,En()}Lt.isProxied||(tt.$watchers$=Lt.watchers,rn(Lt,tt,2),Lt.isProxied=!0);const ln=()=>{};Ce.$flags$|=8;try{new Lt(Ce)}catch(En){Zi(En)}Ce.$flags$&=-9,Ce.$flags$|=128,ln(),Ln(Ce.$lazyInstance$)}if(Lt.style){let ln=Lt.style;"string"!=typeof ln&&(ln=ln[Ce.$modeName$=(Ee=>ur.map(He=>He(Ee)).find(He=>!!He))(He)]);const En=Ht(tt,Ce.$modeName$);if(!_r.has(En)){const $n=()=>{};St(En,ln,!!(1&tt.$flags$)),$n()}}}const nn=Ce.$ancestorComponent$,dn=()=>Br(Ce,!0);nn&&nn["s-rc"]?nn["s-rc"].push(dn):dn()});return function(Ce,tt,It,Lt,nn){return Ee.apply(this,arguments)}}(),Ln=Ee=>{F(Ee,"connectedCallback")},ni=Ee=>{const He=Ee["s-cr"]=K.createComment("");He["s-cn"]=!0,Ee.insertBefore(He,Ee.firstChild)},ii=(Ee,He={})=>{const tt=[],It=He.exclude||[],Lt=Z.customElements,nn=K.head,dn=nn.querySelector("meta[charset]"),ln=K.createElement("style"),En=[],$n=K.querySelectorAll(`[${yt}]`);let Ot,cn=!0,ki=0;for(Object.assign(re,He),re.$resourcesUrl$=new URL(He.resourcesUrl||"./",K.baseURI).href,re.$flags$|=2;ki<$n.length;ki++)St($n[ki].getAttribute(yt),en($n[ki].innerHTML),!0);Ee.map($r=>{$r[1].map(Hi=>{const Er={$flags$:Hi[0],$tagName$:Hi[1],$members$:Hi[2],$listeners$:Hi[3]};Er.$members$=Hi[2],Er.$listeners$=Hi[3],Er.$attrsToReflect$=[],Er.$watchers$={};const nr=Er.$tagName$,vo=class extends HTMLElement{constructor(_o){super(_o),mi(_o=this,Er),1&Er.$flags$&&_o.attachShadow({mode:"open",delegatesFocus:!!(16&Er.$flags$)})}connectedCallback(){Ot&&(clearTimeout(Ot),Ot=null),cn?En.push(this):re.jmp(()=>(Ee=>{if(0==(1&re.$flags$)){const He=ci(Ee),Ce=He.$cmpMeta$,tt=()=>{};if(1&He.$flags$)nt(Ee,He,Ce.$listeners$),Ln(He.$lazyInstance$);else{let It;if(He.$flags$|=1,It=Ee.getAttribute(ot),It){if(1&Ce.$flags$){const Lt=$t(Ee.shadowRoot,Ce,Ee.getAttribute("s-mode"));Ee.classList.remove(Lt+"-h",Lt+"-s")}((Ee,He,Ce,tt)=>{const Lt=Ee.shadowRoot,nn=[],ln=Lt?[]:null,En=tt.$vnode$=Gn(He,null);re.$orgLocNodes$||Dt(K.body,re.$orgLocNodes$=new Map),Ee[ot]=Ce,Ee.removeAttribute(ot),mt(En,nn,[],ln,Ee,Ee,Ce),nn.map($n=>{const Ot=$n.$hostId$+"."+$n.$nodeId$,cn=re.$orgLocNodes$.get(Ot),ki=$n.$elm$;cn&&""===cn["s-en"]&&cn.parentNode.insertBefore(ki,cn.nextSibling),Lt||(ki["s-hn"]=He,cn&&(ki["s-ol"]=cn,ki["s-ol"]["s-nr"]=ki)),re.$orgLocNodes$.delete(Ot)}),Lt&&ln.map($n=>{$n&&Lt.appendChild($n)})})(Ee,Ce.$tagName$,It,He)}It||12&Ce.$flags$&&ni(Ee);{let Lt=Ee;for(;Lt=Lt.parentNode||Lt.host;)if(1===Lt.nodeType&&Lt.hasAttribute("s-id")&&Lt["s-p"]||Lt["s-p"]){Pi(He,He.$ancestorComponent$=Lt);break}}Ce.$members$&&Object.entries(Ce.$members$).map(([Lt,[nn]])=>{if(31&nn&&Ee.hasOwnProperty(Lt)){const dn=Ee[Lt];delete Ee[Lt],Ee[Lt]=dn}}),Jr(()=>pn(Ee,He,Ce))}tt()}})(this))}disconnectedCallback(){re.jmp(()=>(Ee=>{if(0==(1&re.$flags$)){const He=ci(this),Ce=He.$lazyInstance$;He.$rmListeners$&&(He.$rmListeners$.map(tt=>tt()),He.$rmListeners$=void 0),F(Ce,"disconnectedCallback")}})())}componentOnReady(){return ci(this).$onReadyPromise$}};Er.$lazyBundleId$=$r[0],!It.includes(nr)&&!Lt.get(nr)&&(tt.push(nr),Lt.define(nr,rn(vo,Er,1)))})}),ln.innerHTML=tt+"{visibility:hidden}.hydrated{visibility:inherit}",ln.setAttribute("data-styles",""),nn.insertBefore(ln,dn?dn.nextSibling:nn.firstChild),cn=!1,En.length?En.map($r=>$r.connectedCallback()):re.jmp(()=>Ot=setTimeout(X,30))},Ui=Ee=>{const He=new URL(Ee,re.$resourcesUrl$);return He.origin!==Z.location.origin?He.href:He.pathname},Fi=new WeakMap,ci=Ee=>Fi.get(Ee),Mn=(Ee,He)=>Fi.set(He.$lazyInstance$=Ee,He),mi=(Ee,He)=>{const Ce={$flags$:0,$hostElement$:Ee,$cmpMeta$:He,$instanceValues$:new Map};return Ce.$onInstancePromise$=new Promise(tt=>Ce.$onInstanceResolve$=tt),Ce.$onReadyPromise$=new Promise(tt=>Ce.$onReadyResolve$=tt),Ee["s-p"]=[],Ee["s-rc"]=[],nt(Ee,Ce,He.$listeners$),Fi.set(Ee,Ce)},Ii=(Ee,He)=>He in Ee,Zi=(Ee,He)=>(0,console.error)(Ee,He),cr=new Map,oi=(Ee,He,Ce)=>{const tt=Ee.$tagName$.replace(/-/g,"_"),It=Ee.$lazyBundleId$,Lt=cr.get(It);return Lt?Lt[tt]:R(863)(`./${It}.entry.js`).then(nn=>(cr.set(It,nn),nn[tt]),Zi)},_r=new Map,ur=[],Nr=[],go=[],bi=(Ee,He)=>Ce=>{Ee.push(Ce),V||(V=!0,He&&4&re.$flags$?Jr(Hr):re.raf(Hr))},ao=Ee=>{for(let He=0;He<Ee.length;He++)try{Ee[He](performance.now())}catch(Ce){Zi(Ce)}Ee.length=0},Hr=()=>{ao(Nr),ao(go),(V=Nr.length>0)&&re.raf(Hr)},Jr=Ee=>xe().then(Ee),Pr=bi(Nr,!1),Lr=bi(go,!0),Vr={isDev:!1,isBrowser:!0,isServer:!1,isTesting:!1}},2629:(Tn,Je,R)=>{"use strict";R.d(Je,{L:()=>l,a:()=>L,b:()=>P,c:()=>m,d:()=>$,e:()=>Ge,g:()=>wt,l:()=>Re,s:()=>ot,t:()=>Z});var u=R(6099),d=R(9533),j=R(5359);const l="ionViewWillEnter",L="ionViewDidEnter",P="ionViewWillLeave",m="ionViewDidLeave",$="ionViewWillUnload",Z=xt=>new Promise((dt,At)=>{(0,d.c)(()=>{K(xt),re(xt).then(Vt=>{Vt.animation&&Vt.animation.destroy(),_e(xt),dt(Vt)},Vt=>{_e(xt),At(Vt)})})}),K=xt=>{const dt=xt.enteringEl,At=xt.leavingEl;yt(dt,At,xt.direction),xt.showGoBack?dt.classList.add("can-go-back"):dt.classList.remove("can-go-back"),ot(dt,!1),dt.style.setProperty("pointer-events","none"),At&&(ot(At,!1),At.style.setProperty("pointer-events","none"))},re=function(){var xt=(0,u.Z)(function*(dt){const At=yield ge(dt);return At&&d.B.isBrowser?xe(At,dt):je(dt)});return function(At){return xt.apply(this,arguments)}}(),_e=xt=>{const dt=xt.enteringEl,At=xt.leavingEl;dt.classList.remove("ion-page-invisible"),dt.style.removeProperty("pointer-events"),void 0!==At&&(At.classList.remove("ion-page-invisible"),At.style.removeProperty("pointer-events"))},ge=function(){var xt=(0,u.Z)(function*(dt){return dt.leavingEl&&dt.animated&&0!==dt.duration?dt.animationBuilder?dt.animationBuilder:"ios"===dt.mode?(yield Promise.resolve().then(R.bind(R,5562))).iosTransitionAnimation:(yield Promise.resolve().then(R.bind(R,3126))).mdTransitionAnimation:void 0});return function(At){return xt.apply(this,arguments)}}(),xe=function(){var xt=(0,u.Z)(function*(dt,At){yield nt(At,!0);const Vt=dt(At.baseEl,At);Ne(At.enteringEl,At.leavingEl);const Un=yield ke(Vt,At);return At.progressCallback&&At.progressCallback(void 0),Un&&$e(At.enteringEl,At.leavingEl),{hasCompleted:Un,animation:Vt}});return function(At,Vt){return xt.apply(this,arguments)}}(),je=function(){var xt=(0,u.Z)(function*(dt){const At=dt.enteringEl,Vt=dt.leavingEl;return yield nt(dt,!1),Ne(At,Vt),$e(At,Vt),{hasCompleted:!0}});return function(At){return xt.apply(this,arguments)}}(),nt=function(){var xt=(0,u.Z)(function*(dt,At){const Un=(void 0!==dt.deepWait?dt.deepWait:At)?[Ge(dt.enteringEl),Ge(dt.leavingEl)]:[_t(dt.enteringEl),_t(dt.leavingEl)];yield Promise.all(Un),yield Fe(dt.viewIsReady,dt.enteringEl)});return function(At,Vt){return xt.apply(this,arguments)}}(),Fe=function(){var xt=(0,u.Z)(function*(dt,At){dt&&(yield dt(At))});return function(At,Vt){return xt.apply(this,arguments)}}(),ke=(xt,dt)=>{const At=dt.progressCallback,Vt=new Promise(Un=>{xt.onFinish(St=>Un(1===St))});return At?(xt.progressStart(!0),At(xt)):xt.play(),Vt},Ne=(xt,dt)=>{Re(dt,P),Re(xt,l)},$e=(xt,dt)=>{Re(xt,L),Re(dt,m)},Re=(xt,dt)=>{if(xt){const At=new CustomEvent(dt,{bubbles:!1,cancelable:!1});xt.dispatchEvent(At)}},_t=xt=>xt?new Promise(dt=>(0,j.c)(xt,dt)):Promise.resolve(),Ge=function(){var xt=(0,u.Z)(function*(dt){const At=dt;if(At){if(null!=At.componentOnReady){if(null!=(yield At.componentOnReady()))return}else if(null!=At.__registerHost)return void(yield new Promise(Un=>(0,j.r)(Un)));yield Promise.all(Array.from(At.children).map(Ge))}});return function(At){return xt.apply(this,arguments)}}(),ot=(xt,dt)=>{dt?(xt.setAttribute("aria-hidden","true"),xt.classList.add("ion-page-hidden")):(xt.hidden=!1,xt.removeAttribute("aria-hidden"),xt.classList.remove("ion-page-hidden"))},yt=(xt,dt,At)=>{void 0!==xt&&(xt.style.zIndex="back"===At?"99":"101"),void 0!==dt&&(dt.style.zIndex="100")},wt=xt=>xt.classList.contains("ion-page")?xt:xt.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")||xt},1363:(Tn,Je,R)=>{"use strict";R.r(Je),R.d(Je,{GESTURE_CONTROLLER:()=>u.G,createGesture:()=>ue});var u=R(2733);const d=(re,_e,ge,xe)=>{const je=j(re)?{capture:!!xe.capture,passive:!!xe.passive}:!!xe.capture;let nt,Fe;return re.__zone_symbol__addEventListener?(nt="__zone_symbol__addEventListener",Fe="__zone_symbol__removeEventListener"):(nt="addEventListener",Fe="removeEventListener"),re[nt](_e,ge,je),()=>{re[Fe](_e,ge,je)}},j=re=>{if(void 0===l)try{const _e=Object.defineProperty({},"passive",{get:()=>{l=!0}});re.addEventListener("optsTest",()=>{},_e)}catch{l=!1}return!!l};let l;const m=re=>re instanceof Document?re:re.ownerDocument,ue=re=>{let _e=!1,ge=!1,xe=!0,je=!1;const nt=Object.assign({disableScroll:!1,direction:"x",gesturePriority:0,passive:!0,maxAngle:40,threshold:10},re),Fe=nt.canStart,ke=nt.onWillStart,Ne=nt.onStart,$e=nt.onEnd,Re=nt.notCaptured,_t=nt.onMove,Ge=nt.threshold,ot=nt.passive,yt=nt.blurOnStart,wt={type:"pan",startX:0,startY:0,startTime:0,currentX:0,currentY:0,velocityX:0,velocityY:0,deltaX:0,deltaY:0,currentTime:0,event:void 0,data:void 0},xt=((re,_e,ge)=>{const xe=ge*(Math.PI/180),je="x"===re,nt=Math.cos(xe),Fe=_e*_e;let ke=0,Ne=0,$e=!1,Re=0;return{start(_t,Ge){ke=_t,Ne=Ge,Re=0,$e=!0},detect(_t,Ge){if(!$e)return!1;const ot=_t-ke,yt=Ge-Ne,wt=ot*ot+yt*yt;if(wt<Fe)return!1;const xt=Math.sqrt(wt),dt=(je?ot:yt)/xt;return Re=dt>nt?1:dt<-nt?-1:0,$e=!1,!0},isGesture:()=>0!==Re,getDirection:()=>Re}})(nt.direction,nt.threshold,nt.maxAngle),dt=u.G.createGesture({name:re.gestureName,priority:re.gesturePriority,disableScroll:re.disableScroll}),Un=()=>{!_e||(je=!1,_t&&_t(wt))},St=()=>!(dt&&!dt.capture()||(_e=!0,xe=!1,wt.startX=wt.currentX,wt.startY=wt.currentY,wt.startTime=wt.currentTime,ke?ke(wt).then(zt):zt(),0)),zt=()=>{yt&&(()=>{if("undefined"!=typeof document){const Yt=document.activeElement;null!==Yt&&Yt.blur&&Yt.blur()}})(),Ne&&Ne(wt),xe=!0},Ht=()=>{_e=!1,ge=!1,je=!1,xe=!0,dt.release()},en=Yt=>{const qt=_e,Gt=xe;if(Ht(),Gt){if(V(wt,Yt),qt)return void($e&&$e(wt));Re&&Re(wt)}},Kt=((re,_e,ge,xe,je)=>{let nt,Fe,ke,Ne,$e,Re,_t,Ge=0;const ot=$t=>{Ge=Date.now()+2e3,_e($t)&&(!Fe&&ge&&(Fe=d(re,"touchmove",ge,je)),ke||(ke=d($t.target,"touchend",wt,je)),Ne||(Ne=d($t.target,"touchcancel",wt,je)))},yt=$t=>{Ge>Date.now()||!_e($t)||(!Re&&ge&&(Re=d(m(re),"mousemove",ge,je)),_t||(_t=d(m(re),"mouseup",xt,je)))},wt=$t=>{dt(),xe&&xe($t)},xt=$t=>{At(),xe&&xe($t)},dt=()=>{Fe&&Fe(),ke&&ke(),Ne&&Ne(),Fe=ke=Ne=void 0},At=()=>{Re&&Re(),_t&&_t(),Re=_t=void 0},Vt=()=>{dt(),At()},Un=($t=!0)=>{$t?(nt||(nt=d(re,"touchstart",ot,je)),$e||($e=d(re,"mousedown",yt,je))):(nt&&nt(),$e&&$e(),nt=$e=void 0,Vt())};return{enable:Un,stop:Vt,destroy:()=>{Un(!1),xe=ge=_e=void 0}}})(nt.el,Yt=>{const qt=K(Yt);return!(ge||!xe||(Z(Yt,wt),wt.startX=wt.currentX,wt.startY=wt.currentY,wt.startTime=wt.currentTime=qt,wt.velocityX=wt.velocityY=wt.deltaX=wt.deltaY=0,wt.event=Yt,Fe&&!1===Fe(wt))||(dt.release(),!dt.start()))&&(ge=!0,0===Ge?St():(xt.start(wt.startX,wt.startY),!0))},Yt=>{_e?!je&&xe&&(je=!0,V(wt,Yt),requestAnimationFrame(Un)):(V(wt,Yt),xt.detect(wt.currentX,wt.currentY)&&(!xt.isGesture()||!St())&&Wt())},en,{capture:!1,passive:ot}),Wt=()=>{Ht(),Kt.stop(),Re&&Re(wt)};return{enable(Yt=!0){Yt||(_e&&en(void 0),Ht()),Kt.enable(Yt)},destroy(){dt.destroy(),Kt.destroy()}}},V=(re,_e)=>{if(!_e)return;const ge=re.currentX,xe=re.currentY,je=re.currentTime;Z(_e,re);const nt=re.currentX,Fe=re.currentY,Ne=(re.currentTime=K(_e))-je;if(Ne>0&&Ne<100){const Re=(Fe-xe)/Ne;re.velocityX=(nt-ge)/Ne*.7+.3*re.velocityX,re.velocityY=.7*Re+.3*re.velocityY}re.deltaX=nt-re.startX,re.deltaY=Fe-re.startY,re.event=_e},Z=(re,_e)=>{let ge=0,xe=0;if(re){const je=re.changedTouches;if(je&&je.length>0){const nt=je[0];ge=nt.clientX,xe=nt.clientY}else void 0!==re.pageX&&(ge=re.pageX,xe=re.pageY)}_e.currentX=ge,_e.currentY=xe},K=re=>re.timeStamp||Date.now()},4304:(Tn,Je,R)=>{"use strict";R.d(Je,{m:()=>Z});var u=R(6099),d=R(527),j=R(5359),l=R(7639),L=R(6309);const P=K=>(0,L.c)().duration(K?400:300),m=K=>{let re,_e;const ge=K.width+8,xe=(0,L.c)(),je=(0,L.c)();K.isEndSide?(re=ge+"px",_e="0px"):(re=-ge+"px",_e="0px"),xe.addElement(K.menuInnerEl).fromTo("transform",`translateX(${re})`,`translateX(${_e})`);const Fe="ios"===(0,l.b)(K),ke=Fe?.2:.25;return je.addElement(K.backdropEl).fromTo("opacity",.01,ke),P(Fe).addAnimation([xe,je])},$=K=>{let re,_e;const ge=(0,l.b)(K),xe=K.width;K.isEndSide?(re=-xe+"px",_e=xe+"px"):(re=xe+"px",_e=-xe+"px");const je=(0,L.c)().addElement(K.menuInnerEl).fromTo("transform",`translateX(${_e})`,"translateX(0px)"),nt=(0,L.c)().addElement(K.contentEl).fromTo("transform","translateX(0px)",`translateX(${re})`),Fe=(0,L.c)().addElement(K.backdropEl).fromTo("opacity",.01,.32);return P("ios"===ge).addAnimation([je,nt,Fe])},ue=K=>{const re=(0,l.b)(K),_e=K.width*(K.isEndSide?-1:1)+"px",ge=(0,L.c)().addElement(K.contentEl).fromTo("transform","translateX(0px)",`translateX(${_e})`);return P("ios"===re).addAnimation(ge)},Z=(()=>{const K=new Map,re=[],_e=function(){var zt=(0,u.Z)(function*(Ht){const en=yield Ne(Ht);return!!en&&en.open()});return function(en){return zt.apply(this,arguments)}}(),ge=function(){var zt=(0,u.Z)(function*(Ht){const en=yield void 0!==Ht?Ne(Ht):$e();return void 0!==en&&en.close()});return function(en){return zt.apply(this,arguments)}}(),xe=function(){var zt=(0,u.Z)(function*(Ht){const en=yield Ne(Ht);return!!en&&en.toggle()});return function(en){return zt.apply(this,arguments)}}(),je=function(){var zt=(0,u.Z)(function*(Ht,en){const Kt=yield Ne(en);return Kt&&(Kt.disabled=!Ht),Kt});return function(en,Kt){return zt.apply(this,arguments)}}(),nt=function(){var zt=(0,u.Z)(function*(Ht,en){const Kt=yield Ne(en);return Kt&&(Kt.swipeGesture=Ht),Kt});return function(en,Kt){return zt.apply(this,arguments)}}(),Fe=function(){var zt=(0,u.Z)(function*(Ht){if(null!=Ht){const en=yield Ne(Ht);return void 0!==en&&en.isOpen()}return void 0!==(yield $e())});return function(en){return zt.apply(this,arguments)}}(),ke=function(){var zt=(0,u.Z)(function*(Ht){const en=yield Ne(Ht);return!!en&&!en.disabled});return function(en){return zt.apply(this,arguments)}}(),Ne=function(){var zt=(0,u.Z)(function*(Ht){return yield $t(),"start"===Ht||"end"===Ht?St(Wt=>Wt.side===Ht&&!Wt.disabled)||St(Wt=>Wt.side===Ht):null!=Ht?St(Kt=>Kt.menuId===Ht):St(Kt=>!Kt.disabled)||(re.length>0?re[0].el:void 0)});return function(en){return zt.apply(this,arguments)}}(),$e=function(){var zt=(0,u.Z)(function*(){return yield $t(),At()});return function(){return zt.apply(this,arguments)}}(),Re=function(){var zt=(0,u.Z)(function*(){return yield $t(),Vt()});return function(){return zt.apply(this,arguments)}}(),_t=function(){var zt=(0,u.Z)(function*(){return yield $t(),Un()});return function(){return zt.apply(this,arguments)}}(),Ge=(zt,Ht)=>{K.set(zt,Ht)},wt=zt=>{const Ht=zt.side;re.filter(en=>en.side===Ht&&en!==zt).forEach(en=>en.disabled=!0)},xt=function(){var zt=(0,u.Z)(function*(Ht,en,Kt){if(Un())return!1;if(en){const Wt=yield $e();Wt&&Ht.el!==Wt&&(yield Wt.setOpen(!1,!1))}return Ht._setOpen(en,Kt)});return function(en,Kt,Wt){return zt.apply(this,arguments)}}(),At=()=>St(zt=>zt._isOpen),Vt=()=>re.map(zt=>zt.el),Un=()=>re.some(zt=>zt.isAnimating),St=zt=>{const Ht=re.find(zt);if(void 0!==Ht)return Ht.el},$t=()=>Promise.all(Array.from(document.querySelectorAll("ion-menu")).map(zt=>new Promise(Ht=>(0,j.c)(zt,Ht))));return Ge("reveal",ue),Ge("push",$),Ge("overlay",m),"undefined"!=typeof document&&document.addEventListener("ionBackButton",zt=>{const Ht=At();Ht&&zt.detail.register(d.MENU_BACK_BUTTON_PRIORITY,()=>Ht.close())}),{registerAnimation:Ge,get:Ne,getMenus:Re,getOpen:$e,isEnabled:ke,swipeGesture:nt,isAnimating:_t,isOpen:Fe,enable:je,toggle:xe,close:ge,open:_e,_getOpenSync:At,_createAnimation:(zt,Ht)=>{const en=K.get(zt);if(!en)throw new Error("animation not registered");return en(Ht)},_register:zt=>{re.indexOf(zt)<0&&(zt.disabled||wt(zt),re.push(zt))},_unregister:zt=>{const Ht=re.indexOf(zt);Ht>-1&&re.splice(Ht,1)},_setOpen:xt,_setActiveMenu:wt}})()},7639:(Tn,Je,R)=>{"use strict";R.d(Je,{a:()=>Z,b:()=>Un,c:()=>j,g:()=>V,i:()=>St});var u=R(9533);class d{constructor(){this.m=new Map}reset(zt){this.m=new Map(Object.entries(zt))}get(zt,Ht){const en=this.m.get(zt);return void 0!==en?en:Ht}getBoolean(zt,Ht=!1){const en=this.m.get(zt);return void 0===en?Ht:"string"==typeof en?"true"===en:!!en}getNumber(zt,Ht){const en=parseFloat(this.m.get(zt));return isNaN(en)?void 0!==Ht?Ht:NaN:en}set(zt,Ht){this.m.set(zt,Ht)}}const j=new d,$="ionic:",ue="ionic-persist-config",V=$t=>K($t),Z=($t,zt)=>("string"==typeof $t&&(zt=$t,$t=void 0),V($t).includes(zt)),K=($t=window)=>{if(void 0===$t)return[];$t.Ionic=$t.Ionic||{};let zt=$t.Ionic.platforms;return null==zt&&(zt=$t.Ionic.platforms=re($t),zt.forEach(Ht=>$t.document.documentElement.classList.add(`plt-${Ht}`))),zt},re=$t=>{const zt=j.get("platform");return Object.keys(At).filter(Ht=>{const en=zt&&zt[Ht];return"function"==typeof en?en($t):At[Ht]($t)})},ge=$t=>!!(xt($t,/iPad/i)||xt($t,/Macintosh/i)&&$e($t)),nt=$t=>xt($t,/android|sink/i),$e=$t=>dt($t,"(any-pointer:coarse)"),_t=$t=>Ge($t)||ot($t),Ge=$t=>!!($t.cordova||$t.phonegap||$t.PhoneGap),ot=$t=>{const zt=$t.Capacitor;return!(!zt||!zt.isNative)},xt=($t,zt)=>zt.test($t.navigator.userAgent),dt=($t,zt)=>$t.matchMedia&&$t.matchMedia(zt).matches,At={ipad:ge,iphone:$t=>xt($t,/iPhone/i),ios:$t=>xt($t,/iPhone|iPod/i)||ge($t),android:nt,phablet:$t=>{const zt=$t.innerWidth,Ht=$t.innerHeight,en=Math.min(zt,Ht),Kt=Math.max(zt,Ht);return en>390&&en<520&&Kt>620&&Kt<800},tablet:$t=>{const zt=$t.innerWidth,Ht=$t.innerHeight,en=Math.min(zt,Ht),Kt=Math.max(zt,Ht);return ge($t)||($t=>nt($t)&&!xt($t,/mobile/i))($t)||en>460&&en<820&&Kt>780&&Kt<1400},cordova:Ge,capacitor:ot,electron:$t=>xt($t,/electron/i),pwa:$t=>!!($t.matchMedia&&$t.matchMedia("(display-mode: standalone)").matches||$t.navigator.standalone),mobile:$e,mobileweb:$t=>$e($t)&&!_t($t),desktop:$t=>!$e($t),hybrid:_t};let Vt;const Un=$t=>$t&&(0,u.g)($t)||Vt,St=($t={})=>{if("undefined"==typeof window)return;const zt=window.document,Ht=window,en=Ht.Ionic=Ht.Ionic||{},Kt={};$t._ael&&(Kt.ael=$t._ael),$t._rel&&(Kt.rel=$t._rel),$t._ce&&(Kt.ce=$t._ce),(0,u.s)(Kt);const Wt=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},($t=>{try{const zt=$t.sessionStorage.getItem(ue);return null!==zt?JSON.parse(zt):{}}catch{return{}}})(Ht)),{persistConfig:!1}),en.config),($t=>{const zt={};return $t.location.search.slice(1).split("&").map(Ht=>Ht.split("=")).map(([Ht,en])=>[decodeURIComponent(Ht),decodeURIComponent(en)]).filter(([Ht])=>(($t,zt)=>$t.substr(0,zt.length)===zt)(Ht,$)).map(([Ht,en])=>[Ht.slice($.length),en]).forEach(([Ht,en])=>{zt[Ht]=en}),zt})(Ht)),$t);j.reset(Wt),j.getBoolean("persistConfig")&&(($t,zt)=>{try{$t.sessionStorage.setItem(ue,JSON.stringify(zt))}catch{return}})(Ht,Wt),K(Ht),en.config=j,en.mode=Vt=j.get("mode",zt.documentElement.getAttribute("mode")||(Z(Ht,"ios")?"ios":"md")),j.set("mode",Vt),zt.documentElement.setAttribute("mode",Vt),zt.documentElement.classList.add(Vt),j.getBoolean("_testing")&&j.set("animated",!1);const Yt=Gt=>Gt.tagName&&Gt.tagName.startsWith("ION-"),qt=Gt=>["ios","md"].includes(Gt);(0,u.a)(Gt=>{for(;Gt;){const ft=Gt.mode||Gt.getAttribute("mode");if(ft){if(qt(ft))return ft;Yt(Gt)&&console.warn('Invalid ionic mode: "'+ft+'", expected: "ios" or "md"')}Gt=Gt.parentElement}return Vt})}},5562:(Tn,Je,R)=>{"use strict";R.r(Je),R.d(Je,{iosTransitionAnimation:()=>K,shadow:()=>P});var u=R(6309),d=R(2629);R(9533);const L=re=>document.querySelector(`${re}.ion-cloned-element`),P=re=>re.shadowRoot||re,m=re=>{const _e="ION-TABS"===re.tagName?re:re.querySelector("ion-tabs"),ge="ion-content ion-header:not(.header-collapse-condense-inactive) ion-title.title-large";if(null!=_e){const xe=_e.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");return null!=xe?xe.querySelector(ge):null}return re.querySelector(ge)},$=(re,_e)=>{const ge="ION-TABS"===re.tagName?re:re.querySelector("ion-tabs");let xe=[];if(null!=ge){const je=ge.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");null!=je&&(xe=je.querySelectorAll("ion-buttons"))}else xe=re.querySelectorAll("ion-buttons");for(const je of xe){const nt=je.closest("ion-header"),Fe=nt&&!nt.classList.contains("header-collapse-condense-inactive"),ke=je.querySelector("ion-back-button"),Ne=je.classList.contains("buttons-collapse"),$e="start"===je.slot||""===je.slot;if(null!==ke&&$e&&(Ne&&Fe&&_e||!Ne))return ke}return null},V=(re,_e,ge,xe,je,nt)=>{const Fe=_e?`calc(100% - ${nt.right+4}px)`:nt.left-4+"px",ke=_e?"7px":"-7px",Ne=_e?"-4px":"4px",$e=_e?"-4px":"4px",Re=_e?"right":"left",_t=_e?"left":"right",yt=ge?[{offset:0,opacity:1,transform:`translate3d(${Ne}, ${nt.top-46}px, 0) scale(1)`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${ke}, ${je.top-40}px, 0) scale(2.1)`}]:[{offset:0,opacity:0,transform:`translate3d(${ke}, ${je.top-40}px, 0) scale(2.1)`},{offset:1,opacity:1,transform:`translate3d(${Ne}, ${nt.top-46}px, 0) scale(1)`}],dt=ge?[{offset:0,opacity:1,transform:`translate3d(${$e}, ${nt.top-46}px, 0) scale(1)`},{offset:.2,opacity:0,transform:`translate3d(${$e}, ${nt.top-41}px, 0) scale(0.6)`},{offset:1,opacity:0,transform:`translate3d(${$e}, ${nt.top-41}px, 0) scale(0.6)`}]:[{offset:0,opacity:0,transform:`translate3d(${$e}, ${nt.top-41}px, 0) scale(0.6)`},{offset:1,opacity:1,transform:`translate3d(${$e}, ${nt.top-46}px, 0) scale(1)`}],At=(0,u.c)(),Vt=(0,u.c)(),Un=L("ion-back-button"),St=P(Un).querySelector(".button-text"),$t=P(Un).querySelector("ion-icon");Un.text=xe.text,Un.mode=xe.mode,Un.icon=xe.icon,Un.color=xe.color,Un.disabled=xe.disabled,Un.style.setProperty("display","block"),Un.style.setProperty("position","fixed"),Vt.addElement($t),At.addElement(St),At.beforeStyles({"transform-origin":`${Re} center`}).beforeAddWrite(()=>{xe.style.setProperty("display","none"),Un.style.setProperty(Re,Fe)}).afterAddWrite(()=>{xe.style.setProperty("display",""),Un.style.setProperty("display","none"),Un.style.removeProperty(Re)}).keyframes(yt),Vt.beforeStyles({"transform-origin":`${_t} center`}).keyframes(dt),re.addAnimation([At,Vt])},Z=(re,_e,ge,xe,je,nt)=>{const Fe=_e?`calc(100% - ${je.right}px)`:`${je.left}px`,ke=_e?"-18px":"18px",Ne=_e?"right":"left",_t=ge?[{offset:0,opacity:0,transform:`translate3d(${ke}, ${nt.top-4}px, 0) scale(0.49)`},{offset:.1,opacity:0},{offset:1,opacity:1,transform:`translate3d(0, ${je.top-2}px, 0) scale(1)`}]:[{offset:0,opacity:.99,transform:`translate3d(0, ${je.top-2}px, 0) scale(1)`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${ke}, ${nt.top-4}px, 0) scale(0.5)`}],Ge=L("ion-title"),ot=(0,u.c)();Ge.innerText=xe.innerText,Ge.size=xe.size,Ge.color=xe.color,ot.addElement(Ge),ot.beforeStyles({"transform-origin":`${Ne} center`,height:"46px",display:"",position:"relative",[Ne]:Fe}).beforeAddWrite(()=>{xe.style.setProperty("display","none")}).afterAddWrite(()=>{xe.style.setProperty("display",""),Ge.style.setProperty("display","none")}).keyframes(_t),re.addAnimation(ot)},K=(re,_e)=>{try{const ge="cubic-bezier(0.32,0.72,0,1)",xe="opacity",je="transform",nt="0%",Fe=.8,ke="rtl"===re.ownerDocument.dir,Ne=ke?"-99.5%":"99.5%",$e=ke?"33%":"-33%",Re=_e.enteringEl,_t=_e.leavingEl,Ge="back"===_e.direction,ot=Re.querySelector(":scope > ion-content"),yt=Re.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *"),wt=Re.querySelectorAll(":scope > ion-header > ion-toolbar"),xt=(0,u.c)(),dt=(0,u.c)();if(xt.addElement(Re).duration(_e.duration||540).easing(_e.easing||ge).fill("both").beforeRemoveClass("ion-page-invisible"),_t&&re){const St=(0,u.c)();St.addElement(re),xt.addAnimation(St)}if(ot||0!==wt.length||0!==yt.length?(dt.addElement(ot),dt.addElement(yt)):dt.addElement(Re.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),xt.addAnimation(dt),Ge?dt.beforeClearStyles([xe]).fromTo("transform",`translateX(${$e})`,`translateX(${nt})`).fromTo(xe,Fe,1):dt.beforeClearStyles([xe]).fromTo("transform",`translateX(${Ne})`,`translateX(${nt})`),ot){const St=P(ot).querySelector(".transition-effect");if(St){const $t=St.querySelector(".transition-cover"),zt=St.querySelector(".transition-shadow"),Ht=(0,u.c)(),en=(0,u.c)(),Kt=(0,u.c)();Ht.addElement(St).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),en.addElement($t).beforeClearStyles([xe]).fromTo(xe,0,.1),Kt.addElement(zt).beforeClearStyles([xe]).fromTo(xe,.03,.7),Ht.addAnimation([en,Kt]),dt.addAnimation([Ht])}}const At=Re.querySelector("ion-header.header-collapse-condense"),{forward:Vt,backward:Un}=((re,_e,ge,xe,je)=>{const nt=$(xe,ge),Fe=m(je),ke=m(xe),Ne=$(je,ge),$e=null!==nt&&null!==Fe&&!ge,Re=null!==ke&&null!==Ne&&ge;if($e){const _t=Fe.getBoundingClientRect(),Ge=nt.getBoundingClientRect();Z(re,_e,ge,Fe,_t,Ge),V(re,_e,ge,nt,_t,Ge)}else if(Re){const _t=ke.getBoundingClientRect(),Ge=Ne.getBoundingClientRect();Z(re,_e,ge,ke,_t,Ge),V(re,_e,ge,Ne,_t,Ge)}return{forward:$e,backward:Re}})(xt,ke,Ge,Re,_t);if(wt.forEach(St=>{const $t=(0,u.c)();$t.addElement(St),xt.addAnimation($t);const zt=(0,u.c)();zt.addElement(St.querySelector("ion-title"));const Ht=(0,u.c)(),en=Array.from(St.querySelectorAll("ion-buttons,[menuToggle]")),Kt=St.closest("ion-header"),Wt=Kt&&Kt.classList.contains("header-collapse-condense-inactive");let Yt;Yt=en.filter(Ge?On=>{const fn=On.classList.contains("buttons-collapse");return fn&&!Wt||!fn}:On=>!On.classList.contains("buttons-collapse")),Ht.addElement(Yt);const qt=(0,u.c)();qt.addElement(St.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])"));const Gt=(0,u.c)();Gt.addElement(P(St).querySelector(".toolbar-background"));const ft=(0,u.c)(),Ut=St.querySelector("ion-back-button");if(Ut&&ft.addElement(Ut),$t.addAnimation([zt,Ht,qt,Gt,ft]),Ht.fromTo(xe,.01,1),qt.fromTo(xe,.01,1),Ge)Wt||zt.fromTo("transform",`translateX(${$e})`,`translateX(${nt})`).fromTo(xe,.01,1),qt.fromTo("transform",`translateX(${$e})`,`translateX(${nt})`),ft.fromTo(xe,.01,1);else if(At||zt.fromTo("transform",`translateX(${Ne})`,`translateX(${nt})`).fromTo(xe,.01,1),qt.fromTo("transform",`translateX(${Ne})`,`translateX(${nt})`),Gt.beforeClearStyles([xe,"transform"]),(null==Kt?void 0:Kt.translucent)?Gt.fromTo("transform",ke?"translateX(-100%)":"translateX(100%)","translateX(0px)"):Gt.fromTo(xe,.01,"var(--opacity)"),Vt||ft.fromTo(xe,.01,1),Ut&&!Vt){const fn=(0,u.c)();fn.addElement(P(Ut).querySelector(".button-text")).fromTo("transform",ke?"translateX(-100px)":"translateX(100px)","translateX(0px)"),$t.addAnimation(fn)}}),_t){const St=(0,u.c)(),$t=_t.querySelector(":scope > ion-content"),zt=_t.querySelectorAll(":scope > ion-header > ion-toolbar"),Ht=_t.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *");if($t||0!==zt.length||0!==Ht.length?(St.addElement($t),St.addElement(Ht)):St.addElement(_t.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),xt.addAnimation(St),Ge){St.beforeClearStyles([xe]).fromTo("transform",`translateX(${nt})`,ke?"translateX(-100%)":"translateX(100%)");const en=(0,d.g)(_t);xt.afterAddWrite(()=>{"normal"===xt.getDirection()&&en.style.setProperty("display","none")})}else St.fromTo("transform",`translateX(${nt})`,`translateX(${$e})`).fromTo(xe,1,Fe);if($t){const en=P($t).querySelector(".transition-effect");if(en){const Kt=en.querySelector(".transition-cover"),Wt=en.querySelector(".transition-shadow"),Yt=(0,u.c)(),qt=(0,u.c)(),Gt=(0,u.c)();Yt.addElement(en).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),qt.addElement(Kt).beforeClearStyles([xe]).fromTo(xe,.1,0),Gt.addElement(Wt).beforeClearStyles([xe]).fromTo(xe,.7,.03),Yt.addAnimation([qt,Gt]),St.addAnimation([Yt])}}zt.forEach(en=>{const Kt=(0,u.c)();Kt.addElement(en);const Wt=(0,u.c)();Wt.addElement(en.querySelector("ion-title"));const Yt=(0,u.c)(),qt=en.querySelectorAll("ion-buttons,[menuToggle]"),Gt=en.closest("ion-header"),ft=Gt&&Gt.classList.contains("header-collapse-condense-inactive"),Ut=Array.from(qt).filter(sr=>{const zi=sr.classList.contains("buttons-collapse");return zi&&!ft||!zi});Yt.addElement(Ut);const On=(0,u.c)(),fn=en.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])");fn.length>0&&On.addElement(fn);const Gn=(0,u.c)();Gn.addElement(P(en).querySelector(".toolbar-background"));const ei=(0,u.c)(),$i=en.querySelector("ion-back-button");if($i&&ei.addElement($i),Kt.addAnimation([Wt,Yt,On,ei,Gn]),xt.addAnimation(Kt),ei.fromTo(xe,.99,0),Yt.fromTo(xe,.99,0),On.fromTo(xe,.99,0),Ge){if(ft||Wt.fromTo("transform",`translateX(${nt})`,ke?"translateX(-100%)":"translateX(100%)").fromTo(xe,.99,0),On.fromTo("transform",`translateX(${nt})`,ke?"translateX(-100%)":"translateX(100%)"),Gn.beforeClearStyles([xe,"transform"]),(null==Gt?void 0:Gt.translucent)?Gn.fromTo("transform","translateX(0px)",ke?"translateX(-100%)":"translateX(100%)"):Gn.fromTo(xe,"var(--opacity)",0),$i&&!Un){const zi=(0,u.c)();zi.addElement(P($i).querySelector(".button-text")).fromTo("transform",`translateX(${nt})`,`translateX(${(ke?-124:124)+"px"})`),Kt.addAnimation(zi)}}else ft||Wt.fromTo("transform",`translateX(${nt})`,`translateX(${$e})`).fromTo(xe,.99,0).afterClearStyles([je,xe]),On.fromTo("transform",`translateX(${nt})`,`translateX(${$e})`).afterClearStyles([je,xe]),ei.afterClearStyles([xe]),Wt.afterClearStyles([xe]),Yt.afterClearStyles([xe])})}return xt}catch(ge){throw ge}}},3126:(Tn,Je,R)=>{"use strict";R.r(Je),R.d(Je,{mdTransitionAnimation:()=>l});var u=R(6309),d=R(2629);R(9533);const l=(L,P)=>{const ue="back"===P.direction,Z=P.leavingEl,K=(0,d.g)(P.enteringEl),re=K.querySelector("ion-toolbar"),_e=(0,u.c)();if(_e.addElement(K).fill("both").beforeRemoveClass("ion-page-invisible"),ue?_e.duration(P.duration||200).easing("cubic-bezier(0.47,0,0.745,0.715)"):_e.duration(P.duration||280).easing("cubic-bezier(0.36,0.66,0.04,1)").fromTo("transform","translateY(40px)","translateY(0px)").fromTo("opacity",.01,1),re){const ge=(0,u.c)();ge.addElement(re),_e.addAnimation(ge)}if(Z&&ue){_e.duration(P.duration||200).easing("cubic-bezier(0.47,0,0.745,0.715)");const ge=(0,u.c)();ge.addElement((0,d.g)(Z)).onFinish(xe=>{1===xe&&ge.elements.length>0&&ge.elements[0].style.setProperty("display","none")}).fromTo("transform","translateY(0px)","translateY(40px)").fromTo("opacity",1,0),_e.addAnimation(ge)}return _e}},425:(Tn,Je,R)=>{"use strict";R.d(Je,{B:()=>en,a:()=>$,b:()=>ue,c:()=>re,d:()=>wt,e:()=>ge,f:()=>dt,g:()=>Un,h:()=>P,i:()=>$t,j:()=>Fe,k:()=>ot,l:()=>V,m:()=>Z,s:()=>Ht,t:()=>_e});var u=R(6099),d=R(7639),j=R(527),l=R(5359);let L=0;const P=new WeakMap,m=Kt=>({create:Wt=>xe(Kt,Wt),dismiss:(Wt,Yt,qt)=>_t(document,Wt,Yt,Kt,qt),getTop:()=>(0,u.Z)(function*(){return ot(document,Kt)})()}),$=m("ion-alert"),ue=m("ion-action-sheet"),V=m("ion-loading"),Z=m("ion-modal"),re=m("ion-popover"),_e=m("ion-toast"),ge=(Kt,Wt={trapKeyboardFocus:!0})=>{"undefined"!=typeof document&&Re(document,Wt);const Yt=L++;Kt.overlayIndex=Yt,Kt.hasAttribute("id")||(Kt.id=`ion-overlay-${Yt}`)},xe=(Kt,Wt)=>"undefined"!=typeof window&&void 0!==window.customElements?window.customElements.whenDefined(Kt).then(()=>{const Yt=document.createElement(Kt);return Yt.classList.add("overlay-hidden"),Object.assign(Yt,Object.assign(Object.assign({},Wt),{hasController:!0})),At(document).appendChild(Yt),new Promise(qt=>(0,l.c)(Yt,qt))}):Promise.resolve(),je='[tabindex]:not([tabindex^="-"]), input:not([type=hidden]):not([tabindex^="-"]), textarea:not([tabindex^="-"]), button:not([tabindex^="-"]), select:not([tabindex^="-"]), .ion-focusable:not([tabindex^="-"])',nt="input:not([type=hidden]), textarea, button, select",Fe=(Kt,Wt)=>{let Yt=Kt.querySelector(je);const qt=Yt&&Yt.shadowRoot;qt&&(Yt=qt.querySelector(nt)||Yt),Yt?(0,l.f)(Yt):Wt.focus()},Ne=(Kt,Wt)=>{const Yt=Array.from(Kt.querySelectorAll(je));let qt=Yt.length>0?Yt[Yt.length-1]:null;const Gt=qt&&qt.shadowRoot;Gt&&(qt=Gt.querySelector(nt)||qt),qt?qt.focus():Wt.focus()},Re=(Kt,Wt)=>{0===L&&(L=1,Wt.trapKeyboardFocus&&Kt.addEventListener("focus",Yt=>{Yt.target&&"ION-MENU"===Yt.target.tagName||((Kt,Wt)=>{const Yt=ot(Wt),qt=Kt.target;Yt&&qt&&(Yt.shadowRoot?(()=>{if(Yt.contains(qt))Yt.lastFocus=qt;else{const Ut=Yt.lastFocus;Fe(Yt,Yt),Ut===Wt.activeElement&&Ne(Yt,Yt),Yt.lastFocus=Wt.activeElement}})():(()=>{if(Yt===qt)Yt.lastFocus=void 0;else{const Ut=(0,l.g)(Yt);if(!Ut.contains(qt))return;const On=Ut.querySelector(".ion-overlay-wrapper");if(!On)return;if(On.contains(qt))Yt.lastFocus=qt;else{const fn=Yt.lastFocus;Fe(On,Yt),fn===Wt.activeElement&&Ne(On,Yt),Yt.lastFocus=Wt.activeElement}}})())})(Yt,Kt)},!0),Kt.addEventListener("ionBackButton",Yt=>{const qt=ot(Kt);qt&&qt.backdropDismiss&&Yt.detail.register(j.OVERLAY_BACK_BUTTON_PRIORITY,()=>qt.dismiss(void 0,en))}),Kt.addEventListener("keyup",Yt=>{if("Escape"===Yt.key){const qt=ot(Kt);qt&&qt.backdropDismiss&&qt.dismiss(void 0,en)}}))},_t=(Kt,Wt,Yt,qt,Gt)=>{const ft=ot(Kt,qt,Gt);return ft?ft.dismiss(Wt,Yt):Promise.reject("overlay does not exist")},ot=(Kt,Wt,Yt)=>{const qt=((Kt,Wt)=>(void 0===Wt&&(Wt="ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker,ion-popover,ion-toast"),Array.from(Kt.querySelectorAll(Wt)).filter(Yt=>Yt.overlayIndex>0)))(Kt,Wt).filter(Gt=>!(Kt=>Kt.classList.contains("overlay-hidden"))(Gt));return void 0===Yt?qt[qt.length-1]:qt.find(Gt=>Gt.id===Yt)},yt=(Kt=!1)=>{const Yt=At(document).querySelector("ion-router-outlet, ion-nav, #ion-view-container-root");!Yt||(Kt?Yt.setAttribute("aria-hidden","true"):Yt.removeAttribute("aria-hidden"))},wt=function(){var Kt=(0,u.Z)(function*(Wt,Yt,qt,Gt,ft){var Ut,On;if(Wt.presented)return;yt(!0),Wt.presented=!0,Wt.willPresent.emit(),null===(Ut=Wt.willPresentShorthand)||void 0===Ut||Ut.emit();const fn=(0,d.b)(Wt),Gn=Wt.enterAnimation?Wt.enterAnimation:d.c.get(Yt,"ios"===fn?qt:Gt);(yield Vt(Wt,Gn,Wt.el,ft))&&(Wt.didPresent.emit(),null===(On=Wt.didPresentShorthand)||void 0===On||On.emit()),"ION-TOAST"!==Wt.el.tagName&&xt(Wt.el),Wt.keyboardClose&&Wt.el.focus()});return function(Yt,qt,Gt,ft,Ut){return Kt.apply(this,arguments)}}(),xt=function(){var Kt=(0,u.Z)(function*(Wt){let Yt=document.activeElement;if(!Yt)return;const qt=Yt&&Yt.shadowRoot;qt&&(Yt=qt.querySelector(nt)||Yt),yield Wt.onDidDismiss(),Yt.focus()});return function(Yt){return Kt.apply(this,arguments)}}(),dt=function(){var Kt=(0,u.Z)(function*(Wt,Yt,qt,Gt,ft,Ut,On){var fn,Gn;if(!Wt.presented)return!1;yt(!1),Wt.presented=!1;try{Wt.el.style.setProperty("pointer-events","none"),Wt.willDismiss.emit({data:Yt,role:qt}),null===(fn=Wt.willDismissShorthand)||void 0===fn||fn.emit({data:Yt,role:qt});const ei=(0,d.b)(Wt),$i=Wt.leaveAnimation?Wt.leaveAnimation:d.c.get(Gt,"ios"===ei?ft:Ut);"gesture"!==qt&&(yield Vt(Wt,$i,Wt.el,On)),Wt.didDismiss.emit({data:Yt,role:qt}),null===(Gn=Wt.didDismissShorthand)||void 0===Gn||Gn.emit({data:Yt,role:qt}),P.delete(Wt),Wt.el.classList.add("overlay-hidden"),Wt.el.style.removeProperty("pointer-events")}catch(ei){console.error(ei)}return Wt.el.remove(),!0});return function(Yt,qt,Gt,ft,Ut,On,fn){return Kt.apply(this,arguments)}}(),At=Kt=>Kt.querySelector("ion-app")||Kt.body,Vt=function(){var Kt=(0,u.Z)(function*(Wt,Yt,qt,Gt){qt.classList.remove("overlay-hidden");const Ut=Yt(Wt.el,Gt);(!Wt.animated||!d.c.getBoolean("animated",!0))&&Ut.duration(0),Wt.keyboardClose&&Ut.beforeAddWrite(()=>{const fn=qt.ownerDocument.activeElement;fn&&fn.matches("input,ion-input, ion-textarea")&&fn.blur()});const On=P.get(Wt)||[];return P.set(Wt,[...On,Ut]),yield Ut.play(),!0});return function(Yt,qt,Gt,ft){return Kt.apply(this,arguments)}}(),Un=(Kt,Wt)=>{let Yt;const qt=new Promise(Gt=>Yt=Gt);return St(Kt,Wt,Gt=>{Yt(Gt.detail)}),qt},St=(Kt,Wt,Yt)=>{const qt=Gt=>{(0,l.b)(Kt,Wt,qt),Yt(Gt)};(0,l.a)(Kt,Wt,qt)},$t=Kt=>"cancel"===Kt||Kt===en,zt=Kt=>Kt(),Ht=(Kt,Wt)=>{if("function"==typeof Kt)return d.c.get("_zoneGate",zt)(()=>{try{return Kt(Wt)}catch(qt){throw qt}})},en="backdrop"},1099:(Tn,Je,R)=>{"use strict";R.d(Je,{B:()=>K});var u=R(6738),d=R(6579),j=R(9064),l=R(6895);function L(re,_e){if(1&re&&(u.TgZ(0,"ion-badge",7),u._uU(1),u.qZA()),2&re){const ge=u.oxw().$implicit;u.xp6(1),u.hij("",ge.Quantity," x")}}function P(re,_e){if(1&re&&(u.TgZ(0,"strong"),u._uU(1),u.qZA()),2&re){const ge=u.oxw().$implicit;u.xp6(1),u.hij("",ge.PowerKW," kW ")}}function m(re,_e){if(1&re&&(u.TgZ(0,"div"),u._uU(1),u.qZA()),2&re){const ge=u.oxw().$implicit;u.xp6(1),u.hij("",null==ge.CurrentType?null:ge.CurrentType.Title," ")}}function $(re,_e){if(1&re&&(u.TgZ(0,"span"),u._uU(1),u.qZA()),2&re){const ge=u.oxw().$implicit;u.xp6(1),u.hij("",ge.Amps,"A ")}}function ue(re,_e){if(1&re&&(u.TgZ(0,"span"),u._uU(1),u.qZA()),2&re){const ge=u.oxw().$implicit;u.xp6(1),u.hij("",ge.Voltage,"V ")}}function V(re,_e){if(1&re){const ge=u.EpF();u.TgZ(0,"ion-col"),u.TgZ(1,"ion-button",8),u.NdJ("click",function(){u.CHM(ge);const je=u.oxw().$implicit;return u.oxw().editConnection(je)}),u._UZ(2,"ion-icon",9),u.qZA(),u._UZ(3,"br"),u.TgZ(4,"ion-button",10),u.NdJ("click",function(){u.CHM(ge);const je=u.oxw().$implicit;return u.oxw().deleteConnection(je)}),u._UZ(5,"ion-icon",11),u.qZA(),u.qZA()}}function Z(re,_e){if(1&re&&(u.TgZ(0,"ion-row"),u.TgZ(1,"ion-col"),u.TgZ(2,"ion-row"),u.TgZ(3,"ion-col",1),u._UZ(4,"img",2),u.YNc(5,L,2,1,"ion-badge",3),u.TgZ(6,"div",4),u._uU(7),u.qZA(),u.qZA(),u.TgZ(8,"ion-col"),u.TgZ(9,"ion-row"),u.TgZ(10,"ion-col"),u.TgZ(11,"ion-note"),u.TgZ(12,"div"),u.TgZ(13,"strong",5),u._uU(14),u.qZA(),u.qZA(),u.YNc(15,P,2,1,"strong",6),u.YNc(16,m,2,1,"div",6),u.qZA(),u.TgZ(17,"ion-note"),u.YNc(18,$,2,1,"span",6),u.YNc(19,ue,2,1,"span",6),u.qZA(),u.qZA(),u.qZA(),u.TgZ(20,"ion-row"),u.TgZ(21,"ion-col",4),u._uU(22),u.qZA(),u.TgZ(23,"ion-col",4),u._uU(24),u.qZA(),u.qZA(),u.qZA(),u.YNc(25,V,6,0,"ion-col",6),u.qZA(),u.qZA(),u.qZA()),2&re){const ge=_e.$implicit,xe=u.oxw();u.xp6(4),u.Q6J("src",xe.getConnectorTypeIcon(ge.ConnectionTypeID),u.LSH),u.xp6(1),u.Q6J("ngIf",ge.Quantity),u.xp6(2),u.Oqu(null==ge.StatusType?null:ge.StatusType.Title),u.xp6(6),u.s9C("title",null==ge.ConnectionType?null:ge.ConnectionType.FormalName),u.xp6(1),u.hij("",null==ge.ConnectionType?null:ge.ConnectionType.Title," "),u.xp6(1),u.Q6J("ngIf",ge.PowerKW),u.xp6(1),u.Q6J("ngIf",ge.CurrentTypeID),u.xp6(2),u.Q6J("ngIf",ge.Amps),u.xp6(1),u.Q6J("ngIf",ge.Voltage),u.xp6(3),u.Oqu(ge.Reference),u.xp6(2),u.Oqu(ge.Comments),u.xp6(1),u.Q6J("ngIf",xe.enableEdit)}}let K=(()=>{class re{constructor(){this.enableEdit=!1,this.onEdit=new u.vpe,this.onDelete=new u.vpe}ngOnInit(){}editConnection(ge){this.onEdit.emit(ge)}deleteConnection(ge){this.onDelete.emit(ge)}getConnectorTypeIcon(ge){return d.c.getIconForConnector(ge)}}return re.\u0275fac=function(ge){return new(ge||re)},re.\u0275cmp=u.Xpm({type:re,selectors:[["app-equipment-details"]],inputs:{item:"item",enableEdit:"enableEdit"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],["size","3"],[2,"max-width","64px",3,"src"],["color","primary",4,"ngIf"],[1,"info"],[3,"title"],[4,"ngIf"],["color","primary"],["size","small","color","secondary",3,"click"],["name","create","slot","icon-only"],["size","small","color","danger",3,"click"],["name","trash","slot","icon-only"]],template:function(ge,xe){1&ge&&(u.TgZ(0,"ion-grid"),u.YNc(1,Z,26,12,"ion-row",0),u.qZA()),2&ge&&(u.xp6(1),u.Q6J("ngForOf",xe.item.Connections))},directives:[j.jY,l.sg,j.Nd,j.wI,l.O5,j.yp,j.uN,j.YG,j.gu],styles:[""]}),re})()},2428:(Tn,Je,R)=>{"use strict";R.d(Je,{v:()=>K});var u=R(6099),d=R(7689),j=R(6738),l=R(553),L=R(9064),P=R(529),m=R(6260),$=R(6895);function ue(re,_e){1&re&&(j.TgZ(0,"div"),j._UZ(1,"ion-spinner"),j.qZA())}function V(re,_e){if(1&re){const ge=j.EpF();j.TgZ(0,"ion-item",5),j.NdJ("click",function(){const nt=j.CHM(ge).$implicit;return j.oxw(2).placeSelected(nt)}),j.TgZ(1,"ion-avatar",6),j._UZ(2,"ion-icon",7),j.qZA(),j.TgZ(3,"ion-label"),j.TgZ(4,"p"),j._uU(5),j.qZA(),j.qZA(),j.qZA()}if(2&re){const ge=_e.$implicit;j.xp6(5),j.Oqu(ge.Address)}}function Z(re,_e){if(1&re&&(j.TgZ(0,"div",1),j.YNc(1,ue,2,0,"div",2),j.TgZ(2,"ion-list"),j.YNc(3,V,6,1,"ion-item",3),j.TgZ(4,"ion-item"),j.TgZ(5,"p",4),j._uU(6),j.qZA(),j.qZA(),j.qZA(),j.qZA()),2&re){const ge=j.oxw();j.xp6(1),j.Q6J("ngIf",ge.searchInProgress),j.xp6(2),j.Q6J("ngForOf",ge.placeList),j.xp6(3),j.hij(" ",ge.placeAttribution," ")}}let K=(()=>{class re{constructor(ge,xe,je,nt,Fe){this.logging=ge,this.changeDetector=xe,this.platform=je,this.http=nt,this.events=Fe,this.searchInProgress=!1,this.placeSearchActive=!1,this.placeAttribution="",this.placeChanged=new j.vpe,this.searchKeyword="",this.searchInProgress=!1,this.mapService=new l.k(Fe,ge,nt)}ngOnInit(){var ge=this;return(0,u.Z)(function*(){yield ge.platform.ready(),ge.mapService.initAPI()})()}onSearchFocus(){this.placeSearchFocused=!0}onSearchBlur(){this.placeSearchFocused=!1}onSearchCancel(){}getPlacesAutoComplete(ge,xe){var je=this;return(0,u.Z)(function*(){je.placeSearchType=xe;let nt=ge.target.value;if(nt&&nt.length>3){je.logging.log("Starting place lookup for:"+nt),je.placeSearchActive=!0,je.searchInProgress=!0,je.searchInProgress=!1,je.placeSearchActive=!0;try{je.placeList=yield je.mapService.placeSearch(nt),je.placeList&&je.placeList.length>0&&(je.placeAttribution=je.placeList[0].Attribution)}catch{}je.searchInProgress=!1,je.placeSearchActive=!0}else je.searchInProgress=!1,je.placeSearchActive=!1})()}placeSelected(ge){this.logging.log("Looking up place details:"+ge.Title+"::"+ge.ReferenceID),this.selectedPlace=ge,this.placeChanged.emit(ge),this.placeSearchActive=!1}}return re.\u0275fac=function(ge){return new(ge||re)(j.Y36(d.z),j.Y36(j.sBO),j.Y36(L.t4),j.Y36(P.eN),j.Y36(m.z))},re.\u0275cmp=j.Xpm({type:re,selectors:[["place-search"]],inputs:{searchKeyword:"searchKeyword"},outputs:{selectedPlace:"selectedPlace",placeChanged:"placeChanged"},decls:1,vars:1,consts:[["class","place-search",4,"ngIf"],[1,"place-search"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],[1,"place-attribution"],[3,"click"],["item-left",""],["name","locate"]],template:function(ge,xe){1&ge&&j.YNc(0,Z,7,3,"div",0),2&ge&&j.Q6J("ngIf",xe.placeSearchActive)},directives:[$.O5,L.PQ,L.q_,$.sg,L.Ie,L.BJ,L.gu,L.Q$],styles:[".place-search[_ngcontent-%COMP%]{position:absolute;z-index:1000}.place-attribution[_ngcontent-%COMP%]{font-size:9px;color:#dcdcdc;max-width:100%}"]}),re})()},6585:(Tn,Je,R)=>{"use strict";R.d(Je,{o:()=>$});var u=R(6738),d=R(6579),j=R(9064),l=R(6895);function L(ue,V){if(1&ue){const Z=u.EpF();u.TgZ(0,"ion-button",5),u.NdJ("click",function(){u.CHM(Z);const re=u.oxw().$implicit;return u.oxw().onCopyCommand(re)}),u._uU(1,"Copy"),u.qZA()}}function P(ue,V){if(1&ue){const Z=u.EpF();u.TgZ(0,"ion-button",5),u.NdJ("click",function(){u.CHM(Z);const re=u.oxw().$implicit;return u.oxw().onEditCommand(re)}),u._uU(1,"Edit"),u.qZA()}}function m(ue,V){if(1&ue&&(u.TgZ(0,"ion-item",1),u.TgZ(1,"ion-grid"),u.TgZ(2,"ion-row"),u.TgZ(3,"ion-col"),u._uU(4),u.qZA(),u.qZA(),u.TgZ(5,"ion-row"),u.TgZ(6,"ion-col",2),u.TgZ(7,"p"),u._UZ(8,"img",3),u.qZA(),u.TgZ(9,"ion-note"),u._uU(10),u.qZA(),u.YNc(11,L,2,0,"ion-button",4),u.YNc(12,P,2,0,"ion-button",4),u.qZA(),u.TgZ(13,"ion-col"),u.TgZ(14,"ion-row"),u.TgZ(15,"ion-col"),u.TgZ(16,"p"),u._uU(17),u.qZA(),u.TgZ(18,"ion-note"),u._uU(19),u.qZA(),u.qZA(),u.qZA(),u.TgZ(20,"ion-row"),u.TgZ(21,"ion-col"),u._uU(22),u.qZA(),u.TgZ(23,"ion-col"),u._uU(24),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.qZA()),2&ue){const Z=V.$implicit,K=u.oxw();u.xp6(4),u.hij(" ",Z.AddressInfo.Title," "),u.xp6(4),u.Q6J("src",K.getIconForPOI(Z),u.LSH),u.xp6(2),u.hij(" ",K.getFormattedDistance(Z)," "),u.xp6(1),u.Q6J("ngIf",K.enableCopyOption),u.xp6(1),u.Q6J("ngIf",K.enableEditOption),u.xp6(5),u.hij(" ",K.getFormattedAddress(Z)," "),u.xp6(2),u.hij(" ",K.getFormattedConnectorList(Z)," "),u.xp6(3),u.hij(" ",null==Z.UsageType?null:Z.UsageType.Title," "),u.xp6(2),u.hij(" ",null==Z.OperatorInfo?null:Z.OperatorInfo.Title," ")}}let $=(()=>{class ue{constructor(){this.enableCopyOption=!1,this.enableEditOption=!1,this.poiList=[],this.onCopy=new u.vpe,this.onEdit=new u.vpe}ngOnInit(){}onCopyCommand(Z){this.onCopy.emit(Z)}onEditCommand(Z){this.onEdit.emit(Z)}getFormattedAddress(Z){let K="";return K+=Z.AddressInfo.Title!=Z.AddressInfo.AddressLine1?Z.AddressInfo.Title:Z.AddressInfo.Town,K}getFormattedConnectorList(Z){if(!Z.Connections)return;let K=[];for(let re of Z.Connections)null!=re.ConnectionType&&(K.find(_e=>_e==re.ConnectionType.Title)||K.push(re.ConnectionType.Title));return K.join(", ")}getIconForPOI(Z){return d.c.getIconForPOI(Z)}getFormattedDistance(Z){return d.c.getFormattedDistance(Z)}}return ue.\u0275fac=function(Z){return new(Z||ue)},ue.\u0275cmp=u.Xpm({type:ue,selectors:[["app-poi-list"]],inputs:{enableCopyOption:"enableCopyOption",enableEditOption:"enableEditOption",poiList:"poiList"},outputs:{onCopy:"onCopy",onEdit:"onEdit"},decls:2,vars:1,consts:[["style","max-width:400px;",4,"ngFor","ngForOf"],[2,"max-width","400px"],["size","3"],[2,"width","24px",3,"src"],["size","small",3,"click",4,"ngIf"],["size","small",3,"click"]],template:function(Z,K){1&Z&&(u.TgZ(0,"ion-list"),u.YNc(1,m,25,9,"ion-item",0),u.qZA()),2&Z&&(u.xp6(1),u.Q6J("ngForOf",K.poiList))},directives:[j.q_,l.sg,j.Ie,j.jY,j.Nd,j.wI,j.uN,l.O5,j.YG],styles:[""]}),ue})()},8936:(Tn,Je,R)=>{"use strict";R.d(Je,{e:()=>P});var u=R(6895),d=R(9064),j=R(4006),l=R(9397),L=R(6738);let P=(()=>{class m{}return m.\u0275fac=function(ue){return new(ue||m)},m.\u0275mod=L.oAB({type:m}),m.\u0275inj=L.cJS({providers:[u.JJ],imports:[[u.ez,d.Pc,j.u5,l.aw]]}),m})()},2951:(Tn,Je,R)=>{"use strict";R.d(Je,{X:()=>d});var u=R(2340);class d{constructor(){this.baseURL="https://map.openchargemap.io",this.loginProviderRedirectBaseURL="https://openchargemap.org/site/loginprovider/?_mode=silent&_forceLogin=true&_redirectURL=",this.loginProviderRedirectURL=this.loginProviderRedirectBaseURL+this.baseURL,this.enableLiveMapQuerying=!0,this.googleMapsAPIKey=u.N.googleMapsKey,this.enableStaticMaps=u.N.enableStaticMaps}}},6579:(Tn,Je,R)=>{"use strict";R.d(Je,{c:()=>d});var u=R(2340);let d=(()=>{class j{static isFeatureEnabled(L){return!!u.N.enabledFeatures.find(P=>P===L)}static getClientHeight(){const L=document.body,P=document.documentElement;return Math.max(L.scrollHeight,L.offsetHeight,P.clientHeight,P.scrollHeight,P.offsetHeight)}static getClientWidth(){const L=document.body,P=document.documentElement;return Math.max(L.scrollWidth,L.offsetWidth,P.clientWidth,P.scrollWidth,P.offsetWidth)}static getMaxLevelOfPOI(L){let P=0;if(null!=L.Connections)for(let m=0;m<L.Connections.length;m++)null!=L.Connections[m].Level&&L.Connections[m].Level.ID>P&&(P=L.Connections[m].Level.ID);return 4===P&&(P=2),P>4&&(P=3),P}static getIconForPOI(L){let m="assets/images/icons/map/level"+j.getMaxLevelOfPOI(L);return null!=L.UsageType&&L.UsageType.Title.indexOf("Private")>-1?m+="_private":m+=null!=L.StatusType&&!0!==L.StatusType.IsOperational?"_nonoperational":"_operational",m+="_icon.png",m}static getColorForPOI(L){const P=j.getMaxLevelOfPOI(L);let m="#c0c0c0";return null!=L.UsageType&&L.UsageType.Title.indexOf("Private")>-1?m="#FF0000":null!=L.StatusType&&!0!==L.StatusType.IsOperational?m="#a0a0a0":2==P?m="#72EB0D":3==P&&(m="#EB800D"),m}static getIconForConnector(L){let P="assets/images/icons/connectors/";return P+=1===L?"Type1_J1772.svg":2===L?"Chademo_type4.svg":25===L?"Type2_socket.svg":32===L?"Type1_CCS.svg":33===L?"Type2_CCS.svg":1036===L?"Type2_tethered.svg":28===L?"schuko.svg":"Unknown.svg",P}static getFormattedDistance(L){return L&&L.AddressInfo&&L.AddressInfo.Distance?L.AddressInfo.Distance.toFixed(1)+" "+(1===L.AddressInfo.DistanceUnit?"km":"miles"):""}static fixJSONDate(L){if(null==L)return null;if(0==L.indexOf("/")){let m=/Date\(([^)]+)\)/.exec(L);L=new Date(parseFloat(m[1]))}else L=new Date(L);return L}static formatMapLinkFromPosition(L,P,m,$,ue){return'<a href="https://maps.google.com/maps?saddr='+P+","+m+"&daddr="+L.AddressInfo.Latitude+","+L.AddressInfo.Longitude+'">Map ('+Math.ceil($)+" "+ue+")</a>"}static formatSystemWebLink(L,P){return"<a href='#' onclick=\"window.open('"+L+"', '_system');return false;\">"+P+"</a>"}static formatMapLink(L,P,m){return m?device&&"WinCE"==device.platform?this.formatSystemWebLink("maps:"+L.AddressInfo.Latitude+","+L.AddressInfo.Longitude,P):device&&"iOS"===device.platform?this.formatSystemWebLink("https://maps.apple.com/?q="+L.AddressInfo.Latitude+","+L.AddressInfo.Longitude,P):this.formatSystemWebLink("https://maps.google.com/maps?q="+L.AddressInfo.Latitude+","+L.AddressInfo.Longitude,P):'<a target="_blank"  href="https://maps.google.com/maps?q='+L.AddressInfo.Latitude+","+L.AddressInfo.Longitude+'">'+P+"</a>"}static formatURL(L,P=null){return null==L||""==L?"":(-1==L.indexOf("http")&&(L="https://"+L),'<a target="_blank" href="'+L+'">'+(P??L)+"</a>")}static formatString(L){return null==L?"":L.toString()}static formatTextField(L,P=null,m=!1,$=!1,ue=null){if(null==L||""==L||null==L)return"";let V=(null!=P?"<strong class='ocm-label' "+(null!=ue?"data-localize='"+ue+"' ":"")+">"+P+"</strong>: ":"")+(m?"<br/>":"")+L.toString().replace("\n","<br/>")+"<br/>";return 1==$&&(V="<p>"+V+"</p>"),V}static formatEmailAddress(L){return null!=L&&null!=L&&""!=L?"<i class='fa fa-envelope fa-fw'></i> <a href=\"mailto:"+L+'">'+L+"</a><br/>":""}static formatPhone(L,P=null){return null!=L&&null!=L&&""!=L?(null==P?P="<i class='fa fa-phone fa-fw '></i> ":P+=": ",P+'<a href="tel:'+L+'">'+L+"</a><br/>"):""}static formatPOIDetails(L,P){let $=new Date;null==P&&(P=!1);let ue=this.formatPOIAddress(L,!1),V="";V+=this.formatPhone(L.AddressInfo.ContactTelephone1),V+=this.formatPhone(L.AddressInfo.ContactTelephone2),V+=this.formatEmailAddress(L.AddressInfo.ContactEmail);let Z="";if(null!=L.AddressInfo.Distance){let je="https://maps.google.com/maps?saddr=&daddr="+L.AddressInfo.Latitude+","+L.AddressInfo.Longitude;Z+="<strong id='addr_distance'><span data-localize='details.approxDistance'>Distance</span>: "+L.AddressInfo.Distance.toFixed(1)+" "+(2==L.AddressInfo.DistanceUnit?"Miles":"KM")+"</strong>",Z+="<p>"+this.formatSystemWebLink(je,"Get Directions")+"</p>"}if(null!=L.AddressInfo.RelatedURL&&""!=L.AddressInfo.RelatedURL){let je=L.AddressInfo.RelatedURL;je=je.replace(/.*?:\/\//g,""),je.length>40&&(je=je.substr(0,40)+".."),V+="<i class='fa fa-fw fa-external-link'></i>  "+this.formatSystemWebLink(L.AddressInfo.RelatedURL,"<span data-localize='details.addressRelatedURL'>"+je+"</span>")}V+="</p>";const K=this.formatTextField(L.GeneralComments,null,!1,!0)+this.formatTextField(L.AddressInfo.AccessComments,"Access",!0,!0,"details.accessComments");let re="";null!=L.NumberOfPoints&&(re+=this.formatTextField(L.NumberOfPoints,"Bays",!1,!0,"details.numberOfPoints")),null!=L.UsageType&&(re+=this.formatTextField(L.UsageType.Title,"Usage",!1,!0,"details.usageType")),null!=L.UsageCost&&(re+=this.formatTextField(L.UsageCost,"Usage Cost",!1,!0,"details.usageCost")),null!=L.OperatorInfo&&1!=L.OperatorInfo.ID&&(re+=this.formatTextField(L.OperatorInfo.Title,"Operator",!1,!0,"details.operatorTitle"),null!=L.OperatorInfo.WebsiteURL&&(re+=this.formatTextField(this.formatURL(L.OperatorInfo.WebsiteURL),"Operator Website",!0,!0,"details.operatorWebsite")));let _e="";if(null!=L.StatusType&&(_e+=this.formatTextField(L.StatusType.Title,"Status",!1,!0,"details.operationalStatus"),null!=L.DateLastStatusUpdate&&(_e+=this.formatTextField(Math.round(($-this.fixJSONDate(L.DateLastStatusUpdate))/864e5)+" days ago","Last Updated",!1,!0,"details.lastUpdated"))),null!=L.Connections&&L.Connections.length>0){_e+="<table class='table table-striped'>",_e+="<tr><th data-localize='details.equipment.connectionType'>Connection</th><th data-localize='details.equipment.powerLevel'>Power Level</th><th data-localize='details.operationalStatus'>Status</th></tr>";for(let je=0;je<L.Connections.length;je++){let nt=L.Connections[je];""==nt.Amps&&(nt.Amps=null),""==nt.Voltage&&(nt.Voltage=null),""==nt.Quantity&&(nt.Quantity=null),""==nt.PowerKW&&(nt.PowerKW=null),_e+="<tr><td>"+(null!=nt.ConnectionType?nt.ConnectionType.Title:"")+"</td><td>"+(null!=nt.Level?"<strong>"+nt.Level.Title+"</strong><br/>":"")+(null!=nt.Amps?this.formatString(nt.Amps)+"A/ ":"")+(null!=nt.Voltage?this.formatString(nt.Voltage)+"V/ ":"")+(null!=nt.PowerKW?this.formatString(nt.PowerKW)+"kW <br/>":"")+(null!=nt.CurrentType?nt.CurrentType.Title:"")+"<br/>"+(null!=nt.Quantity?this.formatString(nt.Quantity):"1")+" Present</td><td>"+(null!=nt.StatusType?nt.StatusType.Title:"-")+"</td></tr>"}_e+="</table>"}let ge="";return ge+=this.formatTextField("<a target='_blank' href='https://openchargemap.org/site/poi/details/"+L.ID+"'>OCM-"+L.ID+"</a>","OpenChargeMap Ref",!1,!0,"details.refNumber"),null!=L.DataProvider&&(ge+=this.formatTextField(L.DataProvider.Title,"Data Provider",!1,!0,"details.dataProviderTitle"),null!=L.DataProvider.WebsiteURL&&(ge+=this.formatTextField(this.formatURL(L.DataProvider.WebsiteURL),"Website",!1,!0,"details.dataProviderWebsite")),ge+=this.formatTextField(L.AddressInfo.Latitude,"Latitude",!1,!0,null),ge+=this.formatTextField(L.AddressInfo.Longitude,"Longitude",!1,!0,null)),{address:ue,drivingInfo:Z,contactInfo:V,additionalInfo:K+re+_e,advancedInfo:ge}}static debounce(L,P,m){let $;return function(){let ue=this,V=arguments,Z=function(){$=null,m||L.apply(ue,V)},K=m&&!$;clearTimeout($),$=setTimeout(Z,P),K&&L.apply(ue,V)}}static getRandomInt(L){return Math.floor(Math.random()*Math.floor(L))}}return j.formatPOIAddress=function(l,L=!0){let P="";return P=L?""+this.formatTextField(l.AddressInfo.AddressLine1)+this.formatTextField(l.AddressInfo.AddressLine2)+this.formatTextField(l.AddressInfo.Town)+this.formatTextField(l.AddressInfo.StateOrProvince)+this.formatTextField(l.AddressInfo.Postcode)+(null!=l.AddressInfo.Country?this.formatTextField(l.AddressInfo.Country.Title):""):this.formatStringArray([l.AddressInfo.AddressLine1,l.AddressInfo.AddressLine2,l.AddressInfo.Town,l.AddressInfo.StateOrProvince,l.AddressInfo.Postcode,null!=l.AddressInfo.Country?l.AddressInfo.Country.Title:""]),P},j.formatStringArray=function(l,L=", "){if(null==l)return"";let P="";for(let m=0;m<l.length;m++)null!=l[m]&&""!=l[m].trim()&&(P+=m==l.length-1?l[m]:l[m]+L);return P},j})()},4120:(Tn,Je,R)=>{"use strict";R.d(Je,{wC:()=>u,jR:()=>d,LL:()=>j});class u{constructor(L=null,P=null){this.latitude=L,this.longitude=P}}class d{constructor(L=null,P=null){this.coords=new u,this.coords.latitude=L,this.coords.longitude=P}static fromPosition(L){return new d(L.coords.latitude,L.coords.longitude)}}class j{constructor(L,P){this.northEast=L,this.southWest=P}}},129:(Tn,Je,R)=>{"use strict";R.d(Je,{Qp:()=>j,fw:()=>P,JJ:()=>$,eN:()=>m,vw:()=>L,kA:()=>l});class u{constructor(V,Z){this.itemType=V,this.itemId=u.getNewItemId(),this.version=1,this.schemaVersion=Z,this.syncTimeStamp=u.getNewSyncTimeStamp()}static getNewSyncTimeStamp(){return Date.now().toString()}static getNewItemId(){return"_syncitem_"+Date.now().toString()}}class d{constructor(V,Z){this._sync=new u(V,Z)}}class j extends d{}class l extends d{constructor(){super("waypoint",1)}}class L extends d{constructor(){super("journey_stage",1),this.WayPoints=[]}}class P extends d{constructor(){super("journey",1),this.ID=""+Date.now(),this.Stages=[]}}class m{}class ${}},2206:(Tn,Je,R)=>{"use strict";R.d(Je,{b:()=>u});class u{constructor(){this.poiIdList=null,this.countryCode=null,this.latitude=null,this.longitude=null,this.locationTitle=null,this.distance=null,this.distanceUnit=null,this.connectionTypeIdList=null,this.operatorIdList=null,this.levelIdList=null,this.countryIdList=null,this.usageTypeIdList=null,this.statusTypeIdList=null,this.minPowerKW=null,this.maxPowerKW=null,this.submissionStatusTypeIdList=null,this.maxResults=500,this.additionalParams=null,this.includeComments=!1,this.compact=!0,this.enableCaching=!0,this.levelOfDetail=1,this.polyline=null,this.boundingbox=null}}},4209:(Tn,Je,R)=>{"use strict";R.d(Je,{n:()=>u});class u{}},7627:(Tn,Je,R)=>{"use strict";R.d(Je,{U:()=>u,N:()=>d});const u=650;class d{constructor(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MaxPowerKW=null,this.MinPowerKW=null,this.HasActiveFilters=!1,this.FilterOptionsByCountryId=null,this.UseDistanceInKM=!0,this.MapType="ROADMAP",this.EnableAdvancedEditorFeatures=!1}LoadSettings(){}SaveSettings(){}ClearActiveFilters(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MinPowerKW=null,this.MaxPowerKW=null}CheckForActiveFilters(){return this.HasActiveFilters=this.OperatorList.length>0||this.ConnectionTypeList.length>0||this.CountryList.length>0||this.UsageTypeList.length>0||this.StatusTypeList.length>0||this.MinPowerKW>0||this.MaxPowerKW>0||null!=this.MaxPowerKW&&this.MaxPowerKW<u,this.HasActiveFilters}}},8649:(Tn,Je,R)=>{"use strict";R.d(Je,{q:()=>u});var u=(()=>{return(d=u||(u={}))[d.POI=0]="POI",d[d.Comment=1]="Comment",d[d.Media=2]="Media",u;var d})()},534:(Tn,Je,R)=>{"use strict";R.r(Je),R.d(Je,{AboutPageModule:()=>V});var u=R(6895),d=R(4006),j=R(9064),l=R(3334),L=R(388),P=R(6738);const m=[{path:"",component:L.t}];let $=(()=>{class Z{}return Z.\u0275fac=function(re){return new(re||Z)},Z.\u0275mod=P.oAB({type:Z}),Z.\u0275inj=P.cJS({imports:[[l.Bz.forChild(m)],l.Bz]}),Z})();var ue=R(9397);let V=(()=>{class Z{}return Z.\u0275fac=function(re){return new(re||Z)},Z.\u0275mod=P.oAB({type:Z}),Z.\u0275inj=P.cJS({imports:[[u.ez,d.u5,j.Pc,ue.aw,$]]}),Z})()},388:(Tn,Je,R)=>{"use strict";R.d(Je,{t:()=>L});var u=R(2340),d=R(6738),j=R(9064),l=R(9397);let L=(()=>{class P{constructor($){this.modalController=$}get appVersion(){return u.N.version}get apiUrl(){return u.N.apiBase}ngOnInit(){}close(){this.modalController.dismiss()}}return P.\u0275fac=function($){return new($||P)(d.Y36(j.IN))},P.\u0275cmp=d.Xpm({type:P,selectors:[["app-about"]],decls:49,vars:5,consts:[[1,"ion-padding"],["size","2"],["src","assets/images/icons/branding/AppIcon_128x128.png",2,"padding-top","2em"],["href","https://openchargemap.org"],["href","https://community.openchargemap.org"],["href","https://github.com/openchargemap/ocm-system/issues"],["href","https://webprofusion.com"],["href","https://opencollective.com/openchargemap"],["slot","end"],[3,"click"],["name","close","slot","start"]],template:function($,ue){1&$&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-title"),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(5,"ion-content",0),d.TgZ(6,"ion-grid"),d.TgZ(7,"ion-row"),d.TgZ(8,"ion-col",1),d._UZ(9,"img",2),d.qZA(),d.TgZ(10,"ion-col"),d.TgZ(11,"h1"),d._uU(12,"Open Charge Map"),d.qZA(),d.TgZ(13,"h2"),d._uU(14,"The global public registry of Electric Vehicle charging locations"),d.qZA(),d.TgZ(15,"p"),d._uU(16,"Web: "),d.TgZ(17,"a",3),d._uU(18,"https://openchargemap.org"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(19,"p"),d._uU(20,"Community Discussions: "),d.TgZ(21,"a",4),d._uU(22,"https://community.openchargemap.org"),d.qZA(),d.qZA(),d.TgZ(23,"p"),d._uU(24,"App or System Bugs and feature suggestions: "),d.TgZ(25,"a",5),d._uU(26,"GitHub"),d.qZA(),d.qZA(),d.TgZ(27,"p"),d._uU(28,"App development by Webprofusion Pty Ltd ("),d.TgZ(29,"a",6),d._uU(30,"https://webprofusion.com"),d.qZA(),d._uU(31,")"),d.qZA(),d.TgZ(32,"h3"),d._uU(33,"Funding"),d.qZA(),d.TgZ(34,"p"),d._uU(35,"Our software is developed and hosted by volunteers, our data is crowdsourced by you. To help further development please encourage your organisation to sponsor us: "),d.TgZ(36,"a",7),d._uU(37,"Open Collective"),d.qZA(),d.qZA(),d.TgZ(38,"ion-note"),d.TgZ(39,"p"),d._uU(40),d.qZA(),d.TgZ(41,"p"),d._uU(42),d.qZA(),d.qZA(),d.qZA(),d.TgZ(43,"ion-footer"),d.TgZ(44,"ion-toolbar"),d.TgZ(45,"ion-buttons",8),d.TgZ(46,"ion-button",9),d.NdJ("click",function(){return ue.close()}),d._UZ(47,"ion-icon",10),d._uU(48," Close "),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&$&&(d.xp6(3),d.Oqu(d.lcZ(4,3,"ocm.general.about")),d.xp6(37),d.hij("App Version: ",ue.appVersion,""),d.xp6(2),d.hij("API: ",ue.apiUrl,""))},directives:[j.Gu,j.sr,j.wd,j.W2,j.jY,j.Nd,j.wI,j.uN,j.fr,j.Sm,j.YG,j.gu],pipes:[l.X$],styles:[""]}),P})()},5476:(Tn,Je,R)=>{"use strict";R.r(Je),R.d(Je,{JourneysModule:()=>ue});var u=R(9741),d=R(8936),j=R(9397),l=R(6895),L=R(4006),P=R(9064),m=R(3334),$=R(6738);let ue=(()=>{class V{}return V.\u0275fac=function(K){return new(K||V)},V.\u0275mod=$.oAB({type:V}),V.\u0275inj=$.cJS({imports:[[l.ez,L.u5,P.Pc,j.aw,d.e,m.Bz.forChild([{path:"",component:u.g}])]]}),V})()},9741:(Tn,Je,R)=>{"use strict";R.d(Je,{g:()=>ke});var u=R(3912),d=R(7814),j=R(3855),l=R(4120),L=R(3399),P=R(6738),m=R(9064),$=R(6895);function ue(Ne,$e){1&Ne&&(P.TgZ(0,"p"),P._uU(1," You have no journeys yet. Start by browsing to a charging location, then add it as Favourite to start a new Journey. "),P.qZA())}function V(Ne,$e){if(1&Ne&&(P.TgZ(0,"p"),P._uU(1),P.qZA()),2&Ne){const Re=P.oxw(2).$implicit;P.xp6(1),P.hij(" ",Re.Poi.AddressInfo.AddressLine1,"")}}function Z(Ne,$e){if(1&Ne&&(P.TgZ(0,"p"),P._uU(1),P.qZA()),2&Ne){const Re=P.oxw(2).$implicit;P.xp6(1),P.hij(" ",Re.Poi.AddressInfo.AddressLine2,"")}}function K(Ne,$e){if(1&Ne&&(P.TgZ(0,"p"),P._uU(1),P.qZA()),2&Ne){const Re=P.oxw(2).$implicit;P.xp6(1),P.hij(" ",Re.Poi.AddressInfo.Town,"")}}function re(Ne,$e){if(1&Ne&&(P.TgZ(0,"p"),P._uU(1),P.qZA()),2&Ne){const Re=P.oxw(2).$implicit;P.xp6(1),P.hij(" ",Re.Poi.AddressInfo.StateOrProvince,"")}}function _e(Ne,$e){if(1&Ne&&(P.TgZ(0,"p"),P._uU(1),P.qZA()),2&Ne){const Re=P.oxw(2).$implicit;P.xp6(1),P.hij(" ",Re.Poi.AddressInfo.Postcode,"")}}function ge(Ne,$e){if(1&Ne){const Re=P.EpF();P.TgZ(0,"div"),P.TgZ(1,"div",18),P.NdJ("click",function(){P.CHM(Re);const Ge=P.oxw().$implicit;return P.oxw(4).viewPOIDetails(Ge.Poi)}),P.YNc(2,V,2,1,"p",4),P.YNc(3,Z,2,1,"p",4),P.YNc(4,K,2,1,"p",4),P.YNc(5,re,2,1,"p",4),P.YNc(6,_e,2,1,"p",4),P.qZA(),P.TgZ(7,"ion-button",19),P.NdJ("click",function(){P.CHM(Re);const Ge=P.oxw().$implicit;return P.oxw(4).launchNavigation(Ge.Poi)}),P._UZ(8,"ion-icon",20),P._uU(9," Navigate "),P.qZA(),P.qZA()}if(2&Ne){const Re=P.oxw().$implicit;P.xp6(2),P.Q6J("ngIf",Re.Poi.AddressInfo.AddressLine1),P.xp6(1),P.Q6J("ngIf",Re.Poi.AddressInfo.AddressLine2),P.xp6(1),P.Q6J("ngIf",Re.Poi.AddressInfo.Town),P.xp6(1),P.Q6J("ngIf",Re.Poi.AddressInfo.StateOrProvince),P.xp6(1),P.Q6J("ngIf",Re.Poi.AddressInfo.Postcode)}}function xe(Ne,$e){if(1&Ne&&(P.TgZ(0,"div",17),P.YNc(1,ge,10,5,"div",4),P.qZA()),2&Ne){const Re=$e.$implicit;P.xp6(1),P.Q6J("ngIf",Re.Poi)}}function je(Ne,$e){if(1&Ne&&(P.TgZ(0,"ion-item"),P.TgZ(1,"h2"),P._uU(2),P.qZA(),P.TgZ(3,"ion-thumbnail",0),P._UZ(4,"ion-icon",15),P.qZA(),P.TgZ(5,"p"),P._uU(6),P.qZA(),P.YNc(7,xe,2,1,"div",16),P.qZA()),2&Ne){const Re=$e.$implicit;P.xp6(2),P.Oqu(Re.Title),P.xp6(4),P.Oqu(Re.Notes),P.xp6(1),P.Q6J("ngForOf",Re.PoiList)}}function nt(Ne,$e){if(1&Ne&&(P.TgZ(0,"ion-list"),P.TgZ(1,"ion-list-header",11),P._uU(2),P._UZ(3,"ion-icon",12),P._uU(4," -- "),P._UZ(5,"ion-icon",13),P._uU(6," -- "),P._UZ(7,"ion-icon",14),P._uU(8," -- "),P.qZA(),P.YNc(9,je,8,3,"ion-item",5),P.qZA()),2&Ne){const Re=$e.$implicit;P.xp6(2),P.hij(" ",Re.Title," "),P.xp6(7),P.Q6J("ngForOf",Re.WayPoints)}}function Fe(Ne,$e){if(1&Ne){const Re=P.EpF();P.TgZ(0,"ion-card"),P.TgZ(1,"ion-card-content"),P.TgZ(2,"ion-toolbar",8),P.TgZ(3,"ion-title"),P._uU(4),P.qZA(),P.TgZ(5,"ion-buttons",9),P.TgZ(6,"ion-button",1),P.NdJ("click",function(){const ot=P.CHM(Re).$implicit;return P.oxw().deleteJourney(ot.ID)}),P._UZ(7,"ion-icon",10),P.qZA(),P.qZA(),P.qZA(),P.TgZ(8,"p"),P._uU(9),P.qZA(),P.YNc(10,nt,10,2,"ion-list",5),P.qZA(),P.qZA()}if(2&Ne){const Re=$e.$implicit;P.xp6(4),P.hij(" ",Re.Title,""),P.xp6(5),P.Oqu(Re.Notes),P.xp6(1),P.Q6J("ngForOf",Re.Stages)}}let ke=(()=>{class Ne{constructor(Re,_t,Ge,ot,yt){this.appManager=Re,this.journeyManager=_t,this.api=Ge,this.modalController=ot,this.alertController=yt}dismiss(){this.modalController.dismiss()}discoverImages(){this.journeyManager.journeys.forEach(Re=>{Re.Stages.forEach(_t=>{_t.WayPoints.forEach(Ge=>{null!=Ge.PoiList&&Ge.PoiList.forEach(ot=>{ot.Poi&&this.api.getPanoramioLocationPhotos(new l.wC(ot.Poi.AddressInfo.Latitude,ot.Poi.AddressInfo.Longitude)).then(yt=>{ot.Photos=yt})})})})})}getJson(Re){return JSON.stringify(Re,null,4)}viewPOIDetails(Re){this.modalController.create({component:L.H,componentProps:{item:Re}}).then(_t=>_t.present())}get staticMapSize(){return"60x60"}getStaticMapURL(Re){return"https://maps.googleapis.com/maps/api/staticmap?center="+Re.AddressInfo.Latitude+","+Re.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+Re.AddressInfo.Latitude+","+Re.AddressInfo.Longitude}deleteJourney(Re){this.alertController.create({header:"Delete this Journey?",message:"Are you sure you want to delete this Journey?",buttons:[{text:"No",handler:()=>{}},{text:"Delete",handler:()=>{this.journeyManager.deleteJourney(Re)}}]}).then(_t=>_t.present())}launchNavigation(Re){let _t="https://maps.google.com/?q="+Re.AddressInfo.Latitude+","+Re.AddressInfo.Longitude;this.appManager.platform.is("ios")&&(_t="https://maps.apple.com?q="+Re.AddressInfo.Latitude+","+Re.AddressInfo.Longitude),window.open(_t,"_system")}}return Ne.\u0275fac=function(Re){return new(Re||Ne)(P.Y36(j.c),P.Y36(u.i),P.Y36(d.l),P.Y36(m.IN),P.Y36(m.Br))},Ne.\u0275cmp=P.Xpm({type:Ne,selectors:[["ng-component"]],decls:18,vars:2,consts:[["slot","start"],[3,"click"],[1,"journeys-page"],[1,"ion-padding"],[4,"ngIf"],[4,"ngFor","ngForOf"],["slot","end"],["name","close","slot","start"],["primary",""],["slot","primary"],["name","close","slot","icon-only"],[2,"font-size","1.5rem"],["name","car"],["name","time"],["name","flash"],["name","caret-down",2,"font-size","4rem"],["style","text-align:right;width:100%;",4,"ngFor","ngForOf"],[2,"text-align","right","width","100%"],["tappable","",3,"click"],["clear","","item-right","",3,"click"],["name","navigate","slot","start"]],template:function(Re,_t){1&Re&&(P.TgZ(0,"ion-header"),P.TgZ(1,"ion-toolbar"),P.TgZ(2,"ion-buttons",0),P.TgZ(3,"ion-back-button",1),P.NdJ("click",function(){return _t.dismiss()}),P.qZA(),P.qZA(),P.TgZ(4,"ion-title"),P._uU(5," Journeys "),P.qZA(),P.qZA(),P.qZA(),P.TgZ(6,"ion-content",2),P.TgZ(7,"div",3),P.TgZ(8,"p"),P._uU(9," You can create and plan journeys to group your favourite charging routes together. "),P.qZA(),P.YNc(10,ue,2,0,"p",4),P.qZA(),P.YNc(11,Fe,11,3,"ion-card",5),P.qZA(),P.TgZ(12,"ion-footer"),P.TgZ(13,"ion-toolbar"),P.TgZ(14,"ion-buttons",6),P.TgZ(15,"ion-button",1),P.NdJ("click",function(){return _t.dismiss()}),P._UZ(16,"ion-icon",7),P._uU(17," Close "),P.qZA(),P.qZA(),P.qZA(),P.qZA()),2&Re&&(P.xp6(10),P.Q6J("ngIf",null==_t.journeyManager.journeys||0==_t.journeyManager.journeys.length),P.xp6(1),P.Q6J("ngForOf",_t.journeyManager.journeys))},directives:[m.Gu,m.sr,m.Sm,m.oU,m.cs,m.wd,m.W2,$.O5,$.sg,m.PM,m.FN,m.YG,m.gu,m.q_,m.yh,m.Ie,m.Bs,m.fr],encapsulation:2}),Ne})()},5005:(Tn,Je,R)=>{"use strict";R.r(Je),R.d(Je,{LayerEditorPageModule:()=>V});var u=R(6895),d=R(4006),j=R(9064),l=R(3334),L=R(6588),P=R(6738);const m=[{path:"",component:L.A}];let $=(()=>{class Z{}return Z.\u0275fac=function(re){return new(re||Z)},Z.\u0275mod=P.oAB({type:Z}),Z.\u0275inj=P.cJS({imports:[[l.Bz.forChild(m)],l.Bz]}),Z})();var ue=R(8936);let V=(()=>{class Z{}return Z.\u0275fac=function(re){return new(re||Z)},Z.\u0275mod=P.oAB({type:Z}),Z.\u0275inj=P.cJS({imports:[[u.ez,d.u5,j.Pc,$,ue.e]]}),Z})()},6588:(Tn,Je,R)=>{"use strict";R.d(Je,{A:()=>$});var u=R(6099),d=R(6799),j=R(6738),l=R(9064),L=R(6895),P=R(6585);function m(ue,V){if(1&ue&&(j.TgZ(0,"div"),j._uU(1),j._UZ(2,"app-poi-list",10),j.qZA()),2&ue){const Z=j.oxw();j.xp6(1),j.hij(" Items Parsed: ",Z.fileData.length," "),j.xp6(1),j.Q6J("poiList",Z.fileData)}}let $=(()=>{class ue{constructor(Z,K){this.modalController=Z,this.refData=K}ngOnInit(){}previewFile(){var Z=this;return(0,u.Z)(function*(){yield Z.loadFile(!1)})()}cancel(){var Z=this;return(0,u.Z)(function*(){yield Z.modalController.dismiss(Z.fileData)})()}loadFile(Z=!0){var K=this;return(0,u.Z)(function*(){const re=new FileReader;re.onload=()=>{let ge=JSON.parse(re.result);for(let xe of ge)xe.ID="imp_"+xe.ID;K.fileData=K.refData.hydrateCompactPOIList(ge),Z&&K.modalController.dismiss(K.fileData)},re.onerror=()=>{},re.readAsText(document.getElementById("file-upload").files[0])})()}add(){var Z=this;return(0,u.Z)(function*(){Z.modalController.dismiss(Z.fileData)})()}}return ue.\u0275fac=function(Z){return new(Z||ue)(j.Y36(l.IN),j.Y36(d.W))},ue.\u0275cmp=j.Xpm({type:ue,selectors:[["app-layer-editor"]],decls:27,vars:1,consts:[[1,"ion-padding"],[1,"upload"],["name","file","aria-label","file","slot","start"],["type","file","required","","id","file-upload",3,"change"],[4,"ngIf"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","checkmark-circle-outline","slot","end"],[3,"poiList"]],template:function(Z,K){1&Z&&(j.TgZ(0,"ion-header"),j.TgZ(1,"ion-toolbar"),j.TgZ(2,"ion-title"),j._uU(3," Edit Layer "),j.qZA(),j.qZA(),j.qZA(),j.TgZ(4,"ion-content",0),j.TgZ(5,"p"),j._uU(6,"POI layers are used to preview data from other Open Data sources. "),j.qZA(),j.TgZ(7,"p"),j._uU(8,"Select a POI layer JSON file: "),j.qZA(),j.TgZ(9,"div"),j.TgZ(10,"label",1),j.TgZ(11,"ion-button"),j._UZ(12,"ion-icon",2),j.TgZ(13,"ion-label"),j._uU(14,"Choose File.."),j.qZA(),j.qZA(),j.TgZ(15,"input",3),j.NdJ("change",function(){return K.previewFile()}),j.qZA(),j.qZA(),j.qZA(),j.YNc(16,m,3,2,"div",4),j.qZA(),j.TgZ(17,"ion-footer"),j.TgZ(18,"ion-toolbar"),j.TgZ(19,"ion-buttons",5),j.TgZ(20,"ion-button",6),j.NdJ("click",function(){return K.cancel()}),j._UZ(21,"ion-icon",7),j._uU(22," Cancel "),j.qZA(),j.qZA(),j.TgZ(23,"ion-buttons",8),j.TgZ(24,"ion-button",6),j.NdJ("click",function(){return K.add()}),j._uU(25," Add "),j._UZ(26,"ion-icon",9),j.qZA(),j.qZA(),j.qZA(),j.qZA()),2&Z&&(j.xp6(16),j.Q6J("ngIf",K.fileData&&K.fileData.length>0))},directives:[l.Gu,l.sr,l.wd,l.W2,l.YG,l.gu,l.Q$,L.O5,P.o,l.fr,l.Sm],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]}),ue})()},3399:(Tn,Je,R)=>{"use strict";R.d(Je,{H:()=>tr});var u=R(3855),d=R(6738),j=R(9064),l=R(6099),L=R(3912),P=R(129),m=R(4006),$=R(6895);function ue(ie,X){if(1&ie&&(d.TgZ(0,"ion-select-option",13),d._uU(1),d.qZA()),2&ie){const F=X.$implicit;d.Q6J("value",F.ID),d.xp6(1),d.Oqu(F.Title)}}function V(ie,X){if(1&ie&&(d.TgZ(0,"ion-select-option",16),d._uU(1),d.qZA()),2&ie){const F=X.$implicit;d.Q6J("value",X.index),d.xp6(1),d.Oqu(F.Title)}}function Z(ie,X){if(1&ie){const F=d.EpF();d.TgZ(0,"ion-item"),d.TgZ(1,"ion-label",2),d._uU(2,"Journey Stage"),d.qZA(),d.TgZ(3,"ion-select",3),d.NdJ("ngModelChange",function(Te){return d.CHM(F),d.oxw().selectedStageIndex=Te}),d.TgZ(4,"ion-select-option",14),d._uU(5,"Create a Journey Stage"),d.qZA(),d.YNc(6,V,2,2,"ion-select-option",15),d.qZA(),d.qZA()}if(2&ie){const F=d.oxw();d.xp6(3),d.Q6J("ngModel",F.selectedStageIndex),d.xp6(3),d.Q6J("ngForOf",F.journeyManager.getJourneyStages(F.selectedJourneyID))}}function K(ie,X){if(1&ie){const F=d.EpF();d.TgZ(0,"ion-item"),d.TgZ(1,"ion-label",2),d._uU(2,"New Journey Name"),d.qZA(),d.TgZ(3,"ion-input",7),d.NdJ("ngModelChange",function(Te){return d.CHM(F),d.oxw().newJourneyName=Te}),d.qZA(),d.qZA()}if(2&ie){const F=d.oxw();d.xp6(3),d.Q6J("ngModel",F.newJourneyName)}}let re=(()=>{class ie{constructor(F,he,Te,We){this.appManager=F,this.navParams=he,this.journeyManager=Te,this.modalController=We,this.poi=this.navParams.get("poi"),this.waypoint=new P.kA,this.waypoint.Title=this.poi.AddressInfo.Title,this.waypoint.PoiIDs=[this.poi.ID],this.waypoint.PoiList=[];const mt=new P.Qp("charging",1);mt.Poi=this.poi,mt.PoiID=this.poi.ID,this.waypoint.PoiList.push(mt),this.newJourneyName="Trip to "+this.poi.AddressInfo.Title}cancel(){this.modalController.dismiss()}add(){if(null!=this.selectedJourneyID&&""!==this.selectedJourneyID)this.journeyManager.addJourneyWaypoint(this.selectedJourneyID,this.selectedStageIndex,this.waypoint);else{const F=new P.fw;F.ID=Date.now().toString(),""===this.newJourneyName&&(this.newJourneyName="New Journey"),F.Title=this.newJourneyName,this.journeyManager.addJourney(F,this.waypoint)}this.journeyManager.saveJourneys(),this.modalController.dismiss()}}return ie.\u0275fac=function(F){return new(F||ie)(d.Y36(u.c),d.Y36(j.X1),d.Y36(L.i),d.Y36(j.IN))},ie.\u0275cmp=d.Xpm({type:ie,selectors:[["ng-component"]],decls:39,vars:8,consts:[[1,"journeys-page","ion-padding"],[1,"banner"],["position","stacked"],[3,"ngModel","ngModelChange"],["value","","checked",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","text",3,"ngModel","ngModelChange"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","add","slot","end"],[3,"value"],["value",""],["checked","",3,"value",4,"ngFor","ngForOf"],["checked","",3,"value"]],template:function(F,he){1&F&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-title"),d._uU(3," Edit Favourite "),d.qZA(),d.qZA(),d.qZA(),d.TgZ(4,"ion-content",0),d.TgZ(5,"div",1),d.TgZ(6,"h1"),d._uU(7),d.qZA(),d.TgZ(8,"p"),d._uU(9),d.qZA(),d.qZA(),d.TgZ(10,"p"),d._uU(11," Add Charging Location as a Journey Waypoint "),d.qZA(),d.TgZ(12,"ion-item"),d.TgZ(13,"ion-label",2),d._uU(14,"Add to a Journey"),d.qZA(),d.TgZ(15,"ion-select",3),d.NdJ("ngModelChange",function(We){return he.selectedJourneyID=We}),d.TgZ(16,"ion-select-option",4),d._uU(17,"Create a New Journey"),d.qZA(),d.YNc(18,ue,2,2,"ion-select-option",5),d.qZA(),d.qZA(),d.YNc(19,Z,7,2,"ion-item",6),d.YNc(20,K,4,1,"ion-item",6),d.TgZ(21,"ion-item"),d.TgZ(22,"ion-label",2),d._uU(23,"Name for this step of your journey"),d.qZA(),d.TgZ(24,"ion-input",7),d.NdJ("ngModelChange",function(We){return he.waypoint.Title=We}),d.qZA(),d.qZA(),d.TgZ(25,"ion-item"),d.TgZ(26,"ion-label",2),d._uU(27,"Other Notes"),d.qZA(),d.TgZ(28,"ion-textarea",3),d.NdJ("ngModelChange",function(We){return he.waypoint.Notes=We}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(29,"ion-footer"),d.TgZ(30,"ion-toolbar"),d.TgZ(31,"ion-buttons",8),d.TgZ(32,"ion-button",9),d.NdJ("click",function(){return he.cancel()}),d._UZ(33,"ion-icon",10),d._uU(34," Cancel "),d.qZA(),d.qZA(),d.TgZ(35,"ion-buttons",11),d.TgZ(36,"ion-button",9),d.NdJ("click",function(){return he.add()}),d._uU(37," Add "),d._UZ(38,"ion-icon",12),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&F&&(d.xp6(7),d.Oqu(he.poi.AddressInfo.Title),d.xp6(2),d.Oqu(he.poi.AddressInfo.AddressLine1),d.xp6(6),d.Q6J("ngModel",he.selectedJourneyID),d.xp6(3),d.Q6J("ngForOf",he.journeyManager.journeys),d.xp6(1),d.Q6J("ngIf",he.selectedJourneyID),d.xp6(1),d.Q6J("ngIf",!he.selectedJourneyID),d.xp6(4),d.Q6J("ngModel",he.waypoint.Title),d.xp6(4),d.Q6J("ngModel",he.waypoint.Notes))},directives:[j.Gu,j.sr,j.wd,j.W2,j.Ie,j.Q$,j.t9,j.QI,m.JJ,m.On,j.n0,$.sg,$.O5,j.pK,j.j9,j.g2,j.fr,j.Sm,j.YG,j.gu],encapsulation:2}),ie})();var _e=R(7689);function ge(ie,X){if(1&ie){const F=d.EpF();d.TgZ(0,"ion-card"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-title",14),d._uU(3,"Preview"),d.qZA(),d.TgZ(4,"ion-buttons",15),d.TgZ(5,"ion-button",4),d.NdJ("click",function(){return d.CHM(F),d.oxw().rotateImage()}),d._UZ(6,"ion-icon",16),d.TgZ(7,"ion-label"),d._uU(8,"Rotate"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(9,"ion-card-content"),d.TgZ(10,"ion-list"),d.TgZ(11,"ion-item"),d.TgZ(12,"ion-label",17),d._uU(13,"Comment"),d.qZA(),d.TgZ(14,"ion-input",18),d.NdJ("ngModelChange",function(Te){return d.CHM(F),d.oxw().comment=Te}),d.qZA(),d.qZA(),d.qZA(),d._UZ(15,"img",19),d.qZA(),d.qZA()}if(2&ie){const F=d.oxw();d.xp6(14),d.Q6J("ngModel",F.comment)}}let xe=(()=>{class ie{constructor(F,he,Te,We,mt){this.navParams=F,this.appManager=he,this.nav=Te,this.modalController=We,this.logging=mt,this.processingQuality=.8,this.targetWidth=1024,this.targetHeight=800,this.mode=he.platformMode,this.chargePointId=this.navParams.get("id"),this.poi=this.navParams.get("poi"),this.comment=""}processNativeImageSource(F){let he=F;const Te=document.getElementById("img-upload-canvas"),We=Te.getContext("2d"),mt=new Image;mt.onload=()=>{this.logging.log("img load:"+mt.width),Te.width=mt.width,Te.height=mt.height,We.fillStyle="rgb(0,0,0)",We.fillRect(0,0,Te.width,Te.height),We.drawImage(mt,0,0,Te.width,Te.height),this.imgData=Te.toDataURL("image/png"),this.processImage()},mt.src=he}loadCameraOrLibraryImage(F=!1){this.logging.log("PWA mode: fetching image");const he=new FileReader;he.onload=()=>{this.imgData=he.result,this.processImage()},he.onerror=()=>{},he.readAsDataURL(document.getElementById("img-upload-media").files[0])}isBrowserMode(){return this.appManager.isPlatform("desktop")||this.appManager.isPlatform("hybrid")}processImage(){if(null!=this.imgData){const he=document.getElementById("img-upload-canvas"),Te=he.getContext("2d"),We=new Image;We.onload=()=>{he.width=We.width,he.height=We.height,Te.fillStyle="rgb(0,0,0)",Te.fillRect(0,0,he.width,he.height),Te.drawImage(We,0,0,he.width,he.height),this.refreshImageFromCanvas()},We.src=this.imgData}else this.logging.log("processImage: nothing to process.")}refreshImageFromCanvas(){const F=document.getElementById("img-upload-canvas");this.imgData=F.toDataURL("image/jpeg",.8),document.getElementById("preview").src=this.imgData}rotateImage(){const F=document.getElementById("img-upload-canvas");let he=new Image;he.src=F.toDataURL(),he.onload=()=>{let Te=F.height,We=F.width;F.width=Te,F.height=We,Te=F.height,We=F.width;const mt=F.getContext("2d");mt.save(),mt.translate(We,Te/We),mt.rotate(Math.PI/2),mt.drawImage(he,0,0),mt.restore(),he=null,this.refreshImageFromCanvas()}}performUpload(){var F=this;return(0,l.Z)(function*(){if(!F.imgData)return void(yield F.appManager.showToastNotification("Select an image to upload."));const he={chargePointID:F.chargePointId,comment:F.comment,imageDataBase64:F.imgData};yield F.appManager.showLoadingProgress("Uploading photo..");try{yield F.appManager.submitMediaItem(he),F.appManager.dismissLoadingProgress().then(()=>{F.appManager.showToastNotification("Upload completed"),F.modalController.dismiss()}),F.appManager.analytics.appEvent("MediaUpload","Completed")}catch{yield F.appManager.dismissLoadingProgress(),yield F.appManager.showToastNotification("Upload failed, please try again."),F.appManager.analytics.appEvent("MediaUpload","Failed")}})()}cancel(){var F=this;return(0,l.Z)(function*(){yield F.modalController.dismiss()})()}}return ie.\u0275fac=function(F){return new(F||ie)(d.Y36(j.X1),d.Y36(u.c),d.Y36(j.SH),d.Y36(j.IN),d.Y36(_e.z))},ie.\u0275cmp=d.Xpm({type:ie,selectors:[["ng-component"]],decls:32,vars:3,consts:[[1,"media-upload"],[1,"ion-padding"],[1,"banner"],[1,"upload"],[3,"click"],["name","camera","aria-label","camera","slot","start"],["type","file","required","","id","img-upload-media",3,"change"],["inputFile",""],["id","img-upload-canvas",2,"display","none","width","500","height","500","border","1px solid red"],[4,"ngIf"],["slot","secondary"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],["slot","start"],["slot","end"],["name","refresh","slot","start"],["position","floating"],["type","text","placeholder","(optional comment)",3,"ngModel","ngModelChange"],["id","preview",2,"max-width","500px"]],template:function(F,he){if(1&F){const Te=d.EpF();d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-title"),d._uU(3," Share Photo "),d.qZA(),d.qZA(),d.qZA(),d.TgZ(4,"ion-content",0),d.TgZ(5,"div",1),d.TgZ(6,"div",2),d.TgZ(7,"h1"),d._uU(8),d.qZA(),d.TgZ(9,"p"),d._uU(10),d.qZA(),d.qZA(),d.TgZ(11,"p"),d._uU(12,"You can upload a photo from your device or take a new photo: "),d.qZA(),d.TgZ(13,"div",3),d.TgZ(14,"ion-button",4),d.NdJ("click",function(){return d.CHM(Te),d.MAs(19).click()}),d._UZ(15,"ion-icon",5),d.TgZ(16,"ion-label"),d._uU(17,"Choose Photo.."),d.qZA(),d.qZA(),d.TgZ(18,"input",6,7),d.NdJ("change",function(){return he.loadCameraOrLibraryImage()}),d.qZA(),d.qZA(),d._UZ(20,"canvas",8),d.YNc(21,ge,16,1,"ion-card",9),d.qZA(),d.qZA(),d.TgZ(22,"ion-footer"),d.TgZ(23,"ion-toolbar"),d.TgZ(24,"ion-buttons",10),d.TgZ(25,"ion-button",4),d.NdJ("click",function(){return he.cancel()}),d._UZ(26,"ion-icon",11),d._uU(27," Cancel "),d.qZA(),d.qZA(),d.TgZ(28,"ion-buttons",12),d.TgZ(29,"ion-button",4),d.NdJ("click",function(){return he.performUpload()}),d._uU(30," Upload "),d._UZ(31,"ion-icon",13),d.qZA(),d.qZA(),d.qZA(),d.qZA()}2&F&&(d.xp6(8),d.Oqu(he.poi.AddressInfo.Title),d.xp6(2),d.Oqu(he.poi.AddressInfo.AddressLine1),d.xp6(11),d.Q6J("ngIf",null!=he.imgData))},directives:[j.Gu,j.sr,j.wd,j.W2,j.YG,j.gu,j.Q$,$.O5,j.PM,j.Sm,j.FN,j.q_,j.Ie,j.pK,j.j9,m.JJ,m.On,j.fr],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]}),ie})();var je=R(3334);function nt(ie,X){if(1&ie&&(d.TgZ(0,"ion-select-option",19),d._uU(1),d.qZA()),2&ie){const F=X.$implicit;d.Q6J("value",F.ID),d.xp6(1),d.Oqu(F.Title)}}function Fe(ie,X){if(1&ie&&(d.TgZ(0,"ion-select-option",19),d._uU(1),d.qZA()),2&ie){const F=X.$implicit;d.Q6J("value",F.ID),d.xp6(1),d.Oqu(F.Title)}}let ke=(()=>{class ie{constructor(F,he,Te,We,mt,Dt,Xe,kt){this.navParams=F,this.appManager=he,this.nav=Te,this.zone=We,this.loadingController=mt,this.modalController=Dt,this.logging=Xe,this.router=kt,this.commentModel={ChargePointID:this.navParams.get("id"),Comment:"",CheckinStatusTypeID:10,CommentTypeID:10,Rating:null},this.poi=this.navParams.get("poi"),this.commentTypes=he.referenceDataManager.getCommentTypes(!0,!0),this.checkinTypes=he.referenceDataManager.getCheckinStatusTypes(!0,!0)}onPageWillEnter(){}cancel(){this.modalController.dismiss()}add(){var F=this;return(0,l.Z)(function*(){const he=yield F.loadingController.create({message:"Sending .."});yield he.present(),(yield F.appManager.submitComment(F.commentModel).catch(We=>{F.appManager.showToastNotification("There was a problem submitting your comment."),F.loadingController.dismiss(),F.appManager.analytics.appEvent("Comment","Failed")}))&&(F.logging.log("Comment submitted"),yield he.dismiss(),yield F.modalController.dismiss(),F.appManager.analytics.appEvent("Comment","Submitted"))})()}}return ie.\u0275fac=function(F){return new(F||ie)(d.Y36(j.X1),d.Y36(u.c),d.Y36(j.SH),d.Y36(d.R0b),d.Y36(j.HT),d.Y36(j.IN),d.Y36(_e.z),d.Y36(je.F0))},ie.\u0275cmp=d.Xpm({type:ie,selectors:[["ng-component"]],decls:53,vars:8,consts:[["color","primary"],[1,"comment-page","ion-padding"],[1,"banner"],[1,"ion-padding"],["position","stacked"],[3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","(optional comment)",3,"ngModel","ngModelChange"],["value","5"],["value","4"],["value","3"],["value","2"],["value","1"],["value",""],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],[3,"value"]],template:function(F,he){1&F&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar",0),d.TgZ(2,"ion-title"),d._uU(3," Add Comment "),d.qZA(),d.qZA(),d.qZA(),d.TgZ(4,"ion-content",1),d.TgZ(5,"div",2),d.TgZ(6,"h1"),d._uU(7),d.qZA(),d.TgZ(8,"p"),d._uU(9),d.qZA(),d.qZA(),d.TgZ(10,"p",3),d._uU(11,"Recent Check-ins are a big help to other drivers when planning their journey. Tell everyone what you thought about this charging location. "),d.qZA(),d.TgZ(12,"ion-list"),d.TgZ(13,"ion-item"),d.TgZ(14,"ion-label",4),d._uU(15,"Comment Type"),d.qZA(),d.TgZ(16,"ion-select",5),d.NdJ("ngModelChange",function(We){return he.commentModel.CommentTypeID=We}),d.YNc(17,nt,2,2,"ion-select-option",6),d.qZA(),d.qZA(),d.TgZ(18,"ion-item"),d.TgZ(19,"ion-label",4),d._uU(20,"What Did You Think?"),d.qZA(),d.TgZ(21,"ion-input",7),d.NdJ("ngModelChange",function(We){return he.commentModel.Comment=We}),d.qZA(),d.qZA(),d.TgZ(22,"ion-item"),d.TgZ(23,"ion-label",4),d._uU(24,"Did You Successfully Charge?"),d.qZA(),d.TgZ(25,"ion-select",5),d.NdJ("ngModelChange",function(We){return he.commentModel.CheckinStatusTypeID=We}),d.YNc(26,Fe,2,2,"ion-select-option",6),d.qZA(),d.qZA(),d.TgZ(27,"ion-item"),d.TgZ(28,"ion-label",4),d._uU(29,"Your Rating"),d.qZA(),d.TgZ(30,"ion-select",5),d.NdJ("ngModelChange",function(We){return he.commentModel.Rating=We}),d.TgZ(31,"ion-select-option",8),d._uU(32,"5 - Excellent"),d.qZA(),d.TgZ(33,"ion-select-option",9),d._uU(34,"4 - Good"),d.qZA(),d.TgZ(35,"ion-select-option",10),d._uU(36,"3 - Average"),d.qZA(),d.TgZ(37,"ion-select-option",11),d._uU(38,"2 - Not Good"),d.qZA(),d.TgZ(39,"ion-select-option",12),d._uU(40,"1 - Bad"),d.qZA(),d.TgZ(41,"ion-select-option",13),d._uU(42,"Not Rated"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(43,"ion-footer"),d.TgZ(44,"ion-toolbar"),d.TgZ(45,"ion-buttons",14),d.TgZ(46,"ion-button",15),d.NdJ("click",function(){return he.cancel()}),d._UZ(47,"ion-icon",16),d._uU(48," Cancel "),d.qZA(),d.qZA(),d.TgZ(49,"ion-buttons",17),d.TgZ(50,"ion-button",15),d.NdJ("click",function(){return he.add()}),d._uU(51," Submit "),d._UZ(52,"ion-icon",18),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&F&&(d.xp6(7),d.Oqu(he.poi.AddressInfo.Title),d.xp6(2),d.Oqu(he.poi.AddressInfo.AddressLine1),d.xp6(7),d.Q6J("ngModel",he.commentModel.CommentTypeID),d.xp6(1),d.Q6J("ngForOf",he.commentTypes),d.xp6(4),d.Q6J("ngModel",he.commentModel.Comment),d.xp6(4),d.Q6J("ngModel",he.commentModel.CheckinStatusTypeID),d.xp6(1),d.Q6J("ngForOf",he.checkinTypes),d.xp6(4),d.Q6J("ngModel",he.commentModel.Rating))},directives:[j.Gu,j.sr,j.wd,j.W2,j.q_,j.Ie,j.Q$,j.t9,j.QI,m.JJ,m.On,$.sg,j.n0,j.pK,j.j9,j.fr,j.Sm,j.YG,j.gu],encapsulation:2}),ie})();var Ne=R(2951),$e=R(9698),Re=R(9492),_t=R(4508),Ge=R(6579),ot=R(9397),yt=R(1099);function wt(ie,X){if(1&ie&&(d.TgZ(0,"div"),d.TgZ(1,"small"),d._uU(2),d.qZA(),d.qZA()),2&ie){const F=d.oxw(2);d.xp6(2),d.Oqu(F.connectionSummary)}}function xt(ie,X){if(1&ie&&(d.TgZ(0,"div"),d.TgZ(1,"small"),d._uU(2),d.qZA(),d.qZA()),2&ie){const F=d.oxw(2);d.xp6(2),d.Oqu(F.poi.OperatorInfo.Title)}}function dt(ie,X){if(1&ie){const F=d.EpF();d.ynx(0),d.TgZ(1,"ion-button",28),d.NdJ("click",function(){return d.CHM(F),d.oxw(2).addFavourite()}),d._UZ(2,"ion-icon",29),d.TgZ(3,"ion-label"),d._uU(4,"Favourite"),d.qZA(),d.qZA(),d.TgZ(5,"ion-button",13),d.NdJ("click",function(){return d.CHM(F),d.oxw(2).edit()}),d._UZ(6,"ion-icon",30),d.TgZ(7,"ion-label"),d._uU(8,"Edit"),d.qZA(),d.qZA(),d.BQk()}}function At(ie,X){if(1&ie){const F=d.EpF();d.ynx(0),d.TgZ(1,"ion-button",31),d.NdJ("click",function(){return d.CHM(F),d.oxw(2).launchNavigation()}),d._UZ(2,"ion-icon",32),d.TgZ(3,"ion-label"),d._uU(4,"Navigate"),d.qZA(),d.qZA(),d.BQk()}}function Vt(ie,X){if(1&ie){const F=d.EpF();d.ynx(0),d.TgZ(1,"ion-button",33),d.NdJ("click",function(){return d.CHM(F),d.oxw(2).addComment()}),d._UZ(2,"ion-icon",34),d.TgZ(3,"ion-label"),d._uU(4,"Add Comment"),d.qZA(),d.qZA(),d.BQk()}}function Un(ie,X){if(1&ie){const F=d.EpF();d.ynx(0),d.TgZ(1,"ion-button",35),d.NdJ("click",function(){return d.CHM(F),d.oxw(2).addMedia()}),d._UZ(2,"ion-icon",36),d.TgZ(3,"ion-label"),d._uU(4," Add Photo"),d.qZA(),d.qZA(),d.BQk()}}function St(ie,X){if(1&ie&&(d.TgZ(0,"div"),d._uU(1),d.qZA()),2&ie){const F=d.oxw(4);d.xp6(1),d.hij(" ",F.poi.AddressInfo.AddressLine1,"")}}function $t(ie,X){if(1&ie&&(d.TgZ(0,"div"),d._uU(1),d.qZA()),2&ie){const F=d.oxw(4);d.xp6(1),d.hij(" ",F.poi.AddressInfo.AddressLine2,"")}}function zt(ie,X){if(1&ie&&(d.TgZ(0,"div"),d._uU(1),d.qZA()),2&ie){const F=d.oxw(4);d.xp6(1),d.hij(" ",F.poi.AddressInfo.Town,"")}}function Ht(ie,X){if(1&ie&&(d.TgZ(0,"div"),d._uU(1),d.qZA()),2&ie){const F=d.oxw(4);d.xp6(1),d.hij(" ",F.poi.AddressInfo.StateOrProvince,"")}}function en(ie,X){if(1&ie&&(d.TgZ(0,"div"),d._uU(1),d.qZA()),2&ie){const F=d.oxw(4);d.xp6(1),d.hij(" ",F.poi.AddressInfo.Postcode,"")}}function Kt(ie,X){if(1&ie&&(d.TgZ(0,"div"),d._uU(1),d.qZA()),2&ie){const F=d.oxw(4);d.xp6(1),d.hij(" ",F.poi.AddressInfo.Country.Title,"")}}function Wt(ie,X){if(1&ie&&(d.TgZ(0,"p"),d._uU(1),d.qZA()),2&ie){const F=d.oxw(4);d.xp6(1),d.hij(" ",F.poi.AddressInfo.AccessComments," ")}}function Yt(ie,X){if(1&ie&&(d.TgZ(0,"p"),d._UZ(1,"ion-icon",48),d.TgZ(2,"span",45),d._uU(3),d.qZA(),d.qZA()),2&ie){const F=d.oxw(4);d.xp6(3),d.Oqu(F.poi.AddressInfo.ContactTelephone1)}}function qt(ie,X){if(1&ie&&(d.TgZ(0,"p"),d._UZ(1,"ion-icon",48),d.TgZ(2,"span",45),d._uU(3),d.qZA(),d.qZA()),2&ie){const F=d.oxw(4);d.xp6(3),d.Oqu(F.poi.AddressInfo.ContactTelephone2)}}function Gt(ie,X){if(1&ie&&(d.TgZ(0,"p"),d._UZ(1,"ion-icon",49),d.TgZ(2,"span",45),d._uU(3),d.qZA(),d.qZA()),2&ie){const F=d.oxw(4);d.xp6(3),d.Oqu(F.poi.AddressInfo.ContactEmail)}}function ft(ie,X){if(1&ie&&(d.TgZ(0,"p"),d._UZ(1,"ion-icon",50),d.TgZ(2,"span",45),d.TgZ(3,"a",51),d._uU(4),d.qZA(),d.qZA(),d.qZA()),2&ie){const F=d.oxw(4);d.xp6(3),d.s9C("href",F.poi.AddressInfo.RelatedURL,d.LSH),d.xp6(1),d.Oqu(F.poi.AddressInfo.RelatedURL)}}function Ut(ie,X){if(1&ie&&(d.TgZ(0,"ion-card"),d.TgZ(1,"ion-card-header"),d._UZ(2,"ion-icon",43),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.TgZ(5,"ion-card-content"),d.TgZ(6,"ion-grid"),d.TgZ(7,"ion-row"),d.TgZ(8,"ion-col"),d.TgZ(9,"ion-label",44),d._uU(10),d.ALo(11,"translate"),d.qZA(),d.TgZ(12,"div",45),d.YNc(13,St,2,1,"div",0),d.YNc(14,$t,2,1,"div",0),d.YNc(15,zt,2,1,"div",0),d.YNc(16,Ht,2,1,"div",0),d.YNc(17,en,2,1,"div",0),d.YNc(18,Kt,2,1,"div",0),d.qZA(),d.qZA(),d.TgZ(19,"ion-col"),d.YNc(20,Wt,2,1,"p",0),d.YNc(21,Yt,4,1,"p",0),d.YNc(22,qt,4,1,"p",0),d.YNc(23,Gt,4,1,"p",0),d.YNc(24,ft,5,2,"p",0),d.qZA(),d.qZA(),d.TgZ(25,"ion-row"),d.TgZ(26,"ion-col"),d._UZ(27,"ion-icon",46),d.TgZ(28,"ion-label",47),d._uU(29),d.ALo(30,"number"),d.ALo(31,"number"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&ie){const F=d.oxw(3);d.xp6(3),d.hij(" ",d.lcZ(4,15,"ocm.details.location.sectionTitle")," "),d.xp6(7),d.hij(" ",d.lcZ(11,17,"ocm.details.location.address"),""),d.xp6(3),d.Q6J("ngIf",F.poi.AddressInfo.AddressLine1),d.xp6(1),d.Q6J("ngIf",F.poi.AddressInfo.AddressLine2),d.xp6(1),d.Q6J("ngIf",F.poi.AddressInfo.Town),d.xp6(1),d.Q6J("ngIf",F.poi.AddressInfo.StateOrProvince),d.xp6(1),d.Q6J("ngIf",F.poi.AddressInfo.Postcode),d.xp6(1),d.Q6J("ngIf",F.poi.AddressInfo.Country),d.xp6(2),d.Q6J("ngIf",F.poi.AddressInfo.AccessComments),d.xp6(1),d.Q6J("ngIf",F.poi.AddressInfo.ContactTelephone1),d.xp6(1),d.Q6J("ngIf",F.poi.AddressInfo.ContactTelephone2),d.xp6(1),d.Q6J("ngIf",F.poi.AddressInfo.ContactEmail),d.xp6(1),d.Q6J("ngIf",F.poi.AddressInfo.RelatedURL),d.xp6(5),d.AsE(" ",d.xi3(30,19,F.poi.AddressInfo.Latitude,"1.1-13")," , ",d.xi3(31,22,F.poi.AddressInfo.Longitude,"1.1-13")," ")}}function On(ie,X){if(1&ie&&(d.TgZ(0,"p"),d.TgZ(1,"span",44),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"span",45),d._uU(5),d.qZA(),d.qZA()),2&ie){const F=d.oxw(3);d.xp6(2),d.hij("",d.lcZ(3,2,"ocm.details.numberOfPoints"),":"),d.xp6(3),d.Oqu(F.poi.NumberOfPoints)}}function fn(ie,X){if(1&ie&&(d.TgZ(0,"p"),d.TgZ(1,"span",44),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"span",45),d._uU(5),d.qZA(),d.qZA()),2&ie){const F=d.oxw(3);d.xp6(2),d.hij("",d.lcZ(3,2,"ocm.details.operationalStatus"),":"),d.xp6(3),d.hij(" ",F.poi.StatusType.Title," ")}}function Gn(ie,X){if(1&ie&&(d.TgZ(0,"p"),d.TgZ(1,"span",44),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"span",45),d._uU(5),d.qZA(),d.qZA()),2&ie){const F=d.oxw(3);d.xp6(2),d.hij("",d.lcZ(3,2,"ocm.details.usageType"),":"),d.xp6(3),d.Oqu(F.poi.UsageType.Title)}}function ei(ie,X){if(1&ie&&(d.TgZ(0,"p"),d.TgZ(1,"span",44),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"span",45),d._uU(5),d.qZA(),d.qZA()),2&ie){const F=d.oxw(3);d.xp6(2),d.hij("",d.lcZ(3,2,"ocm.details.usageCost"),":"),d.xp6(3),d.hij(" ",F.poi.UsageCost,"")}}function $i(ie,X){if(1&ie&&(d.TgZ(0,"p"),d._UZ(1,"br"),d._uU(2),d.ALo(3,"translate"),d._UZ(4,"br"),d.TgZ(5,"span",45),d._uU(6),d.qZA(),d.qZA()),2&ie){const F=d.oxw(3);d.xp6(2),d.hij("",d.lcZ(3,2,"ocm.details.generalComments"),": "),d.xp6(4),d.Oqu(F.poi.GeneralComments)}}function sr(ie,X){if(1&ie&&(d.TgZ(0,"p"),d._UZ(1,"ion-icon",54),d._uU(2),d.qZA()),2&ie){const F=d.oxw(4);d.xp6(2),d.hij(" ",F.poi.OperatorInfo.WebsiteURL," ")}}function zi(ie,X){if(1&ie&&(d.TgZ(0,"p"),d._UZ(1,"ion-icon",49),d._uU(2),d.qZA()),2&ie){const F=d.oxw(4);d.xp6(2),d.hij(" ",F.poi.OperatorInfo.ContactEmail," ")}}function yi(ie,X){if(1&ie&&(d.TgZ(0,"p"),d._UZ(1,"ion-icon",49),d._uU(2),d.qZA()),2&ie){const F=d.oxw(4);d.xp6(2),d.hij(" ",F.poi.OperatorInfo.FaultReportEmail," ")}}function ji(ie,X){if(1&ie&&(d.TgZ(0,"ion-card"),d.TgZ(1,"ion-card-header"),d._UZ(2,"ion-icon",52),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.TgZ(5,"ion-card-content"),d.TgZ(6,"div",45),d.TgZ(7,"p",53),d._uU(8),d.qZA(),d.YNc(9,sr,3,1,"p",0),d.YNc(10,zi,3,1,"p",0),d.YNc(11,yi,3,1,"p",0),d.qZA(),d.qZA(),d.qZA()),2&ie){const F=d.oxw(3);d.xp6(3),d.hij(" ",d.lcZ(4,5,"ocm.details.operator.sectionTitle")," "),d.xp6(5),d.hij(" ",F.poi.OperatorInfo.Title," "),d.xp6(1),d.Q6J("ngIf",F.poi.OperatorInfo.WebsiteURL),d.xp6(1),d.Q6J("ngIf",null!=F.poi.OperatorInfo.ContactEmail),d.xp6(1),d.Q6J("ngIf",null!=F.poi.OperatorInfo.FaultReportEmail&&F.poi.OperatorInfo.FaultReportEmail!=F.poi.OperatorInfo.ContactEmail)}}function _i(ie,X){if(1&ie){const F=d.EpF();d.TgZ(0,"a",56),d.NdJ("click",function(){d.CHM(F);const Te=d.oxw(4);return Te.launchURL(Te.poi.DataProvider.WebsiteURL)}),d._uU(1),d.qZA()}if(2&ie){const F=d.oxw(4);d.xp6(1),d.Oqu(F.poi.DataProvider.WebsiteURL)}}function xi(ie,X){if(1&ie&&(d.TgZ(0,"div",45),d.TgZ(1,"h3"),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.TgZ(4,"p"),d._uU(5),d.qZA(),d.YNc(6,_i,2,1,"a",55),d.TgZ(7,"p"),d._uU(8),d.qZA(),d.qZA()),2&ie){const F=d.oxw(3);d.xp6(2),d.hij(" ",d.lcZ(3,4,"ocm.details.dataProvider.sectionTitle")," "),d.xp6(3),d.Oqu(null==F.poi.DataProvider?null:F.poi.DataProvider.Title),d.xp6(1),d.Q6J("ngIf",F.poi.DataProvider.WebsiteURL),d.xp6(2),d.Oqu(null==F.poi.DataProvider?null:F.poi.DataProvider.License)}}function Qt(ie,X){if(1&ie&&(d.TgZ(0,"div",37),d.YNc(1,Ut,32,25,"ion-card",0),d.TgZ(2,"ion-card"),d.TgZ(3,"ion-card-header"),d._UZ(4,"ion-icon",38),d._uU(5),d.ALo(6,"translate"),d.qZA(),d.TgZ(7,"ion-card-content"),d.YNc(8,On,6,4,"p",0),d._UZ(9,"app-equipment-details",39),d.qZA(),d.qZA(),d.TgZ(10,"ion-card"),d.TgZ(11,"ion-card-header"),d._UZ(12,"ion-icon",40),d._uU(13," Usage Restrictions "),d.qZA(),d.TgZ(14,"ion-card-content"),d.YNc(15,fn,6,4,"p",0),d.YNc(16,Gn,6,4,"p",0),d.YNc(17,ei,6,4,"p",0),d.YNc(18,$i,7,4,"p",0),d.qZA(),d.qZA(),d.YNc(19,ji,12,7,"ion-card",0),d.TgZ(20,"ion-card"),d.TgZ(21,"ion-card-header"),d._UZ(22,"ion-icon",41),d._uU(23),d.ALo(24,"translate"),d.qZA(),d.TgZ(25,"ion-card-content"),d.YNc(26,xi,9,6,"div",42),d.qZA(),d.qZA(),d.qZA()),2&ie){const F=d.oxw(2);d.xp6(1),d.Q6J("ngIf",F.poi.AddressInfo),d.xp6(4),d.hij(" ",d.lcZ(6,11,"ocm.details.equipment.sectionTitle")," "),d.xp6(3),d.Q6J("ngIf",null!=F.poi.NumberOfPoints),d.xp6(1),d.Q6J("item",F.poi),d.xp6(6),d.Q6J("ngIf",null!=F.poi.StatusType),d.xp6(1),d.Q6J("ngIf",null!=F.poi.UsageType),d.xp6(1),d.Q6J("ngIf",null!=F.poi.UsageCost),d.xp6(1),d.Q6J("ngIf",null!=F.poi.GeneralComments),d.xp6(1),d.Q6J("ngIf",F.poi.OperatorInfo),d.xp6(4),d.hij(" ",d.lcZ(24,13,"ocm.details.advancedDetails")," "),d.xp6(3),d.Q6J("ngIf",F.poi.DataProvider)}}function Ye(ie,X){if(1&ie&&d._UZ(0,"img",60),2&ie){const F=d.oxw().$implicit;d.s9C("src",null==F.User?null:F.User.ProfileImageURL,d.LSH)}}function te(ie,X){if(1&ie&&(d.TgZ(0,"span"),d._uU(1),d.qZA()),2&ie){const F=d.oxw().$implicit;d.xp6(1),d.Oqu(F.User.Username)}}function Ae(ie,X){if(1&ie&&(d.TgZ(0,"span"),d._uU(1),d.qZA()),2&ie){const F=d.oxw().$implicit;d.xp6(1),d.Oqu(F.Username)}}function ut(ie,X){if(1&ie&&(d.TgZ(0,"p",45),d._uU(1),d.qZA()),2&ie){const F=d.oxw().$implicit;d.xp6(1),d.hij(" ",null==F.CommentType?null:F.CommentType.Title," ")}}function Pe(ie,X){if(1&ie&&(d.TgZ(0,"p"),d.TgZ(1,"span",44),d._uU(2,"Rating:"),d.qZA(),d.TgZ(3,"span",45),d._uU(4),d.qZA(),d.qZA()),2&ie){const F=d.oxw().$implicit;d.xp6(4),d.hij("",F.Rating," out of 5")}}function Nt(ie,X){1&ie&&(d.ynx(0),d._UZ(1,"ion-icon",61),d.BQk())}function me(ie,X){1&ie&&(d.ynx(0),d._UZ(1,"ion-icon",62),d.BQk())}function qe(ie,X){if(1&ie&&(d.TgZ(0,"p"),d.YNc(1,Nt,2,0,"ng-container",0),d.YNc(2,me,2,0,"ng-container",0),d._uU(3),d.qZA()),2&ie){const F=d.oxw().$implicit;d.xp6(1),d.Q6J("ngIf",!0===F.CheckinStatusType.IsPositive),d.xp6(1),d.Q6J("ngIf",!1===F.CheckinStatusType.IsPositive),d.xp6(1),d.hij(" ",F.CheckinStatusType.Title," ")}}function Rt(ie,X){if(1&ie&&(d.TgZ(0,"ion-card"),d.TgZ(1,"ion-item"),d.TgZ(2,"ion-avatar",19),d.YNc(3,Ye,1,1,"img",59),d.qZA(),d.TgZ(4,"ion-label"),d.YNc(5,te,2,1,"span",0),d.YNc(6,Ae,2,1,"span",0),d.qZA(),d.TgZ(7,"ion-label",20),d._uU(8),d.ALo(9,"date"),d.qZA(),d.qZA(),d.TgZ(10,"ion-card-content"),d.TgZ(11,"p"),d._uU(12),d.qZA(),d.YNc(13,ut,2,1,"p",42),d.YNc(14,Pe,5,1,"p",0),d.YNc(15,qe,4,3,"p",0),d.qZA(),d.qZA()),2&ie){const F=X.$implicit;d.xp6(3),d.Q6J("ngIf",F.User&&F.User.ProfileImageURL),d.xp6(2),d.Q6J("ngIf",F.User),d.xp6(1),d.Q6J("ngIf",!F.User),d.xp6(2),d.hij(" ",d.lcZ(9,8,F.DateCreated)," "),d.xp6(4),d.Oqu(F.Comment),d.xp6(1),d.Q6J("ngIf",10!=F.CommentTypeID),d.xp6(1),d.Q6J("ngIf",F.Rating),d.xp6(1),d.Q6J("ngIf",F.CheckinStatusType)}}function Xt(ie,X){if(1&ie&&(d.ynx(0),d.YNc(1,Rt,16,10,"ion-card",58),d.BQk()),2&ie){const F=d.oxw(3);d.xp6(1),d.Q6J("ngForOf",F.poi.UserComments)}}function Xn(ie,X){1&ie&&(d.TgZ(0,"p",21),d._uU(1),d.ALo(2,"translate"),d.qZA()),2&ie&&(d.xp6(1),d.hij(" ",d.lcZ(2,1,"ocm.details.commentsAndRatings.zeroComments")," "))}function Ki(ie,X){if(1&ie&&(d.TgZ(0,"div"),d.YNc(1,Xt,2,1,"ng-container",0),d.YNc(2,Xn,3,3,"p",57),d.qZA()),2&ie){const F=d.oxw(2);d.xp6(1),d.Q6J("ngIf",1==F.poi._hasComments),d.xp6(1),d.Q6J("ngIf",0==F.poi._hasComments)}}function Di(ie,X){if(1&ie&&d._UZ(0,"img",60),2&ie){const F=d.oxw().$implicit;d.s9C("src",null==F.User?null:F.User.ProfileImageURL,d.LSH)}}function gi(ie,X){if(1&ie&&(d.TgZ(0,"span"),d._uU(1),d.qZA()),2&ie){const F=d.oxw().$implicit;d.xp6(1),d.Oqu(F.User.Username)}}function fi(ie,X){if(1&ie&&(d.TgZ(0,"span"),d._uU(1),d.qZA()),2&ie){const F=d.oxw().$implicit;d.xp6(1),d.Oqu(F.Username)}}function Cr(ie,X){if(1&ie&&(d.TgZ(0,"ion-card"),d._UZ(1,"img",60),d.TgZ(2,"ion-item"),d.TgZ(3,"ion-avatar",19),d.YNc(4,Di,1,1,"img",59),d.qZA(),d.TgZ(5,"ion-label"),d.YNc(6,gi,2,1,"span",0),d.YNc(7,fi,2,1,"span",0),d.qZA(),d.TgZ(8,"ion-label",20),d._uU(9),d.ALo(10,"date"),d.qZA(),d.qZA(),d.TgZ(11,"ion-card-content"),d.TgZ(12,"p"),d._uU(13),d.qZA(),d.qZA(),d.qZA()),2&ie){const F=X.$implicit;d.xp6(1),d.s9C("src",F.ItemMediumURL,d.LSH),d.xp6(3),d.Q6J("ngIf",F.User&&F.User.ProfileImageURL),d.xp6(2),d.Q6J("ngIf",F.User),d.xp6(1),d.Q6J("ngIf",!F.User),d.xp6(2),d.hij(" ",d.lcZ(10,6,F.DateCreated)," "),d.xp6(4),d.Oqu(F.Comment)}}function Vi(ie,X){if(1&ie&&(d.TgZ(0,"div"),d.YNc(1,Cr,14,8,"ion-card",58),d.qZA()),2&ie){const F=d.oxw(3);d.xp6(1),d.Q6J("ngForOf",F.poi.MediaItems)}}function gr(ie,X){1&ie&&(d.TgZ(0,"div",21),d.TgZ(1,"p",63),d._uU(2),d.ALo(3,"translate"),d.qZA(),d.qZA()),2&ie&&(d.xp6(2),d.hij(" ",d.lcZ(3,1,"ocm.details.mediaItems.addPrompt"),""))}function Pi(ie,X){if(1&ie&&(d.TgZ(0,"div"),d.YNc(1,Vi,2,1,"div",0),d.YNc(2,gr,4,3,"div",57),d.qZA()),2&ie){const F=d.oxw(2);d.xp6(1),d.Q6J("ngIf",F.poi._hasPhotos),d.xp6(1),d.Q6J("ngIf",!F.poi._hasPhotos)}}function Br(ie,X){if(1&ie&&(d.TgZ(0,"p",64),d._uU(1),d.qZA()),2&ie){const F=d.oxw(2);d.xp6(1),d.hij(" ",F.json,"")}}function Ei(ie,X){if(1&ie){const F=d.EpF();d.TgZ(0,"div"),d.TgZ(1,"div",1),d.TgZ(2,"div",2),d.TgZ(3,"h2"),d._uU(4),d.qZA(),d.TgZ(5,"div"),d.TgZ(6,"small"),d._uU(7),d.qZA(),d.qZA(),d.YNc(8,wt,3,1,"div",0),d.YNc(9,xt,3,1,"div",0),d.TgZ(10,"ion-badge",3),d._uU(11),d.ALo(12,"number"),d.qZA(),d.qZA(),d.TgZ(13,"ion-fab",4),d.TgZ(14,"ion-fab-button"),d._UZ(15,"ion-icon",5),d.qZA(),d.TgZ(16,"ion-fab-list",6),d.TgZ(17,"ion-fab-button",7),d.NdJ("click",function(){return d.CHM(F),d.oxw().addComment()}),d._UZ(18,"ion-icon",8),d.qZA(),d.TgZ(19,"ion-fab-button",9),d.NdJ("click",function(){return d.CHM(F),d.oxw().addMedia()}),d._UZ(20,"ion-icon",10),d.qZA(),d.TgZ(21,"ion-fab-button",11),d.NdJ("click",function(){return d.CHM(F),d.oxw().addFavourite()}),d._UZ(22,"ion-icon",12),d.qZA(),d.TgZ(23,"ion-fab-button",13),d.NdJ("click",function(){return d.CHM(F),d.oxw().edit()}),d._UZ(24,"ion-icon",14),d.qZA(),d.TgZ(25,"ion-fab-button",15),d.NdJ("click",function(){return d.CHM(F),d.oxw().refresh()}),d._UZ(26,"ion-icon",16),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(27,"ion-refresher",17),d.NdJ("ionRefresh",function(Te){return d.CHM(F),d.oxw().refresh(Te)}),d._UZ(28,"ion-refresher-content",18),d.qZA(),d.TgZ(29,"ion-toolbar"),d.TgZ(30,"ion-buttons",19),d.YNc(31,dt,9,0,"ng-container",0),d.qZA(),d.TgZ(32,"ion-buttons",20),d.YNc(33,At,5,0,"ng-container",0),d.YNc(34,Vt,5,0,"ng-container",0),d.YNc(35,Un,5,0,"ng-container",0),d.qZA(),d.qZA(),d.TgZ(36,"div",21),d.TgZ(37,"ion-segment",22),d.NdJ("ngModelChange",function(Te){return d.CHM(F),d.oxw().selectedTab=Te}),d.TgZ(38,"ion-segment-button",23),d.TgZ(39,"ion-label"),d._uU(40," Details "),d.qZA(),d.qZA(),d.TgZ(41,"ion-segment-button",24),d.TgZ(42,"ion-label"),d._uU(43),d.qZA(),d.qZA(),d.TgZ(44,"ion-segment-button",25),d.TgZ(45,"ion-label"),d._uU(46),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.YNc(47,Qt,27,15,"div",26),d.YNc(48,Ki,3,2,"div",0),d.YNc(49,Pi,3,2,"div",0),d.YNc(50,Br,2,1,"p",27),d.qZA()}if(2&ie){const F=d.oxw();d.xp6(1),d.Udp("background-image",F.backdropImage?"url("+F.backdropImage+")":""),d.xp6(3),d.hij(" ",F.poi.AddressInfo.Title," "),d.xp6(3),d.hij("OCM-",F.poi.ID,""),d.xp6(1),d.Q6J("ngIf",F.connectionSummary),d.xp6(1),d.Q6J("ngIf",F.poi.OperatorInfo),d.xp6(2),d.Oqu(d.xi3(12,18,F.avgRating,"1.1-1")),d.xp6(20),d.Q6J("ngIf","location"==F.selectedTab),d.xp6(2),d.Q6J("ngIf","location"==F.selectedTab),d.xp6(1),d.Q6J("ngIf","comments"==F.selectedTab),d.xp6(1),d.Q6J("ngIf","media"==F.selectedTab),d.xp6(2),d.Q6J("ngModel",F.selectedTab),d.xp6(6),d.hij("Comments (",F.poi.UserComments?F.poi.UserComments.length:0,")"),d.xp6(3),d.hij(" Photos (",F.poi.MediaItems?F.poi.MediaItems.length:0,")"),d.xp6(1),d.Q6J("ngIf","location"==F.selectedTab),d.xp6(1),d.Q6J("ngIf","comments"==F.selectedTab),d.xp6(1),d.Q6J("ngIf","media"==F.selectedTab),d.xp6(1),d.Q6J("ngIf",1==F.appManager.isDebugMode)}}function Rr(ie,X){1&ie&&(d.TgZ(0,"div"),d.TgZ(1,"h2"),d._uU(2,"POI Not Found"),d.qZA(),d.TgZ(3,"p"),d._uU(4,"The POI details could not be loaded."),d.qZA(),d.qZA())}let _n=(()=>{class ie{constructor(F,he,Te,We,mt,Dt,Xe,kt){this.appManager=F,this.nav=he,this.translate=Te,this.logging=We,this.modalController=mt,this.actionSheetController=Dt,this.poiManager=Xe,this.router=kt,this.hasNavBar=!1}ngOnChanges(F){if(this.logging.log("In ngOnChanges of POI Details"),null!=this.poi&&null!=this.poi.AddressInfo){if(this.selectedTab="location",null!=this.poi.MediaItems&&this.poi.MediaItems.length>0){this.poi._hasPhotos=!0;for(let he of this.poi.MediaItems)he.ItemMediumURL=he.ItemThumbnailURL.replace(".thmb.",".medi.");this.backdropImage=this.poi.MediaItems[this.poi.MediaItems.length-1].ItemThumbnailURL.replace(".thmb.",".medi.")}else this.poi._hasPhotos=!1,this.backdropImage=null;if(null!=this.poi.UserComments&&this.poi.UserComments.length>0){this.poi._hasComments=!0;try{let he=this.poi.UserComments.filter(Te=>Te.Rating>0);if(he.length>0){let Te=0;for(let We of he)Te+=We.Rating;this.avgRating=Te/he.length}else this.avgRating=null}catch{}}else this.poi._hasComments=!1;if(this.poi.Connections&&this.poi.Connections.length>0){let he="";for(let Te of this.poi.Connections)-1==he.indexOf(Te.ConnectionType.Title)&&(he+=(""!=he?", ":"")+Te.ConnectionType.Title);this.connectionSummary=he}}}ngOnInit(){this.logging.log("In ngInit of POI Details")}get staticMapURL(){return"https://maps.googleapis.com/maps/api/staticmap?key="+(new Ne.X).googleMapsAPIKey+"&center="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude}get staticMapSize(){return 0===this.appManager.clientWidth?"240x100":this.appManager.clientWidth>=800?"640x100":this.appManager.clientWidth>=400?"400x100":"240x100"}continueAddComment(){var F=this;return(0,l.Z)(function*(){const he=yield F.modalController.create({component:ke,componentProps:{id:F.poi.ID,poi:F.poi}});setTimeout(()=>{F.refresh()},1e3),yield he.present()})()}addComment(){var F=this;return(0,l.Z)(function*(){if(F.appManager.isUserAuthenticated(!0))yield F.continueAddComment();else{const he=yield F.modalController.create({component:Re.F});he.onDidDismiss().then((0,l.Z)(function*(){F.appManager.isUserAuthenticated(!0)&&(yield F.continueAddComment())})),yield he.present()}})()}continueAddMedia(){var F=this;return(0,l.Z)(function*(){const he=yield F.modalController.create({component:xe,componentProps:{id:F.poi.ID,poi:F.poi}});he.onDidDismiss().then(()=>{setTimeout(()=>{F.refresh()},1e3)}),yield he.present()})()}addMedia(){var F=this;return(0,l.Z)(function*(){if(F.appManager.isUserAuthenticated(!0))yield F.continueAddMedia();else{const he=yield F.modalController.create({component:Re.F});he.onDidDismiss().then((0,l.Z)(function*(){F.appManager.isUserAuthenticated(!0)&&(yield F.continueAddMedia())})),yield he.present()}})()}addFavourite(){var F=this;return(0,l.Z)(function*(){yield(yield F.actionSheetController.create({header:"Add Favourite",buttons:[{text:"Add to Journey",handler:()=>{F.modalController.create({component:re,componentProps:{poi:F.poi}}).then(Te=>Te.present())}},{text:"Cancel",role:"cancel",handler:()=>{}}]})).present()})()}launchNavigation(){this.appManager.isPlatform("ios")?this.appManager.launchWebPage("https://maps.apple.com/?ll="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude):this.appManager.launchWebPage("https://maps.google.com/?q="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude)}launchURL(F){this.appManager.launchWebPage(F)}continueEdit(){var F=this;return(0,l.Z)(function*(){const he=yield F.modalController.create({component:_t.Y,componentProps:{id:F.poi.ID}});return he.onDidDismiss().then(Te=>{F.refresh()}),yield he.present()})()}edit(){var F=this;return(0,l.Z)(function*(){if(Ge.c.isFeatureEnabled("EDIT_POI"))if(F.appManager.isUserAuthenticated(!0))yield F.continueEdit();else{const he=yield F.modalController.create({component:Re.F});he.onDidDismiss().then((0,l.Z)(function*(){F.appManager.isUserAuthenticated(!0)&&(yield F.continueEdit())})),yield he.present()}else F.appManager.launchOCMWebPage("/poi/edit/"+F.poi.ID)})()}refresh(F=null){this.poi&&this.poiManager.getPOIById(this.poi.ID,!0,!0).then(he=>{he&&(this.poi=he,this.ngOnChanges(null)),F&&F.target.complete()})}}return ie.\u0275fac=function(F){return new(F||ie)(d.Y36(u.c),d.Y36(j.SH),d.Y36(ot.sK),d.Y36(_e.z),d.Y36(j.IN),d.Y36(j.BX),d.Y36($e.R),d.Y36(je.F0))},ie.\u0275cmp=d.Xpm({type:ie,selectors:[["poi-details"]],inputs:{poi:"poi"},features:[d.TTD],decls:2,vars:2,consts:[[4,"ngIf"],[1,"banner"],[1,"banner-content"],["color","primary","title","Average User Rating"],["vertical","top","horizontal","end","slot","fixed"],["name","add"],["side","bottom"],["title","Add a comment or charging check-in",3,"click"],["name","chatbubbles"],["title","Add a Photo",3,"click"],["name","camera"],["title","Add to Favourites",3,"click"],["name","star"],["title","Submit an Edit",3,"click"],["name","create"],["title","Refresh",3,"click"],["name","refresh"],["slot","fixed",3,"ionRefresh"],["pullingIcon","caret-down","pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refreshing..."],["slot","start"],["slot","end"],[1,"ion-padding"],[3,"ngModel","ngModelChange"],["value","location","selected",""],["value","comments"],["value","media"],["class","address-details",4,"ngIf"],["style","white-space: pre-wrap;",4,"ngIf"],["size","small","title","Add to Favourites",3,"click"],["name","star","slot","start"],["name","create","slot","start"],[3,"click"],["name","navigate","slot","start"],["size","small","title","Add a comment or charging check-in",3,"click"],["name","chatbubbles","slot","start"],["size","small","title","Add a Photo",3,"click"],["name","camera","slot","start"],[1,"address-details"],["name","battery-charging"],[3,"item"],["name","book"],["name","information-circle"],["class","details",4,"ngIf"],["name","map"],[1,"label"],[1,"details"],["name","pin"],[1,"details-minor"],["name","call"],["name","mail"],["name","globe"],["target","_system",3,"href"],["name","help-circle"],[1,"ion-padding-left"],["name","link"],["href","javascript:void(0)",3,"click",4,"ngIf"],["href","javascript:void(0)",3,"click"],["class","ion-padding",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"src",4,"ngIf"],[3,"src"],["name","checkmark-circle","color","success",2,"font-size","2em"],["name","close-circle","color","danger"],[1,"subtle"],[2,"white-space","pre-wrap"]],template:function(F,he){1&F&&(d.YNc(0,Ei,51,21,"div",0),d.YNc(1,Rr,5,0,"div",0)),2&F&&(d.Q6J("ngIf",null!=he.poi&&null!=he.poi.AddressInfo),d.xp6(1),d.Q6J("ngIf",null==he.poi||null==he.poi.AddressInfo))},directives:[$.O5,j.yp,j.IJ,j.W4,j.gu,j.zq,j.nJ,j.Wo,j.sr,j.Sm,j.YG,j.Q$,j.cJ,j.QI,m.JJ,m.On,j.GO,j.PM,j.Zi,j.FN,j.jY,j.Nd,j.wI,yt.B,$.sg,j.Ie,j.BJ],pipes:[$.JJ,ot.X$,$.uU],styles:[".banner[_ngcontent-%COMP%]{background-color:#4f712f;color:#ffffffec;padding:1em;text-shadow:#000 1px 1px 1px;min-height:180px;background-size:cover}.banner[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.banner-content[_ngcontent-%COMP%]{padding-right:48px}h3[_ngcontent-%COMP%]{font-weight:700}.label[_ngcontent-%COMP%]{color:#000;font-weight:700;font-size:12px}.details[_ngcontent-%COMP%]{color:#707d61;margin-left:1em;font-size:12px}.details-minor[_ngcontent-%COMP%]{color:#707d61;font-size:12px}p[_ngcontent-%COMP%]{display:block;padding:4px}ion-card-header[_ngcontent-%COMP%]{font-weight:700;padding-bottom:0}ion-card-content[_ngcontent-%COMP%]{padding-top:4px}"]}),ie})(),tr=(()=>{class ie{constructor(F,he,Te){this.modalController=F,this.navParams=he,this.appManager=Te,this.hasNavbar=!1,this.poi=this.navParams.get("item"),this.appManager.analytics.viewEvent("POIDetails")}close(){this.modalController.dismiss()}}return ie.\u0275fac=function(F){return new(F||ie)(d.Y36(j.IN),d.Y36(j.X1),d.Y36(u.c))},ie.\u0275cmp=d.Xpm({type:ie,selectors:[["ng-component"]],decls:11,vars:3,consts:[["color","primary"],["slot","start"],[3,"click"],["name","close","slot","icon-only"],[1,"poi-details"],[3,"poi"]],template:function(F,he){1&F&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar",0),d.TgZ(2,"ion-title"),d._uU(3),d.TgZ(4,"small"),d._uU(5),d.qZA(),d.qZA(),d.TgZ(6,"ion-buttons",1),d.TgZ(7,"ion-button",2),d.NdJ("click",function(){return he.close()}),d._UZ(8,"ion-icon",3),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(9,"ion-content",4),d._UZ(10,"poi-details",5),d.qZA()),2&F&&(d.xp6(3),d.hij(" ",he.poi.AddressInfo.Title," "),d.xp6(2),d.hij("OCM-",he.poi.ID,""),d.xp6(5),d.Q6J("poi",he.poi))},directives:[j.Gu,j.sr,j.wd,j.Sm,j.YG,j.gu,j.W2,_n],styles:['.left-col[_ngcontent-%COMP%]{float:left;width:50%;overflow:auto}.right-col[_ngcontent-%COMP%]{float:right;width:50%;overflow:auto}.row[_ngcontent-%COMP%]:after{content:"";display:table;clear:both;overflow:auto}.row[_ngcontent-%COMP%]{margin-bottom:1em}.subtle[_ngcontent-%COMP%]{color:silver}@media screen and (max-width: 768px){.left-col[_ngcontent-%COMP%]{float:none;width:100%}.right-col[_ngcontent-%COMP%]{margin-top:1em;float:none;width:100%}}.address-details[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:200px;width:auto}ion-label[_ngcontent-%COMP%]{overflow:inherit}ion-title[_ngcontent-%COMP%] > small[_ngcontent-%COMP%]{color:#ffffffbf}']}),ie})()},1948:(Tn,Je,R)=>{"use strict";R.r(Je),R.d(Je,{PoiEditorPageModule:()=>V});var u=R(6895),d=R(4006),j=R(3334),l=R(9064),L=R(4508),P=R(9397),m=R(8936),$=R(6738);const ue=[{path:"",component:L.Y}];let V=(()=>{class Z{}return Z.\u0275fac=function(re){return new(re||Z)},Z.\u0275mod=$.oAB({type:Z}),Z.\u0275inj=$.cJS({imports:[[u.ez,d.u5,l.Pc,P.aw,m.e,j.Bz.forChild(ue)]]}),Z})()},4508:(Tn,Je,R)=>{"use strict";R.d(Je,{Y:()=>ut});var u=R(6099),d=R(3855),j=R(2206),l=R(6579),L=R(9698),P=R(4781),m=R(6738),$=R(4120),ue=R(5906),V=R(553),Z=R(7689),K=R(6260),re=R(529),_e=R(6895),ge=R(9064);function xe(Pe,Nt){if(1&Pe){const me=m.EpF();m.ynx(0),m.TgZ(1,"ion-note"),m.TgZ(2,"p"),m._uU(3," The closest address to this position is: "),m.qZA(),m.TgZ(4,"p"),m.TgZ(5,"strong"),m._uU(6),m.qZA(),m._UZ(7,"br"),m._uU(8),m._UZ(9,"br"),m.TgZ(10,"ion-button",3),m.NdJ("click",function(){return m.CHM(me),m.oxw().useAddressSelection()}),m._uU(11,"Use this address below "),m._UZ(12,"ion-icon",4),m.qZA(),m.qZA(),m.qZA(),m.BQk()}if(2&Pe){const me=m.oxw();m.xp6(6),m.Oqu(me.suggestedAddress.AddressLine1),m.xp6(2),m.HOy(" ",me.suggestedAddress.AddressLine2," ",me.suggestedAddress.Town," ",me.suggestedAddress.StateOrProvince," ",me.suggestedAddress.Postcode," ")}}let je=(()=>{class Pe{constructor(me,qe,Rt,Xt,Xn){this.mapping=me,this.events=qe,this.logging=Rt,this.http=Xt,this.appManager=Xn,this.latitudeChange=new m.vpe,this.longitudeChange=new m.vpe,this.suggestedAddress=null,this.suggestedAddressChange=new m.vpe,this.onUseSuggestedAddress=new m.vpe,this.suggestedAddressAttribution=null,this.suggestedAddressAttributionChange=new m.vpe,this.isMapInitialised=!1}ngOnInit(){this.mapService=new V.k(this.events,this.logging,this.http),this.mapService.initAPI(),this.mapOptions=new ue._,this.mapOptions.mapType=this.appManager.searchSettings.MapType,this.mapOptions.onMapMoveCompleted=()=>{let me;me=this.mapService.getMapCenter(),me.subscribe(qe=>{qe&&(this.latitude=qe.coords.latitude,this.longitude=qe.coords.longitude,this.latitudeChange.emit(this.latitude),this.longitudeChange.emit(this.longitude),this.getAddressForCurrentLatLng())})}}ngAfterContentInit(){this.focusMap()}ngOnDestroy(){this.mapService.disposeMap()}focusMap(){0==this.isMapInitialised&&this.mapService&&0!=this.latitude&&0!=this.longitude&&(this.isMapInitialised=!0,this.mapService.initMap("editor-map",this.mapOptions,null),this.mapService.setMapCenter(new $.jR(this.latitude,this.longitude)),this.originalMarkerPos=new $.wC(this.latitude,this.longitude))}ngOnChanges(me){this.focusMap()}getAddressForCurrentLatLng(){var me=this;return(0,u.Z)(function*(){me.latitude&&me.longitude&&me.appManager.api.fetchReverseGeocodeResult(me.latitude,me.longitude).then(qe=>{qe.AddressInfo&&(me.suggestedAddress=qe.AddressInfo)})})()}useAddressSelection(){this.onUseSuggestedAddress.emit({suggestedAddress:this.suggestedAddress,attribution:this.suggestedAddressAttribution}),this.suggestedAddress=null,this.suggestedAddressAttribution=null}}return Pe.\u0275fac=function(me){return new(me||Pe)(m.Y36(P.v),m.Y36(K.z),m.Y36(Z.z),m.Y36(re.eN),m.Y36(d.c))},Pe.\u0275cmp=m.Xpm({type:Pe,selectors:[["app-poi-location-editor"]],inputs:{latitude:"latitude",longitude:"longitude"},outputs:{latitudeChange:"latitudeChange",longitudeChange:"longitudeChange",suggestedAddressChange:"suggestedAddressChange",onUseSuggestedAddress:"onUseSuggestedAddress",suggestedAddressAttributionChange:"suggestedAddressAttributionChange"},features:[m.TTD],decls:4,vars:1,consts:[[1,"instruction"],["id","editor-map"],[4,"ngIf"],["size","small",3,"click"],["slot","end","name","copy"]],template:function(me,qe){1&me&&(m.TgZ(0,"p",0),m._uU(1,"Drag the map to center the marker on the charging location:"),m.qZA(),m._UZ(2,"div",1),m.YNc(3,xe,13,5,"ng-container",2)),2&me&&(m.xp6(3),m.Q6J("ngIf",qe.suggestedAddress))},directives:[_e.O5,ge.uN,ge.YG,ge.gu],styles:["#editor-map[_ngcontent-%COMP%]{border:1px solid gainsboro;background-color:gray;width:100%;height:128px}"]}),Pe})();var nt=R(6799),Fe=R(4006);function ke(Pe,Nt){if(1&Pe&&(m.TgZ(0,"ion-select-option",14),m._uU(1),m.qZA()),2&Pe){const me=Nt.$implicit;m.Q6J("value",me.ID),m.xp6(1),m.Oqu(me.Title)}}function Ne(Pe,Nt){if(1&Pe&&(m.TgZ(0,"ion-select-option",14),m._uU(1),m.qZA()),2&Pe){const me=Nt.$implicit;m.Q6J("value",me.ID),m.xp6(1),m.Oqu(me.Title)}}function $e(Pe,Nt){if(1&Pe&&(m.TgZ(0,"ion-select-option",14),m._uU(1),m.qZA()),2&Pe){const me=Nt.$implicit;m.Q6J("value",me.ID),m.xp6(1),m.Oqu(me.Title)}}let Re=(()=>{class Pe{constructor(me,qe){this.modalController=me,this.referenceDataManager=qe,this.useFilteredConnectionTypes=!0,this.useFilteredOperators=!0}get isAddMode(){return!(null!=this.conn&&this.conn.ID>0)}get connectionTypes(){return this.referenceDataManager.getConnectionTypes(this.useFilteredConnectionTypes)}get currentTypes(){return this.referenceDataManager.getOutputCurrentTypes()}get statusTypes(){return this.referenceDataManager.getStatusTypes().filter(me=>1==me.IsUserSelectable)}ngOnInit(){}save(){this.modalController.dismiss({item:this.conn})}cancel(){this.modalController.dismiss()}}return Pe.\u0275fac=function(me){return new(me||Pe)(m.Y36(ge.IN),m.Y36(nt.W))},Pe.\u0275cmp=m.Xpm({type:Pe,selectors:[["app-poi-equipment-editor"]],decls:60,vars:13,consts:[[1,"ion-padding"],["position","floating"],[3,"ngModel","ngModelChange"],["value","0"],[3,"value",4,"ngFor","ngForOf"],["type","number",3,"ngModel","ngModelChange"],["type","text","placeholder","(optional) other comments",3,"ngModel","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],["slot","start"],[3,"click"],["name","close","slot","start"],["slot","end"],["color","success",3,"click"],["name","send","slot","end"],[3,"value"]],template:function(me,qe){1&me&&(m.TgZ(0,"ion-header"),m.TgZ(1,"ion-toolbar"),m.TgZ(2,"ion-title"),m._uU(3),m.qZA(),m.qZA(),m.qZA(),m.TgZ(4,"ion-content",0),m.TgZ(5,"p"),m._uU(6,"Please provide as much information as you can about the equipment. If you don't know then leave the field blank. At a minimum you should include the Connection Type and approximate Power kW (max)."),m.qZA(),m.TgZ(7,"ion-item"),m.TgZ(8,"ion-label",1),m._uU(9,"Connection Type"),m.qZA(),m.TgZ(10,"ion-select",2),m.NdJ("ngModelChange",function(Xt){return qe.conn.ConnectionTypeID=Xt}),m.TgZ(11,"ion-select-option",3),m._uU(12,"Unknown"),m.qZA(),m.YNc(13,ke,2,2,"ion-select-option",4),m.qZA(),m.qZA(),m.TgZ(14,"ion-item"),m.TgZ(15,"ion-label",1),m._uU(16,"Supply Type"),m.qZA(),m.TgZ(17,"ion-select",2),m.NdJ("ngModelChange",function(Xt){return qe.conn.CurrentTypeID=Xt}),m.TgZ(18,"ion-select-option",3),m._uU(19,"Unknown"),m.qZA(),m.YNc(20,Ne,2,2,"ion-select-option",4),m.qZA(),m.qZA(),m.TgZ(21,"ion-item"),m.TgZ(22,"ion-label",1),m._uU(23,"Power (kW)"),m.qZA(),m.TgZ(24,"ion-input",5),m.NdJ("ngModelChange",function(Xt){return qe.conn.PowerKW=Xt}),m.qZA(),m.qZA(),m.TgZ(25,"ion-item"),m.TgZ(26,"ion-label",1),m._uU(27,"Amps"),m.qZA(),m.TgZ(28,"ion-input",5),m.NdJ("ngModelChange",function(Xt){return qe.conn.Amps=Xt}),m.qZA(),m.qZA(),m.TgZ(29,"ion-item"),m.TgZ(30,"ion-label",1),m._uU(31,"Voltage"),m.qZA(),m.TgZ(32,"ion-input",5),m.NdJ("ngModelChange",function(Xt){return qe.conn.Voltage=Xt}),m.qZA(),m.qZA(),m.TgZ(33,"ion-item"),m.TgZ(34,"ion-label",1),m._uU(35,"Status"),m.qZA(),m.TgZ(36,"ion-select",2),m.NdJ("ngModelChange",function(Xt){return qe.conn.StatusTypeID=Xt}),m.YNc(37,$e,2,2,"ion-select-option",4),m.qZA(),m.qZA(),m.TgZ(38,"ion-item"),m.TgZ(39,"ion-label",1),m._uU(40,"Quantity Available"),m.qZA(),m.TgZ(41,"ion-input",5),m.NdJ("ngModelChange",function(Xt){return qe.conn.Quantity=Xt}),m.qZA(),m.qZA(),m.TgZ(42,"ion-item"),m.TgZ(43,"ion-label",1),m._uU(44,"Comment"),m.qZA(),m.TgZ(45,"ion-input",6),m.NdJ("ngModelChange",function(Xt){return qe.conn.Comments=Xt}),m.qZA(),m.qZA(),m.TgZ(46,"ion-item"),m.TgZ(47,"ion-label",1),m._uU(48,"Operators Reference"),m.qZA(),m.TgZ(49,"ion-input",7),m.NdJ("ngModelChange",function(Xt){return qe.conn.Reference=Xt}),m.qZA(),m.qZA(),m.qZA(),m.TgZ(50,"ion-footer"),m.TgZ(51,"ion-toolbar"),m.TgZ(52,"ion-buttons",8),m.TgZ(53,"ion-button",9),m.NdJ("click",function(){return qe.cancel()}),m._UZ(54,"ion-icon",10),m._uU(55," Cancel "),m.qZA(),m.qZA(),m.TgZ(56,"ion-buttons",11),m.TgZ(57,"ion-button",12),m.NdJ("click",function(){return qe.save()}),m._uU(58," OK "),m._UZ(59,"ion-icon",13),m.qZA(),m.qZA(),m.qZA(),m.qZA()),2&me&&(m.xp6(3),m.Oqu(qe.isAddMode?"Add Equipment":"Edit Equipment"),m.xp6(7),m.Q6J("ngModel",qe.conn.ConnectionTypeID),m.xp6(3),m.Q6J("ngForOf",qe.connectionTypes),m.xp6(4),m.Q6J("ngModel",qe.conn.CurrentTypeID),m.xp6(3),m.Q6J("ngForOf",qe.currentTypes),m.xp6(4),m.Q6J("ngModel",qe.conn.PowerKW),m.xp6(4),m.Q6J("ngModel",qe.conn.Amps),m.xp6(4),m.Q6J("ngModel",qe.conn.Voltage),m.xp6(4),m.Q6J("ngModel",qe.conn.StatusTypeID),m.xp6(1),m.Q6J("ngForOf",qe.statusTypes),m.xp6(4),m.Q6J("ngModel",qe.conn.Quantity),m.xp6(4),m.Q6J("ngModel",qe.conn.Comments),m.xp6(4),m.Q6J("ngModel",qe.conn.Reference))},directives:[ge.Gu,ge.sr,ge.wd,ge.W2,ge.Ie,ge.Q$,ge.t9,ge.QI,Fe.JJ,Fe.On,ge.n0,_e.sg,ge.pK,ge.as,ge.j9,ge.fr,ge.Sm,ge.YG,ge.gu],styles:[""]}),Pe})();var _t=(()=>{return(Pe=_t||(_t={}))[Pe.Unknown=0]="Unknown",Pe[Pe.CurrentlyAvailable=10]="CurrentlyAvailable",Pe[Pe.CurrentlyInUse=20]="CurrentlyInUse",Pe[Pe.TemporarilyUnavailable=30]="TemporarilyUnavailable",Pe[Pe.Operational=50]="Operational",Pe[Pe.PartlyOperational=75]="PartlyOperational",Pe[Pe.NotOperational=100]="NotOperational",Pe[Pe.PlannedForFutureDate=150]="PlannedForFutureDate",Pe[Pe.RemovedDecomissioned=200]="RemovedDecomissioned",_t;var Pe})(),Ge=(()=>{return(Pe=Ge||(Ge={}))[Pe.UnknownOperator=1]="UnknownOperator",Pe[Pe.SiteOwner=45]="SiteOwner",Ge;var Pe})(),wt=R(6585);function xt(Pe,Nt){if(1&Pe&&(m.TgZ(0,"ion-select-option",5),m._uU(1),m.qZA()),2&Pe){const me=Nt.$implicit;m.Q6J("value",me.ID),m.xp6(1),m.Oqu(me.Title)}}function dt(Pe,Nt){1&Pe&&(m.TgZ(0,"ion-select-option",6),m._uU(1,"Other..."),m.qZA())}function At(Pe,Nt){if(1&Pe){const me=m.EpF();m.TgZ(0,"ion-item"),m.TgZ(1,"ion-label",1),m._uU(2,"Network Operator"),m.qZA(),m.TgZ(3,"ion-select",2),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw().operatorId=Rt})("ionChange",function(){return m.CHM(me),m.oxw().onOperatorChange()}),m.YNc(4,xt,2,2,"ion-select-option",3),m.YNc(5,dt,2,0,"ion-select-option",4),m.qZA(),m.qZA()}if(2&Pe){const me=m.oxw();m.xp6(3),m.Q6J("ngModel",me.operatorId),m.xp6(1),m.Q6J("ngForOf",me.operators),m.xp6(1),m.Q6J("ngIf",me.useFilteredOperators)}}function Vt(Pe,Nt){if(1&Pe){const me=m.EpF();m.TgZ(0,"ion-item"),m.TgZ(1,"ion-label"),m._uU(2,"Network Operator"),m.qZA(),m.TgZ(3,"ion-searchbar",7),m.NdJ("ionCancel",function(){return m.CHM(me),m.oxw().cancelOperatorLookup()})("ngModelChange",function(Rt){return m.CHM(me),m.oxw().operatorSearchKeyword=Rt})("ionChange",function(Rt){return m.CHM(me),m.oxw().searchOperators(Rt)}),m.qZA(),m.qZA()}if(2&Pe){const me=m.oxw();m.xp6(3),m.Q6J("ngModel",me.operatorSearchKeyword)}}function Un(Pe,Nt){if(1&Pe){const me=m.EpF();m.TgZ(0,"ion-item",9),m.NdJ("click",function(){const Xt=m.CHM(me).$implicit;return m.oxw(2).onOperatorChange(Xt)}),m.TgZ(1,"ion-avatar",10),m._UZ(2,"ion-icon",11),m.qZA(),m.TgZ(3,"ion-label"),m.TgZ(4,"p"),m._uU(5),m.qZA(),m.TgZ(6,"p"),m._uU(7),m.qZA(),m.qZA(),m.qZA()}if(2&Pe){const me=Nt.$implicit;m.xp6(5),m.Oqu(me.Title),m.xp6(2),m.Oqu(me.WebsiteURL)}}function St(Pe,Nt){if(1&Pe&&(m.ynx(0),m.TgZ(1,"ion-list"),m.YNc(2,Un,8,2,"ion-item",8),m.qZA(),m.BQk()),2&Pe){const me=m.oxw();m.xp6(2),m.Q6J("ngForOf",me.operatorSearchResults)}}function $t(Pe,Nt){if(1&Pe){const me=m.EpF();m.ynx(0),m.TgZ(1,"ion-item"),m.TgZ(2,"ion-avatar",10),m._UZ(3,"ion-icon",12),m.qZA(),m.TgZ(4,"ion-label"),m.TgZ(5,"p"),m._uU(6),m.qZA(),m.TgZ(7,"p"),m._uU(8),m.qZA(),m.TgZ(9,"ion-button",9),m.NdJ("click",function(){return m.CHM(me),m.oxw().selectedOperator=null}),m._uU(10,"Change"),m.qZA(),m.qZA(),m.qZA(),m.BQk()}if(2&Pe){const me=m.oxw();m.xp6(6),m.Oqu(me.selectedOperator.Title),m.xp6(2),m.Oqu(me.selectedOperator.WebsiteURL)}}let zt=(()=>{class Pe{constructor(me){this.referenceDataManager=me,this.operatorId=null,this.useFilteredOperators=null,this.operatorChanged=new m.vpe,this.operatorCache=[],this.operatorSearchResults=[],this.operatorSearchKeyword="",this.selectedOperator=null}get operators(){return this.referenceDataManager.getNetworkOperators(this.useFilteredOperators)}ngOnInit(){this.operatorCache=this.referenceDataManager.getNetworkOperators(!1),null!=this.operatorId&&(this.selectedOperator=this.operatorCache.find(me=>me.ID==this.operatorId))}searchOperators(){this.operatorSearchResults=[],0!=this.operatorSearchKeyword.length&&(this.operatorSearchResults=this.operatorCache?this.operatorCache.filter(me=>me.Title.toLowerCase().startsWith(this.operatorSearchKeyword.toLowerCase())||me.Title.toLowerCase().startsWith("("+this.operatorSearchKeyword.toLowerCase())).slice(0,10):[])}onOperatorChange(me=null){var qe=this;return(0,u.Z)(function*(){null==me&&qe.operatorId&&(me=qe.operatorCache.find(Rt=>Rt.ID==qe.operatorId)),null!=me&&(qe.operatorSearchResults=[],qe.selectedOperator=me,qe.operatorId=me.ID),qe.operatorId?qe.operatorChanged.emit(qe.selectedOperator):qe.useFilteredOperators=!1})()}cancelOperatorLookup(){this.selectedOperator=null}}return Pe.\u0275fac=function(me){return new(me||Pe)(m.Y36(nt.W))},Pe.\u0275cmp=m.Xpm({type:Pe,selectors:[["app-operator-lookup"]],inputs:{operatorId:"operatorId",useFilteredOperators:"useFilteredOperators"},outputs:{operatorChanged:"operatorChanged"},decls:4,vars:4,consts:[[4,"ngIf"],["position","floating"],[3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["value","",4,"ngIf"],[3,"value"],["value",""],["placeholder","Search by network name (in any country)","showCancelButton","focus","autocomplete","on",3,"ngModel","ionCancel","ngModelChange","ionChange"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["item-left",""],["name","card"],["name","locate"]],template:function(me,qe){1&me&&(m.YNc(0,At,6,3,"ion-item",0),m.YNc(1,Vt,4,1,"ion-item",0),m.YNc(2,St,3,1,"ng-container",0),m.YNc(3,$t,11,2,"ng-container",0)),2&me&&(m.Q6J("ngIf",qe.useFilteredOperators&&!qe.selectedOperator),m.xp6(1),m.Q6J("ngIf",!qe.useFilteredOperators&&!qe.selectedOperator),m.xp6(1),m.Q6J("ngIf",qe.operatorSearchResults.length>0),m.xp6(1),m.Q6J("ngIf",null!=qe.selectedOperator))},directives:[_e.O5,ge.Ie,ge.Q$,ge.t9,ge.QI,Fe.JJ,Fe.On,_e.sg,ge.n0,ge.VI,ge.j9,ge.q_,ge.BJ,ge.gu,ge.YG],styles:[""]}),Pe})();var Ht=R(1099);function en(Pe,Nt){1&Pe&&m._UZ(0,"ion-icon",13)}function Kt(Pe,Nt){1&Pe&&m._UZ(0,"ion-icon",13)}function Wt(Pe,Nt){1&Pe&&m._UZ(0,"ion-icon",13)}function Yt(Pe,Nt){if(1&Pe&&(m.TgZ(0,"ion-select-option",27),m._uU(1),m.qZA()),2&Pe){const me=Nt.$implicit;m.Q6J("value",me.ID),m.xp6(1),m.Oqu(me.Title)}}function qt(Pe,Nt){if(1&Pe){const me=m.EpF();m.ynx(0),m.TgZ(1,"app-poi-location-editor",14,15),m.NdJ("latitudeChange",function(Rt){return m.CHM(me),m.oxw(2).item.AddressInfo.Latitude=Rt})("longitudeChange",function(Rt){return m.CHM(me),m.oxw(2).item.AddressInfo.Longitude=Rt})("onUseSuggestedAddress",function(Rt){return m.CHM(me),m.oxw(2).useSuggestedAddress(Rt)}),m.qZA(),m.TgZ(3,"ion-list"),m.TgZ(4,"ion-item"),m.TgZ(5,"ion-label",16),m._uU(6,"Location Name"),m.qZA(),m.TgZ(7,"ion-input",17),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw(2).item.AddressInfo.Title=Rt}),m.qZA(),m.qZA(),m.TgZ(8,"ion-item"),m.TgZ(9,"ion-label",16),m._uU(10,"Address Line 1"),m.qZA(),m.TgZ(11,"ion-input",18),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw(2).item.AddressInfo.AddressLine1=Rt}),m.qZA(),m.qZA(),m.TgZ(12,"ion-item"),m.TgZ(13,"ion-label",16),m._uU(14,"Address Line 2"),m.qZA(),m.TgZ(15,"ion-input",19),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw(2).item.AddressInfo.AddressLine2=Rt}),m.qZA(),m.qZA(),m.TgZ(16,"ion-item"),m.TgZ(17,"ion-label",16),m._uU(18,"Town"),m.qZA(),m.TgZ(19,"ion-input",20),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw(2).item.AddressInfo.Town=Rt}),m.qZA(),m.qZA(),m.TgZ(20,"ion-item"),m.TgZ(21,"ion-label",16),m._uU(22,"State or Province"),m.qZA(),m.TgZ(23,"ion-input",21),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw(2).item.AddressInfo.StateOrProvince=Rt}),m.qZA(),m.qZA(),m.TgZ(24,"ion-item"),m.TgZ(25,"ion-label",16),m._uU(26,"Postal Code"),m.qZA(),m.TgZ(27,"ion-input",22),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw(2).item.AddressInfo.Postcode=Rt}),m.qZA(),m.qZA(),m.TgZ(28,"ion-item"),m.TgZ(29,"ion-label",16),m._uU(30,"Country"),m.qZA(),m.TgZ(31,"ion-select",23),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw(2).item.AddressInfo.CountryID=Rt})("ionChange",function(){return m.CHM(me),m.oxw(2).onCountryChange()}),m.YNc(32,Yt,2,2,"ion-select-option",24),m.qZA(),m.qZA(),m.TgZ(33,"ion-item"),m.TgZ(34,"ion-label",16),m._uU(35,"Latitude"),m.qZA(),m.TgZ(36,"ion-input",25),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw(2).item.AddressInfo.Latitude=Rt}),m.qZA(),m.qZA(),m.TgZ(37,"ion-item"),m.TgZ(38,"ion-label",16),m._uU(39,"Longitude"),m.qZA(),m.TgZ(40,"ion-input",26),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw(2).item.AddressInfo.Longitude=Rt}),m.qZA(),m.qZA(),m.qZA(),m.BQk()}if(2&Pe){const me=m.oxw(2);m.xp6(1),m.Q6J("latitude",me.item.AddressInfo.Latitude)("longitude",me.item.AddressInfo.Longitude),m.xp6(6),m.Q6J("ngModel",me.item.AddressInfo.Title),m.xp6(4),m.Q6J("ngModel",me.item.AddressInfo.AddressLine1),m.xp6(4),m.Q6J("ngModel",me.item.AddressInfo.AddressLine2),m.xp6(4),m.Q6J("ngModel",me.item.AddressInfo.Town),m.xp6(4),m.Q6J("ngModel",me.item.AddressInfo.StateOrProvince),m.xp6(4),m.Q6J("ngModel",me.item.AddressInfo.Postcode),m.xp6(4),m.Q6J("ngModel",me.item.AddressInfo.CountryID),m.xp6(1),m.Q6J("ngForOf",me.countries),m.xp6(4),m.Q6J("ngModel",me.item.AddressInfo.Latitude),m.xp6(4),m.Q6J("ngModel",me.item.AddressInfo.Longitude)}}function Gt(Pe,Nt){if(1&Pe){const me=m.EpF();m.ynx(0),m.TgZ(1,"h3"),m._uU(2,"Locations Nearby"),m.qZA(),m.TgZ(3,"p"),m.TgZ(4,"strong"),m._uU(5,"The following locations already exist nearby."),m.qZA(),m.qZA(),m.TgZ(6,"div",28),m.TgZ(7,"p"),m._uU(8,"Ensure you are not adding a duplicate site unless it is for different equipment from another network operator."),m.qZA(),m.TgZ(9,"p"),m._uU(10,"You can edit any of these listings if required instead:"),m.qZA(),m.qZA(),m.TgZ(11,"app-poi-list",29),m.NdJ("onEdit",function(Rt){return m.CHM(me),m.oxw(2).editPOI(Rt)}),m.qZA(),m.BQk()}if(2&Pe){const me=m.oxw(2);m.xp6(11),m.Q6J("poiList",me.nearbySites)("enableEditOption",!0)}}function ft(Pe,Nt){if(1&Pe&&(m.ynx(0),m.YNc(1,qt,41,12,"ng-container",9),m.YNc(2,Gt,12,2,"ng-container",9),m.BQk()),2&Pe){const me=m.oxw();m.xp6(1),m.Q6J("ngIf","location"==me.step),m.xp6(1),m.Q6J("ngIf","poi-nearby"==me.step)}}function Ut(Pe,Nt){if(1&Pe){const me=m.EpF();m.ynx(0),m.TgZ(1,"p"),m._uU(2,"Copied the equipment configuration from:"),m.qZA(),m.TgZ(3,"ion-item"),m.TgZ(4,"ion-label"),m._uU(5),m._UZ(6,"br"),m._uU(7),m._UZ(8,"br"),m._uU(9),m._UZ(10,"br"),m._uU(11),m._UZ(12,"br"),m._uU(13),m.qZA(),m.TgZ(14,"ion-button",31),m.NdJ("click",function(){return m.CHM(me),m.oxw(5).changeTemplatePOI()}),m._uU(15,"Change.."),m.qZA(),m.qZA(),m.BQk()}if(2&Pe){const me=m.oxw(5);m.xp6(5),m.hij(" ",me.selectedTemplatePOI.AddressInfo.Title," "),m.xp6(2),m.hij(" ",me.selectedTemplatePOI.AddressInfo.AddressLine1," "),m.xp6(2),m.hij(" ",null==me.selectedTemplatePOI.Connections[0].ConnectionType?null:me.selectedTemplatePOI.Connections[0].ConnectionType.Title," "),m.xp6(2),m.hij(" ",me.selectedTemplatePOI.Connections[0].PowerKW," "),m.xp6(2),m.hij(" ",me.selectedTemplatePOI.DateCreated," ")}}function On(Pe,Nt){if(1&Pe){const me=m.EpF();m.ynx(0),m.TgZ(1,"h4"),m._uU(2,"Similar Sites"),m.qZA(),m.TgZ(3,"app-poi-list",32),m.NdJ("onCopy",function(Rt){return m.CHM(me),m.oxw(6).useTemplatePOI(Rt)}),m.qZA(),m.BQk()}if(2&Pe){const me=m.oxw(6);m.xp6(3),m.Q6J("enableCopyOption",!0)("poiList",me.templateSites)}}function fn(Pe,Nt){1&Pe&&(m.ynx(0),m.TgZ(1,"p"),m._uU(2," There are no suggested sites to copy for this network operator. "),m.qZA(),m.BQk())}function Gn(Pe,Nt){if(1&Pe&&(m.ynx(0),m.YNc(1,On,4,2,"ng-container",9),m.YNc(2,fn,3,0,"ng-container",9),m.BQk()),2&Pe){const me=m.oxw(5);m.xp6(1),m.Q6J("ngIf",me.templateSites.length>0),m.xp6(1),m.Q6J("ngIf",0==me.templateSites.length)}}function ei(Pe,Nt){if(1&Pe&&(m.ynx(0),m.YNc(1,Ut,16,5,"ng-container",9),m.YNc(2,Gn,3,2,"ng-container",9),m.BQk()),2&Pe){const me=m.oxw(4);m.xp6(1),m.Q6J("ngIf",me.selectedTemplatePOI),m.xp6(1),m.Q6J("ngIf",!me.selectedTemplatePOI)}}function $i(Pe,Nt){if(1&Pe){const me=m.EpF();m.ynx(0),m.TgZ(1,"p",28),m._uU(2,"You can copy the equipment settings from other sites operated by the same network operator or choose 'Next' to skip this step: "),m.qZA(),m.TgZ(3,"app-operator-lookup",30),m.NdJ("operatorChanged",function(Rt){return m.CHM(me),m.oxw(3).onOperatorChange(Rt)}),m.qZA(),m.YNc(4,ei,3,2,"ng-container",9),m.BQk()}if(2&Pe){const me=m.oxw(3);m.xp6(3),m.Q6J("operatorId",me.item.OperatorID),m.xp6(1),m.Q6J("ngIf",me.item.AddressInfo.CountryID&&me.item.OperatorID)}}function sr(Pe,Nt){if(1&Pe&&(m.ynx(0),m.YNc(1,$i,5,2,"ng-container",9),m.BQk()),2&Pe){const me=m.oxw(2);m.xp6(1),m.Q6J("ngIf",!me.skipPOICopy)}}function zi(Pe,Nt){if(1&Pe){const me=m.EpF();m.ynx(0),m.TgZ(1,"app-operator-lookup",33),m.NdJ("operatorChanged",function(Rt){return m.CHM(me),m.oxw(2).onOperatorChange(Rt)}),m.qZA(),m.TgZ(2,"ion-item"),m.TgZ(3,"ion-label",16),m._uU(4,"Number of Stations or Parking Bays"),m.qZA(),m.TgZ(5,"ion-input",21),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw(2).item.NumberOfPoints=Rt}),m.qZA(),m.qZA(),m.TgZ(6,"h4"),m._uU(7,"Equipment"),m.qZA(),m.TgZ(8,"ion-button",34),m.NdJ("click",function(){return m.CHM(me),m.oxw(2).addConnection()}),m._UZ(9,"ion-icon",35),m.qZA(),m.TgZ(10,"app-equipment-details",36),m.NdJ("onEdit",function(Rt){return m.CHM(me),m.oxw(2).editConnection(Rt)})("onDelete",function(Rt){return m.CHM(me),m.oxw(2).deleteConnection(Rt)}),m.qZA(),m.BQk()}if(2&Pe){const me=m.oxw(2);m.xp6(1),m.Q6J("operatorId",me.item.OperatorID)("useFilteredOperators",!1),m.xp6(4),m.Q6J("ngModel",me.item.NumberOfPoints),m.xp6(5),m.Q6J("item",me.item)("enableEdit",!0)}}function yi(Pe,Nt){if(1&Pe&&(m.ynx(0),m.YNc(1,sr,2,1,"ng-container",9),m.YNc(2,zi,11,5,"ng-container",9),m.BQk()),2&Pe){const me=m.oxw();m.xp6(1),m.Q6J("ngIf","copy-equipment"==me.step),m.xp6(1),m.Q6J("ngIf","edit-equipment"==me.step)}}function ji(Pe,Nt){if(1&Pe&&(m.TgZ(0,"p",43),m.TgZ(1,"strong"),m._uU(2,"Your changes cannot be saved until the following issues are resolved:"),m.qZA(),m.TgZ(3,"ion-label",44),m._uU(4),m.qZA(),m.qZA()),2&Pe){const me=m.oxw(2);m.xp6(4),m.hij(" ",me.validationMsg,"")}}function _i(Pe,Nt){if(1&Pe&&(m.TgZ(0,"ion-select-option",27),m._uU(1),m.qZA()),2&Pe){const me=Nt.$implicit;m.Q6J("value",me.ID),m.xp6(1),m.Oqu(me.Title)}}function xi(Pe,Nt){if(1&Pe&&(m.TgZ(0,"ion-select-option",27),m._uU(1),m.qZA()),2&Pe){const me=Nt.$implicit;m.Q6J("value",me.ID),m.xp6(1),m.Oqu(me.Title)}}function Qt(Pe,Nt){if(1&Pe){const me=m.EpF();m.ynx(0),m.YNc(1,ji,5,1,"p",37),m.TgZ(2,"p"),m._uU(3,"Please provide any other facts related to this site. Additional comments (your charging experiences etc) can be added as check-in comments once the site is listed."),m.qZA(),m.TgZ(4,"ion-item"),m.TgZ(5,"ion-label",16),m._uU(6,"Operational Status (All Equipment))"),m.qZA(),m.TgZ(7,"ion-select",38),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw().item.StatusTypeID=Rt}),m.YNc(8,_i,2,2,"ion-select-option",24),m.qZA(),m.qZA(),m.TgZ(9,"ion-item"),m.TgZ(10,"ion-label",16),m._uU(11,"Usage Type"),m.qZA(),m.TgZ(12,"ion-select",38),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw().item.UsageTypeID=Rt}),m.YNc(13,xi,2,2,"ion-select-option",24),m.qZA(),m.qZA(),m.TgZ(14,"ion-item"),m.TgZ(15,"ion-label",16),m._uU(16,"Usage Cost"),m.qZA(),m.TgZ(17,"ion-input",21),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw().item.UsageCost=Rt}),m.qZA(),m.qZA(),m.TgZ(18,"ion-item"),m.TgZ(19,"ion-label",16),m._uU(20,"General Comments"),m.qZA(),m.TgZ(21,"ion-input",39),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw().item.GeneralComments=Rt}),m.qZA(),m.qZA(),m.TgZ(22,"ion-item"),m.TgZ(23,"ion-label",16),m._uU(24,"Main Telephone Number "),m.qZA(),m.TgZ(25,"ion-input",40),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw().item.AddressInfo.ContactTelephone1=Rt}),m.qZA(),m.qZA(),m.TgZ(26,"ion-item"),m.TgZ(27,"ion-label",16),m._uU(28,"Other Telephone Number "),m.qZA(),m.TgZ(29,"ion-input",40),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw().item.AddressInfo.ContactTelephone2=Rt}),m.qZA(),m.qZA(),m.TgZ(30,"ion-item"),m.TgZ(31,"ion-label",16),m._uU(32,"Access Comments"),m.qZA(),m.TgZ(33,"ion-input",41),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw().item.AddressInfo.AccessComments=Rt}),m.qZA(),m.qZA(),m.TgZ(34,"ion-item"),m.TgZ(35,"ion-label",16),m._uU(36,"Related Website"),m.qZA(),m.TgZ(37,"ion-input",42),m.NdJ("ngModelChange",function(Rt){return m.CHM(me),m.oxw().item.AddressInfo.RelatedURL=Rt}),m.qZA(),m.qZA(),m.BQk()}if(2&Pe){const me=m.oxw();m.xp6(1),m.Q6J("ngIf",me.validationMsg),m.xp6(6),m.Q6J("ngModel",me.item.StatusTypeID),m.xp6(1),m.Q6J("ngForOf",me.statusTypes),m.xp6(4),m.Q6J("ngModel",me.item.UsageTypeID),m.xp6(1),m.Q6J("ngForOf",me.usageTypes),m.xp6(4),m.Q6J("ngModel",me.item.UsageCost),m.xp6(4),m.Q6J("ngModel",me.item.GeneralComments),m.xp6(4),m.Q6J("ngModel",me.item.AddressInfo.ContactTelephone1),m.xp6(4),m.Q6J("ngModel",me.item.AddressInfo.ContactTelephone2),m.xp6(4),m.Q6J("ngModel",me.item.AddressInfo.AccessComments),m.xp6(4),m.Q6J("ngModel",me.item.AddressInfo.RelatedURL)}}function Ye(Pe,Nt){if(1&Pe){const me=m.EpF();m.TgZ(0,"ion-button",1),m.NdJ("click",function(){return m.CHM(me),m.oxw().previous()}),m._uU(1," Previous "),m._UZ(2,"ion-icon",45),m.qZA()}}function te(Pe,Nt){if(1&Pe){const me=m.EpF();m.TgZ(0,"ion-button",1),m.NdJ("click",function(){return m.CHM(me),m.oxw().next()}),m._uU(1," Next "),m._UZ(2,"ion-icon",46),m.qZA()}}function Ae(Pe,Nt){if(1&Pe){const me=m.EpF();m.TgZ(0,"ion-button",47),m.NdJ("click",function(){return m.CHM(me),m.oxw().save()}),m._uU(1," Submit "),m._UZ(2,"ion-icon",48),m.qZA()}}let ut=(()=>{class Pe{constructor(me,qe,Rt,Xt,Xn,Ki){this.appManager=me,this.modalController=qe,this.poiManager=Rt,this.mapping=Xt,this.loadingController=Xn,this.alertController=Ki,this.useFilteredConnectionTypes=!0,this.templateSites=[],this.nearbySites=[],this.selectedTemplatePOI=null,this.suggestedAddress=null,this.suggestedAddressAttribution=null,this.isNonDuplicateConfirmed=!1,this.skipPOICopy=!1,this.validationMsg=null,this.initNewItem()}get countries(){return this.appManager.referenceDataManager.getCountries()}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes()}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes().filter(me=>1==me.IsUserSelectable)}get isAddMode(){return this.item.ID<=0}initNewItem(){this.item={ID:-1,DataProviderID:1,DataProvidersReference:null,OperatorsReference:null,OperatorID:1,UsageCost:null,UsageTypeID:4,NumberOfPoints:1,GeneralComments:null,DatePlanned:null,StatusTypeID:50,SubmissionStatusTypeID:null,Connections:[],MetadataValues:[],AddressInfo:{ID:-1,CountryID:18,Title:"",AddressLine1:"",Latitude:0,Longitude:0}},this.step="location",this.selectedTab="location"}get isReadyToSubmit(){return this.validate().isValid&&"info"==this.step}ngOnInit(){}presentLoadingUI(){var me=this;return(0,u.Z)(function*(){me.loading=yield me.loadingController.create({message:"Please Wait.."}),yield me.loading.present()})()}dismissLoadingUI(){var me=this;return(0,u.Z)(function*(){me.loading&&(yield me.loading.dismiss())})()}ionViewDidEnter(){if(null!=this.id)this.editExistingPOI(this.id);else{let me=localStorage.getItem("_editor-operatorid");me&&(this.item.OperatorID=parseInt(me,10)),this.startPos?(this.item.AddressInfo.Latitude=this.startPos.latitude,this.item.AddressInfo.Longitude=this.startPos.longitude):this.mapping&&this.mapping.getMapCenter().subscribe(qe=>{qe&&(this.item.AddressInfo.Latitude=qe.coords.latitude,this.item.AddressInfo.Longitude=qe.coords.longitude)})}this.refreshFilteredReferenceData()}previous(){var me=this;return(0,u.Z)(function*(){switch(me.step){case"info":me.step="edit-equipment";break;case"edit-equipment":me.step=me.isAddMode?"copy-equipment":"location";break;case"copy-equipment":case"poi-nearby":me.step="location"}yield me.initCurrentStep(!1)})()}next(){var me=this;return(0,u.Z)(function*(){if("poi-nearby"==me.step&&me.nearbySites.length>0&&!me.isNonDuplicateConfirmed)return void(yield me.alertController.create({header:"Confirm",message:"Please confirm you are not adding a duplicate site.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:Xt=>{}},{text:"Confirm",handler:()=>{me.isNonDuplicateConfirmed=!0,me.next()}}]})).present();const qe=me.validate(me.step);if(qe.isValid){switch(me.step){case"location":me.step=me.isAddMode?"poi-nearby":"edit-equipment";break;case"poi-nearby":me.step=me.isAddMode?"copy-equipment":"edit-equipment";break;case"copy-equipment":me.step="edit-equipment";break;case"edit-equipment":me.step="info"}yield me.initCurrentStep(!0)}else(yield me.alertController.create({message:qe.msg})).present()})()}initCurrentStep(me){var qe=this;return(0,u.Z)(function*(){"poi-nearby"==qe.step?(qe.selectedTab="location",0==(yield qe.refreshNearbySites())&&(me?yield qe.next():yield qe.previous())):"location"==qe.step?qe.selectedTab="location":"copy-equipment"==qe.step?(qe.selectedTab="equipment",yield qe.refreshTemplateSites()):"edit-equipment"==qe.step?qe.selectedTab="equipment":"info"==qe.step&&(qe.selectedTab="info")})()}onCountryChange(){var me=this;return(0,u.Z)(function*(){me.refreshFilteredReferenceData()})()}onOperatorChange(me=null){var qe=this;return(0,u.Z)(function*(){null!=me&&qe.item.OperatorID!=me.ID&&(qe.item.OperatorID=me.ID,localStorage.setItem("_editor-operatorid",qe.item.OperatorID.toString()),yield qe.refreshTemplateSites())})()}useSuggestedAddress(me=null){me&&(this.suggestedAddress=me.suggestedAddress,this.suggestedAddressAttribution=me.suggestedAddressAttribution),Object.assign(this.item.AddressInfo,this.suggestedAddress),this.suggestedAddressAttribution&&(this.item.MetadataValues.find(qe=>4==qe.MetadataFieldID)||this.item.MetadataValues.push({ID:-1,MetadataFieldID:4,ItemValue:this.suggestedAddressAttribution,MetadataFieldOptionID:null,MetadataFieldOption:null}))}editConnection(me){var qe=this;return(0,u.Z)(function*(){const Rt=qe.item.Connections.find(Ki=>Ki.ID==me.ID),Xt=Object.assign({},Rt),Xn=yield qe.modalController.create({component:Re,componentProps:{conn:Xt}});return Xn.onWillDismiss().then(Ki=>{Ki&&Ki.data&&Ki.data.item&&qe.updateConnection(Ki.data.item)}),yield Xn.present()})()}deleteConnection(me){var qe=this;return(0,u.Z)(function*(){const Rt=qe.item.Connections.find(Xn=>Xn.ID==me.ID);(yield qe.alertController.create({header:"Confirm Delete",message:"Are you sure you want to delete this connection information?",buttons:[{text:"No",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Yes",handler:()=>{qe.item.Connections=qe.item.Connections.filter(Xn=>Xn.ID!=Rt.ID),qe.appManager.referenceDataManager.hydrateCompactPOI(qe.item,!0)}}]})).present()})()}addConnection(){var me=this;return(0,u.Z)(function*(){const qe={ID:-l.c.getRandomInt(1e4),ConnectionTypeID:null,StatusTypeID:50,PowerKW:null,Quantity:1},Rt=yield me.modalController.create({component:Re,componentProps:{conn:qe}});return Rt.onWillDismiss().then(Xt=>{Xt&&Xt.data&&Xt.data.item&&me.updateConnection(Xt.data.item)}),yield Rt.present()})()}refreshFilteredReferenceData(){this.appManager.referenceDataManager.refreshFilteredReferenceData(this.appManager.api,{CountryIds:[this.item.AddressInfo.CountryID]})}updateConnection(me){if(me){let qe=this.item.Connections.find(Rt=>Rt.ID==me.ID);qe?Object.assign(qe,me):this.item.Connections.push(me)}this.appManager.referenceDataManager.hydrateCompactPOI(this.item,!0)}validate(me="all"){let qe=null;return("all"==me||"location"==me)&&((!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(qe="Location is required"),""==this.item.AddressInfo.Title&&(qe="A location title is required"),this.item.AddressInfo.CountryID||(qe="A country selection is required"),(!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(qe="A location latitude and longitude is required")),("all"==me||"poi-nearby"==me)&&this.nearbySites.length>0&&!this.isNonDuplicateConfirmed&&(qe="Please confirm that the site is not a duplicate"),("all"==me||"equipment"==me)&&(this.item.OperatorID||(qe="Please confirm the charging network or equipment operator."),0==this.item.Connections.length&&(qe="Equipment information is required")),qe?(this.validationMsg=qe,{isValid:!1,msg:qe}):(this.validationMsg=null,{isValid:!0,msg:null})}save(){var me=this;return(0,u.Z)(function*(){let qe=me.validate();if(qe.isValid){yield me.presentLoadingUI();try{yield me.appManager.submitPOI(me.item),yield me.dismissLoadingUI(),me.appManager.showToastNotification("You submission will be reviewed (if required) and published shortly."),me.modalController.dismiss()}catch(Rt){yield me.dismissLoadingUI(),Rt.error&&alert("Sorry, your submission could not be completed at this time. Please try again later.")}}else alert(qe.msg)})()}cancel(){var me=this;return(0,u.Z)(function*(){me.modalController.dismiss()})()}refreshTemplateSites(){var me=this;return(0,u.Z)(function*(){if(me.item.AddressInfo.CountryID&&me.item.OperatorID){yield me.presentLoadingUI(),me.templateSites=[];let qe=new j.b;qe.countryIdList=[me.item.AddressInfo.CountryID],qe.minPowerKW=1,qe.operatorIdList=[me.item.OperatorID],qe.maxResults=10;let Rt=yield me.poiManager.fetchPOIList(qe);Rt.sort((Xt,Xn)=>new Date(Xt.DateCreated).getTime()-new Date(Xn.DateCreated).getTime()),me.templateSites=Rt,me.dismissLoadingUI()}})()}refreshNearbySites(){var me=this;return(0,u.Z)(function*(){if(me.item.AddressInfo.Latitude&&me.item.AddressInfo.Longitude){yield me.presentLoadingUI(),me.nearbySites=[];let qe=new j.b;qe.latitude=me.item.AddressInfo.Latitude,qe.longitude=me.item.AddressInfo.Longitude,qe.distance=5,qe.distanceUnit="km",qe.maxResults=10;let Rt=yield me.poiManager.fetchPOIList(qe);return Rt.sort((Xt,Xn)=>Xt.Distance-Xn.Distance),me.nearbySites=Rt,me.dismissLoadingUI(),Rt.length}return 0})()}confirmNonDuplicate(){this.isNonDuplicateConfirmed=!0,this.next()}changeTemplatePOI(){this.selectedTemplatePOI=null}editPOI(me){this.editExistingPOI(me.ID)}editExistingPOI(me){var qe=this;return(0,u.Z)(function*(){qe.skipPOICopy=!0,qe.isNonDuplicateConfirmed=!0,yield qe.presentLoadingUI(),qe.poiManager.getPOIById(me,!0,!0).then(Rt=>{qe.item=Object.assign({},Rt),null==qe.item.OperatorID&&(qe.item.OperatorID=Ge.UnknownOperator),qe.refreshFilteredReferenceData(),qe.dismissLoadingUI()})})()}useTemplatePOI(me){this.selectedTemplatePOI=me,Object.assign(this.item.Connections,me.Connections);for(let qe of this.item.Connections)qe.ID=-l.c.getRandomInt(1e4),qe.Reference=null,qe.Comments=null,qe.StatusTypeID=_t.Operational;this.item.UsageCost=me.UsageCost,this.item.UsageTypeID=me.UsageTypeID,this.appManager.referenceDataManager.hydrateCompactPOI(this.item)}skipCopyingPOI(){this.skipPOICopy=!0}}return Pe.\u0275fac=function(me){return new(me||Pe)(m.Y36(d.c),m.Y36(ge.IN),m.Y36(L.R),m.Y36(P.v),m.Y36(ge.HT),m.Y36(ge.Br))},Pe.\u0275cmp=m.Xpm({type:Pe,selectors:[["app-poi-editor"]],viewQuery:function(me,qe){if(1&me&&m.Gf(je,5),2&me){let Rt;m.iGM(Rt=m.CRH())&&(qe.editorMap=Rt.first)}},decls:33,vars:14,consts:[["slot","end"],[3,"click"],["name","close","slot","start"],[1,"ion-padding"],[3,"ngModel"],["value","location","layout","icon-start",3,"disabled"],["name","caret-forward",4,"ngIf"],["value","equipment","layout","icon-start",3,"disabled"],["value","info","layout","icon-start",3,"disabled"],[4,"ngIf"],["slot","start"],[3,"click",4,"ngIf"],["color","success",3,"click",4,"ngIf"],["name","caret-forward"],[3,"latitude","longitude","latitudeChange","longitudeChange","onUseSuggestedAddress"],["editorMap",""],["position","floating"],["type","text","autocapitalize","words","placeholder","A title for this location",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","The nearest street address",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Optional",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Town or City",3,"ngModel","ngModelChange"],["type","text",3,"ngModel","ngModelChange"],["type","text","autocapitalize","words","placeholder","Optional Postal Code",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["type","number","placeholder","Latitude (if entering manually)",3,"ngModel","ngModelChange"],["type","number","placeholder","Longitude (if entering manually)",3,"ngModel","ngModelChange"],[3,"value"],[1,"instruction"],[3,"poiList","enableEditOption","onEdit"],[3,"operatorId","operatorChanged"],["slot","start","size","small",3,"click"],[3,"enableCopyOption","poiList","onCopy"],[3,"operatorId","useFilteredOperators","operatorChanged"],["size","small",3,"click"],["name","add","slot","icon-only"],[3,"item","enableEdit","onEdit","onDelete"],["color","warning",4,"ngIf"],[3,"ngModel","ngModelChange"],["type","text","autocapitalize","sentences",3,"ngModel","ngModelChange"],["type","tel","placeholder","",3,"ngModel","ngModelChange"],["type","text","autocapitalize","sentences","placeholder","Instructions for access or tips for finding charging location",3,"ngModel","ngModelChange"],["type","url","placeholder","Website related to this site",3,"ngModel","ngModelChange"],["color","warning"],["color","danger"],["name","caret-back","slot","start"],["name","caret-forward","slot","end"],["color","success",3,"click"],["name","send","slot","end"]],template:function(me,qe){1&me&&(m.TgZ(0,"ion-header"),m.TgZ(1,"ion-toolbar"),m.TgZ(2,"ion-title"),m._uU(3),m.qZA(),m.TgZ(4,"ion-buttons",0),m.TgZ(5,"ion-button",1),m.NdJ("click",function(){return qe.cancel()}),m._UZ(6,"ion-icon",2),m._uU(7," Cancel "),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.TgZ(8,"ion-content",3),m.ynx(9),m.TgZ(10,"ion-segment",4),m.TgZ(11,"ion-segment-button",5),m.YNc(12,en,1,0,"ion-icon",6),m.TgZ(13,"ion-label"),m._uU(14,"Location"),m.qZA(),m.qZA(),m.TgZ(15,"ion-segment-button",7),m.YNc(16,Kt,1,0,"ion-icon",6),m.TgZ(17,"ion-label"),m._uU(18,"Equipment"),m.qZA(),m.qZA(),m.TgZ(19,"ion-segment-button",8),m.YNc(20,Wt,1,0,"ion-icon",6),m.TgZ(21,"ion-label"),m._uU(22,"Info"),m.qZA(),m.qZA(),m.qZA(),m.YNc(23,ft,3,2,"ng-container",9),m.YNc(24,yi,3,2,"ng-container",9),m.YNc(25,Qt,38,11,"ng-container",9),m.BQk(),m.qZA(),m.TgZ(26,"ion-footer"),m.TgZ(27,"ion-toolbar"),m.TgZ(28,"ion-buttons",10),m.YNc(29,Ye,3,0,"ion-button",11),m.qZA(),m.TgZ(30,"ion-buttons",0),m.YNc(31,te,3,0,"ion-button",11),m.YNc(32,Ae,3,0,"ion-button",12),m.qZA(),m.qZA(),m.qZA()),2&me&&(m.xp6(3),m.Oqu(qe.isAddMode?"Add Location":"Edit Location"),m.xp6(7),m.Q6J("ngModel",qe.selectedTab),m.xp6(1),m.Q6J("disabled",!0),m.xp6(1),m.Q6J("ngIf","location"==qe.selectedTab),m.xp6(3),m.Q6J("disabled",!0),m.xp6(1),m.Q6J("ngIf","equipment"==qe.selectedTab),m.xp6(3),m.Q6J("disabled",!0),m.xp6(1),m.Q6J("ngIf","info"==qe.selectedTab),m.xp6(3),m.Q6J("ngIf","location"==qe.selectedTab),m.xp6(1),m.Q6J("ngIf","equipment"==qe.selectedTab),m.xp6(1),m.Q6J("ngIf","info"==qe.selectedTab),m.xp6(4),m.Q6J("ngIf","location"!=qe.step),m.xp6(2),m.Q6J("ngIf",!qe.isReadyToSubmit&&"info"!=qe.step),m.xp6(1),m.Q6J("ngIf",qe.isReadyToSubmit))},directives:[ge.Gu,ge.sr,ge.wd,ge.Sm,ge.YG,ge.gu,ge.W2,ge.cJ,ge.QI,Fe.JJ,Fe.On,ge.GO,_e.O5,ge.Q$,je,ge.q_,ge.Ie,ge.pK,ge.j9,ge.t9,_e.sg,ge.n0,ge.as,wt.o,zt,Ht.B,ge.fr],styles:['ul.breadcrumb[_ngcontent-%COMP%]{display:inline-flex;margin:0;padding:0}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-flex;margin-right:6px;color:var(--ion-color-light-shade);font-size:10px}ul.breadcrumb[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{color:var(--ion-color-dark-shade)}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:">";padding-right:4px}']}),Pe})()},6763:(Tn,Je,R)=>{"use strict";R.d(Je,{u:()=>_t});var u=R(6738),d=R(9064),j=R(4120),l=R(3912),L=R(7689),P=R(129),m=R(529);let $=(()=>{class Ge{constructor(yt,wt){this.http=yt,this.journeyManager=wt}getDirections(yt,wt){return new Promise((xt,dt)=>{(new google.maps.DirectionsService).route({origin:yt,destination:wt,travelMode:google.maps.TravelMode.DRIVING},(Vt,Un)=>{Un===google.maps.DirectionsStatus.OK?xt(Vt):dt(Un)})})}analyseRoutes(yt,wt){const xt=new Array;return yt.routes.forEach(dt=>{const At=new P.JJ;At.Title=""+xt.length+1,At.JourneyRouteLegs=new Array,At.TotalDistanceKM=0,At.TotalDurationMinutes=0,At.TotalEnergykWh=0,dt.legs.forEach(Vt=>{const Un=Vt.duration.value,St=Vt.distance.value/1e3,$t=this.journeyManager.calculateEnergyConsumptionkWh(St,0,null,wt),zt=new P.eN;zt.DistanceKM=St,zt.DurationMinutes=Un/60,zt.EnergyConsumptionkWh=$t,At.JourneyRouteLegs.push(zt),At.TotalDistanceKM+=zt.DistanceKM,At.TotalDurationMinutes+=zt.DurationMinutes,At.TotalEnergykWh=zt.EnergyConsumptionkWh}),xt.push(At)}),xt}}return Ge.\u0275fac=function(yt){return new(yt||Ge)(u.LFG(m.eN),u.LFG(l.i))},Ge.\u0275prov=u.Yz7({token:Ge,factory:Ge.\u0275fac,providedIn:"root"}),Ge})();var ue=R(4781),V=R(6895),Z=R(4006),K=R(2428);function re(Ge,ot){if(1&Ge){const yt=u.EpF();u.TgZ(0,"ion-item"),u._UZ(1,"ion-icon",12),u.TgZ(2,"ion-searchbar",13),u.NdJ("ngModelChange",function(xt){return u.CHM(yt),u.oxw().routeStart=xt})("ionInput",function(xt){return u.CHM(yt),u.oxw(),u.MAs(18).getPlacesAutoComplete(xt,"routeStart")})("ionCancel",function(xt){return u.CHM(yt),u.oxw().onPlaceSearchCancel(xt)}),u.qZA(),u.qZA()}if(2&Ge){const yt=u.oxw();u.xp6(2),u.Q6J("ngModel",yt.routeStart)("debounce",500)}}function _e(Ge,ot){if(1&Ge){const yt=u.EpF();u.TgZ(0,"ion-item",14),u.NdJ("click",function(){return u.CHM(yt),u.oxw().clearRouteStart()}),u._UZ(1,"ion-icon",12),u.TgZ(2,"h2"),u._uU(3),u.qZA(),u.qZA()}if(2&Ge){u.oxw();const yt=u.MAs(18);u.xp6(3),u.Oqu(null==yt.selectedPlace?null:yt.selectedPlace.name)}}function ge(Ge,ot){if(1&Ge){const yt=u.EpF();u.TgZ(0,"ion-item"),u._UZ(1,"ion-icon",15),u.TgZ(2,"ion-searchbar",16),u.NdJ("ngModelChange",function(xt){return u.CHM(yt),u.oxw().routeDestination=xt})("ionInput",function(xt){return u.CHM(yt),u.oxw(),u.MAs(20).getPlacesAutoComplete(xt,"routeDestination")})("ionCancel",function(xt){return u.CHM(yt),u.oxw().onPlaceSearchCancel(xt)}),u.qZA(),u.qZA()}if(2&Ge){const yt=u.oxw();u.xp6(2),u.Q6J("ngModel",yt.routeDestination)("debounce",500)}}function xe(Ge,ot){if(1&Ge){const yt=u.EpF();u.TgZ(0,"ion-item",14),u.NdJ("click",function(){return u.CHM(yt),u.oxw().clearRouteDestination()}),u._UZ(1,"ion-icon",15),u.TgZ(2,"h2"),u._uU(3),u.qZA(),u.qZA()}if(2&Ge){u.oxw();const yt=u.MAs(20);u.xp6(3),u.Oqu(null==yt.selectedPlace?null:yt.selectedPlace.name)}}function je(Ge,ot){if(1&Ge){const yt=u.EpF();u.TgZ(0,"ion-button",14),u.NdJ("click",function(){return u.CHM(yt),u.oxw().clearRoute()}),u._UZ(1,"ion-icon",17),u._uU(2," Clear Route "),u.qZA()}}function nt(Ge,ot){if(1&Ge){const yt=u.EpF();u.TgZ(0,"ion-button",14),u.NdJ("click",function(){return u.CHM(yt),u.oxw().showSettings()}),u._uU(1," Show Settings "),u._UZ(2,"ion-icon",18),u.qZA()}}function Fe(Ge,ot){if(1&Ge){const yt=u.EpF();u.TgZ(0,"ion-button",14),u.NdJ("click",function(){return u.CHM(yt),u.oxw().hideSettings()}),u._uU(1," Hide Settings "),u._UZ(2,"ion-icon",18),u.qZA()}}function ke(Ge,ot){1&Ge&&(u.TgZ(0,"p",19),u._UZ(1,"ion-spinner",19),u._uU(2," Calculating Route.. "),u.qZA())}function Ne(Ge,ot){if(1&Ge&&(u.TgZ(0,"ion-list"),u.TgZ(1,"ion-list-header"),u._uU(2),u.ALo(3,"number"),u.ALo(4,"number"),u.qZA(),u.qZA()),2&Ge){const yt=u.oxw();u.xp6(2),u.lnq(" Total Distance ",u.xi3(3,3,yt.selectedJourneyRoute.TotalDistanceKM,"1.0-2")," km, ",yt.formatDuration(yt.selectedJourneyRoute.TotalDurationMinutes),", ",u.xi3(4,6,yt.selectedJourneyRoute.TotalEnergykWh,"1.0-2")," kWh ")}}function $e(Ge,ot){if(1&Ge){const yt=u.EpF();u.TgZ(0,"div"),u.TgZ(1,"ion-list"),u.TgZ(2,"ion-list-header"),u._UZ(3,"ion-icon",20),u._uU(4," Route Settings "),u.qZA(),u.TgZ(5,"ion-item"),u.TgZ(6,"ion-label",21),u._uU(7),u.qZA(),u.TgZ(8,"ion-range",22),u.NdJ("ngModelChange",function(xt){return u.CHM(yt),u.oxw().routeSearchDistance=xt}),u._UZ(9,"ion-icon",23),u._UZ(10,"ion-icon",24),u.qZA(),u.qZA(),u.TgZ(11,"ion-item"),u.TgZ(12,"ion-label",21),u._uU(13,"Energy Efficiency (kWh Per km)"),u.qZA(),u.TgZ(14,"ion-input",25),u.NdJ("ngModelChange",function(xt){return u.CHM(yt),u.oxw().kWhPerKM=xt}),u.qZA(),u.qZA(),u.qZA(),u.qZA()}if(2&Ge){const yt=u.oxw();u.xp6(7),u.hij("Search Distance (",yt.routeSearchDistance,")"),u.xp6(1),u.Q6J("ngModel",yt.routeSearchDistance),u.xp6(6),u.Q6J("ngModel",yt.kWhPerKM)}}let Re=(()=>{class Ge{constructor(yt,wt,xt,dt,At,Vt){this.mapping=yt,this.logging=wt,this.directions=xt,this.journeyManager=dt,this.changeDetector=At,this.numberPipe=Vt,this.routeSearchDistance=5,this.routeCalcInProgress=!1,this.advancedSettingsMode=!1,this.routeStart="",this.routeDestination="",this.kWhPerKM=.212}get isRouteSet(){return null!=this.routeStartPlace&&null!=this.routeDestinationPlace}showSettings(){this.advancedSettingsMode=!0}hideSettings(){this.advancedSettingsMode=!1}routeStartSelected(yt){this.routeStartPlace=yt,this.calculateRoute(),this.changeDetector.detectChanges()}routeDestinationSelected(yt){this.routeDestinationPlace=yt,this.calculateRoute(),this.changeDetector.detectChanges()}clearRouteStart(){this.routeStartPlace=null,this.changeDetector.detectChanges()}clearRouteDestination(){this.routeDestinationPlace=null,this.changeDetector.detectChanges()}clearRoute(){this.routeStartPlace=null,this.routeDestinationPlace=null,this.journeyManager.setRoutePolyline(null),this.mapping.clearPolyline()}formatDuration(yt){if(yt<=60)return this.numberPipe.transform(yt,"1.0-2")+" mins";{const wt=Math.round(yt/60),xt=Math.floor(yt-60*wt);return wt+" hours "+(xt>0?xt+" mins":"")}}calculateRoute(){null!=this.routeStartPlace&&null!=this.routeDestinationPlace&&(this.logging.log("Fetching route directions.."),this.routeCalcInProgress=!0,this.directions.getDirections(this.routeStartPlace.Location.latitude+","+this.routeStartPlace.Location.longitude,this.routeDestinationPlace.Location.latitude+","+this.routeDestinationPlace.Location.longitude).then(yt=>{if(null!=yt.routes&&yt.routes.length>0){this.logging.log("Got route directions, analysing.."),this.routePolyline=yt.routes[0].overview_polyline;const wt=yt.routes[0].bounds.getSouthWest(),xt=yt.routes[0].bounds.getNorthEast(),dt=new j.wC(xt.lat(),xt.lng()),At=new j.wC(wt.lat(),wt.lng()),Vt=new j.LL(dt,At);this.journeyRoutes=this.directions.analyseRoutes(yt,this.kWhPerKM),this.journeyRoutes.length>0&&(this.selectedJourneyRoute=this.journeyRoutes[0]),this.journeyManager.setRoutePolyline(this.routePolyline),this.mapping.renderPolyline(this.routePolyline),this.mapping.moveToMapBounds(Vt)}else this.logging.log("No route returned..");this.routeCalcInProgress=!1}))}}return Ge.\u0275fac=function(yt){return new(yt||Ge)(u.Y36(ue.v),u.Y36(L.z),u.Y36($),u.Y36(l.i),u.Y36(u.sBO),u.Y36(V.JJ))},Ge.\u0275cmp=u.Xpm({type:Ge,selectors:[["route-planner"]],decls:24,vars:10,consts:[[1,"route"],[1,"route-places"],["name","map","slot","start"],[4,"ngIf"],[3,"click",4,"ngIf"],["primary",""],["slot","secondary"],["slot","primary"],[3,"placeChanged"],["placeSearchRouteStart",""],["placeSearchRouteDestination",""],["class","ion-padding",4,"ngIf"],["name","ionic","item-left",""],["placeholder","Starting Point",3,"ngModel","debounce","ngModelChange","ionInput","ionCancel"],[3,"click"],["name","pin","item-left",""],["placeholder","Destination",3,"ngModel","debounce","ngModelChange","ionInput","ionCancel"],["name","close","slot","start"],["name","cog","slot","end"],[1,"ion-padding"],["name","cog"],["position","stacked"],["min","1","max","200","step","5","snaps","true","pin","true","light","",3,"ngModel","ngModelChange"],["slot","start","small","","name","map"],["slot","end","large","","name","map"],["type","number","min","0.1","max","1",3,"ngModel","ngModelChange"]],template:function(yt,wt){1&yt&&(u.TgZ(0,"div",0),u.TgZ(1,"div",1),u.TgZ(2,"ion-list"),u.TgZ(3,"ion-list-header"),u._UZ(4,"ion-icon",2),u.TgZ(5,"ion-label"),u._uU(6,"Plan Your Journey"),u.qZA(),u.qZA(),u.YNc(7,re,3,2,"ion-item",3),u.YNc(8,_e,4,1,"ion-item",4),u.YNc(9,ge,3,2,"ion-item",3),u.YNc(10,xe,4,1,"ion-item",4),u.qZA(),u.TgZ(11,"ion-toolbar",5),u.TgZ(12,"ion-buttons",6),u.YNc(13,je,3,0,"ion-button",4),u.qZA(),u.TgZ(14,"ion-buttons",7),u.YNc(15,nt,3,0,"ion-button",4),u.YNc(16,Fe,3,0,"ion-button",4),u.qZA(),u.qZA(),u.qZA(),u.TgZ(17,"place-search",8,9),u.NdJ("placeChanged",function(dt){return wt.routeStartSelected(dt)}),u.qZA(),u.TgZ(19,"place-search",8,10),u.NdJ("placeChanged",function(dt){return wt.routeDestinationSelected(dt)}),u.qZA(),u.YNc(21,ke,3,0,"p",11),u.YNc(22,Ne,5,9,"ion-list",3),u.YNc(23,$e,15,3,"div",3),u.qZA()),2&yt&&(u.xp6(7),u.Q6J("ngIf",null==wt.routeStartPlace),u.xp6(1),u.Q6J("ngIf",null!=wt.routeStartPlace),u.xp6(1),u.Q6J("ngIf",null==wt.routeDestinationPlace),u.xp6(1),u.Q6J("ngIf",null!=wt.routeDestinationPlace),u.xp6(3),u.Q6J("ngIf",wt.isRouteSet),u.xp6(2),u.Q6J("ngIf",!wt.advancedSettingsMode),u.xp6(1),u.Q6J("ngIf",wt.advancedSettingsMode),u.xp6(5),u.Q6J("ngIf",wt.routeCalcInProgress),u.xp6(1),u.Q6J("ngIf",null!=wt.selectedJourneyRoute),u.xp6(1),u.Q6J("ngIf",wt.advancedSettingsMode))},directives:[d.q_,d.yh,d.gu,d.Q$,V.O5,d.Ie,d.VI,d.j9,Z.JJ,Z.On,d.sr,d.Sm,d.YG,K.v,d.PQ,d.I_,d.QI,d.pK,d.as],pipes:[V.JJ],encapsulation:2}),Ge})(),_t=(()=>{class Ge{constructor(yt){this.modalController=yt,this.hasNavbar=!1}close(){this.modalController.dismiss()}}return Ge.\u0275fac=function(yt){return new(yt||Ge)(u.Y36(d.IN))},Ge.\u0275cmp=u.Xpm({type:Ge,selectors:[["ng-component"]],decls:10,vars:0,consts:[["slot","end"],[3,"click"],["name","close","slot","end"],[1,"route-planner","ion-padding"]],template:function(yt,wt){1&yt&&(u.TgZ(0,"ion-header"),u.TgZ(1,"ion-toolbar"),u.TgZ(2,"ion-title"),u._uU(3," Route Planner "),u.qZA(),u.TgZ(4,"ion-buttons",0),u.TgZ(5,"ion-button",1),u.NdJ("click",function(){return wt.close()}),u._UZ(6,"ion-icon",2),u._uU(7," Close "),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.TgZ(8,"ion-content",3),u._UZ(9,"route-planner"),u.qZA())},directives:[d.Gu,d.sr,d.wd,d.Sm,d.YG,d.gu,d.W2,Re],encapsulation:2}),Ge})()},9671:(Tn,Je,R)=>{"use strict";R.r(Je),R.d(Je,{SearchPageModule:()=>Yt});var u=R(8936),d=R(9397),j=R(6895),l=R(4006),L=R(9064),P=R(3334),m=R(6099),$=R(2340),ue=R(2951),V=R(6314),Z=R(6763),K=R(3399),re=R(4120),_e=R(2206),ge=R(6579),xe=R(7689),je=R(3912),nt=R(4781),Fe=R(9698),ke=R(3855),Ne=R(2428),$e=R(3753),Re=R(3489),_t=R(6686);const yt=new(R(2268).v)(_t.o);class xt{constructor(Gt,ft){this.dueTime=Gt,this.scheduler=ft}call(Gt,ft){return ft.subscribe(new dt(Gt,this.dueTime,this.scheduler))}}class dt extends Re.L{constructor(Gt,ft,Ut){super(Gt),this.dueTime=ft,this.scheduler=Ut,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(Gt){this.clearDebounce(),this.lastValue=Gt,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(At,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:Gt}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(Gt)}}clearDebounce(){const Gt=this.debouncedSubscription;null!==Gt&&(this.remove(Gt),Gt.unsubscribe(),this.debouncedSubscription=null)}}function At(qt){qt.debouncedNext()}const Un=(0,R(7423).fo)("Geolocation",{web:()=>R.e(4561).then(R.bind(R,4561)).then(qt=>new qt.GeolocationWeb)});var St=R(6738),$t=R(6260);function zt(qt,Gt){1&qt&&St._UZ(0,"ion-icon",13)}function Ht(qt,Gt){1&qt&&St._UZ(0,"ion-spinner")}function en(qt,Gt){if(1&qt){const ft=St.EpF();St.TgZ(0,"ion-button",3),St.NdJ("click",function(){return St.CHM(ft),St.oxw().openSideView()}),St._UZ(1,"ion-icon",14),St.qZA()}}function Kt(qt,Gt){1&qt&&(St.ynx(0),St.TgZ(1,"div",15),St.TgZ(2,"p"),St._uU(3,"There was a problem communicating with Open Charge Map. Please check your data connection."),St.qZA(),St.qZA(),St.BQk())}let Wt=(()=>{class qt{constructor(ft,Ut,On,fn,Gn,ei,$i,sr,zi,yi,ji,_i){this.appManager=ft,this.nav=Ut,this.events=On,this.translate=fn,this.platform=Gn,this.poiManager=ei,this.mapping=$i,this.journeyManager=sr,this.zone=zi,this.modalController=yi,this.alertController=ji,this.logging=_i,this.mapDisplayed=!1,this.initialResultsShown=!1,this.searchOnDemand=!1,this.poiViewMode="modal",this.sideViewAvailable=!1,this.routePlanningMode=!0,this.searchKeyword="",this.appConfig=new ue.X,this.defaultMapZoom=15,this.defaultStartPos=new re.wC(37.415328,-122.076575),this._watchId=null,this.mapCanvasID="map-canvas",this.mapping.setMapType(ft.searchSettings.MapType),this.mapping.setMapAPI($.N.defaultMapProvider),(0,$e.R)(window,"resize").pipe(function wt(qt,Gt=yt){return ft=>ft.lift(new xt(qt,Gt))}(500)).subscribe(Qt=>{let Ye={width:ge.c.getClientHeight(),height:ge.c.getClientWidth()};this.events.publish("ocm:window:resized",[Ye])})}ionViewDidEnter(){this.logging.log("Entered search page.",xe.i.VERBOSE),this.mapping.focusMap(),this.mapping.updateMapSize()}ionViewWillLeave(){this.logging.log("Leaving search page.",xe.i.VERBOSE),this.mapping.unfocusMap()}getPreferredMapHeight(ft){return null==ft&&(ft=ge.c.getClientHeight()),ft-56}enforceMapHeight(ft){this.logging.log("Would resize map:"+ft.width+" "+ft.height,xe.i.VERBOSE),this.checkViewportMode();const Ut=this.getPreferredMapHeight(ft[0]);document.getElementById(this.mapCanvasID).offsetHeight!==Ut&&(document.getElementById(this.mapCanvasID).style.height=Ut+"px"),this.mapping&&(this.logging.log("Map height:"+Ut,xe.i.VERBOSE),this.mapping.updateMapSize())}checkViewportMode(){}initialiseMapping(){var ft=this;return(0,m.Z)(function*(){yield ft.platform.ready(),ft.debouncedRefreshMapResults=ge.c.debounce(ft.refreshMapResults,1e3,!1),ft.events.subscribe("ocm:mapping:ready",(0,m.Z)(function*(){if(ft.logging.log("init map: mapping ready"),ft.mapping&&ft.mapping.updateMapSize(),!ft.initialResultsShown)if(ft.appManager.searchSettings.StartSearchPosition)ft.searchOnDemand=!0,ft.mapping.updateMapCentrePos(ft.appManager.searchSettings.StartSearchPosition.latitude,ft.appManager.searchSettings.StartSearchPosition.longitude,!0,ft.defaultMapZoom);else{let Ut=localStorage.getItem("_locationEnabled");1==ft.appManager.isEmbeddedMode&&"true"!=Ut?yield(yield ft.alertController.create({header:"Search using your location?",message:"Select OK to continue.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:(fn=(0,m.Z)(function*(Gn){yield ft.useFallbackPosition()}),function(ei){return fn.apply(this,arguments)})},{text:"OK",handler:function(){var fn=(0,m.Z)(function*(){yield ft.locateUser()});return function(){return fn.apply(this,arguments)}}()}]})).present():(yield ft.locateUser(),ft.mapping&&ft.mapping.updateMapSize())}var fn})),ft.events.subscribe("ocm:mapping:zoom",()=>{ft.debouncedRefreshMapResults()}),ft.events.subscribe("ocm:mapping:dragend",()=>{ft.debouncedRefreshMapResults()}),ft.events.subscribe("ocm:poiList:updated",Ut=>{ft.showPOIListOnMap(Ut)}),ft.events.subscribe("ocm:poiList:cleared",()=>{ft.mapping.clearMarkers(),setTimeout(()=>{ft.debouncedRefreshMapResults()},500)}),ft.events.subscribe("ocm:window:resized",Ut=>{null!=Ut&&Ut.length>0&&ft.enforceMapHeight(Ut[0])}),ft.events.subscribe("ocm:poi:selected",Ut=>{if(Ut.poi)ft.viewPOIDetails(Ut,Ut.poi);else{let On=ft.getPOIByID(Ut.poiId);ft.viewPOIDetails(Ut,On)}}),ft.checkViewportMode(),ft.mapping.initMap(ft.mapCanvasID)})()}ngAfterViewInit(){var ft=this;return(0,m.Z)(function*(){yield ft.initialiseMapping()})()}ngOnInit(){var ft=this;return(0,m.Z)(function*(){ft.logging.log("Refreshing reference data ..",xe.i.VERBOSE),(yield ft.appManager.referenceDataManager.refreshReferenceData(ft.appManager.api))||(ft.appManager.isOffline=!0)})()}showPOIListOnMap(ft){const Ut=this.getPreferredMapHeight(null);this.mapping.refreshMapView(Ut,this.poiManager.poiList,null),this.mapDisplayed||(this.mapDisplayed=!0)}getIconForPOI(ft){return ge.c.getIconForPOI(ft)}getPOIByID(ft){const Ut=this.poiManager.poiList;for(let On=0;On<Ut.length;On++)if(Ut[On].ID===ft)return Ut[On];return null}refreshMapResults(){var ft=this;return(0,m.Z)(function*(){if(!ft.searchOnDemand)return void ft.logging.log("Skipping refresh, search on demand disabled..",xe.i.VERBOSE);ft.logging.log("Refreshing Results..",xe.i.VERBOSE);const Ut=new _e.b;let On=null;if(ft.appManager.searchSettings.StartSearchPosition&&(On=new re.jR(ft.appManager.searchSettings.StartSearchPosition.latitude,ft.appManager.searchSettings.StartSearchPosition.longitude),ft.appManager.searchSettings.StartSearchPosition=null),On&&0==On.coords.latitude&&0==On.coords.longitude)return void ft.logging.log("Map center is zero. No query will be performed",xe.i.WARNING);if(null!=On)Ut.latitude=On.coords.latitude,Ut.longitude=On.coords.longitude,Ut.distance=25,Ut.boundingbox=null,ft.appManager.searchSettings.LastSearchPosition=new re.wC(On.coords.latitude,On.coords.longitude);else{Ut.latitude=null,Ut.longitude=null;let Gn=yield ft.mapping.getMapBounds().toPromise();Ut.boundingbox="("+Gn[0].latitude+","+Gn[0].longitude+"),("+Gn[1].latitude+","+Gn[1].longitude+")",ft.logging.log(JSON.stringify(Gn),xe.i.VERBOSE)}Ut.includeComments=!0,Ut.enableCaching=!0,null!=ft.appManager.searchSettings&&(null!=ft.appManager.searchSettings.ConnectionTypeList&&(Ut.connectionTypeIdList=ft.appManager.searchSettings.ConnectionTypeList),null!=ft.appManager.searchSettings.UsageTypeList&&(Ut.usageTypeIdList=ft.appManager.searchSettings.UsageTypeList),null!=ft.appManager.searchSettings.StatusTypeList&&(Ut.statusTypeIdList=ft.appManager.searchSettings.StatusTypeList),null!=ft.appManager.searchSettings.OperatorList&&(Ut.operatorIdList=ft.appManager.searchSettings.OperatorList),null!=ft.appManager.searchSettings.MinPowerKW&&ft.appManager.searchSettings.MinPowerKW>0&&(Ut.minPowerKW=ft.appManager.searchSettings.MinPowerKW),null!=ft.appManager.searchSettings.MaxPowerKW&&ft.appManager.searchSettings.MaxPowerKW>0&&(Ut.maxPowerKW=ft.appManager.searchSettings.MaxPowerKW),null!=ft.journeyManager.getRoutePolyline()&&(Ut.polyline=ft.journeyManager.getRoutePolyline(),Ut.boundingbox=null,Ut.levelOfDetail=null,Ut.latitude=null,Ut.longitude=null)),ft.appManager.isRequestInProgress=!0;let fn=yield ft.poiManager.refreshPOIList(Ut);ft.appManager.isRequestInProgress=!1,ft.initialResultsShown=!0,fn>=Ut.maxResults&&ft.appManager.showToastNotification("A maximum of "+fn+" results are returned per search. Zoom in for details.")})()}viewPOIDetails(ft,Ut){this.logging.log("Viewing/fetching ["+this.poiViewMode+"] POI Details "+ft.poiId),null!=Ut?(this.mapping.unfocusMap(),this.modalController.create({component:K.H,componentProps:{item:Ut}}).then(On=>{On.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),On.present()})):this.poiManager.getPOIById(ft.poiId,!0).then(On=>{this.logging.log("Got POI Details "+On.ID),"modal"===this.poiViewMode&&(this.searchOnDemand=!1,this.modalController.create({component:K.H,componentProps:{item:On}}).then(fn=>{fn.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),fn.present()}),this.mapping.unfocusMap()),"side"===this.poiViewMode&&(this.selectedPOI=On)},On=>{this.appManager.showToastNotification("POI Details not available")})}closePOIDetails(){this.selectedPOI=null}openRoutePlannerModal(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:Z.u}).then(ft=>{ft.onDidDismiss().then(Ut=>{this.logging.log("Dismissing Route Planner Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),ft.present()})}openSearchOptions(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:V.N}).then(ft=>{ft.onDidDismiss().then(Ut=>{this.mapping.focusMap(),this.searchOnDemand=!0}),ft.present()})}openSideView(){this.poiViewMode="side",this.mapping.updateMapSize()}closeSideView(){this.poiViewMode="modal",this.mapping.updateMapSize()}planRoute(){this.routePlanningMode=!0}search(ft){this.placeSearchMapPOI.getPlacesAutoComplete(ft,"poiSearch")}useFallbackPosition(){let ft=this.defaultStartPos;null!=this.appManager.searchSettings.LastSearchPosition&&(ft=this.appManager.searchSettings.LastSearchPosition),this.appManager.searchSettings.StartSearchPosition=ft,this.appManager.searchSettings.LastSearchPosition=null,this.searchOnDemand=!0,this.mapping.updateMapCentrePos(ft.latitude,ft.longitude,!0,this.defaultMapZoom)}getPosition(ft={}){var Ut=this;return(0,m.Z)(function*(){return new Promise((On,fn)=>{Ut._watchId=Un.watchPosition(ft,(Gn,ei)=>{Un.clearWatch({id:Ut._watchId}),ei?fn(ei):On(Gn)})})})()}locateUser(){var ft=this;return(0,m.Z)(function*(){ft.useFallbackPosition();try{ft.logging.log("Attempting to locate user..");const Ut=yield ft.getPosition({timeout:1e4});if(!Ut)throw"Failed to get user location.";return ft.logging.log("Got user location."),ft.appManager.searchSettings.StartSearchPosition=new re.wC(Ut.coords.latitude,Ut.coords.longitude),ft.searchOnDemand=!0,ft.mapping.updateMapCentrePos(Ut.coords.latitude,Ut.coords.longitude,!0,ft.defaultMapZoom),localStorage.setItem("_locationEnabled","true"),!0}catch(Ut){return ft.logging.log("Failed to get user location. Searching using default or last position."+Ut),ft.appManager.showToastNotification("Your location could not be determined."),ft.useFallbackPosition(),!1}})()}placeSelected(ft){this.searchKeyword=ft.Address,this.logging.log("Got place details:"+ft.Address),this.mapping.focusMap(),this.mapping.updateMapCentrePos(ft.Location.latitude,ft.Location.longitude,!0),this.debouncedRefreshMapResults()}}return qt.\u0275fac=function(ft){return new(ft||qt)(St.Y36(ke.c),St.Y36(L.SH),St.Y36($t.z),St.Y36(d.sK),St.Y36(L.t4),St.Y36(Fe.R),St.Y36(nt.v),St.Y36(je.i),St.Y36(St.R0b),St.Y36(L.IN),St.Y36(L.Br),St.Y36(xe.z))},qt.\u0275cmp=St.Xpm({type:qt,selectors:[["ng-component"]],viewQuery:function(ft,Ut){if(1&ft&&St.Gf(Ne.v,7),2&ft){let On;St.iGM(On=St.CRH())&&(Ut.placeSearchMapPOI=On.first)}},decls:18,vars:10,consts:[["slot","start"],["autocapitalize","on","autocomplete","on",3,"ngModel","placeholder","debounce","ngModelChange","ionInput"],["slot","end"],[3,"click"],["name","locate","slot","start",4,"ngIf"],[4,"ngIf"],[3,"color","click"],["name","options","slot","end"],[3,"click",4,"ngIf"],[1,"search-page"],[3,"placeChanged"],["placeSearchMapPOI",""],["id","map-canvas",2,"height","100%","width","100%","min-height","300px"],["name","locate","slot","start"],["name","car","title","Route","slot","end"],[2,"position","absolute"]],template:function(ft,Ut){1&ft&&(St.TgZ(0,"ion-header"),St.TgZ(1,"ion-toolbar"),St.TgZ(2,"ion-buttons",0),St._UZ(3,"ion-menu-button"),St.qZA(),St.TgZ(4,"ion-searchbar",1),St.NdJ("ngModelChange",function(fn){return Ut.searchKeyword=fn})("ionInput",function(fn){return Ut.search(fn)}),St.ALo(5,"translate"),St.qZA(),St.TgZ(6,"ion-buttons",2),St.TgZ(7,"ion-button",3),St.NdJ("click",function(){return Ut.locateUser()}),St.YNc(8,zt,1,0,"ion-icon",4),St.YNc(9,Ht,1,0,"ion-spinner",5),St.qZA(),St.TgZ(10,"ion-button",6),St.NdJ("click",function(){return Ut.openSearchOptions()}),St._UZ(11,"ion-icon",7),St.qZA(),St.YNc(12,en,2,0,"ion-button",8),St.qZA(),St.qZA(),St.qZA(),St.TgZ(13,"ion-content",9),St.TgZ(14,"place-search",10,11),St.NdJ("placeChanged",function(fn){return Ut.placeSelected(fn)}),St.qZA(),St.YNc(16,Kt,4,0,"ng-container",5),St._UZ(17,"div",12),St.qZA()),2&ft&&(St.xp6(4),St.Q6J("ngModel",Ut.searchKeyword)("placeholder",St.lcZ(5,8,"ocm.search.performSearch"))("debounce",500),St.xp6(4),St.Q6J("ngIf",!Ut.appManager.isRequestInProgress),St.xp6(1),St.Q6J("ngIf",Ut.appManager.isRequestInProgress),St.xp6(1),St.Q6J("color",Ut.appManager.searchSettings.HasActiveFilters?"danger":"default"),St.xp6(2),St.Q6J("ngIf",1==Ut.sideViewAvailable&&"modal"==Ut.poiViewMode),St.xp6(4),St.Q6J("ngIf",Ut.appManager.isOffline))},directives:[L.Gu,L.sr,L.Sm,L.fG,L.VI,L.j9,l.JJ,l.On,L.YG,j.O5,L.gu,L.PQ,L.W2,Ne.v],pipes:[d.X$],styles:[".search-page[_ngcontent-%COMP%]   #map-canvas[_ngcontent-%COMP%]{width:100%;height:98%}.search-page[_ngcontent-%COMP%]   #place-search[_ngcontent-%COMP%]{min-height:300px;background-color:#f0f0f0;position:absolute;z-index:100;width:100%}.search-page[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]{flex:.4}.search-page[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%], .search-page[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%], .search-page[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding:0}.search-page[_ngcontent-%COMP%]   scroll-content[_ngcontent-%COMP%]{overflow-y:hidden}.search-page[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]{padding-left:2em}.search-page[_ngcontent-%COMP%]   .sideview[_ngcontent-%COMP%]{background:#eeeeee;background:linear-gradient(to bottom,#eeeeee 0%,white 100%)}"]}),qt})(),Yt=(()=>{class qt{}return qt.\u0275fac=function(ft){return new(ft||qt)},qt.\u0275mod=St.oAB({type:qt}),qt.\u0275inj=St.cJS({imports:[[j.ez,l.u5,L.Pc,d.aw,u.e,P.Bz.forChild([{path:"",component:Wt}])]]}),qt})()},6314:(Tn,Je,R)=>{"use strict";R.d(Je,{N:()=>$e});var u=R(6099),d=R(9698),j=R(3855),l=R(7627),L=R(6579),P=R(4781),m=R(6738),$=R(9064),ue=R(6260),V=R(6895),Z=R(4006),K=R(9397);let re=(()=>{class Re extends K.X${constructor(Ge,ot){super(Ge,ot)}transform(Ge,...ot){let yt=super.transform(Ge,...ot);return yt==Ge?null!=ot&&ot[0].default?ot[0].default:ot[0].Title?ot[0].Title:yt:yt}}return Re.\u0275fac=function(Ge){return new(Ge||Re)(m.Y36(K.sK,16),m.Y36(m.sBO,16))},Re.\u0275pipe=m.Yjl({name:"nullableTranslate",type:Re,pure:!0}),Re.\u0275prov=m.Yz7({token:Re,factory:Re.\u0275fac}),Re})();function _e(Re,_t){if(1&Re){const Ge=m.EpF();m.TgZ(0,"p",21),m._UZ(1,"ion-icon",22),m._uU(2," One or more filters are currently being applied. "),m.TgZ(3,"ion-button",23),m.NdJ("click",function(){return m.CHM(Ge),m.oxw().clearFilters()}),m._UZ(4,"ion-icon",24),m.TgZ(5,"ion-label"),m._uU(6,"Clear"),m.qZA(),m.qZA(),m.qZA()}}function ge(Re,_t){if(1&Re&&(m.TgZ(0,"ion-select-option",26),m._uU(1),m.qZA()),2&Re){const Ge=_t.$implicit;m.Q6J("value",Ge.ID),m.xp6(1),m.Oqu(Ge.Title)}}function xe(Re,_t){if(1&Re){const Ge=m.EpF();m.TgZ(0,"ion-item"),m.TgZ(1,"ion-label"),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.TgZ(4,"ion-select",14),m.NdJ("ngModelChange",function(yt){return m.CHM(Ge),m.oxw().searchSettings.FilterOptionsByCountryId=yt})("ionChange",function(){return m.CHM(Ge),m.oxw().onCountryChange()}),m.TgZ(5,"ion-select",25),m._uU(6,"(All Countries)"),m.qZA(),m.YNc(7,ge,2,2,"ion-select-option",4),m.qZA(),m.qZA()}if(2&Re){const Ge=m.oxw();m.xp6(2),m.Oqu(m.lcZ(3,3,"ocm.search.countries")),m.xp6(2),m.Q6J("ngModel",Ge.searchSettings.FilterOptionsByCountryId),m.xp6(3),m.Q6J("ngForOf",Ge.countries)}}function je(Re,_t){if(1&Re&&(m.TgZ(0,"ion-select-option",26),m._uU(1),m.ALo(2,"nullableTranslate"),m.qZA()),2&Re){const Ge=_t.$implicit;m.Q6J("value",Ge.ID),m.xp6(1),m.Oqu(m.xi3(2,2,"ocm.reference.operatorInfo.value_"+Ge.ID,Ge))}}function nt(Re,_t){if(1&Re&&(m.TgZ(0,"ion-select-option",26),m._uU(1),m.ALo(2,"nullableTranslate"),m.qZA()),2&Re){const Ge=_t.$implicit;m.Q6J("value",Ge.ID),m.xp6(1),m.Oqu(m.xi3(2,2,"ocm.reference.usageType.value_"+Ge.ID,Ge))}}function Fe(Re,_t){if(1&Re&&(m.TgZ(0,"ion-select-option",26),m._uU(1),m.ALo(2,"nullableTranslate"),m.qZA()),2&Re){const Ge=_t.$implicit;m.Q6J("value",Ge.ID),m.xp6(1),m.Oqu(m.xi3(2,2,"ocm.reference.statusType.value_"+Ge.ID,Ge))}}function ke(Re,_t){if(1&Re&&(m.TgZ(0,"ion-select-option",26),m._uU(1),m.ALo(2,"nullableTranslate"),m.qZA()),2&Re){const Ge=_t.$implicit;m.Q6J("value",Ge.ID),m.xp6(1),m.Oqu(m.xi3(2,2,"ocm.reference.connectionType.value_"+Ge.ID,Ge))}}function Ne(Re,_t){if(1&Re&&(m.TgZ(0,"ion-select-option",26),m._uU(1),m.qZA()),2&Re){const Ge=_t.$implicit;m.Q6J("value",Ge.code),m.xp6(1),m.Oqu(Ge.title)}}let $e=(()=>{class Re{constructor(Ge,ot,yt,wt,xt){this.appManager=Ge,this.poiManager=ot,this.mapping=yt,this.modalController=wt,this.events=xt,this.maxPower=l.U,this.powerRange={lower:0,upper:this.maxPower},this._languages=[],this.searchSettings=Ge.searchSettings}ngOnInit(){var Ge=this;return(0,u.Z)(function*(){null!=Ge.searchSettings.MinPowerKW&&(Ge.powerRange.lower=Ge.searchSettings.MinPowerKW),null!=Ge.searchSettings.MaxPowerKW&&(Ge.powerRange.upper=Ge.searchSettings.MaxPowerKW),0==Ge.powerRange.upper&&(Ge.powerRange.upper=Ge.maxPower),Ge.appManager.analytics.viewEvent("Settings"),Ge.useFilteredOptions&&(yield Ge.onCountryChange())})()}get useFilteredOptions(){return this.searchSettings.FilterOptionsByCountryId>0}clearFilters(){this.searchSettings.ClearActiveFilters(),this.powerRange={lower:0,upper:this.maxPower},this.searchSettings.CheckForActiveFilters()}get operators(){return this.appManager.referenceDataManager.getNetworkOperators(this.useFilteredOptions)}get connectionTypes(){return this.appManager.referenceDataManager.getConnectionTypes(this.useFilteredOptions)}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes(this.useFilteredOptions)}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes(this.useFilteredOptions)}get countries(){return this.appManager.referenceDataManager.getCountries(this.useFilteredOptions)}get isCountryFilterFeatureEnabled(){return L.c.isFeatureEnabled("FILTER_OPTIONS_BY_COUNTRY")}get languages(){return this._languages.length>0||(this._languages=this.appManager.getLanguages()),this._languages}ionViewWillLeave(){null!=this.searchSettings.Language&&this.appManager.setLanguage(this.searchSettings.Language),this.searchSettings.MinPowerKW=this.powerRange.lower,this.searchSettings.MaxPowerKW=this.powerRange.upper,1==this.searchSettings.MinPowerKW&&(this.searchSettings.MinPowerKW=null),this.searchSettings.MaxPowerKW==this.maxPower&&(this.searchSettings.MaxPowerKW=null),this.appManager.searchSettings=this.searchSettings,this.appManager.saveSearchSettings(),this.events.publish("ocm:poiList:cleared")}onLanguageChange(){null!=this.searchSettings.Language&&""!=this.searchSettings.Language&&this.appManager.setLanguage(this.searchSettings.Language)}onCountryChange(){var Ge=this;return(0,u.Z)(function*(){Ge.appManager.referenceDataManager.refreshFilteredReferenceData(Ge.appManager.api,{CountryIds:[Ge.searchSettings.FilterOptionsByCountryId]})})()}onMapTypeChange(){var Ge=this;return(0,u.Z)(function*(){Ge.mapping.setMapType(Ge.searchSettings.MapType)})()}close(){this.modalController.dismiss()}}return Re.\u0275fac=function(Ge){return new(Ge||Re)(m.Y36(j.c),m.Y36(d.R),m.Y36(P.v),m.Y36($.IN),m.Y36(ue.z))},Re.\u0275cmp=m.Xpm({type:Re,selectors:[["ng-component"]],decls:77,vars:38,consts:[[1,"settings-page","ion-padding"],["danger","",4,"ngIf"],[4,"ngIf"],["multiple","true","cancelText","Cancel","okText","OK",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["lines","none"],["dualKnobs","true","min","0","max","650","pin","true",3,"ngModel","ngModelChange"],["slot","start","size","small","name","flash"],["slot","end","name","flash"],["slot","start",2,"padding-top","0"],["type","number","min","0",2,"width","3em","border","none",3,"ngModel","max","ngModelChange"],["slot","end",2,"padding-top","0"],["type","number",2,"width","3em","border","none",3,"ngModel","max","min","ngModelChange"],["multiple","false",3,"ngModel","ngModelChange","ionChange"],["multiple","false","cancelText","Cancel","okText","OK",3,"ngModel","ngModelChange","ionChange"],["value","ROADMAP"],["value","SATELLITE"],[3,"ngModel","ngModelChange"],["slot","end"],[3,"click"],["name","close","slot","start"],["danger",""],["name","alert"],["size","small","color","light",3,"click"],["slot","start","name","close"],["value",""],[3,"value"]],template:function(Ge,ot){1&Ge&&(m.TgZ(0,"ion-header"),m.TgZ(1,"ion-toolbar"),m.TgZ(2,"ion-title"),m._uU(3),m.ALo(4,"translate"),m.qZA(),m.qZA(),m.qZA(),m.TgZ(5,"ion-content",0),m.TgZ(6,"h2"),m._uU(7,"Search Filters"),m.qZA(),m.TgZ(8,"p"),m._uU(9,"Note: Filters will remove usable charging locations from your search results if we do not have complete data (i.e Operator or Power Levels)."),m.qZA(),m.YNc(10,_e,7,0,"p",1),m.TgZ(11,"ion-list"),m.YNc(12,xe,8,5,"ion-item",2),m.TgZ(13,"ion-item"),m.TgZ(14,"ion-label"),m._uU(15),m.ALo(16,"translate"),m.qZA(),m.TgZ(17,"ion-select",3),m.NdJ("ngModelChange",function(wt){return ot.searchSettings.OperatorList=wt}),m.YNc(18,je,3,5,"ion-select-option",4),m.qZA(),m.qZA(),m.TgZ(19,"ion-item"),m.TgZ(20,"ion-label"),m._uU(21),m.ALo(22,"translate"),m.qZA(),m.TgZ(23,"ion-select",3),m.NdJ("ngModelChange",function(wt){return ot.searchSettings.UsageTypeList=wt}),m.YNc(24,nt,3,5,"ion-select-option",4),m.qZA(),m.qZA(),m.TgZ(25,"ion-item"),m.TgZ(26,"ion-label"),m._uU(27),m.ALo(28,"translate"),m.qZA(),m.TgZ(29,"ion-select",3),m.NdJ("ngModelChange",function(wt){return ot.searchSettings.StatusTypeList=wt}),m.YNc(30,Fe,3,5,"ion-select-option",4),m.qZA(),m.qZA(),m.TgZ(31,"ion-item"),m.TgZ(32,"ion-label"),m._uU(33),m.ALo(34,"translate"),m.qZA(),m.TgZ(35,"ion-select",3),m.NdJ("ngModelChange",function(wt){return ot.searchSettings.ConnectionTypeList=wt}),m.YNc(36,ke,3,5,"ion-select-option",4),m.qZA(),m.qZA(),m.TgZ(37,"ion-item",5),m.TgZ(38,"ion-range",6),m.NdJ("ngModelChange",function(wt){return ot.powerRange=wt}),m.TgZ(39,"ion-icon",7),m._uU(40,"0"),m.qZA(),m._UZ(41,"ion-icon",8),m.qZA(),m.qZA(),m.TgZ(42,"ion-item",5),m.TgZ(43,"ion-note",9),m._uU(44,"Min. Power (kW)"),m._UZ(45,"br"),m.TgZ(46,"input",10),m.NdJ("ngModelChange",function(wt){return ot.powerRange.lower=wt}),m.qZA(),m.qZA(),m.TgZ(47,"ion-note",11),m._uU(48,"Max. Power (kW)"),m._UZ(49,"br"),m.TgZ(50,"input",12),m.NdJ("ngModelChange",function(wt){return ot.powerRange.upper=wt}),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.TgZ(51,"h2"),m._uU(52," General Settings "),m.qZA(),m.TgZ(53,"ion-item"),m.TgZ(54,"ion-label"),m._uU(55,"Language"),m.qZA(),m.TgZ(56,"ion-select",13),m.NdJ("ngModelChange",function(wt){return ot.searchSettings.Language=wt})("ionChange",function(){return ot.onLanguageChange()}),m.YNc(57,Ne,2,2,"ion-select-option",4),m.qZA(),m.qZA(),m.TgZ(58,"ion-item"),m.TgZ(59,"ion-label"),m._uU(60),m.ALo(61,"translate"),m.qZA(),m.TgZ(62,"ion-select",14),m.NdJ("ngModelChange",function(wt){return ot.searchSettings.MapType=wt})("ionChange",function(){return ot.onMapTypeChange()}),m.TgZ(63,"ion-select-option",15),m._uU(64,"Road Map"),m.qZA(),m.TgZ(65,"ion-select-option",16),m._uU(66,"Satellite"),m.qZA(),m.qZA(),m.qZA(),m.TgZ(67,"ion-item"),m.TgZ(68,"ion-label"),m._uU(69,"Enable Advanced Editor Options"),m.qZA(),m.TgZ(70,"ion-toggle",17),m.NdJ("ngModelChange",function(wt){return ot.searchSettings.EnableAdvancedEditorFeatures=wt}),m.qZA(),m.qZA(),m.qZA(),m.TgZ(71,"ion-footer"),m.TgZ(72,"ion-toolbar"),m.TgZ(73,"ion-buttons",18),m.TgZ(74,"ion-button",19),m.NdJ("click",function(){return ot.close()}),m._UZ(75,"ion-icon",20),m._uU(76," Close "),m.qZA(),m.qZA(),m.qZA(),m.qZA()),2&Ge&&(m.xp6(3),m.hij(" ",m.lcZ(4,26,"ocm.general.settings")," "),m.xp6(7),m.Q6J("ngIf",1==ot.searchSettings.HasActiveFilters),m.xp6(2),m.Q6J("ngIf",ot.isCountryFilterFeatureEnabled),m.xp6(3),m.Oqu(m.lcZ(16,28,"ocm.search.networkOperators")),m.xp6(2),m.Q6J("ngModel",ot.searchSettings.OperatorList),m.xp6(1),m.Q6J("ngForOf",ot.operators),m.xp6(3),m.Oqu(m.lcZ(22,30,"ocm.search.usageTypes")),m.xp6(2),m.Q6J("ngModel",ot.searchSettings.UsageTypeList),m.xp6(1),m.Q6J("ngForOf",ot.usageTypes),m.xp6(3),m.Oqu(m.lcZ(28,32,"ocm.search.operationalStatusTypes")),m.xp6(2),m.Q6J("ngModel",ot.searchSettings.StatusTypeList),m.xp6(1),m.Q6J("ngForOf",ot.statusTypes),m.xp6(3),m.Oqu(m.lcZ(34,34,"ocm.search.connectionTypes")),m.xp6(2),m.Q6J("ngModel",ot.searchSettings.ConnectionTypeList),m.xp6(1),m.Q6J("ngForOf",ot.connectionTypes),m.xp6(2),m.Q6J("ngModel",ot.powerRange),m.xp6(8),m.Q6J("ngModel",ot.powerRange.lower)("max",ot.powerRange.upper),m.xp6(4),m.Q6J("ngModel",ot.powerRange.upper)("max",ot.maxPower)("min",ot.powerRange.lower),m.xp6(6),m.Q6J("ngModel",ot.searchSettings.Language),m.xp6(1),m.Q6J("ngForOf",ot.languages),m.xp6(3),m.Oqu(m.lcZ(61,36,"ocm.details.location.map")),m.xp6(2),m.Q6J("ngModel",ot.searchSettings.MapType),m.xp6(8),m.Q6J("ngModel",ot.searchSettings.EnableAdvancedEditorFeatures))},directives:[$.Gu,$.sr,$.wd,$.W2,V.O5,$.gu,$.YG,$.Q$,$.q_,$.Ie,$.t9,$.QI,Z.JJ,Z.On,V.sg,$.n0,$.I_,$.uN,Z.qQ,Z.wV,Z.Fd,Z.Fj,$.ho,$.w,$.fr,$.Sm],pipes:[K.X$,re],encapsulation:2}),Re})()},6779:(Tn,Je,R)=>{"use strict";R.r(Je),R.d(Je,{SignInModule:()=>ue});var u=R(9492),d=R(8936),j=R(9397),l=R(6895),L=R(4006),P=R(9064),m=R(3334),$=R(6738);let ue=(()=>{class V{}return V.\u0275fac=function(K){return new(K||V)},V.\u0275mod=$.oAB({type:V}),V.\u0275inj=$.cJS({imports:[[l.ez,L.u5,P.Pc,j.aw,d.e,m.Bz.forChild([{path:"",component:u.F}])]]}),V})()},9492:(Tn,Je,R)=>{"use strict";R.d(Je,{F:()=>V});var u=R(6099),d=R(7689),j=R(3855),l=R(6738),L=R(9064),P=R(9397),m=R(3334),$=R(6895),ue=R(4006);let V=(()=>{class Z{constructor(re,_e,ge,xe,je,nt,Fe,ke){this.appManager=re,this.modalController=_e,this.translate=ge,this.alertController=xe,this.loadingController=je,this.logging=nt,this.router=Fe,this.location=ke,this.email=""}cancelSignIn(){this.modalController.dismiss()}performSignIn(){var re=this;return(0,u.Z)(function*(){const _e=yield re.loadingController.create({message:"Signing In.."});yield _e.present();let ge=!1;try{yield re.appManager.api.performSignIn(re.email,re.password),_e.dismiss(),localStorage.setItem("authResponse",JSON.stringify(re.appManager.api.authResponse)),re.appManager.isUserAuthenticated(!0),re.modalController.dismiss(),re.appManager.analytics.appEvent("Profile","SignedIn")}catch(xe){ge=!0,_e.dismiss(),yield(yield re.alertController.create({header:"Open Charge Map",subHeader:"Email or Password not recognised",buttons:["Ok"]})).present(),re.logging.log("Error logging in:"+xe)}})()}}return Z.\u0275fac=function(re){return new(re||Z)(l.Y36(j.c),l.Y36(L.IN),l.Y36(P.sK),l.Y36(L.Br),l.Y36(L.HT),l.Y36(d.z),l.Y36(m.F0),l.Y36($.Ye))},Z.\u0275cmp=l.Xpm({type:Z,selectors:[["ng-component"]],decls:37,vars:8,consts:[[1,"signin-page","ion-padding"],["item-left",""],["src","assets/images/icons/branding/AppIcon_128x128.png"],[1,"ion-padding"],["position","floating"],["type","text",3,"ngModel","ngModelChange"],["type","password",3,"ngModel","ngModelChange"],[3,"click"],["slot","secondary"],["name","close","slot","start"],["slot","primary"],["type","submit","color","primary",3,"click"],["name","log-in","slot","start"]],template:function(re,_e){1&re&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-title"),l._uU(3),l.ALo(4,"translate"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(5,"ion-content",0),l.TgZ(6,"ion-avatar",1),l._UZ(7,"img",2),l.qZA(),l.TgZ(8,"p",3),l._uU(9," Sign in using your Open Charge Map account. "),l.qZA(),l.TgZ(10,"ion-list"),l.TgZ(11,"ion-item"),l.TgZ(12,"ion-label",4),l._uU(13,"Email"),l.qZA(),l.TgZ(14,"ion-input",5),l.NdJ("ngModelChange",function(xe){return _e.email=xe}),l.qZA(),l.qZA(),l.TgZ(15,"ion-item"),l.TgZ(16,"ion-label",4),l._uU(17,"Password"),l.qZA(),l.TgZ(18,"ion-input",6),l.NdJ("ngModelChange",function(xe){return _e.password=xe}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(19,"p"),l._uU(20,"or "),l.TgZ(21,"a",7),l.NdJ("click",function(){return _e.appManager.launchWebPage("https://openchargemap.org/site/loginprovider/register")}),l._uU(22,"Register as New User"),l.qZA(),l._uU(23," or "),l.TgZ(24,"a",7),l.NdJ("click",function(){return _e.appManager.launchWebPage("https://openchargemap.org/site/loginprovider/passwordreset")}),l._uU(25,"Reset your password"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(26,"ion-footer"),l.TgZ(27,"ion-toolbar"),l.TgZ(28,"ion-buttons",8),l.TgZ(29,"ion-button",7),l.NdJ("click",function(){return _e.cancelSignIn()}),l._UZ(30,"ion-icon",9),l._uU(31," Cancel"),l.qZA(),l.qZA(),l.TgZ(32,"ion-buttons",10),l.TgZ(33,"ion-button",11),l.NdJ("click",function(){return _e.performSignIn()}),l._UZ(34,"ion-icon",12),l._uU(35),l.ALo(36,"translate"),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&re&&(l.xp6(3),l.hij(" ",l.lcZ(4,4,"ocm.general.signIn")," "),l.xp6(11),l.Q6J("ngModel",_e.email),l.xp6(4),l.Q6J("ngModel",_e.password),l.xp6(17),l.hij(" ",l.lcZ(36,6,"ocm.general.signIn"),""))},directives:[L.Gu,L.sr,L.wd,L.W2,L.BJ,L.q_,L.Ie,L.Q$,L.pK,L.j9,ue.JJ,ue.On,L.fr,L.Sm,L.YG,L.gu],pipes:[P.X$],encapsulation:2}),Z})()},7814:(Tn,Je,R)=>{"use strict";R.d(Je,{l:()=>$});var u=R(6099),d=R(7689),j=R(6799),l=R(8649),L=R(529),P=R(2340),m=R(6738);let $=(()=>{class ue{constructor(Z,K,re){this.http=Z,this.refData=K,this.logging=re,this.serviceBase="https://api.openchargemap.io",this.serviceBaseURL=this.serviceBase+"/v3",this.hasAuthorizationError=!1,this.ATTRIBUTION_METADATAFIELDID=4,this.clientName="ocm.api.default",this.allowMirror=!1,this.lastPOIApiCallURL="",this.serviceBaseURL=P.N.apiBase+"/v3"}getNumberListString(Z){let K="";for(let re=0;re<Z.length;re++)K+=Z[re],re<Z.length&&(K+=",");return K}fetchPOIListByParam(Z){var K=this;return(0,u.Z)(function*(){const re=K.serviceBaseURL+"/poi/?client="+K.clientName+(K.allowMirror?" &allowmirror=true":"")+"&verbose=false&output=json";Z.compact=!0;let _e="";null!=Z.countryCode&&(_e+="&countrycode="+Z.countryCode),null!=Z.latitude&&(_e+="&latitude="+Z.latitude),null!=Z.longitude&&(_e+="&longitude="+Z.longitude),null!=Z.distance&&(_e+="&distance="+Z.distance),null!=Z.distanceUnit&&(_e+="&distanceunit="+Z.distanceUnit),null!=Z.includeComments&&(_e+="&includecomments="+Z.includeComments),null!=Z.maxResults&&(_e+="&maxresults="+Z.maxResults),null!=Z.countryIdList&&(_e+="&countryid="+K.getNumberListString(Z.countryIdList)),null!=Z.levelIdList&&(_e+="&levelid="+K.getNumberListString(Z.levelIdList)),null!=Z.connectionTypeIdList&&Z.connectionTypeIdList.length>0&&(_e+="&connectiontypeid="+K.getNumberListString(Z.connectionTypeIdList)),null!=Z.operatorIdList&&Z.operatorIdList.length>0&&(_e+="&operatorid="+K.getNumberListString(Z.operatorIdList)),null!=Z.usageTypeIdList&&Z.usageTypeIdList.length>0&&(_e+="&usagetypeid="+K.getNumberListString(Z.usageTypeIdList)),null!=Z.statusTypeIdList&&Z.statusTypeIdList.length>0&&(_e+="&statustypeid="+K.getNumberListString(Z.statusTypeIdList)),null!=Z.locationTitle&&(_e+="&locationtitle="+Z.locationTitle),null!=Z.minPowerKW&&Z.minPowerKW>0&&(_e+="&minpowerkw="+Z.minPowerKW),null!=Z.maxPowerKW&&Z.maxPowerKW>0&&(_e+="&maxpowerkw="+Z.maxPowerKW),null!=Z.submissionStatusTypeIdList&&(_e+="&submissionstatustypeid="+K.getNumberListString(Z.submissionStatusTypeIdList)),null!=Z.poiIdList&&Z.poiIdList.length>0&&(_e+="&chargepointid="+K.getNumberListString(Z.poiIdList)),0==Z.enableCaching&&(_e+="&enablecaching=false"),null!=Z.compact&&(_e+="&compact="+Z.compact),Z.levelOfDetail>1&&(_e+="&levelofdetail="+Z.levelOfDetail),null!=Z.polyline&&(_e+="&polyline="+Z.polyline),null!=Z.boundingbox&&(_e+="&boundingbox="+Z.boundingbox),null!=Z.additionalParams&&(_e+="&"+Z.additionalParams);const ge=re+_e;if(K.lastPOIApiCallURL===ge&&0!=Z.enableCaching)return K.logging.log("Skipped API call due to same query being repeated."),[];K.lastPOIApiCallURL=ge,K.logging.log("API Call:"+ge,d.i.VERBOSE);try{let xe=yield K.http.get(ge,K.getHttpRequestOptions()).toPromise();return K.refData.hydrateCompactPOIList(xe)}catch(xe){const je=xe.message||"Could not fetch POI list from server.";throw K.logging.log("API Client: "+JSON.stringify(xe),d.i.ERROR),je}})()}getHttpRequestOptions(Z=!0){let K=new L.WM;return Z&&(K=K.append("Content-Type","application/json")),this.authResponse&&this.authResponse.Data&&this.authResponse.Data.access_token&&(K=K.append("Authorization","Bearer "+this.authResponse.Data.access_token)),K=K.append("X-API-Key",P.N.apiKey),{headers:K}}fetchCoreReferenceData(Z){let K=this.serviceBaseURL+"/referencedata/?client="+this.clientName+"&output=json"+(this.allowMirror?"&allowmirror=true":"")+"&verbose=false&compact=true";return null!=Z&&null!=Z.CountryIds&&(K+="&countryid="+this.getNumberListString(Z.CountryIds)),this.logging.log("API Call:"+K,d.i.VERBOSE),this.http.get(K,this.getHttpRequestOptions())}performSignIn(Z,K){return this.http.post(this.serviceBaseURL+"/profile/authenticate/",JSON.stringify({emailaddress:Z,password:K}),this.getHttpRequestOptions()).toPromise().then(ge=>(this.authResponse=ge,this.authResponse))}performSubmission(Z,K){return Z===l.q.POI?this.submitPOI(K):Z===l.q.Comment?this.submitUserComment(K):Z===l.q.Media?this.submitMediaItem(K):void 0}submitUserComment(Z){const K=JSON.stringify(Z);return this.logging.log("[api] Submitting user comment"),this.http.post(this.serviceBaseURL+"/comment/",K,this.getHttpRequestOptions()).toPromise()}submitMediaItem(Z){const K=JSON.stringify(Z);return this.http.post(this.serviceBaseURL+"/mediaitem/",K,this.getHttpRequestOptions()).toPromise()}submitPOI(Z){const K=JSON.stringify(Z);return this.http.post(this.serviceBaseURL+"/poi/",K,this.getHttpRequestOptions()).toPromise()}getPanoramioLocationPhotos(Z){return new Promise(K=>{const re=.001,_e="https://www.panoramio.com/map/get_panoramas.php?set=public&from=0&to=2&minx="+(Z.longitude-re)+"&miny="+(Z.latitude-re)+"&maxx="+(Z.longitude+re)+"maxy="+(Z.latitude+re)+"&size=medium&mapfilter=true&callback=?";return console.log(_e),this.http.get(_e).toPromise()})}fetchReverseGeocodeResult(Z,K){return this.http.get(this.serviceBaseURL+"/geocode/?client="+this.clientName+"&output=json&camelcase=false&latitude="+Z+"&longitude="+K,this.getHttpRequestOptions()).toPromise()}isLocalStorageAvailable(){return void 0!==window.localStorage}setCachedDataObject(Z,K){this.isLocalStorageAvailable()&&(void 0===K&&(K=null),null===K?localStorage.removeItem(Z):localStorage.setItem(Z,JSON.stringify(K)))}getCachedDataObject(Z){if(this.isLocalStorageAvailable()){const K=localStorage.getItem(Z);if(null!=K&&K.length>0)return JSON.parse(K)}return null}}return ue.\u0275fac=function(Z){return new(Z||ue)(m.LFG(L.eN),m.LFG(j.W),m.LFG(d.z))},ue.\u0275prov=m.Yz7({token:ue,factory:ue.\u0275fac,providedIn:"root"}),ue})()},56:(Tn,Je,R)=>{"use strict";R.d(Je,{c:()=>L});var u=R(6099),d=R(7689),j=R(6738),l=R(9064);let L=(()=>{class P{constructor($,ue){this.logger=$,this.platform=ue,this.isCordova=!1,this.ga=null,this.isCordova=!(!ue.is("cordova")&&!ue.is("capacitor"))}init($){var ue=this;return(0,u.Z)(function*(){ue.isCordova&&ue.ga?yield ue.ga.startTrackerWithId($):ue.logger.log("Could not initialise analytics")})()}setAppVersion($){var ue=this;return(0,u.Z)(function*(){if(ue.isCordova&&ue.ga)return ue.ga.setAppVersion($);ue.logger.log($)})()}appEvent($,ue){var V=this;return(0,u.Z)(function*(){if(V.isCordova&&V.ga)return V.ga.trackEvent($,ue);V.logger.log(ue)})()}viewEvent($){var ue=this;return(0,u.Z)(function*(){if(ue.isCordova&&ue.ga)return ue.ga.trackView($);ue.logger.log($)})()}}return P.\u0275fac=function($){return new($||P)(j.LFG(d.z),j.LFG(l.t4))},P.\u0275prov=j.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),P})()},3855:(Tn,Je,R)=>{"use strict";R.d(Je,{c:()=>Fe});var u=R(6099),d=R(7689),j=R(7814),l=R(7627),L=R(4120),P=R(8649),m=R(6799),$=R(3912),ue=R(56),V=R(2340),Z=R(6738),K=R(529),re=R(6260);class _e{constructor(Ne,$e){this.SubmissionType=Ne,this.Data=$e,this.DateQueued=new Date,this.IsSubmitted=!1,this.IsInProgress=!1,this.IsCancelled=!1,this.IsFailure=!1,this.Attempts=0,this.ID=new Date+"_"+100*Math.random()}}let ge=(()=>{class ke{constructor($e){this.events=$e,this.isQueueProcessing=!1}setAppManager($e){this.appManager=$e}add($e,Re){let _t=this.getQueueItems();_t.push(new _e($e,Re)),this.saveQueueItems(_t)}update($e){let Re=this.getQueueItems(),_t=new Array;return Re.forEach(Ge=>{_t.push(Ge.ID==$e.ID?$e:Ge)}),_t}processNextQueueItem(){let $e=this.getNextQueueItem();null!=$e&&null!=this.appManager&&this.appManager.api.performSubmission($e.SubmissionType,$e.Data).then(()=>{$e.IsSubmitted=!0,$e.Attempts++,this.update($e),this.clear()})}getNextQueueItem(){let $e=this.getQueueItems(),Re=null;return $e.forEach(_t=>{null==Re&&!_t.IsCancelled&&!_t.IsInProgress&&!_t.IsSubmitted&&(Re=_t)}),Re}hasPendingItems(){let $e=!1;return this.getQueueItems().forEach(_t=>{!_t.IsFailure&&!_t.IsCancelled&&!_t.IsSubmitted&&($e=!0)}),$e}isCompleted(){let $e=this.getQueueItems(),Re=!0;return $e.forEach(_t=>{(_t.IsInProgress||_t.IsFailure)&&(Re=!1)}),Re}clear($e=!1){let Re=this.getQueueItems(),_t=new Array;$e||Re.forEach(Ge=>{(Ge.IsInProgress||Ge.IsFailure)&&_t.push(Ge)}),this.saveQueueItems(_t)}saveQueueItems($e){localStorage.setItem("submissionQueue",JSON.stringify($e))}getQueueItems(){let $e=localStorage.getItem("submissionQueue");return null!=$e?JSON.parse($e):new Array}}return ke.\u0275fac=function($e){return new($e||ke)(Z.LFG(re.z))},ke.\u0275prov=Z.Yz7({token:ke,factory:ke.\u0275fac,providedIn:"root"}),ke})();var xe=R(9064),je=R(9397),nt=R(4244);let Fe=(()=>{class ke{constructor($e,Re,_t,Ge,ot,yt,wt,xt,dt,At,Vt,Un,St){this.http=$e,this.events=Re,this.api=_t,this.submissionQueue=Ge,this.platform=ot,this.referenceDataManager=yt,this.journeyManager=wt,this.translateService=xt,this.toastController=dt,this.loadingController=At,this.jwtHelper=Vt,this.logging=Un,this.analytics=St,this.isRequestInProgress=!1,this.title="Open Charge Map",this._isUserAuthenticated=null,this.isEmbeddedMode=!1,this.isOffline=!1,this.api.clientName="ocm.app.ionic."+V.N.version,this.isDebugMode=!1,this.enableSubmissionQueue=!1,this.submissionQueue.setAppManager(this),this.platformMode=ot.is("cordova")?"cordova":"web",this.initAppManager(),this.searchSettings=new l.N,this.loadSearchSettings(),this.applyURLQueryStringOptions(),this.searchSettings.CheckForActiveFilters(),this.journeyManager.loadJourneys()}loadSearchSettings(){if(null!=localStorage.getItem("searchSettings")){this.searchSettings=new l.N;try{let $e=JSON.parse(localStorage.getItem("searchSettings"));Object.assign(this.searchSettings,$e)}catch{}}}savePushRegistration($e){localStorage.setItem("_pushToken",$e.toString())}getPushRegistration(){localStorage.getItem("_pushToken")}getQueryVariable($e){let _t=window.location.search.substring(1).split("&");for(let Ge=0;Ge<_t.length;Ge++){let ot=_t[Ge].split("=");if(decodeURIComponent(ot[0])==$e)return ot[1].split(",").map(xt=>decodeURIComponent(xt))}return null}applyURLQueryStringOptions(){if(this.getQueryVariable("mode")&&"embedded"==this.getQueryVariable("mode")[0]&&(this.isEmbeddedMode=!0),this.getQueryVariable("operatorid")){let $e=this.getQueryVariable("operatorid");for(let Re of $e)this.searchSettings.OperatorList.unshift(parseInt(Re,10))}if(this.getQueryVariable("latitude")&&this.getQueryVariable("longitude")){let $e=this.getQueryVariable("latitude")[0],Re=this.getQueryVariable("longitude")[0];this.searchSettings.StartSearchPosition=new L.wC(parseFloat($e),parseFloat(Re))}this.getQueryVariable("title")&&(this.title=this.getQueryVariable("title")[0]),this.getQueryVariable("languagecode")&&this.setLanguage(this.getQueryVariable("languagecode")[0])}saveSearchSettings(){this.searchSettings.CheckForActiveFilters(),localStorage.setItem("searchSettings",JSON.stringify(this.searchSettings))}getLanguages(){return[{code:"ar",title:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629 / Arabic"},{code:"bg",title:"Bulgarian / \u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438"},{code:"cs",title:"Czech / \u010ce\u0161tina"},{code:"de",title:"German / Deutsch"},{code:"el",title:"Greek / \u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ae"},{code:"en",title:"English"},{code:"es",title:"Spanish / Espa\xf1ol"},{code:"et",title:"Estonian / Eesti"},{code:"fi",title:"Finnish / Suomi"},{code:"fr",title:"French / Fran\xe7ais"},{code:"fy",title:"West Frisian / Frysk"},{code:"hu",title:"Hungarian / Magyar"},{code:"it",title:"Italian / Italiano"},{code:"ja",title:"Japanese / \u65e5\u672c\u8a9e"},{code:"lt",title:"Lithuanian / Lietuvi\u0173"},{code:"nl",title:"Dutch / Nederlands"},{code:"pt",title:"Portuguese / portugu\xeas"},{code:"ru",title:"Russian / P\u0443\u0441\u0441\u043a\u0438\u0439"},{code:"sk",title:"Slovak / Sloven\u010dina"},{code:"tr",title:"Turkish / T\xfcrk\xe7e"},{code:"zh",title:"Chinese / \u4e2d\u56fd\u7684"}]}setLanguage($e){(null==$e||""==$e)&&($e="en"),this.logging.log("Changing language: "+$e),this.translateService.use($e)}initAppManager(){this.initAuthFromStorage(),this.isUserAuthenticated(!0)&&this.enableSubmissionQueue&&null!=this.submissionQueue&&this.submissionQueue.hasPendingItems()&&this.submissionQueue.processNextQueueItem()}initAuthFromStorage(){let $e=localStorage.getItem("authResponse");if(null!=$e){let Re=JSON.parse($e);null!=Re.Data&&null!=Re.Data.access_token&&(this.jwtHelper.decodeToken(Re.Data.access_token),this.jwtHelper.isTokenExpired(Re.Data.access_token)?localStorage.removeItem("authResponse"):(this.api.authResponse=Re,this.logging.log("User has valid auth token in local storage",d.i.VERBOSE)))}}isUserAuthenticated($e=!1){return!1===$e&&null!=this._isUserAuthenticated||(this._isUserAuthenticated=!1,null!=this.api.authResponse&&(this.jwtHelper.isTokenExpired(this.api.authResponse.Data.access_token)||(this._isUserAuthenticated=!0))),this._isUserAuthenticated}getCurrentAuthToken(){return null!=this.api.authResponse?this.api.authResponse.Data.access_token:null}getUserProfile(){return null!=this.api.authResponse?this.api.authResponse.Data.UserProfile:null}signOutCurrentUser(){localStorage.removeItem("authResponse"),this.api.authResponse=null,this._isUserAuthenticated=!1}submitComment($e){if(!this.enableSubmissionQueue)return this.api.performSubmission(P.q.Comment,$e);this.submissionQueue.add(P.q.Comment,$e),this.submissionQueue.processNextQueueItem()}submitMediaItem($e){if(!this.enableSubmissionQueue)return this.api.performSubmission(P.q.Media,$e);this.submissionQueue.add(P.q.Media,$e),this.submissionQueue.processNextQueueItem()}submitPOI($e){if(!this.enableSubmissionQueue)return this.api.performSubmission(P.q.POI,$e);this.submissionQueue.add(P.q.POI,$e),this.submissionQueue.processNextQueueItem()}showToastNotification($e){var Re=this;return(0,u.Z)(function*(){yield(yield Re.toastController.create({message:$e,duration:3e3})).present()})()}showLoadingProgress($e){var Re=this;return(0,u.Z)(function*(){yield(yield Re.loadingController.create({message:$e})).present()})()}dismissLoadingProgress(){var $e=this;return(0,u.Z)(function*(){return $e.loadingController.dismiss()})()}launchOCMWebPage($e){this.isUserAuthenticated(!0)&&(-1===$e.indexOf("?")&&($e+="?"),$e+="&auth="+this.getCurrentAuthToken()),$e="https://openchargemap.org/site"+$e,window.open($e,"_system")}launchWebPage($e){window.open($e,"_system")}isPlatform($e){return this.platform.is($e)}}return ke.\u0275fac=function($e){return new($e||ke)(Z.LFG(K.eN),Z.LFG(re.z),Z.LFG(j.l),Z.LFG(ge),Z.LFG(xe.t4),Z.LFG(m.W),Z.LFG($.i),Z.LFG(je.sK),Z.LFG(xe.yF),Z.LFG(xe.HT),Z.LFG(nt.N0),Z.LFG(d.z),Z.LFG(ue.c))},ke.\u0275prov=Z.Yz7({token:ke,factory:ke.\u0275fac,providedIn:"root"}),ke})()},6260:(Tn,Je,R)=>{"use strict";R.d(Je,{z:()=>d});var u=R(6738);let d=(()=>{class j{constructor(){this.c=new Map}subscribe(L,...P){let m=this.c.get(L);m||this.c.set(L,m=[]),m.push(...P)}unsubscribe(L,P){if(!P)return this.c.delete(L);const m=this.c.get(L);if(!m)return!1;const $=m.indexOf(P);return!($<0||(m.splice($,1),0===m.length&&this.c.delete(L),0))}publish(L,...P){const m=this.c.get(L);return m?m.map($=>{try{return $(...P)}catch(ue){return console.error(ue),null}}):null}}return j.\u0275fac=function(L){return new(L||j)},j.\u0275prov=u.Yz7({token:j,factory:j.\u0275fac,providedIn:"root"}),j})()},3912:(Tn,Je,R)=>{"use strict";R.d(Je,{i:()=>$});var u=R(7689),d=R(7814),j=R(9698),l=R(2206),L=R(129),P=R(4120),m=R(6738);let $=(()=>{class ue{constructor(Z,K,re){this.api=Z,this.poiManager=K,this.logging=re,this.journeys=[],this.favourites=[]}loadJourneys(){let Z=localStorage.getItem("journeys");if(null!=Z&&(this.journeys=JSON.parse(Z)),null!=this.journeys)for(let K of this.journeys)this.fetchAllJourneyPOIDetails(K)}fetchAllJourneyPOIDetails(Z){this.logging.log("Journeys - fetching poi details for Journey "+Z.Title);let K=new l.b;K.poiIdList=[];for(let re of Z.Stages)for(let _e of re.WayPoints)for(let ge of _e.PoiIDs)K.poiIdList.push(ge);this.api.fetchPOIListByParam(K).then(re=>{for(let _e of re)this.updateStoredPOI(_e)})}updateStoredPOI(Z){if(this.journeys.forEach(K=>{K.Stages.forEach(re=>{re.WayPoints.forEach(_e=>{_e.PoiIDs.forEach(ge=>{if(ge==Z.ID)if(null==_e.PoiList){_e.PoiList=[];let xe=new L.Qp("charging",1);xe.Poi=Z,xe.PoiID=Z.ID,_e.PoiList.push(xe)}else for(let xe of _e.PoiList)xe.PoiID==Z.ID&&(xe.Poi=Z)})})})}),null!=this.favourites)for(let K of this.favourites)"charging"==K.Type&&K.PoiID==Z.ID&&(K.Poi=Z)}saveJourneys(){let Z=JSON.parse(JSON.stringify(this.journeys));for(let re of Z)for(const _e of re.Stages)for(let ge of _e.WayPoints)for(let xe of ge.PoiList)xe.Poi=null,xe.Photos=null;const K=JSON.stringify(Z);localStorage.setItem("journeys",K)}addJourney(Z,K){let re=new L.vw;re.Title="Stage 1",null!=K&&re.WayPoints.push(K),Z.Stages.push(re),this.journeys.push(Z)}deleteJourney(Z){this.journeys=this.journeys.filter(K=>K.ID!=Z),this.saveJourneys()}getJourney(Z){let K=this.journeys.filter(re=>re.ID==Z);return K.length>0?K[0]:null}getJourneyStages(Z){return this.getJourney(Z).Stages}addJourneyWaypoint(Z,K,re){let _e=this.getJourney(Z);if(null==K){let ge=new L.vw;ge.Title="Stage "+(_e.Stages.length+1),ge.WayPoints.push(re),_e.Stages.push(ge)}else{let ge=_e.Stages[K];null==ge.WayPoints&&(ge.WayPoints=[]),ge.WayPoints.push(re)}}addJourneyStage(Z,K){return this.getJourney(Z).Stages.push(K)-1}setupTestJourneys(){this.journeys=[];let Z=new L.fw;Z.Title="New York to Brooklyn",Z.Notes="A little jaunt to Brooklyn",Z.Stages=[];let K=new L.vw,re=new L.kA;re.Notes="Starting point",re.Position=new P.wC(40,1.2),re.Title="Start",K.WayPoints.push(re);let _e=new L.kA;_e.Notes="Middle point",_e.Position=new P.wC(40,1.33),_e.Title="Middle",K.WayPoints.push(_e);let ge=new L.kA;ge.Notes="End point",ge.Position=new P.wC(40,1.33),ge.Title="End",K.WayPoints.push(ge),Z.Stages.push(K),this.journeys.push(Z);let xe=new L.fw;xe.Title="Aberdeen to London",xe.Notes="Roadtrip",xe.Stages=[],this.journeys.push(xe)}calculateEnergyConsumptionkWh(Z,K,re=0,_e){return Z*_e}setRoutePolyline(Z){this.routePolyline=Z}getRoutePolyline(){return this.routePolyline}}return ue.\u0275fac=function(Z){return new(Z||ue)(m.LFG(d.l),m.LFG(j.R),m.LFG(u.z))},ue.\u0275prov=m.Yz7({token:ue,factory:ue.\u0275fac,providedIn:"root"}),ue})()},7689:(Tn,Je,R)=>{"use strict";R.d(Je,{i:()=>j,z:()=>l});var u=R(2340),d=R(6738),j=(()=>{return(L=j||(j={}))[L.VERBOSE=0]="VERBOSE",L[L.INFO=1]="INFO",L[L.WARNING=2]="WARNING",L[L.ERROR=3]="ERROR",j;var L})();let l=(()=>{class L{constructor(){this.logLevel=j.VERBOSE,u.N.production&&(this.logLevel=j.INFO)}log(m,$=j.VERBOSE){console&&console.log&&$>=this.logLevel&&console.log("["+j[$]+"] {"+(new Date).toLocaleTimeString()+"} "+m)}}return L.\u0275fac=function(m){return new(m||L)},L.\u0275prov=d.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),L})()},9698:(Tn,Je,R)=>{"use strict";R.d(Je,{R:()=>m});var u=R(6099),d=R(7689),j=R(7814),l=R(56),L=R(6738),P=R(6260);let m=(()=>{class ${constructor(V,Z,K,re){this.api=V,this.events=Z,this.logging=K,this.analytics=re,this.isRequestInProgress=!1}refreshPOIList(V){var Z=this;return(0,u.Z)(function*(){try{return Z.poiList=yield Z.fetchPOIList(V),Z.events.publish("ocm:poiList:updated"),Z.analytics.appEvent("Search","Fetched Results"),Z.poiList.length}catch{return 0}})()}fetchPOIList(V){var Z=this;return(0,u.Z)(function*(){Z.isRequestInProgress=!0;try{let K=yield Z.api.fetchPOIListByParam(V);return Z.isRequestInProgress=!1,K&&K.length&&Z.logging.log("fetched POI list ["+K.length+"]"),K}catch{return Z.isRequestInProgress=!1,[]}})()}clearResults(){this.poiList=[],this.events.publish("ocm:poiList:cleared"),this.logging.log("clearing results after settings change",d.i.VERBOSE)}getPOIById(V,Z=!1,K=!1){var re=this;return(0,u.Z)(function*(){if(!K&&null!=re.poiList){const xe=re.poiList.find(je=>je.ID==V);if(xe)return xe}const _e={poiIdList:[V],enableCaching:!K,includeComments:!0},ge=yield re.api.fetchPOIListByParam(_e);return ge&&ge.length>0?(re.poiList&&ge[0].ID==V&&(re.poiList=re.poiList.filter(xe=>xe.ID!=V),re.poiList.push(ge[0]),re.logging.log("POI refreshed in cache "+V)),ge[0]):null})()}}return $.\u0275fac=function(V){return new(V||$)(L.LFG(j.l),L.LFG(P.z),L.LFG(d.z),L.LFG(l.c))},$.\u0275prov=L.Yz7({token:$,factory:$.\u0275fac,providedIn:"root"}),$})()},6799:(Tn,Je,R)=>{"use strict";R.d(Je,{W:()=>L});var u=R(6099),d=R(7689),j=R(6738),l=R(529);let L=(()=>{class P{constructor($,ue){this.http=$,this.logging=ue,this.loadCachedRefData()}refreshReferenceData($){var ue=this;return(0,u.Z)(function*(){try{const V=yield $.fetchCoreReferenceData(null).toPromise();return ue.setCoreReferenceData(V),ue.setFilteredReferenceData(V),ue.logging.log("Got refreshed core ref data.",d.i.VERBOSE),ue.sortCoreReferenceData(),ue.cacheCurrentRefData(),!0}catch(V){return ue.logging.log("Error fetching core ref data:"+V),!1}})()}refreshFilteredReferenceData($,ue){$.fetchCoreReferenceData(ue).subscribe(V=>{this.setFilteredReferenceData(V),this.sortCoreReferenceData(),this.logging.log("Got refreshed filtered reference data.",d.i.VERBOSE)},V=>{this.logging.log("Error fetching filtered reference data:"+V)})}setCoreReferenceData($){this.referenceData=$}setFilteredReferenceData($){this.filteredReferenceData=$}referenceDataLoaded(){return null!=this.referenceData}getCountries($=!1){return 1==$?this.filteredReferenceData.Countries:this.referenceData.Countries}getCountryByID($){return this.getRefDataByID(this.referenceData.Countries,$)}getConnectionTypes($=!1){return 1==$?this.filteredReferenceData.ConnectionTypes:this.referenceData.ConnectionTypes}getConnectionTypeByID($){return this.getRefDataByID(this.referenceData.ConnectionTypes,$)}getUsageTypes($=!1){return 1==$?this.filteredReferenceData.UsageTypes:this.referenceData.UsageTypes.filter(ue=>ue.ID>0)}getUsageTypeByID($){return this.getRefDataByID(this.referenceData.UsageTypes,$)}getStatusTypes($=!1){return 1==$?this.filteredReferenceData.StatusTypes:this.referenceData.StatusTypes.filter(ue=>ue.ID>0)}getStatusTypeByID($){return this.getRefDataByID(this.referenceData.StatusTypes,$)}getNetworkOperators($=!1){return 1==$?this.filteredReferenceData.Operators:this.referenceData.Operators}getNetworkOperatorByID($){return this.getRefDataByID(this.referenceData.Operators,$)}getDataProviders($=!1){return 1==$?this.filteredReferenceData.DataProviders:this.referenceData.DataProviders}getDataProviderByID($){return this.getRefDataByID(this.referenceData.DataProviders,$)}getCheckinStatusTypes($=!1,ue=!0){let V=null;return V=1==$?this.filteredReferenceData.CheckinStatusTypes:this.referenceData.CheckinStatusTypes,ue&&(V=V.filter(Z=>!1===Z.IsAutomatedCheckin)),V}getCheckinStatusTypeByID($){return this.getRefDataByID(this.referenceData.CheckinStatusTypes,$)}getCommentTypes($=!1,ue=!0){let V;return V=1==$?this.filteredReferenceData.UserCommentTypes:this.referenceData.UserCommentTypes,ue&&(V=V.filter(Z=>100!==Z.ID&&110!==Z.ID)),V}getCommentTypeByID($){return this.getRefDataByID(this.referenceData.UserCommentTypes,$)}getSubmissionStatusTypes($=!1){return 1==$?this.filteredReferenceData.SubmissionStatusTypes:this.referenceData.SubmissionStatusTypes}getSubmissionStatusTypesByID($){return this.getRefDataByID(this.referenceData.SubmissionStatusTypes,$)}getChargingLevelTypes($=!1){return 1==$?this.filteredReferenceData.ChargerTypes:this.referenceData.ChargerTypes}getChargingLevelTypeByID($){return this.getRefDataByID(this.referenceData.ChargerTypes,$)}getOutputCurrentTypes($=!1){return $?this.referenceData.CurrentTypes:this.filteredReferenceData.CurrentTypes}getOutputCurrentTypeByID($){return this.getRefDataByID(this.referenceData.CurrentTypes,$)}loadCachedRefData(){const $=localStorage.getItem("referenceData");if(null==$)this.http.get("./assets/data/CoreReferenceData.json").subscribe(ue=>{this.logging.log("Using bundled reference data as cached ref data."),this.setCoreReferenceData(ue),this.setFilteredReferenceData(ue)});else{let ue=JSON.parse($);this.setCoreReferenceData(ue)}this.setFilteredReferenceData(this.referenceData)}cacheCurrentRefData(){null!=this.referenceData&&(this.referenceData.CacheDate=new Date,localStorage.setItem("referenceData",JSON.stringify(this.referenceData)))}getRefDataByID($,ue){if(""!==ue&&(ue=parseInt(ue,10)),null!=$)for(let V=0;V<$.length;V++)if($[V].ID===ue)return $[V];return null}sortCoreReferenceData(){this.sortReferenceData(this.referenceData.ConnectionTypes),this.sortReferenceData(this.referenceData.Countries),this.sortReferenceData(this.referenceData.Operators),this.sortReferenceData(this.referenceData.DataProviders),this.sortReferenceData(this.referenceData.UsageTypes),this.sortReferenceData(this.referenceData.StatusTypes),this.sortReferenceData(this.referenceData.CheckinStatusTypes),this.sortReferenceData(this.referenceData.SubmissionStatusTypes),this.filteredReferenceData&&(this.sortReferenceData(this.filteredReferenceData.ConnectionTypes),this.sortReferenceData(this.filteredReferenceData.Operators))}sortReferenceData($){$.sort(this.sortListByTitle)}sortListByTitle($,ue){return $.Title<ue.Title?-1:$.Title>ue.Title?1:0}getMetadataValueByMetadataFieldID($,ue){if(""!==ue&&(ue=parseInt(ue,10)),null!=$)for(let V=0;V<$.length;V++)if($[V].ID===ue)return $[V];return null}hydrateCompactPOI($,ue=!1){const V=this;if(null!=$.DataProviderID&&(ue||null==$.DataProvider)&&($.DataProvider=V.getDataProviderByID($.DataProviderID)),null!=$.OperatorID&&(ue||null==$.OperatorInfo)&&($.OperatorInfo=V.getNetworkOperatorByID($.OperatorID)),null!=$.UsageTypeID&&(ue||null==$.UsageType)&&($.UsageType=V.getUsageTypeByID($.UsageTypeID)),null!=$.AddressInfo.CountryID&&(ue||null==$.AddressInfo.Country)&&($.AddressInfo.Country=V.getCountryByID($.AddressInfo.CountryID)),null!=$.StatusTypeID&&(ue||null==$.StatusType)&&($.StatusType=V.getStatusTypeByID($.StatusTypeID)),null!=$.SubmissionStatusTypeID&&(ue||null==$.SubmissionStatusType)&&($.SubmissionStatusType=V.getSubmissionStatusTypesByID($.SubmissionStatusTypeID)),null!=$.Connections)for(let Z=0;Z<$.Connections.length;Z++){const K=$.Connections[Z];null!=K.ConnectionTypeID&&(ue||null==K.ConnectionType)&&(K.ConnectionType=V.getConnectionTypeByID(K.ConnectionTypeID)),null!=K.LevelID&&(ue||null==K.Level)&&(K.Level=V.getChargingLevelTypeByID(K.LevelID)),null!=K.CurrentTypeID&&(ue||null==K.CurrentType)&&(K.CurrentType=V.getOutputCurrentTypeByID(K.CurrentTypeID)),null!=K.StatusTypeID&&(ue||null==K.StatusType)&&(K.StatusType=V.getStatusTypeByID(K.StatusTypeID)),$.Connections[Z]=K}if(null!=$.UserComments)for(let Z=0;Z<$.UserComments.length;Z++){const K=$.UserComments[Z];null!=K.CommentTypeID&&(ue||null==K.CommentType)&&(K.CommentType=V.getCommentTypeByID(K.CommentTypeID)),null!=K.CheckinStatusTypeID&&(ue||null==K.CheckinStatusType)&&(K.CheckinStatusType=V.getCheckinStatusTypeByID(K.CheckinStatusTypeID)),$.UserComments[Z]=K}return $}hydrateCompactPOIList($){for(let ue=0;ue<$.length;ue++)$[ue]=this.hydrateCompactPOI($[ue]);return $}}return P.\u0275fac=function($){return new($||P)(j.LFG(l.eN),j.LFG(d.z))},P.\u0275prov=j.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),P})()},4781:(Tn,Je,R)=>{"use strict";R.d(Je,{v:()=>je});var u=R(553),d=R(5906),j=R(6579),l=R(7689),L=R(6099),P=R(2916),m=R(2210),$=R(4120),ue=R(2340),V=R(4209);class Z{constructor(Fe,ke){this.events=Fe,this.logging=ke,this.events=Fe,this.mapAPIType=d.b.MAPKIT_JS,this.mapReady=!1,this.markerList=new m.Xy,this.mapkitUtils=new K}initAPI(){mapkit&&mapkit.init({authorizationCallback:function(Fe){Fe(ue.N.mapKitToken)}})}disposeMap(){}initMap(Fe,ke,Ne){this.mapCanvasID=Fe;let $e=!0;if($e="undefined"!=typeof mapkit,!$e)return this.logging.log("Call to initMap before API is ready:"+d.b[this.mapAPIType],l.i.ERROR),this.mapReady=!1,!1;this.initAPI(),null==this.map&&(document.getElementById(Fe),this.map=new mapkit.Map(Fe),this.map.annotationForCluster=function(_t){"poi"===_t.clusteringIdentifier&&(_t.title="Charging Location",_t.subtitle=_t.memberAnnotations.reduce((Ge,ot)=>Ge+ot.population,0))},this.mapReady=!0,mapkit.addEventListener("configuration-change",_t=>{this.events.publish("ocm:mapping:ready")}),this.map.addEventListener("scroll-end",_t=>{this.events.publish("ocm:mapping:dragend")}),this.map.addEventListener("zoom-end",_t=>{this.events.publish("ocm:mapping:zoom")}))}clearMarkers(){null!=this.markerList&&this.markerList.forEach((Fe,ke)=>{try{this.map.removeAnnotation(ke)}catch{}}),this.markerList=new m.Xy}showPOIListOnMap(Fe,ke){let _t=0,ot=0==this.markerList.size();if(null!=Fe){let wt=[];for(let xt=0;xt<Fe.length;xt++)if(null!=Fe[xt].AddressInfo&&null!=Fe[xt].AddressInfo.Latitude&&null!=Fe[xt].AddressInfo.Longitude){let dt=Fe[xt],At=!0;if(null!=this.markerList&&this.markerList.containsKey(dt.ID)&&(At=!1),At){let Vt=null;Vt=j.c.getIconForPOI(dt);let zt="OCM-"+dt.ID+": "+dt.AddressInfo.Title+":";null!=dt.UsageType&&(zt+=" "+dt.UsageType.Title),null!=dt.StatusType&&(zt+=" "+dt.StatusType.Title);const Ht=new mapkit.Coordinate(dt.AddressInfo.Latitude,dt.AddressInfo.Longitude);let en=new mapkit.ImageAnnotation(Ht,{title:zt,size:{width:34,height:50},url:{1:Vt},clusteringIdentifier:"poi"});en.poi=dt,en.addEventListener("select",Kt=>{const Wt=Kt.target.poi;this.events.publish("ocm:poi:selected",{poi:Wt,poiId:Wt.ID})}),this.markerList.setValue(dt.ID,en),wt.push(en),_t++}}wt.length>0&&(this.map.addAnnotations(wt),ot&&this.map.showItems(wt,{animate:!0,padding:new mapkit.Padding(60,25,60,25)})),this.logging.log(_t+" new map markers added out of a total "+this.markerList.size())}}refreshMapLayout(){null!=this.map&&setTimeout(()=>{this.logging.log("MapKit: refreshMapLayout",l.i.VERBOSE)},200)}setMapCenter(Fe,ke){this.map&&(this.map.setCenterAnimated(new mapkit.Coordinate(Fe.coords.latitude,Fe.coords.longitude),!1),ke&&this.setMapZoom(ke))}getMapCenter(){return new P.y(ke=>{if(null!=this.map){let Ne=this.map.center;null!=Ne&&(ke.next(new $.jR(Ne.latitude,Ne.longitude)),ke.complete())}})}setMapZoom(Fe){const ke=Math.min(Fe,28),Ne=this.mapkitUtils.deltaFromZoomLevel(this.map,this.map.center,Math.round(ke)),$e=new mapkit.CoordinateSpan(111*Ne.latitudeDelta,111*Ne.longitudeDelta),Re=new mapkit.CoordinateRegion(this.map.center,$e);this.map.setRegionAnimated(Re)}getMapZoom(){return new P.y(ke=>{this.logging.log("MapKit: getMapZoom not supported",l.i.VERBOSE),ke.next(this.map._impl.zoomLevel),ke.complete()})}setMapType(Fe){this.logging.log("MapKit: skipped setting Map Type :"+Fe)}getMapBounds(){return new P.y(ke=>{let Ne=new Array,$e=this.map.region.toBoundingRegion();Ne.push(new $.wC($e.southLatitude,$e.westLongitude)),Ne.push(new $.wC($e.northLatitude,$e.eastLongitude)),ke.next(Ne),ke.complete()})}moveToMapBounds(Fe){this.logging.log("MapKit: map bounds not implemented")}renderMap(Fe,ke,Ne){return document.getElementById(this.mapCanvasID).style.height=ke+"px",this.mapReady&&this.showPOIListOnMap(Fe,Ne),!0}renderPolyline(Fe){this.clearPolyline()}clearPolyline(){null!=this.polylinePath&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(Fe){return(0,L.Z)(function*(){let ke=new mapkit.Search({getsUserLocation:!0});return new Promise(function(){var Ne=(0,L.Z)(function*($e,Re){let _t=[];ke.search(Fe,function(){var Ge=(0,L.Z)(function*(ot,yt){ot&&Re(ot),_t=[],yt.places.map(wt=>{let xt=new V.n;xt.Title=wt.name,xt.Address=wt.formattedAddress,xt.Type="place",xt.Location=new $.wC(wt.coordinate.latitude,wt.coordinate.longitude),_t.push(xt)}),$e(_t)});return function(ot,yt){return Ge.apply(this,arguments)}}())});return function($e,Re){return Ne.apply(this,arguments)}}())})()}addPOILayer(Fe){this.logging.log("Add POI Layer not implemented in this provider.")}}class K{constructor(){this.mercatorRadius=85445659.44705395,this.mercatorOffset=268435456}longitudeToPixelSpaceX(Fe){return Math.round(this.mercatorOffset+this.mercatorRadius*Fe*Math.PI/180)}latitudeToPixelSpaceY(Fe){return Math.round(this.mercatorOffset-this.mercatorRadius*Math.log((1+Math.sin(Fe*Math.PI/180))/(1-Math.sin(Fe*Math.PI/180)))/2)}pixelSpaceXToLongitude(Fe){return(Math.round(Fe)-this.mercatorOffset)/this.mercatorRadius*180/Math.PI}pixelSpaceYToLatitude(Fe){return 180*(Math.PI/2-2*Math.atan(Math.exp((Math.round(Fe)-this.mercatorOffset)/this.mercatorRadius)))/Math.PI}deltaFromZoomLevel(Fe,ke,Ne){let $e=this.longitudeToPixelSpaceX(ke.longitude),Re=this.latitudeToPixelSpaceY(ke.latitude),Ge=Math.pow(2,20-Ne),ot=Fe.visibleMapRect.size,yt=ot.width*Ge,wt=ot.height*Ge,xt=$e-yt/2,dt=Re-wt/2,At=this.pixelSpaceXToLongitude(xt),Un=this.pixelSpaceXToLongitude(xt+yt)-At,St=this.pixelSpaceYToLatitude(dt);return{latitudeDelta:-1*(this.pixelSpaceYToLatitude(dt+wt)-St),longitudeDelta:Un}}}var re=R(6738),_e=R(6260),ge=R(529);let xe=(()=>{class nt extends u.k{constructor(ke,Ne,$e){super(ke,Ne,$e),this.mapAPIType=d.b.MAPTILER,this.mapTileSet="https://maps.tilehosting.com/styles/streets/style.json?key=Gs9z7krALe3CGI60d5cL"}initAPI(){}}return nt.\u0275fac=function(ke){return new(ke||nt)(re.LFG(_e.z),re.LFG(l.z),re.LFG(ge.eN))},nt.\u0275prov=re.Yz7({token:nt,factory:nt.\u0275fac}),nt})(),je=(()=>{class nt{constructor(ke,Ne,$e){this.logging=Ne,this.http=$e,this.isFocused=!1,this.events=ke,this.mapOptions=new d._,this.mapAPIReady=!1,this.mapsInitialised=!1,this.setMapAPI(this.mapOptions.mapAPI);let Re=this;this.debouncedMapPositionUpdate=j.c.debounce(()=>{this.logging.log("signaling map position change:"),Re.mapProvider.mapReady&&Re.getMapCenter().subscribe(_t=>{null!=_t?(this.logging.log("Map centre/zoom changed, updating search position:"+_t),this.updateMapCentrePos(_t.coords.latitude,_t.coords.longitude,!1)):this.logging.log("Map centre/zoom changed - map not ready to change centre pos:")})},300,!1)}setParentAppContext(ke){this.parentAppContext=ke}setMapAPI(ke){this.mapOptions.mapAPI=ke,this.mapOptions.mapAPI==d.b.MAPBOX&&(this.mapProvider=new u.k(this.events,this.logging,this.http)),this.mapOptions.mapAPI==d.b.MAPKIT_JS&&(this.mapProvider=new Z(this.events,this.logging)),this.mapOptions.mapAPI==d.b.MAPTILER&&(this.mapProvider=new xe(this.events,this.logging,this.http))}isMapReady(){return null!=this.mapProvider&&this.mapProvider.mapReady}externalAPILoaded(ke){this.mapAPIReady=!0,this.logging.log("Mapping API Loaded: "+d.b[ke])}initMap(ke){if(!this.isMapReady())if(null!=this.mapProvider)this.mapsInitialised&&this.logging.log("initMap: Map provider already initialised"),this.logging.log("Mapping Manager: Init "+d.b[this.mapProvider.mapAPIType]),this.mapProvider.initMap(ke,this.mapOptions,this);else{if(this.mapsInitialised)return void this.logging.log("initMap: map already initialised");this.logging.log("initMap: "+this.mapOptions.mapAPI)}}mapManipulationPerformed(ke){this.logging.log("map manipulated:"+ke),("drag"==ke||"zoom"==ke)&&this.debouncedMapPositionUpdate()}updateMapSize(){this.mapProvider&&this.mapProvider.refreshMapLayout()}updateMapCentrePos(ke,Ne,$e,Re){$e&&null!=this.mapProvider&&this.mapProvider.setMapCenter(new $.jR(ke,Ne),Re),this.mapOptions.mapCentre=new $.jR(ke,Ne)}moveToMapBounds(ke){this.mapProvider.moveToMapBounds(ke)}refreshMapView(ke,Ne,$e){return null!=this.mapProvider?(this.logging.log("Mapping Manager: renderMap "+d.b[this.mapProvider.mapAPIType]),this.isMapReady()?this.mapProvider.renderMap(Ne,ke,this.parentAppContext):this.logging.log("refreshMapView: map provider not initialised..")):this.logging.log("Unsupported Map API: refreshMapView",l.i.ERROR),!0}setMapType(ke){this.mapOptions.mapType!=ke&&(this.mapOptions.mapType=ke,this.isMapReady()&&null!=this.mapProvider?(this.logging.log("Changing map type:"+ke),this.mapProvider.setMapType(ke)):this.logging.log("Map type set, maps not initialised yet."))}unfocusMap(){this.logging.log("[mapping] Unfocus Map."),this.isFocused=!1,this.mapProvider.unfocusMap()}focusMap(){this.logging.log("[mapping] Focus Map."),this.isFocused=!0,this.mapProvider.focusMap()}getMapBounds(){return this.mapProvider.getMapBounds()}getMapZoom(){return this.mapProvider.getMapZoom()}setMapZoom(ke){this.mapProvider.setMapZoom(ke)}getMapCenter(){return this.mapProvider.getMapCenter()}showPOIOnStaticMap(ke,Ne,$e=!1,Re=!1,_t=200,Ge=200){let ot=document.getElementById(ke);if(null!=ot){let wt=Ne.AddressInfo.Latitude,xt=Ne.AddressInfo.Longitude;_t>640&&(_t=640),Ge>640&&(Ge=640);let dt=_t,At=Ge,Vt="https://maps.googleapis.com/maps/api/staticmap?center="+wt+","+xt+"&zoom=14&size="+dt+"x"+At+"&maptype=roadmap&markers=color:blue%7Clabel:A%7C"+wt+","+xt+"&sensor=false",Un="";Un+=1==$e?"<div>"+j.c.formatMapLink(Ne,'<div><img width="'+dt+'" height="'+At+'" src="'+Vt+'" /></div>',Re)+"</div>":'<div><img width="'+dt+'" height="'+At+'" src="'+Vt+'" /></div>',ot.innerHTML=Un}}renderPolyline(ke){this.mapProvider.renderPolyline(ke)}clearPolyline(){this.mapProvider.clearPolyline()}clearMarkers(){this.logging.log("mapping: clearing markers"),this.mapProvider.clearMarkers()}addPOILayer(ke){this.mapProvider.addPOILayer(ke)}}return nt.\u0275fac=function(ke){return new(ke||nt)(re.LFG(_e.z),re.LFG(l.z),re.LFG(ge.eN))},nt.\u0275prov=re.Yz7({token:nt,factory:nt.\u0275fac,providedIn:"root"}),nt})()},5906:(Tn,Je,R)=>{"use strict";R.d(Je,{b:()=>d,_:()=>j});var u=R(2340),d=(()=>{return(l=d||(d={}))[l.GOOGLE_WEB=1]="GOOGLE_WEB",l[l.GOOGLE_NATIVE=2]="GOOGLE_NATIVE",l[l.LEAFLET=3]="LEAFLET",l[l.MAPBOX=4]="MAPBOX",l[l.MAPKIT_JS=5]="MAPKIT_JS",l[l.MAPTILER=6]="MAPTILER",d;var l})();class j{constructor(){this.enableClustering=!1,this.resultBatchID=-1,this.useMarkerIcons=!0,this.useMarkerAnimation=!0,this.enableTrackingMapCentre=!1,this.enableSearchByWatchingLocation=!1,this.mapCentre=null,this.mapAPI=u.N.defaultMapProvider,this.mapType="ROADMAP",this.searchDistanceKM=1e5,this.mapMoveQueryRefreshMS=300,this.enableSearchRadiusIndicator=!1,this.minZoomLevel=2}}},553:(Tn,Je,R)=>{"use strict";R.d(Je,{k:()=>xe});var u=R(6099),d=R(6579),j=R(5906),l=R(2916),L=R(2210),P=R(4120),m=R(7689),$=R(9898),V=R(2340),Z=R(4209),K=R(6738),re=R(6260),_e=R(529);let xe=(()=>{class je{constructor(Fe,ke,Ne){this.events=Fe,this.logging=ke,this.http=Ne,this._isMapAnimating=!1,this.events=Fe,this.mapAPIType=j.b.MAPBOX,this.mapReady=!1,this.markerList=new L.Xy}initAPI(){$&&($.accessToken=V.N.mapBoxToken)}disposeMap(){this.map&&(this.logging.log("Disposing map",m.i.INFO),this.map.remove())}getCurrentMapTileSet(Fe){return"SATELLITE"==Fe?"mapbox://styles/mapbox/satellite-streets-v11?optimize=true":"mapbox://styles/mapbox/streets-v11?optimize=true"}flyAroundPoint(Fe){if(this._isMapAnimating){this.map.rotateTo(Fe/100%360,{duration:0});const ke=this;requestAnimationFrame(function(Ne){ke.flyAroundPoint(Ne)})}}initMap(Fe,ke,Ne){this.mapCanvasID=Fe;let $e=!0;if($e=void 0!==$,!$e)return this.logging.log("Call to initMap before API is ready:"+j.b[this.mapAPIType],m.i.ERROR),this.mapReady=!1,!1;if(null==this.map){let ot=function(wt){return wt*(2-wt)};document.getElementById(Fe),this.initAPI(),this.map=new $.Map({container:Fe,style:this.getCurrentMapTileSet(ke.mapType),zoom:15,attributionControl:!1}),this.map.addControl(new $.AttributionControl({compact:!0,customAttribution:["Open Charge Map Contributors"]})),this.map.addControl(new $.NavigationControl),this.mapReady=!0,this.map.getCanvas().focus();let _t=100,Ge=25;this.map.getCanvas().addEventListener("keydown",wt=>{wt.preventDefault(),38===wt.which?this.map.panBy([0,-_t],{easing:ot}):40===wt.which?this.map.panBy([0,_t],{easing:ot}):37===wt.which?this.map.easeTo({bearing:this.map.getBearing()-Ge,easing:ot}):39===wt.which?this.map.easeTo({bearing:this.map.getBearing()+Ge,easing:ot}):32===wt.which&&(this._isMapAnimating?this._isMapAnimating=!1:(this._isMapAnimating=!0,this.flyAroundPoint(0)))},!0),this.map.on("load",()=>{this.events.publish("ocm:mapping:ready")});let yt=d.c.debounce(()=>{this.getMapCenter().subscribe(wt=>{this.searchMarker.setLngLat(new $.LngLat(wt.coords.longitude,wt.coords.latitude))})},500,!1);this.map.on("move",()=>{this.searchMarker&&yt()}),this.map.on("moveend",()=>{this.events.publish("ocm:mapping:dragend"),ke.onMapMoveCompleted&&ke.onMapMoveCompleted()}),this.map.on("zoomend",()=>{this.events.publish("ocm:mapping:zoom")})}}clearMarkers(){null!=this.markerList&&this.markerList.forEach((Fe,ke)=>{try{ke.remove()}catch{}}),this.markerList=new L.Xy}showPOIListOnMap(Fe,ke,Ne=!0){let Re=this.map,_t=new $.LngLatBounds,Ge=0;if(Re.getZoom(),null!=Fe){for(let dt=0;dt<Fe.length;dt++)if(null!=Fe[dt].AddressInfo&&null!=Fe[dt].AddressInfo.Latitude&&null!=Fe[dt].AddressInfo.Longitude){let At=Fe[dt],Vt=!0;if(null!=this.markerList&&this.markerList.containsKey(At.ID)){Vt=!1;let Un=this.markerList.getValue(At.ID);Un&&Un.poi&&Un.poi.DateLastStatusUpdate!=At.DateLastStatusUpdate&&(Un.remove(),Vt=!0)}if(Vt){let Un=null,St=null;Ne?(Un=document.createElement("img"),Un.src=d.c.getIconForPOI(At),Un.width=34,Un.height=50):(Un=null,St=d.c.getColorForPOI(At));let zt=(Ne?"OCM-":"EXT-")+At.ID+": "+At.AddressInfo.Title+":";null!=At.UsageType&&(zt+=" "+At.UsageType.Title),null!=At.StatusType&&(zt+=" "+At.StatusType.Title);let Ht=new $.Marker({element:Un,color:St}).setLngLat([At.AddressInfo.Longitude,At.AddressInfo.Latitude]).addTo(Re);Ht.poi=At;let en=Ht.getElement();en.poi=At,en.addEventListener("click",Kt=>{const Wt=Kt.currentTarget.poi;this.events.publish("ocm:poi:selected",{poiId:Wt.ID,poi:Wt})}),_t.extend(Ht.getLngLat()),this.markerList.setValue(At.ID,Ht),Ge++}}this.logging.log(Ge+" new map markers added out of a total "+this.markerList.size())}if(null!=Fe&&Fe.length>0)if(null==ke||ke.appConfig.enableLiveMapQuerying)null==Re.getCenter()&&Re.setCenter(_t.getCenter());else{this.logging.log("Fitting to marker bounds:"+_t),Re.setCenter(_t.getCenter()),this.logging.log("zoom before fit bounds:"+Re.getZoom()),Re.fitBounds(_t);let xt=Re.getZoom();Re.setZoom(xt<6?6:xt)}}refreshMapLayout(){null!=this.map&&setTimeout(()=>{this.logging.log("MapBoxGL: refreshMapLayout",m.i.VERBOSE),this.map.resize()},200)}setMapCenter(Fe){this.mapReady&&(this.map.setCenter(new $.LngLat(Fe.coords.longitude,Fe.coords.latitude)),this.searchMarker||(this.searchMarker=new $.Marker({color:"#99ccff",anchor:"top"}).setLngLat(new $.LngLat(Fe.coords.longitude,Fe.coords.latitude)).addTo(this.map),this.searchMarker.getElement().addEventListener("click",()=>{let ke=this.searchMarker.getLngLat();this.events.publish("ocm:mapping:addpoi",new P.wC(ke.lat,ke.lng))})))}getMapCenter(){return new l.y(ke=>{if(null!=this.map){let Ne=this.map.getCenter();null!=Ne&&(ke.next(new P.jR(Ne.lat,Ne.lng)),ke.complete())}})}setMapZoom(Fe){this.map.setZoom(Fe)}getMapZoom(){return new l.y(ke=>{let Ne=this.map.getZoom();ke.next(Ne),ke.complete()})}setMapType(Fe){this.map.setStyle(this.getCurrentMapTileSet(Fe))}getMapBounds(){return new l.y(ke=>{let Ne=new Array,$e=this.map.getBounds();Ne.push(new P.wC($e.getSouthWest().lat,$e.getSouthWest().lng)),Ne.push(new P.wC($e.getNorthEast().lat,$e.getNorthEast().lng)),ke.next(Ne),ke.complete()})}moveToMapBounds(Fe){this.map.fitBounds(new $.LngLatBounds(new $.LngLat(Fe.southWest.longitude,Fe.southWest.latitude),new $.LngLat(Fe.northEast.longitude,Fe.northEast.latitude)))}renderMap(Fe,ke,Ne){return document.getElementById(this.mapCanvasID).style.height=ke+"px",this.mapReady&&this.showPOIListOnMap(Fe,Ne),!0}renderPolyline(Fe){this.clearPolyline()}clearPolyline(){null!=this.polylinePath&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(Fe,ke,Ne){var $e=this;return(0,u.Z)(function*(){let Re=`https://api.mapbox.com/geocoding/v5/mapbox.places/${Fe||Ne+","+ke}.json?access_token=${V.N.mapBoxToken}`;return new Promise(function(){var _t=(0,u.Z)(function*(Ge,ot){$e.http.get(Re).toPromise().then(yt=>{let wt=[];wt=[],yt.features&&yt.features.map(xt=>{let dt=new Z.n;dt.Title=xt.place_name,dt.Address=xt.place_name,dt.Type="place",dt.Location=new P.wC(xt.center[1],xt.center[0]),dt.Attribution=yt.attribution,wt.push(dt)}),Ge(wt)})});return function(Ge,ot){return _t.apply(this,arguments)}}())})()}addPOILayer(Fe){this.logging.log("Add POI Layer not implemented in this provider."),this.showPOIListOnMap(Fe,null,!1)}}return je.\u0275fac=function(Fe){return new(Fe||je)(K.LFG(re.z),K.LFG(m.z),K.LFG(_e.eN))},je.\u0275prov=K.Yz7({token:je,factory:je.\u0275fac}),je})()},2340:(Tn,Je,R)=>{"use strict";R.d(Je,{N:()=>u});const u={name:"prod",version:"8.1.2",production:!0,analyticsId:"",googleMapsKey:"",mapBoxToken:"pk.eyJ1Ijoid2VicHJvZnVzaW9uIiwiYSI6ImNrdHZlc2N5dTI5Zjcydm8zYWFwc2JnbTMifQ.M7b5SOzbPcg_8XAHCOeP0w",mapKitToken:"",enableStaticMaps:!1,defaultMapProvider:4,apiBase:"https://api.openchargemap.io",apiKey:"9bb03e5b-0fb2-4916-9b2b-26c6bd27a56a",enabledFeatures:["MAP","ADD_COMMENT","ADD_PHOTO","FAVOURITES","FILTER_OPTIONS_BY_COUNTRY","ADD_POI","EDIT_POI","LAYERS"]}},3592:(Tn,Je,R)=>{"use strict";var u=R(6895),d=R(6738);class j extends u.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class l extends j{static makeCurrent(){(0,u.HT)(new l)}onAndCancel(Ke,Se,Ct){return Ke.addEventListener(Se,Ct,!1),()=>{Ke.removeEventListener(Se,Ct,!1)}}dispatchEvent(Ke,Se){Ke.dispatchEvent(Se)}remove(Ke){Ke.parentNode&&Ke.parentNode.removeChild(Ke)}createElement(Ke,Se){return(Se=Se||this.getDefaultDocument()).createElement(Ke)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(Ke){return Ke.nodeType===Node.ELEMENT_NODE}isShadowRoot(Ke){return Ke instanceof DocumentFragment}getGlobalEventTarget(Ke,Se){return"window"===Se?window:"document"===Se?Ke:"body"===Se?Ke.body:null}getBaseHref(Ke){const Se=function P(){return L=L||document.querySelector("base"),L?L.getAttribute("href"):null}();return null==Se?null:function $(it){m=m||document.createElement("a"),m.setAttribute("href",it);const Ke=m.pathname;return"/"===Ke.charAt(0)?Ke:`/${Ke}`}(Se)}resetBaseElement(){L=null}getUserAgent(){return window.navigator.userAgent}getCookie(Ke){return(0,u.Mx)(document.cookie,Ke)}}let m,L=null;const ue=new d.OlP("TRANSITION_ID"),Z=[{provide:d.ip1,useFactory:function V(it,Ke,Se){return()=>{Se.get(d.CZH).donePromise.then(()=>{const Ct=(0,u.q)(),sn=Ke.querySelectorAll(`style[ng-transition="${it}"]`);for(let si=0;si<sn.length;si++)Ct.remove(sn[si])})}},deps:[ue,u.K0,d.zs3],multi:!0}];class K{static init(){(0,d.VLi)(new K)}addToWindow(Ke){d.dqk.getAngularTestability=(Ct,sn=!0)=>{const si=Ke.findTestabilityInTree(Ct,sn);if(null==si)throw new Error("Could not find testability for element.");return si},d.dqk.getAllAngularTestabilities=()=>Ke.getAllTestabilities(),d.dqk.getAllAngularRootElements=()=>Ke.getAllRootElements(),d.dqk.frameworkStabilizers||(d.dqk.frameworkStabilizers=[]),d.dqk.frameworkStabilizers.push(Ct=>{const sn=d.dqk.getAllAngularTestabilities();let si=sn.length,hi=!1;const io=function(ar){hi=hi||ar,si--,0==si&&Ct(hi)};sn.forEach(function(ar){ar.whenStable(io)})})}findTestabilityInTree(Ke,Se,Ct){return null==Se?null:Ke.getTestability(Se)??(Ct?(0,u.q)().isShadowRoot(Se)?this.findTestabilityInTree(Ke,Se.host,!0):this.findTestabilityInTree(Ke,Se.parentElement,!0):null)}}let re=(()=>{class it{build(){return new XMLHttpRequest}}return it.\u0275fac=function(Se){return new(Se||it)},it.\u0275prov=d.Yz7({token:it,factory:it.\u0275fac}),it})();const _e=new d.OlP("EventManagerPlugins");let ge=(()=>{class it{constructor(Se,Ct){this._zone=Ct,this._eventNameToPlugin=new Map,Se.forEach(sn=>sn.manager=this),this._plugins=Se.slice().reverse()}addEventListener(Se,Ct,sn){return this._findPluginFor(Ct).addEventListener(Se,Ct,sn)}addGlobalEventListener(Se,Ct,sn){return this._findPluginFor(Ct).addGlobalEventListener(Se,Ct,sn)}getZone(){return this._zone}_findPluginFor(Se){const Ct=this._eventNameToPlugin.get(Se);if(Ct)return Ct;const sn=this._plugins;for(let si=0;si<sn.length;si++){const hi=sn[si];if(hi.supports(Se))return this._eventNameToPlugin.set(Se,hi),hi}throw new Error(`No event manager plugin found for event ${Se}`)}}return it.\u0275fac=function(Se){return new(Se||it)(d.LFG(_e),d.LFG(d.R0b))},it.\u0275prov=d.Yz7({token:it,factory:it.\u0275fac}),it})();class xe{constructor(Ke){this._doc=Ke}addGlobalEventListener(Ke,Se,Ct){const sn=(0,u.q)().getGlobalEventTarget(this._doc,Ke);if(!sn)throw new Error(`Unsupported event target ${sn} for event ${Se}`);return this.addEventListener(sn,Se,Ct)}}let je=(()=>{class it{constructor(){this._stylesSet=new Set}addStyles(Se){const Ct=new Set;Se.forEach(sn=>{this._stylesSet.has(sn)||(this._stylesSet.add(sn),Ct.add(sn))}),this.onStylesAdded(Ct)}onStylesAdded(Se){}getAllStyles(){return Array.from(this._stylesSet)}}return it.\u0275fac=function(Se){return new(Se||it)},it.\u0275prov=d.Yz7({token:it,factory:it.\u0275fac}),it})(),nt=(()=>{class it extends je{constructor(Se){super(),this._doc=Se,this._hostNodes=new Map,this._hostNodes.set(Se.head,[])}_addStylesToHost(Se,Ct,sn){Se.forEach(si=>{const hi=this._doc.createElement("style");hi.textContent=si,sn.push(Ct.appendChild(hi))})}addHost(Se){const Ct=[];this._addStylesToHost(this._stylesSet,Se,Ct),this._hostNodes.set(Se,Ct)}removeHost(Se){const Ct=this._hostNodes.get(Se);Ct&&Ct.forEach(Fe),this._hostNodes.delete(Se)}onStylesAdded(Se){this._hostNodes.forEach((Ct,sn)=>{this._addStylesToHost(Se,sn,Ct)})}ngOnDestroy(){this._hostNodes.forEach(Se=>Se.forEach(Fe))}}return it.\u0275fac=function(Se){return new(Se||it)(d.LFG(u.K0))},it.\u0275prov=d.Yz7({token:it,factory:it.\u0275fac}),it})();function Fe(it){(0,u.q)().remove(it)}const ke={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Ne=/%COMP%/g;function wt(it,Ke,Se){for(let Ct=0;Ct<Ke.length;Ct++){let sn=Ke[Ct];Array.isArray(sn)?wt(it,sn,Se):(sn=sn.replace(Ne,it),Se.push(sn))}return Se}function xt(it){return Ke=>{if("__ngUnwrap__"===Ke)return it;!1===it(Ke)&&(Ke.preventDefault(),Ke.returnValue=!1)}}let At=(()=>{class it{constructor(Se,Ct,sn){this.eventManager=Se,this.sharedStylesHost=Ct,this.appId=sn,this.rendererByCompId=new Map,this.defaultRenderer=new Vt(Se)}createRenderer(Se,Ct){if(!Se||!Ct)return this.defaultRenderer;switch(Ct.encapsulation){case d.ifc.Emulated:{let sn=this.rendererByCompId.get(Ct.id);return sn||(sn=new $t(this.eventManager,this.sharedStylesHost,Ct,this.appId),this.rendererByCompId.set(Ct.id,sn)),sn.applyToHost(Se),sn}case 1:case d.ifc.ShadowDom:return new zt(this.eventManager,this.sharedStylesHost,Se,Ct);default:if(!this.rendererByCompId.has(Ct.id)){const sn=wt(Ct.id,Ct.styles,[]);this.sharedStylesHost.addStyles(sn),this.rendererByCompId.set(Ct.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return it.\u0275fac=function(Se){return new(Se||it)(d.LFG(ge),d.LFG(nt),d.LFG(d.AFp))},it.\u0275prov=d.Yz7({token:it,factory:it.\u0275fac}),it})();class Vt{constructor(Ke){this.eventManager=Ke,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(Ke,Se){return Se?document.createElementNS(ke[Se]||Se,Ke):document.createElement(Ke)}createComment(Ke){return document.createComment(Ke)}createText(Ke){return document.createTextNode(Ke)}appendChild(Ke,Se){Ke.appendChild(Se)}insertBefore(Ke,Se,Ct){Ke&&Ke.insertBefore(Se,Ct)}removeChild(Ke,Se){Ke&&Ke.removeChild(Se)}selectRootElement(Ke,Se){let Ct="string"==typeof Ke?document.querySelector(Ke):Ke;if(!Ct)throw new Error(`The selector "${Ke}" did not match any elements`);return Se||(Ct.textContent=""),Ct}parentNode(Ke){return Ke.parentNode}nextSibling(Ke){return Ke.nextSibling}setAttribute(Ke,Se,Ct,sn){if(sn){Se=sn+":"+Se;const si=ke[sn];si?Ke.setAttributeNS(si,Se,Ct):Ke.setAttribute(Se,Ct)}else Ke.setAttribute(Se,Ct)}removeAttribute(Ke,Se,Ct){if(Ct){const sn=ke[Ct];sn?Ke.removeAttributeNS(sn,Se):Ke.removeAttribute(`${Ct}:${Se}`)}else Ke.removeAttribute(Se)}addClass(Ke,Se){Ke.classList.add(Se)}removeClass(Ke,Se){Ke.classList.remove(Se)}setStyle(Ke,Se,Ct,sn){sn&(d.JOm.DashCase|d.JOm.Important)?Ke.style.setProperty(Se,Ct,sn&d.JOm.Important?"important":""):Ke.style[Se]=Ct}removeStyle(Ke,Se,Ct){Ct&d.JOm.DashCase?Ke.style.removeProperty(Se):Ke.style[Se]=""}setProperty(Ke,Se,Ct){Ke[Se]=Ct}setValue(Ke,Se){Ke.nodeValue=Se}listen(Ke,Se,Ct){return"string"==typeof Ke?this.eventManager.addGlobalEventListener(Ke,Se,xt(Ct)):this.eventManager.addEventListener(Ke,Se,xt(Ct))}}class $t extends Vt{constructor(Ke,Se,Ct,sn){super(Ke),this.component=Ct;const si=wt(sn+"-"+Ct.id,Ct.styles,[]);Se.addStyles(si),this.contentAttr=function ot(it){return"_ngcontent-%COMP%".replace(Ne,it)}(sn+"-"+Ct.id),this.hostAttr=function yt(it){return"_nghost-%COMP%".replace(Ne,it)}(sn+"-"+Ct.id)}applyToHost(Ke){super.setAttribute(Ke,this.hostAttr,"")}createElement(Ke,Se){const Ct=super.createElement(Ke,Se);return super.setAttribute(Ct,this.contentAttr,""),Ct}}class zt extends Vt{constructor(Ke,Se,Ct,sn){super(Ke),this.sharedStylesHost=Se,this.hostEl=Ct,this.shadowRoot=Ct.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const si=wt(sn.id,sn.styles,[]);for(let hi=0;hi<si.length;hi++){const io=document.createElement("style");io.textContent=si[hi],this.shadowRoot.appendChild(io)}}nodeOrShadowRoot(Ke){return Ke===this.hostEl?this.shadowRoot:Ke}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(Ke,Se){return super.appendChild(this.nodeOrShadowRoot(Ke),Se)}insertBefore(Ke,Se,Ct){return super.insertBefore(this.nodeOrShadowRoot(Ke),Se,Ct)}removeChild(Ke,Se){return super.removeChild(this.nodeOrShadowRoot(Ke),Se)}parentNode(Ke){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(Ke)))}}let Ht=(()=>{class it extends xe{constructor(Se){super(Se)}supports(Se){return!0}addEventListener(Se,Ct,sn){return Se.addEventListener(Ct,sn,!1),()=>this.removeEventListener(Se,Ct,sn)}removeEventListener(Se,Ct,sn){return Se.removeEventListener(Ct,sn)}}return it.\u0275fac=function(Se){return new(Se||it)(d.LFG(u.K0))},it.\u0275prov=d.Yz7({token:it,factory:it.\u0275fac}),it})();const en=["alt","control","meta","shift"],Wt={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Yt={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},qt={alt:it=>it.altKey,control:it=>it.ctrlKey,meta:it=>it.metaKey,shift:it=>it.shiftKey};let Gt=(()=>{class it extends xe{constructor(Se){super(Se)}supports(Se){return null!=it.parseEventName(Se)}addEventListener(Se,Ct,sn){const si=it.parseEventName(Ct),hi=it.eventCallback(si.fullKey,sn,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,u.q)().onAndCancel(Se,si.domEventName,hi))}static parseEventName(Se){const Ct=Se.toLowerCase().split("."),sn=Ct.shift();if(0===Ct.length||"keydown"!==sn&&"keyup"!==sn)return null;const si=it._normalizeKey(Ct.pop());let hi="";if(en.forEach(ar=>{const es=Ct.indexOf(ar);es>-1&&(Ct.splice(es,1),hi+=ar+".")}),hi+=si,0!=Ct.length||0===si.length)return null;const io={};return io.domEventName=sn,io.fullKey=hi,io}static getEventFullKey(Se){let Ct="",sn=function ft(it){let Ke=it.key;if(null==Ke){if(Ke=it.keyIdentifier,null==Ke)return"Unidentified";Ke.startsWith("U+")&&(Ke=String.fromCharCode(parseInt(Ke.substring(2),16)),3===it.location&&Yt.hasOwnProperty(Ke)&&(Ke=Yt[Ke]))}return Wt[Ke]||Ke}(Se);return sn=sn.toLowerCase()," "===sn?sn="space":"."===sn&&(sn="dot"),en.forEach(si=>{si!=sn&&qt[si](Se)&&(Ct+=si+".")}),Ct+=sn,Ct}static eventCallback(Se,Ct,sn){return si=>{it.getEventFullKey(si)===Se&&sn.runGuarded(()=>Ct(si))}}static _normalizeKey(Se){return"esc"===Se?"escape":Se}}return it.\u0275fac=function(Se){return new(Se||it)(d.LFG(u.K0))},it.\u0275prov=d.Yz7({token:it,factory:it.\u0275fac}),it})();const ei=(0,d.eFA)(d._c5,"browser",[{provide:d.Lbi,useValue:u.bD},{provide:d.g9A,useValue:function Ut(){l.makeCurrent(),K.init()},multi:!0},{provide:u.K0,useFactory:function fn(){return(0,d.RDi)(document),document},deps:[]}]),$i=[{provide:d.zSh,useValue:"root"},{provide:d.qLn,useFactory:function On(){return new d.qLn},deps:[]},{provide:_e,useClass:Ht,multi:!0,deps:[u.K0,d.R0b,d.Lbi]},{provide:_e,useClass:Gt,multi:!0,deps:[u.K0]},{provide:At,useClass:At,deps:[ge,nt,d.AFp]},{provide:d.FYo,useExisting:At},{provide:je,useExisting:nt},{provide:nt,useClass:nt,deps:[u.K0]},{provide:d.dDg,useClass:d.dDg,deps:[d.R0b]},{provide:ge,useClass:ge,deps:[_e,d.R0b]},{provide:u.JF,useClass:re,deps:[]}];let sr=(()=>{class it{constructor(Se){if(Se)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(Se){return{ngModule:it,providers:[{provide:d.AFp,useValue:Se.appId},{provide:ue,useExisting:d.AFp},Z]}}}return it.\u0275fac=function(Se){return new(Se||it)(d.LFG(it,12))},it.\u0275mod=d.oAB({type:it}),it.\u0275inj=d.cJS({providers:$i,imports:[u.ez,d.hGG]}),it})();"undefined"!=typeof window&&window;var We=R(8936),mt=R(9397),Dt=R(4006),Xe=R(9064);let kt=(()=>{class it{}return it.\u0275fac=function(Se){return new(Se||it)},it.\u0275mod=d.oAB({type:it}),it.\u0275inj=d.cJS({imports:[[u.ez,Dt.u5,Xe.Pc,mt.aw,We.e]]}),it})(),tn=(()=>{class it{}return it.\u0275fac=function(Se){return new(Se||it)},it.\u0275mod=d.oAB({type:it}),it.\u0275inj=d.cJS({imports:[[u.ez,Dt.u5,Xe.Pc,mt.aw,We.e]]}),it})(),rn=(()=>{class it{}return it.\u0275fac=function(Se){return new(Se||it)},it.\u0275mod=d.oAB({type:it}),it.\u0275inj=d.cJS({imports:[[u.ez,Dt.u5,Xe.Pc,mt.aw,We.e]]}),it})();var pn=R(9671),Ln=R(529),qn=R(3334),ni=R(4244);class Hn{constructor(Ke,Se="/assets/i18n/",Ct=".json"){this.http=Ke,this.prefix=Se,this.suffix=Ct}getTranslation(Ke){return this.http.get(`${this.prefix}${Ke}${this.suffix}`)}}var ii=R(6099),Ui=R(4781),Fi=R(6763),ci=R(9492),Mn=R(9741),mi=R(3855);function Ii(it,Ke){if(1&it){const Se=d.EpF();d.TgZ(0,"div"),d._uU(1," You are not signed in. "),d.TgZ(2,"button",5),d.NdJ("click",function(){return d.CHM(Se),d.oxw().showSignInModal()}),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.qZA()}2&it&&(d.xp6(3),d.Oqu(d.lcZ(4,1,"ocm.general.signIn")))}function Zi(it,Ke){if(1&it&&(d.TgZ(0,"div"),d.TgZ(1,"ion-card"),d.TgZ(2,"ion-item"),d.TgZ(3,"ion-avatar",6),d._UZ(4,"img",7),d.qZA(),d.TgZ(5,"h2"),d._uU(6),d.qZA(),d.qZA(),d.TgZ(7,"ion-card-content"),d.TgZ(8,"p"),d._uU(9),d.qZA(),d.TgZ(10,"p"),d._uU(11),d.qZA(),d.qZA(),d.TgZ(12,"ion-item"),d.TgZ(13,"ion-note",8),d._UZ(14,"ion-icon",9),d._uU(15),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&it){const Se=d.oxw();d.xp6(4),d.s9C("src",Se.userProfile.ProfileImageURL,d.LSH),d.xp6(2),d.Oqu(Se.userProfile.Username),d.xp6(3),d.hij(" ",Se.userProfile.Profile,""),d.xp6(2),d.hij(" Date Joined: ",Se.userProfile.DateCreated," "),d.xp6(4),d.hij(" ",Se.userProfile.ReputationPoints," Contributor Points ")}}let cr=(()=>{class it{constructor(Se,Ct,sn,si){this.appManager=Se,this.nav=Ct,this.translate=sn,this.modalController=si}ionViewDidEnter(){this.userProfile=this.appManager.getUserProfile(),null!=this.userProfile&&this.appManager.isUserAuthenticated(!0)?this.refreshProfileView():this.showSignInModal(),this.appManager.analytics.viewEvent("Profile")}refreshProfileView(){this.userProfile=this.appManager.getUserProfile()}showSignInModal(){this.modalController.create({component:ci.F,componentProps:{Profile:this.userProfile}}).then(Se=>{Se.onDidDismiss().then(()=>{this.refreshProfileView()}),Se.present()})}close(){this.modalController.dismiss()}}return it.\u0275fac=function(Se){return new(Se||it)(d.Y36(mi.c),d.Y36(Xe.SH),d.Y36(mt.sK),d.Y36(Xe.IN))},it.\u0275cmp=d.Xpm({type:it,selectors:[["ng-component"]],decls:14,vars:5,consts:[[1,"profile-page","ion-padding"],[4,"ngIf"],["slot","end"],[3,"click"],["name","close","slot","start"],["ion-button","",3,"click"],["slot","start"],[3,"src"],["item-left",""],["name","star"]],template:function(Se,Ct){1&Se&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-title"),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(5,"ion-content",0),d.YNc(6,Ii,5,3,"div",1),d.YNc(7,Zi,16,5,"div",1),d.qZA(),d.TgZ(8,"ion-footer"),d.TgZ(9,"ion-toolbar"),d.TgZ(10,"ion-buttons",2),d.TgZ(11,"ion-button",3),d.NdJ("click",function(){return Ct.close()}),d._UZ(12,"ion-icon",4),d._uU(13," Close "),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&Se&&(d.xp6(3),d.hij(" ",d.lcZ(4,3,"ocm.navigation.profile.sectionTitle")," "),d.xp6(3),d.Q6J("ngIf",null==Ct.userProfile),d.xp6(1),d.Q6J("ngIf",null!=Ct.userProfile))},directives:[Xe.Gu,Xe.sr,Xe.wd,Xe.W2,u.O5,Xe.PM,Xe.Ie,Xe.BJ,Xe.FN,Xe.uN,Xe.gu,Xe.fr,Xe.Sm,Xe.YG],pipes:[mt.X$],encapsulation:2}),it})();var oi=R(7689),_r=R(2340),ur=R(4508),Nr=R(56),go=R(6579),bi=R(388),ao=R(6588),Hr=R(7423);const Jr=(0,Hr.fo)("PushNotifications",{}),Pr=(0,Hr.fo)("StatusBar"),Lr=(0,Hr.fo)("SplashScreen",{web:()=>R.e(2680).then(R.bind(R,2680)).then(it=>new it.SplashScreenWeb)}),Vr=(0,Hr.fo)("App",{web:()=>R.e(4477).then(R.bind(R,4477)).then(it=>new it.AppWeb)});var Ee=R(6260);function He(it,Ke){if(1&it){const Se=d.EpF();d.TgZ(0,"ion-item",9),d.NdJ("click",function(){return d.CHM(Se),d.oxw().openRoutePlannerModal()}),d._UZ(1,"ion-icon",12),d.TgZ(2,"ion-label"),d._uU(3," Route Planner "),d.qZA(),d.qZA()}}function Ce(it,Ke){if(1&it){const Se=d.EpF();d.TgZ(0,"ion-item",9),d.NdJ("click",function(){return d.CHM(Se),d.oxw().add()}),d._UZ(1,"ion-icon",13),d.TgZ(2,"ion-label"),d._uU(3),d.ALo(4,"translate"),d.qZA(),d.qZA()}2&it&&(d.xp6(3),d.hij(" ",d.lcZ(4,1,"ocm.general.addLocation")," "))}function tt(it,Ke){if(1&it){const Se=d.EpF();d.TgZ(0,"ion-item",9),d.NdJ("click",function(){return d.CHM(Se),d.oxw().journeys()}),d._UZ(1,"ion-icon",12),d.TgZ(2,"ion-label"),d._uU(3," Journeys "),d.qZA(),d.qZA()}}function It(it,Ke){if(1&it){const Se=d.EpF();d.TgZ(0,"ion-item",9),d.NdJ("click",function(){return d.CHM(Se),d.oxw().addLayer()}),d._UZ(1,"ion-icon",14),d.TgZ(2,"ion-label"),d._uU(3," Add Layer "),d.qZA(),d.qZA()}}function Lt(it,Ke){if(1&it){const Se=d.EpF();d.ynx(0),d.TgZ(1,"ion-item",9),d.NdJ("click",function(){return d.CHM(Se),d.oxw().signIn()}),d._UZ(2,"ion-icon",15),d.TgZ(3,"ion-label"),d._uU(4),d.ALo(5,"translate"),d.qZA(),d.qZA(),d.BQk()}2&it&&(d.xp6(4),d.hij(" ",d.lcZ(5,1,"ocm.general.signIn")," "))}function nn(it,Ke){if(1&it){const Se=d.EpF();d.ynx(0),d.TgZ(1,"ion-item",9),d.NdJ("click",function(){return d.CHM(Se),d.oxw().profile()}),d._UZ(2,"ion-icon",15),d.TgZ(3,"ion-label"),d._uU(4),d.ALo(5,"translate"),d.qZA(),d.qZA(),d.TgZ(6,"ion-item",9),d.NdJ("click",function(){return d.CHM(Se),d.oxw().signOut()}),d._UZ(7,"ion-icon",16),d.TgZ(8,"ion-label"),d._uU(9),d.ALo(10,"translate"),d._UZ(11,"br"),d.TgZ(12,"small",17),d._uU(13),d.qZA(),d.qZA(),d.qZA(),d.BQk()}if(2&it){const Se=d.oxw();d.xp6(4),d.hij(" ",d.lcZ(5,3,"ocm.navigation.profile.sectionTitle")," "),d.xp6(5),d.hij(" ",d.lcZ(10,5,"ocm.general.signOut")," "),d.xp6(4),d.hij(" ",Se.getUserName(),"")}}const dn=function(){return["/search"]};let ln=(()=>{class it{constructor(Se,Ct,sn,si,hi,io,ar,es){this.platform=Se,this.translate=Ct,this.mapping=sn,this.modalController=si,this.appManager=hi,this.logger=io,this.analytics=ar,this.events=es,this.logger.log("Environment: "+_r.N.name),this.initializeApp(),this.enabledFeatures=_r.N.enabledFeatures,1!=hi.searchSettings.EnableAdvancedEditorFeatures&&(this.enabledFeatures=this.enabledFeatures.filter(ts=>"LAYERS"!=ts))}configurePushNotifications(){Jr.register(),Jr.addListener("registration",Se=>{this.logger.log("Push registration success, token: "+Se.value),this.appManager.savePushRegistration(Se.value)}),Jr.addListener("registrationError",Se=>{this.logger.log("Error on registration: "+JSON.stringify(Se))}),Jr.addListener("pushNotificationReceived",Se=>{this.logger.log("Push received: "+JSON.stringify(Se),oi.i.INFO)}),Jr.addListener("pushNotificationActionPerformed",Se=>{this.logger.log("Push action performed: "+JSON.stringify(Se))})}isUserAuthenticated(){return this.appManager.isUserAuthenticated()}getUserName(){let Se=this.appManager.getUserProfile();return Se?Se.EmailAddress?Se.EmailAddress:Se.Username:"Not Signed In"}initializeApp(){var Se=this;this.platform.ready().then(()=>{this.platform.is("capacitor")&&(Pr.show(),Lr.hide()),this.translate.addLangs(this.appManager.getLanguages().map(Ct=>Ct.code)),this.translate.setDefaultLang("en"),null!=this.appManager.searchSettings.Language?this.translate.use(this.appManager.searchSettings.Language):this.translate.currentLang||this.translate.use("en"),this.translate.get("ocm.search.performSearch").toPromise().then(Ct=>{}),this.analytics.init(_r.N.analyticsId).then(()=>{this.analytics.setAppVersion(_r.N.version),this.analytics.appEvent("Startup","App Loaded")}).catch(Ct=>this.logger.log("Error starting analytics")),this.events.subscribe("ocm:mapping:addpoi",function(){var Ct=(0,ii.Z)(function*(sn){go.c.isFeatureEnabled("ADD_POI")&&Se.add(sn)});return function(sn){return Ct.apply(this,arguments)}}()),(this.platform.is("ios")||this.platform.is("android"))&&(this.configurePushNotifications(),this.checkForAppOpenUrl())})}checkForAppOpenUrl(){return(0,ii.Z)(function*(){Vr.addListener("appUrlOpen",Ct=>{alert("App (re)opened with URL: "+Ct.url)});let Se=yield Vr.getLaunchUrl();Se&&Se.url&&alert("App opened with URL: "+Se.url)})()}openRoutePlannerModal(){var Se=this;return(0,ii.Z)(function*(){Se.mapping.unfocusMap();const Ct=yield Se.modalController.create({component:Fi.u});Ct.onDidDismiss().then(sn=>{Se.mapping.focusMap()}),yield Ct.present()})()}continueAdd(Se){var Ct=this;return(0,ii.Z)(function*(){const sn=yield Ct.modalController.create({component:ur.Y,componentProps:{startPos:Se}});sn.onDidDismiss().then(si=>{Ct.mapping.focusMap()}),yield sn.present()})()}add(Se){var Ct=this;return(0,ii.Z)(function*(){if(Ct.mapping.unfocusMap(),!Ct.appManager.isUserAuthenticated(!0)){const sn=yield Ct.modalController.create({component:ci.F});return sn.onDidDismiss().then(function(){var si=(0,ii.Z)(function*(hi){Ct.mapping.focusMap(),Ct.appManager.isUserAuthenticated(!0)&&(yield Ct.continueAdd(Se))});return function(hi){return si.apply(this,arguments)}}()),yield sn.present()}yield Ct.continueAdd(Se)})()}signIn(){var Se=this;return(0,ii.Z)(function*(){Se.mapping.unfocusMap();const Ct=yield Se.modalController.create({component:ci.F});return Ct.onDidDismiss().then(sn=>{Se.mapping.focusMap(),Se.appManager.isUserAuthenticated(!0)}),yield Ct.present()})()}signOut(){var Se=this;return(0,ii.Z)(function*(){Se.appManager.signOutCurrentUser()})()}profile(){var Se=this;return(0,ii.Z)(function*(){Se.mapping.unfocusMap();const Ct=yield Se.modalController.create({component:cr});Ct.onDidDismiss().then(sn=>{Se.mapping.focusMap()}),yield Ct.present()})()}journeys(){var Se=this;return(0,ii.Z)(function*(){Se.mapping.unfocusMap();const Ct=yield Se.modalController.create({component:Mn.g});Ct.onDidDismiss().then(sn=>{Se.mapping.focusMap()}),yield Ct.present()})()}addLayer(){var Se=this;return(0,ii.Z)(function*(){const Ct=yield Se.modalController.create({component:ao.A});yield Ct.present();const{data:sn}=yield Ct.onWillDismiss();sn&&Se.mapping.addPOILayer(sn)})()}about(){var Se=this;return(0,ii.Z)(function*(){Se.mapping.unfocusMap();const Ct=yield Se.modalController.create({component:bi.t});Ct.onDidDismiss().then(sn=>{Se.mapping.focusMap()}),yield Ct.present()})()}}return it.\u0275fac=function(Se){return new(Se||it)(d.Y36(Xe.t4),d.Y36(mt.sK),d.Y36(Ui.v),d.Y36(Xe.IN),d.Y36(mi.c),d.Y36(oi.z),d.Y36(Nr.c),d.Y36(Ee.z))},it.\u0275cmp=d.Xpm({type:it,selectors:[["app-root"]],decls:29,vars:17,consts:[["contentId","main-content",3,"disabled"],["contentId","main-content","swipeGesture","false"],["slot","start"],["src","assets/images/icons/branding/AppIcon_128x128.png"],["auto-hide","false"],[3,"routerDirection","routerLink"],["slot","start","name","home"],[3,"click",4,"ngIf"],[4,"ngIf"],[3,"click"],["slot","start","name","information-circle-outline"],["id","main-content"],["slot","start","name","map"],["slot","start","name","add-circle-outline"],["slot","start","name","albums"],["slot","start","name","person"],["slot","start","name","log-out"],[2,"color","#c0c0c0"]],template:function(Se,Ct){1&Se&&(d.TgZ(0,"ion-app"),d.TgZ(1,"ion-split-pane",0),d.TgZ(2,"ion-menu",1),d.TgZ(3,"ion-header"),d.TgZ(4,"ion-toolbar"),d.TgZ(5,"ion-thumbnail",2),d._UZ(6,"img",3),d.qZA(),d.TgZ(7,"ion-title"),d._uU(8),d.qZA(),d.qZA(),d.qZA(),d.TgZ(9,"ion-content"),d.TgZ(10,"ion-list"),d.TgZ(11,"ion-menu-toggle",4),d.TgZ(12,"ion-item",5),d._UZ(13,"ion-icon",6),d.TgZ(14,"ion-label"),d._uU(15),d.ALo(16,"translate"),d.qZA(),d.qZA(),d.YNc(17,He,4,0,"ion-item",7),d.YNc(18,Ce,5,3,"ion-item",7),d.YNc(19,tt,4,0,"ion-item",7),d.YNc(20,It,4,0,"ion-item",7),d.YNc(21,Lt,6,3,"ng-container",8),d.YNc(22,nn,14,7,"ng-container",8),d.TgZ(23,"ion-item",9),d.NdJ("click",function(){return Ct.about()}),d._UZ(24,"ion-icon",10),d.TgZ(25,"ion-label"),d._uU(26),d.ALo(27,"translate"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d._UZ(28,"ion-router-outlet",11),d.qZA(),d.qZA()),2&Se&&(d.xp6(1),d.Q6J("disabled",!0),d.xp6(7),d.Oqu(Ct.appManager.title),d.xp6(4),d.Q6J("routerDirection","root")("routerLink",d.DdM(16,dn)),d.xp6(3),d.hij(" ",d.lcZ(16,12,"ocm.search.sectionTitle")," "),d.xp6(2),d.Q6J("ngIf",Ct.enabledFeatures.includes("ROUTE_PLANNER")),d.xp6(1),d.Q6J("ngIf",Ct.enabledFeatures.includes("ADD_POI")),d.xp6(1),d.Q6J("ngIf",Ct.enabledFeatures.includes("FAVOURITES")),d.xp6(1),d.Q6J("ngIf",Ct.enabledFeatures.includes("LAYERS")),d.xp6(1),d.Q6J("ngIf",!Ct.isUserAuthenticated()),d.xp6(1),d.Q6J("ngIf",Ct.isUserAuthenticated()),d.xp6(4),d.hij(" ",d.lcZ(27,14,"ocm.general.about")," "))},directives:[Xe.dr,Xe.jI,Xe.z0,Xe.Gu,Xe.sr,Xe.Bs,Xe.wd,Xe.W2,Xe.q_,Xe.zc,Xe.Ie,Xe.YI,qn.rH,Xe.gu,Xe.Q$,u.O5,Xe.jP],pipes:[mt.X$],encapsulation:2}),it})();const En=[{path:"",redirectTo:"search",pathMatch:"full"},{path:"search",loadChildren:()=>Promise.resolve().then(R.bind(R,9671)).then(it=>it.SearchPageModule)},{path:"journeys",loadChildren:()=>Promise.resolve().then(R.bind(R,5476)).then(it=>it.JourneysModule)},{path:"signin",loadChildren:()=>Promise.resolve().then(R.bind(R,6779)).then(it=>it.SignInModule)},{path:"poi-editor/:id",loadChildren:()=>Promise.resolve().then(R.bind(R,1948)).then(it=>it.PoiEditorPageModule)},{path:"about",loadChildren:()=>Promise.resolve().then(R.bind(R,534)).then(it=>it.AboutPageModule)},{path:"layer-editor",loadChildren:()=>Promise.resolve().then(R.bind(R,5005)).then(it=>it.LayerEditorPageModule)}];let $n=(()=>{class it{}return it.\u0275fac=function(Se){return new(Se||it)},it.\u0275mod=d.oAB({type:it}),it.\u0275inj=d.cJS({imports:[[qn.Bz.forRoot(En,{useHash:!0})],qn.Bz]}),it})(),Ot=(()=>{class it{}return it.\u0275fac=function(Se){return new(Se||it)},it.\u0275mod=d.oAB({type:it}),it.\u0275inj=d.cJS({imports:[[u.ez,Dt.u5,Xe.Pc,mt.aw,We.e]]}),it})();var cn=R(6779);let ki=(()=>{class it{}return it.\u0275fac=function(Se){return new(Se||it)},it.\u0275mod=d.oAB({type:it}),it.\u0275inj=d.cJS({imports:[[u.ez,Dt.u5,Xe.Pc,mt.aw,We.e,qn.Bz.forChild([{path:"",component:cr}])]]}),it})();var $r=R(6314);let Hi=(()=>{class it{}return it.\u0275fac=function(Se){return new(Se||it)},it.\u0275mod=d.oAB({type:it}),it.\u0275inj=d.cJS({imports:[[u.ez,Dt.u5,Xe.Pc,mt.aw,We.e,qn.Bz.forChild([{path:"",component:$r.N}])]]}),it})();var Er=R(5476),nr=R(1948),vo=R(534),_o=R(5005);function Zn(){return localStorage.getItem("access_token")}function Wi(it){return new Hn(it,"/assets/i18n/",".json")}let Oo=(()=>{class it{}return it.\u0275fac=function(Se){return new(Se||it)},it.\u0275mod=d.oAB({type:it,bootstrap:[ln]}),it.\u0275inj=d.cJS({providers:[{provide:qn.wN,useClass:Xe.r4}],imports:[[sr,Ln.JF,mt.aw.forRoot({loader:{provide:mt.Zw,useFactory:Wi,deps:[Ln.eN]}}),Xe.Pc.forRoot(),$n,ni.Ar.forRoot({config:{tokenGetter:Zn}}),pn.SearchPageModule,Ot,Er.JourneysModule,cn.SignInModule,rn,kt,tn,nr.PoiEditorPageModule,ki,Hi,vo.AboutPageModule,_o.LayerEditorPageModule]]}),it})();_r.N.production&&(0,d.G48)(),ei().bootstrapModule(Oo).catch(it=>console.log(it))},9898:function(Tn){Tn.exports=function(){"use strict";var Je,R,u;function d(l,L){if(Je)if(R){var P="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Je+")(sharedChunk); ("+R+")(sharedChunk); self.onerror = null;",m={};Je(m),u=L(m),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}else R=L;else Je=L}return d(0,function(l){var L="2.7.0",P=m;function m(t,e,i,s){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=s,this.p2x=i,this.p2y=s}m.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},m.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},m.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},m.prototype.solveCurveX=function(t,e){var i,s,h,f,y;for(void 0===e&&(e=1e-6),h=t,y=0;y<8;y++){if(f=this.sampleCurveX(h)-t,Math.abs(f)<e)return h;var b=this.sampleCurveDerivativeX(h);if(Math.abs(b)<1e-6)break;h-=f/b}if((h=t)<(i=0))return i;if(h>(s=1))return s;for(;i<s;){if(f=this.sampleCurveX(h),Math.abs(f-t)<e)return h;t>f?i=h:s=h,h=.5*(s-i)+i}return h},m.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var $=ue;function ue(t,e){this.x=t,this.y=e}ue.prototype={clone:function(){return new ue(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround:function(t,e){var i=Math.cos(t),s=Math.sin(t),h=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ue.convert=function(t){return t instanceof ue?t:Array.isArray(t)?new ue(t[0],t[1]):t};var V="undefined"!=typeof self?self:{},Z=1e-6,K="undefined"!=typeof Float32Array?Float32Array:Array;function re(){var t=new K(9);return K!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function _e(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ge(t,e,i){var s=e[0],h=e[1],f=e[2],y=e[3],b=e[4],C=e[5],M=e[6],B=e[7],U=e[8],q=e[9],de=e[10],ye=e[11],Ie=e[12],Ue=e[13],Qe=e[14],pt=e[15],Tt=i[0],Pt=i[1],Ft=i[2],Bt=i[3];return t[0]=Tt*s+Pt*b+Ft*U+Bt*Ie,t[1]=Tt*h+Pt*C+Ft*q+Bt*Ue,t[2]=Tt*f+Pt*M+Ft*de+Bt*Qe,t[3]=Tt*y+Pt*B+Ft*ye+Bt*pt,t[4]=(Tt=i[4])*s+(Pt=i[5])*b+(Ft=i[6])*U+(Bt=i[7])*Ie,t[5]=Tt*h+Pt*C+Ft*q+Bt*Ue,t[6]=Tt*f+Pt*M+Ft*de+Bt*Qe,t[7]=Tt*y+Pt*B+Ft*ye+Bt*pt,t[8]=(Tt=i[8])*s+(Pt=i[9])*b+(Ft=i[10])*U+(Bt=i[11])*Ie,t[9]=Tt*h+Pt*C+Ft*q+Bt*Ue,t[10]=Tt*f+Pt*M+Ft*de+Bt*Qe,t[11]=Tt*y+Pt*B+Ft*ye+Bt*pt,t[12]=(Tt=i[12])*s+(Pt=i[13])*b+(Ft=i[14])*U+(Bt=i[15])*Ie,t[13]=Tt*h+Pt*C+Ft*q+Bt*Ue,t[14]=Tt*f+Pt*M+Ft*de+Bt*Qe,t[15]=Tt*y+Pt*B+Ft*ye+Bt*pt,t}function xe(t,e,i){var s,h,f,y,b,C,M,B,U,q,de,ye,Ie=i[0],Ue=i[1],Qe=i[2];return e===t?(t[12]=e[0]*Ie+e[4]*Ue+e[8]*Qe+e[12],t[13]=e[1]*Ie+e[5]*Ue+e[9]*Qe+e[13],t[14]=e[2]*Ie+e[6]*Ue+e[10]*Qe+e[14],t[15]=e[3]*Ie+e[7]*Ue+e[11]*Qe+e[15]):(h=e[1],f=e[2],y=e[3],b=e[4],C=e[5],M=e[6],B=e[7],U=e[8],q=e[9],de=e[10],ye=e[11],t[0]=s=e[0],t[1]=h,t[2]=f,t[3]=y,t[4]=b,t[5]=C,t[6]=M,t[7]=B,t[8]=U,t[9]=q,t[10]=de,t[11]=ye,t[12]=s*Ie+b*Ue+U*Qe+e[12],t[13]=h*Ie+C*Ue+q*Qe+e[13],t[14]=f*Ie+M*Ue+de*Qe+e[14],t[15]=y*Ie+B*Ue+ye*Qe+e[15]),t}function je(t,e,i){var s=i[0],h=i[1],f=i[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*h,t[5]=e[5]*h,t[6]=e[6]*h,t[7]=e[7]*h,t[8]=e[8]*f,t[9]=e[9]*f,t[10]=e[10]*f,t[11]=e[11]*f,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function nt(t,e,i){var s=Math.sin(i),h=Math.cos(i),f=e[4],y=e[5],b=e[6],C=e[7],M=e[8],B=e[9],U=e[10],q=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=f*h+M*s,t[5]=y*h+B*s,t[6]=b*h+U*s,t[7]=C*h+q*s,t[8]=M*h-f*s,t[9]=B*h-y*s,t[10]=U*h-b*s,t[11]=q*h-C*s,t}function Fe(t,e,i){var s=Math.sin(i),h=Math.cos(i),f=e[0],y=e[1],b=e[2],C=e[3],M=e[8],B=e[9],U=e[10],q=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*h-M*s,t[1]=y*h-B*s,t[2]=b*h-U*s,t[3]=C*h-q*s,t[8]=f*s+M*h,t[9]=y*s+B*h,t[10]=b*s+U*h,t[11]=C*s+q*h,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ke=ge;function Ne(){var t=new K(3);return K!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function $e(t){var e=new K(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Re(t){return Math.hypot(t[0],t[1],t[2])}function _t(t,e,i){var s=new K(3);return s[0]=t,s[1]=e,s[2]=i,s}function Ge(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function ot(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function yt(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function wt(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function xt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function dt(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t}function At(t,e){var i=e[0],s=e[1],h=e[2],f=i*i+s*s+h*h;return f>0&&(f=1/Math.sqrt(f)),t[0]=e[0]*f,t[1]=e[1]*f,t[2]=e[2]*f,t}function Vt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Un(t,e,i){var s=e[0],h=e[1],f=e[2],y=i[0],b=i[1],C=i[2];return t[0]=h*C-f*b,t[1]=f*y-s*C,t[2]=s*b-h*y,t}function St(t,e,i){var s=e[0],h=e[1],f=e[2],y=i[3]*s+i[7]*h+i[11]*f+i[15];return t[0]=(i[0]*s+i[4]*h+i[8]*f+i[12])/(y=y||1),t[1]=(i[1]*s+i[5]*h+i[9]*f+i[13])/y,t[2]=(i[2]*s+i[6]*h+i[10]*f+i[14])/y,t}function $t(t,e,i){var s=i[0],h=i[1],f=i[2],y=e[0],b=e[1],C=e[2],M=h*C-f*b,B=f*y-s*C,U=s*b-h*y,q=h*U-f*B,de=f*M-s*U,ye=s*B-h*M,Ie=2*i[3];return B*=Ie,U*=Ie,de*=2,ye*=2,t[0]=y+(M*=Ie)+(q*=2),t[1]=b+B+de,t[2]=C+U+ye,t}var zt,t,Ht=ot,en=yt,Kt=Re;function Wt(t,e,i){var s=e[0],h=e[1],f=e[2],y=e[3];return t[0]=i[0]*s+i[4]*h+i[8]*f+i[12]*y,t[1]=i[1]*s+i[5]*h+i[9]*f+i[13]*y,t[2]=i[2]*s+i[6]*h+i[10]*f+i[14]*y,t[3]=i[3]*s+i[7]*h+i[11]*f+i[15]*y,t}function Yt(){var t=new K(4);return K!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function qt(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Gt(t,e,i){i*=.5;var s=e[0],h=e[1],f=e[2],y=e[3],b=Math.sin(i),C=Math.cos(i);return t[0]=s*C+y*b,t[1]=h*C+f*b,t[2]=f*C-h*b,t[3]=y*C-s*b,t}function ft(t,e){return t[0]===e[0]&&t[1]===e[1]}Ne(),zt=new K(4),K!=Float32Array&&(zt[0]=0,zt[1]=0,zt[2]=0,zt[3]=0),Ne(),_t(1,0,0),_t(0,1,0),Yt(),Yt(),re(),t=new K(2),K!=Float32Array&&(t[0]=0,t[1]=0);const Ut=Math.PI/180,On=180/Math.PI;function fn(t){return t*Ut}function Gn(t){return t*On}const ei=[[0,0],[1,0],[1,1],[0,1]];function $i(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function sr(t,e,i,s){const h=new P(t,e,i,s);return function(f){return h.solve(f)}}const zi=sr(.25,.1,.25,1);function yi(t,e,i){return Math.min(i,Math.max(e,t))}function ji(t,e,i){return(i=yi((i-t)/(e-t),0,1))*i*(3-2*i)}function _i(t,e,i){const s=i-e,h=((t-e)%s+s)%s+e;return h===e?i:h}function xi(t,e,i){if(!t.length)return i(null,[]);let s=t.length;const h=new Array(t.length);let f=null;t.forEach((y,b)=>{e(y,(C,M)=>{C&&(f=C),h[b]=M,0==--s&&i(f,h)})})}function Qt(t){const e=[];for(const i in t)e.push(t[i]);return e}function Ye(t,...e){for(const i of e)for(const s in i)t[s]=i[s];return t}let te=1;function Ae(){return te++}function ut(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Pe(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Nt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function me(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function qe(t,e){return-1!==t.indexOf(e,t.length-e.length)}function Rt(t,e,i){const s={};for(const h in t)s[h]=e.call(i||this,t[h],h,t);return s}function Xt(t,e,i){const s={};for(const h in t)e.call(i||this,t[h],h,t)&&(s[h]=t[h]);return s}function Xn(t){return Array.isArray(t)?t.map(Xn):"object"==typeof t&&t?Rt(t,Xn):t}const Ki={};function Di(t){Ki[t]||("undefined"!=typeof console&&console.warn(t),Ki[t]=!0)}function gi(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function fi(t){let e=0;for(let i,s,h=0,f=t.length,y=f-1;h<f;y=h++)i=t[h],s=t[y],e+=(s.x-i.x)*(i.y+s.y);return e}function Cr(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Vi(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,h,f)=>{const y=h||f;return e[s]=!y||y.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let gr,Pi,Br,Ei=null;function Rr(t){if(null==Ei){const e=t.navigator?t.navigator.userAgent:null;Ei=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ei}function _n(t){try{const e=V[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const tr={now:()=>void 0!==Br?Br:V.performance.now(),setNow(t){Br=t},restoreNow(){Br=void 0},frame(t){const e=V.requestAnimationFrame(t);return{cancel:()=>V.cancelAnimationFrame(e)}},getImageData(t,e=0){const i=V.document.createElement("canvas"),s=i.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return i.width=t.width,i.height=t.height,s.drawImage(t,0,0,t.width,t.height),s.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(gr||(gr=V.document.createElement("a")),gr.href=t,gr.href),get devicePixelRatio(){return V.devicePixelRatio},get prefersReducedMotion(){return!!V.matchMedia&&(null==Pi&&(Pi=V.matchMedia("(prefers-reduced-motion: reduce)")),Pi.matches)}};let ie;const X={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ie){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ie=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{ie=t}}return ie},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},F={supported:!1,testSupport:function(t){!We&&Te&&(mt?Dt(t):he=t)}};let he,Te,We=!1,mt=!1;function Dt(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Te),t.isContextLost())return;F.supported=!0}catch{}t.deleteTexture(e),We=!0}V.document&&(Te=V.document.createElement("img"),Te.onload=function(){he&&Dt(he),he=null,mt=!0},Te.onerror=function(){We=!0,he=null},Te.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Xe="01",kt="NO_ACCESS_TOKEN";function tn(t){return 0===t.indexOf("mapbox:")}function rn(t){return X.API_URL_REGEX.test(t)}const pn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ln(t){const e=t.match(pn);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function qn(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function ni(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(V.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Hn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=ni(X.ACCESS_TOKEN);let s="";return s=i&&i.u?V.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(h,f)=>String.fromCharCode(Number("0x"+f)))):X.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=_n("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const h=V.localStorage.getItem(i);h&&(this.eventData=JSON.parse(h));const f=V.localStorage.getItem(s);f&&(this.anonId=f)}catch{Di("Unable to read from LocalStorage")}}saveEventData(){const e=_n("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{V.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&V.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Di("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,s,h){if(!X.EVENTS_URL)return;const f=Ln(X.EVENTS_URL);f.params.push(`access_token=${h||X.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:L,skuId:Xe,userId:this.anonId},b=i?Ye(y,i):y,C={url:qn(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=Vr(C,M=>{this.pendingRequest=null,s(M),this.saveEventData(),this.processRequests(h)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const ii=new class extends Hn{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){X.EVENTS_URL&&X.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>tn(i)||rn(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ni(X.ACCESS_TOKEN),i=e?e.u:X.ACCESS_TOKEN;let s=i!==this.eventData.tokenU;Nt(this.anonId)||(this.anonId=ut(),s=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),y=new Date(h),b=(h-this.eventData.lastSuccess)/864e5;s=s||b>=1||b<-1||f.getDate()!==y.getDate()}else s=!0;if(!s)return this.processRequests();this.postEvent(h,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=h,this.eventData.tokenU=i)},t)}},Ui=ii.postTurnstileEvent.bind(ii),Fi=new class extends Hn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,s){this.skuToken=e,this.errorCb=s,X.EVENTS_URL&&(i||X.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(kt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Nt(this.anonId)||(this.anonId=ut()),this.postEvent(i,{skuToken:this.skuToken},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}},ci=Fi.postMapLoadEvent.bind(Fi),Mn=new class extends Hn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,s){if(!X.API_URL||!X.SESSION_PATH)return;const h=Ln(X.API_URL+X.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${s||X.ACCESS_TOKEN||""}`);const f={url:qn(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Ee(f,y=>{this.pendingRequest=null,i(y),this.saveEventData(),this.processRequests(s)})}getSessionAPI(t,e,i,s){this.skuToken=e,this.errorCb=s,X.SESSION_PATH&&X.API_URL&&(i||X.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(kt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}},mi=Mn.getSessionAPI.bind(Mn),Ii=new Set,Zi="mapbox-tiles";let cr,oi,_r=500,ur=50;function Nr(){V.caches&&!cr&&(cr=V.caches.open(Zi))}function go(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}let bi=1/0;const ao={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ao);class Hr extends Error{constructor(e,i,s){401===i&&rn(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Jr=Cr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===V.location.protocol?V.parent:V).location.href,Pr=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(Jr())&&!/^\w+:/.test(i))){if(V.fetch&&V.Request&&V.AbortController&&V.Request.prototype.hasOwnProperty("signal"))return function(s,h){const f=new V.AbortController,y=new V.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Jr(),signal:f.signal});let b=!1,C=!1;const M=(B=y.url).indexOf("sku=")>0&&rn(B);var B;"json"===s.type&&y.headers.set("Accept","application/json");const U=(de,ye,Ie)=>{if(C)return;if(de&&"SecurityError"!==de.message&&Di(de),ye&&Ie)return q(ye);const Ue=Date.now();V.fetch(y).then(Qe=>{if(Qe.ok){const pt=M?Qe.clone():null;return q(Qe,pt,Ue)}return h(new Hr(Qe.statusText,Qe.status,s.url))}).catch(Qe=>{20!==Qe.code&&h(new Error(Qe.message))})},q=(de,ye,Ie)=>{("arrayBuffer"===s.type?de.arrayBuffer():"json"===s.type?de.json():de.text()).then(Ue=>{C||(ye&&Ie&&function(Qe,pt,Tt){if(Nr(),!cr)return;const Pt={status:pt.status,statusText:pt.statusText,headers:new V.Headers};pt.headers.forEach((Bt,vn)=>Pt.headers.set(vn,Bt));const Ft=Vi(pt.headers.get("Cache-Control")||"");Ft["no-store"]||(Ft["max-age"]&&Pt.headers.set("Expires",new Date(Tt+1e3*Ft["max-age"]).toUTCString()),new Date(Pt.headers.get("Expires")).getTime()-Tt<42e4||function(Bt,vn){if(void 0===oi)try{new Response(new ReadableStream),oi=!0}catch{oi=!1}oi?vn(Bt.body):Bt.blob().then(vn)}(pt,Bt=>{const vn=new V.Response(Bt,Pt);Nr(),cr&&cr.then(mn=>mn.put(go(Qe.url),vn)).catch(mn=>Di(mn.message))}))}(y,ye,Ie),b=!0,h(null,Ue,de.headers.get("Cache-Control"),de.headers.get("Expires")))}).catch(Ue=>{C||h(new Error(Ue.message))})};return M?function(de,ye){if(Nr(),!cr)return ye(null);const Ie=go(de.url);cr.then(Ue=>{Ue.match(Ie).then(Qe=>{const pt=function(Tt){if(!Tt)return!1;const Pt=new Date(Tt.headers.get("Expires")||0),Ft=Vi(Tt.headers.get("Cache-Control")||"");return Pt>Date.now()&&!Ft["no-cache"]}(Qe);Ue.delete(Ie),pt&&Ue.put(Ie,Qe.clone()),ye(null,Qe,pt)}).catch(ye)}).catch(ye)}(y,U):U(null,null),{cancel:()=>{C=!0,b||f.abort()}}}(t,e);if(Cr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(s,h){const f=new V.XMLHttpRequest;f.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(f.responseType="arraybuffer");for(const y in s.headers)f.setRequestHeader(y,s.headers[y]);return"json"===s.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===s.credentials,f.onerror=()=>{h(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let y=f.response;if("json"===s.type)try{y=JSON.parse(f.response)}catch(b){return h(b)}h(null,y,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else h(new Hr(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}}(t,e)},Lr=function(t,e){return Pr(Ye(t,{type:"arrayBuffer"}),e)},Vr=function(t,e){return Pr(Ye(t,{method:"POST"}),e)},Ee=function(t,e){return Pr(Ye(t,{method:"GET"}),e)};function He(t){const e=V.document.createElement("a");return e.href=t,e.protocol===V.document.location.protocol&&e.host===V.document.location.host}const Ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let tt,It;tt=[],It=0;const Lt=function(t,e){if(F.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),It>=X.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return tt.push(f),f}It++;let i=!1;const s=()=>{if(!i)for(i=!0,It--;tt.length&&It<X.MAX_PARALLEL_IMAGE_REQUESTS;){const f=tt.shift(),{requestParameters:y,callback:b,cancelled:C}=f;C||(f.cancel=Lt(y,b).cancel)}},h=Lr(t,(f,y,b,C)=>{s(),f?e(f):y&&(V.createImageBitmap?function(M,B){const U=new V.Blob([new Uint8Array(M)],{type:"image/png"});V.createImageBitmap(U).then(q=>{B(null,q)}).catch(q=>{B(new Error(`Could not load image because of ${q.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(M,B)=>e(M,B,b,C)):function(M,B){const U=new V.Image,q=V.URL;U.onload=()=>{B(null,U),q.revokeObjectURL(U.src),U.onload=null,V.requestAnimationFrame(()=>{U.src=Ce})},U.onerror=()=>B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const de=new V.Blob([new Uint8Array(M)],{type:"image/png"});U.src=M.byteLength?q.createObjectURL(de):Ce}(y,(M,B)=>e(M,B,b,C)))});return{cancel:()=>{h.cancel(),s()}}};function nn(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function dn(t,e,i){if(i&&i[t]){const s=i[t].indexOf(e);-1!==s&&i[t].splice(s,1)}}class ln{constructor(e,i={}){Ye(this,i),this.type=e}}class En extends ln{constructor(e,i={}){super("error",Ye({error:e},i))}}class $n{on(e,i){return this._listeners=this._listeners||{},nn(e,i,this._listeners),this}off(e,i){return dn(e,i,this._listeners),dn(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},nn(e,i,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,i){"string"==typeof e&&(e=new ln(e,i||{}));const s=e.type;if(this.listens(s)){e.target=this;const h=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const b of h)b.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const b of f)dn(s,b,this._oneTimeListeners),b.call(this,e);const y=this._eventedParent;y&&(Ye(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof En&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Ot=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class cn{constructor(e,i,s,h){this.message=(e?`${e}: `:"")+s,h&&(this.identifier=h),null!=i&&i.__line__&&(this.line=i.__line__)}}function ki(t){const e=t.value;return e?[new cn(t.key,e,"constants have been deprecated as of v8")]:[]}function $r(t,...e){for(const i of e)for(const s in i)t[s]=i[s];return t}function Hi(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Er(t){if(Array.isArray(t))return t.map(Er);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Er(t[i]);return e}return Hi(t)}class nr extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class vo{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,h]of i)this.bindings[s]=h}concat(e){return new vo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const _o={kind:"null"},Zn={kind:"number"},Wi={kind:"string"},Ai={kind:"boolean"},Oo={kind:"color"},it={kind:"object"},Ke={kind:"value"},Se={kind:"collator"},Ct={kind:"formatted"},sn={kind:"resolvedImage"};function si(t,e){return{kind:"array",itemType:t,N:e}}function hi(t){if("array"===t.kind){const e=hi(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const io=[_o,Zn,Wi,Ai,Oo,Ct,it,si(Ke),sn];function ar(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!ar(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const i of io)if(!ar(i,e))return null}return`Expected ${hi(t)} but found ${hi(e)} instead.`}function es(t,e){return e.some(i=>i.kind===t.kind)}function ts(t,e){return e.some(i=>"null"===i?null===t:"array"===i?Array.isArray(t):"object"===i?t&&!Array.isArray(t)&&"object"==typeof t:i===typeof t)}function cs(t){var e={exports:{}};return t(e,e.exports),e.exports}var Io=cs(function(t,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(b){return(b=Math.round(b))<0?0:b>255?255:b}function h(b){return s("%"===b[b.length-1]?parseFloat(b)/100*255:parseInt(b))}function f(b){return(C="%"===b[b.length-1]?parseFloat(b)/100:parseFloat(b))<0?0:C>1?1:C;var C}function y(b,C,M){return M<0?M+=1:M>1&&(M-=1),6*M<1?b+(C-b)*M*6:2*M<1?C:3*M<2?b+(C-b)*(2/3-M)*6:b}try{e.parseCSSColor=function(b){var C,M=b.replace(/ /g,"").toLowerCase();if(M in i)return i[M].slice();if("#"===M[0])return 4===M.length?(C=parseInt(M.substr(1),16))>=0&&C<=4095?[(3840&C)>>4|(3840&C)>>8,240&C|(240&C)>>4,15&C|(15&C)<<4,1]:null:7===M.length&&(C=parseInt(M.substr(1),16))>=0&&C<=16777215?[(16711680&C)>>16,(65280&C)>>8,255&C,1]:null;var B=M.indexOf("("),U=M.indexOf(")");if(-1!==B&&U+1===M.length){var q=M.substr(0,B),de=M.substr(B+1,U-(B+1)).split(","),ye=1;switch(q){case"rgba":if(4!==de.length)return null;ye=f(de.pop());case"rgb":return 3!==de.length?null:[h(de[0]),h(de[1]),h(de[2]),ye];case"hsla":if(4!==de.length)return null;ye=f(de.pop());case"hsl":if(3!==de.length)return null;var Ie=(parseFloat(de[0])%360+360)%360/360,Ue=f(de[1]),Qe=f(de[2]),pt=Qe<=.5?Qe*(Ue+1):Qe+Ue-Qe*Ue,Tt=2*Qe-pt;return[s(255*y(Tt,pt,Ie+1/3)),s(255*y(Tt,pt,Ie)),s(255*y(Tt,pt,Ie-1/3)),ye];default:return null}}return null}}catch{}});class Bi{constructor(e,i,s,h=1){this.r=e,this.g=i,this.b=s,this.a=h}static parse(e){if(!e)return;if(e instanceof Bi)return e;if("string"!=typeof e)return;const i=Io.parseCSSColor(e);return i?new Bi(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,s,h]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(s)},${h})`}toArray(){const{r:e,g:i,b:s,a:h}=this;return 0===h?[0,0,0,0]:[255*e/h,255*i/h,255*s/h,h]}}Bi.black=new Bi(0,0,0,1),Bi.white=new Bi(1,1,1,1),Bi.transparent=new Bi(0,0,0,0),Bi.red=new Bi(1,0,0,1),Bi.blue=new Bi(0,0,1,1);class ks{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Fs{constructor(e,i,s,h,f){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=h,this.textColor=f}}class Ni{constructor(e){this.sections=e}static fromString(e){return new Ni([new Fs(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Ni?e:Ni.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(s)}return e}}class ro{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ro({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Vo(t,e,i,s){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[t,e,i,s]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function bs(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Bi||t instanceof ks||t instanceof Ni||t instanceof ro)return!0;if(Array.isArray(t)){for(const e of t)if(!bs(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!bs(t[e]))return!1;return!0}return!1}function Wr(t){if(null===t)return _o;if("string"==typeof t)return Wi;if("boolean"==typeof t)return Ai;if("number"==typeof t)return Zn;if(t instanceof Bi)return Oo;if(t instanceof ks)return Se;if(t instanceof Ni)return Ct;if(t instanceof ro)return sn;if(Array.isArray(t)){const e=t.length;let i;for(const s of t){const h=Wr(s);if(i){if(i===h)continue;i=Ke;break}i=h}return si(i||Ke,e)}return it}function Bs(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Bi||t instanceof Ni||t instanceof ro?t.toString():JSON.stringify(t)}class $o{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(2!==e.length)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!bs(e[1]))return i.error("invalid value");const s=e[1];let h=Wr(s);const f=i.expectedType;return"array"!==h.kind||0!==h.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(h=f),new $o(h,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Bi?["rgba"].concat(this.value.toArray()):this.value instanceof Ni?this.value.serialize():this.value}}class Qr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ns={string:Wi,number:Zn,boolean:Ai,object:it};class uo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,h=1;const f=e[0];if("array"===f){let b,C;if(e.length>2){const M=e[1];if("string"!=typeof M||!(M in Ns)||"object"===M)return i.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ns[M],h++}else b=Ke;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);C=e[2],h++}s=si(b,C)}else s=Ns[f];const y=[];for(;h<e.length;h++){const b=i.parse(e[h],h,Ke);if(!b)return null;y.push(b)}return new uo(s,y)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!ar(this.type,Wr(s)))return s;if(i===this.args.length-1)throw new Qr(`Expected value to be of type ${hi(this.type)}, but found ${hi(Wr(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){i.push(s.kind);const h=e.N;("number"==typeof h||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(s=>s.serialize()))}}class Mo{constructor(e){this.type=Ct,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return i.error("First argument must be an image or text section.");const h=[];let f=!1;for(let y=1;y<=e.length-1;++y){const b=e[y];if(f&&"object"==typeof b&&!Array.isArray(b)){f=!1;let C=null;if(b["font-scale"]&&(C=i.parse(b["font-scale"],1,Zn),!C))return null;let M=null;if(b["text-font"]&&(M=i.parse(b["text-font"],1,si(Wi)),!M))return null;let B=null;if(b["text-color"]&&(B=i.parse(b["text-color"],1,Oo),!B))return null;const U=h[h.length-1];U.scale=C,U.font=M,U.textColor=B}else{const C=i.parse(e[y],1,Ke);if(!C)return null;const M=C.type.kind;if("string"!==M&&"value"!==M&&"null"!==M&&"resolvedImage"!==M)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:C,scale:null,font:null,textColor:null})}}return new Mo(h)}evaluate(e){return new Ni(this.sections.map(i=>{const s=i.content.evaluate(e);return Wr(s)===sn?new Fs("",s,null,null,null):new Fs(Bs(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class ns{constructor(e){this.type=sn,this.input=e}static parse(e,i){if(2!==e.length)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Wi);return s?new ns(s):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),s=ro.fromString(i);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(i)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const xo={"to-boolean":Ai,"to-color":Oo,"to-number":Zn,"to-string":Wi};class Ro{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return i.error("Expected one argument.");const h=xo[s],f=[];for(let y=1;y<e.length;y++){const b=i.parse(e[y],y,Ke);if(!b)return null;f.push(b)}return new Ro(h,f)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let i,s;for(const h of this.args){if(i=h.evaluate(e),s=null,i instanceof Bi)return i;if("string"==typeof i){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Vo(i[0],i[1],i[2],i[3]),!s))return new Bi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Qr(s||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(const s of this.args){if(i=s.evaluate(e),null===i)return 0;const h=Number(i);if(!isNaN(h))return h}throw new Qr(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?Ni.fromString(Bs(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?ro.fromString(Bs(this.args[0].evaluate(e))):Bs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Mo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ns(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Qs=["Unknown","Point","LineString","Polygon"];class oe{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Qs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(h*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Bi.parse(e)),i}}class we{constructor(e,i,s,h){this.name=e,this.type=i,this._evaluate=s,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],h=we.definitions[s];if(!h)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,b=y.filter(([M])=>!Array.isArray(M)||M.length===e.length-1);let C=null;for(const[M,B]of b){C=new As(i.registry,i.path,null,i.scope);const U=[];let q=!1;for(let de=1;de<e.length;de++){const ye=e[de],Ie=Array.isArray(M)?M[de-1]:M.type,Ue=C.parse(ye,1+U.length,Ie);if(!Ue){q=!0;break}U.push(Ue)}if(!q)if(Array.isArray(M)&&M.length!==U.length)C.error(`Expected ${M.length} arguments, but found ${U.length} instead.`);else{for(let de=0;de<U.length;de++){const ye=Array.isArray(M)?M[de]:M.type,Ie=U[de];C.concat(de+1).checkSubtype(ye,Ie.type)}if(0===C.errors.length)return new we(s,f,B,U)}}if(1===b.length)i.errors.push(...C.errors);else{const M=(b.length?b:y).map(([U])=>{return q=U,Array.isArray(q)?`(${q.map(hi).join(", ")})`:`(${hi(q.type)}...)`;var q}).join(" | "),B=[];for(let U=1;U<e.length;U++){const q=i.parse(e[U],1+B.length);if(!q)return null;B.push(hi(q.type))}i.error(`Expected arguments of type ${M}, but found (${B.join(", ")}) instead.`)}return null}static register(e,i){we.definitions=i;for(const s in i)e[s]=we}}class se{constructor(e,i,s){this.type=Se,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(2!==e.length)return i.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return i.error("Collator options argument must be an object.");const h=i.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Ai);if(!h)return null;const f=i.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Ai);if(!f)return null;let y=null;return s.locale&&(y=i.parse(s.locale,1,Wi),!y)?null:new se(h,f,y)}evaluate(e){return new ks(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Le=8192;function Mt(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function an(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Bn(t,e){const i=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*Le),Math.round(s*h*Le)]}function Wn(t,e,i){const s=t[0]-e[0],h=t[1]-e[1],f=t[0]-i[0],y=t[1]-i[1];return s*y-f*h==0&&s*f<=0&&h*y<=0}function yr(t,e){let i=!1;for(let y=0,b=e.length;y<b;y++){const C=e[y];for(let M=0,B=C.length;M<B-1;M++){if(Wn(t,C[M],C[M+1]))return!1;(h=C[M])[1]>(s=t)[1]!=(f=C[M+1])[1]>s[1]&&s[0]<(f[0]-h[0])*(s[1]-h[1])/(f[1]-h[1])+h[0]&&(i=!i)}}var s,h,f;return i}function Dr(t,e){for(let i=0;i<e.length;i++)if(yr(t,e[i]))return!0;return!1}function Oi(t,e,i,s){const h=s[0]-i[0],f=s[1]-i[1],y=(t[0]-i[0])*f-h*(t[1]-i[1]),b=(e[0]-i[0])*f-h*(e[1]-i[1]);return y>0&&b<0||y<0&&b>0}function dr(t,e,i){for(const M of i)for(let B=0;B<M.length-1;++B)if((b=[(y=M[B+1])[0]-(f=M[B])[0],y[1]-f[1]])[0]*(C=[(h=e)[0]-(s=t)[0],h[1]-s[1]])[1]-b[1]*C[0]!=0&&Oi(s,h,f,y)&&Oi(f,y,s,h))return!0;var s,h,f,y,b,C;return!1}function jr(t,e){for(let i=0;i<t.length;++i)if(!yr(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(dr(t[i],t[i+1],e))return!1;return!0}function ae(t,e){for(let i=0;i<e.length;i++)if(jr(t,e[i]))return!0;return!1}function ee(t,e,i){const s=[];for(let h=0;h<t.length;h++){const f=[];for(let y=0;y<t[h].length;y++){const b=Bn(t[h][y],i);Mt(e,b),f.push(b)}s.push(f)}return s}function Q(t,e,i){const s=[];for(let h=0;h<t.length;h++){const f=ee(t[h],e,i);s.push(f)}return s}function Oe(t,e,i,s){if(t[0]<i[0]||t[0]>i[2]){const h=.5*s;let f=t[0]-i[0]>h?-s:i[0]-t[0]>h?s:0;0===f&&(f=t[0]-i[2]>h?-s:i[2]-t[0]>h?s:0),t[0]+=f}Mt(e,t)}function hn(t,e,i,s){const h=Math.pow(2,s.z)*Le,f=[s.x*Le,s.y*Le],y=[];for(const b of t)for(const C of b){const M=[C.x+f[0],C.y+f[1]];Oe(M,e,i,h),y.push(M)}return y}function ti(t,e,i,s){const h=Math.pow(2,s.z)*Le,f=[s.x*Le,s.y*Le],y=[];for(const C of t){const M=[];for(const B of C){const U=[B.x+f[0],B.y+f[1]];Mt(e,U),M.push(U)}y.push(M)}if(e[2]-e[0]<=h/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const C of y)for(const M of C)Oe(M,e,i,h)}var b;return y}class Ir{constructor(e,i){this.type=Ai,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(bs(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let h=0;h<s.features.length;++h){const f=s.features[h].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new Ir(s,s.features[h].geometry)}else if("Feature"===s.type){const h=s.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new Ir(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new Ir(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(i,s){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=i.canonicalID();if("Polygon"===s.type){const b=ee(s.coordinates,f,y),C=hn(i.geometry(),h,f,y);if(!an(h,f))return!1;for(const M of C)if(!yr(M,b))return!1}if("MultiPolygon"===s.type){const b=Q(s.coordinates,f,y),C=hn(i.geometry(),h,f,y);if(!an(h,f))return!1;for(const M of C)if(!Dr(M,b))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(i,s){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=i.canonicalID();if("Polygon"===s.type){const b=ee(s.coordinates,f,y),C=ti(i.geometry(),h,f,y);if(!an(h,f))return!1;for(const M of C)if(!jr(M,b))return!1}if("MultiPolygon"===s.type){const b=Q(s.coordinates,f,y),C=ti(i.geometry(),h,f,y);if(!an(h,f))return!1;for(const M of C)if(!ae(M,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function xr(t){if(t instanceof we&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof Ir)return!1;let e=!0;return t.eachChild(i=>{e&&!xr(i)&&(e=!1)}),e}function Wo(t){if(t instanceof we&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(i=>{e&&!Wo(i)&&(e=!1)}),e}function Ao(t,e){if(t instanceof we&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(s=>{i&&!Ao(s,e)&&(i=!1)}),i}class zs{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(2!==e.length||"string"!=typeof e[1])return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new zs(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class As{constructor(e,i=[],s,h=new vo,f=[]){this.registry=e,this.path=i,this.key=i.map(y=>`[${y}]`).join(""),this.scope=h,this.errors=f,this.expectedType=s}parse(e,i,s,h,f={}){return i?this.concat(i,s,h)._parse(e,f):this._parse(e,f)}_parse(e,i){function s(h,f,y){return"assert"===y?new uo(f,[h]):"coerce"===y?new Ro(f,[h]):h}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[h];if(f){let y=f.parse(e,this);if(!y)return null;if(this.expectedType){const b=this.expectedType,C=y.type;if("string"!==b.kind&&"number"!==b.kind&&"boolean"!==b.kind&&"object"!==b.kind&&"array"!==b.kind||"value"!==C.kind)if("color"!==b.kind&&"formatted"!==b.kind&&"resolvedImage"!==b.kind||"value"!==C.kind&&"string"!==C.kind){if(this.checkSubtype(b,C))return null}else y=s(y,b,i.typeAnnotation||"coerce");else y=s(y,b,i.typeAnnotation||"assert")}if(!(y instanceof $o)&&"resolvedImage"!==y.type.kind&&Si(y)){const b=new oe;try{y=new $o(y.type,y.evaluate(b))}catch(C){return this.error(C.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s){const h="number"==typeof e?this.path.concat(e):this.path,f=s?this.scope.concat(s):this.scope;return new As(this.registry,h,i||null,f,this.errors)}error(e,...i){const s=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new nr(s,e))}checkSubtype(e,i){const s=ar(e,i);return s&&this.error(s),s}}function Si(t){if(t instanceof zs)return Si(t.boundExpression);if(t instanceof we&&"error"===t.name||t instanceof se||t instanceof Ir)return!1;const e=t instanceof Ro||t instanceof uo;let i=!0;return t.eachChild(s=>{i=e?i&&Si(s):i&&s instanceof $o}),!!i&&xr(t)&&Ao(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function nl(t,e){const i=t.length-1;let s,h,f=0,y=i,b=0;for(;f<=y;)if(b=Math.floor((f+y)/2),s=t[b],h=t[b+1],s<=e){if(b===i||e<h)return b;f=b+1}else{if(!(s>e))throw new Qr("Input is not a number.");y=b-1}return 0}class Aa{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,f]of s)this.labels.push(h),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,Zn);if(!s)return null;const h=[];let f=null;i.expectedType&&"value"!==i.expectedType.kind&&(f=i.expectedType);for(let y=1;y<e.length;y+=2){const b=1===y?-1/0:e[y],C=e[y+1],M=y,B=y+1;if("number"!=typeof b)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(h.length&&h[h.length-1][0]>=b)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const U=i.parse(C,B,f);if(!U)return null;f=f||U.type,h.push([b,U])}return new Aa(f,s,h)}evaluate(e){const i=this.labels,s=this.outputs;if(1===i.length)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return s[0].evaluate(e);const f=i.length;return h>=i[f-1]?s[f-1].evaluate(e):s[nl(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}function br(t,e,i){return t*(1-i)+e*i}var pa=Object.freeze({__proto__:null,number:br,color:function(t,e,i){return new Bi(br(t.r,e.r,i),br(t.g,e.g,i),br(t.b,e.b,i),br(t.a,e.a,i))},array:function(t,e,i){return t.map((s,h)=>br(s,e[h],i))}});const ta=4/29,Sn=6/29,lr=3*Sn*Sn,Jl=Math.PI/180,Co=180/Math.PI;function il(t){return t>.008856451679035631?Math.pow(t,1/3):t/lr+ta}function Us(t){return t>Sn?t*t*t:lr*(t-ta)}function is(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function fa(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ma(t){const e=fa(t.r),i=fa(t.g),s=fa(t.b),h=il((.4124564*e+.3575761*i+.1804375*s)/.95047),f=il((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*f-16,a:500*(h-f),b:200*(f-il((.0193339*e+.119192*i+.9503041*s)/1.08883)),alpha:t.a}}function D(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*Us(e),i=.95047*Us(i),s=1.08883*Us(s),new Bi(is(3.2404542*i-1.5371385*e-.4985314*s),is(-.969266*i+1.8760108*e+.041556*s),is(.0556434*i-.2040259*e+1.0572252*s),t.alpha)}function Y(t,e,i){const s=e-t;return t+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const E={forward:ma,reverse:D,interpolate:function(t,e,i){return{l:br(t.l,e.l,i),a:br(t.a,e.a,i),b:br(t.b,e.b,i),alpha:br(t.alpha,e.alpha,i)}}},H={forward:function(t){const{l:e,a:i,b:s}=ma(t),h=Math.atan2(s,i)*Co;return{h:h<0?h+360:h,c:Math.sqrt(i*i+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Jl,i=t.c;return D({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Y(t.h,e.h,i),c:br(t.c,e.c,i),l:br(t.l,e.l,i),alpha:br(t.alpha,e.alpha,i)}}};var ve=Object.freeze({__proto__:null,lab:E,hcl:H});class vt{constructor(e,i,s,h,f){this.type=e,this.operator=i,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(const[y,b]of f)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(e,i,s,h){let f=0;if("exponential"===e.name)f=In(i,e.base,s,h);else if("linear"===e.name)f=In(i,1,s,h);else if("cubic-bezier"===e.name){const y=e.controlPoints;f=new P(y[0],y[1],y[2],y[3]).solve(In(i,1,s,h))}return f}static parse(e,i){let[s,h,f,...y]=e;if(!Array.isArray(h)||0===h.length)return i.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const M=h[1];if("number"!=typeof M)return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:M}}else{if("cubic-bezier"!==h[0])return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const M=h.slice(1);if(4!==M.length||M.some(B=>"number"!=typeof B||B<0||B>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:M}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Zn),!f)return null;const b=[];let C=null;"interpolate-hcl"===s||"interpolate-lab"===s?C=Oo:i.expectedType&&"value"!==i.expectedType.kind&&(C=i.expectedType);for(let M=0;M<y.length;M+=2){const B=y[M],U=y[M+1],q=M+3,de=M+4;if("number"!=typeof B)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(b.length&&b[b.length-1][0]>=B)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',q);const ye=i.parse(U,de,C);if(!ye)return null;C=C||ye.type,b.push([B,ye])}return"number"===C.kind||"color"===C.kind||"array"===C.kind&&"number"===C.itemType.kind&&"number"==typeof C.N?new vt(C,s,h,f,b):i.error(`Type ${hi(C)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(1===i.length)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return s[0].evaluate(e);const f=i.length;if(h>=i[f-1])return s[f-1].evaluate(e);const y=nl(i,h),b=vt.interpolationFactor(this.interpolation,h,i[y],i[y+1]),C=s[y].evaluate(e),M=s[y+1].evaluate(e);return"interpolate"===this.operator?pa[this.type.kind.toLowerCase()](C,M,b):"interpolate-hcl"===this.operator?H.reverse(H.interpolate(H.forward(C),H.forward(M),b)):E.reverse(E.interpolate(E.forward(C),E.forward(M),b))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function In(t,e,i,s){const h=s-i,f=t-i;return 0===h?0:1===e?f/h:(Math.pow(e,f)-1)/(Math.pow(e,h)-1)}class Vn{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const h=i.expectedType;h&&"value"!==h.kind&&(s=h);const f=[];for(const b of e.slice(1)){const C=i.parse(b,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!C)return null;s=s||C.type,f.push(C)}const y=h&&f.some(b=>ar(h,b.type));return new Vn(y?Ke:s,f)}evaluate(e){let i,s=null,h=0;for(const f of this.args){if(h++,s=f.evaluate(e),s&&s instanceof ro&&!s.available&&(i||(i=s),s=null,h===this.args.length))return i;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class wi{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let f=1;f<e.length-1;f+=2){const y=e[f];if("string"!=typeof y)return i.error(`Expected string, but found ${typeof y} instead.`,f);if(/[^a-zA-Z0-9_]/.test(y))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const b=i.parse(e[f+1],f+1);if(!b)return null;s.push([y,b])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return h?new wi(s,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class ui{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Zn),h=i.parse(e[2],2,si(i.expectedType||Ke));return s&&h?new ui(h.type.itemType,s,h):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new Qr(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new Qr(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new Qr(`Array index must be an integer, but found ${i} instead.`);return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class er{constructor(e,i){this.type=Ai,this.needle=e,this.haystack=i}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ke),h=i.parse(e[2],2,Ke);return s&&h?es(s.type,[Ai,Wi,Zn,_o,Ke])?new er(s,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${hi(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!ts(i,["boolean","string","number","null"]))throw new Qr(`Expected first argument to be of type boolean, string, number or null, but found ${hi(Wr(i))} instead.`);if(!ts(s,["string","array"]))throw new Qr(`Expected second argument to be of type array or string, but found ${hi(Wr(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class hr{constructor(e,i,s){this.type=Zn,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ke),h=i.parse(e[2],2,Ke);if(!s||!h)return null;if(!es(s.type,[Ai,Wi,Zn,_o,Ke]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${hi(s.type)} instead`);if(4===e.length){const f=i.parse(e[3],3,Zn);return f?new hr(s,h,f):null}return new hr(s,h)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!ts(i,["boolean","string","number","null"]))throw new Qr(`Expected first argument to be of type boolean, string, number or null, but found ${hi(Wr(i))} instead.`);if(!ts(s,["string","array"]))throw new Qr(`Expected second argument to be of type array or string, but found ${hi(Wr(s))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return s.indexOf(i,h)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Or{constructor(e,i,s,h,f,y){this.inputType=e,this.type=i,this.input=s,this.cases=h,this.outputs=f,this.otherwise=y}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,h;i.expectedType&&"value"!==i.expectedType.kind&&(h=i.expectedType);const f={},y=[];for(let M=2;M<e.length-1;M+=2){let B=e[M];const U=e[M+1];Array.isArray(B)||(B=[B]);const q=i.concat(M);if(0===B.length)return q.error("Expected at least one branch label.");for(const ye of B){if("number"!=typeof ye&&"string"!=typeof ye)return q.error("Branch labels must be numbers or strings.");if("number"==typeof ye&&Math.abs(ye)>Number.MAX_SAFE_INTEGER)return q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof ye&&Math.floor(ye)!==ye)return q.error("Numeric branch labels must be integer values.");if(s){if(q.checkSubtype(s,Wr(ye)))return null}else s=Wr(ye);if(void 0!==f[String(ye)])return q.error("Branch labels must be unique.");f[String(ye)]=y.length}const de=i.parse(U,M,h);if(!de)return null;h=h||de.type,y.push(de)}const b=i.parse(e[1],1,Ke);if(!b)return null;const C=i.parse(e[e.length-1],e.length-1,h);return C?"value"!==b.type.kind&&i.concat(1).checkSubtype(s,b.type)?null:new Or(s,h,b,f,y,C):null}evaluate(e){const i=this.input.evaluate(e);return(Wr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],h={};for(const y of i){const b=h[this.cases[y]];void 0===b?(h[this.cases[y]]=s.length,s.push([this.cases[y],[y]])):s[b][1].push(y)}const f=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,b]of s)e.push(1===b.length?f(b[0]):b.map(f)),e.push(this.outputs[y].serialize());return e.push(this.otherwise.serialize()),e}}class eo{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&"value"!==i.expectedType.kind&&(s=i.expectedType);const h=[];for(let y=1;y<e.length-1;y+=2){const b=i.parse(e[y],y,Ai);if(!b)return null;const C=i.parse(e[y+1],y+1,s);if(!C)return null;h.push([b,C]),s=s||C.type}const f=i.parse(e[e.length-1],e.length-1,s);return f?new eo(s,h,f):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Lo{constructor(e,i,s,h){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ke),h=i.parse(e[2],2,Zn);if(!s||!h)return null;if(!es(s.type,[si(Ke),Wi,Ke]))return i.error(`Expected first argument to be of type array or string, but found ${hi(s.type)} instead`);if(4===e.length){const f=i.parse(e[3],3,Zn);return f?new Lo(s.type,s,h,f):null}return new Lo(s.type,s,h)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!ts(i,["string","array"]))throw new Qr(`Expected first argument to be of type array or string, but found ${hi(Wr(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(s,h)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function rs(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function ga(t,e,i,s){return 0===s.compare(e,i)}function Zs(t,e,i){const s="=="!==t&&"!="!==t;return class E0{constructor(f,y,b){this.type=Ai,this.lhs=f,this.rhs=y,this.collator=b,this.hasUntypedArgument="value"===f.type.kind||"value"===y.type.kind}static parse(f,y){if(3!==f.length&&4!==f.length)return y.error("Expected two or three arguments.");const b=f[0];let C=y.parse(f[1],1,Ke);if(!C)return null;if(!rs(b,C.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${hi(C.type)}'.`);let M=y.parse(f[2],2,Ke);if(!M)return null;if(!rs(b,M.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${hi(M.type)}'.`);if(C.type.kind!==M.type.kind&&"value"!==C.type.kind&&"value"!==M.type.kind)return y.error(`Cannot compare types '${hi(C.type)}' and '${hi(M.type)}'.`);s&&("value"===C.type.kind&&"value"!==M.type.kind?C=new uo(M.type,[C]):"value"!==C.type.kind&&"value"===M.type.kind&&(M=new uo(C.type,[M])));let B=null;if(4===f.length){if("string"!==C.type.kind&&"string"!==M.type.kind&&"value"!==C.type.kind&&"value"!==M.type.kind)return y.error("Cannot use collator to compare non-string types.");if(B=y.parse(f[3],3,Se),!B)return null}return new E0(C,M,B)}evaluate(f){const y=this.lhs.evaluate(f),b=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const C=Wr(y),M=Wr(b);if(C.kind!==M.kind||"string"!==C.kind&&"number"!==C.kind)throw new Qr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${C.kind}, ${M.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const C=Wr(y),M=Wr(b);if("string"!==C.kind||"string"!==M.kind)return e(f,y,b)}return this.collator?i(f,y,b,this.collator.evaluate(f)):e(f,y,b)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[t];return this.eachChild(y=>{f.push(y.serialize())}),f}}}const xc=Zs("==",function(t,e,i){return e===i},ga),rl=Zs("!=",function(t,e,i){return e!==i},function(t,e,i,s){return!ga(0,e,i,s)}),El=Zs("<",function(t,e,i){return e<i},function(t,e,i,s){return s.compare(e,i)<0}),bc=Zs(">",function(t,e,i){return e>i},function(t,e,i,s){return s.compare(e,i)>0}),Xl=Zs("<=",function(t,e,i){return e<=i},function(t,e,i,s){return s.compare(e,i)<=0}),wc=Zs(">=",function(t,e,i){return e>=i},function(t,e,i,s){return s.compare(e,i)>=0});class Sa{constructor(e,i,s,h,f){this.type=Wi,this.number=e,this.locale=i,this.currency=s,this.minFractionDigits=h,this.maxFractionDigits=f}static parse(e,i){if(3!==e.length)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Zn);if(!s)return null;const h=e[2];if("object"!=typeof h||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=i.parse(h.locale,1,Wi),!f))return null;let y=null;if(h.currency&&(y=i.parse(h.currency,1,Wi),!y))return null;let b=null;if(h["min-fraction-digits"]&&(b=i.parse(h["min-fraction-digits"],1,Zn),!b))return null;let C=null;return h["max-fraction-digits"]&&(C=i.parse(h["max-fraction-digits"],1,Zn),!C)?null:new Sa(s,f,y,b,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Kl{constructor(e){this.type=Zn,this.input=e}static parse(e,i){if(2!==e.length)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?i.error(`Expected argument of type string or array, but found ${hi(s.type)} instead.`):new Kl(s):null}evaluate(e){const i=this.input.evaluate(e);if("string"==typeof i||Array.isArray(i))return i.length;throw new Qr(`Expected value to be of type string or array, but found ${hi(Wr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const ws={"==":xc,"!=":rl,">":bc,"<":El,">=":wc,"<=":Xl,array:uo,at:ui,boolean:uo,case:eo,coalesce:Vn,collator:se,format:Mo,image:ns,in:er,"index-of":hr,interpolate:vt,"interpolate-hcl":vt,"interpolate-lab":vt,length:Kl,let:wi,literal:$o,match:Or,number:uo,"number-format":Sa,object:uo,slice:Lo,step:Aa,string:uo,"to-boolean":Ro,"to-color":Ro,"to-number":Ro,"to-string":Ro,var:zs,within:Ir};function Yo(t,[e,i,s,h]){e=e.evaluate(t),i=i.evaluate(t),s=s.evaluate(t);const f=h?h.evaluate(t):1,y=Vo(e,i,s,f);if(y)throw new Qr(y);return new Bi(e/255*f,i/255*f,s/255*f,f)}function Ss(t,e){return t in e}function to(t,e){const i=e[t];return void 0===i?null:i}function na(t){return{type:t}}function Tc(t){return{result:"success",value:t}}function ia(t){return{result:"error",value:t}}function ol(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Yc(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Cc(t){return!!t.expression&&t.expression.interpolated}function pr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Pa(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function ra(t){return t}function _a(t,e){const i="color"===e.type,s=t.stops&&"object"==typeof t.stops[0][0],h=s||!(s||void 0!==t.property),f=t.type||(Cc(e)?"exponential":"interval");if(i&&((t=$r({},t)).stops&&(t.stops=t.stops.map(M=>[M[0],Bi.parse(M[1])])),t.default=Bi.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!ve[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let y,b,C;if("exponential"===f)y=Oa;else if("interval"===f)y=Vs;else if("categorical"===f){y=Ql,b=Object.create(null);for(const M of t.stops)b[M[0]]=M[1];C=typeof t.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);y=Mu}if(s){const M={},B=[];for(let de=0;de<t.stops.length;de++){const ye=t.stops[de],Ie=ye[0].zoom;void 0===M[Ie]&&(M[Ie]={zoom:Ie,type:t.type,property:t.property,default:t.default,stops:[]},B.push(Ie)),M[Ie].stops.push([ye[0].value,ye[1]])}const U=[];for(const de of B)U.push([M[de].zoom,_a(M[de],e)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:vt.interpolationFactor.bind(void 0,q),zoomStops:U.map(de=>de[0]),evaluate:({zoom:de},ye)=>Oa({stops:U,base:t.base},e,de).evaluate(de,ye)}}if(h){const M="exponential"===f?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:vt.interpolationFactor.bind(void 0,M),zoomStops:t.stops.map(B=>B[0]),evaluate:({zoom:B})=>y(t,e,B,b,C)}}return{kind:"source",evaluate(M,B){const U=B&&B.properties?B.properties[t.property]:void 0;return void 0===U?ko(t.default,e.default):y(t,e,U,b,C)}}}function ko(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function Ql(t,e,i,s,h){return ko(typeof i===h?s[i]:void 0,t.default,e.default)}function Vs(t,e,i){if("number"!==pr(i))return ko(t.default,e.default);const s=t.stops.length;if(1===s||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[s-1][0])return t.stops[s-1][1];const h=nl(t.stops.map(f=>f[0]),i);return t.stops[h][1]}function Oa(t,e,i){const s=void 0!==t.base?t.base:1;if("number"!==pr(i))return ko(t.default,e.default);const h=t.stops.length;if(1===h||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[h-1][0])return t.stops[h-1][1];const f=nl(t.stops.map(B=>B[0]),i),y=function(B,U,q,de){const ye=de-q,Ie=B-q;return 0===ye?0:1===U?Ie/ye:(Math.pow(U,Ie)-1)/(Math.pow(U,ye)-1)}(i,s,t.stops[f][0],t.stops[f+1][0]),b=t.stops[f][1],C=t.stops[f+1][1];let M=pa[e.type]||ra;if(t.colorSpace&&"rgb"!==t.colorSpace){const B=ve[t.colorSpace];M=(U,q)=>B.reverse(B.interpolate(B.forward(U),B.forward(q),y))}return"function"==typeof b.evaluate?{evaluate(...B){const U=b.evaluate.apply(void 0,B),q=C.evaluate.apply(void 0,B);if(void 0!==U&&void 0!==q)return M(U,q,y)}}:M(b,C,y)}function Mu(t,e,i){return"color"===e.type?i=Bi.parse(i):"formatted"===e.type?i=Ni.fromString(i.toString()):"resolvedImage"===e.type?i=ro.fromString(i.toString()):pr(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),ko(i,t.default,e.default)}we.register(ws,{error:[{kind:"error"},[Wi],(t,[e])=>{throw new Qr(e.evaluate(t))}],typeof:[Wi,[Ke],(t,[e])=>hi(Wr(e.evaluate(t)))],"to-rgba":[si(Zn,4),[Oo],(t,[e])=>e.evaluate(t).toArray()],rgb:[Oo,[Zn,Zn,Zn],Yo],rgba:[Oo,[Zn,Zn,Zn,Zn],Yo],has:{type:Ai,overloads:[[[Wi],(t,[e])=>Ss(e.evaluate(t),t.properties())],[[Wi,it],(t,[e,i])=>Ss(e.evaluate(t),i.evaluate(t))]]},get:{type:Ke,overloads:[[[Wi],(t,[e])=>to(e.evaluate(t),t.properties())],[[Wi,it],(t,[e,i])=>to(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Ke,[Wi],(t,[e])=>to(e.evaluate(t),t.featureState||{})],properties:[it,[],t=>t.properties()],"geometry-type":[Wi,[],t=>t.geometryType()],id:[Ke,[],t=>t.id()],zoom:[Zn,[],t=>t.globals.zoom],pitch:[Zn,[],t=>t.globals.pitch||0],"distance-from-center":[Zn,[],t=>t.distanceFromCenter()],"heatmap-density":[Zn,[],t=>t.globals.heatmapDensity||0],"line-progress":[Zn,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Zn,[],t=>t.globals.skyRadialProgress||0],accumulated:[Ke,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Zn,na(Zn),(t,e)=>{let i=0;for(const s of e)i+=s.evaluate(t);return i}],"*":[Zn,na(Zn),(t,e)=>{let i=1;for(const s of e)i*=s.evaluate(t);return i}],"-":{type:Zn,overloads:[[[Zn,Zn],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Zn],(t,[e])=>-e.evaluate(t)]]},"/":[Zn,[Zn,Zn],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Zn,[Zn,Zn],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Zn,[],()=>Math.LN2],pi:[Zn,[],()=>Math.PI],e:[Zn,[],()=>Math.E],"^":[Zn,[Zn,Zn],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Zn,[Zn],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Zn,[Zn],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Zn,[Zn],(t,[e])=>Math.log(e.evaluate(t))],log2:[Zn,[Zn],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Zn,[Zn],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Zn,[Zn],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Zn,[Zn],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Zn,[Zn],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Zn,[Zn],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Zn,[Zn],(t,[e])=>Math.atan(e.evaluate(t))],min:[Zn,na(Zn),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[Zn,na(Zn),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[Zn,[Zn],(t,[e])=>Math.abs(e.evaluate(t))],round:[Zn,[Zn],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Zn,[Zn],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Zn,[Zn],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Ai,[Wi,Ke],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Ai,[Ke],(t,[e])=>t.id()===e.value],"filter-type-==":[Ai,[Wi],(t,[e])=>t.geometryType()===e.value],"filter-<":[Ai,[Wi,Ke],(t,[e,i])=>{const s=t.properties()[e.value],h=i.value;return typeof s==typeof h&&s<h}],"filter-id-<":[Ai,[Ke],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[Ai,[Wi,Ke],(t,[e,i])=>{const s=t.properties()[e.value],h=i.value;return typeof s==typeof h&&s>h}],"filter-id->":[Ai,[Ke],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[Ai,[Wi,Ke],(t,[e,i])=>{const s=t.properties()[e.value],h=i.value;return typeof s==typeof h&&s<=h}],"filter-id-<=":[Ai,[Ke],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[Ai,[Wi,Ke],(t,[e,i])=>{const s=t.properties()[e.value],h=i.value;return typeof s==typeof h&&s>=h}],"filter-id->=":[Ai,[Ke],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[Ai,[Ke],(t,[e])=>e.value in t.properties()],"filter-has-id":[Ai,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Ai,[si(Wi)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Ai,[si(Ke)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Ai,[Wi,si(Ke)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Ai,[Wi,si(Ke)],(t,[e,i])=>function(s,h,f,y){for(;f<=y;){const b=f+y>>1;if(h[b]===s)return!0;h[b]>s?y=b-1:f=b+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Ai,overloads:[[[Ai,Ai],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[na(Ai),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Ai,overloads:[[[Ai,Ai],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[na(Ai),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Ai,[Ai],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Ai,[Wi],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Wi,[Wi],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Wi,[Wi],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Wi,na(Ke),(t,e)=>e.map(i=>Bs(i.evaluate(t))).join("")],"resolved-locale":[Wi,[Se],(t,[e])=>e.evaluate(t).resolvedLocale()]});class Ec{constructor(e,i){var s;this.expression=e,this._warningHistory={},this._evaluator=new oe,this._defaultValue=i?"color"===(s=i).type&&Pa(s.default)?new Bi(0,0,0,0):"color"===s.type?Bi.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(e,i,s,h,f,y,b,C){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=h,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,h,f,y,b,C){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=C||null;try{const M=this.expression.evaluate(this._evaluator);if(null==M||"number"==typeof M&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Qr(`Expected value to be one of ${Object.keys(this._enumValues).map(B=>JSON.stringify(B)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,"undefined"!=typeof console&&console.warn(M.message)),this._defaultValue}}}function $s(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in ws}function Ra(t,e){const i=new As(ws,[],e?function(h){const f={color:Oo,string:Wi,number:Zn,enum:Wi,boolean:Ai,formatted:Ct,resolvedImage:sn};return"array"===h.type?si(f[h.value]||Ke,h.length):f[h.type]}(e):void 0),s=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?Tc(new Ec(s,e)):ia(i.errors)}class sl{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent="constant"!==e&&!Wo(i.expression)}evaluateWithoutErrorHandling(e,i,s,h,f,y){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,h,f,y)}evaluate(e,i,s,h,f,y){return this._styleExpression.evaluate(e,i,s,h,f,y)}}class Dc{constructor(e,i,s,h){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent="camera"!==e&&!Wo(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,s,h,f,y){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,h,f,y)}evaluate(e,i,s,h,f,y){return this._styleExpression.evaluate(e,i,s,h,f,y)}interpolationFactor(e,i,s){return this.interpolationType?vt.interpolationFactor(this.interpolationType,e,i,s):0}}function Au(t,e){if("error"===(t=Ra(t,e)).result)return t;const i=t.value.expression,s=xr(i);if(!s&&!ol(e))return ia([new nr("","data expressions not supported")]);const h=Ao(i,["zoom","pitch","distance-from-center"]);if(!h&&!Yc(e))return ia([new nr("","zoom expressions not supported")]);const f=La(i);return f||h?f instanceof nr?ia([f]):f instanceof vt&&!Cc(e)?ia([new nr("",'"interpolate" expressions cannot be used with this property')]):Tc(f?new Dc(s?"camera":"composite",t.value,f.labels,f instanceof vt?f.interpolation:void 0):new sl(s?"constant":"source",t.value)):ia([new nr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Fo{constructor(e,i){this._parameters=e,this._specification=i,$r(this,_a(this._parameters,this._specification))}static deserialize(e){return new Fo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function La(t){let e=null;if(t instanceof wi)e=La(t.result);else if(t instanceof Vn){for(const i of t.args)if(e=La(i),e)break}else(t instanceof Aa||t instanceof vt)&&t.input instanceof we&&"zoom"===t.input.name&&(e=t);return e instanceof nr||t.eachChild(i=>{const s=La(i);s instanceof nr?e=s:!e&&s?e=new nr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new nr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Jo(t){const e=t.key,i=t.value,s=t.valueSpec||{},h=t.objectElementValidators||{},f=t.style,y=t.styleSpec;let b=[];const C=pr(i);if("object"!==C)return[new cn(e,i,`object expected, ${C} found`)];for(const M in i){const B=M.split(".")[0],U=s[B]||s["*"];let q;if(h[B])q=h[B];else if(s[B])q=J;else if(h["*"])q=h["*"];else{if(!s["*"]){b.push(new cn(e,i[M],`unknown property "${M}"`));continue}q=J}b=b.concat(q({key:(e&&`${e}.`)+M,value:i[M],valueSpec:U,style:f,styleSpec:y,object:i,objectKey:M},i))}for(const M in s)h[M]||s[M].required&&void 0===s[M].default&&void 0===i[M]&&b.push(new cn(e,i,`missing required property "${M}"`));return b}function ya(t){const e=t.value,i=t.valueSpec,s=t.style,h=t.styleSpec,f=t.key,y=t.arrayElementValidator||J;if("array"!==pr(e))return[new cn(f,e,`array expected, ${pr(e)} found`)];if(i.length&&e.length!==i.length)return[new cn(f,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new cn(f,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let b={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum};h.$version<7&&(b.function=i.function),"object"===pr(i.value)&&(b=i.value);let C=[];for(let M=0;M<e.length;M++)C=C.concat(y({array:e,arrayIndex:M,value:e[M],valueSpec:b,style:s,styleSpec:h,key:`${f}[${M}]`}));return C}function ka(t){const e=t.key,i=t.value,s=t.valueSpec;let h=pr(i);if("number"===h&&i!=i&&(h="NaN"),"number"!==h)return[new cn(e,i,`number expected, ${h} found`)];if("minimum"in s){let f=s.minimum;if("array"===pr(s.minimum)&&(f=s.minimum[t.arrayIndex]),i<f)return[new cn(e,i,`${i} is less than the minimum value ${f}`)]}if("maximum"in s){let f=s.maximum;if("array"===pr(s.maximum)&&(f=s.maximum[t.arrayIndex]),i>f)return[new cn(e,i,`${i} is greater than the maximum value ${f}`)]}return[]}function js(t){const e=t.valueSpec,i=Hi(t.value.type);let s,h,f,y={};const b="categorical"!==i&&void 0===t.value.property,C=!b,M="array"===pr(t.value.stops)&&"array"===pr(t.value.stops[0])&&"object"===pr(t.value.stops[0][0]),B=Jo({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(de){if("identity"===i)return[new cn(de.key,de.value,'identity function may not have a "stops" property')];let ye=[];const Ie=de.value;return ye=ye.concat(ya({key:de.key,value:Ie,valueSpec:de.valueSpec,style:de.style,styleSpec:de.styleSpec,arrayElementValidator:U})),"array"===pr(Ie)&&0===Ie.length&&ye.push(new cn(de.key,Ie,"array must have at least one stop")),ye},default:function(de){return J({key:de.key,value:de.value,valueSpec:e,style:de.style,styleSpec:de.styleSpec})}}});return"identity"===i&&b&&B.push(new cn(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||B.push(new cn(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!Cc(t.valueSpec)&&B.push(new cn(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(C&&!ol(t.valueSpec)?B.push(new cn(t.key,t.value,"property functions not supported")):b&&!Yc(t.valueSpec)&&B.push(new cn(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!M||void 0!==t.value.property||B.push(new cn(t.key,t.value,'"property" property is required')),B;function U(de){let ye=[];const Ie=de.value,Ue=de.key;if("array"!==pr(Ie))return[new cn(Ue,Ie,`array expected, ${pr(Ie)} found`)];if(2!==Ie.length)return[new cn(Ue,Ie,`array length 2 expected, length ${Ie.length} found`)];if(M){if("object"!==pr(Ie[0]))return[new cn(Ue,Ie,`object expected, ${pr(Ie[0])} found`)];if(void 0===Ie[0].zoom)return[new cn(Ue,Ie,"object stop key must have zoom")];if(void 0===Ie[0].value)return[new cn(Ue,Ie,"object stop key must have value")];if(f&&f>Hi(Ie[0].zoom))return[new cn(Ue,Ie[0].zoom,"stop zoom values must appear in ascending order")];Hi(Ie[0].zoom)!==f&&(f=Hi(Ie[0].zoom),h=void 0,y={}),ye=ye.concat(Jo({key:`${Ue}[0]`,value:Ie[0],valueSpec:{zoom:{}},style:de.style,styleSpec:de.styleSpec,objectElementValidators:{zoom:ka,value:q}}))}else ye=ye.concat(q({key:`${Ue}[0]`,value:Ie[0],valueSpec:{},style:de.style,styleSpec:de.styleSpec},Ie));return $s(Er(Ie[1]))?ye.concat([new cn(`${Ue}[1]`,Ie[1],"expressions are not allowed in function stops.")]):ye.concat(J({key:`${Ue}[1]`,value:Ie[1],valueSpec:e,style:de.style,styleSpec:de.styleSpec}))}function q(de,ye){const Ie=pr(de.value),Ue=Hi(de.value),Qe=null!==de.value?de.value:ye;if(s){if(Ie!==s)return[new cn(de.key,Qe,`${Ie} stop domain type must match previous stop domain type ${s}`)]}else s=Ie;if("number"!==Ie&&"string"!==Ie&&"boolean"!==Ie)return[new cn(de.key,Qe,"stop domain value must be a number, string, or boolean")];if("number"!==Ie&&"categorical"!==i){let pt=`number expected, ${Ie} found`;return ol(e)&&void 0===i&&(pt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new cn(de.key,Qe,pt)]}return"categorical"!==i||"number"!==Ie||isFinite(Ue)&&Math.floor(Ue)===Ue?"categorical"!==i&&"number"===Ie&&void 0!==h&&Ue<h?[new cn(de.key,Qe,"stop domain values must appear in ascending order")]:(h=Ue,"categorical"===i&&Ue in y?[new cn(de.key,Qe,"stop domain values must be unique")]:(y[Ue]=!0,[])):[new cn(de.key,Qe,`integer expected, found ${Ue}`)]}}function Gs(t){const e=("property"===t.expressionContext?Au:Ra)(Er(t.value),t.valueSpec);if("error"===e.result)return e.value.map(s=>new cn(`${t.key}${s.key}`,t.value,s.message));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new cn(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Wo(i))return[new cn(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return va(i,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Ao(i,["zoom","feature-state"]))return[new cn(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!xr(i))return[new cn(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function va(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const h of e.valueSpec.expression.parameters)i.delete(h);if(0===i.size)return[];const s=[];return t instanceof we&&i.has(t.name)?[new cn(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(h=>{s.push(...va(h,e))}),s)}function Dl(t){const e=t.key,i=t.value,s=t.valueSpec,h=[];return Array.isArray(s.values)?-1===s.values.indexOf(Hi(i))&&h.push(new cn(e,i,`expected one of [${s.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(s.values).indexOf(Hi(i))&&h.push(new cn(e,i,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(i)} found`)),h}function oa(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!oa(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Fa(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};oa(t)||(t=wa(t));const i=t;let s=!0;try{s=function(M){if(!al(M))return M;let B=Er(M);return Ic(B),B=xa(B),B}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const h=Ot[`filter_${e}`],f=Ra(s,h);let y=null;if("error"===f.result)throw new Error(f.value.map(M=>`${M.key}: ${M.message}`).join(", "));y=(M,B,U)=>f.value.evaluate(M,B,{},U);let b=null,C=null;if(s!==i){const M=Ra(i,h);if("error"===M.result)throw new Error(M.value.map(B=>`${B.key}: ${B.message}`).join(", "));b=(B,U,q,de,ye)=>M.value.evaluate(B,U,{},q,void 0,void 0,de,ye),C=!xr(M.value.expression)}return y=y,{filter:y,dynamicFilter:b||void 0,needGeometry:Mc(s),needFeature:!!C}}function xa(t){if(!Array.isArray(t))return t;const e=function(i){if(ba.has(i[0]))for(let s=1;s<i.length;s++)if(al(i[s]))return!0;return i}(t);return!0===e?e:e.map(i=>xa(i))}function Ic(t){let e=!1;const i=[];if("case"===t[0]){for(let s=1;s<t.length-1;s+=2)e=e||al(t[s]),i.push(t[s+1]);i.push(t[t.length-1])}else if("match"===t[0]){e=e||al(t[1]);for(let s=2;s<t.length-1;s+=2)i.push(t[s+1]);i.push(t[t.length-1])}else if("step"===t[0]){e=e||al(t[1]);for(let s=1;s<t.length-1;s+=2)i.push(t[s+1])}e&&(t.length=0,t.push("any",...i));for(let s=1;s<t.length;s++)Ic(t[s])}function al(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let i=1;i<t.length;i++)if(al(t[i]))return!0;return!1}const ba=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Jc(t,e){return t<e?-1:t>e?1:0}function Mc(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Mc(t[e]))return!0;return!1}function wa(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Il(t[1],t[2],"=="):"!="===e?Ba(Il(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Il(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(wa))):"all"===e?["all"].concat(t.slice(1).map(wa)):"none"===e?["all"].concat(t.slice(1).map(wa).map(Ba)):"in"===e?ec(t[1],t.slice(2)):"!in"===e?Ba(ec(t[1],t.slice(2))):"has"===e?Ml(t[1]):"!has"===e?Ba(Ml(t[1])):"within"!==e||t;var i}function Il(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function ec(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Jc)]]:["filter-in-small",t,["literal",e]]}}function Ml(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ba(t){return["!",t]}function tc(t){if(oa(Er(t.value))){const e=Er(t.layerType);return Gs($r({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${e||"fill"}`]}))}return Ac(t)}function Ac(t){const e=t.value,i=t.key;if("array"!==pr(e))return[new cn(i,e,`array expected, ${pr(e)} found`)];const s=t.styleSpec;let h,f=[];if(e.length<1)return[new cn(i,e,"filter array must have at least 1 element")];switch(f=f.concat(Dl({key:`${i}[0]`,value:e[0],valueSpec:s.filter_operator,style:t.style,styleSpec:t.styleSpec})),Hi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Hi(e[1])&&f.push(new cn(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&f.push(new cn(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=pr(e[1]),"string"!==h&&f.push(new cn(`${i}[1]`,e[1],`string expected, ${h} found`)));for(let y=2;y<e.length;y++)h=pr(e[y]),"$type"===Hi(e[1])?f=f.concat(Dl({key:`${i}[${y}]`,value:e[y],valueSpec:s.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&f.push(new cn(`${i}[${y}]`,e[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)f=f.concat(Ac({key:`${i}[${y}]`,value:e[y],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":h=pr(e[1]),2!==e.length?f.push(new cn(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==h&&f.push(new cn(`${i}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=pr(e[1]),2!==e.length?f.push(new cn(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==h&&f.push(new cn(`${i}[1]`,e[1],`object expected, ${h} found`))}return f}function ll(t,e){const i=t.key,s=t.style,h=t.styleSpec,f=t.value,y=t.objectKey,b=h[`${e}_${t.layerType}`];if(!b)return[];const C=y.match(/^(.*)-transition$/);if("paint"===e&&C&&b[C[1]]&&b[C[1]].transition)return J({key:i,value:f,valueSpec:h.transition,style:s,styleSpec:h});const M=t.valueSpec||b[y];if(!M)return[new cn(i,f,`unknown property "${y}"`)];let B;if("string"===pr(f)&&ol(M)&&!M.tokens&&(B=/^{([^}]+)}$/.exec(f)))return[new cn(i,f,`"${y}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(B[1])} }\`.`)];const U=[];return"symbol"===t.layerType&&("text-field"===y&&s&&!s.glyphs&&U.push(new cn(i,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&Pa(Er(f))&&"identity"===Hi(f.type)&&U.push(new cn(i,f,'"text-font" does not support identity functions'))),U.concat(J({key:t.key,value:f,valueSpec:M,style:s,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:y}))}function Sc(t){return ll(t,"paint")}function Al(t){return ll(t,"layout")}function Sl(t){let e=[];const i=t.value,s=t.key,h=t.style,f=t.styleSpec;i.type||i.ref||e.push(new cn(s,i,'either "type" or "ref" is required'));let y=Hi(i.type);const b=Hi(i.ref);if(i.id){const C=Hi(i.id);for(let M=0;M<t.arrayIndex;M++){const B=h.layers[M];Hi(B.id)===C&&e.push(new cn(s,i.id,`duplicate layer id "${i.id}", previously used at line ${B.id.__line__}`))}}if("ref"in i){let C;["type","source","source-layer","filter","layout"].forEach(M=>{M in i&&e.push(new cn(s,i[M],`"${M}" is prohibited for ref layers`))}),h.layers.forEach(M=>{Hi(M.id)===b&&(C=M)}),C?C.ref?e.push(new cn(s,i.ref,"ref cannot reference another ref layer")):y=Hi(C.type):e.push(new cn(s,i.ref,`ref layer "${b}" not found`))}else if("background"!==y&&"sky"!==y)if(i.source){const C=h.sources&&h.sources[i.source],M=C&&Hi(C.type);C?"vector"===M&&"raster"===y?e.push(new cn(s,i.source,`layer "${i.id}" requires a raster source`)):"raster"===M&&"raster"!==y?e.push(new cn(s,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==M||i["source-layer"]?"raster-dem"===M&&"hillshade"!==y?e.push(new cn(s,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!i.paint||!i.paint["line-gradient"]||"geojson"===M&&C.lineMetrics||e.push(new cn(s,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new cn(s,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new cn(s,i.source,`source "${i.source}" not found`))}else e.push(new cn(s,i,'missing required property "source"'));return e=e.concat(Jo({key:s,value:i,valueSpec:f.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>J({key:`${s}.type`,value:i.type,valueSpec:f.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:C=>tc($r({layerType:y},C)),layout:C=>Jo({layer:i,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":M=>Al($r({layerType:y},M))}}),paint:C=>Jo({layer:i,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":M=>Sc($r({layerType:y},M))}})}})),e}function cl(t){const e=t.value,i=t.key,s=pr(e);return"string"!==s?[new cn(i,e,`string expected, ${s} found`)]:[]}const Na={promoteId:function({key:t,value:e}){if("string"===pr(e))return cl({key:t,value:e});{const i=[];for(const s in e)i.push(...cl({key:`${t}.${s}`,value:e[s]}));return i}}};function ul(t){const e=t.value,i=t.key,s=t.styleSpec,h=t.style;if(!e.type)return[new cn(i,e,'"type" is required')];const f=Hi(e.type);let y;switch(f){case"vector":case"raster":case"raster-dem":return y=Jo({key:i,value:e,valueSpec:s[`source_${f.replace("-","_")}`],style:t.style,styleSpec:s,objectElementValidators:Na}),y;case"geojson":if(y=Jo({key:i,value:e,valueSpec:s.source_geojson,style:h,styleSpec:s,objectElementValidators:Na}),e.cluster)for(const b in e.clusterProperties){const[C,M]=e.clusterProperties[b],B="string"==typeof C?[C,["accumulated"],["get",b]]:C;y.push(...Gs({key:`${i}.${b}.map`,value:M,expressionContext:"cluster-map"})),y.push(...Gs({key:`${i}.${b}.reduce`,value:B,expressionContext:"cluster-reduce"}))}return y;case"video":return Jo({key:i,value:e,valueSpec:s.source_video,style:h,styleSpec:s});case"image":return Jo({key:i,value:e,valueSpec:s.source_image,style:h,styleSpec:s});case"canvas":return[new cn(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Dl({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:s})}}function Xc(t){const e=t.value,i=t.styleSpec,s=i.light,h=t.style;let f=[];const y=pr(e);if(void 0===e)return f;if("object"!==y)return f=f.concat([new cn("light",e,`object expected, ${y} found`)]),f;for(const b in e){const C=b.match(/^(.*)-transition$/);f=f.concat(C&&s[C[1]]&&s[C[1]].transition?J({key:b,value:e[b],valueSpec:i.transition,style:h,styleSpec:i}):s[b]?J({key:b,value:e[b],valueSpec:s[b],style:h,styleSpec:i}):[new cn(b,e[b],`unknown property "${b}"`)])}return f}function z(t){const e=t.value,i=t.key,s=t.style,h=t.styleSpec,f=h.terrain;let y=[];const b=pr(e);if(void 0===e)return y;if("object"!==b)return y=y.concat([new cn("terrain",e,`object expected, ${b} found`)]),y;for(const C in e){const M=C.match(/^(.*)-transition$/);y=y.concat(M&&f[M[1]]&&f[M[1]].transition?J({key:C,value:e[C],valueSpec:h.transition,style:s,styleSpec:h}):f[C]?J({key:C,value:e[C],valueSpec:f[C],style:s,styleSpec:h}):[new cn(C,e[C],`unknown property "${C}"`)])}if(e.source){const C=s.sources&&s.sources[e.source],M=C&&Hi(C.type);C?"raster-dem"!==M&&y.push(new cn(i,e.source,`terrain cannot be used with a source of type ${M}, it only be used with a "raster-dem" source type`)):y.push(new cn(i,e.source,`source "${e.source}" not found`))}else y.push(new cn(i,e,'terrain is missing required property "source"'));return y}function O(t){const e=t.value,i=t.style,s=t.styleSpec,h=s.fog;let f=[];const y=pr(e);if(void 0===e)return f;if("object"!==y)return f=f.concat([new cn("fog",e,`object expected, ${y} found`)]),f;for(const b in e){const C=b.match(/^(.*)-transition$/);f=f.concat(C&&h[C[1]]&&h[C[1]].transition?J({key:b,value:e[b],valueSpec:s.transition,style:i,styleSpec:s}):h[b]?J({key:b,value:e[b],valueSpec:h[b],style:i,styleSpec:s}):[new cn(b,e[b],`unknown property "${b}"`)])}return f}const S={"*":()=>[],array:ya,boolean:function(t){const e=t.value,i=t.key,s=pr(e);return"boolean"!==s?[new cn(i,e,`boolean expected, ${s} found`)]:[]},number:ka,color:function(t){const e=t.key,i=t.value,s=pr(i);return"string"!==s?[new cn(e,i,`color expected, ${s} found`)]:null===Io.parseCSSColor(i)?[new cn(e,i,`color expected, "${i}" found`)]:[]},constants:ki,enum:Dl,filter:tc,function:js,layer:Sl,object:Jo,source:ul,light:Xc,terrain:z,fog:O,string:cl,formatted:function(t){return 0===cl(t).length?[]:Gs(t)},resolvedImage:function(t){return 0===cl(t).length?[]:Gs(t)},projection:function(t){const e=t.value,i=t.styleSpec,s=i.projection,h=t.style;let f=[];const y=pr(e);if("object"===y)for(const b in e)f=f.concat(J({key:b,value:e[b],valueSpec:s[b],style:h,styleSpec:i}));else"string"!==y&&(f=f.concat([new cn("projection",e,`object or string expected, ${y} found`)]));return f}};function J(t){const e=t.value,i=t.valueSpec,s=t.styleSpec;return i.expression&&Pa(Hi(e))?js(t):i.expression&&$s(Er(e))?Gs(t):i.type&&S[i.type]?S[i.type](t):Jo($r({},t,{valueSpec:i.type?s[i.type]:i}))}function ce(t){const e=t.value,i=t.key,s=cl(t);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new cn(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new cn(i,e,'"glyphs" url must include a "{range}" token'))),s}function Me(t,e=Ot){let i=[];return i=i.concat(J({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:ce,"*":()=>[]}})),t.constants&&(i=i.concat(ki({key:"constants",value:t.constants,style:t,styleSpec:e}))),lt(i)}function lt(t){return[].concat(t).sort((e,i)=>e.line-i.line)}function bt(t){return function(...e){return lt(t.apply(this,e))}}Me.source=bt(ul),Me.light=bt(Xc),Me.terrain=bt(z),Me.fog=bt(O),Me.layer=bt(Sl),Me.filter=bt(tc),Me.paintProperty=bt(Sc),Me.layoutProperty=bt(Al);const xn=Me,pi=xn.light,zr=xn.fog,Ri=xn.paintProperty,oo=xn.layoutProperty;function Ur(t,e){let i=!1;if(e&&e.length)for(const s of e)t.fire(new En(new Error(s.message))),i=!0;return i}var Mr=bo;function bo(t,e,i){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var h=new Int32Array(this.arrayBuffer);t=h[0],this.d=(e=h[1])+2*(i=h[2]);for(var f=0;f<this.d*this.d;f++){var y=h[3+f],b=h[3+f+1];s.push(y===b?null:h.subarray(y,b))}var C=h[3+s.length+1];this.keys=h.subarray(h[3+s.length],C),this.bboxes=h.subarray(C),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var M=0;M<this.d*this.d;M++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var B=i/e*t;this.min=-B,this.max=t+B}bo.prototype.insert=function(t,e,i,s,h){this._forEachCell(e,i,s,h,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(h)},bo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},bo.prototype._insertCell=function(t,e,i,s,h,f){this.cells[h].push(f)},bo.prototype.query=function(t,e,i,s,h){var f=this.min,y=this.max;if(t<=f&&e<=f&&y<=i&&y<=s&&!h)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(t,e,i,s,this._queryCell,b,{},h),b},bo.prototype._queryCell=function(t,e,i,s,h,f,y,b){var C=this.cells[h];if(null!==C)for(var M=this.keys,B=this.bboxes,U=0;U<C.length;U++){var q=C[U];if(void 0===y[q]){var de=4*q;(b?b(B[de+0],B[de+1],B[de+2],B[de+3]):t<=B[de+2]&&e<=B[de+3]&&i>=B[de+0]&&s>=B[de+1])?(y[q]=!0,f.push(M[q])):y[q]=!1}}},bo.prototype._forEachCell=function(t,e,i,s,h,f,y,b){for(var C=this._convertToCellCoord(t),M=this._convertToCellCoord(e),B=this._convertToCellCoord(i),U=this._convertToCellCoord(s),q=C;q<=B;q++)for(var de=M;de<=U;de++){var ye=this.d*de+q;if((!b||b(this._convertFromCellCoord(q),this._convertFromCellCoord(de),this._convertFromCellCoord(q+1),this._convertFromCellCoord(de+1)))&&h.call(this,t,e,i,s,ye,f,y,b))return}},bo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},bo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},bo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,s=0;s<this.cells.length;s++)i+=this.cells[s].length;var h=new Int32Array(e+i+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var f=e,y=0;y<t.length;y++){var b=t[y];h[3+y]=f,h.set(b,f),f+=b.length}return h[3+t.length]=f,h.set(this.keys,f),h[3+t.length+1]=f+=this.keys.length,h.set(this.bboxes,f),f+=this.bboxes.length,h.buffer};const{ImageData:us,ImageBitmap:Ts}=V,za={};function Kn(t,e,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),za[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}Kn("Object",Object),Mr.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},Mr.deserialize=function(t){return new Mr(t.buffer)},Kn("Grid",Mr),Kn("Color",Bi),Kn("Error",Error),Kn("ResolvedImage",ro),Kn("StylePropertyFunction",Fo),Kn("StyleExpression",Ec,{omit:["_evaluator"]}),Kn("ZoomDependentExpression",Dc),Kn("ZoomConstantExpression",sl),Kn("CompoundExpression",we,{omit:["_evaluate"]});for(const t in ws)ws[t]._classRegistryKey||Kn(`Expression_${t}`,ws[t]);function Pl(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function _h(t){return Ts&&t instanceof Ts}function Ua(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Pl(t)||_h(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof us)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const s of t)i.push(Ua(s,e));return i}if("object"==typeof t){const i=t.constructor,s=i._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");const h=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const f in t){if(!t.hasOwnProperty(f)||za[s].omit.indexOf(f)>=0)continue;const y=t[f];h[f]=za[s].shallow.indexOf(f)>=0?y:Ua(y,e)}t instanceof Error&&(h.message=t.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(h.$name=s),h}throw new Error("can't serialize object of type "+typeof t)}function Ol(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Pl(t)||_h(t)||ArrayBuffer.isView(t)||t instanceof us)return t;if(Array.isArray(t))return t.map(Ol);if("object"==typeof t){const e=t.$name||"Object",{klass:i}=za[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const s=Object.create(i.prototype);for(const h of Object.keys(t)){if("$name"===h)continue;const f=t[h];s[h]=za[e].shallow.indexOf(h)>=0?f:Ol(f)}return s}throw new Error("can't deserialize object of type "+typeof t)}class g{constructor(){this.first=!0}update(e,i){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const n=t=>t>=1536&&t<=1791,c=t=>t>=1872&&t<=1919,_=t=>t>=2208&&t<=2303,x=t=>t>=11904&&t<=12031,T=t=>t>=12032&&t<=12255,I=t=>t>=12272&&t<=12287,k=t=>t>=12288&&t<=12351,W=t=>t>=12352&&t<=12447,ne=t=>t>=12448&&t<=12543,le=t=>t>=12544&&t<=12591,pe=t=>t>=12704&&t<=12735,De=t=>t>=12736&&t<=12783,Ze=t=>t>=12784&&t<=12799,Be=t=>t>=12800&&t<=13055,Ve=t=>t>=13056&&t<=13311,ct=t=>t>=13312&&t<=19903,ze=t=>t>=19968&&t<=40959,at=t=>t>=40960&&t<=42127,ht=t=>t>=42128&&t<=42191,rt=t=>t>=44032&&t<=55215,st=t=>t>=63744&&t<=64255,gt=t=>t>=64336&&t<=65023,Zt=t=>t>=65040&&t<=65055,on=t=>t>=65072&&t<=65103,zn=t=>t>=65104&&t<=65135,An=t=>t>=65136&&t<=65279,Dn=t=>t>=65280&&t<=65519;function un(t){for(const e of t)if(yn(e.charCodeAt(0)))return!0;return!1}function Jt(t){for(const e of t)if(!bn(e.charCodeAt(0)))return!1;return!0}function bn(t){return!(n(t)||c(t)||_(t)||gt(t)||An(t))}function yn(t){return!(746!==t&&747!==t&&(t<4352||!(pe(t)||le(t)||on(t)&&!(t>=65097&&t<=65103)||st(t)||Ve(t)||x(t)||De(t)||!(!k(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||ct(t)||ze(t)||Be(t)||(e=t,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||rt(t)||W(t)||I(t)||(e=>e>=12688&&e<=12703)(t)||T(t)||Ze(t)||ne(t)&&12540!==t||!(!Dn(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!zn(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||Zt(t)||(e=>e>=19904&&e<=19967)(t)||at(t)||ht(t))));var e}function di(t){return!(yn(t)||(e=t,(i=e)>=128&&i<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(i=>i>=8192&&i<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&9251!==e||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||k(e)||ne(e)||(i=>i>=57344&&i<=63743)(e)||on(e)||zn(e)||Dn(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,i}function Mi(t){return t>=1424&&t<=2303||gt(t)||An(t)}function rr(t,e){return!(!e&&Mi(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(i=t,i>=6016&&i<=6143));var i}function Nn(t){for(const e of t)if(Mi(e.charCodeAt(0)))return!0;return!1}const vi="deferred",Yi="loading",Ar="loaded";let Xr=null,Gi="unavailable",Li=null;const lo=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Gi="error"),Xr&&Xr(t)};function jo(){ds.fire(new ln("pluginStateChange",{pluginStatus:Gi,pluginURL:Li}))}const ds=new $n,hs=function(){return Gi},sa=function(){if(Gi!==vi||!Li)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gi=Yi,jo(),Li&&Lr({url:Li},t=>{t?lo(t):(Gi=Ar,jo())})},wr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Gi===Ar||null!=wr.applyArabicShaping,isLoading:()=>Gi===Yi,setState(t){Gi=t.pluginStatus,Li=t.pluginURL},isParsed:()=>null!=wr.applyArabicShaping&&null!=wr.processBidirectionalText&&null!=wr.processStyledBidirectionalText,getPluginURL:()=>Li};class Ji{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new g,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,s){for(const h of i)if(!rr(h.charCodeAt(0),s))return!1;return!0}(e,wr.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*i}}}class or{constructor(e,i){this.property=e,this.value=i,this.expression=function(s,h){if(Pa(s))return new Fo(s,h);if($s(s)){const f=Au(s,h);if("error"===f.result)throw new Error(f.value.map(y=>`${y.key}: ${y.message}`).join(", "));return f.value}{let f=s;return"string"==typeof s&&"color"===h.type&&(f=Bi.parse(s)),{kind:"constant",evaluate:()=>f}}}(void 0===i?e.specification.default:i,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,i,s){return this.property.possiblyEvaluate(this,e,i,s)}}class no{constructor(e){this.property=e,this.value=new or(e,void 0)}transitioned(e,i){return new Gr(this.property,this.value,i,Ye({},e.transition,this.transition),e.now)}untransitioned(){return new Gr(this.property,this.value,null,{},0)}}class Cs{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Xn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new no(this._values[e].property)),this._values[e].value=new or(this._values[e].property,null===i?void 0:Xn(i))}getTransition(e){return Xn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new no(this._values[e].property)),this._values[e].transition=Xn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);void 0!==s&&(e[i]=s);const h=this.getTransition(i);void 0!==h&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const s=new Ps(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].transitioned(e,i._values[h]);return s}untransitioned(){const e=new Ps(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Gr{constructor(e,i,s,h,f){const y=h.delay||0,b=h.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+y,this.end=this.begin+b,e.specification.transition&&(h.delay||h.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const h=e.now||0,f=this.value.possiblyEvaluate(e,i,s),y=this.prior;if(y){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return y.possiblyEvaluate(e,i,s);{const b=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,i,s),f,$i(b))}}return f}}class Ps{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const h=new Ta(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(e,i,s);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class nc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Xn(this._values[e].value)}setValue(e,i){this._values[e]=new or(this._values[e].property,null===i?void 0:Xn(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);void 0!==s&&(e[i]=s)}return e}possiblyEvaluate(e,i,s){const h=new Ta(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(e,i,s);return h}}class ps{constructor(e,i,s){this.property=e,this.value=i,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,i,s,h){return this.property.evaluate(this.value,this.parameters,e,i,s,h)}}class Ta{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ai{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const h=pa[this.specification.type];return h?h(e,i,s):e}}class Ti{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,h){return new ps(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(i,null,{},s,h)}:e.expression,i)}interpolate(e,i,s){if("constant"!==e.value.kind||"constant"!==i.value.kind)return e;if(void 0===e.value.value||void 0===i.value.value)return new ps(this,{kind:"constant",value:void 0},e.parameters);const h=pa[this.specification.type];return h?new ps(this,{kind:"constant",value:h(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,h,f,y){return"constant"===e.kind?e.value:e.evaluate(i,s,h,f,y)}}class Xo extends Ti{possiblyEvaluate(e,i,s,h){if(void 0===e.value)return new ps(this,{kind:"constant",value:void 0},i);if("constant"===e.expression.kind){const f=e.expression.evaluate(i,null,{},s,h),y="resolvedImage"===e.property.specification.type&&"string"!=typeof f?f.name:f,b=this._calculate(y,y,y,i);return new ps(this,{kind:"constant",value:b},i)}if("camera"===e.expression.kind){const f=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new ps(this,{kind:"constant",value:f},i)}return new ps(this,e.expression,i)}evaluate(e,i,s,h,f,y){if("source"===e.kind){const b=e.evaluate(i,s,h,f,y);return this._calculate(b,b,b,i)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},s,h),e.evaluate({zoom:Math.floor(i.zoom)},s,h),e.evaluate({zoom:Math.floor(i.zoom)+1},s,h),i):e.value}_calculate(e,i,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:i,other:s}:{from:s,to:i,other:e}}interpolate(e){return e}}class qs{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,h){if(void 0!==e.value){if("constant"===e.expression.kind){const f=e.expression.evaluate(i,null,{},s,h);return this._calculate(f,f,f,i)}return this._calculate(e.expression.evaluate(new Ji(Math.floor(i.zoom-1),i)),e.expression.evaluate(new Ji(Math.floor(i.zoom),i)),e.expression.evaluate(new Ji(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:s,to:i}}interpolate(e){return e}}class Hs{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,h){return!!e.expression.evaluate(i,null,{},s,h)}interpolate(){return!1}}class os{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const s=e[i];s.specification.overridable&&this.overridableProperties.push(i);const h=this.defaultPropertyValues[i]=new or(s,void 0),f=this.defaultTransitionablePropertyValues[i]=new no(s);this.defaultTransitioningPropertyValues[i]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=h.possiblyEvaluate({})}}}function jm(t,e){return 256*(t=yi(Math.floor(t),0,255))+yi(Math.floor(e),0,255)}Kn("DataDrivenProperty",Ti),Kn("DataConstantProperty",ai),Kn("CrossFadedDataDrivenProperty",Xo),Kn("CrossFadedProperty",qs),Kn("ColorRampProperty",Hs);const tf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Su{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Bo{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function yo(t,e=1){let i=0,s=0;return{members:t.map(h=>{const f=tf[h.type].BYTES_PER_ELEMENT,y=i=nf(i,Math.max(e,f)),b=h.components||1;return s=Math.max(s,f),i+=f*b,{name:h.name,type:h.type,components:b,offset:y}}),size:nf(i,Math.max(s,e)),alignment:e}}function nf(t,e){return Math.ceil(t/e)*e}class Kc extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=s,e}}Kc.prototype.bytesPerElement=4,Kn("StructArrayLayout2i4",Kc);class Rl extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,h)}emplace(e,i,s,h,f){const y=4*e;return this.int16[y+0]=i,this.int16[y+1]=s,this.int16[y+2]=h,this.int16[y+3]=f,e}}Rl.prototype.bytesPerElement=8,Kn("StructArrayLayout4i8",Rl);class Pu extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,f,y,b){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,s,h,f,y,b)}emplace(e,i,s,h,f,y,b,C){const M=6*e,B=12*e,U=3*e;return this.int16[M+0]=i,this.int16[M+1]=s,this.uint8[B+4]=h,this.uint8[B+5]=f,this.uint8[B+6]=y,this.uint8[B+7]=b,this.float32[U+2]=C,e}}Pu.prototype.bytesPerElement=12,Kn("StructArrayLayout2i4ub1f12",Pu);class Za extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s)}emplace(e,i,s,h){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=s,this.float32[f+2]=h,e}}Za.prototype.bytesPerElement=12,Kn("StructArrayLayout3f12",Za);class ic extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,h,f,y,b,C,M,B){const U=this.length;return this.resize(U+1),this.emplace(U,e,i,s,h,f,y,b,C,M,B)}emplace(e,i,s,h,f,y,b,C,M,B,U){const q=10*e;return this.uint16[q+0]=i,this.uint16[q+1]=s,this.uint16[q+2]=h,this.uint16[q+3]=f,this.uint16[q+4]=y,this.uint16[q+5]=b,this.uint16[q+6]=C,this.uint16[q+7]=M,this.uint16[q+8]=B,this.uint16[q+9]=U,e}}ic.prototype.bytesPerElement=20,Kn("StructArrayLayout10ui20",ic);class ud extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,h,f,y,b,C){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,s,h,f,y,b,C)}emplace(e,i,s,h,f,y,b,C,M){const B=8*e;return this.uint16[B+0]=i,this.uint16[B+1]=s,this.uint16[B+2]=h,this.uint16[B+3]=f,this.uint16[B+4]=y,this.uint16[B+5]=b,this.uint16[B+6]=C,this.uint16[B+7]=M,e}}ud.prototype.bytesPerElement=16,Kn("StructArrayLayout8ui16",ud);class rf extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,h,f,y,b,C,M,B,U,q,de,ye,Ie,Ue){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,e,i,s,h,f,y,b,C,M,B,U,q,de,ye,Ie,Ue)}emplace(e,i,s,h,f,y,b,C,M,B,U,q,de,ye,Ie,Ue,Qe){const pt=16*e;return this.int16[pt+0]=i,this.int16[pt+1]=s,this.int16[pt+2]=h,this.int16[pt+3]=f,this.uint16[pt+4]=y,this.uint16[pt+5]=b,this.uint16[pt+6]=C,this.uint16[pt+7]=M,this.int16[pt+8]=B,this.int16[pt+9]=U,this.int16[pt+10]=q,this.int16[pt+11]=de,this.int16[pt+12]=ye,this.int16[pt+13]=Ie,this.int16[pt+14]=Ue,this.int16[pt+15]=Qe,e}}rf.prototype.bytesPerElement=32,Kn("StructArrayLayout4i4ui4i4i32",rf);class Qc extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Qc.prototype.bytesPerElement=4,Kn("StructArrayLayout1ul4",Qc);class Ou extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,h,f,y,b,C,M,B,U,q,de){const ye=this.length;return this.resize(ye+1),this.emplace(ye,e,i,s,h,f,y,b,C,M,B,U,q,de)}emplace(e,i,s,h,f,y,b,C,M,B,U,q,de,ye){const Ie=20*e,Ue=10*e;return this.int16[Ie+0]=i,this.int16[Ie+1]=s,this.int16[Ie+2]=h,this.int16[Ie+3]=f,this.int16[Ie+4]=y,this.float32[Ue+3]=b,this.float32[Ue+4]=C,this.float32[Ue+5]=M,this.float32[Ue+6]=B,this.int16[Ie+14]=U,this.uint32[Ue+8]=q,this.uint16[Ie+18]=de,this.uint16[Ie+19]=ye,e}}Ou.prototype.bytesPerElement=40,Kn("StructArrayLayout5i4f1i1ul2ui40",Ou);class Ru extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,h,f,y,b){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,s,h,f,y,b)}emplace(e,i,s,h,f,y,b,C){const M=8*e;return this.int16[M+0]=i,this.int16[M+1]=s,this.int16[M+2]=h,this.int16[M+4]=f,this.int16[M+5]=y,this.int16[M+6]=b,this.int16[M+7]=C,e}}Ru.prototype.bytesPerElement=16,Kn("StructArrayLayout3i2i2i16",Ru);class dd extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,h,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,h,f)}emplace(e,i,s,h,f,y){const b=4*e,C=8*e;return this.float32[b+0]=i,this.float32[b+1]=s,this.float32[b+2]=h,this.int16[C+6]=f,this.int16[C+7]=y,e}}dd.prototype.bytesPerElement=16,Kn("StructArrayLayout2f1f2i16",dd);class hd extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,h)}emplace(e,i,s,h,f){const y=12*e,b=3*e;return this.uint8[y+0]=i,this.uint8[y+1]=s,this.float32[b+1]=h,this.float32[b+2]=f,e}}hd.prototype.bytesPerElement=12,Kn("StructArrayLayout2ub2f12",hd);class Ws extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s)}emplace(e,i,s,h){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=s,this.uint16[f+2]=h,e}}Ws.prototype.bytesPerElement=6,Kn("StructArrayLayout3ui6",Ws);class yh extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,f,y,b,C,M,B,U,q,de,ye,Ie,Ue,Qe,pt,Tt,Pt,Ft){const Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,e,i,s,h,f,y,b,C,M,B,U,q,de,ye,Ie,Ue,Qe,pt,Tt,Pt,Ft)}emplace(e,i,s,h,f,y,b,C,M,B,U,q,de,ye,Ie,Ue,Qe,pt,Tt,Pt,Ft,Bt){const vn=30*e,mn=15*e,jn=60*e;return this.int16[vn+0]=i,this.int16[vn+1]=s,this.int16[vn+2]=h,this.float32[mn+2]=f,this.float32[mn+3]=y,this.uint16[vn+8]=b,this.uint16[vn+9]=C,this.uint32[mn+5]=M,this.uint32[mn+6]=B,this.uint32[mn+7]=U,this.uint16[vn+16]=q,this.uint16[vn+17]=de,this.uint16[vn+18]=ye,this.float32[mn+10]=Ie,this.float32[mn+11]=Ue,this.uint8[jn+48]=Qe,this.uint8[jn+49]=pt,this.uint8[jn+50]=Tt,this.uint32[mn+13]=Pt,this.int16[vn+28]=Ft,this.uint8[jn+58]=Bt,e}}yh.prototype.bytesPerElement=60,Kn("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",yh);class vh extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,f,y,b,C,M,B,U,q,de,ye,Ie,Ue,Qe,pt,Tt,Pt,Ft,Bt,vn,mn,jn,kn,gn,Fn,Yn,wn){const Qn=this.length;return this.resize(Qn+1),this.emplace(Qn,e,i,s,h,f,y,b,C,M,B,U,q,de,ye,Ie,Ue,Qe,pt,Tt,Pt,Ft,Bt,vn,mn,jn,kn,gn,Fn,Yn,wn)}emplace(e,i,s,h,f,y,b,C,M,B,U,q,de,ye,Ie,Ue,Qe,pt,Tt,Pt,Ft,Bt,vn,mn,jn,kn,gn,Fn,Yn,wn,Qn){const li=38*e,vr=19*e;return this.int16[li+0]=i,this.int16[li+1]=s,this.int16[li+2]=h,this.float32[vr+2]=f,this.float32[vr+3]=y,this.int16[li+8]=b,this.int16[li+9]=C,this.int16[li+10]=M,this.int16[li+11]=B,this.int16[li+12]=U,this.int16[li+13]=q,this.uint16[li+14]=de,this.uint16[li+15]=ye,this.uint16[li+16]=Ie,this.uint16[li+17]=Ue,this.uint16[li+18]=Qe,this.uint16[li+19]=pt,this.uint16[li+20]=Tt,this.uint16[li+21]=Pt,this.uint16[li+22]=Ft,this.uint16[li+23]=Bt,this.uint16[li+24]=vn,this.uint16[li+25]=mn,this.uint16[li+26]=jn,this.uint16[li+27]=kn,this.uint16[li+28]=gn,this.uint32[vr+15]=Fn,this.float32[vr+16]=Yn,this.float32[vr+17]=wn,this.float32[vr+18]=Qn,e}}vh.prototype.bytesPerElement=76,Kn("StructArrayLayout3i2f6i15ui1ul3f76",vh);class pd extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}pd.prototype.bytesPerElement=4,Kn("StructArrayLayout1f4",pd);class xh extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s)}emplace(e,i,s,h){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=s,this.int16[f+2]=h,e}}xh.prototype.bytesPerElement=6,Kn("StructArrayLayout3i6",xh);class Lu extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h,f,y,b){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,s,h,f,y,b)}emplace(e,i,s,h,f,y,b,C){const M=7*e;return this.float32[M+0]=i,this.float32[M+1]=s,this.float32[M+2]=h,this.float32[M+3]=f,this.float32[M+4]=y,this.float32[M+5]=b,this.float32[M+6]=C,e}}Lu.prototype.bytesPerElement=28,Kn("StructArrayLayout7f28",Lu);class dl extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,h)}emplace(e,i,s,h,f){const y=6*e;return this.uint32[3*e+0]=i,this.uint16[y+2]=s,this.uint16[y+3]=h,this.uint16[y+4]=f,e}}dl.prototype.bytesPerElement=12,Kn("StructArrayLayout1ul3ui12",dl);class Ca extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=s,e}}Ca.prototype.bytesPerElement=4,Kn("StructArrayLayout2ui4",Ca);class fd extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}fd.prototype.bytesPerElement=2,Kn("StructArrayLayout1ui2",fd);class bh extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=s,e}}bh.prototype.bytesPerElement=8,Kn("StructArrayLayout2f8",bh);class of extends Bo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,h)}emplace(e,i,s,h,f){const y=4*e;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=h,this.float32[y+3]=f,e}}of.prototype.bytesPerElement=16,Kn("StructArrayLayout4f16",of);class Gm extends Su{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Gm.prototype.size=40;class sf extends Ou{get(e){return new Gm(this,e)}}Kn("CollisionBoxArray",sf);class qm extends Su{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}qm.prototype.size=60;class wh extends yh{get(e){return new qm(this,e)}}Kn("PlacedSymbolArray",wh);class af extends Su{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}af.prototype.size=76;class lf extends vh{get(e){return new af(this,e)}}Kn("SymbolInstanceArray",lf);class cf extends pd{getoffsetX(e){return this.float32[1*e+0]}}Kn("GlyphOffsetArray",cf);class uf extends xh{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Kn("SymbolLineVertexArray",uf);class Hm extends Su{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Hm.prototype.size=12;class df extends dl{get(e){return new Hm(this,e)}}Kn("FeatureIndexArray",df);class ku extends Su{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}ku.prototype.size=4;class Th extends Ca{get(e){return new ku(this,e)}}Kn("FillExtrusionCentroidArray",Th);const hl=yo([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Fu=yo([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Ch=cs(function(t){t.exports=function(e,i){var s,h,f,y,b,C,M,B;for(h=e.length-(s=3&e.length),f=i,b=3432918353,C=461845907,B=0;B<h;)M=255&e.charCodeAt(B)|(255&e.charCodeAt(++B))<<8|(255&e.charCodeAt(++B))<<16|(255&e.charCodeAt(++B))<<24,++B,f=27492+(65535&(y=5*(65535&(f=(f^=M=(65535&(M=(M=(65535&M)*b+(((M>>>16)*b&65535)<<16)&4294967295)<<15|M>>>17))*C+(((M>>>16)*C&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(M=0,s){case 3:M^=(255&e.charCodeAt(B+2))<<16;case 2:M^=(255&e.charCodeAt(B+1))<<8;case 1:f^=M=(65535&(M=(M=(65535&(M^=255&e.charCodeAt(B)))*b+(((M>>>16)*b&65535)<<16)&4294967295)<<15|M>>>17))*C+(((M>>>16)*C&65535)<<16)&4294967295}return f^=e.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),hf=cs(function(t){t.exports=function(e,i){for(var s,h=e.length,f=i^h,y=0;h>=4;)s=1540483477*(65535&(s=255&e.charCodeAt(y)|(255&e.charCodeAt(++y))<<8|(255&e.charCodeAt(++y))<<16|(255&e.charCodeAt(++y))<<24))+((1540483477*(s>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),h-=4,++y;switch(h){case 3:f^=(255&e.charCodeAt(y+2))<<16;case 2:f^=(255&e.charCodeAt(y+1))<<8;case 1:f=1540483477*(65535&(f^=255&e.charCodeAt(y)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),eu=Ch,V_=hf;eu.murmur3=Ch,eu.murmur2=V_;class Eh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,s,h){this.ids.push(Wm(e)),this.positions.push(i,s,h)}getPositions(e){const i=Wm(e);let s=0,h=this.ids.length-1;for(;s<h;){const y=s+h>>1;this.ids[y]>=i?h=y:s=y+1}const f=[];for(;this.ids[s]===i;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(e,i){const s=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Bu(s,h,0,s.length-1),i&&i.push(s.buffer,h.buffer),{ids:s,positions:h}}static deserialize(e){const i=new Eh;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Wm(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:eu(String(t))}function Bu(t,e,i,s){for(;i<s;){const h=t[i+s>>1];let f=i-1,y=s+1;for(;;){do{f++}while(t[f]<h);do{y--}while(t[y]>h);if(f>=y)break;tu(t,f,y),tu(e,3*f,3*y),tu(e,3*f+1,3*y+1),tu(e,3*f+2,3*y+2)}y-i<s-y?(Bu(t,e,i,y),i=y+1):(Bu(t,e,y+1,s),s=y)}}function tu(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}Kn("FeaturePositionMap",Eh);class Va{constructor(e,i){this.gl=e.gl,this.location=i}}class Dh extends Va{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Ym extends Va{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ih extends Va{constructor(e,i){super(e,i),this.current=Bi.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Jm=new Float32Array(16),Xm=new Float32Array(9),Km=new Float32Array(4);function Mh(t){return[jm(255*t.r,255*t.g),jm(255*t.b,255*t.a)]}class nu{constructor(e,i,s){this.value=e,this.uniformNames=i.map(h=>`u_${h}`),this.type=s}setUniform(e,i,s){e.set(s.constantOr(this.value))}getBinding(e,i,s){return"color"===this.type?new Ih(e,i):new Dh(e,i)}}class Ll{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tl.concat(i.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,i,s,h){const f="u_pattern_to"===h||"u_dash_to"===h?this.patternTo:"u_pattern_from"===h||"u_dash_from"===h?this.patternFrom:"u_pixel_ratio_to"===h?this.pixelRatioTo:"u_pixel_ratio_from"===h?this.pixelRatioFrom:null;f&&e.set(f)}getBinding(e,i,s){return"u_pattern_from"===s||"u_pattern_to"===s||"u_dash_from"===s||"u_dash_to"===s?new Ym(e,i):new Dh(e,i)}}class kl{constructor(e,i,s,h){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,s,h,f,y){const b=this.paintVertexArray.length,C=this.expression.evaluate(new Ji(0),i,{},f,h,y);this.paintVertexArray.resize(e),this._setPaintValue(b,e,C)}updatePaintArray(e,i,s,h,f){const y=this.expression.evaluate({zoom:0},s,h,void 0,f);this._setPaintValue(e,i,y)}_setPaintValue(e,i,s){if("color"===this.type){const h=Mh(s);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class aa{constructor(e,i,s,h,f,y){this.expression=e,this.uniformNames=i.map(b=>`u_${b}_t`),this.type=s,this.useIntegerZoom=h,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,i,s,h,f,y){const b=this.expression.evaluate(new Ji(this.zoom),i,{},f,h,y),C=this.expression.evaluate(new Ji(this.zoom+1),i,{},f,h,y),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,b,C)}updatePaintArray(e,i,s,h,f){const y=this.expression.evaluate({zoom:this.zoom},s,h,void 0,f),b=this.expression.evaluate({zoom:this.zoom+1},s,h,void 0,f);this._setPaintValue(e,i,y,b)}_setPaintValue(e,i,s,h){if("color"===this.type){const f=Mh(s),y=Mh(h);for(let b=e;b<i;b++)this.paintVertexArray.emplace(b,f[0],f[1],y[0],y[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const s=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,h=yi(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(h)}getBinding(e,i,s){return new Dh(e,i)}}class rc{constructor(e,i,s,h,f,y,b){this.expression=e,this.type=s,this.useIntegerZoom=h,this.zoom=f,this.layerId=b,this.paintVertexAttributes=("array"===s?Fu:hl).members;for(let C=0;C<i.length;++C);this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(e,i,s){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,h,f,y){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],y)}_setPaintValues(e,i,s,h){if(!h||!s)return;const{min:f,mid:y,max:b}=s,C=h[f],M=h[y],B=h[b];if(C&&M&&B)for(let U=e;U<i;U++)this._setPaintValue(this.zoomInPaintVertexArray,U,M,C),this._setPaintValue(this.zoomOutPaintVertexArray,U,M,B)}_setPaintValue(e,i,s,h){e.emplace(i,s.tl[0],s.tl[1],s.br[0],s.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],s.pixelRatio,h.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ho{constructor(e,i,s=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const f in e.paint._values){if(!s(f))continue;const y=e.paint.get(f);if(!(y instanceof ps&&ol(y.property.specification)))continue;const b=Ah(f,e.type),C=y.value,M=y.property.specification.type,B=y.property.useIntegerZoom,U=y.property.specification["property-type"],q="cross-faded"===U||"cross-faded-data-driven"===U,de="line-dasharray"===String(f)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==C.kind||de)if("source"===C.kind||de||q){const ye=ff(f,M,"source");this.binders[f]=q?new rc(C,b,M,B,i,ye,e.id):new kl(C,b,M,ye),h.push(`/a_${f}`)}else{const ye=ff(f,M,"composite");this.binders[f]=new aa(C,b,M,B,i,ye),h.push(`/z_${f}`)}else this.binders[f]=q?new Ll(C.value,b):new nu(C.value,b,M),h.push(`/u_${f}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof kl||i instanceof aa?i.maxValue:0}populatePaintArrays(e,i,s,h,f,y){for(const b in this.binders){const C=this.binders[b];(C instanceof kl||C instanceof aa||C instanceof rc)&&C.populatePaintArray(e,i,s,h,f,y)}}setConstantPatternPositions(e,i){for(const s in this.binders){const h=this.binders[s];h instanceof Ll&&h.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,s,h,f,y){let b=!1;for(const C in e){const M=i.getPositions(C);for(const B of M){const U=s.feature(B.index);for(const q in this.binders){const de=this.binders[q];if((de instanceof kl||de instanceof aa||de instanceof rc)&&!0===de.expression.isStateDependent){const ye=h.paint.get(q);de.expression=ye.value,de.updatePaintArray(B.start,B.end,U,e[C],f,y),b=!0}}}}return b}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof nu||s instanceof Ll)&&e.push(...s.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof kl||s instanceof aa||s instanceof rc)for(let h=0;h<s.paintVertexAttributes.length;h++)e.push(s.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof nu||s instanceof Ll||s instanceof aa)for(const h of s.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const s=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof nu||f instanceof Ll||f instanceof aa)for(const y of f.uniformNames)if(i[y]){const b=f.getBinding(e,i[y],y);s.push({name:y,property:h,binding:b})}}return s}setUniforms(e,i,s,h){for(const{name:f,property:y,binding:b}of i)this.binders[y].setUniform(b,h,s.get(y),f)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const s=this.binders[i];if(e&&s instanceof rc){const h=2===e.fromScale?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(s instanceof kl||s instanceof aa)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof kl||s instanceof aa||s instanceof rc)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof kl||i instanceof aa||i instanceof rc)&&i.destroy()}}}class Pc{constructor(e,i,s=(()=>!0)){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new ho(h,i,s);this.needsUpload=!1,this._featureMap=new Eh,this._bufferOffset=0}populatePaintArrays(e,i,s,h,f,y,b){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(e,i,h,f,y,b);void 0!==i.id&&this._featureMap.add(i.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,h,f){for(const y of s)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,i,y,h,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Qm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Ah(t,e){return Qm[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const pf={"line-pattern":{source:ic,composite:ic},"fill-pattern":{source:ic,composite:ic},"fill-extrusion-pattern":{source:ic,composite:ic},"line-dasharray":{source:ud,composite:ud}},eg={color:{source:bh,composite:of},number:{source:pd,composite:bh}};function ff(t,e,i){const s=pf[t];return s&&s[i]||eg[e][i]}Kn("ConstantBinder",nu),Kn("CrossFadedConstantBinder",Ll),Kn("SourceExpressionBinder",kl),Kn("CrossFadedCompositeBinder",rc),Kn("CompositeExpressionBinder",aa),Kn("ProgramConfiguration",ho,{omit:["_buffers"]}),Kn("ProgramConfigurationSet",Pc);const md="-transition";class $a extends $n{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new nc(i.layout)),i.paint)){this._transitionablePaint=new Cs(i.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ta(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,s={}){null!=i&&this._validate(oo,`layers.${this.id}.layout.${e}`,e,i,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return qe(e,md)?this._transitionablePaint.getTransition(e.slice(0,-md.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,s={}){if(null!=i&&this._validate(Ri,`layers.${this.id}.paint.${e}`,e,i,s))return!1;if(qe(e,md))return this._transitionablePaint.setTransition(e.slice(0,-md.length),i||void 0),!1;{const h=this._transitionablePaint._values[e],f="cross-faded-data-driven"===h.property.specification["property-type"],y=h.value.isDataDriven(),b=h.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const C=this._transitionablePaint._values[e].value;return C.isDataDriven()||y||f||this._handleOverridablePaintPropertyUpdate(e,b,C)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Xt(e,(i,s)=>!(void 0===i||"layout"===s&&!Object.keys(i).length||"paint"===s&&!Object.keys(i).length))}_validate(e,i,s,h,f={}){return(!f||!1!==f.validate)&&Ur(this,e.call(xn,{key:i,layerType:this.type,objectKey:s,value:h,styleSpec:Ot,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof ps&&ol(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Fa(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const tg=yo([{name:"a_pos",components:2,type:"Int16"}],4),{members:$_}=tg;class No{constructor(e=[]){this.segments=e}prepareSegment(e,i,s,h){let f=this.segments[this.segments.length-1];return e>No.MAX_VERTEX_ARRAY_LENGTH&&Di(`Max vertices per segment is ${No.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>No.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h)&&(f={vertexOffset:i.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==h&&(f.sortKey=h),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,h){return new No([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])}}No.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Kn("SegmentVector",No);var ir=8192;class Go{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Yr?new Yr(e.lng,e.lat):Yr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Yr?new Yr(e.lng,e.lat):Yr.convert(e),this}extend(e){const i=this._sw,s=this._ne;let h,f;if(e instanceof Yr)h=e,f=e;else{if(!(e instanceof Go))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Go.convert(e)):this.extend(Yr.convert(e)):this;if(h=e._sw,f=e._ne,!h||!f)return this}return i||s?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new Yr(h.lng,h.lat),this._ne=new Yr(f.lng,f.lat)),this}getCenter(){return new Yr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Yr(this.getWest(),this.getNorth())}getSouthEast(){return new Yr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=Yr.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&h}static convert(e){return!e||e instanceof Go?e:new Go(e)}}const gd=6371008.8;class Yr{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Yr(_i(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,h=e.lat*i,f=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return gd*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new Go(new Yr(this.lng-s,this.lat-i),new Yr(this.lng+s,this.lat+i))}static convert(e){if(e instanceof Yr)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Yr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Yr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Sh=2*Math.PI*gd;function _s(t){return Sh*Math.cos(t*Math.PI/180)}function pl(t){return(180+t)/360}function oc(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ja(t,e){return t/_s(e)}function Fl(t){return 360*t-180}function la(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function mf(t,e){return t*_s(la(e))}const Ga=85.051129;class _d{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=Yr.convert(e);return new _d(pl(s.lng),oc(s.lat),ja(i,s.lat))}toLngLat(){return new Yr(Fl(this.x),la(this.y))}toAltitude(){return mf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Sh*(e=la(this.y),1/Math.cos(e*Math.PI/180));var e}}function yd(t,e,i,s,h,f,y,b,C){const M=(e+s)/2,B=(i+h)/2,U=new $(M,B);b(U),function(q,de,ye,Ie,Ue,Qe){const pt=ye-Ue,Tt=Ie-Qe;return Math.abs((Ie-de)*pt-(ye-q)*Tt)/Math.hypot(pt,Tt)}(U.x,U.y,f.x,f.y,y.x,y.y)>=C?(yd(t,e,i,M,B,f,U,b,C),yd(t,M,B,s,h,U,y,b,C)):t.push(y)}function ng(t,e,i){const s=[];let h,f,y;for(const b of t){const{x:C,y:M}=b;e(b),y?yd(s,h,f,C,M,y,b,e,i):s.push(b),h=C,f=M,y=b}return s}const Ph=Math.pow(2,14)-1,vd=-Ph-1;function ig(t,e){const i=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=yi(i,vd,Ph),t.y=yi(s,vd,Ph),(i<t.x||i>t.x+1||s<t.y||s>t.y+1)&&Di("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Bl(t,e,i){const s=t.loadGeometry(),h=t.extent,f=ir/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const y=1<<e.z,{scale:b,x:C,y:M,projection:B}=i,U=q=>{const de=Fl((e.x+q.x/h)/y),ye=la((e.y+q.y/h)/y),Ie=B.project(de,ye);q.x=(Ie.x*b-C)*h,q.y=(Ie.y*b-M)*h};for(let q=0;q<s.length;q++)if(1!==t.type)s[q]=ng(s[q],U,1);else{const de=[];for(const ye of s[q])ye.x<0||ye.x>=h||ye.y<0||ye.y>=h||(U(ye),de.push(ye));s[q]=de}}for(const y of s)for(const b of y)ig(b,f);return s}function Nl(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Bl(t):[]}}function xd(t,e,i,s,h){t.emplaceBack(2*e+(s+1)/2,2*i+(h+1)/2)}class Oh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Kc,this.indexArray=new Ws,this.segments=new No,this.programConfigurations=new Pc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,h){const f=this.layers[0],y=[];let b=null;"circle"===f.type&&(b=f.layout.get("circle-sort-key"));for(const{feature:C,id:M,index:B,sourceLayerIndex:U}of e){const q=this.layers[0]._featureFilter.needGeometry,de=Nl(C,q);if(!this.layers[0]._featureFilter.filter(new Ji(this.zoom),de,s))continue;const ye=b?b.evaluate(de,{},s):void 0,Ie={id:M,properties:C.properties,type:C.type,sourceLayerIndex:U,index:B,geometry:q?de.geometry:Bl(C,s,h),patterns:{},sortKey:ye};y.push(Ie)}b&&y.sort((C,M)=>C.sortKey-M.sortKey);for(const C of y){const{geometry:M,index:B,sourceLayerIndex:U}=C,q=e[B].feature;this.addFeature(C,M,B,i.availableImages,s),i.featureIndex.insert(q,M,B,U,this.index)}}update(e,i,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,h,f){for(const y of i)for(const b of y){const C=b.x,M=b.y;if(C<0||C>=ir||M<0||M>=ir)continue;const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),U=B.vertexLength;xd(this.layoutVertexArray,C,M,-1,-1),xd(this.layoutVertexArray,C,M,1,-1),xd(this.layoutVertexArray,C,M,1,1),xd(this.layoutVertexArray,C,M,-1,1),this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+3,U+2),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},h,f)}}function iu(t,e){for(let i=0;i<t.length;i++)if(ru(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(ru(t,e[i]))return!0;return!!Rh(t,e)}function rg(t,e,i){return!!ru(t,e)||!!bd(e,t,i)}function gf(t,e){if(1===t.length)return yf(e,t[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let h=0;h<s.length;h++)if(ru(t,s[h]))return!0}for(let i=0;i<t.length;i++)if(yf(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Rh(t,e[i]))return!0;return!1}function og(t,e,i){if(t.length>1){if(Rh(t,e))return!0;for(let s=0;s<e.length;s++)if(bd(e[s],t,i))return!0}for(let s=0;s<t.length;s++)if(bd(t[s],e,i))return!0;return!1}function Rh(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const s=t[i],h=t[i+1];for(let f=0;f<e.length-1;f++)if(sg(s,h,e[f],e[f+1]))return!0}return!1}function sg(t,e,i,s){return gi(t,i,s)!==gi(e,i,s)&&gi(t,e,i)!==gi(t,e,s)}function bd(t,e,i){const s=i*i;if(1===e.length)return t.distSqr(e[0])<s;for(let h=1;h<e.length;h++)if(_f(t,e[h-1],e[h])<s)return!0;return!1}function _f(t,e,i){const s=e.distSqr(i);if(0===s)return t.distSqr(e);const h=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/s;return t.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function yf(t,e){let i,s,h,f=!1;for(let y=0;y<t.length;y++){i=t[y];for(let b=0,C=i.length-1;b<i.length;C=b++)s=i[b],h=i[C],s.y>e.y!=h.y>e.y&&e.x<(h.x-s.x)*(e.y-s.y)/(h.y-s.y)+s.x&&(f=!f)}return f}function ru(t,e){let i=!1;for(let s=0,h=t.length-1;s<t.length;h=s++){const f=t[s],y=t[h];f.y>e.y!=y.y>e.y&&e.x<(y.x-f.x)*(e.y-f.y)/(y.y-f.y)+f.x&&(i=!i)}return i}function vf(t,e,i,s,h){for(const y of t)if(e<=y.x&&i<=y.y&&s>=y.x&&h>=y.y)return!0;const f=[new $(e,i),new $(e,h),new $(s,h),new $(s,i)];if(t.length>2)for(const y of f)if(ru(t,y))return!0;for(let y=0;y<t.length-1;y++)if(xf(t[y],t[y+1],f))return!0;return!1}function xf(t,e,i){const s=i[0],h=i[2];if(t.x<s.x&&e.x<s.x||t.x>h.x&&e.x>h.x||t.y<s.y&&e.y<s.y||t.y>h.y&&e.y>h.y)return!1;const f=gi(t,e,i[0]);return f!==gi(t,e,i[1])||f!==gi(t,e,i[2])||f!==gi(t,e,i[3])}function ou(t,e,i){const s=e.paint.get(t).value;return"constant"===s.kind?s.value:i.programConfigurations.get(e.id).getMaxValue(t)}function wd(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function bf(t,e,i,s,h){if(!e[0]&&!e[1])return t;const f=$.convert(e)._mult(h);"viewport"===i&&f._rotate(-s);const y=[];for(let b=0;b<t.length;b++)y.push(t[b].sub(f));return y}function Oc(t,e,i,s){const h=$.convert(t)._mult(s);return"viewport"===e&&h._rotate(-i),h}Kn("CircleBucket",Oh,{omit:["layers"]});const fl=new os({"circle-sort-key":new Ti(Ot.layout_circle["circle-sort-key"])});var j_={paint:new os({"circle-radius":new Ti(Ot.paint_circle["circle-radius"]),"circle-color":new Ti(Ot.paint_circle["circle-color"]),"circle-blur":new Ti(Ot.paint_circle["circle-blur"]),"circle-opacity":new Ti(Ot.paint_circle["circle-opacity"]),"circle-translate":new ai(Ot.paint_circle["circle-translate"]),"circle-translate-anchor":new ai(Ot.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ai(Ot.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ai(Ot.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ti(Ot.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ti(Ot.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ti(Ot.paint_circle["circle-stroke-opacity"])}),layout:fl};class wf{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,s,h){const f=Math.pow(2,s),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const M=Wt([],C,e),B=1/M[3]/i*f;return(U=M)[0]=(q=M)[0]*(de=[B,B,h?1/M[3]:B,B])[0],U[1]=q[1]*de[1],U[2]=q[2]*de[2],U[3]=q[3]*de[3],U;var U,q,de}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const M=At([],Un([],Ht([],y[C[0]],y[C[1]]),Ht([],y[C[2]],y[C[1]]))),B=-Vt(M,y[C[1]]);return M.concat(B)});return new wf(y,b)}}class Ea{constructor(e,i){this.min=e,this.max=i,this.center=xt([],Ge([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=$e(this.min),h=$e(this.max);for(let f=0;f<i.length;f++)s[f]=i[f]?this.min[f]:this.center[f],h[f]=i[f]?this.center[f]:this.max[f];return h[2]=this.max[2],new Ea(s,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let s=!0;for(let h=0;h<e.planes.length;h++){const f=e.planes[h];let y=0;for(let b=0;b<i.length;b++)y+=Vt(f,i[b])+f[3]>=0;if(0===y)return 0;y!==i.length&&(s=!1)}if(s)return 2;for(let h=0;h<3;h++){let f=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let b=0;b<e.points.length;b++){const C=e.points[b][h]-this.min[h];f=Math.min(f,C),y=Math.max(y,C)}if(y<0||f>this.max[h]-this.min[h])return 0}return 1}}function ag(t,e,i,s,h,f,y,b,C){if(f&&t.queryGeometry.isAboveHorizon)return!1;f&&(C*=t.pixelToTileUnitsFactor);for(const M of e)for(const B of M){const U=B.add(b),q=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(U.x,U.y,!0):0,de=f?U:ml(U,q,s),ye=f?t.tilespaceRays.map(Ue=>lg(Ue,q)):t.queryGeometry.screenGeometry,Ie=Wt([],[B.x,B.y,q,1],s);if(!y&&f?C*=Ie[3]/i.cameraToCenterDistance:y&&!f&&(C*=i.cameraToCenterDistance/Ie[3]),rg(ye,de,C))return!0}return!1}function ml(t,e,i){const s=Wt([],[t.x,t.y,e,1],i);return new $(s[0]/s[3],s[1]/s[3])}const Td=_t(0,0,0),Lh=_t(0,0,1);function lg(t,e){const i=Ne();return Td[2]=e,t.intersectsPlane(Td,Lh,i),new $(i[0],i[1])}class kh extends Oh{}function Rc(t,{width:e,height:i},s,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*s);return t.width=e,t.height=i,t.data=h,t}function Fh(t,{width:e,height:i},s){if(e===t.width&&i===t.height)return;const h=Rc({},{width:e,height:i},s);Cd(t,h,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,i)},s),t.width=e,t.height=i,t.data=h.data}function Cd(t,e,i,s,h,f){if(0===h.width||0===h.height)return e;if(h.width>t.width||h.height>t.height||i.x>t.width-h.width||i.y>t.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||s.x>e.width-h.width||s.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=t.data,b=e.data;for(let C=0;C<h.height;C++){const M=((i.y+C)*t.width+i.x)*f,B=((s.y+C)*e.width+s.x)*f;for(let U=0;U<h.width*f;U++)b[B+U]=y[M+U]}return e}Kn("HeatmapBucket",kh,{omit:["layers"]});class gl{constructor(e,i){Rc(this,e,1,i)}resize(e){Fh(this,e,1)}clone(){return new gl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,h,f){Cd(e,i,s,h,f,1)}}class Os{constructor(e,i){Rc(this,e,4,i)}resize(e){Fh(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Os({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,h,f){Cd(e,i,s,h,f,4)}}Kn("AlphaImage",gl),Kn("RGBAImage",Os);var Tf={paint:new os({"heatmap-radius":new Ti(Ot.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ti(Ot.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ai(Ot.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Hs(Ot.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ai(Ot.paint_heatmap["heatmap-opacity"])})};function Cf(t){const e={},i=t.resolution||256,s=t.clips?t.clips.length:1,h=t.image||new Os({width:i,height:s}),f=(y,b,C)=>{e[t.evaluationKey]=C;const M=t.expression.evaluate(e);h.data[y+b+0]=Math.floor(255*M.r/M.a),h.data[y+b+1]=Math.floor(255*M.g/M.a),h.data[y+b+2]=Math.floor(255*M.b/M.a),h.data[y+b+3]=Math.floor(255*M.a)};if(t.clips)for(let y=0,b=0;y<s;++y,b+=4*i)for(let C=0,M=0;C<i;C++,M+=4){const B=C/(i-1),{start:U,end:q}=t.clips[y];f(b,M,U*(1-B)+q*B)}else for(let y=0,b=0;y<i;y++,b+=4)f(0,b,y/(i-1));return h}var su={paint:new os({"hillshade-illumination-direction":new ai(Ot.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ai(Ot.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ai(Ot.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ai(Ot.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ai(Ot.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ai(Ot.paint_hillshade["hillshade-accent-color"])})};const Bh=yo([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ef}=Bh;var Ed=Dd,Nh=Dd;function Dd(t,e,i){i=i||2;var s,h,f,y,b,C,M,B=e&&e.length,U=B?e[0]*i:t.length,q=Df(t,0,U,i,!0),de=[];if(!q||q.next===q.prev)return de;if(B&&(q=function(Ie,Ue,Qe,pt){var Tt,Pt,Ft,Bt=[];for(Tt=0,Pt=Ue.length;Tt<Pt;Tt++)(Ft=Df(Ie,Ue[Tt]*pt,Tt<Pt-1?Ue[Tt+1]*pt:Ie.length,pt,!1))===Ft.next&&(Ft.steiner=!0),Bt.push(Af(Ft));for(Bt.sort(Mf),Tt=0;Tt<Bt.length;Tt++)Qe=sc(Qe=Uh(Bt[Tt],Qe),Qe.next);return Qe}(t,e,q,i)),t.length>80*i){s=f=t[0],h=y=t[1];for(var ye=i;ye<U;ye+=i)(b=t[ye])<s&&(s=b),(C=t[ye+1])<h&&(h=C),b>f&&(f=b),C>y&&(y=C);M=0!==(M=Math.max(f-s,y-h))?1/M:0}return Nu(q,de,i,s,h,M),de}function Df(t,e,i,s,h){var f,y;if(h===lu(t,e,i,s)>0)for(f=e;f<i;f+=s)y=$h(f,t[f],t[f+1],y);else for(f=i-s;f>=e;f-=s)y=$h(f,t[f],t[f+1],y);return y&&zu(y,y.next)&&(Bc(y),y=y.next),y}function sc(t,e){if(!t)return t;e||(e=t);var i,s=t;do{if(i=!1,s.steiner||!zu(s,s.next)&&0!==Eo(s.prev,s,s.next))s=s.next;else{if(Bc(s),(s=e=s.prev)===s.next)break;i=!0}}while(i||s!==e);return e}function Nu(t,e,i,s,h,f,y){if(t){!y&&f&&function(B,U,q,de){var ye=B;do{null===ye.z&&(ye.z=Zh(ye.x,ye.y,U,q,de)),ye.prevZ=ye.prev,ye.nextZ=ye.next,ye=ye.next}while(ye!==B);ye.prevZ.nextZ=null,ye.prevZ=null,function(Ie){var Ue,Qe,pt,Tt,Pt,Ft,Bt,vn,mn=1;do{for(Qe=Ie,Ie=null,Pt=null,Ft=0;Qe;){for(Ft++,pt=Qe,Bt=0,Ue=0;Ue<mn&&(Bt++,pt=pt.nextZ);Ue++);for(vn=mn;Bt>0||vn>0&&pt;)0!==Bt&&(0===vn||!pt||Qe.z<=pt.z)?(Tt=Qe,Qe=Qe.nextZ,Bt--):(Tt=pt,pt=pt.nextZ,vn--),Pt?Pt.nextZ=Tt:Ie=Tt,Tt.prevZ=Pt,Pt=Tt;Qe=pt}Pt.nextZ=null,mn*=2}while(Ft>1)}(ye)}(t,s,h,f);for(var b,C,M=t;t.prev!==t.next;)if(b=t.prev,C=t.next,f?ug(t,s,h,f):cg(t))e.push(b.i/i),e.push(t.i/i),e.push(C.i/i),Bc(t),t=C.next,M=C.next;else if((t=C)===M){y?1===y?Nu(t=If(sc(t),e,i),e,i,s,h,f,2):2===y&&zh(t,e,i,s,h,f):Nu(sc(t),e,i,s,h,f,1);break}}}function cg(t){var e=t.prev,i=t,s=t.next;if(Eo(e,i,s)>=0)return!1;for(var h=t.next.next;h!==t.prev;){if(Lc(e.x,e.y,i.x,i.y,s.x,s.y,h.x,h.y)&&Eo(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function ug(t,e,i,s){var h=t.prev,f=t,y=t.next;if(Eo(h,f,y)>=0)return!1;for(var b=h.x>f.x?h.x>y.x?h.x:y.x:f.x>y.x?f.x:y.x,C=h.y>f.y?h.y>y.y?h.y:y.y:f.y>y.y?f.y:y.y,M=Zh(h.x<f.x?h.x<y.x?h.x:y.x:f.x<y.x?f.x:y.x,h.y<f.y?h.y<y.y?h.y:y.y:f.y<y.y?f.y:y.y,e,i,s),B=Zh(b,C,e,i,s),U=t.prevZ,q=t.nextZ;U&&U.z>=M&&q&&q.z<=B;){if(U!==t.prev&&U!==t.next&&Lc(h.x,h.y,f.x,f.y,y.x,y.y,U.x,U.y)&&Eo(U.prev,U,U.next)>=0||(U=U.prevZ,q!==t.prev&&q!==t.next&&Lc(h.x,h.y,f.x,f.y,y.x,y.y,q.x,q.y)&&Eo(q.prev,q,q.next)>=0))return!1;q=q.nextZ}for(;U&&U.z>=M;){if(U!==t.prev&&U!==t.next&&Lc(h.x,h.y,f.x,f.y,y.x,y.y,U.x,U.y)&&Eo(U.prev,U,U.next)>=0)return!1;U=U.prevZ}for(;q&&q.z<=B;){if(q!==t.prev&&q!==t.next&&Lc(h.x,h.y,f.x,f.y,y.x,y.y,q.x,q.y)&&Eo(q.prev,q,q.next)>=0)return!1;q=q.nextZ}return!0}function If(t,e,i){var s=t;do{var h=s.prev,f=s.next.next;!zu(h,f)&&Sf(h,s,s.next,f)&&au(h,f)&&au(f,h)&&(e.push(h.i/i),e.push(s.i/i),e.push(f.i/i),Bc(s),Bc(s.next),s=t=f),s=s.next}while(s!==t);return sc(s)}function zh(t,e,i,s,h,f){var y=t;do{for(var b=y.next.next;b!==y.prev;){if(y.i!==b.i&&kc(y,b)){var C=Vh(y,b);return y=sc(y,y.next),C=sc(C,C.next),Nu(y,e,i,s,h,f),void Nu(C,e,i,s,h,f)}b=b.next}y=y.next}while(y!==t)}function Mf(t,e){return t.x-e.x}function Uh(t,e){var i=function(f,y){var b,C=y,M=f.x,B=f.y,U=-1/0;do{if(B<=C.y&&B>=C.next.y&&C.next.y!==C.y){var q=C.x+(B-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(q<=M&&q>U){if(U=q,q===M){if(B===C.y)return C;if(B===C.next.y)return C.next}b=C.x<C.next.x?C:C.next}}C=C.next}while(C!==y);if(!b)return null;if(M===U)return b;var de,ye=b,Ie=b.x,Ue=b.y,Qe=1/0;C=b;do{M>=C.x&&C.x>=Ie&&M!==C.x&&Lc(B<Ue?M:U,B,Ie,Ue,B<Ue?U:M,B,C.x,C.y)&&(de=Math.abs(B-C.y)/(M-C.x),au(C,f)&&(de<Qe||de===Qe&&(C.x>b.x||C.x===b.x&&dg(b,C)))&&(b=C,Qe=de)),C=C.next}while(C!==ye);return b}(t,e);if(!i)return e;var s=Vh(i,t),h=sc(i,i.next);return sc(s,s.next),e===i?h:e}function dg(t,e){return Eo(t.prev,t,e.prev)<0&&Eo(e.next,t,t.next)<0}function Zh(t,e,i,s,h){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*h)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*h)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Af(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Lc(t,e,i,s,h,f,y,b){return(h-y)*(e-b)-(t-y)*(f-b)>=0&&(t-y)*(s-b)-(i-y)*(e-b)>=0&&(i-y)*(f-b)-(h-y)*(s-b)>=0}function kc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,s){var h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==s.i&&h.next.i!==s.i&&Sf(h,h.next,i,s))return!0;h=h.next}while(h!==i);return!1}(t,e)&&(au(t,e)&&au(e,t)&&function(i,s){var h=i,f=!1,y=(i.x+s.x)/2,b=(i.y+s.y)/2;do{h.y>b!=h.next.y>b&&h.next.y!==h.y&&y<(h.next.x-h.x)*(b-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next}while(h!==i);return f}(t,e)&&(Eo(t.prev,t,e.prev)||Eo(t,e.prev,e))||zu(t,e)&&Eo(t.prev,t,t.next)>0&&Eo(e.prev,e,e.next)>0)}function Eo(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function zu(t,e){return t.x===e.x&&t.y===e.y}function Sf(t,e,i,s){var h=Id(Eo(t,e,i)),f=Id(Eo(t,e,s)),y=Id(Eo(i,s,t)),b=Id(Eo(i,s,e));return h!==f&&y!==b||!(0!==h||!Fc(t,i,e))||!(0!==f||!Fc(t,s,e))||!(0!==y||!Fc(i,t,s))||!(0!==b||!Fc(i,e,s))}function Fc(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Id(t){return t>0?1:t<0?-1:0}function au(t,e){return Eo(t.prev,t,t.next)<0?Eo(t,e,t.next)>=0&&Eo(t,t.prev,e)>=0:Eo(t,e,t.prev)<0||Eo(t,t.next,e)<0}function Vh(t,e){var i=new Md(t.i,t.x,t.y),s=new Md(e.i,e.x,e.y),h=t.next,f=e.prev;return t.next=e,e.prev=t,i.next=h,h.prev=i,s.next=i,i.prev=s,f.next=s,s.prev=f,s}function $h(t,e,i,s){var h=new Md(t,e,i);return s?(h.next=s.next,h.prev=s,s.next.prev=h,s.next=h):(h.prev=h,h.next=h),h}function Bc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Md(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function lu(t,e,i,s){for(var h=0,f=e,y=i-s;f<i;f+=s)h+=(t[y]-t[f])*(t[f+1]+t[y+1]),y=f;return h}function Ad(t,e,i,s,h){jh(t,e,i||0,s||t.length-1,h||Pf)}function jh(t,e,i,s,h){for(;s>i;){if(s-i>600){var f=s-i+1,y=e-i+1,b=Math.log(f),C=.5*Math.exp(2*b/3),M=.5*Math.sqrt(b*C*(f-C)/f)*(y-f/2<0?-1:1);jh(t,e,Math.max(i,Math.floor(e-y*C/f+M)),Math.min(s,Math.floor(e+(f-y)*C/f+M)),h)}var B=t[e],U=i,q=s;for(Nc(t,i,e),h(t[s],B)>0&&Nc(t,i,s);U<q;){for(Nc(t,U,q),U++,q--;h(t[U],B)<0;)U++;for(;h(t[q],B)>0;)q--}0===h(t[i],B)?Nc(t,i,q):Nc(t,++q,s),q<=e&&(i=q+1),e<=q&&(s=q-1)}}function Nc(t,e,i){var s=t[e];t[e]=t[i],t[i]=s}function Pf(t,e){return t<e?-1:t>e?1:0}function Uu(t,e){const i=t.length;if(i<=1)return[t];const s=[];let h,f;for(let y=0;y<i;y++){const b=fi(t[y]);0!==b&&(t[y].area=Math.abs(b),void 0===f&&(f=b<0),f===b<0?(h&&s.push(h),h=[t[y]]):h.push(t[y]))}if(h&&s.push(h),e>1)for(let y=0;y<s.length;y++)s[y].length<=e||(Ad(s[y],e,1,s[y].length-1,Zu),s[y]=s[y].slice(0,e));return s}function Zu(t,e){return e.area-t.area}function Gh(t,e,i){const s=i.patternDependencies;let h=!1;for(const f of e){const y=f.paint.get(`${t}-pattern`);y.isConstant()||(h=!0);const b=y.constantOr(null);b&&(h=!0,s[b.to]=!0,s[b.from]=!0)}return h}function Sd(t,e,i,s,h){const f=h.patternDependencies;for(const y of e){const b=y.paint.get(`${t}-pattern`).value;if("constant"!==b.kind){let C=b.evaluate({zoom:s-1},i,{},h.availableImages),M=b.evaluate({zoom:s},i,{},h.availableImages),B=b.evaluate({zoom:s+1},i,{},h.availableImages);C=C&&C.name?C.name:C,M=M&&M.name?M.name:M,B=B&&B.name?B.name:B,f[C]=!0,f[M]=!0,f[B]=!0,i.patterns[y.id]={min:C,mid:M,max:B}}}return i}Dd.deviation=function(t,e,i,s){var h=e&&e.length,f=Math.abs(lu(t,0,h?e[0]*i:t.length,i));if(h)for(var y=0,b=e.length;y<b;y++)f-=Math.abs(lu(t,e[y]*i,y<b-1?e[y+1]*i:t.length,i));var C=0;for(y=0;y<s.length;y+=3){var M=s[y]*i,B=s[y+1]*i,U=s[y+2]*i;C+=Math.abs((t[M]-t[U])*(t[B+1]-t[M+1])-(t[M]-t[B])*(t[U+1]-t[M+1]))}return 0===f&&0===C?0:Math.abs((C-f)/f)},Dd.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,h=0;h<t.length;h++){for(var f=0;f<t[h].length;f++)for(var y=0;y<e;y++)i.vertices.push(t[h][f][y]);h>0&&i.holes.push(s+=t[h-1].length)}return i},Ed.default=Nh;class Pd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Kc,this.indexArray=new Ws,this.indexArray2=new Ca,this.programConfigurations=new Pc(e.layers,e.zoom),this.segments=new No,this.segments2=new No,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,h){this.hasPattern=Gh("fill",this.layers,i);const f=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:b,id:C,index:M,sourceLayerIndex:B}of e){const U=this.layers[0]._featureFilter.needGeometry,q=Nl(b,U);if(!this.layers[0]._featureFilter.filter(new Ji(this.zoom),q,s))continue;const de=f?f.evaluate(q,{},s,i.availableImages):void 0,ye={id:C,properties:b.properties,type:b.type,sourceLayerIndex:B,index:M,geometry:U?q.geometry:Bl(b,s,h),patterns:{},sortKey:de};y.push(ye)}f&&y.sort((b,C)=>b.sortKey-C.sortKey);for(const b of y){const{geometry:C,index:M,sourceLayerIndex:B}=b;if(this.hasPattern){const U=Sd("fill",this.layers,b,this.zoom,i);this.patternFeatures.push(U)}else this.addFeature(b,C,M,s,{},i.availableImages);i.featureIndex.insert(e[M].feature,C,M,B,this.index)}}update(e,i,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,h)}addFeatures(e,i,s,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ef),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,s,h,f,y=[]){for(const b of Uu(i,500)){let C=0;for(const ye of b)C+=ye.length;const M=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray),B=M.vertexLength,U=[],q=[];for(const ye of b){if(0===ye.length)continue;ye!==b[0]&&q.push(U.length/2);const Ie=this.segments2.prepareSegment(ye.length,this.layoutVertexArray,this.indexArray2),Ue=Ie.vertexLength;this.layoutVertexArray.emplaceBack(ye[0].x,ye[0].y),this.indexArray2.emplaceBack(Ue+ye.length-1,Ue),U.push(ye[0].x),U.push(ye[0].y);for(let Qe=1;Qe<ye.length;Qe++)this.layoutVertexArray.emplaceBack(ye[Qe].x,ye[Qe].y),this.indexArray2.emplaceBack(Ue+Qe-1,Ue+Qe),U.push(ye[Qe].x),U.push(ye[Qe].y);Ie.vertexLength+=ye.length,Ie.primitiveLength+=ye.length}const de=Ed(U,q);for(let ye=0;ye<de.length;ye+=3)this.indexArray.emplaceBack(B+de[ye],B+de[ye+1],B+de[ye+2]);M.vertexLength+=C,M.primitiveLength+=de.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,y,h)}}Kn("FillBucket",Pd,{omit:["layers","patternFeatures"]});const hg=new os({"fill-sort-key":new Ti(Ot.layout_fill["fill-sort-key"])});var Of={paint:new os({"fill-antialias":new ai(Ot.paint_fill["fill-antialias"]),"fill-opacity":new Ti(Ot.paint_fill["fill-opacity"]),"fill-color":new Ti(Ot.paint_fill["fill-color"]),"fill-outline-color":new Ti(Ot.paint_fill["fill-outline-color"]),"fill-translate":new ai(Ot.paint_fill["fill-translate"]),"fill-translate-anchor":new ai(Ot.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xo(Ot.paint_fill["fill-pattern"])}),layout:hg};const qh=yo([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Rf=yo([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:G_}=qh;var Hh=cu;function cu(t,e,i,s,h){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=h,t.readFields(Lf,this,e)}function Lf(t,e,i){1==t?e.id=i.readVarint():2==t?function(s,h){for(var f=s.readVarint()+s.pos;s.pos<f;){var y=h._keys[s.readVarint()],b=h._values[s.readVarint()];h.properties[y]=b}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function pg(t){for(var e,i,s=0,h=0,f=t.length,y=f-1;h<f;y=h++)s+=((i=t[y]).x-(e=t[h]).x)*(e.y+i.y);return s}cu.types=["Unknown","Point","LineString","Polygon"],cu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,s=1,h=0,f=0,y=0,b=[];t.pos<i;){if(h<=0){var C=t.readVarint();s=7&C,h=C>>3}if(h--,1===s||2===s)f+=t.readSVarint(),y+=t.readSVarint(),1===s&&(e&&b.push(e),e=[]),e.push(new $(f,y));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&b.push(e),b},cu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,s=0,h=0,f=0,y=1/0,b=-1/0,C=1/0,M=-1/0;t.pos<e;){if(s<=0){var B=t.readVarint();i=7&B,s=B>>3}if(s--,1===i||2===i)(h+=t.readSVarint())<y&&(y=h),h>b&&(b=h),(f+=t.readSVarint())<C&&(C=f),f>M&&(M=f);else if(7!==i)throw new Error("unknown command "+i)}return[y,C,b,M]},cu.prototype.toGeoJSON=function(t,e,i){var s,h,f=this.extent*Math.pow(2,i),y=this.extent*t,b=this.extent*e,C=this.loadGeometry(),M=cu.types[this.type];function B(de){for(var ye=0;ye<de.length;ye++){var Ie=de[ye];de[ye]=[360*(Ie.x+y)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ie.y+b)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var U=[];for(s=0;s<C.length;s++)U[s]=C[s][0];B(C=U);break;case 2:for(s=0;s<C.length;s++)B(C[s]);break;case 3:for(C=function(de){var ye=de.length;if(ye<=1)return[de];for(var Ie,Ue,Qe=[],pt=0;pt<ye;pt++){var Tt=pg(de[pt]);0!==Tt&&(void 0===Ue&&(Ue=Tt<0),Ue===Tt<0?(Ie&&Qe.push(Ie),Ie=[de[pt]]):Ie.push(de[pt]))}return Ie&&Qe.push(Ie),Qe}(C),s=0;s<C.length;s++)for(h=0;h<C[s].length;h++)B(C[s][h])}1===C.length?C=C[0]:M="Multi"+M;var q={type:"Feature",geometry:{type:M,coordinates:C},properties:this.properties};return"id"in this&&(q.id=this.id),q};var kf=Da;function Da(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(fg,this,e),this.length=this._features.length}function fg(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(s){for(var h=null,f=s.readVarint()+s.pos;s.pos<f;){var y=s.readVarint()>>3;h=1===y?s.readString():2===y?s.readFloat():3===y?s.readDouble():4===y?s.readVarint64():5===y?s.readVarint():6===y?s.readSVarint():7===y?s.readBoolean():null}return h}(i))}function Ff(t,e,i){if(3===t){var s=new kf(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}Da.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Hh(this._pbf,e,this.extent,this._keys,this._values)};var zc={VectorTile:function(t,e){this.layers=t.readFields(Ff,{},e)},VectorTileFeature:Hh,VectorTileLayer:kf};const mg=zc.VectorTileFeature.types,gg=Math.pow(2,13);function Vu(t,e,i,s,h,f,y,b){t.emplaceBack((e<<1)+y,(i<<1)+f,(Math.floor(s*gg)<<1)+h,Math.round(b))}class Wh{constructor(){this.acc=new $(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new $(e.x,e.y),this.max=new $(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);let s=!!this.borders;const h=this.min,f=this.max;e.x<h.x?(h.x=e.x,s=!0):e.x>f.x&&(f.x=e.x,s=!0),e.y<h.y?(h.y=e.y,s=!0):e.y>f.y&&(f.y=e.y,s=!0),((0===e.x||e.x===ir)&&e.x===i.x)!=((0===e.y||e.y===ir)&&e.y===i.y)&&this.processBorderOverlap(e,i),s&&this.checkBorderIntersection(e,i)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,br(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>ir!=e.x>ir&&this.addBorderIntersection(1,br(i.y,e.y,(ir-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,br(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>ir!=e.y>ir&&this.addBorderIntersection(3,br(i.x,e.x,(ir-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((i,s)=>i+s.edges,0);return 0!==e?this.acc.div(e)._round():new $(0,0)}span(){return new $(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class Yh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Rl,this.centroidVertexArray=new Th,this.indexArray=new Ws,this.programConfigurations=new Pc(e.layers,e.zoom),this.segments=new No,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,s,h){this.features=[],this.hasPattern=Gh("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(f){const y=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*y/(y*y+1)/ir/(1<<f.z)}(s);for(const{feature:f,id:y,index:b,sourceLayerIndex:C}of e){const M=this.layers[0]._featureFilter.needGeometry,B=Nl(f,M);if(!this.layers[0]._featureFilter.filter(new Ji(this.zoom),B,s))continue;const U={id:y,sourceLayerIndex:C,index:b,geometry:M?B.geometry:Bl(f,s,h),properties:f.properties,type:f.type,patterns:{}},q=this.layoutVertexArray.length;this.hasPattern?this.features.push(Sd("fill-extrusion",this.layers,U,this.zoom,i)):this.addFeature(U,U.geometry,b,s,{},i.availableImages),i.featureIndex.insert(f,U.geometry,b,C,this.index,q)}this.sortBorders()}addFeatures(e,i,s,h){for(const f of this.features){const{geometry:y}=f;this.addFeature(f,y,f.index,i,s,h)}this.sortBorders()}update(e,i,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,G_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Rf.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,h,f,y){const b=this.enableTerrain?new Wh:null;for(const M of Uu(i,500)){let B=0,U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===M.length||(C=M[0]).every(Ue=>Ue.x<=0)||C.every(Ue=>Ue.x>=ir)||C.every(Ue=>Ue.y<=0)||C.every(Ue=>Ue.y>=ir))continue;for(let Ue=0;Ue<M.length;Ue++){const Qe=M[Ue];if(0===Qe.length)continue;B+=Qe.length;let pt=0;b&&b.startRing(Qe[0]);for(let Tt=0;Tt<Qe.length;Tt++){const Pt=Qe[Tt];if(Tt>=1){const Ft=Qe[Tt-1];if(!_g(Pt,Ft)){b&&b.append(Pt,Ft),U.vertexLength+4>No.MAX_VERTEX_ARRAY_LENGTH&&(U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Bt=Pt.sub(Ft)._perp(),vn=Bt.x/(Math.abs(Bt.x)+Math.abs(Bt.y)),mn=Bt.y>0?1:0,jn=Ft.dist(Pt);pt+jn>32768&&(pt=0),Vu(this.layoutVertexArray,Pt.x,Pt.y,vn,mn,0,0,pt),Vu(this.layoutVertexArray,Pt.x,Pt.y,vn,mn,0,1,pt),pt+=jn,Vu(this.layoutVertexArray,Ft.x,Ft.y,vn,mn,0,0,pt),Vu(this.layoutVertexArray,Ft.x,Ft.y,vn,mn,0,1,pt);const kn=U.vertexLength;this.indexArray.emplaceBack(kn,kn+2,kn+1),this.indexArray.emplaceBack(kn+1,kn+2,kn+3),U.vertexLength+=4,U.primitiveLength+=2}}}}if(U.vertexLength+B>No.MAX_VERTEX_ARRAY_LENGTH&&(U=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray)),"Polygon"!==mg[e.type])continue;const q=[],de=[],ye=U.vertexLength;for(let Ue=0;Ue<M.length;Ue++){const Qe=M[Ue];if(0!==Qe.length){Qe!==M[0]&&de.push(q.length/2);for(let pt=0;pt<Qe.length;pt++){const Tt=Qe[pt];Vu(this.layoutVertexArray,Tt.x,Tt.y,0,0,1,1,0),q.push(Tt.x),q.push(Tt.y),b&&b.currentPolyCount.top++}}}const Ie=Ed(q,de);for(let Ue=0;Ue<Ie.length;Ue+=3)this.indexArray.emplaceBack(ye+Ie[Ue],ye+Ie[Ue+2],ye+Ie[Ue+1]);U.primitiveLength+=Ie.length/3,U.vertexLength+=B}var C;if(b&&b.polyCount.length>0){if(b.borders){b.vertexArrayOffset=this.centroidVertexArray.length;const M=b.borders,B=this.featuresOnBorder.push(b)-1;for(let U=0;U<4;U++)M[U][0]!==Number.MAX_VALUE&&this.borders[U].push(B)}this.encodeCentroid(b.borders?void 0:b.centroid(),b)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,y,h)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,i,s=!0){let h,f;if(e)if(0!==e.y){const b=i.span()._mult(this.tileToMeter);h=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(b.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(b.y/10))}else h=Math.ceil(7*(e.x+450)),f=0;else h=0,f=+s;let y=s?this.centroidVertexArray.length:i.vertexArrayOffset;for(const b of i.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*b.edges+b.top);for(let C=0;C<2*b.edges;C++)this.centroidVertexArray.emplace(y++,0,f),this.centroidVertexArray.emplace(y++,h,f);for(let C=0;C<b.top;C++)this.centroidVertexArray.emplace(y++,h,f)}}}function _g(t,e){return t.x===e.x&&(t.x<0||t.x>ir)||t.y===e.y&&(t.y<0||t.y>ir)}Kn("FillExtrusionBucket",Yh,{omit:["layers","features"]}),Kn("PartMetadata",Wh);var yg={paint:new os({"fill-extrusion-opacity":new ai(Ot["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ti(Ot["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ai(Ot["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ai(Ot["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xo(Ot["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ti(Ot["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ti(Ot["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ai(Ot["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Qi(t,e){return t.x*e.x+t.y*e.y}function Jh(t,e){if(1===t.length){let i=0;const s=e[i++];let h;for(;!h||s.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const f=e[i],y=t[0],b=h.sub(s),C=f.sub(s),M=y.sub(s),B=Qi(b,b),U=Qi(b,C),q=Qi(C,C),de=Qi(M,b),ye=Qi(M,C),Ie=B*q-U*U,Ue=(q*de-U*ye)/Ie,Qe=(B*ye-U*de)/Ie,pt=s.z*(1-Ue-Qe)+h.z*Ue+f.z*Qe;if(isFinite(pt))return pt}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function Xh(t){const e=new $(t[0],t[1]);return e.z=t[2],e}function Bf(t,e,i,s,h,f,y,b){const C=y*h.getElevationAt(t,e,!0,!0),M=0!==f[0],B=M?0===f[1]?y*(f[0]/7-450):y*function(U,q,de){const ye=Math.floor(q[0]/8),Ie=Math.floor(q[1]/8),Ue=10*(q[0]-8*ye),Qe=10*(q[1]-8*Ie),pt=U.getElevationAt(ye,Ie,!0,!0),Tt=U.getMeterToDEM(de),Pt=Math.floor(.5*(Ue*Tt-1)),Ft=Math.floor(.5*(Qe*Tt-1)),Bt=U.tileCoordToPixel(ye,Ie),vn=2*Pt+1,mn=2*Ft+1,jn=(Kr=vn,fr=mn,[(Qn=U).getElevationAtPixel(li=Bt.x-Pt,vr=Bt.y-Ft,!0),Qn.getElevationAtPixel(li+fr,vr,!0),Qn.getElevationAtPixel(li,vr+fr,!0),Qn.getElevationAtPixel(li+Kr,vr+fr,!0)]),kn=Math.abs(jn[0]-jn[1]),gn=Math.abs(jn[2]-jn[3]),Fn=Math.abs(jn[0]-jn[2])+Math.abs(jn[1]-jn[3]),Yn=Math.min(.25,.5*Tt*(kn+gn)/vn),wn=Math.min(.25,.5*Tt*Fn/mn);var Qn,li,vr,Kr,fr;return pt+Math.max(Yn*Ue,wn*Qe)}(h,f,b):C;return{base:C+(0===i)?-1:i,top:M?Math.max(B+s,C+i+2):C+s}}const Od=yo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:qa}=Od,Nf=yo([{name:"a_packed",components:3,type:"Float32"}]),{members:vg}=Nf,Kh=zc.VectorTileFeature.types,zl=Math.cos(Math.PI/180*37.5);class uu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Pu,this.layoutVertexArray2=new Za,this.indexArray=new Ws,this.programConfigurations=new Pc(e.layers,e.zoom),this.segments=new No,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,h){this.hasPattern=Gh("line",this.layers,i);const f=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:B,id:U,index:q,sourceLayerIndex:de}of e){const ye=this.layers[0]._featureFilter.needGeometry,Ie=Nl(B,ye);if(!this.layers[0]._featureFilter.filter(new Ji(this.zoom),Ie,s))continue;const Ue=f?f.evaluate(Ie,{},s):void 0,Qe={id:U,properties:B.properties,type:B.type,sourceLayerIndex:de,index:q,geometry:ye?Ie.geometry:Bl(B,s,h),patterns:{},sortKey:Ue};y.push(Qe)}f&&y.sort((B,U)=>B.sortKey-U.sortKey);const{lineAtlas:b,featureIndex:C}=i,M=this.addConstantDashes(b);for(const B of y){const{geometry:U,index:q,sourceLayerIndex:de}=B;if(M&&this.addFeatureDashes(B,b),this.hasPattern){const ye=Sd("line",this.layers,B,this.zoom,i);this.patternFeatures.push(ye)}else this.addFeature(B,U,q,s,b.positions,i.availableImages);C.insert(e[q].feature,U,q,de,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const h=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==f.kind)i=!0;else{const y=f.value,b=h.value;if(!b)continue;e.addDash(b.from,y),e.addDash(b.to,y),b.other&&e.addDash(b.other,y)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,y=h.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===y.kind)continue;let b,C,M,B,U,q;if("constant"===f.kind){const Ue=f.value;if(!Ue)continue;b=Ue.other||Ue.to,C=Ue.to,M=Ue.from}else b=f.evaluate({zoom:s-1},e),C=f.evaluate({zoom:s},e),M=f.evaluate({zoom:s+1},e);"constant"===y.kind?B=U=q=y.value:(B=y.evaluate({zoom:s-1},e),U=y.evaluate({zoom:s},e),q=y.evaluate({zoom:s+1},e)),i.addDash(b,B),i.addDash(C,U),i.addDash(M,q);const de=i.getKey(b,B),ye=i.getKey(C,U),Ie=i.getKey(M,q);e.patterns[h.id]={min:de,mid:ye,max:Ie}}}update(e,i,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,s,h)}addFeatures(e,i,s,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,vg)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qa),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,s,h,f,y){const b=this.layers[0].layout,C=b.get("line-join").evaluate(e,{}),M=b.get("line-cap").evaluate(e,{}),B=b.get("line-miter-limit"),U=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const q of i)this.addLine(q,e,C,M,B,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,y,h)}addLine(e,i,s,h,f,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Qe=0;Qe<e.length-1;Qe++)this.totalDistance+=e[Qe].dist(e[Qe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b="Polygon"===Kh[i.type];let C=e.length;for(;C>=2&&e[C-1].equals(e[C-2]);)C--;let M=0;for(;M<C-1&&e[M].equals(e[M+1]);)M++;if(C<(b?3:2))return;"bevel"===s&&(f=1.05);const B=this.overscaling<=16?122880/(512*this.overscaling):0,U=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let q,de,ye,Ie,Ue;this.e1=this.e2=-1,b&&(q=e[C-2],Ue=e[M].sub(q)._unit()._perp());for(let Qe=M;Qe<C;Qe++){if(ye=Qe===C-1?b?e[M+1]:void 0:e[Qe+1],ye&&e[Qe].equals(ye))continue;Ue&&(Ie=Ue),q&&(de=q),q=e[Qe],Ue=ye?ye.sub(q)._unit()._perp():Ie,Ie=Ie||Ue;let pt=Ie.add(Ue);0===pt.x&&0===pt.y||pt._unit();const Tt=Ie.x*Ue.x+Ie.y*Ue.y,Pt=pt.x*Ue.x+pt.y*Ue.y,Ft=0!==Pt?1/Pt:1/0,Bt=2*Math.sqrt(2-2*Pt),vn=Pt<zl&&de&&ye,mn=Ie.x*Ue.y-Ie.y*Ue.x>0;if(vn&&Qe>M){const gn=q.dist(de);if(gn>2*B){const Fn=q.sub(q.sub(de)._mult(B/gn)._round());this.updateDistance(de,Fn),this.addCurrentVertex(Fn,Ie,0,0,U),de=Fn}}const jn=de&&ye;let kn=jn?s:b?"butt":h;if(jn&&"round"===kn&&(Ft<y?kn="miter":Ft<=2&&(kn="fakeround")),"miter"===kn&&Ft>f&&(kn="bevel"),"bevel"===kn&&(Ft>2&&(kn="flipbevel"),Ft<f&&(kn="miter")),de&&this.updateDistance(de,q),"miter"===kn)pt._mult(Ft),this.addCurrentVertex(q,pt,0,0,U);else if("flipbevel"===kn){if(Ft>100)pt=Ue.mult(-1);else{const gn=Ft*Ie.add(Ue).mag()/Ie.sub(Ue).mag();pt._perp()._mult(gn*(mn?-1:1))}this.addCurrentVertex(q,pt,0,0,U),this.addCurrentVertex(q,pt.mult(-1),0,0,U)}else if("bevel"===kn||"fakeround"===kn){const gn=-Math.sqrt(Ft*Ft-1),Fn=mn?gn:0,Yn=mn?0:gn;if(de&&this.addCurrentVertex(q,Ie,Fn,Yn,U),"fakeround"===kn){const wn=Math.round(180*Bt/Math.PI/20);for(let Qn=1;Qn<wn;Qn++){let li=Qn/wn;if(.5!==li){const Kr=li-.5;li+=li*Kr*(li-1)*((1.0904+Tt*(Tt*(3.55645-1.43519*Tt)-3.2452))*Kr*Kr+(.848013+Tt*(.215638*Tt-1.06021)))}const vr=Ue.sub(Ie)._mult(li)._add(Ie)._unit()._mult(mn?-1:1);this.addHalfVertex(q,vr.x,vr.y,!1,mn,0,U)}}ye&&this.addCurrentVertex(q,Ue,-Fn,-Yn,U)}else if("butt"===kn)this.addCurrentVertex(q,pt,0,0,U);else if("square"===kn){const gn=de?1:-1;de||this.addCurrentVertex(q,pt,gn,gn,U),this.addCurrentVertex(q,pt,0,0,U),de&&this.addCurrentVertex(q,pt,gn,gn,U)}else"round"===kn&&(de&&(this.addCurrentVertex(q,Ie,0,0,U),this.addCurrentVertex(q,Ie,1,1,U,!0)),ye&&(this.addCurrentVertex(q,Ue,-1,-1,U,!0),this.addCurrentVertex(q,Ue,0,0,U)));if(vn&&Qe<C-1){const gn=q.dist(ye);if(gn>2*B){const Fn=q.add(ye.sub(q)._mult(B/gn)._round());this.updateDistance(q,Fn),this.addCurrentVertex(Fn,Ue,0,0,U),q=Fn}}}}addCurrentVertex(e,i,s,h,f,y=!1){const b=i.y*h-i.x,C=-i.y-i.x*h;this.addHalfVertex(e,i.x+i.y*s,i.y-i.x*s,y,!1,s,f),this.addHalfVertex(e,b,C,y,!0,-h,f)}addHalfVertex({x:e,y:i},s,h,f,y,b,C){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(y?1:0),Math.round(63*s)+128,Math.round(63*h)+128,1+(0===b?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const M=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),C.primitiveLength++),y?this.e2=M:this.e1=M}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Kn("LineBucket",uu,{omit:["layers","patternFeatures"]});const zf=new os({"line-cap":new Ti(Ot.layout_line["line-cap"]),"line-join":new Ti(Ot.layout_line["line-join"]),"line-miter-limit":new ai(Ot.layout_line["line-miter-limit"]),"line-round-limit":new ai(Ot.layout_line["line-round-limit"]),"line-sort-key":new Ti(Ot.layout_line["line-sort-key"])});var Rd={paint:new os({"line-opacity":new Ti(Ot.paint_line["line-opacity"]),"line-color":new Ti(Ot.paint_line["line-color"]),"line-translate":new ai(Ot.paint_line["line-translate"]),"line-translate-anchor":new ai(Ot.paint_line["line-translate-anchor"]),"line-width":new Ti(Ot.paint_line["line-width"]),"line-gap-width":new Ti(Ot.paint_line["line-gap-width"]),"line-offset":new Ti(Ot.paint_line["line-offset"]),"line-blur":new Ti(Ot.paint_line["line-blur"]),"line-dasharray":new Xo(Ot.paint_line["line-dasharray"]),"line-pattern":new Xo(Ot.paint_line["line-pattern"]),"line-gradient":new Hs(Ot.paint_line["line-gradient"])}),layout:zf};const xg=new class extends Ti{possiblyEvaluate(t,e){return e=new Ji(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,s){return e=Ye({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,s)}}(Rd.paint.properties["line-width"].specification);function Qh(t,e){return e>0?e+2*t:t}xg.useIntegerZoom=!0;const q_=yo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),Ld=yo([{name:"a_projected_pos",components:3,type:"Float32"}],4);yo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const kd=yo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ep=yo([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);yo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Fd=yo([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),tp=yo([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);yo([{name:"triangle",components:3,type:"Uint16"}]),yo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),yo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),yo([{type:"Float32",name:"offsetX"}]),yo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const _l=128;function np(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Ji(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:h}=i;let f=0;for(;f<s.length&&s[f]<=t;)f++;f=Math.max(0,f-1);let y=f;for(;y<s.length&&s[y]<t+1;)y++;y=Math.min(s.length-1,y);const b=s[f],C=s[y];return"composite"===i.kind?{kind:"composite",minZoom:b,maxZoom:C,interpolationType:h}:{kind:"camera",minZoom:b,maxZoom:C,minSize:i.evaluate(new Ji(b)),maxSize:i.evaluate(new Ji(C)),interpolationType:h}}}function Bd(t,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:h}){return"source"===t.kind?s/_l:"composite"===t.kind?br(s/_l,h/_l,i):e}function du(t,e){let i=0,s=0;if("constant"===t.kind)s=t.layoutSize;else if("source"!==t.kind){const{interpolationType:h,minZoom:f,maxZoom:y}=t,b=h?yi(vt.interpolationFactor(h,e,f,y),0,1):0;"camera"===t.kind?s=br(t.minSize,t.maxSize,b):i=b}return{uSizeT:i,uSize:s}}var Uf=Object.freeze({__proto__:null,getSizeData:np,evaluateSizeForFeature:Bd,evaluateSizeForZoom:du,SIZE_PACK_FACTOR:_l});function H_(t,e,i){return t.sections.forEach(s=>{s.text=function(h,f,y){const b=f.layout.get("text-transform").evaluate(y,{});return"uppercase"===b?h=h.toLocaleUpperCase():"lowercase"===b&&(h=h.toLocaleLowerCase()),wr.applyArabicShaping&&(h=wr.applyArabicShaping(h)),h}(s.text,e,i)}),t}const $u={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function W_(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function Zf(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var ip=function(t,e,i,s,h){var f,y,b=8*h-s-1,C=(1<<b)-1,M=C>>1,B=-7,U=i?h-1:0,q=i?-1:1,de=t[e+U];for(U+=q,f=de&(1<<-B)-1,de>>=-B,B+=b;B>0;f=256*f+t[e+U],U+=q,B-=8);for(y=f&(1<<-B)-1,f>>=-B,B+=s;B>0;y=256*y+t[e+U],U+=q,B-=8);if(0===f)f=1-M;else{if(f===C)return y?NaN:1/0*(de?-1:1);y+=Math.pow(2,s),f-=M}return(de?-1:1)*y*Math.pow(2,f-s)},Vf=function(t,e,i,s,h,f){var y,b,C,M=8*f-h-1,B=(1<<M)-1,U=B>>1,q=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,de=s?0:f-1,ye=s?1:-1,Ie=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,y=B):(y=Math.floor(Math.log(e)/Math.LN2),e*(C=Math.pow(2,-y))<1&&(y--,C*=2),(e+=y+U>=1?q/C:q*Math.pow(2,1-U))*C>=2&&(y++,C/=2),y+U>=B?(b=0,y=B):y+U>=1?(b=(e*C-1)*Math.pow(2,h),y+=U):(b=e*Math.pow(2,U-1)*Math.pow(2,h),y=0));h>=8;t[i+de]=255&b,de+=ye,b/=256,h-=8);for(y=y<<h|b,M+=h;M>0;t[i+de]=255&y,de+=ye,y/=256,M-=8);t[i+de-ye]|=128*Ie},Uc=so;function so(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}so.Varint=0,so.Fixed64=1,so.Bytes=2,so.Fixed32=5;var $f=4294967296,bg=1/$f,wg="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function ac(t){return t.type===so.Bytes?t.readVarint()+t.pos:t.pos+1}function Tg(t,e,i){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(var h=i.pos-1;h>=t;h--)i.buf[h+s]=i.buf[h]}function Y_(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function J_(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function X_(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function lc(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function rp(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Cg(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function jf(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function op(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Gf(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function hu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function pu(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Ul(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function qf(t,e,i){e.glyphs=[],1===t&&i.readMessage(Eg,e)}function Eg(t,e,i){if(3===t){const{id:s,bitmap:h,width:f,height:y,left:b,top:C,advance:M}=i.readMessage(sp,{});e.glyphs.push({id:s,bitmap:new gl({width:f+6,height:y+6},h),metrics:{width:f,height:y,left:b,top:C,advance:M}})}else 4===t?e.ascender=i.readSVarint():5===t&&(e.descender=i.readSVarint())}function sp(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}function ap(t){let e=0,i=0;for(const y of t)e+=y.w*y.h,i=Math.max(i,y.w);t.sort((y,b)=>b.h-y.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,f=0;for(const y of t)for(let b=s.length-1;b>=0;b--){const C=s[b];if(!(y.w>C.w||y.h>C.h)){if(y.x=C.x,y.y=C.y,f=Math.max(f,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===C.w&&y.h===C.h){const M=s.pop();b<s.length&&(s[b]=M)}else y.h===C.h?(C.x+=y.w,C.w-=y.w):y.w===C.w?(C.y+=y.h,C.h-=y.h):(s.push({x:C.x+y.w,y:C.y,w:C.w-y.w,h:y.h}),C.y+=y.h,C.h-=y.h);break}}return{w:h,h:f,fill:e/(h*f)||0}}so.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),h=s>>3,f=this.pos;this.type=7&s,t(h,e,this),this.pos===f&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=hu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Ul(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=hu(this.buf,this.pos)+hu(this.buf,this.pos+4)*$f;return this.pos+=8,t},readSFixed64:function(){var t=hu(this.buf,this.pos)+Ul(this.buf,this.pos+4)*$f;return this.pos+=8,t},readFloat:function(){var t=ip(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ip(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,s=this.buf;return e=127&(i=s[this.pos++]),i<128?e:(e|=(127&(i=s[this.pos++]))<<7,i<128?e:(e|=(127&(i=s[this.pos++]))<<14,i<128?e:(e|=(127&(i=s[this.pos++]))<<21,i<128?e:function(h,f,y){var b,C,M=y.buf;if(b=(112&(C=M[y.pos++]))>>4,C<128||(b|=(127&(C=M[y.pos++]))<<3,C<128)||(b|=(127&(C=M[y.pos++]))<<10,C<128)||(b|=(127&(C=M[y.pos++]))<<17,C<128)||(b|=(127&(C=M[y.pos++]))<<24,C<128)||(b|=(1&(C=M[y.pos++]))<<31,C<128))return function ju(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(h,b,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&wg?wg.decode(this.buf.subarray(e,t)):function(i,s,h){for(var f="",y=s;y<h;){var b,C,M,B=i[y],U=null,q=B>239?4:B>223?3:B>191?2:1;if(y+q>h)break;1===q?B<128&&(U=B):2===q?128==(192&(b=i[y+1]))&&(U=(31&B)<<6|63&b)<=127&&(U=null):3===q?(C=i[y+2],128==(192&(b=i[y+1]))&&128==(192&C)&&((U=(15&B)<<12|(63&b)<<6|63&C)<=2047||U>=55296&&U<=57343)&&(U=null)):4===q&&(C=i[y+2],M=i[y+3],128==(192&(b=i[y+1]))&&128==(192&C)&&128==(192&M)&&((U=(15&B)<<18|(63&b)<<12|(63&C)<<6|63&M)<=65535||U>=1114112)&&(U=null)),null===U?(U=65533,q=1):U>65535&&(U-=65536,f+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),f+=String.fromCharCode(U),y+=q}return f}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==so.Bytes)return t.push(this.readVarint(e));var i=ac(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==so.Bytes)return t.push(this.readSVarint());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==so.Bytes)return t.push(this.readBoolean());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==so.Bytes)return t.push(this.readFloat());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==so.Bytes)return t.push(this.readDouble());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==so.Bytes)return t.push(this.readFixed32());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==so.Bytes)return t.push(this.readSFixed32());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==so.Bytes)return t.push(this.readFixed64());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==so.Bytes)return t.push(this.readSFixed64());var e=ac(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===so.Varint)for(;this.buf[this.pos++]>127;);else if(e===so.Bytes)this.pos=this.readVarint()+this.pos;else if(e===so.Fixed32)this.pos+=4;else{if(e!==so.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),pu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),pu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),pu(this.buf,-1&t,this.pos),pu(this.buf,Math.floor(t*bg),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),pu(this.buf,-1&t,this.pos),pu(this.buf,Math.floor(t*bg),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var s,h,f,b;if(e>=0?(s=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,h=h+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),f=s,(b=i).buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,b.buf[b.pos]=127&(f>>>=7),function(f,y){var b=(7&f)<<4;y.buf[y.pos++]|=b|((f>>>=3)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f)))))}(h,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,h,f){for(var y,b,C=0;C<h.length;C++){if((y=h.charCodeAt(C))>55295&&y<57344){if(!b){y>56319||C+1===h.length?(s[f++]=239,s[f++]=191,s[f++]=189):b=y;continue}if(y<56320){s[f++]=239,s[f++]=191,s[f++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(s[f++]=239,s[f++]=191,s[f++]=189,b=null);y<128?s[f++]=y:(y<2048?s[f++]=y>>6|192:(y<65536?s[f++]=y>>12|224:(s[f++]=y>>18|240,s[f++]=y>>12&63|128),s[f++]=y>>6&63|128),s[f++]=63&y|128)}return f}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Tg(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Vf(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Vf(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var s=this.pos-i;s>=128&&Tg(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,i){this.writeTag(t,so.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Y_,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,J_,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,rp,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,X_,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,lc,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Cg,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,jf,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,op,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Gf,e)},writeBytesField:function(t,e){this.writeTag(t,so.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,so.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,so.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,so.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,so.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,so.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,so.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,so.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,so.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,so.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Nd{constructor(e,{pixelRatio:i,version:s,stretchX:h,stretchY:f,content:y}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=h,this.stretchY=f,this.content=y,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Hf{constructor(e,i){const s={},h={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,s,f),this.addImages(i,h,f);const{w:y,h:b}=ap(f),C=new Os({width:y||1,height:b||1});for(const M in e){const B=e[M],U=s[M].paddedRect;Os.copy(B.data,C,{x:0,y:0},{x:U.x+1,y:U.y+1},B.data)}for(const M in i){const B=i[M],U=h[M].paddedRect,q=U.x+1,de=U.y+1,ye=B.data.width,Ie=B.data.height;Os.copy(B.data,C,{x:0,y:0},{x:q,y:de},B.data),Os.copy(B.data,C,{x:0,y:Ie-1},{x:q,y:de-1},{width:ye,height:1}),Os.copy(B.data,C,{x:0,y:0},{x:q,y:de+Ie},{width:ye,height:1}),Os.copy(B.data,C,{x:ye-1,y:0},{x:q-1,y:de},{width:1,height:Ie}),Os.copy(B.data,C,{x:0,y:0},{x:q+ye,y:de},{width:1,height:Ie})}this.image=C,this.iconPositions=s,this.patternPositions=h}addImages(e,i,s){for(const h in e){const f=e[h],y={x:0,y:0,w:f.data.width+2,h:f.data.height+2};s.push(y),i[h]=new Nd(y,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),i),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),i)}patchUpdatedImage(e,i,s){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,f]=e.tl;s.update(i.data,void 0,{x:h,y:f})}}Kn("ImagePosition",Nd),Kn("ImageAtlas",Hf);const ca={horizontal:1,vertical:2,horizontalOnly:3};class Zl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const s=new Zl;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new Zl;return i.imageName=e,i}}class Ha{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const s=new Ha;for(let h=0;h<e.sections.length;h++){const f=e.sections[h];f.image?s.addImageSection(f):s.addTextSection(f,i)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,s){let h="";for(let f=0;f<i.length;f++){const y=i.charCodeAt(f+1)||null,b=i.charCodeAt(f-1)||null;h+=!s&&(y&&di(y)&&!$u[i[f+1]]||b&&di(b)&&!$u[i[f-1]])||!$u[i[f]]?i[f]:$u[i[f]]}return h}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Vl[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Vl[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new Ha;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Zl.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(s)}addImageSection(e){const i=e.image?e.image.name:"";if(0===i.length)return void Di("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Zl.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Di("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Gu(t,e,i,s,h,f,y,b,C,M,B,U,q,de,ye,Ie){const Ue=Ha.fromFeature(t,h);let Qe;U===ca.vertical&&Ue.verticalizePunctuation(q);const{processBidirectionalText:pt,processStyledBidirectionalText:Tt}=wr;if(pt&&1===Ue.sections.length){Qe=[];const Bt=pt(Ue.toString(),Hu(Ue,M,f,e,s,de,ye));for(const vn of Bt){const mn=new Ha;mn.text=vn,mn.sections=Ue.sections;for(let jn=0;jn<vn.length;jn++)mn.sectionIndex.push(0);Qe.push(mn)}}else if(Tt){Qe=[];const Bt=Tt(Ue.text,Ue.sectionIndex,Hu(Ue,M,f,e,s,de,ye));for(const vn of Bt){const mn=new Ha;mn.text=vn[0],mn.sectionIndex=vn[1],mn.sections=Ue.sections,Qe.push(mn)}}else Qe=function(Bt,vn){const mn=[],jn=Bt.text;let kn=0;for(const gn of vn)mn.push(Bt.substring(kn,gn)),kn=gn;return kn<jn.length&&mn.push(Bt.substring(kn,jn.length)),mn}(Ue,Hu(Ue,M,f,e,s,de,ye));const Pt=[],Ft={positionedLines:Pt,text:Ue.toString(),top:B[1],bottom:B[1],left:B[0],right:B[0],writingMode:U,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Bt,vn,mn,jn,kn,gn,Fn,Yn,wn,Qn,li,vr){let Kr=0,fr=0,Tr=0;const Pn="right"===Yn?1:"left"===Yn?0:.5;let kr=!1;for(const Fr of kn){const mr=Fr.getSections();for(const po of mr){if(po.imageName)continue;const To=vn[po.fontStack];if(To&&(kr=void 0!==To.ascender&&void 0!==To.descender,!kr))break}if(!kr)break}let Sr=0;for(const Fr of kn){Fr.trim();const mr=Fr.getMaxScale(),po=24*(mr-1),To={positionedGlyphs:[],lineOffset:0};Bt.positionedLines[Sr]=To;const Po=To.positionedGlyphs;let Do=0;if(!Fr.length()){fr+=gn,++Sr;continue}let ms=0,Xs=0;for(let co=0;co<Fr.length();co++){const Uo=Fr.getSection(co),Ks=Fr.getSectionIndex(co),as=Fr.getCharCode(co);let qr=Uo.scale,Zo=null,fo=null,Ms=null,qo=24,ls=0;const gs=!(wn===ca.horizontal||!li&&!yn(as)||li&&(Vl[as]||(So=as,n(So)||c(So)||_(So)||gt(So)||An(So))));if(Uo.imageName){const vs=jn[Uo.imageName];if(!vs)continue;Ms=Uo.imageName,Bt.iconsInText=Bt.iconsInText||!0,fo=vs.paddedRect;const Ho=vs.displaySize;qr=24*qr/vr,Zo={width:Ho[0],height:Ho[1],left:1,top:-3,advance:gs?Ho[1]:Ho[0],localGlyph:!1},ls=kr?-Zo.height*qr:24*mr-17-Ho[1]*qr,qo=Zo.advance;const da=(gs?Ho[0]:Ho[1])*qr-24*mr;da>0&&da>Do&&(Do=da)}else{const vs=mn[Uo.fontStack];if(!vs)continue;vs[as]&&(fo=vs[as]);const Ho=vn[Uo.fontStack];if(!Ho)continue;const da=Ho.glyphs[as];if(!da)continue;if(Zo=da.metrics,qo=8203!==as?24:0,kr){const Hc=void 0!==Ho.ascender?Math.abs(Ho.ascender):0,Du=void 0!==Ho.descender?Math.abs(Ho.descender):0,Wc=(Hc+Du)*qr;ms<Wc&&(ms=Wc,Xs=(Hc-Du)/2*qr),ls=-Hc*qr}else ls=24*(mr-qr)-17}gs?(Bt.verticalizable=!0,Po.push({glyph:as,imageName:Ms,x:Kr,y:fr+ls,vertical:gs,scale:qr,localGlyph:Zo.localGlyph,fontStack:Uo.fontStack,sectionIndex:Ks,metrics:Zo,rect:fo}),Kr+=qo*qr+Qn):(Po.push({glyph:as,imageName:Ms,x:Kr,y:fr+ls,vertical:gs,scale:qr,localGlyph:Zo.localGlyph,fontStack:Uo.fontStack,sectionIndex:Ks,metrics:Zo,rect:fo}),Kr+=Zo.advance*qr+Qn)}0!==Po.length&&(Tr=Math.max(Kr-Qn,Tr),kr?Wu(Po,Pn,Do,Xs,gn*mr/2):Wu(Po,Pn,Do,0,gn/2)),Kr=0;const ss=gn*mr+Do;To.lineOffset=Math.max(Do,po),fr+=ss,++Sr}var So;const wo=fr,{horizontalAlign:Ko,verticalAlign:fs}=Ud(Fn);(function(Fr,mr,po,To,Po,Do){const ms=(mr-po)*Po,Xs=-Do*To;for(const ss of Fr)for(const co of ss.positionedGlyphs)co.x+=ms,co.y+=Xs})(Bt.positionedLines,Pn,Ko,fs,Tr,wo),Bt.top+=-fs*wo,Bt.bottom=Bt.top+wo,Bt.left+=-Ko*Tr,Bt.right=Bt.left+Tr,Bt.hasBaseline=kr}(Ft,e,i,s,Qe,y,b,C,U,M,q,Ie),!function(Bt){for(const vn of Bt)if(0!==vn.positionedGlyphs.length)return!1;return!0}(Pt)&&Ft}const Vl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qu={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Zc(t,e,i,s,h,f){if(e.imageName){const y=s[e.imageName];return y?y.displaySize[0]*e.scale*24/f+h:0}{const y=i[e.fontStack],b=y&&y.glyphs[t];return b?b.metrics.advance*e.scale+h:0}}function Wf(t,e,i,s){const h=Math.pow(t-e,2);return s?t<e?h/2:2*h:h+Math.abs(i)*i}function Yf(t,e,i){let s=0;return 10===t&&(s-=1e4),i&&(s+=150),40!==t&&65288!==t||(s+=50),41!==e&&65289!==e||(s+=50),s}function lp(t,e,i,s,h,f){let y=null,b=Wf(e,i,h,f);for(const C of s){const M=Wf(e-C.x,i,h,f)+C.badness;M<=b&&(y=C,b=M)}return{index:t,x:e,priorBreak:y,badness:b}}function zd(t){return t?zd(t.priorBreak).concat(t.index):[]}function Hu(t,e,i,s,h,f,y){if("point"!==f)return[];if(!t)return[];const b=[],C=function(q,de,ye,Ie,Ue,Qe){let pt=0;for(let Tt=0;Tt<q.length();Tt++){const Pt=q.getSection(Tt);pt+=Zc(q.getCharCode(Tt),Pt,Ie,Ue,de,Qe)}return pt/Math.max(1,Math.ceil(pt/ye))}(t,e,i,s,h,y),M=t.text.indexOf("\u200b")>=0;let B=0;for(let q=0;q<t.length();q++){const de=t.getSection(q),ye=t.getCharCode(q);if(Vl[ye]||(B+=Zc(ye,de,s,h,e,y)),q<t.length()-1){const Ie=!((U=ye)<11904||!(pe(U)||le(U)||on(U)||st(U)||Ve(U)||x(U)||De(U)||k(U)||ct(U)||ze(U)||Be(U)||Dn(U)||W(U)||I(U)||T(U)||Ze(U)||ne(U)||Zt(U)||ht(U)||at(U)));(qu[ye]||Ie||de.imageName)&&b.push(lp(q+1,B,C,b,Yf(ye,t.getCharCode(q+1),Ie&&M),!1))}}var U;return zd(lp(t.length(),B,C,b,0,!0))}function Ud(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Wu(t,e,i,s,h){if(!(e||i||s||h))return;const f=t.length-1,y=t[f],b=(y.x+y.metrics.advance*y.scale)*e;for(let C=0;C<=f;C++)t[C].x-=b,t[C].y+=i+s+h}function Dg(t,e,i){const{horizontalAlign:s,verticalAlign:h}=Ud(i),f=e[0]-t.displaySize[0]*s,y=e[1]-t.displaySize[1]*h;return{image:t,top:y,bottom:y+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function cp(t,e,i,s,h,f){const y=t.image;let b;if(y.content){const Ue=y.content,Qe=y.pixelRatio||1;b=[Ue[0]/Qe,Ue[1]/Qe,y.displaySize[0]-Ue[2]/Qe,y.displaySize[1]-Ue[3]/Qe]}const C=e.left*f,M=e.right*f;let B,U,q,de;"width"===i||"both"===i?(de=h[0]+C-s[3],U=h[0]+M+s[1]):(de=h[0]+(C+M-y.displaySize[0])/2,U=de+y.displaySize[0]);const ye=e.top*f,Ie=e.bottom*f;return"height"===i||"both"===i?(B=h[1]+ye-s[0],q=h[1]+Ie+s[2]):(B=h[1]+(ye+Ie-y.displaySize[1])/2,q=B+y.displaySize[1]),{image:y,top:B,right:U,bottom:q,left:de,collisionPadding:b}}class cc extends ${constructor(e,i,s,h,f){super(e,i),this.angle=h,this.z=s,void 0!==f&&(this.segment=f)}clone(){return new cc(this.x,this.y,this.z,this.angle,this.segment)}}function up(t,e,i,s,h){if(void 0===e.segment)return!0;let f=e,y=e.segment+1,b=0;for(;b>-i/2;){if(y--,y<0)return!1;b-=t[y].dist(f),f=t[y]}b+=t[y].dist(t[y+1]),y++;const C=[];let M=0;for(;b<i/2;){const B=t[y],U=t[y+1];if(!U)return!1;let q=t[y-1].angleTo(B)-B.angleTo(U);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:b,angleDelta:q}),M+=q;b-C[0].distance>s;)M-=C.shift().angleDelta;if(M>h)return!1;y++,b+=B.dist(U)}return!0}function dp(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Jf(t,e,i){return t?.6*e*i:0}function hp(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Ig(t,e,i,s,h,f){const y=Jf(i,h,f),b=hp(i,s)*f;let C=0;const M=dp(t)/2;for(let B=0;B<t.length-1;B++){const U=t[B],q=t[B+1],de=U.dist(q);if(C+de>M){const ye=(M-C)/de,Ie=br(U.x,q.x,ye),Ue=br(U.y,q.y,ye),Qe=new cc(Ie,Ue,0,q.angleTo(U),B);return!y||up(t,Qe,b,y,e)?Qe:void 0}C+=de}}function Mg(t,e,i,s,h,f,y,b,C){const M=Jf(s,f,y),B=hp(s,h),U=B*y,q=0===t[0].x||t[0].x===C||0===t[0].y||t[0].y===C;return e-U<e/4&&(e=U+e/4),Ys(t,q?e/2*b%e:(B/2+2*f)*y*b%e,e,M,i,U,q,!1,C)}function Ys(t,e,i,s,h,f,y,b,C){const M=f/2,B=dp(t);let U=0,q=e-i,de=[];for(let ye=0;ye<t.length-1;ye++){const Ie=t[ye],Ue=t[ye+1],Qe=Ie.dist(Ue),pt=Ue.angleTo(Ie);for(;q+i<U+Qe;){q+=i;const Tt=(q-U)/Qe,Pt=br(Ie.x,Ue.x,Tt),Ft=br(Ie.y,Ue.y,Tt);if(Pt>=0&&Pt<C&&Ft>=0&&Ft<C&&q-M>=0&&q+M<=B){const Bt=new cc(Pt,Ft,0,pt,ye);Bt._round(),s&&!up(t,Bt,f,s,h)||de.push(Bt)}}U+=Qe}return b||de.length||y||(de=Ys(t,U/2,i,s,h,f,y,!0,C)),de}function Xf(t,e,i,s,h){const f=[];for(let y=0;y<t.length;y++){const b=t[y];let C;for(let M=0;M<b.length-1;M++){let B=b[M],U=b[M+1];B.x<e&&U.x<e||(B.x<e?B=new $(e,B.y+(e-B.x)/(U.x-B.x)*(U.y-B.y))._round():U.x<e&&(U=new $(e,B.y+(e-B.x)/(U.x-B.x)*(U.y-B.y))._round()),B.y<i&&U.y<i||(B.y<i?B=new $(B.x+(i-B.y)/(U.y-B.y)*(U.x-B.x),i)._round():U.y<i&&(U=new $(B.x+(i-B.y)/(U.y-B.y)*(U.x-B.x),i)._round()),B.x>=s&&U.x>=s||(B.x>=s?B=new $(s,B.y+(s-B.x)/(U.x-B.x)*(U.y-B.y))._round():U.x>=s&&(U=new $(s,B.y+(s-B.x)/(U.x-B.x)*(U.y-B.y))._round()),B.y>=h&&U.y>=h||(B.y>=h?B=new $(B.x+(h-B.y)/(U.y-B.y)*(U.x-B.x),h)._round():U.y>=h&&(U=new $(B.x+(h-B.y)/(U.y-B.y)*(U.x-B.x),h)._round()),C&&B.equals(C[C.length-1])||(C=[B],f.push(C)),C.push(U)))))}}return f}Kn("Anchor",cc);const Yu=1e20;function Ag(t,e,i,s,h,f,y,b,C){for(let M=e;M<e+s;M++)Sg(t,i*f+M,f,h,y,b,C);for(let M=i;M<i+h;M++)Sg(t,M*f+e,1,s,y,b,C)}function Sg(t,e,i,s,h,f,y){f[0]=0,y[0]=-Yu,y[1]=Yu,h[0]=t[e];for(let b=1,C=0,M=0;b<s;b++){h[b]=t[e+b*i];const B=b*b;do{const U=f[C];M=(h[b]-h[U]+B-U*U)/(b-U)/2}while(M<=y[C]&&--C>-1);C++,f[C]=b,y[C]=M,y[C+1]=Yu}for(let b=0,C=0;b<s;b++){for(;y[C+1]<b;)C++;const M=f[C],B=b-M;t[e+b*i]=h[M]+B*B}}const Zd={none:0,ideographs:1,all:2};class Ju{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const s=[];for(const h in e)for(const f of e[h])s.push({stack:h,id:f});xi(s,({stack:h,id:f},y)=>{let b=this.entries[h];b||(b=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=b.glyphs[f];if(void 0!==C)return void y(null,{stack:h,id:f,glyph:C});if(C=this._tinySDF(b,h,f),C)return b.glyphs[f]=C,void y(null,{stack:h,id:f,glyph:C});const M=Math.floor(f/256);if(256*M>65535)return void y(new Error("glyphs > 65535 not supported"));if(b.ranges[M])return void y(null,{stack:h,id:f,glyph:C});let B=b.requests[M];B||(B=b.requests[M]=[],Ju.loadGlyphRange(h,M,this.url,this.requestManager,(U,q)=>{if(q){b.ascender=q.ascender,b.descender=q.descender;for(const de in q.glyphs)this._doesCharSupportLocalGlyph(+de)||(b.glyphs[+de]=q.glyphs[+de]);b.ranges[M]=!0}for(const de of B)de(U,q);delete b.requests[M]})),B.push((U,q)=>{U?y(U):q&&y(null,{stack:h,id:f,glyph:q.glyphs[f]||null})})},(h,f)=>{if(h)i(h);else if(f){const y={};for(const{stack:b,id:C,glyph:M}of f)void 0===y[b]&&(y[b]={}),void 0===y[b].glyphs&&(y[b].glyphs={}),y[b].glyphs[C]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;i(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Zd.none&&(this.localGlyphMode===Zd.all?!!this.localFontFamily:!!this.localFontFamily&&(ze(e)||rt(e)||W(e)||ne(e))||k(e))}_tinySDF(e,i,s){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(s))return;let f=e.tinySDF;if(!f){let Ie="400";/bold/i.test(i)?Ie="900":/medium/i.test(i)?Ie="500":/light/i.test(i)&&(Ie="200"),f=e.tinySDF=new Ju.TinySDF({fontFamily:h,fontWeight:Ie,fontSize:48,buffer:6,radius:16}),f.fontWeight=Ie}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const y=String.fromCharCode(s),{data:b,width:C,height:M,glyphWidth:B,glyphHeight:U,glyphLeft:q,glyphTop:de,glyphAdvance:ye}=f.draw(y);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new gl({width:C,height:M},b),metrics:{width:B/2,height:U/2,left:q/2,top:de/2-27,advance:ye/2,localGlyph:!0}}}}function Kf(t,e,i,s){const h=[],f=t.image,y=f.pixelRatio,b=f.paddedRect.w-2,C=f.paddedRect.h-2,M=t.right-t.left,B=t.bottom-t.top,U=f.stretchX||[[0,b]],q=f.stretchY||[[0,C]],de=(gn,Fn)=>gn+Fn[1]-Fn[0],ye=U.reduce(de,0),Ie=q.reduce(de,0),Ue=b-ye,Qe=C-Ie;let pt=0,Tt=ye,Pt=0,Ft=Ie,Bt=0,vn=Ue,mn=0,jn=Qe;if(f.content&&s){const gn=f.content;pt=fu(U,0,gn[0]),Pt=fu(q,0,gn[1]),Tt=fu(U,gn[0],gn[2]),Ft=fu(q,gn[1],gn[3]),Bt=gn[0]-pt,mn=gn[1]-Pt,vn=gn[2]-gn[0]-Tt,jn=gn[3]-gn[1]-Ft}const kn=(gn,Fn,Yn,wn)=>{const Qn=Vd(gn.stretch-pt,Tt,M,t.left),li=$d(gn.fixed-Bt,vn,gn.stretch,ye),vr=Vd(Fn.stretch-Pt,Ft,B,t.top),Kr=$d(Fn.fixed-mn,jn,Fn.stretch,Ie),fr=Vd(Yn.stretch-pt,Tt,M,t.left),Tr=$d(Yn.fixed-Bt,vn,Yn.stretch,ye),Pn=Vd(wn.stretch-Pt,Ft,B,t.top),kr=$d(wn.fixed-mn,jn,wn.stretch,Ie),Sr=new $(Qn,vr),So=new $(fr,vr),wo=new $(fr,Pn),Ko=new $(Qn,Pn),fs=new $(li/y,Kr/y),Fr=new $(Tr/y,kr/y),mr=e*Math.PI/180;if(mr){const Po=Math.sin(mr),Do=Math.cos(mr),ms=[Do,-Po,Po,Do];Sr._matMult(ms),So._matMult(ms),Ko._matMult(ms),wo._matMult(ms)}const po=gn.stretch+gn.fixed,To=Fn.stretch+Fn.fixed;return{tl:Sr,tr:So,bl:Ko,br:wo,tex:{x:f.paddedRect.x+1+po,y:f.paddedRect.y+1+To,w:Yn.stretch+Yn.fixed-po,h:wn.stretch+wn.fixed-To},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fs,pixelOffsetBR:Fr,minFontScaleX:vn/y/M,minFontScaleY:jn/y/B,isSDF:i}};if(s&&(f.stretchX||f.stretchY)){const gn=pp(U,Ue,ye),Fn=pp(q,Qe,Ie);for(let Yn=0;Yn<gn.length-1;Yn++){const wn=gn[Yn],Qn=gn[Yn+1];for(let li=0;li<Fn.length-1;li++)h.push(kn(wn,Fn[li],Qn,Fn[li+1]))}}else h.push(kn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:C+1}));return h}function fu(t,e,i){let s=0;for(const h of t)s+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return s}function pp(t,e,i){const s=[{fixed:-1,stretch:0}];for(const[h,f]of t){const y=s[s.length-1];s.push({fixed:h-y.stretch,stretch:y.stretch}),s.push({fixed:h-y.stretch,stretch:y.stretch+(f-h)})}return s.push({fixed:e+1,stretch:i}),s}function Vd(t,e,i,s){return t/e*i+s}function $d(t,e,i,s){return t-e*i/s}function Pg(t,e,i,s){const h=e+t.positionedLines[s].lineOffset;return 0===s?i+h/2:i+(h+(e+t.positionedLines[s-1].lineOffset))/2}Ju.loadGlyphRange=function(t,e,i,s,h){const f=256*e,y=f+255,b=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${f}-${y}`),ao.Glyphs);Lr(b,(C,M)=>{if(C)h(C);else if(M){const B={},U=new Uc(M).readFields(qf,{});for(const q of U.glyphs)B[q.id]=q;h(null,{glyphs:B,ascender:U.ascender,descender:U.descender})}})},Ju.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:y="normal"}){this.buffer=e,this.cutoff=s,this.radius=i;const b=this.size=t+4*e,C=this._createCanvas(b),M=this.ctx=C.getContext("2d",{willReadFrequently:!0});M.font=`${y} ${f} ${t}px ${h}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(t),y=Math.floor(i),b=Math.min(this.size-this.buffer,Math.ceil(f-h)),C=Math.min(this.size-this.buffer,Math.ceil(i)+Math.ceil(s)),M=b+2*this.buffer,B=C+2*this.buffer,U=M*B,q=new Uint8ClampedArray(U),de={data:q,width:M,height:B,glyphWidth:b,glyphHeight:C,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(0===b||0===C)return de;const{ctx:ye,buffer:Ie,gridInner:Ue,gridOuter:Qe}=this;ye.clearRect(Ie,Ie,b,C),ye.fillText(t,Ie,Ie+y+1);const pt=ye.getImageData(Ie,Ie,b,C);Qe.fill(Yu,0,U),Ue.fill(0,0,U);for(let Tt=0;Tt<C;Tt++)for(let Pt=0;Pt<b;Pt++){const Ft=pt.data[4*(Tt*b+Pt)+3]/255;if(0===Ft)continue;const Bt=(Tt+Ie)*M+Pt+Ie;if(1===Ft)Qe[Bt]=0,Ue[Bt]=Yu;else{const vn=.5-Ft;Qe[Bt]=vn>0?vn*vn:0,Ue[Bt]=vn<0?vn*vn:0}}Ag(Qe,0,0,M,B,M,this.f,this.v,this.z),Ag(Ue,Ie,Ie,b,C,M,this.f,this.v,this.z);for(let Tt=0;Tt<U;Tt++){const Pt=Math.sqrt(Qe[Tt])-Math.sqrt(Ue[Tt]);q[Tt]=Math.round(255-255*(Pt/this.radius+this.cutoff))}return de}};class Qf{constructor(e=[],i=Og){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,h=i[e];for(;e>0;){const f=e-1>>1,y=i[f];if(s(h,y)>=0)break;i[e]=y,e=f}i[e]=h}_down(e){const{data:i,compare:s}=this,h=this.length>>1,f=i[e];for(;e<h;){let y=1+(e<<1),b=i[y];const C=y+1;if(C<this.length&&s(i[C],b)<0&&(y=C,b=i[C]),s(b,f)>=0)break;i[e]=b,e=y}i[e]=f}}function Og(t,e){return t<e?-1:t>e?1:0}function em(t,e=1,i=!1){let s=1/0,h=1/0,f=-1/0,y=-1/0;const b=t[0];for(let de=0;de<b.length;de++){const ye=b[de];(!de||ye.x<s)&&(s=ye.x),(!de||ye.y<h)&&(h=ye.y),(!de||ye.x>f)&&(f=ye.x),(!de||ye.y>y)&&(y=ye.y)}const C=Math.min(f-s,y-h);let M=C/2;const B=new Qf([],Rg);if(0===C)return new $(s,h);for(let de=s;de<f;de+=C)for(let ye=h;ye<y;ye+=C)B.push(new mu(de+M,ye+M,M,t));let U=function(de){let ye=0,Ie=0,Ue=0;const Qe=de[0];for(let pt=0,Tt=Qe.length,Pt=Tt-1;pt<Tt;Pt=pt++){const Ft=Qe[pt],Bt=Qe[Pt],vn=Ft.x*Bt.y-Bt.x*Ft.y;Ie+=(Ft.x+Bt.x)*vn,Ue+=(Ft.y+Bt.y)*vn,ye+=3*vn}return new mu(Ie/ye,Ue/ye,0,de)}(t),q=B.length;for(;B.length;){const de=B.pop();(de.d>U.d||!U.d)&&(U=de,i&&console.log("found best %d after %d probes",Math.round(1e4*de.d)/1e4,q)),de.max-U.d<=e||(M=de.h/2,B.push(new mu(de.p.x-M,de.p.y-M,M,t)),B.push(new mu(de.p.x+M,de.p.y-M,M,t)),B.push(new mu(de.p.x-M,de.p.y+M,M,t)),B.push(new mu(de.p.x+M,de.p.y+M,M,t)),q+=4)}return i&&(console.log(`num probes: ${q}`),console.log(`best distance: ${U.d}`)),U.p}function Rg(t,e){return e.max-t.max}function mu(t,e,i,s){this.p=new $(t,e),this.h=i,this.d=function(h,f){let y=!1,b=1/0;for(let C=0;C<f.length;C++){const M=f[C];for(let B=0,U=M.length,q=U-1;B<U;q=B++){const de=M[B],ye=M[q];de.y>h.y!=ye.y>h.y&&h.x<(ye.x-de.x)*(h.y-de.y)/(ye.y-de.y)+de.x&&(y=!y),b=Math.min(b,_f(h,de,ye))}}return(y?1:-1)*Math.sqrt(b)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const jd=Number.POSITIVE_INFINITY,tm=Math.sqrt(2);function nm(t,e){return e[1]!==jd?function(i,s,h){let f=0,y=0;switch(s=Math.abs(s),h=Math.abs(h),i){case"top-right":case"top-left":case"top":y=h-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-h}switch(i){case"top-right":case"bottom-right":case"right":f=-s;break;case"top-left":case"bottom-left":case"left":f=s}return[f,y]}(t,e[0],e[1]):function(i,s){let h=0,f=0;s<0&&(s=0);const y=s/tm;switch(i){case"top-right":case"top-left":f=y-7;break;case"bottom-right":case"bottom-left":f=7-y;break;case"bottom":f=7-s;break;case"top":f=s-7}switch(i){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=s;break;case"right":h=-s}return[h,f]}(t,e[0])}function yl(t,e,i,s,h,f,y,b,C,M){t.createArrays(),t.tilePixelRatio=ir/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const B=t.layers[0].layout,U=t.layers[0]._unevaluatedLayout._values,q={};if("composite"===t.textSizeData.kind){const{minZoom:Ie,maxZoom:Ue}=t.textSizeData;q.compositeTextSizes=[U["text-size"].possiblyEvaluate(new Ji(Ie),b),U["text-size"].possiblyEvaluate(new Ji(Ue),b)]}if("composite"===t.iconSizeData.kind){const{minZoom:Ie,maxZoom:Ue}=t.iconSizeData;q.compositeIconSizes=[U["icon-size"].possiblyEvaluate(new Ji(Ie),b),U["icon-size"].possiblyEvaluate(new Ji(Ue),b)]}q.layoutTextSize=U["text-size"].possiblyEvaluate(new Ji(C+1),b),q.layoutIconSize=U["icon-size"].possiblyEvaluate(new Ji(C+1),b),q.textMaxSize=U["text-size"].possiblyEvaluate(new Ji(18),b);const de="map"===B.get("text-rotation-alignment")&&"point"!==B.get("symbol-placement"),ye=B.get("text-size");for(const Ie of t.features){const Ue=B.get("text-font").evaluate(Ie,{},b).join(","),Qe=ye.evaluate(Ie,{},b),pt=q.layoutTextSize.evaluate(Ie,{},b),Tt=(q.layoutIconSize.evaluate(Ie,{},b),{horizontal:{},vertical:void 0}),Pt=Ie.text;let Ft,Bt=[0,0];if(Pt){const jn=Pt.toString(),kn=24*B.get("text-letter-spacing").evaluate(Ie,{},b),gn=24*B.get("text-line-height").evaluate(Ie,{},b),Fn=Jt(jn)?kn:0,Yn=B.get("text-anchor").evaluate(Ie,{},b),wn=B.get("text-variable-anchor");if(!wn){const Tr=B.get("text-radial-offset").evaluate(Ie,{},b);Bt=Tr?nm(Yn,[24*Tr,jd]):B.get("text-offset").evaluate(Ie,{},b).map(Pn=>24*Pn)}let Qn=de?"center":B.get("text-justify").evaluate(Ie,{},b);const li=B.get("symbol-placement"),vr="point"===li,Kr="point"===li?24*B.get("text-max-width").evaluate(Ie,{},b):0,fr=Tr=>{t.allowVerticalPlacement&&un(jn)&&(Tt.vertical=Gu(Pt,e,i,h,Ue,Kr,gn,Yn,Tr,Fn,Bt,ca.vertical,!0,li,pt,Qe))};if(!de&&wn){const Tr="auto"===Qn?wn.map(kr=>Xu(kr)):[Qn];let Pn=!1;for(let kr=0;kr<Tr.length;kr++){const Sr=Tr[kr];if(!Tt.horizontal[Sr])if(Pn)Tt.horizontal[Sr]=Tt.horizontal[0];else{const So=Gu(Pt,e,i,h,Ue,Kr,gn,"center",Sr,Fn,Bt,ca.horizontal,!1,li,pt,Qe);So&&(Tt.horizontal[Sr]=So,Pn=1===So.positionedLines.length)}}fr("left")}else{if("auto"===Qn&&(Qn=Xu(Yn)),vr||B.get("text-writing-mode").indexOf("horizontal")>=0||!un(jn)){const Tr=Gu(Pt,e,i,h,Ue,Kr,gn,Yn,Qn,Fn,Bt,ca.horizontal,!1,li,pt,Qe);Tr&&(Tt.horizontal[Qn]=Tr)}fr("point"===li?"left":Qn)}}let vn=!1;if(Ie.icon&&Ie.icon.name){const jn=s[Ie.icon.name];jn&&(Ft=Dg(h[Ie.icon.name],B.get("icon-offset").evaluate(Ie,{},b),B.get("icon-anchor").evaluate(Ie,{},b)),vn=jn.sdf,void 0===t.sdfIcons?t.sdfIcons=jn.sdf:t.sdfIcons!==jn.sdf&&Di("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(jn.pixelRatio!==t.pixelRatio||0!==B.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const mn=fp(Tt.horizontal)||Tt.vertical;t.iconsInText||(t.iconsInText=!!mn&&mn.iconsInText),(mn||Ft)&&Lg(t,Ie,Tt,Ft,s,q,pt,0,Bt,vn,y,b,M)}f&&t.generateCollisionDebugBuffers(C,t.collisionBoxArray)}function Xu(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Lg(t,e,i,s,h,f,y,b,C,M,B,U,q){let de=f.textMaxSize.evaluate(e,{},U);void 0===de&&(de=y);const ye=t.layers[0].layout,Ie=ye.get("icon-offset").evaluate(e,{},U),Ue=fp(i.horizontal)||i.vertical,Qe=y/24,pt=t.tilePixelRatio*de/24,Tt=t.tilePixelRatio*ye.get("symbol-spacing"),Pt=ye.get("text-padding")*t.tilePixelRatio,Ft=ye.get("icon-padding")*t.tilePixelRatio,Bt=fn(ye.get("text-max-angle")),vn="map"===ye.get("text-rotation-alignment")&&"point"!==ye.get("symbol-placement"),mn="map"===ye.get("icon-rotation-alignment")&&"point"!==ye.get("symbol-placement"),jn=ye.get("symbol-placement"),kn=Tt/2,gn=ye.get("icon-text-fit");let Fn;s&&"none"!==gn&&(t.allowVerticalPlacement&&i.vertical&&(Fn=cp(s,i.vertical,gn,ye.get("icon-text-fit-padding"),Ie,Qe)),Ue&&(s=cp(s,Ue,gn,ye.get("icon-text-fit-padding"),Ie,Qe)));const Yn=(wn,Qn,li)=>{if(Qn.x<0||Qn.x>=ir||Qn.y<0||Qn.y>=ir)return;const{x:vr,y:Kr,z:fr}=q.projectTilePoint(Qn.x,Qn.y,li),Tr=new cc(vr,Kr,fr,0,void 0);!function(Pn,kr,Sr,So,wo,Ko,fs,Fr,mr,po,To,Po,Do,ms,Xs,ss,co,Uo,Ks,as,qr,Zo,fo,Ms,qo){const ls=Pn.addToLineVertexArray(kr,So);let gs,vs,Ho,da,Hc,Du,Wc,Bp=0,Cm=0,Np=0,zp=0,od=-1,oh=-1;const wl={};let Up=eu(""),sh=0,sd=0;if(void 0===mr._unevaluatedLayout.getValue("text-radial-offset")?[sh,sd]=mr.layout.get("text-offset").evaluate(qr,{},qo).map(Rs=>24*Rs):(sh=24*mr.layout.get("text-radial-offset").evaluate(qr,{},qo),sd=jd),Pn.allowVerticalPlacement&&wo.vertical){const Rs=wo.vertical;if(Xs)Du=mp(Rs),Fr&&(Wc=mp(Fr));else{const Ls=mr.layout.get("text-rotate").evaluate(qr,{},qo)+90;Ho=Gd(po,Sr,kr,To,Po,Do,Rs,ms,Ls,ss),Fr&&(da=Gd(po,Sr,kr,To,Po,Do,Fr,Uo,Ls))}}if(Ko){const Rs=mr.layout.get("icon-rotate").evaluate(qr,{},qo),Ls="none"!==mr.layout.get("icon-text-fit"),Iu=Kf(Ko,Rs,fo,Ls),lh=Fr?Kf(Fr,Rs,fo,Ls):void 0;vs=Gd(po,Sr,kr,To,Po,Do,Ko,Uo,Rs),Bp=4*Iu.length;const Zp=Pn.iconSizeData;let gc=null;"source"===Zp.kind?(gc=[_l*mr.layout.get("icon-size").evaluate(qr,{},qo)],gc[0]>uc&&Di(`${Pn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Zp.kind&&(gc=[_l*Zo.compositeIconSizes[0].evaluate(qr,{},qo),_l*Zo.compositeIconSizes[1].evaluate(qr,{},qo)],(gc[0]>uc||gc[1]>uc)&&Di(`${Pn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Pn.addSymbols(Pn.icon,Iu,gc,as,Ks,qr,!1,Sr,kr,ls.lineStartIndex,ls.lineLength,-1,Ms,qo),od=Pn.icon.placedSymbolArray.length-1,lh&&(Cm=4*lh.length,Pn.addSymbols(Pn.icon,lh,gc,as,Ks,qr,ca.vertical,Sr,kr,ls.lineStartIndex,ls.lineLength,-1,Ms,qo),oh=Pn.icon.placedSymbolArray.length-1)}for(const Rs in wo.horizontal){const Ls=wo.horizontal[Rs];gs||(Up=eu(Ls.text),Xs?Hc=mp(Ls):gs=Gd(po,Sr,kr,To,Po,Do,Ls,ms,mr.layout.get("text-rotate").evaluate(qr,{},qo),ss));const Iu=1===Ls.positionedLines.length;if(Np+=kg(Pn,Sr,kr,Ls,fs,mr,Xs,qr,ss,ls,wo.vertical?ca.horizontal:ca.horizontalOnly,Iu?Object.keys(wo.horizontal):[Rs],wl,od,Zo,Ms,qo),Iu)break}wo.vertical&&(zp+=kg(Pn,Sr,kr,wo.vertical,fs,mr,Xs,qr,ss,ls,ca.vertical,["vertical"],wl,oh,Zo,Ms,qo));let Tl=-1;const ah=(Rs,Ls)=>Rs?Math.max(Rs,Ls):Ls;Tl=ah(Hc,Tl),Tl=ah(Du,Tl),Tl=ah(Wc,Tl);const Em=Tl>-1?1:0;Pn.glyphOffsetArray.length>=vl.MAX_GLYPHS&&Di("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==qr.sortKey&&Pn.addToSortKeyRanges(Pn.symbolInstances.length,qr.sortKey),Pn.symbolInstances.emplaceBack(Sr.x,Sr.y,Sr.z,kr.x,kr.y,wl.right>=0?wl.right:-1,wl.center>=0?wl.center:-1,wl.left>=0?wl.left:-1,wl.vertical>=0?wl.vertical:-1,od,oh,Up,void 0!==gs?gs:Pn.collisionBoxArray.length,void 0!==gs?gs+1:Pn.collisionBoxArray.length,void 0!==Ho?Ho:Pn.collisionBoxArray.length,void 0!==Ho?Ho+1:Pn.collisionBoxArray.length,void 0!==vs?vs:Pn.collisionBoxArray.length,void 0!==vs?vs+1:Pn.collisionBoxArray.length,da||Pn.collisionBoxArray.length,da?da+1:Pn.collisionBoxArray.length,To,Np,zp,Bp,Cm,Em,0,sh,sd,Tl)}(t,Qn,Tr,wn,i,s,h,Fn,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Pt,vn,C,0,Ft,mn,Ie,e,f,M,B,U)};if("line"===jn)for(const wn of Xf(e.geometry,0,0,ir,ir)){const Qn=Mg(wn,Tt,Bt,i.vertical||Ue,s,24,pt,t.overscaling,ir);for(const li of Qn){const vr=Ue;vr&&Fg(t,vr.text,kn,li)||Yn(wn,li,U)}}else if("line-center"===jn){for(const wn of e.geometry)if(wn.length>1){const Qn=Ig(wn,Bt,i.vertical||Ue,s,24,pt);Qn&&Yn(wn,Qn,U)}}else if("Polygon"===e.type)for(const wn of Uu(e.geometry,0)){const Qn=em(wn,16);Yn(wn[0],new cc(Qn.x,Qn.y,0,0,void 0),U)}else if("LineString"===e.type)for(const wn of e.geometry)Yn(wn,new cc(wn[0].x,wn[0].y,0,0,void 0),U);else if("Point"===e.type)for(const wn of e.geometry)for(const Qn of wn)Yn([Qn],new cc(Qn.x,Qn.y,0,0,void 0),U)}const uc=32640;function kg(t,e,i,s,h,f,y,b,C,M,B,U,q,de,ye,Ie,Ue){const Qe=function(Pt,Ft,Bt,vn,mn,jn,kn,gn){const Fn=[];if(0===Ft.positionedLines.length)return Fn;const Yn=vn.layout.get("text-rotate").evaluate(jn,{})*Math.PI/180,wn=function(fr){const Tr=fr[0],Pn=fr[1],kr=Tr*Pn;return kr>0?[Tr,-Pn]:kr<0?[-Tr,Pn]:0===Tr?[Pn,Tr]:[Pn,-Tr]}(Bt);let Qn=Math.abs(Ft.top-Ft.bottom);for(const fr of Ft.positionedLines)Qn-=fr.lineOffset;const li=Ft.positionedLines.length,vr=Qn/li;let Kr=Ft.top-Bt[1];for(let fr=0;fr<li;++fr){const Tr=Ft.positionedLines[fr];Kr=Pg(Ft,vr,Kr,fr);for(const Pn of Tr.positionedGlyphs){if(!Pn.rect)continue;const kr=Pn.rect||{};let Sr=4,So=!0,wo=1,Ko=0;if(Pn.imageName){const fo=kn[Pn.imageName];if(!fo)continue;if(fo.sdf){Di("SDF images are not supported in formatted text and will be ignored.");continue}So=!1,wo=fo.pixelRatio,Sr=1/wo}const fs=(mn||gn)&&Pn.vertical,Fr=Pn.metrics.advance*Pn.scale/2,mr=Pn.metrics,po=Pn.rect;if(null===po)continue;gn&&Ft.verticalizable&&(Ko=Pn.imageName?Fr-Pn.metrics.width*Pn.scale/2:0);const To=mn?[Pn.x+Fr,Pn.y]:[0,0];let Po=[0,0],Do=[0,0],ms=!1;mn||(fs?(Do=[Pn.x+Fr+wn[0],Pn.y+wn[1]-Ko],ms=!0):Po=[Pn.x+Fr+Bt[0],Pn.y+Bt[1]-Ko]);const Xs=po.w*Pn.scale/(wo*(Pn.localGlyph?2:1)),ss=po.h*Pn.scale/(wo*(Pn.localGlyph?2:1));let co,Uo,Ks,as;if(fs){const fo=Pn.y-Kr,Ms=new $(-Fr,Fr-fo),qo=-Math.PI/2,ls=new $(...Do);co=new $(-Fr+Po[0],Po[1]),co._rotateAround(qo,Ms)._add(ls),co.x+=-fo+Fr,co.y-=(mr.left-Sr)*Pn.scale;const gs=Pn.imageName?mr.advance*Pn.scale:24*Pn.scale,vs=String.fromCharCode(Pn.glyph);W_(vs)?co.x+=(1-Sr)*Pn.scale:Zf(vs)?co.x+=gs-mr.height*Pn.scale+(-Sr-1)*Pn.scale:co.x+=Pn.imageName||mr.width+2*Sr===po.w&&mr.height+2*Sr===po.h?(gs-ss)/2:(gs-(mr.height+2*Sr)*Pn.scale)/2,Uo=new $(co.x,co.y-Xs),Ks=new $(co.x+ss,co.y),as=new $(co.x+ss,co.y-Xs)}else{const fo=(mr.left-Sr)*Pn.scale-Fr+Po[0],Ms=(-mr.top-Sr)*Pn.scale+Po[1],qo=fo+Xs,ls=Ms+ss;co=new $(fo,Ms),Uo=new $(qo,Ms),Ks=new $(fo,ls),as=new $(qo,ls)}if(Yn){let fo;fo=mn?new $(0,0):ms?new $(wn[0],wn[1]):new $(Bt[0],Bt[1]),co._rotateAround(Yn,fo),Uo._rotateAround(Yn,fo),Ks._rotateAround(Yn,fo),as._rotateAround(Yn,fo)}const qr=new $(0,0),Zo=new $(0,0);Fn.push({tl:co,tr:Uo,bl:Ks,br:as,tex:kr,writingMode:Ft.writingMode,glyphOffset:To,sectionIndex:Pn.sectionIndex,isSDF:So,pixelOffsetTL:qr,pixelOffsetBR:Zo,minFontScaleX:0,minFontScaleY:0})}}return Fn}(0,s,C,f,y,b,h,t.allowVerticalPlacement),pt=t.textSizeData;let Tt=null;"source"===pt.kind?(Tt=[_l*f.layout.get("text-size").evaluate(b,{},Ue)],Tt[0]>uc&&Di(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===pt.kind&&(Tt=[_l*ye.compositeTextSizes[0].evaluate(b,{},Ue),_l*ye.compositeTextSizes[1].evaluate(b,{},Ue)],(Tt[0]>uc||Tt[1]>uc)&&Di(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,Qe,Tt,C,y,b,B,e,i,M.lineStartIndex,M.lineLength,de,Ie,Ue);for(const Pt of U)q[Pt]=t.text.placedSymbolArray.length-1;return 4*Qe.length}function fp(t){for(const e in t)return t[e];return null}function Gd(t,e,i,s,h,f,y,b,C,M){let B=y.top,U=y.bottom,q=y.left,de=y.right;const ye=y.collisionPadding;if(ye&&(q-=ye[0],B-=ye[1],de+=ye[2],U+=ye[3]),C){const Ie=new $(q,B),Ue=new $(de,B),Qe=new $(q,U),pt=new $(de,U),Tt=fn(C);let Pt=new $(0,0);M&&(Pt=new $(M[0],M[1])),Ie._rotateAround(Tt,Pt),Ue._rotateAround(Tt,Pt),Qe._rotateAround(Tt,Pt),pt._rotateAround(Tt,Pt),q=Math.min(Ie.x,Ue.x,Qe.x,pt.x),de=Math.max(Ie.x,Ue.x,Qe.x,pt.x),B=Math.min(Ie.y,Ue.y,Qe.y,pt.y),U=Math.max(Ie.y,Ue.y,Qe.y,pt.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,q,B,de,U,b,s,h,f),t.length-1}function mp(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Fg(t,e,i,s){const h=t.compareText;if(e in h){const f=h[e];for(let y=f.length-1;y>=0;y--)if(s.dist(f[y])<i)return!0}else h[e]=[];return h[e].push(s),!1}const gp=zc.VectorTileFeature.types,Bg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qd(t,e,i,s,h,f,y,b,C,M,B,U,q,de,ye,Ie){const Ue=B?Math.min(uc,Math.round(B[0])):0,Qe=B?Math.min(uc,Math.round(B[1])):0;t.emplaceBack(e,i,Math.round(32*y),Math.round(32*b),C,M,(Ue<<1)+(U?1:0),Qe,16*q,16*de,256*ye,256*Ie,s,h,f,0)}function gu(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i)}function _p(t){for(const e of t.sections)if(Nn(e.text))return!0;return!1}class yp{constructor(e){this.layoutVertexArray=new rf,this.indexArray=new Ws,this.programConfigurations=e,this.segments=new No,this.dynamicLayoutVertexArray=new Za,this.opacityVertexArray=new Qc,this.placedSymbolArray=new wh}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,i,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,q_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Ld.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Bg,!0),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Kn("SymbolBuffers",yp);class Ku{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new No,this.collisionVertexArray=new hd,this.collisionVertexArrayExt=new Za}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,kd.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,ep.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Kn("CollisionBuffers",Ku);class vl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_e([]),this.placementViewportMatrix=_e([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=np(this.zoom,i["text-size"]),this.iconSizeData=np(this.zoom,i["icon-size"]);const s=this.layers[0].layout,h=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(y=>ca[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new yp(new Pc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new yp(new Pc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new cf,this.lineVertexArray=new uf,this.symbolInstances=new lf}calculateGlyphDependencies(e,i,s,h,f){for(let y=0;y<e.length;y++)if(i[e.charCodeAt(y)]=!0,h&&f){const b=$u[e.charAt(y)];b&&(i[b.charCodeAt(0)]=!0)}}populate(e,i,s,h){const f=this.layers[0],y=f.layout,b=y.get("text-font"),C=y.get("text-field"),M=y.get("icon-image"),B=("constant"!==C.value.kind||C.value.value instanceof Ni&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&("constant"!==b.value.kind||b.value.value.length>0),U="constant"!==M.value.kind||!!M.value.value||Object.keys(M.parameters).length>0,q=y.get("symbol-sort-key");if(this.features=[],!B&&!U)return;const de=i.iconDependencies,ye=i.glyphDependencies,Ie=i.availableImages,Ue=new Ji(this.zoom);for(const{feature:Qe,id:pt,index:Tt,sourceLayerIndex:Pt}of e){const Ft=f._featureFilter.needGeometry,Bt=Nl(Qe,Ft);if(!f._featureFilter.filter(Ue,Bt,s))continue;let vn,mn;if(Ft||(Bt.geometry=Bl(Qe,s,h)),B){const kn=f.getValueAndResolveTokens("text-field",Bt,s,Ie),gn=Ni.factory(kn);_p(gn)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===hs()||this.hasRTLText&&wr.isParsed())&&(vn=H_(gn,f,Bt))}if(U){const kn=f.getValueAndResolveTokens("icon-image",Bt,s,Ie);mn=kn instanceof ro?kn:ro.fromString(kn)}if(!vn&&!mn)continue;const jn=this.sortFeaturesByKey?q.evaluate(Bt,{},s):void 0;if(this.features.push({id:pt,text:vn,icon:mn,index:Tt,sourceLayerIndex:Pt,geometry:Bt.geometry,properties:Qe.properties,type:gp[Qe.type],sortKey:jn}),mn&&(de[mn.name]=!0),vn){const kn=b.evaluate(Bt,{},s).join(","),gn="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ca.vertical)>=0;for(const Fn of vn.sections)if(Fn.image)de[Fn.image.name]=!0;else{const Yn=un(vn.toString()),wn=Fn.fontStack||kn,Qn=ye[wn]=ye[wn]||{};this.calculateGlyphDependencies(Fn.text,Qn,gn,this.allowVerticalPlacement,Yn)}}}"line"===y.get("symbol-placement")&&(this.features=function(Qe){const pt={},Tt={},Pt=[];let Ft=0;function Bt(kn){Pt.push(Qe[kn]),Ft++}function vn(kn,gn,Fn){const Yn=Tt[kn];return delete Tt[kn],Tt[gn]=Yn,Pt[Yn].geometry[0].pop(),Pt[Yn].geometry[0]=Pt[Yn].geometry[0].concat(Fn[0]),Yn}function mn(kn,gn,Fn){const Yn=pt[gn];return delete pt[gn],pt[kn]=Yn,Pt[Yn].geometry[0].shift(),Pt[Yn].geometry[0]=Fn[0].concat(Pt[Yn].geometry[0]),Yn}function jn(kn,gn,Fn){const Yn=Fn?gn[0][gn[0].length-1]:gn[0][0];return`${kn}:${Yn.x}:${Yn.y}`}for(let kn=0;kn<Qe.length;kn++){const gn=Qe[kn],Fn=gn.geometry,Yn=gn.text?gn.text.toString():null;if(!Yn){Bt(kn);continue}const wn=jn(Yn,Fn),Qn=jn(Yn,Fn,!0);if(wn in Tt&&Qn in pt&&Tt[wn]!==pt[Qn]){const li=mn(wn,Qn,Fn),vr=vn(wn,Qn,Pt[li].geometry);delete pt[wn],delete Tt[Qn],Tt[jn(Yn,Pt[vr].geometry,!0)]=vr,Pt[li].geometry=null}else wn in Tt?vn(wn,Qn,Fn):Qn in pt?mn(wn,Qn,Fn):(Bt(kn),pt[wn]=Ft-1,Tt[Qn]=Ft-1)}return Pt.filter(kn=>kn.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Qe,pt)=>Qe.sortKey-pt.sortKey)}update(e,i,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,s,h),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,s,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(void 0!==e.segment){let h=e.dist(i[e.segment+1]),f=e.dist(i[e.segment]);const y={};for(let b=e.segment+1;b<i.length;b++)y[b]={x:i[b].x,y:i[b].y,tileUnitDistanceFromAnchor:h},b<i.length-1&&(h+=i[b+1].dist(i[b]));for(let b=e.segment||0;b>=0;b--)y[b]={x:i[b].x,y:i[b].y,tileUnitDistanceFromAnchor:f},b>0&&(f+=i[b-1].dist(i[b]));for(let b=0;b<i.length;b++){const C=y[b];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,h,f,y,b,C,M,B,U,q,de,ye){const Ie=e.indexArray,Ue=e.layoutVertexArray,Qe=e.segments.prepareSegment(4*i.length,Ue,Ie,this.canOverlap?y.sortKey:void 0),pt=this.glyphOffsetArray.length,Tt=Qe.vertexLength,Pt=this.allowVerticalPlacement&&b===ca.vertical?Math.PI/2:0,Ft=y.text&&y.text.sections;for(let Bt=0;Bt<i.length;Bt++){const{tl:vn,tr:mn,bl:jn,br:kn,tex:gn,pixelOffsetTL:Fn,pixelOffsetBR:Yn,minFontScaleX:wn,minFontScaleY:Qn,glyphOffset:li,isSDF:vr,sectionIndex:Kr}=i[Bt],fr=Qe.vertexLength,Tr=li[1];qd(Ue,C.x,C.y,C.z,M.x,M.y,vn.x,Tr+vn.y,gn.x,gn.y,s,vr,Fn.x,Fn.y,wn,Qn),qd(Ue,C.x,C.y,C.z,M.x,M.y,mn.x,Tr+mn.y,gn.x+gn.w,gn.y,s,vr,Yn.x,Fn.y,wn,Qn),qd(Ue,C.x,C.y,C.z,M.x,M.y,jn.x,Tr+jn.y,gn.x,gn.y+gn.h,s,vr,Fn.x,Yn.y,wn,Qn),qd(Ue,C.x,C.y,C.z,M.x,M.y,kn.x,Tr+kn.y,gn.x+gn.w,gn.y+gn.h,s,vr,Yn.x,Yn.y,wn,Qn),gu(e.dynamicLayoutVertexArray,C,Pt),Ie.emplaceBack(fr,fr+1,fr+2),Ie.emplaceBack(fr+1,fr+2,fr+3),Qe.vertexLength+=4,Qe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(li[0]),Bt!==i.length-1&&Kr===i[Bt+1].sectionIndex||e.programConfigurations.populatePaintArrays(Ue.length,y,y.index,{},de,ye,Ft&&Ft[Kr])}e.placedSymbolArray.emplaceBack(C.x,C.y,C.z,M.x,M.y,pt,this.glyphOffsetArray.length-pt,Tt,B,U,M.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],b,0,!1,0,q,0)}_commitLayoutVertex(e,i,s,h,f,y,b){e.emplaceBack(i,s,h,f,y,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,i,s,h,f,y,b){const C=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),M=C.vertexLength,B=b.tileAnchorX,U=b.tileAnchorY;for(let de=0;de<4;de++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,h,f,y,B,U,new $(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,f,y,B,U,new $(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,f,y,B,U,new $(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,h,f,y,B,U,new $(e.x1,e.y2)),C.vertexLength+=4;const q=s.indexArray;q.emplaceBack(M,M+1),q.emplaceBack(M+1,M+2),q.emplaceBack(M+2,M+3),q.emplaceBack(M+3,M),C.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,h,f,y){for(let b=h;b<f;b++){const C=s.get(b),M=this.getSymbolInstanceTextSize(e,y,i,b);this._addCollisionDebugVertices(C,M,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(e,i,s,h,f,y){for(let b=h;b<f;b++){const C=s.get(b),M=this.getSymbolInstanceIconSize(e,i,b);this._addCollisionDebugVertices(C,M,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,y)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ku(Ru,Fd.members,Ca),this.iconCollisionBox=new Ku(Ru,Fd.members,Ca);const s=du(this.iconSizeData,e),h=du(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const y=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(h,e,i,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(h,e,i,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(s,e,i,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(s,e,i,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,i,s,h){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),y=Bd(this.textSizeData,e,f)/24;return this.tilePixelRatio*y}getSymbolInstanceIconSize(e,i,s){const h=this.icon.placedSymbolArray.get(s),f=Bd(this.iconSizeData,e,h);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,s){e.emplaceBack(i,-s,-s),e.emplaceBack(i,s,-s),e.emplaceBack(i,s,s),e.emplaceBack(i,-s,s)}_updateTextDebugCollisionBoxes(e,i,s,h,f,y){for(let b=h;b<f;b++){const C=s.get(b),M=this.getSymbolInstanceTextSize(e,y,i,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,C.padding)}}_updateIconDebugCollisionBoxes(e,i,s,h,f){for(let y=h;y<f;y++){const b=s.get(y),C=this.getSymbolInstanceIconSize(e,i,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,b.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=du(this.iconSizeData,e),h=du(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const y=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(h,e,i,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(h,e,i,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(s,e,i,y.iconBoxStartIndex,y.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(s,e,i,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,h,f,y,b,C,M){const B={};for(let U=i;U<s;U++){const q=e.get(U);B.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,padding:q.padding,projectedAnchorX:q.projectedAnchorX,projectedAnchorY:q.projectedAnchorY,projectedAnchorZ:q.projectedAnchorZ,tileAnchorX:q.tileAnchorX,tileAnchorY:q.tileAnchorY},B.textFeatureIndex=q.featureIndex;break}for(let U=h;U<f;U++){const q=e.get(U);B.verticalTextBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,padding:q.padding,projectedAnchorX:q.projectedAnchorX,projectedAnchorY:q.projectedAnchorY,projectedAnchorZ:q.projectedAnchorZ,tileAnchorX:q.tileAnchorX,tileAnchorY:q.tileAnchorY},B.verticalTextFeatureIndex=q.featureIndex;break}for(let U=y;U<b;U++){const q=e.get(U);B.iconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,padding:q.padding,projectedAnchorX:q.projectedAnchorX,projectedAnchorY:q.projectedAnchorY,projectedAnchorZ:q.projectedAnchorZ,tileAnchorX:q.tileAnchorX,tileAnchorY:q.tileAnchorY},B.iconFeatureIndex=q.featureIndex;break}for(let U=C;U<M;U++){const q=e.get(U);B.verticalIconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,padding:q.padding,projectedAnchorX:q.projectedAnchorX,projectedAnchorY:q.projectedAnchorY,projectedAnchorZ:q.projectedAnchorZ,tileAnchorX:q.tileAnchorX,tileAnchorY:q.tileAnchorY},B.verticalIconFeatureIndex=q.featureIndex;break}return B}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),h=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<h;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),h=[],f=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const C=this.symbolInstances.get(b);h.push(0|Math.round(i*C.tileAnchorX+s*C.tileAnchorY)),f.push(C.featureIndex)}return y.sort((b,C)=>h[b]-h[C]||f[C]-f[b]),y}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((h,f,y)=>{h>=0&&y.indexOf(h)===f&&this.addIndicesForPlacedSymbol(this.text,h)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Kn("SymbolBucket",vl,{omit:["layers","collisionBoxArray","features","compareText"]}),vl.MAX_GLYPHS=65535,vl.addDynamicAttributes=gu;const im=new os({"symbol-placement":new ai(Ot.layout_symbol["symbol-placement"]),"symbol-spacing":new ai(Ot.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ai(Ot.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ti(Ot.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ai(Ot.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ai(Ot.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ai(Ot.layout_symbol["icon-ignore-placement"]),"icon-optional":new ai(Ot.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ai(Ot.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ti(Ot.layout_symbol["icon-size"]),"icon-text-fit":new ai(Ot.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ai(Ot.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ti(Ot.layout_symbol["icon-image"]),"icon-rotate":new Ti(Ot.layout_symbol["icon-rotate"]),"icon-padding":new ai(Ot.layout_symbol["icon-padding"]),"icon-keep-upright":new ai(Ot.layout_symbol["icon-keep-upright"]),"icon-offset":new Ti(Ot.layout_symbol["icon-offset"]),"icon-anchor":new Ti(Ot.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ai(Ot.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ai(Ot.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ai(Ot.layout_symbol["text-rotation-alignment"]),"text-field":new Ti(Ot.layout_symbol["text-field"]),"text-font":new Ti(Ot.layout_symbol["text-font"]),"text-size":new Ti(Ot.layout_symbol["text-size"]),"text-max-width":new Ti(Ot.layout_symbol["text-max-width"]),"text-line-height":new Ti(Ot.layout_symbol["text-line-height"]),"text-letter-spacing":new Ti(Ot.layout_symbol["text-letter-spacing"]),"text-justify":new Ti(Ot.layout_symbol["text-justify"]),"text-radial-offset":new Ti(Ot.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ai(Ot.layout_symbol["text-variable-anchor"]),"text-anchor":new Ti(Ot.layout_symbol["text-anchor"]),"text-max-angle":new ai(Ot.layout_symbol["text-max-angle"]),"text-writing-mode":new ai(Ot.layout_symbol["text-writing-mode"]),"text-rotate":new Ti(Ot.layout_symbol["text-rotate"]),"text-padding":new ai(Ot.layout_symbol["text-padding"]),"text-keep-upright":new ai(Ot.layout_symbol["text-keep-upright"]),"text-transform":new Ti(Ot.layout_symbol["text-transform"]),"text-offset":new Ti(Ot.layout_symbol["text-offset"]),"text-allow-overlap":new ai(Ot.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ai(Ot.layout_symbol["text-ignore-placement"]),"text-optional":new ai(Ot.layout_symbol["text-optional"])});var vp={paint:new os({"icon-opacity":new Ti(Ot.paint_symbol["icon-opacity"]),"icon-color":new Ti(Ot.paint_symbol["icon-color"]),"icon-halo-color":new Ti(Ot.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ti(Ot.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ti(Ot.paint_symbol["icon-halo-blur"]),"icon-translate":new ai(Ot.paint_symbol["icon-translate"]),"icon-translate-anchor":new ai(Ot.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ti(Ot.paint_symbol["text-opacity"]),"text-color":new Ti(Ot.paint_symbol["text-color"],{runtimeType:Oo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Ti(Ot.paint_symbol["text-halo-color"]),"text-halo-width":new Ti(Ot.paint_symbol["text-halo-width"]),"text-halo-blur":new Ti(Ot.paint_symbol["text-halo-blur"]),"text-translate":new ai(Ot.paint_symbol["text-translate"]),"text-translate-anchor":new ai(Ot.paint_symbol["text-translate-anchor"])}),layout:im};class rm{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:_o,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Kn("FormatSectionOverride",rm,{omit:["defaultValue"]});class _u extends $a{constructor(e){super(e,vp)}recalculate(e,i){super.recalculate(e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const h=[];for(const f of s)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,s,h){const f=this.layout.get(e).evaluate(i,{},s,h),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||$s(y.value)||!f?f:(b=i.properties,f.replace(/{([^{}]+)}/g,(M,B)=>B in b?String(b[B]):""));var b}createBucket(e){return new vl(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of vp.paint.overridableProperties){if(!_u.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new rm(i),h=new Ec(s,i.property.specification);let f=null;f="constant"===i.value.kind||"source"===i.value.kind?new sl("source",h):new Dc("composite",h,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new ps(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&_u.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),h=vp.paint.properties[i];let f=!1;const y=b=>{for(const C of b)if(h.overrides&&h.overrides.hasOverride(C))return void(f=!0)};if("constant"===s.value.kind&&s.value.value instanceof Ni)y(s.value.value.sections);else if("source"===s.value.kind){const b=M=>{f||(M instanceof $o&&Wr(M.value)===Ct?y(M.value.sections):M instanceof Mo?y(M.sections):M.eachChild(b))},C=s.value;C._styleExpression&&b(C._styleExpression.expression)}return f}getProgramConfiguration(e){return new ho(this,e)}}var K_={paint:new os({"background-color":new ai(Ot.paint_background["background-color"]),"background-pattern":new qs(Ot.paint_background["background-pattern"]),"background-opacity":new ai(Ot.paint_background["background-opacity"])})},Ng={paint:new os({"raster-opacity":new ai(Ot.paint_raster["raster-opacity"]),"raster-hue-rotate":new ai(Ot.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ai(Ot.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ai(Ot.paint_raster["raster-brightness-max"]),"raster-saturation":new ai(Ot.paint_raster["raster-saturation"]),"raster-contrast":new ai(Ot.paint_raster["raster-contrast"]),"raster-resampling":new ai(Ot.paint_raster["raster-resampling"]),"raster-fade-duration":new ai(Ot.paint_raster["raster-fade-duration"])})};class om extends $a{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var sm={paint:new os({"sky-type":new ai(Ot.paint_sky["sky-type"]),"sky-atmosphere-sun":new ai(Ot.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ai(Ot.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ai(Ot.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ai(Ot.paint_sky["sky-gradient-radius"]),"sky-gradient":new Hs(Ot.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ai(Ot.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ai(Ot.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ai(Ot.paint_sky["sky-opacity"])})};function Hd(t,e,i){const s=_t(0,0,1),h=qt(Yt());return function(f,y,b){b*=.5;var C=y[0],M=y[1],B=y[2],U=y[3],q=Math.sin(b),de=Math.cos(b);f[0]=C*de-B*q,f[1]=M*de+U*q,f[2]=B*de+C*q,f[3]=U*de-M*q}(h,h,i?-fn(t)+Math.PI:fn(t)),Gt(h,h,-fn(e)),$t(s,s,h),At(s,s)}const am={circle:class extends $a{constructor(t){super(t,j_)}createBucket(t){return new Oh(t)}queryRadius(t){const e=t;return ou("circle-radius",this,e)+ou("circle-stroke-width",this,e)+wd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,s,h,f,y,b){const C=Oc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return ag(t,s,f,y,b,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),C,M)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new ho(this,t)}},heatmap:class extends $a{createBucket(t){return new kh(t)}constructor(t){super(t,Tf),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Cf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return ou("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,s,h,f,y,b){const C=this.paint.get("heatmap-radius").evaluate(e,i);return ag(t,s,f,y,b,!0,!0,new $(0,0),C)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new ho(this,t)}},hillshade:class extends $a{constructor(t){super(t,su)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(t){return new ho(this,t)}},fill:class extends $a{constructor(t){super(t,Of)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new ho(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Pd(t)}queryRadius(){return wd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,s,h,f){return!t.queryGeometry.isAboveHorizon&&gf(bf(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends $a{constructor(t){super(t,yg)}createBucket(t){return new Yh(t)}queryRadius(){return wd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new ho(this,t)}queryIntersectsFeature(t,e,i,s,h,f,y,b,C){const M=Oc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),B=this.paint.get("fill-extrusion-height").evaluate(e,i),U=this.paint.get("fill-extrusion-base").evaluate(e,i),q=[0,0],de=b&&f.elevation,ye=f.elevation?f.elevation.exaggeration():1;if(de){const Qe=t.tile.getBucket(this).centroidVertexArray,pt=C+1;if(pt<Qe.length){const Tt=Qe.get(pt);q[0]=Tt.a_centroid_pos0,q[1]=Tt.a_centroid_pos1}}if(0===q[0]&&1===q[1])return!1;const Ie=(Qe=s,pt=U,Tt=B,Pt=M,Ft=y,(Bt=de?b:null)?function(kn,gn,Fn,Yn,wn,Qn,li,vr,Kr){const fr=[],Tr=[],Pn=[0,0,0,1];for(const kr of kn){const Sr=[],So=[];for(const wo of kr){const Ko=wo.x+Yn.x,fs=wo.y+Yn.y,Fr=Bf(Ko,fs,gn,Fn,Qn,li,vr,Kr);Pn[0]=Ko,Pn[1]=fs,Pn[2]=Fr.base,Pn[3]=1,Wt(Pn,Pn,wn),Pn[3]=Math.max(Pn[3],1e-5);const mr=Xh([Pn[0]/Pn[3],Pn[1]/Pn[3],Pn[2]/Pn[3]]);Pn[0]=Ko,Pn[1]=fs,Pn[2]=Fr.top,Pn[3]=1,Wt(Pn,Pn,wn),Pn[3]=Math.max(Pn[3],1e-5);const po=Xh([Pn[0]/Pn[3],Pn[1]/Pn[3],Pn[2]/Pn[3]]);Sr.push(mr),So.push(po)}fr.push(Sr),Tr.push(So)}return[fr,Tr]}(Qe,pt,Tt,Pt,Ft,Bt,q,ye,f.center.lat):function(kn,gn,Fn,Yn,wn){const Qn=[],li=[],vr=wn[8]*gn,Kr=wn[9]*gn,fr=wn[10]*gn,Tr=wn[11]*gn,Pn=wn[8]*Fn,kr=wn[9]*Fn,Sr=wn[10]*Fn,So=wn[11]*Fn;for(const wo of kn){const Ko=[],fs=[];for(const Fr of wo){const mr=Fr.x+Yn.x,po=Fr.y+Yn.y,To=wn[0]*mr+wn[4]*po+wn[12],Po=wn[1]*mr+wn[5]*po+wn[13],Do=wn[2]*mr+wn[6]*po+wn[14],ms=wn[3]*mr+wn[7]*po+wn[15],Xs=To+vr,ss=Po+Kr,co=Do+fr,Uo=Math.max(ms+Tr,1e-5),Ks=To+Pn,as=Po+kr,qr=Do+Sr,Zo=Math.max(ms+So,1e-5),fo=new $(Xs/Uo,ss/Uo);fo.z=co/Uo,Ko.push(fo);const Ms=new $(Ks/Zo,as/Zo);Ms.z=qr/Zo,fs.push(Ms)}Qn.push(Ko),li.push(fs)}return[Qn,li]}(Qe,pt,Tt,Pt,Ft)),Ue=t.queryGeometry;var Qe,pt,Tt,Pt,Ft,Bt;return function(Qe,pt,Tt){let Pt=1/0;gf(Tt,pt)&&(Pt=Jh(Tt,pt[0]));for(let Ft=0;Ft<pt.length;Ft++){const Bt=pt[Ft],vn=Qe[Ft];for(let mn=0;mn<Bt.length-1;mn++){const jn=Bt[mn],kn=[jn,Bt[mn+1],vn[mn+1],vn[mn],jn];iu(Tt,kn)&&(Pt=Math.min(Pt,Jh(Tt,kn)))}}return Pt!==1/0&&Pt}(Ie[0],Ie[1],Ue.isPointQuery()?Ue.screenBounds:Ue.screenGeometry)}},line:class extends $a{constructor(t){super(t,Rd),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Aa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=xg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new uu(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new ho(this,t)}queryRadius(t){const e=t,i=Qh(ou("line-width",this,e),ou("line-gap-width",this,e)),s=ou("line-offset",this,e);return i/2+Math.abs(s)+wd(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,s,h,f){if(t.queryGeometry.isAboveHorizon)return!1;const y=bf(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),b=t.pixelToTileUnitsFactor/2*Qh(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),C=this.paint.get("line-offset").evaluate(e,i);return C&&(s=function(M,B){const U=[],q=new $(0,0);for(let de=0;de<M.length;de++){const ye=M[de],Ie=[];for(let Ue=0;Ue<ye.length;Ue++){const Qe=ye[Ue-1],pt=ye[Ue],Tt=ye[Ue+1],Pt=0===Ue?q:pt.sub(Qe)._unit()._perp(),Ft=Ue===ye.length-1?q:Tt.sub(pt)._unit()._perp(),Bt=Pt._add(Ft)._unit();Bt._mult(1/(Bt.x*Ft.x+Bt.y*Ft.y)),Ie.push(Bt._mult(B)._add(pt))}U.push(Ie)}return U}(s,C*t.pixelToTileUnitsFactor)),function(M,B,U){for(let q=0;q<B.length;q++){const de=B[q];if(M.length>=3)for(let ye=0;ye<de.length;ye++)if(ru(M,de[ye]))return!0;if(og(M,de,U))return!0}return!1}(y,s,b)}isTileClipped(){return!0}},symbol:_u,background:class extends $a{constructor(t){super(t,K_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends $a{constructor(t){super(t,Ng)}getProgramIds(){return["raster"]}},sky:class extends $a{constructor(t){super(t,sm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Cf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(t,e){const i=this.paint.get("sky-type");if("atmosphere"===i){const s=this.paint.get("sky-atmosphere-sun"),h=!s,f=t.style.light,y=f.properties.get("position");return h&&"viewport"===f.properties.get("anchor")&&Di("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Hd(y.azimuthal,90-y.polar,e):Hd(s[0],90-s[1],e)}if("gradient"===i){const s=this.paint.get("sky-gradient-center");return Hd(s[0],90-s[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}},{HTMLImageElement:xp,HTMLCanvasElement:xl,HTMLVideoElement:Qu,ImageData:lm,ImageBitmap:Wd}=V;class bp{constructor(e,i,s,h){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(i,h)}update(e,i,s){const{width:h,height:f}=e,{context:y}=this,{gl:b}=y;if(b.bindTexture(b.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!i||!1!==i.premultiply)),s||this.size&&this.size[0]===h&&this.size[1]===f){const{x:C,y:M}=s||{x:0,y:0};e instanceof xp||e instanceof xl||e instanceof Qu||e instanceof lm||Wd&&e instanceof Wd?b.texSubImage2D(b.TEXTURE_2D,0,C,M,b.RGBA,b.UNSIGNED_BYTE,e):b.texSubImage2D(b.TEXTURE_2D,0,C,M,h,f,b.RGBA,b.UNSIGNED_BYTE,e.data)}else this.size=[h,f],e instanceof xp||e instanceof xl||e instanceof Qu||e instanceof lm||Wd&&e instanceof Wd?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,e):b.texImage2D(b.TEXTURE_2D,0,this.format,h,f,0,this.format,b.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(e,i){const{context:s}=this,{gl:h}=s;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class ed{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new gl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=Pe(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const h=[];let f=e.length%2==1?-e[e.length-1]*s:0,y=e[0]*s,b=!0;h.push({left:f,right:y,isDash:b,zeroLength:0===e[0]});let C=e[0];for(let M=1;M<e.length;M++){b=!b;const B=e[M];f=C*s,C+=B,y=C*s,h.push({left:f,right:y,isDash:b,zeroLength:0===B})}return h}addRoundDash(e,i,s){const h=i/2;for(let f=-s;f<=s;f++){const y=this.width*(this.nextRow+s+f);let b=0,C=e[b];for(let M=0;M<this.width;M++){M/C.right>1&&(C=e[++b]);const B=Math.abs(M-C.left),U=Math.abs(M-C.right),q=Math.min(B,U);let de;const ye=f/s*(h+1);if(C.isDash){const Ie=h-Math.abs(ye);de=Math.sqrt(q*q+Ie*Ie)}else de=h-Math.sqrt(q*q+ye*ye);this.image.data[y+M]=Math.max(0,Math.min(255,de+128))}}}addRegularDash(e,i){for(let C=e.length-1;C>=0;--C){const M=e[C],B=e[C+1];M.zeroLength?e.splice(C,1):B&&B.isDash===M.isDash&&(B.left=M.left,e.splice(C,1))}const s=e[0],h=e[e.length-1];s.isDash===h.isDash&&(s.left=h.left-this.width,h.right=s.right+this.width);const f=this.width*this.nextRow;let y=0,b=e[y];for(let C=0;C<this.width;C++){C/b.right>1&&(b=e[++y]);const M=Math.abs(C-b.left),B=Math.abs(C-b.right),U=Math.min(M,B);this.image.data[f+C]=Math.max(0,Math.min(255,(b.isDash?U:-U)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const h="round"===i,f=h?7:0,y=2*f+1;if(this.nextRow+y>this.height)return Di("LineAtlas out of space"),null;0===e.length&&e.push(1);let b=0;for(let B=0;B<e.length;B++)e[B]<0&&(Di("Negative value is found in line dasharray, replacing values with 0"),e[B]=0),b+=e[B];if(0!==b){const B=this.width/b,U=this.getDashRanges(e,this.width,B);h?this.addRoundDash(U,B,f):this.addRegularDash(U,"square"===i?.5*B:0)}const C=this.nextRow+f;this.nextRow+=y;const M={tl:[C,f],br:[b,0]};return this.positions[s]=M,M}}Kn("LineAtlas",ed);class cm{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const wp=V.performance;function yu(t){const e=t?t.url.toString():void 0;return wp.getEntriesByName(e)}class zg{constructor(){this.tasks={},this.taskQueue=[],me(["process"],this),this.invoker=new cm(this.process),this.nextId=0}add(e,i){const s=this.nextId++,h=function({type:f,isSymbolTile:y,zoom:b}){return b=b||0,"message"===f?0:"maybePrepare"!==f||y?"parseTile"!==f||y?"parseTile"===f&&y?300-b:"maybePrepare"===f&&y?400-b:500:200-b:100-b}(i);if(0===h){Cr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:i,priority:h,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){Cr();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const f=this.tasks[this.taskQueue[h]];f.priority<i&&(i=f.priority,e=h)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}function Yd(t,e,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[t*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class td{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=nd(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const s=(y=this.y,b=this.z,C=Yd(256*(f=this.x),256*(y=Math.pow(2,b)-y-1),b),M=Yd(256*(f+1),256*(y+1),b),C[0]+","+C[1]+","+M[0]+","+M[1]),h=function(f,y,b){let C,M="";for(let B=f;B>0;B--)C=1<<B-1,M+=(y&C?1:0)+(b&C?2:0);return M}(this.z,this.x,this.y);var f,y,b,C,M;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Jd{constructor(e,i){this.wrap=e,this.canonical=i,this.key=nd(e,i.z,i.z,i.x,i.y)}}class Es{constructor(e,i,s,h,f){this.overscaledZ=e,this.wrap=i,this.canonical=new td(s,+h,+f),this.key=0===i&&e===s?this.canonical.key:nd(i,e,s,h,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Es(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Es(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return nd(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return nd(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Es(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new Es(i,this.wrap,i,s,h),new Es(i,this.wrap,i,s+1,h),new Es(i,this.wrap,i,s,h+1),new Es(i,this.wrap,i,s+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Es(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Es(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Jd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function nd(t,e,i,s,h){const f=1<<Math.min(i,22);let y=f*(h%f)+s%f;return t&&i<22&&(y+=f*f*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*y+i)+(e-i)}Kn("CanonicalTileID",td),Kn("OverscaledTileID",Es,{omit:["projMatrix"]});class dc{constructor(e,i,s){this.func=e,this.mask=i,this.range=s}}dc.ReadOnly=!1,dc.ReadWrite=!0,dc.disabled=new dc(519,dc.ReadOnly,[0,1]);class Cp{constructor(e,i,s,h,f,y){this.test=e,this.ref=i,this.mask=s,this.fail=h,this.depthFail=f,this.pass=y}}Cp.disabled=new Cp({func:519,mask:0},0,0,7680,7680,7680);class Wa{constructor(e,i,s){this.blendFunction=e,this.blendColor=i,this.mask=s}}Wa.Replace=[1,0],Wa.disabled=new Wa(Wa.Replace,Bi.transparent,[!1,!1,!1,!1]),Wa.unblended=new Wa(Wa.Replace,Bi.transparent,[!0,!0,!0,!0]),Wa.alphaBlended=new Wa([1,771],Bi.transparent,[!0,!0,!0,!0]);class Ya{constructor(e,i,s){this.enable=e,this.mode=i,this.frontFace=s}}Ya.disabled=new Ya(!1,1029,2305),Ya.backCCW=new Ya(!0,1029,2305),Ya.backCW=new Ya(!0,1029,2304),Ya.frontCW=new Ya(!0,1028,2304),Ya.frontCCW=new Ya(!0,1028,2305);class um{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Vc{constructor(e,i,s,h,f){this.type="Feature",this._vectorTileFeature=e,e._z=i,e._x=s,e._y=h,this.properties=e.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)"_geometry"!==i&&"_vectorTileFeature"!==i&&(e[i]=this[i]);return e}}class Ug{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,s){const h=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},Ye(this.stateChanges[e][h],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const f in this.state[e])f!==h&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][h]){this.deletedStates[e][h]={};for(const f in this.state[e][h])s[f]||(this.deletedStates[e][h][f]=null)}else for(const f in s)this.deletedStates[e]&&this.deletedStates[e][h]&&null===this.deletedStates[e][h][f]&&delete this.deletedStates[e][h][f]}removeFeatureState(e,i,s){if(null===this.deletedStates[e])return;const h=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==i)null!==this.deletedStates[e][h]&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][s]=null);else if(void 0!==i)if(this.stateChanges[e]&&this.stateChanges[e][h])for(s in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][s]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,i){const s=String(i),h=Ye({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const f=this.deletedStates[e][i];if(null===f)return{};for(const y in f)delete h[y]}return h}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const s={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const f={};for(const y in this.stateChanges[h])this.state[h][y]||(this.state[h][y]={}),Ye(this.state[h][y],this.stateChanges[h][y]),f[y]=this.state[h][y];s[h]=f}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const f={};if(null===this.deletedStates[h])for(const y in this.state[h])f[y]={},this.state[h][y]={};else for(const y in this.deletedStates[h]){if(null===this.deletedStates[h][y])this.state[h][y]={};else for(const b of Object.keys(this.deletedStates[h][y]))delete this.state[h][y][b];f[y]=this.state[h][y]}s[h]=s[h]||{},Ye(s[h],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const h in e)e[h].setFeatureState(s,i)}}class dm{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function hm(t,e,i,s){let h=0,f=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(s[y])<1e-15){if(i[y]<t[y]||i[y]>e[y])return null}else{const b=1/s[y];let C=(t[y]-i[y])*b,M=(e[y]-i[y])*b;if(C>M){const B=C;C=M,M=B}if(C>h&&(h=C),M<f&&(f=M),h>f)return null}return h}function pm(t,e,i,s,h,f,y,b,C,M,B){const U=s-t,q=h-e,de=f-i,ye=y-t,Ie=b-e,Ue=C-i,Qe=B[1]*Ue-B[2]*Ie,pt=B[2]*ye-B[0]*Ue,Tt=B[0]*Ie-B[1]*ye,Pt=U*Qe+q*pt+de*Tt;if(Math.abs(Pt)<1e-15)return null;const Ft=1/Pt,Bt=M[0]-t,vn=M[1]-e,mn=M[2]-i,jn=(Bt*Qe+vn*pt+mn*Tt)*Ft;if(jn<0||jn>1)return null;const kn=vn*de-mn*q,gn=mn*U-Bt*de,Fn=Bt*q-vn*U,Yn=(B[0]*kn+B[1]*gn+B[2]*Fn)*Ft;return Yn<0||jn+Yn>1?null:(ye*kn+Ie*gn+Ue*Fn)*Ft}function ua(t,e,i){return(t-e)/(i-e)}function Kd(t,e,i,s,h,f,y,b,C){const M=1<<i,B=f-s,U=y-h,q=(t+1)/M*B+s,de=(e+0)/M*U+h,ye=(e+1)/M*U+h;b[0]=(t+0)/M*B+s,b[1]=de,C[0]=q,C[1]=ye}class Ep{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const y=Math.ceil(Math.log2(f.dim/8)),b=[];let C=Math.ceil(Math.pow(2,y));const M=1/C,B=(de,ye,Ie,Ue,Qe)=>{const pt=Ue?1:0,Tt=(de+1)*Ie-pt,Pt=ye*Ie,Ft=(ye+1)*Ie-pt;Qe[0]=de*Ie,Qe[1]=Pt,Qe[2]=Tt,Qe[3]=Ft};let U=new dm(C);const q=[];for(let de=0;de<C*C;de++){B(de%C,Math.floor(de/C),M,!1,q);const ye=$l(q[0],q[1],f),Ie=$l(q[2],q[1],f),Ue=$l(q[2],q[3],f),Qe=$l(q[0],q[3],f);U.minimums.push(Math.min(ye,Ie,Ue,Qe)),U.maximums.push(Math.max(ye,Ie,Ue,Qe)),U.leaves.push(1)}for(b.push(U),C/=2;C>=1;C/=2){const de=b[b.length-1];U=new dm(C);for(let ye=0;ye<C*C;ye++){B(ye%C,Math.floor(ye/C),2,!0,q);const Ie=de.getElevation(q[0],q[1]),Ue=de.getElevation(q[2],q[1]),Qe=de.getElevation(q[2],q[3]),pt=de.getElevation(q[0],q[3]),Tt=de.isLeaf(q[0],q[1]),Pt=de.isLeaf(q[2],q[1]),Ft=de.isLeaf(q[2],q[3]),Bt=de.isLeaf(q[0],q[3]),vn=Math.min(Ie.min,Ue.min,Qe.min,pt.min),mn=Math.max(Ie.max,Ue.max,Qe.max,pt.max),jn=Tt&&Pt&&Ft&&Bt;U.maximums.push(mn),U.minimums.push(vn),U.leaves.push(mn-vn<=5&&jn?1:0)}b.push(U)}return b}(this.dem),s=i.length-1,h=i[s];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,h,f,y,b=1){return hm([e,i,-100],[s,h,this.maximums[0]*b],f,y)}raycast(e,i,s,h,f,y,b=1){if(!this.nodeCount)return null;const C=this.raycastRoot(e,i,s,h,f,y,b);if(null==C)return null;const M=[],B=[],U=[],q=[],de=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;de.length>0;){const{idx:ye,t:Ie,nodex:Ue,nodey:Qe,depth:pt}=de.pop();if(this.leaves[ye]){Kd(Ue,Qe,pt,e,i,s,h,U,q);const Pt=1<<pt,Ft=(Ue+0)/Pt,Bt=(Ue+1)/Pt,vn=(Qe+0)/Pt,mn=(Qe+1)/Pt,jn=$l(Ft,vn,this.dem)*b,kn=$l(Bt,vn,this.dem)*b,gn=$l(Bt,mn,this.dem)*b,Fn=$l(Ft,mn,this.dem)*b,Yn=pm(U[0],U[1],jn,q[0],U[1],kn,q[0],q[1],gn,f,y),wn=pm(q[0],q[1],gn,U[0],q[1],Fn,U[0],U[1],jn,f,y),Qn=Math.min(null!==Yn?Yn:Number.MAX_VALUE,null!==wn?wn:Number.MAX_VALUE);if(Qn!==Number.MAX_VALUE)return Qn;{const li=dt([],f,y,Ie);if(Dp(jn,kn,Fn,gn,ua(li[0],U[0],q[0]),ua(li[1],U[1],q[1]))>=li[2])return Ie}continue}let Tt=0;for(let Pt=0;Pt<this._siblingOffset.length;Pt++){Kd((Ue<<1)+this._siblingOffset[Pt][0],(Qe<<1)+this._siblingOffset[Pt][1],pt+1,e,i,s,h,U,q),U[2]=-100,q[2]=this.maximums[this.childOffsets[ye]+Pt]*b;const Ft=hm(U,q,f,y);if(null!=Ft){const Bt=Ft;M[Pt]=Bt;let vn=!1;for(let mn=0;mn<Tt&&!vn;mn++)Bt>=M[B[mn]]&&(B.splice(mn,0,Pt),vn=!0);vn||(B[Tt]=Pt),Tt++}}for(let Pt=0;Pt<Tt;Pt++){const Ft=B[Pt];de.push({idx:this.childOffsets[ye]+Ft,t:M[Ft],nodex:(Ue<<1)+this._siblingOffset[Ft][0],nodey:(Qe<<1)+this._siblingOffset[Ft][1],depth:pt+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,h,f){if(1===e[h].isLeaf(i,s))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const y=h-1,b=e[y];let C,M=0;for(let B=0;B<this._siblingOffset.length;B++){const U=2*i+this._siblingOffset[B][0],q=2*s+this._siblingOffset[B][1],de=b.getElevation(U,q),ye=b.isLeaf(U,q),Ie=this._addNode(de.min,de.max,ye);ye&&(M|=1<<B),C||(C=Ie)}for(let B=0;B<this._siblingOffset.length;B++)M&1<<B||this._construct(e,2*i+this._siblingOffset[B][0],2*s+this._siblingOffset[B][1],y,C+B)}}function Dp(t,e,i,s,h,f){return br(br(t,i,f),br(e,s,f),h)}function $l(t,e,i){const s=i.dim,h=yi(t*s-.5,0,s-1),f=yi(e*s-.5,0,s-1),y=Math.floor(h),b=Math.floor(f),C=Math.min(y+1,s-1),M=Math.min(b+1,s-1);return Dp(i.get(y,b),i.get(C,b),i.get(y,M),i.get(C,M),h-y,f-b)}const Ip={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Qd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,h=!1,f=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return Di(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const y=this.dim=i.height-2;if(this.data=new Uint32Array(i.data.buffer),this.encoding=s||"mapbox",this.borderReady=h,!h){for(let b=0;b<y;b++)this.data[this._idx(-1,b)]=this.data[this._idx(0,b)],this.data[this._idx(y,b)]=this.data[this._idx(y-1,b)],this.data[this._idx(b,-1)]=this.data[this._idx(b,0)],this.data[this._idx(b,y)]=this.data[this._idx(b,y-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(y,-1)]=this.data[this._idx(y-1,0)],this.data[this._idx(-1,y)]=this.data[this._idx(0,y-1)],this.data[this._idx(y,y)]=this.data[this._idx(y-1,y-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Ep(this)}get(e,i,s=!1){const h=new Uint8Array(this.data.buffer);s&&(e=yi(e,-1,this.dim),i=yi(i,-1,this.dim));const f=4*this._idx(e,i);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(h[f],h[f+1],h[f+2])}static getUnpackVector(e){return Ip[e]}get unpackVector(){return Ip[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,s){return(256*e*256+256*i+s)/10-1e4}_unpackTerrarium(e,i,s){return 256*e+i+s/256-32768}static pack(e,i){const s=[0,0,0,0],h=Qd.getUnpackVector(i);let f=Math.floor((e+h[3])/h[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new Os({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,f=i*this.dim+this.dim,y=s*this.dim,b=s*this.dim+this.dim;switch(i){case-1:h=f-1;break;case 1:f=h+1}switch(s){case-1:y=b-1;break;case 1:b=y+1}const C=-i*this.dim,M=-s*this.dim;for(let B=y;B<b;B++)for(let U=h;U<f;U++)this.data[this._idx(U,B)]=e.data[this._idx(U+C,B+M)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Kn("DEMData",Qd),Kn("DemMinMaxQuadTree",Ep,{omit:["dem"]});class Zg{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,s){const h=e.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const f={value:i,timeout:void 0};if(void 0!==s&&(f.timeout=setTimeout(()=>{this.remove(e,f)},s)),this.data[h].push(f),this.order.push(h),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const s=e.wrapped().key,h=void 0===i?0:this.data[s].indexOf(i),f=this.data[s][h];return this.data[s].splice(h,1),f.timeout&&clearTimeout(f.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(f.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const s in this.data)for(const h of this.data[s])e(h.value)||i.push(h);for(const s of i)this.remove(s.value.tileID,s)}}class $c extends $n{constructor(e,i,s){super(),this.id=e,this._onlySymbols=s,i.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new Zg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ug}onAdd(e){this.map=e,this._minTileCacheSize=e?e._minTileCacheSize:null,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const s=this._tiles[i];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return Qt(this._tiles).map(e=>e.tileID).sort(fm).map(e=>e.key)}getRenderableIds(e){const i=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&i.push(this._tiles[s]);return e?i.sort((s,h)=>{const f=s.tileID,y=h.tileID,b=new $(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),C=new $(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-y.overscaledZ||C.y-b.y||C.x-b.x}).map(s=>s.tileID.key):i.map(s=>s.tileID).sort(fm).map(s=>s.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=i),this._loadTile(s,this._tileLoaded.bind(this,s,e,i)))}_tileLoaded(e,i,s,h){if(h)if(e.state="errored",404!==h.status)this._source.fire(new En(h,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=tr.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new ln("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let h=0;h<i.length;h++){const f=i[h];if(e.neighboringTiles&&e.neighboringTiles[f]){const y=this.getTileByID(f);s(e,y),s(y,e)}}function s(h,f){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let y=f.tileID.canonical.x-h.tileID.canonical.x;const b=f.tileID.canonical.y-h.tileID.canonical.y,C=Math.pow(2,h.tileID.canonical.z),M=f.tileID.key;0===y&&0===b||Math.abs(b)>1||(Math.abs(y)>1&&(1===Math.abs(y+C)?y+=C:1===Math.abs(y-C)&&(y-=C)),f.dem&&h.dem&&(h.dem.backfillBorder(f.dem,y,b),h.neighboringTiles&&h.neighboringTiles[M]&&(h.neighboringTiles[M].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,s,h){for(const f in this._tiles){let y=this._tiles[f];if(h[f]||!y.hasData()||y.tileID.overscaledZ<=i||y.tileID.overscaledZ>s)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>i+1;){const M=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[M.key],y&&y.hasData()&&(b=M)}let C=b;for(;C.overscaledZ>i;)if(C=C.scaledTo(C.overscaledZ-1),e[C.key]){h[b.key]=b;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=i?s:null}for(let s=e.overscaledZ-1;s>=i;s--){const h=e.scaledTo(s),f=this._getLoadedTile(h);if(f)return f}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const s=Math.ceil(e.width/i)+1,h=Math.ceil(e.height/i)+1,f=Math.floor(s*h*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,f):f,b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(b)}handleWrapJump(e){const i=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,i){const s={};for(const h in this._tiles){const f=this._tiles[h];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+i),s[f.tileID.key]=f}this._tiles=s;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,i,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let h;this.updateCacheSize(e,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new Es(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(h=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(b=>this._source.hasTile(b)))):h=[];const f=this._updateRetainedTiles(h);if(Mp(this._source.type)&&0!==h.length){const b={},C={},M=Object.keys(f);for(const U of M){const q=f[U],de=this._tiles[U];if(!de||de.fadeEndTime&&de.fadeEndTime<=tr.now())continue;const ye=this.findLoadedParent(q,Math.max(q.overscaledZ-$c.maxOverzooming,this._source.minzoom));ye&&(this._addTile(ye.tileID),b[ye.tileID.key]=ye.tileID),C[U]=q}const B=h[h.length-1].overscaledZ;for(const U in this._tiles){const q=this._tiles[U];if(f[U]||!q.hasData())continue;let de=q.tileID;for(;de.overscaledZ>B;){de=de.scaledTo(de.overscaledZ-1);const ye=this._tiles[de.key];if(ye&&ye.hasData()&&C[de.key]){f[U]=q.tileID;break}}}for(const U in b)f[U]||(this._coveredTiles[U]=!0,f[U]=b[U])}for(const b in f)this._tiles[b].clearFadeHold();const y=function(b,C){const M=[];for(const B in b)B in C||M.push(B);return M}(this._tiles,f);for(const b of y){const C=this._tiles[b];C.hasSymbolBuckets&&!C.holdingForFade()?C.setHoldDuration(this.map._fadeDuration):C.hasSymbolBuckets&&!C.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(0===e.length)return i;const s={},h=e.reduce((M,B)=>Math.min(M,B.overscaledZ),1/0),f=e[0].overscaledZ,y=Math.max(f-$c.maxOverzooming,this._source.minzoom),b=Math.max(f+$c.maxUnderzooming,this._source.minzoom),C={};for(const M of e){const B=this._addTile(M);i[M.key]=M,B.hasData()||h<this._source.maxzoom&&(C[M.key]=M)}this._retainLoadedChildren(C,h,b,i);for(const M of e){let B=this._tiles[M.key];if(B.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const q=M.children(this._source.maxzoom)[0],de=this.getTile(q);if(de&&de.hasData()){i[q.key]=q;continue}}else{const q=M.children(this._source.maxzoom);if(i[q[0].key]&&i[q[1].key]&&i[q[2].key]&&i[q[3].key])continue}let U=B.wasRequested();for(let q=M.overscaledZ-1;q>=y;--q){const de=M.scaledTo(q);if(s[de.key]||(s[de.key]=!0,B=this.getTile(de),!B&&U&&(B=this._addTile(de)),B&&(i[de.key]=de,U=B.wasRequested(),B.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let s,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){s=this._loadedParentTiles[h.key];break}i.push(h.key);const f=h.scaledTo(h.overscaledZ-1);if(s=this._getLoadedTile(f),s)break;h=f}for(const f of i)this._loadedParentTiles[f]=s}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const s=Boolean(i);if(!s){const h=this.map?this.map.painter:null,f="raster"===this._source.type||"raster-dem"===this._source.type;i=new eh(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,h,f),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,s||this._source.fire(new ln("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=i.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&"reloading"!==i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,i,s){const h=[],f=this.transform;if(!f)return h;for(const y in this._tiles){const b=this._tiles[y];if(s&&b.clearQueryDebugViz(),b.holdingForFade())continue;const C=e.containsTile(b,f,i);C&&h.push(C)}return h}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of i)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(Mp(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=tr.now())return!0}return!1}setFeatureState(e,i,s){this._state.updateState(e=e||"_geojsonTileLayer",i,s)}removeFeatureState(e,i,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,s)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,s){const h=this._tiles[e];h&&h.setDependencies(i,s)}reloadTilesForDependencies(e,i){for(const s in this._tiles)this._tiles[s].hasDependency(e,i)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,i))}_preloadTiles(e,i){const s=new Map,h=Array.isArray(e)?e:[e],f=this.map.painter.terrain,y=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const M of h){const B=M.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const U of B)s.set(U.key,U);this.usedForTerrain&&M.updateElevation(!1)}const b=Array.from(s.values()),C="raster"===this._source.type||"raster-dem"===this._source.type;xi(b,(M,B)=>{const U=new eh(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,C);this._loadTile(U,q=>{"raster-dem"===this._source.type&&U.dem&&this._backfillDEM(U),B(q,U)})},i)}}function fm(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Mp(t){return"raster"===t||"image"===t||"video"===t}$c.maxOverzooming=10,$c.maxUnderzooming=3;class Ap{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const h=s||e.findDEMTileFor(i);if(!h||!h.dem)return;const f=h.dem,y=h.tileID,b=1<<i.canonical.z-y.canonical.z;return new Ap(h,h.tileSize/ir/b,[(i.canonical.x/b-y.canonical.x)*f.dim,(i.canonical.y/b-y.canonical.y)*f.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(s);return new $(h,f)}getElevationAt(e,i,s,h){const f=e*this._scale+this._offset[0],y=i*this._scale+this._offset[1],b=Math.floor(f),C=Math.floor(y),M=this._dem;return h=!!h,s?br(br(M.get(b,C,h),M.get(b,C+1,h),y-C),br(M.get(b+1,C,h),M.get(b+1,C+1,h),y-C),f-b):M.get(b,C,h)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ja(1,e)*this._dem.stride}}class Sp{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Mr(ir,16,0),this.featureIndexArray=new df,this.promoteId=i}insert(e,i,s,h,f,y=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,f,y);const C=this.grid;for(let M=0;M<i.length;M++){const B=i[M],U=[1/0,1/0,-1/0,-1/0];for(let q=0;q<B.length;q++){const de=B[q];U[0]=Math.min(U[0],de.x),U[1]=Math.min(U[1],de.y),U[2]=Math.max(U[2],de.x),U[3]=Math.max(U[3],de.y)}U[0]<ir&&U[1]<ir&&U[2]>=0&&U[3]>=0&&C.insert(b,U[0],U[1],U[2],U[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new zc.VectorTile(new Uc(this.rawTileData)).layers,this.sourceLayerCoder=new um(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,s,h){this.loadVTLayers();const f=e.params||{},y=Fa(f.filter),b=e.tileResult,C=e.transform,M=b.bufferedTilespaceBounds,B=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(ye,Ie,Ue,Qe)=>vf(b.bufferedTilespaceGeometry,ye,Ie,Ue,Qe));B.sort(Vg);let U=null;C.elevation&&B.length>0&&(U=Ap.create(C.elevation,this.tileID));const q={};let de;for(let ye=0;ye<B.length;ye++){const Ie=B[ye];if(Ie===de)continue;de=Ie;const Ue=this.featureIndexArray.get(Ie);let Qe=null;this.loadMatchingFeature(q,Ue,y,f.layers,f.availableImages,i,s,h,(pt,Tt,Pt,Ft=0)=>(Qe||(Qe=Bl(pt,this.tileID.canonical,e.tileTransform)),Tt.queryIntersectsFeature(b,pt,Pt,Qe,this.z,e.transform,e.pixelPosMatrix,U,Ft)))}return q}loadMatchingFeature(e,i,s,h,f,y,b,C,M){const{featureIndex:B,bucketIndex:U,sourceLayerIndex:q,layoutVertexArrayOffset:de}=i,ye=this.bucketLayerIDs[U];if(h&&!function(pt,Tt){for(let Pt=0;Pt<pt.length;Pt++)if(Tt.indexOf(pt[Pt])>=0)return!0;return!1}(h,ye))return;const Ie=this.sourceLayerCoder.decode(q),Ue=this.vtLayers[Ie].feature(B);if(s.needGeometry){const pt=Nl(Ue,!0);if(!s.filter(new Ji(this.tileID.overscaledZ),pt,this.tileID.canonical))return}else if(!s.filter(new Ji(this.tileID.overscaledZ),Ue))return;const Qe=this.getId(Ue,Ie);for(let pt=0;pt<ye.length;pt++){const Tt=ye[pt];if(h&&h.indexOf(Tt)<0)continue;const Pt=y[Tt];if(!Pt)continue;let Ft={};void 0!==Qe&&C&&(Ft=C.getState(Pt.sourceLayer||"_geojsonTileLayer",Qe));const Bt=Ye({},b[Tt]);Bt.paint=mm(Bt.paint,Pt.paint,Ue,Ft,f),Bt.layout=mm(Bt.layout,Pt.layout,Ue,Ft,f);const vn=!M||M(Ue,Pt,Ft,de);if(!vn)continue;const mn=new Vc(Ue,this.z,this.x,this.y,Qe);mn.layer=Bt;let jn=e[Tt];void 0===jn&&(jn=e[Tt]=[]),jn.push({featureIndex:B,feature:mn,intersectionZ:vn})}}lookupSymbolFeatures(e,i,s,h,f,y,b,C){const M={};this.loadVTLayers();const B=Fa(f);for(const U of e)this.loadMatchingFeature(M,{bucketIndex:s,sourceLayerIndex:h,featureIndex:U,layoutVertexArrayOffset:0},B,y,b,C,i);return M}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(s),f=this.vtFeatures[h];if(f[i])return f[i];const y=this.vtLayers[h].feature(i);return f[i]=y,y}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;return this.promoteId&&(s=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[i]],"boolean"==typeof s&&(s=Number(s))),s}}function mm(t,e,i,s,h){return Rt(t,(f,y)=>{const b=e instanceof Ta?e.get(y):null;return b&&b.evaluate?b.evaluate(i,s,h):b})}function Vg(t,e){return e-t}Kn("FeatureIndex",Sp,{omit:["rawTileData","sourceLayerCoder"]});var Q_=yo([{name:"a_pos",type:"Int16",components:2}]);const pc=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,s=0,h=0,f=0,y=0,b=0;for(1&e?h=f=y=32:i=s=b=32;(e>>=1)>1;){const M=i+h>>1,B=s+f>>1;1&e?(h=i,f=s,i=y,s=b):(i=h,s=f,h=y,f=b),y=M,b=B}const C=4*t;pc[C+0]=i,pc[C+1]=s,pc[C+2]=h,pc[C+3]=f}const Xa=new Uint16Array(2178),jl=new Uint8Array(1089),Pp=new Uint16Array(1089);function Ma(t){return 0===t?-.03125:32===t?.03125:0}var gm=yo([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const $g={type:2,extent:ir,loadGeometry:()=>[[new $(0,0),new $(8193,0),new $(8193,8193),new $(0,8193),new $(0,0)]]};class eh{constructor(e,i,s,h,f){this.tileID=e,this.uid=Ae(),this.uses=0,this.tileSize=i,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<tr.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=xu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,f){const y={};if(!f)return y;for(const b of h){const C=b.layerIds.map(M=>f.getLayer(M)).filter(Boolean);if(0!==C.length){b.layers=C,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(M=>C.filter(B=>B.id===M)[0]));for(const M of C)y[M.id]=b}}return y}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const f=this.buckets[h];if(f instanceof vl){if(this.hasSymbolBuckets=!0,!s)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const f=this.buckets[h];if(f instanceof vl&&f.hasRTLText){this.hasRTLText=!0,wr.isLoading()||wr.isLoaded()||"deferred"!==hs()||sa();break}}this.queryPadding=0;for(const h in this.buckets){const f=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(h).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new sf}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const h=this.buckets[s];h.uploadPending()&&h.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new bp(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new bp(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new bp(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,s,h,f,y,b,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:b,transform:y,params:f,tileTransform:this.tileTransform},e,i,s):{}}querySourceFeatures(e,i){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const h=s.loadVTLayers(),f=i?i.sourceLayer:"",y=h._geojsonTileLayer||h[f];if(!y)return;const b=Fa(i&&i.filter),{z:C,x:M,y:B}=this.tileID.canonical,U={z:C,x:M,y:B};for(let q=0;q<y.length;q++){const de=y.feature(q);if(b.needGeometry){const Ue=Nl(de,!0);if(!b.filter(new Ji(this.tileID.overscaledZ),Ue,this.tileID.canonical))continue}else if(!b.filter(new Ji(this.tileID.overscaledZ),de))continue;const ye=s.getId(de,f),Ie=new Vc(de,C,M,B,ye);Ie.tile=U,e.push(Ie)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const s=Vi(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let h=!1;if(this.expirationTime>s)h=!1;else if(i)if(this.expirationTime<i)h=!0;else{const f=this.expirationTime-i;f?this.expirationTime=s+Math.max(f,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!i)return;const s=this.latestFeatureIndex.loadVTLayers(),h=i.style.listImages();for(const f in this.buckets){if(!i.style.hasLayer(f))continue;const y=this.buckets[f],b=y.layers[0].sourceLayer||"_geojsonTileLayer",C=s[b],M=e[b];if(!C||!M||0===Object.keys(M).length)continue;if(y.update(M,C,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof uu||y instanceof Pd){const U=i.style._getSourceCache(y.layers[0].source);i._terrain&&i._terrain.enabled&&U&&y.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(U.id,this.tileID)}const B=i&&i.style&&i.style.getLayer(f);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<tr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=tr.now()+e}setDependencies(e,i){const s={};for(const h of i)s[h]=!0;this.dependencies[e]=s}hasDependency(e,i){for(const s of e){const h=this.dependencies[s];if(h)for(const f of i)if(h[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const s=Bl($g,this.tileID.canonical,this.tileTransform)[0],h=new Kc,f=new fd;for(let y=0;y<s.length;y++){const{x:b,y:C}=s[y];h.emplaceBack(b,C),f.emplaceBack(y)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(h,gm.members),this._tileDebugSegments=No.simpleSegment(0,0,h.length,f.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const s=Bl($g,this.tileID.canonical,this.tileTransform)[0];let h,f;if(this.isRaster){const y=function(b,C){const M=xu(b,C),B=Math.pow(2,b.z);for(let Ue=0;Ue<33;Ue++)for(let Qe=0;Qe<33;Qe++){const pt=Fl((b.x+(Qe+Ma(Qe))/32)/B),Tt=la((b.y+(Ue+Ma(Ue))/32)/B),Pt=C.project(pt,Tt),Ft=33*Ue+Qe;Xa[2*Ft+0]=Math.round((Pt.x*M.scale-M.x)*ir),Xa[2*Ft+1]=Math.round((Pt.y*M.scale-M.y)*ir)}jl.fill(0),Pp.fill(0);for(let Ue=2045;Ue>=0;Ue--){const Qe=4*Ue,pt=pc[Qe+0],Tt=pc[Qe+1],Pt=pc[Qe+2],Ft=pc[Qe+3],Bt=pt+Pt>>1,vn=Tt+Ft>>1,mn=Bt+vn-Tt,jn=vn+pt-Bt,kn=33*Tt+pt,gn=33*Ft+Pt,Fn=33*vn+Bt,Yn=Math.hypot((Xa[2*kn+0]+Xa[2*gn+0])/2-Xa[2*Fn+0],(Xa[2*kn+1]+Xa[2*gn+1])/2-Xa[2*Fn+1])>=16;if(jl[Fn]=jl[Fn]||(Yn?1:0),Ue<1022){const wn=33*(Tt+jn>>1)+(pt+mn>>1),Qn=33*(Ft+jn>>1)+(Pt+mn>>1);jl[Fn]=jl[Fn]||jl[wn]||jl[Qn]}}const U=new Rl,q=new Ws;let de=0;function ye(Ue,Qe){const pt=33*Qe+Ue;return 0===Pp[pt]&&(U.emplaceBack(Xa[2*pt+0],Xa[2*pt+1],Ue*ir/32,Qe*ir/32),Pp[pt]=++de),Pp[pt]-1}function Ie(Ue,Qe,pt,Tt,Pt,Ft){const Bt=Ue+pt>>1,vn=Qe+Tt>>1;if(Math.abs(Ue-Pt)+Math.abs(Qe-Ft)>1&&jl[33*vn+Bt])Ie(Pt,Ft,Ue,Qe,Bt,vn),Ie(pt,Tt,Pt,Ft,Bt,vn);else{const mn=ye(Ue,Qe),jn=ye(pt,Tt),kn=ye(Pt,Ft);q.emplaceBack(mn,jn,kn)}}return Ie(0,0,32,32,32,0),Ie(32,32,0,0,0,32),{vertices:U,indices:q}}(this.tileID.canonical,i);h=y.vertices,f=y.indices}else{h=new Rl,f=new Ws;for(const{x:b,y:C}of s)h.emplaceBack(b,C,0,0);const y=Ed(h.int16,void 0,4);for(let b=0;b<y.length;b+=3)f.emplaceBack(y[b],y[b+1],y[b+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,gm.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=No.simpleSegment(0,0,h.length,f.length)}}const _m=yo([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),ym=yo([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:vm}=_m;function vu(t,e){const i=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,h=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),f=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),y=Math.sin(t._pitch)*f+h;return Math.min(1.01*y,h*(1/t._horizonShift))}const th=ir/Math.PI/2,Ds=-th,Js=th,Op=[new Ea([Ds,Ds,Ds],[Js,Js,Js]),new Ea([Ds,Ds,Ds],[0,0,Js]),new Ea([0,Ds,Ds],[Js,0,Js]),new Ea([Ds,0,Ds],[0,Js,Js]),new Ea([0,0,Ds],[Js,Js,Js])];function nh(t){if(t.z<=1)return Op[t.z+2*t.y+t.x];const[e,i]=xm(t),s=[ih(e[0],e[1]),ih(e[0],i[1]),ih(i[0],e[1]),ih(i[0],i[1])],h=[Js,Js,Js],f=[Ds,Ds,Ds];for(const y of s)h[0]=Math.min(h[0],y[0]),h[1]=Math.min(h[1],y[1]),h[2]=Math.min(h[2],y[2]),f[0]=Math.max(f[0],y[0]),f[1]=Math.max(f[1],y[1]),f[2]=Math.max(f[2],y[2]);return new Ea(h,f)}function xm(t){const e=Math.pow(2,t.z),i=t.x/e,s=(t.x+1)/e,h=(t.y+1)/e;return[[la(t.y/e),Fl(i)],[la(h),Fl(s)]]}function Rp(t,e,i,s){return i=fn(i),s||(s=th),[t*Math.sin(i)*s,-e*s,t*Math.cos(i)*s]}function ih(t,e,i){return Rp(Math.cos(fn(t)),Math.sin(fn(t)),e,i)}function bm(t){return 16383/Math.max(...Ht([],t.max,t.min))}function wm(t){const e=_e(new Float64Array(16)),i=1/bm(t);return xe(e,e,t.min),je(e,e,[i,i,i]),e}function id(t,e,i){const s=e/(2*Math.PI),h=function(y){const b=ir/(2*Math.PI);return y/(2*Math.PI)/b}(e);if(!i){const y=yi(t.center.lat,-85.051129,Ga);i=[pl(t.center.lng)*e,oc(y)*e]}const f=_e(new Float64Array(16));return xe(f,f,[i[0],i[1],-s]),je(f,f,[h,h,h]),nt(f,f,fn(-t._center.lat)),Fe(f,f,fn(-t._center.lng)),f}class fc{constructor(e){const i=this._createGridIndices();this.gridIndexBuffer=e.createIndexBuffer(i,!0),this.gridSegments=No.simpleSegment(0,0,4225,8192);const s=this._createPoleTriangleIndices();this.poleIndexBuffer=e.createIndexBuffer(s,!0),this.poleSegments=No.simpleSegment(0,0,66,64);const h=new Lu;h.emplaceBack(-1,1,1,0,0,0,0),h.emplaceBack(1,1,1,0,0,1,0),h.emplaceBack(1,-1,1,0,0,1,1),h.emplaceBack(-1,-1,1,0,0,0,1);const f=new Ws;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.atmosphereVertexBuffer=e.createVertexBuffer(h,ym.members),this.atmosphereIndexBuffer=e.createIndexBuffer(f),this.atmosphereSegments=No.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(e,i,s){const h=new Lu,f=i/Math.PI/2;h.emplaceBack(0,-f,0,0,0,.5,s?0:1);const y=360/e,b=Math.cos(fn(85)),C=Math.sin(fn(85));for(let B=0;B<=64;B++){const U=B/64,q=Rp(b,C,0*(1-(M=U))+y*M,f);h.emplaceBack(q[0],q[1],q[2],0,0,U,s?0:1)}var M;return h}_createPoleTriangleIndices(){const e=new Ws;for(let i=0;i<=64;i++)e.emplaceBack(0,i+1,i+2);return e}static createGridVertices(e){const i=Math.pow(2,e.z),s=(C,M,B)=>C*(1-B)+M*B,[h,f]=xm(e),y=new Lu,b=function(C){const M=_e(new Float64Array(16)),B=bm(C);var U,q;return je(M,M,[B,B,B]),xe(M,M,((U=[])[0]=-(q=C.min)[0],U[1]=-q[1],U[2]=-q[2],U)),M}(nh(e));y.reserve(4096);for(let C=0;C<65;C++){const M=s(h[0],f[0],C/64),B=oc(M),U=B*i-e.y,q=Math.sin(fn(M)),de=Math.cos(fn(M));for(let ye=0;ye<65;ye++){const Ie=ye/64,Ue=s(h[1],f[1],Ie),Qe=Rp(de,q,Ue);St(Qe,Qe,b);const pt=pl(Ue);y.emplaceBack(Qe[0],Qe[1],Qe[2],pt,B,Ie,U)}}return y}_createGridIndices(){const e=new Ws,i=(s,h)=>{const f=65*h+s;e.emplaceBack(f+1,f,f+65),e.emplaceBack(f+65,f+65+1,f+1)};for(let s=0;s<64;s++)for(let h=0;h<64;h++)i(h,s);return e}getWirefameBuffer(e){if(!this.wireframeSegments){const i=this._createWireframeGrid();this.wireframeIndexBuffer=e.createIndexBuffer(i),this.wireframeSegments=No.simpleSegment(0,0,4096,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const e=new Ca,i=(s,h)=>{const f=65*h+s;e.emplaceBack(f,f+1),e.emplaceBack(f,f+65),e.emplaceBack(f,f+65+1)};for(let s=0;s<64;s++)for(let h=0;h<64;h++)i(h,s);return e}}function xu(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),s=t.x*i,h=(t.x+1)*i,f=t.y*i,y=(t.y+1)*i,b=Fl(s),C=Fl(h),M=la(f),B=la(y),U=e.project(b,M),q=e.project(C,M),de=e.project(C,B),ye=e.project(b,B);let Ie=Math.min(U.x,q.x,de.x,ye.x),Ue=Math.min(U.y,q.y,de.y,ye.y),Qe=Math.max(U.x,q.x,de.x,ye.x),pt=Math.max(U.y,q.y,de.y,ye.y);const Tt=i/16;function Pt(Bt,vn,mn,jn,kn,gn){const Fn=(mn+kn)/2,Yn=(jn+gn)/2,wn=e.project(Fl(Fn),la(Yn)),Qn=Math.max(0,Ie-wn.x,Ue-wn.y,wn.x-Qe,wn.y-pt);Ie=Math.min(Ie,wn.x),Qe=Math.max(Qe,wn.x),Ue=Math.min(Ue,wn.y),pt=Math.max(pt,wn.y),Qn>Tt&&(Pt(Bt,wn,mn,jn,Fn,Yn),Pt(wn,vn,Fn,Yn,kn,gn))}Pt(U,q,s,f,h,f),Pt(q,de,h,f,h,y),Pt(de,ye,h,y,s,y),Pt(ye,U,s,y,s,f),Ie-=Tt,Ue-=Tt,Qe+=Tt,pt+=Tt;const Ft=1/Math.max(Qe-Ie,pt-Ue);return{scale:Ft,x:Ie*Ft,y:Ue*Ft,x2:Qe*Ft,y2:pt*Ft,projection:e}}class bu{constructor(e){const i={},s=[];for(const b in e){const C=e[b],M=i[b]={};for(const B in C.glyphs){const U=C.glyphs[+B];if(!U||0===U.bitmap.width||0===U.bitmap.height)continue;const q=U.metrics.localGlyph?2:1,de={x:0,y:0,w:U.bitmap.width+2*q,h:U.bitmap.height+2*q};s.push(de),M[B]=de}}const{w:h,h:f}=ap(s),y=new gl({width:h||1,height:f||1});for(const b in e){const C=e[b];for(const M in C.glyphs){const B=C.glyphs[+M];if(!B||0===B.bitmap.width||0===B.bitmap.height)continue;const U=i[b][M],q=B.metrics.localGlyph?2:1;gl.copy(B.bitmap,y,{x:0,y:0},{x:U.x+q,y:U.y+q},B.bitmap)}}this.image=y,this.positions=i}}Kn("GlyphAtlas",bu);class jg{constructor(e){this.tileID=new Es(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=xu(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,s,h,f){this.status="parsing",this.data=e,this.collisionBoxArray=new sf;const y=new um(Object.keys(e.layers).sort()),b=new Sp(this.tileID,this.promoteId);b.bucketLayerIDs=[];const C={},M=new ed(256,256),B={featureIndex:b,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:M,availableImages:s},U=i.familiesBySource[this.source];for(const Ft in U){const Bt=e.layers[Ft];if(!Bt)continue;let vn=!1,mn=!1;for(const gn of U[Ft])"symbol"===gn[0].type?vn=!0:mn=!0;if(!0===this.isSymbolTile&&!vn||!1===this.isSymbolTile&&!mn)continue;1===Bt.version&&Di(`Vector tile source "${this.source}" layer "${Ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const jn=y.encode(Ft),kn=[];for(let gn=0;gn<Bt.length;gn++){const Fn=Bt.feature(gn),Yn=b.getId(Fn,Ft);kn.push({feature:Fn,id:Yn,index:gn,sourceLayerIndex:jn})}for(const gn of U[Ft]){const Fn=gn[0];void 0!==this.isSymbolTile&&"symbol"===Fn.type!==this.isSymbolTile||Fn.minzoom&&this.zoom<Math.floor(Fn.minzoom)||Fn.maxzoom&&this.zoom>=Fn.maxzoom||"none"!==Fn.visibility&&(Lp(gn,this.zoom,s),(C[Fn.id]=Fn.createBucket({index:b.bucketLayerIDs.length,layers:gn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:jn,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:s})).populate(kn,B,this.tileID.canonical,this.tileTransform),b.bucketLayerIDs.push(gn.map(Yn=>Yn.id)))}}let q,de,ye,Ie;M.trim();const Ue={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Qe=Rt(B.glyphDependencies,Ft=>Object.keys(Ft).map(Number));Object.keys(Qe).length?h.send("getGlyphs",{uid:this.uid,stacks:Qe},(Ft,Bt)=>{q||(q=Ft,de=Bt,Pt.call(this))},void 0,!1,Ue):de={};const pt=Object.keys(B.iconDependencies);pt.length?h.send("getImages",{icons:pt,source:this.source,tileID:this.tileID,type:"icons"},(Ft,Bt)=>{q||(q=Ft,ye=Bt,Pt.call(this))},void 0,!1,Ue):ye={};const Tt=Object.keys(B.patternDependencies);function Pt(){if(q)return f(q);if(de&&ye&&Ie){const Ft=new bu(de),Bt=new Hf(ye,Ie);for(const vn in C){const mn=C[vn];mn instanceof vl?(Lp(mn.layers,this.zoom,s),yl(mn,de,Ft.positions,ye,Bt.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection),mn.projection=this.projection.name):mn.hasPattern&&(mn instanceof uu||mn instanceof Pd||mn instanceof Yh)&&(Lp(mn.layers,this.zoom,s),mn.addFeatures(B,this.tileID.canonical,Bt.patternPositions,s))}this.status="done",f(null,{buckets:Qt(C).filter(vn=>!vn.isEmpty()),featureIndex:b,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ft.image,lineAtlas:M,imageAtlas:Bt,glyphMap:this.returnDependencies?de:null,iconMap:this.returnDependencies?ye:null,glyphPositions:this.returnDependencies?Ft.positions:null})}}Tt.length?h.send("getImages",{icons:Tt,source:this.source,tileID:this.tileID,type:"patterns"},(Ft,Bt)=>{q||(q=Ft,Ie=Bt,Pt.call(this))},void 0,!1,Ue):Ie={},Pt.call(this)}}function Lp(t,e,i){const s=new Ji(e);for(const h of t)h.recalculate(s,i)}class rh{constructor(e){this.entries={},this.scheduler=e}request(e,i,s,h){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[y,b]=f.result;return this.scheduler?this.scheduler.add(()=>{h(y,b)},i):h(y,b),()=>{}}return f.callbacks.push(h),f.cancel||(f.cancel=s((y,b)=>{f.result=[y,b];for(const C of f.callbacks)this.scheduler?this.scheduler.add(()=>{C(y,b)},i):C(y,b);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(y=>y!==h),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function Ka(t,e,i){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},h=>{const f=Lr(t.request,(y,b,C,M)=>{y?h(y):b&&h(null,{vectorTile:i?void 0:new zc.VectorTile(new Uc(b)),rawData:b,cacheControl:C,expires:M})});return()=>{f.cancel(),h()}},e)}const rd=_e(new Float64Array(16));class zo{constructor(e,i){this._tr=e,this._worldSize=i}createInversionMatrix(){return rd}createTileMatrix(e){let i,s,h;const f=e.canonical,y=_e(new Float64Array(16)),b=this._tr.projection;if(b.isReprojectedInTileSpace){const C=xu(f,b);i=1,s=C.x+e.wrap*C.scale,h=C.y,je(y,y,[i/C.scale,i/C.scale,this._tr.pixelsPerMeter/this._worldSize])}else i=this._worldSize/this._tr.zoomScale(f.z),s=(f.x+Math.pow(2,f.z)*e.wrap)*i,h=f.y*i;return xe(y,y,[s,h,0]),je(y,y,[i/ir,i/ir,1]),y}pointCoordinate(e,i,s){const h=this._tr.horizonLineFromTop(!1),f=new $(e,Math.max(h,i));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(f,s))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var jc={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&ft(this.parallels,this.constants.parallels))return;const t=Math.sin(fn(this.parallels[0])),e=(t+Math.sin(fn(this.parallels[1])))/2,i=1+t*(2*e-t),s=Math.sqrt(i)/e;this.constants={n:e,c:i,r0:s,parallels:this.parallels}},project(t,e){this.initializeConstants();const i=fn(t-this.center[0]),s=fn(e),{n:h,c:f,r0:y}=this.constants,b=Math.sqrt(f-2*h*Math.sin(s))/h;return{x:b*Math.sin(i*h),y:b*Math.cos(i*h)-y,z:0}},unproject(t,e){this.initializeConstants();const{n:i,c:s,r0:h}=this.constants,f=h+e;let y=Math.atan2(t,Math.abs(f))*Math.sign(f);f*i<0&&(y-=Math.PI*Math.sign(t)*Math.sign(f));const b=fn(this.center[0])*i;y=_i(y,-Math.PI-b,Math.PI-b);const C=Gn(y/i)+this.center[0],M=Math.asin(yi((s-(t*t+f*f)*i*i)/(2*i),-1,1)),B=yi(Gn(M),-85.051129,Ga);return new Yr(C,B)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>ja(1,t)*e,farthestPixelDistance(t){return vu(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new zo(t,e)};const mc=1.340264,Is=-.081106,Gc=893e-6,bl=.003796,Gl=Math.sqrt(3)/2;var wu={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const i=Math.asin(Gl*Math.sin(e)),s=i*i,h=s*s*s;return{x:.5*(t*Math.cos(i)/(Gl*(mc+3*Is*s+h*(7*Gc+9*bl*s)))/Math.PI+.5),y:1-.5*(i*(mc+Is*s+h*(Gc+bl*s))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,s=i*i,h=s*s*s;for(let M,B,U,q=0;q<12&&(B=i*(mc+Is*s+h*(Gc+bl*s))-e,U=mc+3*Is*s+h*(7*Gc+9*bl*s),M=B/U,i=yi(i-M,-Math.PI/3,Math.PI/3),s=i*i,h=s*s*s,!(Math.abs(M)<1e-12));++q);const f=Gl*t*(mc+3*Is*s+h*(7*Gc+9*bl*s))/Math.cos(i),y=Math.asin(Math.sin(i)/Gl),b=yi(180*f/Math.PI,-180,180),C=yi(180*y/Math.PI,-85.051129,Ga);return new Yr(b,C)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>ja(1,t)*e,farthestPixelDistance(t){return vu(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new zo(t,e)},Tu={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(t,e)=>({x:.5+t/360,y:.5-e/360,z:0}),unproject(t,e){const i=360*(t-.5),s=yi(360*(.5-e),-85.051129,Ga);return new Yr(i,s)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>ja(1,t)*e,farthestPixelDistance(t){return vu(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new zo(t,e)};const Qa=Math.PI/2;function ql(t){return Math.tan((Qa+t)/2)}var Cu={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&ft(this.parallels,this.constants.parallels))return;const t=fn(this.parallels[0]),e=fn(this.parallels[1]),i=Math.cos(t),s=t===e?Math.sin(t):Math.log(i/Math.cos(e))/Math.log(ql(e)/ql(t)),h=i*Math.pow(ql(t),s)/s;this.constants={n:s,f:h,parallels:this.parallels}},project(t,e){this.initializeConstants(),e=fn(e),t=fn(t-this.center[0]);const i=1e-6,{n:s,f:h}=this.constants;h>0?e<-Qa+i&&(e=-Qa+i):e>Qa-i&&(e=Qa-i);const f=h/Math.pow(ql(e),s),y=f*Math.sin(s*t),b=h-f*Math.cos(s*t);return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+.5),z:0}},unproject(t,e){this.initializeConstants(),t=(2*t-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:i,f:s}=this.constants,h=s-e,f=Math.sign(h),y=Math.sign(i)*Math.sqrt(t*t+h*h);let b=Math.atan2(t,Math.abs(h))*f;h*i<0&&(b-=Math.PI*Math.sign(t)*f);const C=yi(Gn(b/i)+this.center[0],-180,180),M=yi(Gn(2*Math.atan(Math.pow(s/y,1/i))-Qa),-85.051129,Ga);return new Yr(C,M)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>ja(1,t)*e,farthestPixelDistance(t){return vu(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new zo(t,e)},Eu={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(t,e)=>({x:pl(t),y:oc(e),z:0}),unproject(t,e){const i=Fl(t),s=la(e);return new Yr(i,s)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>ja(1,t)*e,farthestPixelDistance(t){return vu(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new zo(t,e)};const qc=fn(Ga);var Tm={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(t,e){const i=(e=fn(e))*e,s=i*i;return{x:.5*((t=fn(t))*(.8707-.131979*i+s*(s*(.003971*i-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+i*(.015085+s*(.028874*i-.044475-.005916*s)))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,s=25,h=0,f=i*i;do{f=i*i;const C=f*f;h=(i*(1.007226+f*(.015085+C*(.028874*f-.044475-.005916*C)))-e)/(1.007226+f*(.045255+C*(.259866*f-.311325-.005916*11*C))),i=yi(i-h,-qc,qc)}while(Math.abs(h)>1e-6&&--s>0);f=i*i;const y=yi(Gn(t/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),b=Gn(i);return new Yr(y,b)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>ja(1,t)*e,farthestPixelDistance(t){return vu(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new zo(t,e)};const kp=fn(Ga),Fp={albers:jc,equalEarth:wu,equirectangular:Tu,lambertConformalConic:Cu,mercator:Eu,naturalEarth:Tm,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=fn(e),t=fn(t);const i=Math.cos(e),s=2/Math.PI,h=Math.acos(i*Math.cos(t/2)),f=Math.sin(h)/h,y=.5*(t*s+2*i*Math.sin(t/2)/f)||0,b=.5*(e+Math.sin(e)/f)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}},unproject(t,e){let i=t=(2*t-.5)*Math.PI,s=e=(2*(1-e)-1)*Math.PI,h=25;const f=1e-6;let y=0,b=0;do{const C=Math.cos(s),M=Math.sin(s),B=2*M*C,U=M*M,q=C*C,de=Math.cos(i/2),ye=Math.sin(i/2),Ie=2*de*ye,Ue=ye*ye,Qe=1-q*de*de,pt=Qe?1/Qe:0,Tt=Qe?Math.acos(C*de)*Math.sqrt(1/Qe):0,Pt=.5*(2*Tt*C*ye+2*i/Math.PI)-t,Ft=.5*(Tt*M+s)-e,Bt=.5*pt*(q*Ue+Tt*C*de*U)+1/Math.PI,vn=pt*(Ie*B/4-Tt*M*ye),mn=.125*pt*(B*ye-Tt*M*q*Ie),jn=.5*pt*(U*de+Tt*Ue*C)+.5,kn=vn*mn-jn*Bt;y=(Ft*vn-Pt*jn)/kn,b=(Pt*mn-Ft*Bt)/kn,i=yi(i-y,-Math.PI,Math.PI),s=yi(s-b,-kp,kp)}while((Math.abs(y)>f||Math.abs(b)>f)&&--h>0);return new Yr(Gn(i),Gn(s))},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>ja(1,t)*e,farthestPixelDistance(t){return vu(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new zo(t,e)}};l.ARRAY_TYPE=K,l.AUTH_ERR_MSG=kt,l.Aabb=Ea,l.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},me(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Cr()?t:V,this.scheduler=new zg}send(t,e,i,s,h=!1,f){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=f,this.callbacks[y]=i);const b=Rr(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:t,hasCallback:!!i,targetMapId:s,mustQueue:h,sourceMapId:this.mapId,data:Ua(e,b)},b),{cancel:()=>{i&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[i];delete this.cancelCallbacks[i],s&&s.cancel()}else if(e.mustQueue||Cr()){const s=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),s&&s.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if("<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(Ol(e.error)):i(null,Ol(e.data)))}else{const i=Rr(this.globalScope)?void 0:[],s=e.hasCallback?(f,y)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:f?Ua(f):null,data:Ua(y,i)},i)}:f=>{},h=Ol(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,h,s);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],h.source)[f[1]](h,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.CanonicalTileID=td,l.Color=Bi,l.ColorMode=Wa,l.CullFaceMode=Ya,l.DEMData=Qd,l.DataConstantProperty=ai,l.DedupedRequest=rh,l.DepthMode=dc,l.EXTENT=ir,l.Elevation=class{getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){null==e&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const h=s.getSource().maxzoom,f=1<<h,y=Math.floor(t.x),b=t.x-y,C=new Es(h,y,h,Math.floor(b*f),Math.floor(t.y*f)),M=this.findDEMTileFor(C);if(!M||!M.dem)return e;const B=M.dem,U=1<<M.tileID.canonical.z,q=(b*U-M.tileID.canonical.x)*B.dim,de=(t.y*U-M.tileID.canonical.y)*B.dim,ye=Math.floor(q),Ie=Math.floor(de);return(i?this.exaggeration():1)*br(br(B.get(ye,Ie),B.get(ye,Ie+1),de-Ie),br(B.get(ye+1,Ie),B.get(ye+1,Ie+1),de-Ie),q-ye)}getAtTileOffset(t,e,i){const s=1<<t.canonical.z;return this.getAtPointOrZero(new _d(t.wrap+(t.canonical.x+e/ir)/s,(t.canonical.y+i/ir)/s))}getAtTileOffsetFunc(t,e){return i=>{const s=this.getAtTileOffset(t,i.x,i.y),h=e.upVector(t.canonical,i.x,i.y);return xt(h,h,s*e.upVectorScale(t.canonical)),h}}getForTilePoints(t,e,i,s){const h=Ap.create(this,t,s);return!!h&&(e.forEach(f=>{f[2]=this.exaggeration()*h.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,h=1<<t.canonical.z-s.canonical.z;let f=t.canonical.x/h-s.canonical.x,y=t.canonical.y/h-s.canonical.y,b=0;for(let C=0;C<t.canonical.z-s.canonical.z&&!i.leaves[b];C++){f*=2,y*=2;const M=2*Math.floor(y)+Math.floor(f);b=i.childOffsets[b]+M,f%=1,y%=1}return{min:this.exaggeration()*i.minimums[b],max:this.exaggeration()*i.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},l.ErrorEvent=En,l.EvaluationParameters=Ji,l.Event=ln,l.Evented=$n,l.Frustum=wf,l.GLOBE_ZOOM_THRESHOLD_MAX=6,l.GlobeSharedBuffers=fc,l.GlyphManager=Ju,l.ImagePosition=Nd,l.LineAtlas=ed,l.LngLat=Yr,l.LngLatBounds=Go,l.LocalGlyphMode=Zd,l.MAX_MERCATOR_LATITUDE=Ga,l.MercatorCoordinate=_d,l.ONE_EM=24,l.OverscaledTileID=Es,l.Properties=os,l.RGBAImage=Os,l.Ray=class{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,i){const s=Vt(e,this.dir);if(Math.abs(s)<1e-6)return!1;const h=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/s;return i[0]=this.pos[0]+this.dir[0]*h,i[1]=this.pos[1]+this.dir[1]*h,i[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(t,e,i){if(ye=(q=this.pos)[0],Ie=q[1],Ue=q[2],Qe=(de=t)[0],pt=de[1],Tt=de[2],Math.abs(ye-Qe)<=Z*Math.max(1,Math.abs(ye),Math.abs(Qe))&&Math.abs(Ie-pt)<=Z*Math.max(1,Math.abs(Ie),Math.abs(pt))&&Math.abs(Ue-Tt)<=Z*Math.max(1,Math.abs(Ue),Math.abs(Tt))||0===e)return i[0]=i[1]=i[2]=0,!1;var q,de,ye,Ie,Ue,Qe,pt,Tt;const[s,h,f]=this.dir,y=this.pos[0]-t[0],b=this.pos[1]-t[1],C=this.pos[2]-t[2],M=s*s+h*h+f*f,B=2*(y*s+b*h+C*f),U=B*B-4*M*(y*y+b*b+C*C-e*e);if(U<0){const q=Math.max(-B/2,0),de=y+s*q,ye=b+h*q,Ie=C+f*q,Ue=Math.hypot(de,ye,Ie);return i[0]=de*e/Ue,i[1]=ye*e/Ue,i[2]=Ie*e/Ue,!1}{const q=(-B-Math.sqrt(U))/(2*M);if(q<0){const de=Math.hypot(y,b,C);return i[0]=y*e/de,i[1]=b*e/de,i[2]=C*e/de,!1}return i[0]=y+s*q,i[1]=b+h*q,i[2]=C+f*q,!0}}},l.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Xe,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!tn(t))return t;const i=Ln(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!tn(t))return t;const i=Ln(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!tn(t))return t;const i=Ln(t);return i.path=`/v4/${i.authority}.json`,i.params.push("secure"),this._makeAPIURL(i,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,s){const h=Ln(t);return tn(t)?(h.path=`/styles/v1${h.path}/sprite${e}${i}`,this._makeAPIURL(h,this._customAccessToken||s)):(h.path+=`${e}${i}`,qn(h))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!tn(t))return t;const s=Ln(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==s.authority&&512===i?"@2x":""}${F.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${X.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${X.TILE_URL_VERSION}${s.path}`);const h=this._customAccessToken||function(f){for(const y of f){const b=y.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(s.params)||X.ACCESS_TOKEN;return X.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,h)}canonicalizeTileURL(t,e){const i=Ln(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let s="mapbox://";i.path.match(/^\/raster\/v1\//)?s+=`raster/${i.path.replace(`/${X.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${i.path.replace(`/${X.TILE_URL_VERSION}/`,"")}`;let h=i.params;return e&&(h=h.filter(f=>!f.match(/^access_token=/))),h.length&&(s+=`?${h.join("&")}`),s}canonicalizeTileset(t,e){const i=!!e&&tn(e),s=[];for(const h of t.tiles||[])rn(h)?s.push(this.canonicalizeTileURL(h,i)):s.push(h);return s}_makeAPIURL(t,e){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",s=Ln(X.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,"http"===t.protocol){const h=t.params.indexOf("secure");h>=0&&t.params.splice(h,1)}if("/"!==s.path&&(t.path=`${s.path}${t.path}`),!X.REQUIRE_ACCESS_TOKEN)return qn(t);if(e=e||X.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(h=>-1===h.indexOf("access_token")),t.params.push(`access_token=${e||""}`),qn(t)}},l.ResourceType=ao,l.SegmentVector=No,l.SourceCache=$c,l.StencilMode=Cp,l.StructArrayLayout1ui2=fd,l.StructArrayLayout2f1f2i16=dd,l.StructArrayLayout2i4=Kc,l.StructArrayLayout2ui4=Ca,l.StructArrayLayout3f12=Za,l.StructArrayLayout3ui6=Ws,l.StructArrayLayout4i8=Rl,l.Texture=bp,l.Tile=eh,l.Transitionable=Cs,l.Uniform1f=Dh,l.Uniform1i=class extends Va{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},l.Uniform2f=class extends Va{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},l.Uniform3f=class extends Va{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},l.Uniform4f=Ym,l.UniformColor=Ih,l.UniformMatrix2f=class extends Va{constructor(t,e){super(t,e),this.current=Km}set(t){for(let e=0;e<4;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},l.UniformMatrix3f=class extends Va{constructor(t,e){super(t,e),this.current=Xm}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},l.UniformMatrix4f=class extends Va{constructor(t,e){super(t,e),this.current=Jm}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},l.UnwrappedTileID=Jd,l.ValidationError=cn,l.VectorTileWorkerSource=class extends $n{constructor(t,e,i,s,h){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=h||Ka,this.loading={},this.loaded={},this.deduped=new rh(t.scheduler),this.isSpriteLoaded=s,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,s=t&&t.request,h=s&&s.collectResourceTiming,f=this.loading[i]=new jg(t);f.abort=this.loadVectorData(t,(y,b)=>{const C=!this.loading[i];if(delete this.loading[i],C||y||!b)return f.status="done",C||(this.loaded[i]=f),e(y);const M=b.rawData,B={};b.expires&&(B.expires=b.expires),b.cacheControl&&(B.cacheControl=b.cacheControl),f.vectorTile=b.vectorTile||new zc.VectorTile(new Uc(M));const U=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(q,de)=>{if(q||!de)return e(q);const ye={};if(h){const Ie=yu(s);Ie.length>0&&(ye.resourceTiming=JSON.parse(JSON.stringify(Ie)))}e(null,Ye({rawTileData:M.slice(0)},de,B,ye))})};this.isSpriteLoaded?U():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(U,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):U()}),this.loaded=this.loaded||{},this.loaded[i]=f})}reloadTile(t,e){const i=this.loaded,s=t.uid,h=this;if(i&&i[s]){const f=i[s];f.showCollisionBoxes=t.showCollisionBoxes,f.enableTerrain=!!t.enableTerrain,f.projection=t.projection;const y=(b,C)=>{const M=f.reloadCallback;M&&(delete f.reloadCallback,f.parse(f.vectorTile,h.layerIndex,this.availableImages,h.actor,M)),e(b,C)};"parsing"===f.status?f.reloadCallback=y:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(t,e){const i=t.uid,s=this.loading[i];s&&(s.abort&&s.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,s=t.uid;i&&i[s]&&delete i[s],e()}},l.WritingMode=ca,l.ZoomHistory=g,l.add=Ge,l.addDynamicAttributes=gu,l.adjoint=function(t,e){var i=e[0],s=e[1],h=e[2],f=e[3],y=e[4],b=e[5],C=e[6],M=e[7],B=e[8];return t[0]=y*B-b*M,t[1]=h*M-s*B,t[2]=s*b-h*y,t[3]=b*C-f*B,t[4]=i*B-h*C,t[5]=h*f-i*b,t[6]=f*M-y*C,t[7]=s*C-i*M,t[8]=i*y-s*f,t},l.asyncAll=xi,l.bezier=sr,l.bindAll=me,l.boundsAttributes=gm,l.bufferConvexPolygon=function(t,e){const i=[];for(let s=0;s<t.length;s++){const h=_i(s-1,-1,t.length-1),f=_i(s+1,-1,t.length-1),y=t[s],b=t[f],C=t[h].sub(y).unit(),M=b.sub(y).unit(),B=M.angleWithSep(C.x,C.y),U=C.add(M).unit().mult(-1*e/Math.sin(B/2));i.push(y.add(U))}return i},l.cacheEntryPossiblyAdded=function(t){bi++,bi>ur&&(t.getActor().send("enforceCacheSizeLimit",_r),bi=0)},l.calculateGlobeMatrix=id,l.calculateGlobeMercatorMatrix=function(t){const e=t.worldSize,i=yi(t.center.lat,-85.051129,Ga),s=new $(pl(t.center.lng)*e,oc(i)*e),h=ja(1,t.center.lat)*e,f=t.pixelsPerMeter,y=e/(h/t.pixelsPerMeter),b=_e(new Float64Array(16));return xe(b,b,[s.x,s.y,0]),je(b,b,[y,y,f]),b},l.clamp=yi,l.clearTileCache=function(t){const e=V.caches.delete(Zi);t&&e.catch(t).then(()=>t())},l.clipLine=Xf,l.clone=function(t){var e=new K(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},l.clone$1=Xn,l.collisionCircleLayout=tp,l.config=X,l.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},l.create=function(){var t=new K(16);return K!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},l.create$1=re,l.createExpression=Ra,l.createLayout=yo,l.createStyleLayer=function(t){return"custom"===t.type?new om(t):new am[t.type](t)},l.cross=Un,l.degToRad=fn,l.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},l.dot=Vt,l.ease=zi,l.easeCubicInOut=$i,l.emitValidationErrors=Ur,l.endsWith=qe,l.enforceCacheSizeLimit=function(t){Nr(),cr&&cr.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-t;s++)e.delete(i[s])})})},l.evaluateSizeForFeature=Bd,l.evaluateSizeForZoom=du,l.evaluateVariableOffset=nm,l.evented=ds,l.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},l.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},l.exported=tr,l.exported$1=F,l.extend=Ye,l.extend$1=$r,l.filterObject=Xt,l.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},l.fromQuat=function(t,e){var i=e[0],s=e[1],h=e[2],f=e[3],y=i+i,b=s+s,C=h+h,M=i*y,B=s*y,U=s*b,q=h*y,de=h*b,ye=h*C,Ie=f*y,Ue=f*b,Qe=f*C;return t[0]=1-U-ye,t[1]=B+Qe,t[2]=q-Ue,t[3]=0,t[4]=B-Qe,t[5]=1-M-ye,t[6]=de+Ie,t[7]=0,t[8]=q+Ue,t[9]=de-Ie,t[10]=1-M-U,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.fromRotation=function(t,e){var i=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=i,t[2]=0,t[3]=-i,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},l.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return ei[e]},l.getAABBPointSquareDist=function(t,e,i){let s=0;for(let h=0;h<2;++h){const f=i?i[h]:0;t[h]>f&&(s+=(t[h]-f)*(t[h]-f)),e[h]<f&&(s+=(f-e[h])*(f-e[h]))}return s},l.getAnchorAlignment=Ud,l.getAnchorJustification=Xu,l.getBounds=function(t){let e=1/0,i=1/0,s=-1/0,h=-1/0;for(const f of t)e=Math.min(e,f.x),i=Math.min(i,f.y),s=Math.max(s,f.x),h=Math.max(h,f.y);return{min:new $(e,i),max:new $(s,h)}},l.getColumn=function(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]},l.getImage=Lt,l.getJSON=function(t,e){return Pr(Ye(t,{type:"json"}),e)},l.getMapSessionAPI=mi,l.getPerformanceMeasurement=yu,l.getProjection=function(t){const e=Fp[t.name];if(!e)throw new Error(`Invalid projection name: ${t.name}`);return e.conic?function(i,s){if(s.parallels&&Math.abs(s.parallels[0]+s.parallels[1])<.01){let h=function(f){const y=Math.max(.01,Math.cos(fn(f))),b=1/(2*Math.max(Math.PI*y,1/y));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(C,M){const B=fn(C)*y,U=Math.sin(fn(M))/y;return{x:B*b+.5,y:-U*b+.5,z:0}},unproject(C,M){const B=-(M-.5)/b,U=yi(Gn((C-.5)/b)/y,-180,180),q=Math.asin(yi(B*y,-1,1)),de=yi(Gn(q),-85.051129,Ga);return new Yr(U,de)}}}(s.parallels[0]);if("lambertConformalConic"===s.name){const{project:f,unproject:y}=Fp.mercator;h={wrap:!0,supportsWorldCopies:!0,project:f,unproject:y}}return Ye({},i,s,h)}return Ye({},i,s)}(e,t):e},l.getRTLTextPluginStatus=hs,l.getReferrer=Jr,l.getTilePoint=function(t,{x:e,y:i},s=0){return new $(((e-s)*t.scale-t.x)*ir,(i*t.scale-t.y)*ir)},l.getTileVec3=function(t,e,i=0){return _t(((e.x-i)*t.scale-t.x)*ir,(e.y*t.scale-t.y)*ir,mf(e.z,e.y))},l.getVideo=function(t,e){const i=V.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<t.length;s++){const h=V.document.createElement("source");He(t[s])||(i.crossOrigin="Anonymous"),h.src=t[s],i.appendChild(h)}return{cancel:()=>{}}},l.globeBuffersForTileMesh=function(t,e,i,s){const h=t.context,f=t.transform;let y=e.globeGridBuffer,b=e.globePoleBuffer;if(!y){const C=fc.createGridVertices(i.canonical);y=e.globeGridBuffer=h.createVertexBuffer(C,vm,!1)}if(!b){const C=fc.createPoleTriangleVertices(s,f.tileSize*s,0===i.canonical.y);b=e.globePoleBuffer=h.createVertexBuffer(C,vm,!1)}return[y,b]},l.globeDenormalizeECEF=wm,l.globeMatrixForTile=function(t,e){const i=wm(nh(t)),s=((h=new Float64Array(16))[0]=(f=e)[0],h[1]=f[1],h[2]=f[2],h[3]=f[3],h[4]=f[4],h[5]=f[5],h[6]=f[6],h[7]=f[7],h[8]=f[8],h[9]=f[9],h[10]=f[10],h[11]=f[11],h[12]=f[12],h[13]=f[13],h[14]=f[14],h[15]=f[15],h);var h,f;return ke(s,s,i),s},l.globePoleMatrixForTile=function(t,e,i){const s=_e(new Float64Array(16)),h=Math.pow(2,t.z),f=(t.x-h/2)/h*Math.PI*2,y=i.point,b=i.worldSize/(i.tileSize*h);return xe(s,s,[y.x,y.y,-i.worldSize/Math.PI/2]),je(s,s,[b,b,b]),nt(s,s,fn(-i._center.lat)),Fe(s,s,fn(-i._center.lng)),Fe(s,s,f),e&&je(s,s,[1,-1,1]),s},l.globeTileBounds=nh,l.globeToMercatorTransition=function(t){return ji(5,6,t)},l.identity=_e,l.identity$1=qt,l.invert=function(t,e){var i=e[0],s=e[1],h=e[2],f=e[3],y=e[4],b=e[5],C=e[6],M=e[7],B=e[8],U=e[9],q=e[10],de=e[11],ye=e[12],Ie=e[13],Ue=e[14],Qe=e[15],pt=i*b-s*y,Tt=i*C-h*y,Pt=i*M-f*y,Ft=s*C-h*b,Bt=s*M-f*b,vn=h*M-f*C,mn=B*Ie-U*ye,jn=B*Ue-q*ye,kn=B*Qe-de*ye,gn=U*Ue-q*Ie,Fn=U*Qe-de*Ie,Yn=q*Qe-de*Ue,wn=pt*Yn-Tt*Fn+Pt*gn+Ft*kn-Bt*jn+vn*mn;return wn?(t[0]=(b*Yn-C*Fn+M*gn)*(wn=1/wn),t[1]=(h*Fn-s*Yn-f*gn)*wn,t[2]=(Ie*vn-Ue*Bt+Qe*Ft)*wn,t[3]=(q*Bt-U*vn-de*Ft)*wn,t[4]=(C*kn-y*Yn-M*jn)*wn,t[5]=(i*Yn-h*kn+f*jn)*wn,t[6]=(Ue*Pt-ye*vn-Qe*Tt)*wn,t[7]=(B*vn-q*Pt+de*Tt)*wn,t[8]=(y*Fn-b*kn+M*mn)*wn,t[9]=(s*kn-i*Fn-f*mn)*wn,t[10]=(ye*Bt-Ie*Pt+Qe*pt)*wn,t[11]=(U*Pt-B*Bt-de*pt)*wn,t[12]=(b*jn-y*gn-C*mn)*wn,t[13]=(i*gn-s*jn+h*mn)*wn,t[14]=(Ie*Tt-ye*Ft-Ue*pt)*wn,t[15]=(B*Ft-U*Tt+q*pt)*wn,t):null},l.isMapAuthenticated=function(t){return Ii.has(t)},l.isMapboxURL=tn,l.latFromMercatorY=la,l.len=Kt,l.length=Re,l.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},l.loadVectorTile=Ka,l.makeRequest=Pr,l.mercatorXfromLng=pl,l.mercatorYfromLat=oc,l.mercatorZfromAltitude=ja,l.mul=ke,l.mul$1=en,l.multiply=function(t,e,i){var s=e[0],h=e[1],f=e[2],y=e[3],b=e[4],C=e[5],M=e[6],B=e[7],U=e[8],q=i[0],de=i[1],ye=i[2],Ie=i[3],Ue=i[4],Qe=i[5],pt=i[6],Tt=i[7],Pt=i[8];return t[0]=q*s+de*y+ye*M,t[1]=q*h+de*b+ye*B,t[2]=q*f+de*C+ye*U,t[3]=Ie*s+Ue*y+Qe*M,t[4]=Ie*h+Ue*b+Qe*B,t[5]=Ie*f+Ue*C+Qe*U,t[6]=pt*s+Tt*y+Pt*M,t[7]=pt*h+Tt*b+Pt*B,t[8]=pt*f+Tt*C+Pt*U,t},l.multiply$1=ge,l.multiply$2=yt,l.nextPowerOfTwo=Pe,l.normalize=At,l.normalize$1=function(t,e){var i=e[0],s=e[1],h=e[2],f=e[3],y=i*i+s*s+h*h+f*f;return y>0&&(y=1/Math.sqrt(y)),t[0]=i*y,t[1]=s*y,t[2]=h*y,t[3]=f*y,t},l.number=br,l.ortho=function(t,e,i,s,h,f,y){var b=1/(e-i),C=1/(s-h),M=1/(f-y);return t[0]=-2*b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*C,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*M,t[11]=0,t[12]=(e+i)*b,t[13]=(h+s)*C,t[14]=(y+f)*M,t[15]=1,t},l.pbf=Uc,l.perspective=function(t,e,i,s,h){var f,y=1/Math.tan(e/2);return t[0]=y/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=h&&h!==1/0?(t[10]=(h+s)*(f=1/(s-h)),t[14]=2*h*s*f):(t[10]=-1,t[14]=-2*s),t},l.pick=function(t,e){const i={};for(let s=0;s<e.length;s++){const h=e[s];h in t&&(i[h]=t[h])}return i},l.plugin=wr,l.pointGeometry=$,l.polygonIntersectsBox=vf,l.polygonIntersectsPolygon=iu,l.polygonizeBounds=function(t,e,i=0,s=!0){const h=new $(i,i),f=t.sub(h),y=e.add(h),b=[f,new $(y.x,f.y),y,new $(f.x,y.y)];return s&&b.push(f),b},l.posAttributes=Q_,l.postMapLoadEvent=ci,l.postTurnstileEvent=Ui,l.potpack=ap,l.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},l.radToDeg=Gn,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.registerForPluginStateChange=function(t){return t({pluginStatus:Gi,pluginURL:Li}),ds.on("pluginStateChange",t),t},l.removeAuthState=function(t){Ii.delete(t)},l.renderColorRamp=Cf,l.rotateX=nt,l.rotateX$1=Gt,l.rotateY=Fe,l.rotateZ=function(t,e,i){var s=Math.sin(i),h=Math.cos(i),f=e[0],y=e[1],b=e[2],C=e[3],M=e[4],B=e[5],U=e[6],q=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*h+M*s,t[1]=y*h+B*s,t[2]=b*h+U*s,t[3]=C*h+q*s,t[4]=M*h-f*s,t[5]=B*h-y*s,t[6]=U*h-b*s,t[7]=q*h-C*s,t},l.rotateZ$1=function(t,e,i){i*=.5;var s=e[0],h=e[1],f=e[2],y=e[3],b=Math.sin(i),C=Math.cos(i);return t[0]=s*C+h*b,t[1]=h*C-s*b,t[2]=f*C+y*b,t[3]=y*C-f*b,t},l.scale=je,l.scale$1=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},l.scale$2=xt,l.scaleAndAdd=dt,l.setCacheLimits=function(t,e){_r=t,ur=e},l.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},l.setRTLTextPlugin=function(t,e,i=!1){if(Gi===vi||Gi===Yi||Gi===Ar)throw new Error("setRTLTextPlugin cannot be called multiple times.");Li=tr.resolveURL(t),Gi=vi,Xr=e,jo(),i||sa()},l.smoothstep=ji,l.spec=Ot,l.storeAuthState=function(t,e){e?Ii.add(t):Ii.delete(t)},l.sub=Ht,l.subtract=ot,l.symbolSize=Uf,l.tileAABB=function(t,e,i,s,h,f,y,b,C){if("globe"===C.name){const de=nh(new Jd(f,new td(i,s,h)).canonical).getCorners(),ye=Number.MAX_VALUE,Ie=[-ye,-ye,-ye],Ue=[ye,ye,ye],Qe=id(t,e);for(let pt=0;pt<de.length;pt++)St(de[pt],de[pt],Qe),B=Ue,U=de[pt],(M=Ue)[0]=Math.min(B[0],U[0]),M[1]=Math.min(B[1],U[1]),M[2]=Math.min(B[2],U[2]),wt(Ie,Ie,de[pt]);return new Ea(Ue,Ie)}var M,B,U;const q=xu({z:i,x:s,y:h},C);return new Ea([(f+q.x/q.scale)*e,e*(q.y/q.scale),y],[(f+q.x2/q.scale)*e,e*(q.y2/q.scale),b])},l.tileTransform=xu,l.transformMat3=function(t,e,i){var s=e[0],h=e[1],f=e[2];return t[0]=s*i[0]+h*i[3]+f*i[6],t[1]=s*i[1]+h*i[4]+f*i[7],t[2]=s*i[2]+h*i[5]+f*i[8],t},l.transformMat4=St,l.transformMat4$1=Wt,l.transformQuat=$t,l.translate=xe,l.transpose=function(t,e){if(t===e){var i=e[1],s=e[2],h=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=s,t[7]=h}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},l.triggerPluginCompletionEvent=lo,l.uniqueId=Ae,l.validateCustomStyleLayer=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},l.validateFog=zr,l.validateLight=pi,l.validateStyle=xn,l.values=Qt,l.vectorTile=zc,l.version=L,l.warnOnce=Di,l.window=V,l.wrap=_i}),d(0,function(l){function L(ie){const X=typeof ie;if("number"===X||"boolean"===X||"string"===X||null==ie)return JSON.stringify(ie);if(Array.isArray(ie)){let Te="[";for(const We of ie)Te+=`${L(We)},`;return`${Te}]`}const F=Object.keys(ie).sort();let he="{";for(let Te=0;Te<F.length;Te++)he+=`${JSON.stringify(F[Te])}:${L(ie[F[Te]])},`;return`${he}}`}function P(ie){let X="";for(const F of l.refProperties)X+=`/${L(ie[F])}`;return X}class m{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,F){for(const Te of X)this._layerConfigs[Te.id]=Te,(this._layers[Te.id]=l.createStyleLayer(Te)).compileFilter(),this.keyCache[Te.id]&&delete this.keyCache[Te.id];for(const Te of F)delete this.keyCache[Te],delete this._layerConfigs[Te],delete this._layers[Te];this.familiesBySource={};const he=function(Te,We){const mt={};for(let Xe=0;Xe<Te.length;Xe++){const kt=We&&We[Te[Xe].id]||P(Te[Xe]);We&&(We[Te[Xe].id]=kt);let tn=mt[kt];tn||(tn=mt[kt]=[]),tn.push(Te[Xe])}const Dt=[];for(const Xe in mt)Dt.push(mt[Xe]);return Dt}(l.values(this._layerConfigs),this.keyCache);for(const Te of he){const We=Te.map(rn=>this._layers[rn.id]),mt=We[0];if("none"===mt.visibility)continue;const Dt=mt.source||"";let Xe=this.familiesBySource[Dt];Xe||(Xe=this.familiesBySource[Dt]={});const kt=mt.sourceLayer||"_geojsonTileLayer";let tn=Xe[kt];tn||(tn=Xe[kt]=[]),tn.push(We)}}}const{ImageBitmap:$}=l.window;class ue{loadTile(X,F){const{uid:he,encoding:Te,rawImageData:We,padding:mt,buildQuadTree:Dt}=X,Xe=$&&We instanceof $?this.getImageData(We,mt):We;F(null,new l.DEMData(he,Xe,Te,mt<1,Dt))}getImageData(X,F){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);const he=this.offscreenCanvasContext.getImageData(-F,-F,X.width+2*F,X.height+2*F);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:he.width,height:he.height},he.data)}}var V=function ie(X,F){var he,Te=X&&X.type;if("FeatureCollection"===Te)for(he=0;he<X.features.length;he++)ie(X.features[he],F);else if("GeometryCollection"===Te)for(he=0;he<X.geometries.length;he++)ie(X.geometries[he],F);else if("Feature"===Te)ie(X.geometry,F);else if("Polygon"===Te)Z(X.coordinates,F);else if("MultiPolygon"===Te)for(he=0;he<X.coordinates.length;he++)Z(X.coordinates[he],F);return X};function Z(ie,X){if(0!==ie.length){K(ie[0],X);for(var F=1;F<ie.length;F++)K(ie[F],!X)}}function K(ie,X){for(var F=0,he=0,Te=0,We=ie.length,mt=We-1;Te<We;mt=Te++){var Dt=(ie[Te][0]-ie[mt][0])*(ie[mt][1]+ie[Te][1]),Xe=F+Dt;he+=Math.abs(F)>=Math.abs(Dt)?F-Xe+Dt:Dt-Xe+F,F=Xe}F+he>=0!=!!X&&ie.reverse()}const re=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class _e{constructor(X){this._feature=X,this.extent=l.EXTENT,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))}loadGeometry(){if(1===this._feature.type){const X=[];for(const F of this._feature.geometry)X.push([new l.pointGeometry(F[0],F[1])]);return X}{const X=[];for(const F of this._feature.geometry){const he=[];for(const Te of F)he.push(new l.pointGeometry(Te[0],Te[1]));X.push(he)}return X}}toGeoJSON(X,F,he){return re.call(this,X,F,he)}}class ge{constructor(X){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=X.length,this._features=X}feature(X){return new _e(this._features[X])}}var xe=l.vectorTile.VectorTileFeature,je=nt;function nt(ie,X){this.options=X||{},this.features=ie,this.length=ie.length}function Fe(ie,X){this.id="number"==typeof ie.id?ie.id:void 0,this.type=ie.type,this.rawGeometry=1===ie.type?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=X||4096}nt.prototype.feature=function(ie){return new Fe(this.features[ie],this.options.extent)},Fe.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var X=0;X<ie.length;X++){for(var F=ie[X],he=[],Te=0;Te<F.length;Te++)he.push(new l.pointGeometry(F[Te][0],F[Te][1]));this.geometry.push(he)}return this.geometry},Fe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,X=1/0,F=-1/0,he=1/0,Te=-1/0,We=0;We<ie.length;We++)for(var mt=ie[We],Dt=0;Dt<mt.length;Dt++){var Xe=mt[Dt];X=Math.min(X,Xe.x),F=Math.max(F,Xe.x),he=Math.min(he,Xe.y),Te=Math.max(Te,Xe.y)}return[X,he,F,Te]},Fe.prototype.toGeoJSON=xe.prototype.toGeoJSON;var ke=$e,Ne=je;function $e(ie){var X=new l.pbf;return function(F,he){for(var Te in F.layers)he.writeMessage(3,Re,F.layers[Te])}(ie,X),X.finish()}function Re(ie,X){var F;X.writeVarintField(15,ie.version||1),X.writeStringField(1,ie.name||""),X.writeVarintField(5,ie.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<ie.length;F++)he.feature=ie.feature(F),X.writeMessage(2,_t,he);var Te=he.keys;for(F=0;F<Te.length;F++)X.writeStringField(3,Te[F]);var We=he.values;for(F=0;F<We.length;F++)X.writeMessage(4,xt,We[F])}function _t(ie,X){var F=ie.feature;void 0!==F.id&&X.writeVarintField(1,F.id),X.writeMessage(2,Ge,ie),X.writeVarintField(3,F.type),X.writeMessage(4,wt,F)}function Ge(ie,X){var F=ie.feature,he=ie.keys,Te=ie.values,We=ie.keycache,mt=ie.valuecache;for(var Dt in F.properties){var Xe=F.properties[Dt],kt=We[Dt];if(null!==Xe){void 0===kt&&(he.push(Dt),We[Dt]=kt=he.length-1),X.writeVarint(kt);var tn=typeof Xe;"string"!==tn&&"boolean"!==tn&&"number"!==tn&&(Xe=JSON.stringify(Xe));var rn=tn+":"+Xe,pn=mt[rn];void 0===pn&&(Te.push(Xe),mt[rn]=pn=Te.length-1),X.writeVarint(pn)}}}function ot(ie,X){return(X<<3)+(7&ie)}function yt(ie){return ie<<1^ie>>31}function wt(ie,X){for(var F=ie.loadGeometry(),he=ie.type,Te=0,We=0,mt=F.length,Dt=0;Dt<mt;Dt++){var Xe=F[Dt],kt=1;1===he&&(kt=Xe.length),X.writeVarint(ot(1,kt));for(var tn=3===he?Xe.length-1:Xe.length,rn=0;rn<tn;rn++){1===rn&&1!==he&&X.writeVarint(ot(2,tn-1));var pn=Xe[rn].x-Te,Ln=Xe[rn].y-We;X.writeVarint(yt(pn)),X.writeVarint(yt(Ln)),Te+=pn,We+=Ln}3===he&&X.writeVarint(ot(7,1))}}function xt(ie,X){var F=typeof ie;"string"===F?X.writeStringField(1,ie):"boolean"===F?X.writeBooleanField(7,ie):"number"===F&&(ie%1!=0?X.writeDoubleField(3,ie):ie<0?X.writeSVarintField(6,ie):X.writeVarintField(5,ie))}function dt(ie,X,F,he,Te,We){if(Te-he<=F)return;const mt=he+Te>>1;At(ie,X,mt,he,Te,We%2),dt(ie,X,F,he,mt-1,We+1),dt(ie,X,F,mt+1,Te,We+1)}function At(ie,X,F,he,Te,We){for(;Te>he;){if(Te-he>600){const kt=Te-he+1,tn=F-he+1,rn=Math.log(kt),pn=.5*Math.exp(2*rn/3),Ln=.5*Math.sqrt(rn*pn*(kt-pn)/kt)*(tn-kt/2<0?-1:1);At(ie,X,F,Math.max(he,Math.floor(F-tn*pn/kt+Ln)),Math.min(Te,Math.floor(F+(kt-tn)*pn/kt+Ln)),We)}const mt=X[2*F+We];let Dt=he,Xe=Te;for(Vt(ie,X,he,F),X[2*Te+We]>mt&&Vt(ie,X,he,Te);Dt<Xe;){for(Vt(ie,X,Dt,Xe),Dt++,Xe--;X[2*Dt+We]<mt;)Dt++;for(;X[2*Xe+We]>mt;)Xe--}X[2*he+We]===mt?Vt(ie,X,he,Xe):(Xe++,Vt(ie,X,Xe,Te)),Xe<=F&&(he=Xe+1),F<=Xe&&(Te=Xe-1)}}function Vt(ie,X,F,he){Un(ie,F,he),Un(X,2*F,2*he),Un(X,2*F+1,2*he+1)}function Un(ie,X,F){const he=ie[X];ie[X]=ie[F],ie[F]=he}function St(ie,X,F,he){const Te=ie-F,We=X-he;return Te*Te+We*We}ke.fromVectorTileJs=$e,ke.fromGeojsonVt=function(ie,X){X=X||{};var F={};for(var he in ie)F[he]=new je(ie[he].features,X),F[he].name=he,F[he].version=X.version,F[he].extent=X.extent;return $e({layers:F})},ke.GeoJSONWrapper=Ne;const $t=ie=>ie[0],zt=ie=>ie[1];class Ht{constructor(X,F=$t,he=zt,Te=64,We=Float64Array){this.nodeSize=Te,this.points=X;const mt=X.length<65536?Uint16Array:Uint32Array,Dt=this.ids=new mt(X.length),Xe=this.coords=new We(2*X.length);for(let kt=0;kt<X.length;kt++)Dt[kt]=kt,Xe[2*kt]=F(X[kt]),Xe[2*kt+1]=he(X[kt]);dt(Dt,Xe,Te,0,Dt.length-1,0)}range(X,F,he,Te){return function(We,mt,Dt,Xe,kt,tn,rn){const pn=[0,We.length-1,0],Ln=[];let qn,ni;for(;pn.length;){const Hn=pn.pop(),ii=pn.pop(),Ui=pn.pop();if(ii-Ui<=rn){for(let Mn=Ui;Mn<=ii;Mn++)qn=mt[2*Mn],ni=mt[2*Mn+1],qn>=Dt&&qn<=kt&&ni>=Xe&&ni<=tn&&Ln.push(We[Mn]);continue}const Fi=Math.floor((Ui+ii)/2);qn=mt[2*Fi],ni=mt[2*Fi+1],qn>=Dt&&qn<=kt&&ni>=Xe&&ni<=tn&&Ln.push(We[Fi]);const ci=(Hn+1)%2;(0===Hn?Dt<=qn:Xe<=ni)&&(pn.push(Ui),pn.push(Fi-1),pn.push(ci)),(0===Hn?kt>=qn:tn>=ni)&&(pn.push(Fi+1),pn.push(ii),pn.push(ci))}return Ln}(this.ids,this.coords,X,F,he,Te,this.nodeSize)}within(X,F,he){return function(Te,We,mt,Dt,Xe,kt){const tn=[0,Te.length-1,0],rn=[],pn=Xe*Xe;for(;tn.length;){const Ln=tn.pop(),qn=tn.pop(),ni=tn.pop();if(qn-ni<=kt){for(let ci=ni;ci<=qn;ci++)St(We[2*ci],We[2*ci+1],mt,Dt)<=pn&&rn.push(Te[ci]);continue}const Hn=Math.floor((ni+qn)/2),ii=We[2*Hn],Ui=We[2*Hn+1];St(ii,Ui,mt,Dt)<=pn&&rn.push(Te[Hn]);const Fi=(Ln+1)%2;(0===Ln?mt-Xe<=ii:Dt-Xe<=Ui)&&(tn.push(ni),tn.push(Hn-1),tn.push(Fi)),(0===Ln?mt+Xe>=ii:Dt+Xe>=Ui)&&(tn.push(Hn+1),tn.push(qn),tn.push(Fi))}return rn}(this.ids,this.coords,X,F,he,this.nodeSize)}}const en={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},Kt=Math.fround||(Wt=new Float32Array(1),ie=>(Wt[0]=+ie,Wt[0]));var Wt;class Yt{constructor(X){this.options=ei(Object.create(en),X),this.trees=new Array(this.options.maxZoom+1)}load(X){const{log:F,minZoom:he,maxZoom:Te,nodeSize:We}=this.options;F&&console.time("total time");const mt=`prepare ${X.length} points`;F&&console.time(mt),this.points=X;let Dt=[];for(let Xe=0;Xe<X.length;Xe++)X[Xe].geometry&&Dt.push(Gt(X[Xe],Xe));this.trees[Te+1]=new Ht(Dt,$i,sr,We,Float32Array),F&&console.timeEnd(mt);for(let Xe=Te;Xe>=he;Xe--){const kt=+Date.now();Dt=this._cluster(Dt,Xe),this.trees[Xe]=new Ht(Dt,$i,sr,We,Float32Array),F&&console.log("z%d: %d clusters in %dms",Xe,Dt.length,+Date.now()-kt)}return F&&console.timeEnd("total time"),this}getClusters(X,F){let he=((X[0]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,X[1]));let We=180===X[2]?180:((X[2]+180)%360+360)%360-180;const mt=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)he=-180,We=180;else if(he>We){const tn=this.getClusters([he,Te,180,mt],F),rn=this.getClusters([-180,Te,We,mt],F);return tn.concat(rn)}const Dt=this.trees[this._limitZoom(F)],Xe=Dt.range(On(he),fn(mt),On(We),fn(Te)),kt=[];for(const tn of Xe){const rn=Dt.points[tn];kt.push(rn.numPoints?ft(rn):this.points[rn.index])}return kt}getChildren(X){const F=this._getOriginId(X),he=this._getOriginZoom(X),Te="No cluster with the specified id.",We=this.trees[he];if(!We)throw new Error(Te);const mt=We.points[F];if(!mt)throw new Error(Te);const Dt=this.options.radius/(this.options.extent*Math.pow(2,he-1)),Xe=We.within(mt.x,mt.y,Dt),kt=[];for(const tn of Xe){const rn=We.points[tn];rn.parentId===X&&kt.push(rn.numPoints?ft(rn):this.points[rn.index])}if(0===kt.length)throw new Error(Te);return kt}getLeaves(X,F,he){const Te=[];return this._appendLeaves(Te,X,F=F||10,he=he||0,0),Te}getTile(X,F,he){const Te=this.trees[this._limitZoom(X)],We=Math.pow(2,X),{extent:mt,radius:Dt}=this.options,Xe=Dt/mt,kt=(he-Xe)/We,tn=(he+1+Xe)/We,rn={features:[]};return this._addTileFeatures(Te.range((F-Xe)/We,kt,(F+1+Xe)/We,tn),Te.points,F,he,We,rn),0===F&&this._addTileFeatures(Te.range(1-Xe/We,kt,1,tn),Te.points,We,he,We,rn),F===We-1&&this._addTileFeatures(Te.range(0,kt,Xe/We,tn),Te.points,-1,he,We,rn),rn.features.length?rn:null}getClusterExpansionZoom(X){let F=this._getOriginZoom(X)-1;for(;F<=this.options.maxZoom;){const he=this.getChildren(X);if(F++,1!==he.length)break;X=he[0].properties.cluster_id}return F}_appendLeaves(X,F,he,Te,We){const mt=this.getChildren(F);for(const Dt of mt){const Xe=Dt.properties;if(Xe&&Xe.cluster?We+Xe.point_count<=Te?We+=Xe.point_count:We=this._appendLeaves(X,Xe.cluster_id,he,Te,We):We<Te?We++:X.push(Dt),X.length===he)break}return We}_addTileFeatures(X,F,he,Te,We,mt){for(const Dt of X){const Xe=F[Dt],kt=Xe.numPoints;let tn,rn,pn;if(kt)tn=Ut(Xe),rn=Xe.x,pn=Xe.y;else{const ni=this.points[Xe.index];tn=ni.properties,rn=On(ni.geometry.coordinates[0]),pn=fn(ni.geometry.coordinates[1])}const Ln={type:1,geometry:[[Math.round(this.options.extent*(rn*We-he)),Math.round(this.options.extent*(pn*We-Te))]],tags:tn};let qn;kt?qn=Xe.id:this.options.generateId?qn=Xe.index:this.points[Xe.index].id&&(qn=this.points[Xe.index].id),void 0!==qn&&(Ln.id=qn),mt.features.push(Ln)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(+X,this.options.maxZoom+1))}_cluster(X,F){const he=[],{radius:Te,extent:We,reduce:mt,minPoints:Dt}=this.options,Xe=Te/(We*Math.pow(2,F));for(let kt=0;kt<X.length;kt++){const tn=X[kt];if(tn.zoom<=F)continue;tn.zoom=F;const rn=this.trees[F+1],pn=rn.within(tn.x,tn.y,Xe),Ln=tn.numPoints||1;let qn=Ln;for(const ni of pn){const Hn=rn.points[ni];Hn.zoom>F&&(qn+=Hn.numPoints||1)}if(qn>Ln&&qn>=Dt){let ni=tn.x*Ln,Hn=tn.y*Ln,ii=mt&&Ln>1?this._map(tn,!0):null;const Ui=(kt<<5)+(F+1)+this.points.length;for(const Fi of pn){const ci=rn.points[Fi];if(ci.zoom<=F)continue;ci.zoom=F;const Mn=ci.numPoints||1;ni+=ci.x*Mn,Hn+=ci.y*Mn,ci.parentId=Ui,mt&&(ii||(ii=this._map(tn,!0)),mt(ii,this._map(ci)))}tn.parentId=Ui,he.push(qt(ni/qn,Hn/qn,Ui,qn,ii))}else if(he.push(tn),qn>1)for(const ni of pn){const Hn=rn.points[ni];Hn.zoom<=F||(Hn.zoom=F,he.push(Hn))}}return he}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,F){if(X.numPoints)return F?ei({},X.properties):X.properties;const he=this.points[X.index].properties,Te=this.options.map(he);return F&&Te===he?ei({},Te):Te}}function qt(ie,X,F,he,Te){return{x:Kt(ie),y:Kt(X),zoom:1/0,id:F,parentId:-1,numPoints:he,properties:Te}}function Gt(ie,X){const[F,he]=ie.geometry.coordinates;return{x:Kt(On(F)),y:Kt(fn(he)),zoom:1/0,index:X,parentId:-1}}function ft(ie){return{type:"Feature",id:ie.id,properties:Ut(ie),geometry:{type:"Point",coordinates:[(X=ie.x,360*(X-.5)),Gn(ie.y)]}};var X}function Ut(ie){const X=ie.numPoints,F=X>=1e4?`${Math.round(X/1e3)}k`:X>=1e3?Math.round(X/100)/10+"k":X;return ei(ei({},ie.properties),{cluster:!0,cluster_id:ie.id,point_count:X,point_count_abbreviated:F})}function On(ie){return ie/360+.5}function fn(ie){const X=Math.sin(ie*Math.PI/180),F=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return F<0?0:F>1?1:F}function Gn(ie){const X=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function ei(ie,X){for(const F in X)ie[F]=X[F];return ie}function $i(ie){return ie.x}function sr(ie){return ie.y}function zi(ie,X,F,he){for(var Te,We=he,mt=F-X>>1,Dt=F-X,Xe=ie[X],kt=ie[X+1],tn=ie[F],rn=ie[F+1],pn=X+3;pn<F;pn+=3){var Ln=yi(ie[pn],ie[pn+1],Xe,kt,tn,rn);if(Ln>We)Te=pn,We=Ln;else if(Ln===We){var qn=Math.abs(pn-mt);qn<Dt&&(Te=pn,Dt=qn)}}We>he&&(Te-X>3&&zi(ie,X,Te,he),ie[Te+2]=We,F-Te>3&&zi(ie,Te,F,he))}function yi(ie,X,F,he,Te,We){var mt=Te-F,Dt=We-he;if(0!==mt||0!==Dt){var Xe=((ie-F)*mt+(X-he)*Dt)/(mt*mt+Dt*Dt);Xe>1?(F=Te,he=We):Xe>0&&(F+=mt*Xe,he+=Dt*Xe)}return(mt=ie-F)*mt+(Dt=X-he)*Dt}function ji(ie,X,F,he){var Te={id:void 0===ie?null:ie,type:X,geometry:F,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(We){var mt=We.geometry,Dt=We.type;if("Point"===Dt||"MultiPoint"===Dt||"LineString"===Dt)_i(We,mt);else if("Polygon"===Dt||"MultiLineString"===Dt)for(var Xe=0;Xe<mt.length;Xe++)_i(We,mt[Xe]);else if("MultiPolygon"===Dt)for(Xe=0;Xe<mt.length;Xe++)for(var kt=0;kt<mt[Xe].length;kt++)_i(We,mt[Xe][kt])}(Te),Te}function _i(ie,X){for(var F=0;F<X.length;F+=3)ie.minX=Math.min(ie.minX,X[F]),ie.minY=Math.min(ie.minY,X[F+1]),ie.maxX=Math.max(ie.maxX,X[F]),ie.maxY=Math.max(ie.maxY,X[F+1])}function xi(ie,X,F,he){if(X.geometry){var Te=X.geometry.coordinates,We=X.geometry.type,mt=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2),Dt=[],Xe=X.id;if(F.promoteId?Xe=X.properties[F.promoteId]:F.generateId&&(Xe=he||0),"Point"===We)Qt(Te,Dt);else if("MultiPoint"===We)for(var kt=0;kt<Te.length;kt++)Qt(Te[kt],Dt);else if("LineString"===We)Ye(Te,Dt,mt,!1);else if("MultiLineString"===We){if(F.lineMetrics){for(kt=0;kt<Te.length;kt++)Ye(Te[kt],Dt=[],mt,!1),ie.push(ji(Xe,"LineString",Dt,X.properties));return}te(Te,Dt,mt,!1)}else if("Polygon"===We)te(Te,Dt,mt,!0);else{if("MultiPolygon"!==We){if("GeometryCollection"===We){for(kt=0;kt<X.geometry.geometries.length;kt++)xi(ie,{id:Xe,geometry:X.geometry.geometries[kt],properties:X.properties},F,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(kt=0;kt<Te.length;kt++){var tn=[];te(Te[kt],tn,mt,!0),Dt.push(tn)}}ie.push(ji(Xe,We,Dt,X.properties))}}function Qt(ie,X){X.push(Ae(ie[0])),X.push(ut(ie[1])),X.push(0)}function Ye(ie,X,F,he){for(var Te,We,mt=0,Dt=0;Dt<ie.length;Dt++){var Xe=Ae(ie[Dt][0]),kt=ut(ie[Dt][1]);X.push(Xe),X.push(kt),X.push(0),Dt>0&&(mt+=he?(Te*kt-Xe*We)/2:Math.sqrt(Math.pow(Xe-Te,2)+Math.pow(kt-We,2))),Te=Xe,We=kt}var tn=X.length-3;X[2]=1,zi(X,0,tn,F),X[tn+2]=1,X.size=Math.abs(mt),X.start=0,X.end=X.size}function te(ie,X,F,he){for(var Te=0;Te<ie.length;Te++){var We=[];Ye(ie[Te],We,F,he),X.push(We)}}function Ae(ie){return ie/360+.5}function ut(ie){var X=Math.sin(ie*Math.PI/180),F=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return F<0?0:F>1?1:F}function Pe(ie,X,F,he,Te,We,mt,Dt){if(he/=X,We>=(F/=X)&&mt<he)return ie;if(mt<F||We>=he)return null;for(var Xe=[],kt=0;kt<ie.length;kt++){var tn=ie[kt],rn=tn.geometry,pn=tn.type,Ln=0===Te?tn.minX:tn.minY,qn=0===Te?tn.maxX:tn.maxY;if(Ln>=F&&qn<he)Xe.push(tn);else if(!(qn<F||Ln>=he)){var ni=[];if("Point"===pn||"MultiPoint"===pn)Nt(rn,ni,F,he,Te);else if("LineString"===pn)me(rn,ni,F,he,Te,!1,Dt.lineMetrics);else if("MultiLineString"===pn)Rt(rn,ni,F,he,Te,!1);else if("Polygon"===pn)Rt(rn,ni,F,he,Te,!0);else if("MultiPolygon"===pn)for(var Hn=0;Hn<rn.length;Hn++){var ii=[];Rt(rn[Hn],ii,F,he,Te,!0),ii.length&&ni.push(ii)}if(ni.length){if(Dt.lineMetrics&&"LineString"===pn){for(Hn=0;Hn<ni.length;Hn++)Xe.push(ji(tn.id,pn,ni[Hn],tn.tags));continue}"LineString"!==pn&&"MultiLineString"!==pn||(1===ni.length?(pn="LineString",ni=ni[0]):pn="MultiLineString"),"Point"!==pn&&"MultiPoint"!==pn||(pn=3===ni.length?"Point":"MultiPoint"),Xe.push(ji(tn.id,pn,ni,tn.tags))}}}return Xe.length?Xe:null}function Nt(ie,X,F,he,Te){for(var We=0;We<ie.length;We+=3){var mt=ie[We+Te];mt>=F&&mt<=he&&(X.push(ie[We]),X.push(ie[We+1]),X.push(ie[We+2]))}}function me(ie,X,F,he,Te,We,mt){for(var Dt,Xe,kt=qe(ie),tn=0===Te?Xn:Ki,rn=ie.start,pn=0;pn<ie.length-3;pn+=3){var Ln=ie[pn],qn=ie[pn+1],ni=ie[pn+2],Hn=ie[pn+3],ii=ie[pn+4],Ui=0===Te?Ln:qn,Fi=0===Te?Hn:ii,ci=!1;mt&&(Dt=Math.sqrt(Math.pow(Ln-Hn,2)+Math.pow(qn-ii,2))),Ui<F?Fi>F&&(Xe=tn(kt,Ln,qn,Hn,ii,F),mt&&(kt.start=rn+Dt*Xe)):Ui>he?Fi<he&&(Xe=tn(kt,Ln,qn,Hn,ii,he),mt&&(kt.start=rn+Dt*Xe)):Xt(kt,Ln,qn,ni),Fi<F&&Ui>=F&&(Xe=tn(kt,Ln,qn,Hn,ii,F),ci=!0),Fi>he&&Ui<=he&&(Xe=tn(kt,Ln,qn,Hn,ii,he),ci=!0),!We&&ci&&(mt&&(kt.end=rn+Dt*Xe),X.push(kt),kt=qe(ie)),mt&&(rn+=Dt)}var Mn=ie.length-3;Ln=ie[Mn],qn=ie[Mn+1],ni=ie[Mn+2],(Ui=0===Te?Ln:qn)>=F&&Ui<=he&&Xt(kt,Ln,qn,ni),Mn=kt.length-3,We&&Mn>=3&&(kt[Mn]!==kt[0]||kt[Mn+1]!==kt[1])&&Xt(kt,kt[0],kt[1],kt[2]),kt.length&&X.push(kt)}function qe(ie){var X=[];return X.size=ie.size,X.start=ie.start,X.end=ie.end,X}function Rt(ie,X,F,he,Te,We){for(var mt=0;mt<ie.length;mt++)me(ie[mt],X,F,he,Te,We,!1)}function Xt(ie,X,F,he){ie.push(X),ie.push(F),ie.push(he)}function Xn(ie,X,F,he,Te,We){var mt=(We-X)/(he-X);return ie.push(We),ie.push(F+(Te-F)*mt),ie.push(1),mt}function Ki(ie,X,F,he,Te,We){var mt=(We-F)/(Te-F);return ie.push(X+(he-X)*mt),ie.push(We),ie.push(1),mt}function Di(ie,X){for(var F=[],he=0;he<ie.length;he++){var Te,We=ie[he],mt=We.type;if("Point"===mt||"MultiPoint"===mt||"LineString"===mt)Te=gi(We.geometry,X);else if("MultiLineString"===mt||"Polygon"===mt){Te=[];for(var Dt=0;Dt<We.geometry.length;Dt++)Te.push(gi(We.geometry[Dt],X))}else if("MultiPolygon"===mt)for(Te=[],Dt=0;Dt<We.geometry.length;Dt++){for(var Xe=[],kt=0;kt<We.geometry[Dt].length;kt++)Xe.push(gi(We.geometry[Dt][kt],X));Te.push(Xe)}F.push(ji(We.id,mt,Te,We.tags))}return F}function gi(ie,X){var F=[];F.size=ie.size,void 0!==ie.start&&(F.start=ie.start,F.end=ie.end);for(var he=0;he<ie.length;he+=3)F.push(ie[he]+X,ie[he+1],ie[he+2]);return F}function fi(ie,X){if(ie.transformed)return ie;var F,he,Te,We=1<<ie.z,mt=ie.x,Dt=ie.y;for(F=0;F<ie.features.length;F++){var Xe=ie.features[F],kt=Xe.geometry,tn=Xe.type;if(Xe.geometry=[],1===tn)for(he=0;he<kt.length;he+=2)Xe.geometry.push(Cr(kt[he],kt[he+1],X,We,mt,Dt));else for(he=0;he<kt.length;he++){var rn=[];for(Te=0;Te<kt[he].length;Te+=2)rn.push(Cr(kt[he][Te],kt[he][Te+1],X,We,mt,Dt));Xe.geometry.push(rn)}}return ie.transformed=!0,ie}function Cr(ie,X,F,he,Te,We){return[Math.round(F*(ie*he-Te)),Math.round(F*(X*he-We))]}function Vi(ie,X,F,he,Te){for(var We=X===Te.maxZoom?0:Te.tolerance/((1<<X)*Te.extent),mt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:F,y:he,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Dt=0;Dt<ie.length;Dt++){mt.numFeatures++,gr(mt,ie[Dt],We,Te);var Xe=ie[Dt].minX,kt=ie[Dt].minY,tn=ie[Dt].maxX,rn=ie[Dt].maxY;Xe<mt.minX&&(mt.minX=Xe),kt<mt.minY&&(mt.minY=kt),tn>mt.maxX&&(mt.maxX=tn),rn>mt.maxY&&(mt.maxY=rn)}return mt}function gr(ie,X,F,he){var Te=X.geometry,We=X.type,mt=[];if("Point"===We||"MultiPoint"===We)for(var Dt=0;Dt<Te.length;Dt+=3)mt.push(Te[Dt]),mt.push(Te[Dt+1]),ie.numPoints++,ie.numSimplified++;else if("LineString"===We)Pi(mt,Te,ie,F,!1,!1);else if("MultiLineString"===We||"Polygon"===We)for(Dt=0;Dt<Te.length;Dt++)Pi(mt,Te[Dt],ie,F,"Polygon"===We,0===Dt);else if("MultiPolygon"===We)for(var Xe=0;Xe<Te.length;Xe++){var kt=Te[Xe];for(Dt=0;Dt<kt.length;Dt++)Pi(mt,kt[Dt],ie,F,!0,0===Dt)}if(mt.length){var tn=X.tags||null;if("LineString"===We&&he.lineMetrics){for(var rn in tn={},X.tags)tn[rn]=X.tags[rn];tn.mapbox_clip_start=Te.start/Te.size,tn.mapbox_clip_end=Te.end/Te.size}var pn={geometry:mt,type:"Polygon"===We||"MultiPolygon"===We?3:"LineString"===We||"MultiLineString"===We?2:1,tags:tn};null!==X.id&&(pn.id=X.id),ie.features.push(pn)}}function Pi(ie,X,F,he,Te,We){var mt=he*he;if(he>0&&X.size<(Te?mt:he))F.numPoints+=X.length/3;else{for(var Dt=[],Xe=0;Xe<X.length;Xe+=3)(0===he||X[Xe+2]>mt)&&(F.numSimplified++,Dt.push(X[Xe]),Dt.push(X[Xe+1])),F.numPoints++;Te&&function(kt,tn){for(var rn=0,pn=0,Ln=kt.length,qn=Ln-2;pn<Ln;qn=pn,pn+=2)rn+=(kt[pn]-kt[qn])*(kt[pn+1]+kt[qn+1]);if(rn>0===tn)for(pn=0,Ln=kt.length;pn<Ln/2;pn+=2){var ni=kt[pn],Hn=kt[pn+1];kt[pn]=kt[Ln-2-pn],kt[pn+1]=kt[Ln-1-pn],kt[Ln-2-pn]=ni,kt[Ln-1-pn]=Hn}}(Dt,We),ie.push(Dt)}}function Br(ie,X){var F=(X=this.options=function(Te,We){for(var mt in We)Te[mt]=We[mt];return Te}(Object.create(this.options),X)).debug;if(F&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var Te,We,mt,Dt,Xe,kt,he=function(Te,We){var mt=[];if("FeatureCollection"===Te.type)for(var Dt=0;Dt<Te.features.length;Dt++)xi(mt,Te.features[Dt],We,Dt);else xi(mt,"Feature"===Te.type?Te:{geometry:Te},We);return mt}(ie,X);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Te=he,We=X,mt=We.buffer/We.extent,Dt=Te,Xe=Pe(Te,1,-1-mt,mt,0,-1,2,We),kt=Pe(Te,1,1-mt,2+mt,0,-1,2,We),(Xe||kt)&&(Dt=Pe(Te,1,-mt,1+mt,0,-1,2,We)||[],Xe&&(Dt=Di(Xe,1).concat(Dt)),kt&&(Dt=Dt.concat(Di(kt,-1)))),he=Dt).length&&this.splitTile(he,0,0,0),F&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ei(ie,X,F){return 32*((1<<ie)*F+X)+ie}function Rr(ie,X){const F=ie.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);const he=this._geoJSONIndex.getTile(F.z,F.x,F.y);if(!he)return X(null,null);const Te=new ge(he.features);let We=ke(Te);0===We.byteOffset&&We.byteLength===We.buffer.byteLength||(We=new Uint8Array(We)),X(null,{vectorTile:Te,rawData:We.buffer})}Br.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Br.prototype.splitTile=function(ie,X,F,he,Te,We,mt){for(var Dt=[ie,X,F,he],Xe=this.options,kt=Xe.debug;Dt.length;){he=Dt.pop(),F=Dt.pop(),X=Dt.pop(),ie=Dt.pop();var tn=1<<X,rn=Ei(X,F,he),pn=this.tiles[rn];if(!pn&&(kt>1&&console.time("creation"),pn=this.tiles[rn]=Vi(ie,X,F,he,Xe),this.tileCoords.push({z:X,x:F,y:he}),kt)){kt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,F,he,pn.numFeatures,pn.numPoints,pn.numSimplified),console.timeEnd("creation"));var Ln="z"+X;this.stats[Ln]=(this.stats[Ln]||0)+1,this.total++}if(pn.source=ie,Te){if(X===Xe.maxZoom||X===Te)continue;var qn=1<<Te-X;if(F!==Math.floor(We/qn)||he!==Math.floor(mt/qn))continue}else if(X===Xe.indexMaxZoom||pn.numPoints<=Xe.indexMaxPoints)continue;if(pn.source=null,0!==ie.length){kt>1&&console.time("clipping");var ni,Hn,ii,Ui,Fi,ci,Mn=.5*Xe.buffer/Xe.extent,mi=.5-Mn,Ii=.5+Mn,Zi=1+Mn;ni=Hn=ii=Ui=null,Fi=Pe(ie,tn,F-Mn,F+Ii,0,pn.minX,pn.maxX,Xe),ci=Pe(ie,tn,F+mi,F+Zi,0,pn.minX,pn.maxX,Xe),ie=null,Fi&&(ni=Pe(Fi,tn,he-Mn,he+Ii,1,pn.minY,pn.maxY,Xe),Hn=Pe(Fi,tn,he+mi,he+Zi,1,pn.minY,pn.maxY,Xe),Fi=null),ci&&(ii=Pe(ci,tn,he-Mn,he+Ii,1,pn.minY,pn.maxY,Xe),Ui=Pe(ci,tn,he+mi,he+Zi,1,pn.minY,pn.maxY,Xe),ci=null),kt>1&&console.timeEnd("clipping"),Dt.push(ni||[],X+1,2*F,2*he),Dt.push(Hn||[],X+1,2*F,2*he+1),Dt.push(ii||[],X+1,2*F+1,2*he),Dt.push(Ui||[],X+1,2*F+1,2*he+1)}}},Br.prototype.getTile=function(ie,X,F){var he=this.options,Te=he.extent,We=he.debug;if(ie<0||ie>24)return null;var mt=1<<ie,Dt=Ei(ie,X=(X%mt+mt)%mt,F);if(this.tiles[Dt])return fi(this.tiles[Dt],Te);We>1&&console.log("drilling down to z%d-%d-%d",ie,X,F);for(var Xe,kt=ie,tn=X,rn=F;!Xe&&kt>0;)kt--,tn=Math.floor(tn/2),rn=Math.floor(rn/2),Xe=this.tiles[Ei(kt,tn,rn)];return Xe&&Xe.source?(We>1&&console.log("found parent tile z%d-%d-%d",kt,tn,rn),We>1&&console.time("drilling down"),this.splitTile(Xe.source,kt,tn,rn,ie,X,F),We>1&&console.timeEnd("drilling down"),this.tiles[Dt]?fi(this.tiles[Dt],Te):null):null};class _n extends l.VectorTileWorkerSource{constructor(X,F,he,Te,We){super(X,F,he,Te,Rr),We&&(this.loadGeoJSON=We)}loadData(X,F){const he=X&&X.request,Te=he&&he.collectResourceTiming;this.loadGeoJSON(X,(We,mt)=>{if(We||!mt)return F(We);if("object"!=typeof mt)return F(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{V(mt,!0);try{if(X.filter){const Xe=l.createExpression(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Xe.result)throw new Error(Xe.value.map(tn=>`${tn.key}: ${tn.message}`).join(", "));const kt=mt.features.filter(tn=>Xe.value.evaluate({zoom:0},tn));mt={type:"FeatureCollection",features:kt}}this._geoJSONIndex=X.cluster?new Yt(function({superclusterOptions:Xe,clusterProperties:kt}){if(!kt||!Xe)return Xe;const tn={},rn={},pn={accumulated:null,zoom:0},Ln={properties:null},qn=Object.keys(kt);for(const ni of qn){const[Hn,ii]=kt[ni],Ui=l.createExpression(ii),Fi=l.createExpression("string"==typeof Hn?[Hn,["accumulated"],["get",ni]]:Hn);tn[ni]=Ui.value,rn[ni]=Fi.value}return Xe.map=ni=>{Ln.properties=ni;const Hn={};for(const ii of qn)Hn[ii]=tn[ii].evaluate(pn,Ln);return Hn},Xe.reduce=(ni,Hn)=>{Ln.properties=Hn;for(const ii of qn)pn.accumulated=ni[ii],ni[ii]=rn[ii].evaluate(pn,Ln)},Xe}(X)).load(mt.features):new Br(Xe=mt,X.geojsonVtOptions)}catch(Xe){return F(Xe)}this.loaded={};const Dt={};if(Te){const Xe=l.getPerformanceMeasurement(he);Xe&&(Dt.resourceTiming={},Dt.resourceTiming[X.source]=JSON.parse(JSON.stringify(Xe)))}F(null,Dt)}var Xe})}reloadTile(X,F){const he=this.loaded;return he&&he[X.uid]?super.reloadTile(X,F):this.loadTile(X,F)}loadGeoJSON(X,F){if(X.request)l.getJSON(X.request,F);else{if("string"!=typeof X.data)return F(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));try{return F(null,JSON.parse(X.data))}catch{return F(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(X,F){try{F(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(he){F(he)}}getClusterChildren(X,F){try{F(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(he){F(he)}}getClusterLeaves(X,F){try{F(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(he){F(he)}}}class tr{constructor(X){this.self=X,this.actor=new l.Actor(X,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=l.getProjection({name:"mercator"}),this.workerSourceTypes={vector:l.VectorTileWorkerSource,geojson:_n},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(F,he)=>{if(this.workerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.workerSourceTypes[F]=he},this.self.registerRTLTextPlugin=F=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=F.applyArabicShaping,l.plugin.processBidirectionalText=F.processBidirectionalText,l.plugin.processStyledBidirectionalText=F.processStyledBidirectionalText}}clearCaches(X,F,he){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],he()}checkIfReady(X,F,he){he()}setReferrer(X,F){this.referrer=F}spriteLoaded(X,F){this.isSpriteLoaded[X]=F;for(const he in this.workerSources[X]){const Te=this.workerSources[X][he];for(const We in Te)Te[We]instanceof l.VectorTileWorkerSource&&(Te[We].isSpriteLoaded=F,Te[We].fire(new l.Event("isSpriteLoaded")))}}setImages(X,F,he){this.availableImages[X]=F;for(const Te in this.workerSources[X]){const We=this.workerSources[X][Te];for(const mt in We)We[mt].availableImages=F}he()}enableTerrain(X,F,he){this.terrain=F,he()}setProjection(X,F){this.projections[X]=l.getProjection(F)}setLayers(X,F,he){this.getLayerIndex(X).replace(F),he()}updateLayers(X,F,he){this.getLayerIndex(X).update(F.layers,F.removedIds),he()}loadTile(X,F,he){const Te=this.enableTerrain?l.extend({enableTerrain:this.terrain},F):F;Te.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,F.type,F.source).loadTile(Te,he)}loadDEMTile(X,F,he){const Te=this.enableTerrain?l.extend({buildQuadTree:this.terrain},F):F;this.getDEMWorkerSource(X,F.source).loadTile(Te,he)}reloadTile(X,F,he){const Te=this.enableTerrain?l.extend({enableTerrain:this.terrain},F):F;Te.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,F.type,F.source).reloadTile(Te,he)}abortTile(X,F,he){this.getWorkerSource(X,F.type,F.source).abortTile(F,he)}removeTile(X,F,he){this.getWorkerSource(X,F.type,F.source).removeTile(F,he)}removeSource(X,F,he){if(!this.workerSources[X]||!this.workerSources[X][F.type]||!this.workerSources[X][F.type][F.source])return;const Te=this.workerSources[X][F.type][F.source];delete this.workerSources[X][F.type][F.source],void 0!==Te.removeSource?Te.removeSource(F,he):he()}loadWorkerSource(X,F,he){try{this.self.importScripts(F.url),he()}catch(Te){he(Te.toString())}}syncRTLPluginState(X,F,he){try{l.plugin.setState(F);const Te=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&null!=Te){this.self.importScripts(Te);const We=l.plugin.isParsed();he(We?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Te}`),We)}}catch(Te){he(Te.toString())}}getAvailableImages(X){let F=this.availableImages[X];return F||(F=[]),F}getLayerIndex(X){let F=this.layerIndexes[X];return F||(F=this.layerIndexes[X]=new m),F}getWorkerSource(X,F,he){return this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][F]||(this.workerSources[X][F]={}),this.workerSources[X][F][he]||(this.workerSources[X][F][he]=new this.workerSourceTypes[F]({send:(Te,We,mt,Dt,Xe,kt)=>{this.actor.send(Te,We,mt,X,Xe,kt)},scheduler:this.actor.scheduler},this.getLayerIndex(X),this.getAvailableImages(X),this.isSpriteLoaded[X])),this.workerSources[X][F][he]}getDEMWorkerSource(X,F){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][F]||(this.demWorkerSources[X][F]=new ue),this.demWorkerSources[X][F]}enforceCacheSizeLimit(X,F){l.enforceCacheSizeLimit(F)}getWorkerPerformanceMetrics(X,F,he){he(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new tr(self)),tr}),d(0,function(l){var L=P;function P(g){return n=g,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,T=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(T);try{x=new Worker(I),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(I),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var T=x.getImageData(0,0,1,1);return T&&T.width===_.width}()||(void 0===m[c=n&&n.failIfMajorPerformanceCaveat]&&(m[c]=function(_){var x,I,k,W,T=(I=_,k=document.createElement("canvas"),(W=Object.create(P.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,k.getContext("webgl",W)||k.getContext("experimental-webgl",W));if(!T)return!1;try{x=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!x||T.isContextLost())&&(T.shaderSource(x,"void main() {}"),T.compileShader(x),!0===T.getShaderParameter(x,T.COMPILE_STATUS))}(c)),!m[c]||document.documentMode));var n,c}var m={};function $(g,n){var c=n[0],_=n[1],x=n[2],T=n[3],I=c*T-x*_;return I?(g[0]=T*(I=1/I),g[1]=-_*I,g[2]=-x*I,g[3]=c*I,g):null}function ue(g,n){if(Array.isArray(g)){if(!Array.isArray(n)||g.length!==n.length)return!1;for(let c=0;c<g.length;c++)if(!ue(g[c],n[c]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==n){if("object"!=typeof n||Object.keys(g).length!==Object.keys(n).length)return!1;for(const c in g)if(!ue(g[c],n[c]))return!1;return!0}return g===n}P.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const V={create:function(g,n,c){const _=l.window.document.createElement(g);return void 0!==n&&(_.className=n),c&&c.appendChild(_),_},createSVG:function(g,n,c){const _=l.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const x of Object.keys(n))_.setAttributeNS(null,x,n[x]);return c&&c.appendChild(_),_}},Z=l.window.document&&l.window.document.documentElement.style,K=Z&&void 0!==Z.userSelect?"userSelect":"WebkitUserSelect";let re;V.disableDrag=function(){Z&&K&&(re=Z[K],Z[K]="none")},V.enableDrag=function(){Z&&K&&(Z[K]=re)};const _e=function(g){g.preventDefault(),g.stopPropagation(),l.window.removeEventListener("click",_e,!0)};function ge(g,n,c){const _=g.offsetWidth===n.width?1:g.offsetWidth/n.width;return new l.pointGeometry((c.clientX-n.left)*_,(c.clientY-n.top)*_)}function xe(g){const{userImage:n}=g;return!!(n&&n.render&&n.render())&&(g.data.replace(new Uint8Array(n.data.buffer)),!0)}V.suppressClick=function(){l.window.addEventListener("click",_e,!0),l.window.setTimeout(()=>{l.window.removeEventListener("click",_e,!0)},0)},V.mousePos=function(g,n){const c=g.getBoundingClientRect();return ge(g,c,n)},V.touchPos=function(g,n){const c=g.getBoundingClientRect(),_=[];for(let x=0;x<n.length;x++)_.push(ge(g,c,n[x]));return _},V.mouseButton=function(g){return void 0!==l.window.InstallTrigger&&2===g.button&&g.ctrlKey&&l.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button};class je extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:c,callback:_}of this.requestors)this._notify(c,_);this.requestors=[]}}getImage(n){return this.images[n]}addImage(n,c){this._validate(n,c)&&(this.images[n]=c)}_validate(n,c){let _=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),_=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),_=!1),this._validateContent(c.content,c)||(this.fire(new l.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),_=!1),_}_validateStretch(n,c){if(!n)return!0;let _=0;for(const x of n){if(x[0]<_||x[1]<x[0]||c<x[1])return!1;_=x[1]}return!0}_validateContent(n,c){return!(n&&(4!==n.length||n[0]<0||c.data.width<n[0]||n[1]<0||c.data.height<n[1]||n[2]<0||c.data.width<n[2]||n[3]<0||c.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,c){c.version=this.images[n].version+1,this.images[n]=c,this.updatedImages[n]=!0}removeImage(n){const c=this.images[n];delete this.images[n],delete this.patterns[n],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,c){let _=!0;if(!this.isLoaded())for(const x of n)this.images[x]||(_=!1);this.isLoaded()||_?this._notify(n,c):this.requestors.push({ids:n,callback:c})}_notify(n,c){const _={};for(const x of n){this.images[x]||this.fire(new l.Event("styleimagemissing",{id:x}));const T=this.images[x];T?_[x]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:Boolean(T.userImage&&T.userImage.render)}:l.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,_)}getPixelSize(){const{width:n,height:c}=this.atlasImage;return{width:n,height:c}}getPattern(n){const c=this.patterns[n],_=this.getImage(n);if(!_)return null;if(c&&c.position.version===_.version)return c.position;if(c)c.position.version=_.version;else{const x={w:_.data.width+2,h:_.data.height+2,x:0,y:0},T=new l.ImagePosition(x,_);this.patterns[n]={bin:x,position:T}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const c=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.Texture(n,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const T in this.patterns)n.push(this.patterns[T].bin);const{w:c,h:_}=l.potpack(n),x=this.atlasImage;x.resize({width:c||1,height:_||1});for(const T in this.patterns){const{bin:I}=this.patterns[T],k=I.x+1,W=I.y+1,ne=this.images[T].data,le=ne.width,pe=ne.height;l.RGBAImage.copy(ne,x,{x:0,y:0},{x:k,y:W},{width:le,height:pe}),l.RGBAImage.copy(ne,x,{x:0,y:pe-1},{x:k,y:W-1},{width:le,height:1}),l.RGBAImage.copy(ne,x,{x:0,y:0},{x:k,y:W+pe},{width:le,height:1}),l.RGBAImage.copy(ne,x,{x:le-1,y:0},{x:k-1,y:W},{width:1,height:pe}),l.RGBAImage.copy(ne,x,{x:0,y:0},{x:k+le,y:W},{width:1,height:pe})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const c of n){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const _=this.images[c];xe(_)&&this.updateImage(c,_)}}}const nt=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(g,n){return function([c,_,x]){const T=l.degToRad(_+90),I=l.degToRad(x);return{x:c*Math.cos(T)*Math.sin(I),y:c*Math.sin(T)*Math.sin(I),z:c*Math.cos(I),azimuthal:_,polar:x}}(g.expression.evaluate(n))}interpolate(g,n,c){return{x:l.number(g.x,n.x,c),y:l.number(g.y,n.y,c),z:l.number(g.z,n.z,c),azimuthal:l.number(g.azimuthal,n.azimuthal,c),polar:l.number(g.polar,n.polar,c)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),Fe="-transition";class ke extends l.Evented{constructor(n){super(),this._transitionable=new l.Transitionable(nt),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,c={}){if(!this._validate(l.validateLight,n,c))for(const _ in n){const x=n[_];l.endsWith(_,Fe)?this._transitionable.setTransition(_.slice(0,-Fe.length),x):this._transitionable.setValue(_,x)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,_){return(!_||!1!==_.validate)&&l.emitValidationErrors(this,n.call(l.validateStyle,l.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}const Ne=new l.Properties({source:new l.DataConstantProperty(l.spec.terrain.source),exaggeration:new l.DataConstantProperty(l.spec.terrain.exaggeration)}),$e="-transition";class Re extends l.Evented{constructor(n,c){super(),this._transitionable=new l.Transitionable(Ne),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(n){for(const c in n){const _=n[c];l.endsWith(c,$e)?this._transitionable.setTransition(c.slice(0,-$e.length),_):this._transitionable.setValue(c,_)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function _t(g,n,c,_){const x=l.smoothstep(45,65,c),[T,I]=Ge(g,_),k=l.length(n);let W=1-Math.min(1,Math.exp((k-T)/(I-T)*-6));return W*=W*W,W=Math.min(1,1.00747*W),W*x*g.alpha}function Ge(g,n){const c=.5/Math.tan(.5*n);return[g.range[0]+c,g.range[1]+c]}const ot=new l.Properties({range:new l.DataConstantProperty(l.spec.fog.range),color:new l.DataConstantProperty(l.spec.fog.color),"horizon-blend":new l.DataConstantProperty(l.spec.fog["horizon-blend"])}),yt="-transition";class wt extends l.Evented{constructor(n,c){super(),this._transitionable=new l.Transitionable(ot),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,c={}){if(!this._validate(l.validateFog,n,c))for(const _ in n){const x=n[_];l.endsWith(_,yt)?this._transitionable.setTransition(_.slice(0,-yt.length),x):this._transitionable.setValue(_,x)}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return l.smoothstep(45,65,n)*c.a}getOpacityAtLatLng(n,c){return this._transform.projection.supportsFog?function(_,x,T){const I=l.MercatorCoordinate.fromLngLat(x),k=T.elevation?T.elevation.getAtPointOrZero(I):0,W=[I.x,I.y,k];return l.transformMat4(W,W,T.mercatorFogMatrix),_t(_,W,T.pitch,T._fov)}(this.state,n,c):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Ge(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,_){return(!_||!1!==_.validate)&&l.emitValidationErrors(this,n.call(l.validateStyle,l.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class xt{constructor(n,c){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const _=this.workerPool.acquire(this.id);for(let x=0;x<_.length;x++){const T=new xt.Actor(_[x],c,this.id);T.name=`Worker ${x}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,c,_){l.asyncAll(this.actors,(x,T)=>{x.send(n,c,T)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function dt(g,n,c){return n*(l.EXTENT/(g.tileSize*Math.pow(2,c-g.tileID.overscaledZ)))}xt.Actor=l.Actor;class At{constructor(n,c,_){this.context=n;const x=n.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Vt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Un{constructor(n,c,_,x){this.length=c.length,this.attributes=_,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.context=n;const T=n.gl;this.buffer=T.createBuffer(),n.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,c){for(let _=0;_<this.attributes.length;_++){const x=c.attributes[this.attributes[_].name];void 0!==x&&n.enableVertexAttribArray(x)}}setVertexAttribPointers(n,c,_){for(let x=0;x<this.attributes.length;x++){const T=this.attributes[x],I=c.attributes[T.name];void 0!==I&&n.vertexAttribPointer(I,T.components,n[Vt[T.type]],!1,this.itemSize,T.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class St{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class $t extends St{getDefault(){return l.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class zt extends St{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Ht extends St{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class en extends St{getDefault(){return[!0,!0,!0,!0]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Kt extends St{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Wt extends St{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Yt extends St{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const c=this.current;(n.func!==c.func||n.ref!==c.ref||n.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class qt extends St{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Gt extends St{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=n,this.dirty=!1}}class ft extends St{getDefault(){return[0,1]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Ut extends St{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=n,this.dirty=!1}}class On extends St{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class fn extends St{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.BLEND):c.disable(c.BLEND),this.current=n,this.dirty=!1}}class Gn extends St{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class ei extends St{getDefault(){return l.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class $i extends St{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class sr extends St{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=n,this.dirty=!1}}class zi extends St{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class yi extends St{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class ji extends St{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class _i extends St{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class xi extends St{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Qt extends St{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Ye extends St{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class te extends St{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Ae extends St{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ut extends St{getDefault(){return null}set(n){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Pe extends St{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Nt extends St{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class me extends St{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class qe extends St{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Rt extends St{constructor(n,c){super(n),this.context=n,this.parent=c}getDefault(){return null}}class Xt extends Rt{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Xn extends Rt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ki extends Xn{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Di{constructor(n,c,_,x){this.context=n,this.width=c,this.height=_;const T=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Xt(n,T),x&&(this.depthAttachment=new Xn(n,T))}destroy(){const n=this.context.gl,c=this.colorAttachment.get();if(c&&n.deleteTexture(c),this.depthAttachment){const _=this.depthAttachment.get();_&&n.deleteRenderbuffer(_)}n.deleteFramebuffer(this.framebuffer)}}class gi{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new $t(this),this.clearDepth=new zt(this),this.clearStencil=new Ht(this),this.colorMask=new en(this),this.depthMask=new Kt(this),this.stencilMask=new Wt(this),this.stencilFunc=new Yt(this),this.stencilOp=new qt(this),this.stencilTest=new Gt(this),this.depthRange=new ft(this),this.depthTest=new Ut(this),this.depthFunc=new On(this),this.blend=new fn(this),this.blendFunc=new Gn(this),this.blendColor=new ei(this),this.blendEquation=new $i(this),this.cullFace=new sr(this),this.cullFaceSide=new zi(this),this.frontFace=new yi(this),this.program=new ji(this),this.activeTexture=new _i(this),this.viewport=new xi(this),this.bindFramebuffer=new Qt(this),this.bindRenderbuffer=new Ye(this),this.bindTexture=new te(this),this.bindVertexBuffer=new Ae(this),this.bindElementBuffer=new ut(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Pe(this),this.pixelStoreUnpack=new Nt(this),this.pixelStoreUnpackPremultiplyAlpha=new me(this),this.pixelStoreUnpackFlipY=new qe(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,c){return new At(this,n,c)}createVertexBuffer(n,c,_){return new Un(this,n,c,_)}createRenderbuffer(n,c,_){const x=this.gl,T=x.createRenderbuffer();return this.bindRenderbuffer.set(T),x.renderbufferStorage(x.RENDERBUFFER,n,c,_),this.bindRenderbuffer.set(null),T}createFramebuffer(n,c,_){return new Di(this,n,c,_)}clear({color:n,depth:c,stencil:_}){const x=this.gl;let T=0;n&&(T|=x.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(T|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==_&&(T|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),x.clear(T)}setCullFace(n){!1===n.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){ue(n.blendFunction,l.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class fi{constructor(n,c,_,x){this.screenBounds=n,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(T=>x.pointCoordinate3D(T)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(n,c){let _,x;if(n instanceof l.pointGeometry||"number"==typeof n[0]){const T=l.pointGeometry.convert(n);_=[l.pointGeometry.convert(n)],x=c.isPointAboveHorizon(T)}else{const T=l.pointGeometry.convert(n[0]),I=l.pointGeometry.convert(n[1]);_=[T,I],x=l.polygonizeBounds(T,I).every(k=>c.isPointAboveHorizon(k))}return new fi(_,c.getCameraPoint(),x,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(n){return l.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const c=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new l.pointGeometry(1,1)):this.screenBounds[1],x=l.polygonizeBounds(c,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(x[3]=this.cameraPoint)),l.bufferConvexPolygon(x,n)}containsTile(n,c,_){const x=n.queryPadding+1,T=n.tileID.wrap,I=_?this._bufferedCameraMercator(x,c).map(Be=>l.getTilePoint(n.tileTransform,Be,T)):this._bufferedScreenMercator(x,c).map(Be=>l.getTilePoint(n.tileTransform,Be,T)),k=this.screenGeometryMercator.map(Be=>l.getTileVec3(n.tileTransform,Be,T)),W=k.map(Be=>new l.pointGeometry(Be[0],Be[1])),ne=c.getFreeCameraOptions().position||new l.MercatorCoordinate(0,0,0),le=l.getTileVec3(n.tileTransform,ne,T),pe=k.map(Be=>{const Ve=l.sub(Be,Be,le);return l.normalize(Ve,Ve),new l.Ray(le,Ve)}),De=dt(n,1,c.zoom);if(l.polygonIntersectsBox(I,0,0,l.EXTENT,l.EXTENT))return{queryGeometry:this,tilespaceGeometry:W,tilespaceRays:pe,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(Ze=l.getBounds(I),Ze.min.x=l.clamp(Ze.min.x,0,l.EXTENT),Ze.min.y=l.clamp(Ze.min.y,0,l.EXTENT),Ze.max.x=l.clamp(Ze.max.x,0,l.EXTENT),Ze.max.y=l.clamp(Ze.max.y,0,l.EXTENT),Ze),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:De};var Ze}_bufferedScreenMercator(n,c){const _=Cr(n);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{const x=this.bufferedScreenGeometry(n).map(T=>c.pointCoordinate3D(T));return this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(n,c){const _=Cr(n);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{const x=this.bufferedCameraGeometry(n).map(T=>c.pointCoordinate3D(T));return this._cameraRaycastCache[_]=x,x}}}function Cr(g){return 100*g|0}function Vi(g,n,c){const _=function(x,T){if(x)return c(x);if(T){const I=l.pick(l.extend(T,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(I.vectorLayers=T.vector_layers,I.vectorLayerIds=I.vectorLayers.map(k=>k.id)),I.tiles=n.canonicalizeTileset(I,g.url),c(null,I)}};return g.url?l.getJSON(n.transformRequest(n.normalizeSourceURL(g.url),l.ResourceType.Source),_):l.exported.frame(()=>_(null,g))}class gr{constructor(n,c,_){this.bounds=l.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=c||0,this.maxzoom=_||24}validateBounds(n){return Array.isArray(n)&&4===n.length?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const c=Math.pow(2,n.z),_=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*c),x=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*c),T=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*c),I=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*c);return n.x>=_&&n.x<T&&n.y>=x&&n.y<I}}class Pi extends l.Evented{constructor(n,c,_,x){super(),this.id=n,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},c),l.extend(this,l.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Vi(this._options,this.map._requestManager,(n,c)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new l.ErrorEvent(n)):c&&(l.extend(this,c),c.bounds&&(this.tileBounds=new gr(c.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(c.tiles),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,c){const _=l.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);n.request=l.getImage(this.map._requestManager.transformRequest(x,l.ResourceType.Tile),(T,I,k,W)=>{if(delete n.request,n.aborted)n.state="unloaded",c(null);else if(T)n.state="errored",c(T);else if(I){this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:k,expires:W});const ne=this.map.painter.context,le=ne.gl;n.texture=this.map.painter.getTileTexture(I.width),n.texture?n.texture.update(I,{useMipmap:!0}):(n.texture=new l.Texture(ne,I,le.RGBA,{useMipmap:!0}),n.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE),ne.extTextureFilterAnisotropic&&le.texParameterf(le.TEXTURE_2D,ne.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ne.extTextureFilterAnisotropicMax)),n.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),c(null)}})}abortTile(n,c){n.request&&(n.request.cancel(),delete n.request),c()}unloadTile(n,c){n.texture&&this.map.painter.saveTileTexture(n.texture),c()}hasTransition(){return!1}}let Br;function Ei(g,n,c,_,x,T,I,k){const W=[g,c,x,n,_,T,1,1,1],ne=[I,k,1],le=l.adjoint([],W),[pe,De,Ze]=l.transformMat3(ne,ne,l.transpose(le,le));return l.multiply(W,[pe,0,0,0,De,0,0,0,Ze],W)}class Rr extends l.Evented{constructor(n,c,_,x){super(),this.id=n,this.dispatcher=_,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=c}load(n,c){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(_,x)=>{this._loaded=!0,_?this.fire(new l.ErrorEvent(_)):x&&(this.image=l.exported.getImageData(x),this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}setCoordinates(n){this.coordinates=n,delete this._boundsArray;const c=n.map(l.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let x=1/0,T=1/0,I=-1/0,k=-1/0;for(const pe of _)x=Math.min(x,pe.x),T=Math.min(T,pe.y),I=Math.max(I,pe.x),k=Math.max(k,pe.y);const W=Math.max(I-x,k-T),ne=Math.max(0,Math.floor(-Math.log(W)/Math.LN2)),le=Math.pow(2,ne);return new l.CanonicalTileID(ne,Math.floor((x+I)/2*le),Math.floor((T+k)/2*le))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const n=l.tileTransform(this.tileID,this.map.transform.projection),[c,_,x,T]=this.coordinates.map(I=>{const k=n.projection.project(I[0],I[1]);return l.getTilePoint(n,k)._round()});return this.perspectiveTransform=function(I,k,W,ne,le,pe,De,Ze,Be,Ve){const ct=Ei(0,0,I,0,0,k,I,k),ze=Ei(W,ne,le,pe,De,Ze,Be,Ve);return l.multiply(ze,l.adjoint(ct,ct),ze),[ze[6]/ze[8]*I/l.EXTENT,ze[7]/ze[8]*k/l.EXTENT]}(this.width,this.height,c.x,c.y,_.x,_.y,T.x,T.y,x.x,x.y),this._boundsArray=new l.StructArrayLayout4i8,this._boundsArray.emplaceBack(c.x,c.y,0,0),this._boundsArray.emplaceBack(_.x,_.y,l.EXTENT,0),this._boundsArray.emplaceBack(T.x,T.y,0,l.EXTENT),this._boundsArray.emplaceBack(x.x,x.y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const n=this.map.painter.context,c=n.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,l.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new l.Texture(n,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const _ in this.tiles){const x=this.tiles[_];"loaded"!==x.state&&(x.state="loaded",x.texture=this.texture)}}loadTile(n,c){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},c(null)):(n.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const _n={vector:class extends l.Evented{constructor(g,n,c,_){if(super(),this.id=g,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(n,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new l.DedupedRequest}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Vi(this._options,this.map._requestManager,(g,n)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new l.ErrorEvent(g)):n&&(l.extend(this,n),n.bounds&&(this.tileBounds=new gr(n.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(n.tiles,this.map._requestManager._customAccessToken),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}onAdd(g){this.map=g,this.load()}setSourceProperty(g){this._tileJSONRequest&&this._tileJSONRequest.cancel(),g();const n=this.map.style._getSourceCaches(this.id);for(const c of n)c.clearTiles();this.load()}setTiles(g){return this.setSourceProperty(()=>{this._options.tiles=g}),this}setUrl(g){return this.setSourceProperty(()=>{this.url=g,this._options.url=g}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(g,n){const c=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(c,l.ResourceType.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:g.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,g.actor&&"expired"!==g.state)"loading"===g.state?g.reloadCallback=n:g.request=g.actor.send("reloadTile",_,x.bind(this));else if(g.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)g.request=g.actor.send("loadTile",_,x.bind(this),void 0,!0);else{const T=l.loadVectorTile.call({deduped:this._deduped},_,(I,k)=>{I||!k?x.call(this,I):(_.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},g.actor&&g.actor.send("loadTile",_,x.bind(this),void 0,!0))},!0);g.request={cancel:T}}function x(T,I){return delete g.request,g.aborted?n(null):T&&404!==T.status?n(T):(I&&I.resourceTiming&&(g.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&g.setExpiryData(I),g.loadVectorData(I,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(g.reloadCallback&&(this.loadTile(g,g.reloadCallback),g.reloadCallback=null)))}}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.actor&&g.actor.send("abortTile",{uid:g.uid,type:this.type,source:this.id})}unloadTile(g){g.unloadVectorData(),g.actor&&g.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Pi,"raster-dem":class extends Pi{constructor(g,n,c,_){super(g,n,c,_),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(g,n){const c=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,T){x&&(g.state="errored",n(x)),T&&(g.dem=T,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",n(null))}g.request=l.getImage(this.map._requestManager.transformRequest(c,l.ResourceType.Tile),function(x,T,I,k){if(delete g.request,g.aborted)g.state="unloaded",n(null);else if(x)g.state="errored",n(x);else if(T){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:I,expires:k});const W=l.window.ImageBitmap&&T instanceof l.window.ImageBitmap&&(null==Br&&(Br=l.window.OffscreenCanvas&&new l.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof l.window.createImageBitmap),Br),ne=1-(T.width-l.prevPowerOfTwo(T.width))/2;ne<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const le=W?T:l.exported.getImageData(T,ne),pe={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:le,encoding:this.encoding,padding:ne};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",pe,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const n=g.canonical,c=Math.pow(2,n.z),_=(n.x-1+c)%c,x=0===n.x?g.wrap-1:g.wrap,T=(n.x+1+c)%c,I=n.x+1===c?g.wrap+1:g.wrap,k={};return k[new l.OverscaledTileID(g.overscaledZ,x,n.z,_,n.y).key]={backfilled:!1},k[new l.OverscaledTileID(g.overscaledZ,I,n.z,T,n.y).key]={backfilled:!1},n.y>0&&(k[new l.OverscaledTileID(g.overscaledZ,x,n.z,_,n.y-1).key]={backfilled:!1},k[new l.OverscaledTileID(g.overscaledZ,g.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},k[new l.OverscaledTileID(g.overscaledZ,I,n.z,T,n.y-1).key]={backfilled:!1}),n.y+1<c&&(k[new l.OverscaledTileID(g.overscaledZ,x,n.z,_,n.y+1).key]={backfilled:!1},k[new l.OverscaledTileID(g.overscaledZ,g.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},k[new l.OverscaledTileID(g.overscaledZ,I,n.z,T,n.y+1).key]={backfilled:!1}),k}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends l.Evented{constructor(g,n,c,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(_),this._data=n.data,this._options=l.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const x=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*x,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*x,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:l.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*x,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},n),this}getClusterChildren(g,n){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},n),this}getClusterLeaves(g,n,c,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:n,offset:c},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new l.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=l.extend({},this.workerOptions),n=this._data;"string"==typeof n?(g.request=this.map._requestManager.transformRequest(l.exported.resolveURL(n),l.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(c,_)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new l.ErrorEvent(c));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),this.fire(new l.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,n){const c=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(c,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,x)=>(delete g.request,g.unloadVectorData(),g.aborted?n(null):_?n(_):(g.loadVectorData(x,this.map.painter,"reloadTile"===c),n(null))),void 0,"loadTile"===c)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Rr{constructor(g,n,c,_){super(g,n,c,_),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const n of g.urls)this.urls.push(this.map._requestManager.transformRequest(n,l.ResourceType.Source).url);l.getVideo(this.urls,(n,c)=>{this._loaded=!0,n?this.fire(new l.ErrorEvent(n)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const n=this.video.seekable;g<n.start(0)||g>n.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,n=g.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new l.Texture(g,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,l.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2));for(const c in this.tiles){const _=this.tiles[c];"loaded"!==_.state&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Rr,canvas:class extends Rr{constructor(g,n,c,_){super(g,n,c,_),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(T=>"number"!=typeof T))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof l.window.HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof l.window.HTMLCanvasElement?this.options.canvas:l.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,c=n.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,l.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.Texture(n,this.canvas,c.RGBA,{premultiply:!0});for(const _ in this.tiles){const x=this.tiles[_];"loaded"!==x.state&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}}},tr=function(g,n,c,_){const x=new _n[n.type](g,n,c,_);if(x.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${x.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],x),x};function ie(g,n){const c=l.identity([]);return l.scale(c,c,[.5*g.width,.5*-g.height,1]),l.translate(c,c,[1,-1,0]),l.multiply$1(c,c,g.calculateProjMatrix(n.toUnwrapped()))}function X(g,n,c,_,x,T,I,k=!1){const W=g.tilesIn(_,I,k);W.sort(he);const ne=[];for(const pe of W)ne.push({wrappedTileID:pe.tile.tileID.wrapped().key,queryResults:pe.tile.queryRenderedFeatures(n,c,g._state,pe,x,T,ie(g.transform,pe.tile.tileID),k)});const le=function(pe){const De={},Ze={};for(const Be of pe){const Ve=Be.queryResults,ct=Be.wrappedTileID,ze=Ze[ct]=Ze[ct]||{};for(const at in Ve){const ht=Ve[at],rt=ze[at]=ze[at]||{},st=De[at]=De[at]||[];for(const gt of ht)rt[gt.featureIndex]||(rt[gt.featureIndex]=!0,st.push(gt))}}return De}(ne);for(const pe in le)le[pe].forEach(De=>{const Ze=De.feature,Be=g.getFeatureState(Ze.layer["source-layer"],Ze.id);Ze.source=Ze.layer.source,Ze.layer["source-layer"]&&(Ze.sourceLayer=Ze.layer["source-layer"]),Ze.state=Be});return le}function F(g,n){const c=g.getRenderableIds().map(T=>g.getTileByID(T)),_=[],x={};for(let T=0;T<c.length;T++){const I=c[T],k=I.tileID.canonical.key;x[k]||(x[k]=!0,I.querySourceFeatures(_,n))}return _}function he(g,n){const c=g.tileID,_=n.tileID;return c.overscaledZ-_.overscaledZ||c.canonical.y-_.canonical.y||c.wrap-_.wrap||c.canonical.x-_.canonical.x}function Te(){return null!=Ol.workerClass?new Ol.workerClass:new l.window.Worker(Ol.workerUrl)}const We="mapboxgl_preloaded_worker_pool";class mt{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<mt.workerCount;)this.workers.push(new Te);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[We]}numActive(){return Object.keys(this.active).length}}let Dt;function Xe(){return Dt||(Dt=new mt),Dt}function kt(g,n){const c={};for(const _ in g)"ref"!==_&&(c[_]=g[_]);return l.refProperties.forEach(_=>{_ in n&&(c[_]=n[_])}),c}function tn(g){g=g.slice();const n=Object.create(null);for(let c=0;c<g.length;c++)n[g[c].id]=g[c];for(let c=0;c<g.length;c++)"ref"in g[c]&&(g[c]=kt(g[c],n[g[c].ref]));return g}mt.workerCount=2;const rn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function pn(g,n,c){c.push({command:rn.addSource,args:[g,n[g]]})}function Ln(g,n,c){n.push({command:rn.removeSource,args:[g]}),c[g]=!0}function qn(g,n,c,_){Ln(g,c,_),pn(g,n,c)}function ni(g,n,c){let _;for(_ in g[c])if(g[c].hasOwnProperty(_)&&"data"!==_&&!ue(g[c][_],n[c][_]))return!1;for(_ in n[c])if(n[c].hasOwnProperty(_)&&"data"!==_&&!ue(g[c][_],n[c][_]))return!1;return!0}function Hn(g,n,c,_,x,T){let I;for(I in n=n||{},g=g||{})g.hasOwnProperty(I)&&(ue(g[I],n[I])||c.push({command:T,args:[_,I,n[I],x]}));for(I in n)n.hasOwnProperty(I)&&!g.hasOwnProperty(I)&&(ue(g[I],n[I])||c.push({command:T,args:[_,I,n[I],x]}))}function ii(g){return g.id}function Ui(g,n){return g[n.id]=n,g}class Fi{constructor(n,c){this.reset(n,c)}reset(n,c){this.points=n||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(1===this.points.length)return this.points[0];n=l.clamp(n,0,1);let c=1,_=this._distances[c];const x=n*this.paddedLength+this.padding;for(;_<x&&c<this._distances.length;)_=this._distances[++c];const T=c-1,I=this._distances[T],k=_-I,W=k>0?(x-I)/k:0;return this.points[T].mult(1-W).add(this.points[c].mult(W))}}class ci{constructor(n,c,_){const x=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(n/_),this.yCellCount=Math.ceil(c/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)x.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=c,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,c,_,x,T){this._forEachCell(c,_,x,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(c),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(T)}insertCircle(n,c,_,x){this._forEachCell(c-x,_-x,c+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(c),this.circles.push(_),this.circles.push(x)}_insertBoxCell(n,c,_,x,T,I){this.boxCells[T].push(I)}_insertCircleCell(n,c,_,x,T,I){this.circleCells[T].push(I)}_query(n,c,_,x,T,I){if(_<0||n>this.width||x<0||c>this.height)return!T&&[];const k=[];if(n<=0&&c<=0&&this.width<=_&&this.height<=x){if(T)return!0;for(let W=0;W<this.boxKeys.length;W++)k.push({key:this.boxKeys[W],x1:this.bboxes[4*W],y1:this.bboxes[4*W+1],x2:this.bboxes[4*W+2],y2:this.bboxes[4*W+3]});for(let W=0;W<this.circleKeys.length;W++){const ne=this.circles[3*W],le=this.circles[3*W+1],pe=this.circles[3*W+2];k.push({key:this.circleKeys[W],x1:ne-pe,y1:le-pe,x2:ne+pe,y2:le+pe})}return I?k.filter(I):k}return this._forEachCell(n,c,_,x,this._queryCell,k,{hitTest:T,seenUids:{box:{},circle:{}}},I),T?k.length>0:k}_queryCircle(n,c,_,x,T){const I=n-_,k=n+_,W=c-_,ne=c+_;if(k<0||I>this.width||ne<0||W>this.height)return!x&&[];const le=[];return this._forEachCell(I,W,k,ne,this._queryCellCircle,le,{hitTest:x,circle:{x:n,y:c,radius:_},seenUids:{box:{},circle:{}}},T),x?le.length>0:le}query(n,c,_,x,T){return this._query(n,c,_,x,!1,T)}hitTest(n,c,_,x,T){return this._query(n,c,_,x,!0,T)}hitTestCircle(n,c,_,x){return this._queryCircle(n,c,_,!0,x)}_queryCell(n,c,_,x,T,I,k,W){const ne=k.seenUids,le=this.boxCells[T];if(null!==le){const De=this.bboxes;for(const Ze of le)if(!ne.box[Ze]){ne.box[Ze]=!0;const Be=4*Ze;if(n<=De[Be+2]&&c<=De[Be+3]&&_>=De[Be+0]&&x>=De[Be+1]&&(!W||W(this.boxKeys[Ze]))){if(k.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[Ze],x1:De[Be],y1:De[Be+1],x2:De[Be+2],y2:De[Be+3]})}}}const pe=this.circleCells[T];if(null!==pe){const De=this.circles;for(const Ze of pe)if(!ne.circle[Ze]){ne.circle[Ze]=!0;const Be=3*Ze;if(this._circleAndRectCollide(De[Be],De[Be+1],De[Be+2],n,c,_,x)&&(!W||W(this.circleKeys[Ze]))){if(k.hitTest)return I.push(!0),!0;{const Ve=De[Be],ct=De[Be+1],ze=De[Be+2];I.push({key:this.circleKeys[Ze],x1:Ve-ze,y1:ct-ze,x2:Ve+ze,y2:ct+ze})}}}}}_queryCellCircle(n,c,_,x,T,I,k,W){const ne=k.circle,le=k.seenUids,pe=this.boxCells[T];if(null!==pe){const Ze=this.bboxes;for(const Be of pe)if(!le.box[Be]){le.box[Be]=!0;const Ve=4*Be;if(this._circleAndRectCollide(ne.x,ne.y,ne.radius,Ze[Ve+0],Ze[Ve+1],Ze[Ve+2],Ze[Ve+3])&&(!W||W(this.boxKeys[Be])))return I.push(!0),!0}}const De=this.circleCells[T];if(null!==De){const Ze=this.circles;for(const Be of De)if(!le.circle[Be]){le.circle[Be]=!0;const Ve=3*Be;if(this._circlesCollide(Ze[Ve],Ze[Ve+1],Ze[Ve+2],ne.x,ne.y,ne.radius)&&(!W||W(this.circleKeys[Be])))return I.push(!0),!0}}}_forEachCell(n,c,_,x,T,I,k,W){const ne=this._convertToXCellCoord(n),le=this._convertToYCellCoord(c),pe=this._convertToXCellCoord(_),De=this._convertToYCellCoord(x);for(let Ze=ne;Ze<=pe;Ze++)for(let Be=le;Be<=De;Be++)if(T.call(this,n,c,_,x,this.xCellCount*Be+Ze,I,k,W))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,c,_,x,T,I){const k=x-n,W=T-c,ne=_+I;return ne*ne>k*k+W*W}_circleAndRectCollide(n,c,_,x,T,I,k){const W=(I-x)/2,ne=Math.abs(n-(x+W));if(ne>W+_)return!1;const le=(k-T)/2,pe=Math.abs(c-(T+le));if(pe>le+_)return!1;if(ne<=W||pe<=le)return!0;const De=ne-W,Ze=pe-le;return De*De+Ze*Ze<=_*_}}const Mn=Math.tan(85*Math.PI/180);function mi(g,n,c,_,x,T){let I=l.create();if(c){if("globe"===x.projection.name)I=l.calculateGlobeMatrix(x,x.worldSize/x._projectionScaler,[0,0]),l.multiply$1(I,I,l.globeDenormalizeECEF(l.globeTileBounds(n)));else{const k=$([],T);I[0]=k[0],I[1]=k[1],I[4]=k[2],I[5]=k[3]}_||l.rotateZ(I,I,x.angle)}else l.multiply$1(I,x.labelPlaneMatrix,g);return I}function Ii(g,n,c,_,x,T){if(c){if("globe"===x.projection.name){const I=mi(g,n,c,_,x,T);return l.invert(I,I),l.multiply$1(I,g,I),I}{const I=l.clone(g),k=l.identity([]);return k[0]=T[0],k[1]=T[1],k[4]=T[2],k[5]=T[3],l.multiply$1(I,I,k),_||l.rotateZ(I,I,-x.angle),I}}return x.glCoordMatrix}function Zi(g,n,c=0){const _=[g.x,g.y,c,1];c?l.transformMat4$1(_,_,n):Lr(_,_,n);const x=_[3];return{point:new l.pointGeometry(_[0]/x,_[1]/x),signedDistanceFromCamera:x}}function cr(g,n){return Math.min(.5+g/n*.5,1.5)}function oi(g,n){const c=g[0]/g[3],_=g[1]/g[3];return c>=-n[0]&&c<=n[0]&&_>=-n[1]&&_<=n[1]}function _r(g,n,c,_,x,T,I,k,W,ne){const le=c.transform,pe=_?g.textSizeData:g.iconSizeData,De=l.evaluateSizeForZoom(pe,c.transform.zoom),Ze=[256/c.width*2+1,256/c.height*2+1],Be=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;Be.clear();const Ve=g.lineVertexArray,ct=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,ze=c.transform.width/c.transform.height;let at=!1;for(let ht=0;ht<ct.length;ht++){const rt=ct.get(ht);if(rt.writingMode!==l.WritingMode.vertical||at||0!==ht&&ct.get(ht-1).writingMode===l.WritingMode.horizontal||(at=!0),rt.hidden||rt.writingMode===l.WritingMode.vertical&&!at){Pr(rt.numGlyphs,Be);continue}at=!1;const st=new l.pointGeometry(rt.tileAnchorX,rt.tileAnchorY),gt=W?W(st):[0,0,0],Zt=le.projection.projectTilePoint(st.x,st.y,ne.canonical),on=[Zt.x+gt[0],Zt.y+gt[1],Zt.z+gt[2]],zn=[...on,1];if(l.transformMat4$1(zn,zn,n),!oi(zn,Ze)){Pr(rt.numGlyphs,Be);continue}const An=cr(c.transform.cameraToCenterDistance,zn[3]),Dn=l.evaluateSizeForFeature(pe,De,rt),un=I?Dn/An:Dn*An,Jt=Zi(new l.pointGeometry(on[0],on[1]),x,on[2]);if(Jt.signedDistanceFromCamera<=0){Pr(rt.numGlyphs,Be);continue}let bn={};const yn=I?null:W,di=go(rt,un,!1,k,n,x,T,g.glyphOffsetArray,Ve,Be,Jt.point,st,bn,ze,yn,le.projection,ne);at=di.useVertical,yn&&di.needsFlipping&&(bn={}),(di.notEnoughRoom||at||di.needsFlipping&&go(rt,un,!0,k,n,x,T,g.glyphOffsetArray,Ve,Be,Jt.point,st,bn,ze,yn,le.projection,ne).notEnoughRoom)&&Pr(rt.numGlyphs,Be)}_?g.text.dynamicLayoutVertexBuffer.updateData(Be):g.icon.dynamicLayoutVertexBuffer.updateData(Be)}function ur(g,n,c,_,x,T,I,k,W,ne,le,pe,De,Ze,Be){const Ve=k.glyphStartIndex+k.numGlyphs,ct=k.lineStartIndex,ze=k.lineStartIndex+k.lineLength,at=n.getoffsetX(k.glyphStartIndex),ht=n.getoffsetX(Ve-1),rt=Hr(g*at,c,_,x,T,I,k.segment,ct,ze,W,ne,le,pe,De,!0,Ze,Be);if(!rt)return null;const st=Hr(g*ht,c,_,x,T,I,k.segment,ct,ze,W,ne,le,pe,De,!0,Ze,Be);return st?{first:rt,last:st}:null}function Nr(g,n,c,_){return g.writingMode===l.WritingMode.horizontal&&Math.abs(c.y-n.y)>Math.abs(c.x-n.x)*_?{useVertical:!0}:g.writingMode===l.WritingMode.vertical?n.y<c.y?{needsFlipping:!0}:null:0!==g.flipState&&function(x,T,I){const k=(T.x-x.x)*I;return 0===k||Math.abs((T.y-x.y)/k)>Mn}(n,c,_)?1===g.flipState?{needsFlipping:!0}:null:n.x>c.x?{needsFlipping:!0}:null}function go(g,n,c,_,x,T,I,k,W,ne,le,pe,De,Ze,Be,Ve,ct){const ze=n/24,at=g.lineOffsetX*ze,ht=g.lineOffsetY*ze;let rt;if(g.numGlyphs>1){const st=g.glyphStartIndex+g.numGlyphs,gt=g.lineStartIndex,Zt=g.lineStartIndex+g.lineLength,on=ur(ze,k,at,ht,c,le,pe,g,W,T,De,Be,!1,Ve,ct);if(!on)return{notEnoughRoom:!0};const zn=Zi(on.first.point,I).point,An=Zi(on.last.point,I).point;if(_&&!c){const Dn=Nr(g,zn,An,Ze);if(g.flipState=Dn&&Dn.needsFlipping?1:2,Dn)return Dn}rt=[on.first];for(let Dn=g.glyphStartIndex+1;Dn<st-1;Dn++)rt.push(Hr(ze*k.getoffsetX(Dn),at,ht,c,le,pe,g.segment,gt,Zt,W,T,De,Be,!1,!1,Ve,ct));rt.push(on.last)}else{if(_&&!c){const gt=Zi(pe,x).point,Zt=g.lineStartIndex+g.segment+1,on=new l.pointGeometry(W.getx(Zt),W.gety(Zt)),zn=Zi(on,x),An=Nr(g,gt,zn.signedDistanceFromCamera>0?zn.point:ao(pe,on,gt,1,x,void 0,Ve,ct.canonical),Ze);if(g.flipState=An&&An.needsFlipping?1:2,An)return An}const st=Hr(ze*k.getoffsetX(g.glyphStartIndex),at,ht,c,le,pe,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,W,T,De,Be,!1,!1,Ve,ct);if(!st)return{notEnoughRoom:!0};rt=[st]}for(const st of rt)l.addDynamicAttributes(ne,st.point,st.angle);return{}}function bi(g,n,c,_,x){const T=_.projectTilePoint(g.x,g.y,n);if(!x)return Zi(T,c,T.z);const I=x(g);return Zi(new l.pointGeometry(T.x+I[0],T.y+I[1]),c,T.z+I[2])}function ao(g,n,c,_,x,T,I,k){const W=bi(g.add(g.sub(n)._unit()),k,x,I,T).point,ne=c.sub(W);return c.add(ne._mult(_/ne.mag()))}function Hr(g,n,c,_,x,T,I,k,W,ne,le,pe,De,Ze,Be,Ve,ct){const ze=_?g-n:g+n;let at=ze>0?1:-1,ht=0;_&&(at*=-1,ht=Math.PI),at<0&&(ht+=Math.PI);let rt=at>0?k+I:k+I+1,st=x,gt=x,Zt=0,on=0;const zn=Math.abs(ze),An=[],Dn=[];let un=T;const Jt=()=>{const Nn=rt-at;return 0===Zt?T:new l.pointGeometry(ne.getx(Nn),ne.gety(Nn))},bn=()=>ao(Jt(),un,gt,zn-Zt+1,le,De,Ve,ct.canonical);for(;Zt+on<=zn;){if(rt+=at,rt<k||rt>=W)return null;if(gt=st,An.push(st),Ze&&Dn.push(un||Jt()),st=pe[rt],void 0===st){un=new l.pointGeometry(ne.getx(rt),ne.gety(rt));const Nn=bi(un,ct.canonical,le,Ve,De);st=Nn.signedDistanceFromCamera>0?pe[rt]=Nn.point:bn()}else un=null;Zt+=on,on=gt.dist(st)}Be&&De&&(un=un||new l.pointGeometry(ne.getx(rt),ne.gety(rt)),pe[rt]=st=void 0===pe[rt]?st:bn(),on=gt.dist(st));const yn=(zn-Zt)/on,di=st.sub(gt),Mi=di.mult(yn)._add(gt);c&&Mi._add(di._unit()._perp()._mult(c*at));const rr=ht+Math.atan2(st.y-gt.y,st.x-gt.x);return An.push(Mi),Ze&&(un=un||new l.pointGeometry(ne.getx(rt),ne.gety(rt)),Dn.push(function(Nn,vi,Yi){const Ar=1-Yi;return new l.pointGeometry(Nn.x*Ar+vi.x*Yi,Nn.y*Ar+vi.y*Yi)}(Dn.length>0?Dn[Dn.length-1]:un,un,yn))),{point:Mi,angle:rr,path:An,tilePath:Dn}}const Jr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Pr(g,n){for(let c=0;c<g;c++){const _=n.length;n.resize(_+4),n.float32.set(Jr,3*_)}}function Lr(g,n,c){const _=n[0],x=n[1];return g[0]=c[0]*_+c[4]*x+c[12],g[1]=c[1]*_+c[5]*x+c[13],g[3]=c[3]*_+c[7]*x+c[15],g}const Vr=100;class Ee{constructor(n,c,_=new ci(n.width+200,n.height+200,25),x=new ci(n.width+200,n.height+200,25)){this.transform=n,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Vr,this.screenBottomBoundary=n.height+Vr,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=c}placeCollisionBox(n,c,_,x,T,I,k){let W=c.projectedAnchorX,ne=c.projectedAnchorY,le=c.projectedAnchorZ;const pe=c.elevation,De=c.tileID;if(pe&&De){const rt=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),st=rt.upVector(De.canonical,c.tileAnchorX,c.tileAnchorY),gt=rt.upVectorScale(De.canonical);W+=st[0]*pe*gt,ne+=st[1]*pe*gt,le+=st[2]*pe*gt}const Ze=this.projectAndGetPerspectiveRatio(I,W,ne,le,c.tileID),Be=T*Ze.perspectiveRatio,Ve=(c.x1*n+_.x-c.padding)*Be+Ze.point.x,ct=(c.y1*n+_.y-c.padding)*Be+Ze.point.y,ze=(c.x2*n+_.x+c.padding)*Be+Ze.point.x,at=(c.y2*n+_.y+c.padding)*Be+Ze.point.y,ht=Ze.perspectiveRatio<=.55||Ze.aboveHorizon;return!this.isInsideGrid(Ve,ct,ze,at)||!x&&this.grid.hitTest(Ve,ct,ze,at,k)||ht?{box:[],offscreen:!1}:{box:[Ve,ct,ze,at],offscreen:this.isOffscreen(Ve,ct,ze,at)}}placeCollisionCircles(n,c,_,x,T,I,k,W,ne,le,pe,De,Ze,Be){const Ve=[],ct=this.transform.elevation,ze=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),at=ct?ct.getAtTileOffsetFunc(Be,ze):yn=>[0,0,0],ht=new l.pointGeometry(c.tileAnchorX,c.tileAnchorY),rt=this.transform.projection.projectTilePoint(c.tileAnchorX,c.tileAnchorY,Be.canonical),st=at(ht),gt=[rt.x+st[0],rt.y+st[1],rt.z+st[2]],Zt=this.projectAndGetPerspectiveRatio(I,gt[0],gt[1],gt[2],Be),{perspectiveRatio:on}=Zt,zn=(le?T/on:T*on)/l.ONE_EM,An=Zi(new l.pointGeometry(gt[0],gt[1]),k,gt[2]).point,Dn=Zt.signedDistanceFromCamera>0?ur(zn,x,c.lineOffsetX*zn,c.lineOffsetY*zn,!1,An,ht,c,_,k,{},ct&&!le?at:null,le&&!!ct,this.transform.projection,Be):null;let un=!1,Jt=!1,bn=!0;if(Dn&&!Zt.aboveHorizon){const yn=.5*De*on+Ze,di=new l.pointGeometry(-100,-100),Mi=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),rr=new Fi,Nn=Dn.first,vi=Dn.last;let Yi=[];for(let Gi=Nn.path.length-1;Gi>=1;Gi--)Yi.push(Nn.path[Gi]);for(let Gi=1;Gi<vi.path.length;Gi++)Yi.push(vi.path[Gi]);const Ar=2.5*yn;if(W){const Gi=Yi.map(ct?(Li,lo)=>{const jo=at(lo<Nn.path.length-1?Nn.tilePath[Nn.path.length-1-lo]:vi.tilePath[lo-Nn.path.length+2]);return Zi(Li,W,jo[2])}:Li=>Zi(Li,W));Yi=Gi.some(Li=>Li.signedDistanceFromCamera<=0)?[]:Gi.map(Li=>Li.point)}let Xr=[];if(Yi.length>0){const Gi=Yi[0].clone(),Li=Yi[0].clone();for(let lo=1;lo<Yi.length;lo++)Gi.x=Math.min(Gi.x,Yi[lo].x),Gi.y=Math.min(Gi.y,Yi[lo].y),Li.x=Math.max(Li.x,Yi[lo].x),Li.y=Math.max(Li.y,Yi[lo].y);Xr=Gi.x>=di.x&&Li.x<=Mi.x&&Gi.y>=di.y&&Li.y<=Mi.y?[Yi]:Li.x<di.x||Gi.x>Mi.x||Li.y<di.y||Gi.y>Mi.y?[]:l.clipLine([Yi],di.x,di.y,Mi.x,Mi.y)}for(const Gi of Xr){rr.reset(Gi,.25*yn);let Li=0;Li=rr.length<=.5*yn?1:Math.ceil(rr.paddedLength/Ar)+1;for(let lo=0;lo<Li;lo++){const jo=lo/Math.max(Li-1,1),ds=rr.lerp(jo),hs=ds.x+Vr,sa=ds.y+Vr;Ve.push(hs,sa,yn,0);const wr=hs-yn,Ji=sa-yn,or=hs+yn,no=sa+yn;if(bn=bn&&this.isOffscreen(wr,Ji,or,no),Jt=Jt||this.isInsideGrid(wr,Ji,or,no),!n&&this.grid.hitTestCircle(hs,sa,yn,pe)&&(un=!0,!ne))return{circles:[],offscreen:!1,collisionDetected:un}}}}return{circles:!ne&&un||!Jt?[]:Ve,offscreen:bn,collisionDetected:un}}queryRenderedSymbols(n){if(0===n.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let _=1/0,x=1/0,T=-1/0,I=-1/0;for(const le of n){const pe=new l.pointGeometry(le.x+Vr,le.y+Vr);_=Math.min(_,pe.x),x=Math.min(x,pe.y),T=Math.max(T,pe.x),I=Math.max(I,pe.y),c.push(pe)}const k=this.grid.query(_,x,T,I).concat(this.ignoredGrid.query(_,x,T,I)),W={},ne={};for(const le of k){const pe=le.key;if(void 0===W[pe.bucketInstanceId]&&(W[pe.bucketInstanceId]={}),W[pe.bucketInstanceId][pe.featureIndex])continue;const De=[new l.pointGeometry(le.x1,le.y1),new l.pointGeometry(le.x2,le.y1),new l.pointGeometry(le.x2,le.y2),new l.pointGeometry(le.x1,le.y2)];l.polygonIntersectsPolygon(c,De)&&(W[pe.bucketInstanceId][pe.featureIndex]=!0,void 0===ne[pe.bucketInstanceId]&&(ne[pe.bucketInstanceId]=[]),ne[pe.bucketInstanceId].push(pe.featureIndex))}return ne}insertCollisionBox(n,c,_,x,T){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:T},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,c,_,x,T){const I=c?this.ignoredGrid:this.grid,k={bucketInstanceId:_,featureIndex:x,collisionGroupID:T};for(let W=0;W<n.length;W+=4)I.insertCircle(k,n[W],n[W+1],n[W+2])}projectAndGetPerspectiveRatio(n,c,_,x,T){const I=[c,_,x||0,1];let k=!1;if(x||this.transform.pitch>0){l.transformMat4$1(I,I,n);let W=!1;this.fogState&&T&&(W=function(ne,le,pe,De,Ze,Be){const Ve=Be.calculateFogTileMatrix(Ze),ct=[le,pe,De];return l.transformMat4(ct,ct,Ve),_t(ne,ct,Be.pitch,Be._fov)}(this.fogState,c,_,x||0,T.toUnwrapped(),this.transform)>.9),k=I[2]>I[3]||W}else Lr(I,I,n);return{point:new l.pointGeometry((I[0]/I[3]+1)/2*this.transform.width+Vr,(-I[1]/I[3]+1)/2*this.transform.height+Vr),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/I[3]*.5,1.5),signedDistanceFromCamera:I[3],aboveHorizon:k}}isOffscreen(n,c,_,x){return _<Vr||n>=this.screenRightBoundary||x<Vr||c>this.screenBottomBoundary}isInsideGrid(n,c,_,x){return _>=0&&n<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const n=l.identity([]);return l.translate(n,n,[-100,-100,0]),n}}class He{constructor(n,c,_,x){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?c:-c))):x&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class Ce{constructor(n,c,_,x,T,I=!1){this.text=new He(n?n.text:null,c,_,T),this.icon=new He(n?n.icon:null,c,x,T),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class tt{constructor(n,c,_,x=!1){this.text=n,this.icon=c,this.skipFade=_,this.clipped=x}}class It{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class Lt{constructor(n,c,_,x,T){this.bucketInstanceId=n,this.featureIndex=c,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=T}}class nn{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const c=++this.maxGroupID;this.collisionGroups[n]={ID:c,predicate:_=>_.collisionGroupID===c}}return this.collisionGroups[n]}}function dn(g,n,c,_,x){const{horizontalAlign:T,verticalAlign:I}=l.getAnchorAlignment(g),k=-(T-.5)*n,W=-(I-.5)*c,ne=l.evaluateVariableOffset(g,_);return new l.pointGeometry(k+ne[0]*x,W+ne[1]*x)}function ln(g,n,c,_,x){const T=new l.pointGeometry(g,n);return c&&T._rotate(_?x:-x),T}class En{constructor(n,c,_,x,T){this.transform=n.clone(),this.collisionIndex=new Ee(this.transform,T),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new nn(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,c,_,x){const T=_.getBucket(c),I=_.latestFeatureIndex;if(!T||!I||c.id!==T.layerIds[0])return;const k=T.layers[0].layout,W=_.collisionBoxArray,ne=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),le=_.tileSize/l.EXTENT,pe=_.tileID.toUnwrapped(),De=this.transform.calculateProjMatrix(pe),Ze="map"===k.get("text-pitch-alignment"),Be="map"===k.get("text-rotation-alignment");c.compileFilter();const Ve=c.dynamicFilter(),ct=c.dynamicFilterNeedsFeature(),ze=this.transform.calculatePixelsToTileUnitsMatrix(_),at=mi(De,_.tileID.canonical,Ze,Be,this.transform,ze);let ht=null;if(Ze){const gt=Ii(De,_.tileID.canonical,Ze,Be,this.transform,ze);ht=l.multiply$1([],this.transform.labelPlaneMatrix,gt)}let rt=null;Ve&&_.latestFeatureIndex&&(rt={unwrappedTileID:pe,dynamicFilter:Ve,dynamicFilterNeedsFeature:ct,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new Lt(T.bucketInstanceId,I,T.sourceLayerIndex,T.index,_.tileID);const st={bucket:T,layout:k,posMatrix:De,textLabelPlaneMatrix:at,labelToScreenMatrix:ht,clippingData:rt,scale:ne,textPixelRatio:le,holdingForFade:_.holdingForFade(),collisionBoxArray:W,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:l.evaluateSizeForZoom(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(x)for(const gt of T.sortKeyRanges){const{sortKey:Zt,symbolInstanceStart:on,symbolInstanceEnd:zn}=gt;n.push({sortKey:Zt,symbolInstanceStart:on,symbolInstanceEnd:zn,parameters:st})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:st})}attemptAnchorPlacement(n,c,_,x,T,I,k,W,ne,le,pe,De,Ze,Be,Ve,ct,ze,at){const ht=[De.textOffset0,De.textOffset1],rt=dn(n,_,x,ht,T),st=this.collisionIndex.placeCollisionBox(T,c,ln(rt.x,rt.y,I,k,this.transform.angle),pe,W,ne,le.predicate);if((!ct||0!==this.collisionIndex.placeCollisionBox(Be.getSymbolInstanceIconSize(at,this.transform.zoom,Ze),ct,ln(rt.x,rt.y,I,k,this.transform.angle),pe,W,ne,le.predicate).box.length)&&st.box.length>0){let gt;return this.prevPlacement&&this.prevPlacement.variableOffsets[De.crossTileID]&&this.prevPlacement.placements[De.crossTileID]&&this.prevPlacement.placements[De.crossTileID].text&&(gt=this.prevPlacement.variableOffsets[De.crossTileID].anchor),this.variableOffsets[De.crossTileID]={textOffset:ht,width:_,height:x,anchor:n,textScale:T,prevAnchor:gt},this.markUsedJustification(Be,n,De,Ve),Be.allowVerticalPlacement&&(this.markUsedOrientation(Be,Ve,De),this.placedOrientations[De.crossTileID]=Ve),{shift:rt,placedGlyphBoxes:st}}}placeLayerBucketPart(n,c,_,x){const{bucket:T,layout:I,posMatrix:k,textLabelPlaneMatrix:W,labelToScreenMatrix:ne,clippingData:le,textPixelRatio:pe,holdingForFade:De,collisionBoxArray:Ze,partiallyEvaluatedTextSize:Be,partiallyEvaluatedIconSize:Ve,collisionGroup:ct}=n.parameters,ze=I.get("text-optional"),at=I.get("icon-optional"),ht=I.get("text-allow-overlap"),rt=I.get("icon-allow-overlap"),st="map"===I.get("text-rotation-alignment"),gt="map"===I.get("text-pitch-alignment"),Zt="none"!==I.get("icon-text-fit"),on="viewport-y"===I.get("symbol-z-order"),zn=ht&&(rt||!T.hasIconData()||at),An=rt&&(ht||!T.hasTextData()||ze);!T.collisionArrays&&Ze&&T.deserializeCollisionBoxes(Ze),_&&x&&T.updateCollisionDebugBuffers(this.transform.zoom,Ze);const Dn=(un,Jt,bn)=>{if(le){const wr={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ji=null;if(le.dynamicFilterNeedsFeature){const or=this.retainedQueryData[T.bucketInstanceId];Ji=le.featureIndex.loadFeature({featureIndex:un.featureIndex,bucketIndex:or.bucketIndex,sourceLayerIndex:or.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,le.dynamicFilter)(wr,Ji,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new l.pointGeometry(un.tileAnchorX,un.tileAnchorY),this.transform.calculateDistanceTileData(le.unwrappedTileID)))return this.placements[un.crossTileID]=new tt(!1,!1,!1,!0),void(c[un.crossTileID]=!0)}if(c[un.crossTileID])return;if(De)return void(this.placements[un.crossTileID]=new tt(!1,!1,!1));let yn=!1,di=!1,Mi=!0,rr=null,Nn={box:null,offscreen:null},vi={box:null,offscreen:null},Yi=null,Ar=null,Xr=null,Gi=0,Li=0,lo=0;bn.textFeatureIndex?Gi=bn.textFeatureIndex:un.useRuntimeCollisionCircles&&(Gi=un.featureIndex),bn.verticalTextFeatureIndex&&(Li=bn.verticalTextFeatureIndex);const jo=wr=>{wr.tileID=this.retainedQueryData[T.bucketInstanceId].tileID,(this.transform.elevation||wr.elevation)&&(wr.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[T.bucketInstanceId].tileID,wr.tileAnchorX,wr.tileAnchorY):0)},ds=bn.textBox;if(ds){jo(ds);const wr=or=>{let no=l.WritingMode.horizontal;if(T.allowVerticalPlacement&&!or&&this.prevPlacement){const Cs=this.prevPlacement.placedOrientations[un.crossTileID];Cs&&(this.placedOrientations[un.crossTileID]=Cs,no=Cs,this.markUsedOrientation(T,no,un))}return no},Ji=(or,no)=>{if(T.allowVerticalPlacement&&un.numVerticalGlyphVertices>0&&bn.verticalTextBox){for(const Cs of T.writingModes)if(Cs===l.WritingMode.vertical?(Nn=no(),vi=Nn):Nn=or(),Nn&&Nn.box&&Nn.box.length)break}else Nn=or()};if(I.get("text-variable-anchor")){let or=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[un.crossTileID]){const Gr=this.prevPlacement.variableOffsets[un.crossTileID];or.indexOf(Gr.anchor)>0&&(or=or.filter(Ps=>Ps!==Gr.anchor),or.unshift(Gr.anchor))}const no=(Gr,Ps,nc)=>{const ps=T.getSymbolInstanceTextSize(Be,un,this.transform.zoom,Jt),Ta=(Gr.x2-Gr.x1)*ps+2*Gr.padding,ai=(Gr.y2-Gr.y1)*ps+2*Gr.padding,Ti=Zt&&!rt?Ps:null;Ti&&jo(Ti);let Xo={box:[],offscreen:!1};const qs=ht?2*or.length:or.length;for(let Hs=0;Hs<qs;++Hs){const os=this.attemptAnchorPlacement(or[Hs%or.length],Gr,Ta,ai,ps,st,gt,pe,k,ct,Hs>=or.length,un,Jt,T,nc,Ti,Be,Ve);if(os&&(Xo=os.placedGlyphBoxes,Xo&&Xo.box&&Xo.box.length)){yn=!0,rr=os.shift;break}}return Xo};Ji(()=>no(ds,bn.iconBox,l.WritingMode.horizontal),()=>{const Gr=bn.verticalTextBox;return Gr&&jo(Gr),T.allowVerticalPlacement&&!(Nn&&Nn.box&&Nn.box.length)&&un.numVerticalGlyphVertices>0&&Gr?no(Gr,bn.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),Nn&&(yn=Nn.box,Mi=Nn.offscreen);const Cs=wr(Nn&&Nn.box);if(!yn&&this.prevPlacement){const Gr=this.prevPlacement.variableOffsets[un.crossTileID];Gr&&(this.variableOffsets[un.crossTileID]=Gr,this.markUsedJustification(T,Gr.anchor,un,Cs))}}else{const or=(no,Cs)=>{const Gr=T.getSymbolInstanceTextSize(Be,un,this.transform.zoom,Jt),Ps=this.collisionIndex.placeCollisionBox(Gr,no,new l.pointGeometry(0,0),ht,pe,k,ct.predicate);return Ps&&Ps.box&&Ps.box.length&&(this.markUsedOrientation(T,Cs,un),this.placedOrientations[un.crossTileID]=Cs),Ps};Ji(()=>or(ds,l.WritingMode.horizontal),()=>{const no=bn.verticalTextBox;return T.allowVerticalPlacement&&un.numVerticalGlyphVertices>0&&no?(jo(no),or(no,l.WritingMode.vertical)):{box:null,offscreen:null}}),wr(Nn&&Nn.box&&Nn.box.length)}}if(Yi=Nn,yn=Yi&&Yi.box&&Yi.box.length>0,Mi=Yi&&Yi.offscreen,un.useRuntimeCollisionCircles){const wr=T.text.placedSymbolArray.get(un.centerJustifiedTextSymbolIndex>=0?un.centerJustifiedTextSymbolIndex:un.verticalPlacedTextSymbolIndex),Ji=l.evaluateSizeForFeature(T.textSizeData,Be,wr),or=I.get("text-padding");Ar=this.collisionIndex.placeCollisionCircles(ht,wr,T.lineVertexArray,T.glyphOffsetArray,Ji,k,W,ne,_,gt,ct.predicate,un.collisionCircleDiameter*Ji/l.ONE_EM,or,this.retainedQueryData[T.bucketInstanceId].tileID),yn=ht||Ar.circles.length>0&&!Ar.collisionDetected,Mi=Mi&&Ar.offscreen}if(bn.iconFeatureIndex&&(lo=bn.iconFeatureIndex),bn.iconBox){const wr=Ji=>{jo(Ji);const or=Zt&&rr?ln(rr.x,rr.y,st,gt,this.transform.angle):new l.pointGeometry(0,0),no=T.getSymbolInstanceIconSize(Ve,this.transform.zoom,Jt);return this.collisionIndex.placeCollisionBox(no,Ji,or,rt,pe,k,ct.predicate)};vi&&vi.box&&vi.box.length&&bn.verticalIconBox?(Xr=wr(bn.verticalIconBox),di=Xr.box.length>0):(Xr=wr(bn.iconBox),di=Xr.box.length>0),Mi=Mi&&Xr.offscreen}const hs=ze||0===un.numHorizontalGlyphVertices&&0===un.numVerticalGlyphVertices,sa=at||0===un.numIconVertices;if(hs||sa?sa?hs||(di=di&&yn):yn=di&&yn:di=yn=di&&yn,yn&&Yi&&Yi.box&&this.collisionIndex.insertCollisionBox(Yi.box,I.get("text-ignore-placement"),T.bucketInstanceId,vi&&vi.box&&Li?Li:Gi,ct.ID),di&&Xr&&this.collisionIndex.insertCollisionBox(Xr.box,I.get("icon-ignore-placement"),T.bucketInstanceId,lo,ct.ID),Ar&&(yn&&this.collisionIndex.insertCollisionCircles(Ar.circles,I.get("text-ignore-placement"),T.bucketInstanceId,Gi,ct.ID),_)){const wr=T.bucketInstanceId;let Ji=this.collisionCircleArrays[wr];void 0===Ji&&(Ji=this.collisionCircleArrays[wr]=new It);for(let or=0;or<Ar.circles.length;or+=4)Ji.circles.push(Ar.circles[or+0]),Ji.circles.push(Ar.circles[or+1]),Ji.circles.push(Ar.circles[or+2]),Ji.circles.push(Ar.collisionDetected?1:0)}this.placements[un.crossTileID]=new tt(yn||zn,di||An,Mi||T.justReloaded),c[un.crossTileID]=!0};if(on){const un=T.getSortedSymbolIndexes(this.transform.angle);for(let Jt=un.length-1;Jt>=0;--Jt){const bn=un[Jt];Dn(T.symbolInstances.get(bn),bn,T.collisionArrays[bn])}}else for(let un=n.symbolInstanceStart;un<n.symbolInstanceEnd;un++)Dn(T.symbolInstances.get(un),un,T.collisionArrays[un]);if(_&&T.bucketInstanceId in this.collisionCircleArrays){const un=this.collisionCircleArrays[T.bucketInstanceId];l.invert(un.invProjMatrix,k),un.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(n,c,_,x){let T;T=x===l.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(c)];const I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const k of I)k>=0&&(n.text.placedSymbolArray.get(k).crossTileID=T>=0&&k!==T?0:_.crossTileID)}markUsedOrientation(n,c,_){const x=c===l.WritingMode.horizontal||c===l.WritingMode.horizontalOnly?c:0,T=c===l.WritingMode.vertical?c:0,I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const k of I)n.text.placedSymbolArray.get(k).placedOrientation=x;_.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=T)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let _=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(n):1,T=c?c.opacities:{},I=c?c.variableOffsets:{},k=c?c.placedOrientations:{};for(const W in this.placements){const ne=this.placements[W],le=T[W];le?(this.opacities[W]=new Ce(le,x,ne.text,ne.icon,null,ne.clipped),_=_||ne.text!==le.text.placed||ne.icon!==le.icon.placed):(this.opacities[W]=new Ce(null,x,ne.text,ne.icon,ne.skipFade,ne.clipped),_=_||ne.text||ne.icon)}for(const W in T){const ne=T[W];if(!this.opacities[W]){const le=new Ce(ne,x,!1,!1);le.isHidden()||(this.opacities[W]=le,_=_||ne.text.placed||ne.icon.placed)}}for(const W in I)this.variableOffsets[W]||!this.opacities[W]||this.opacities[W].isHidden()||(this.variableOffsets[W]=I[W]);for(const W in k)this.placedOrientations[W]||!this.opacities[W]||this.opacities[W].isHidden()||(this.placedOrientations[W]=k[W]);_?this.lastPlacementChangeTime=n:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:n)}updateLayerOpacities(n,c){const _={};for(const x of c){const T=x.getBucket(n);T&&x.latestFeatureIndex&&n.id===T.layerIds[0]&&this.updateBucketOpacities(T,_,x.collisionBoxArray)}}updateBucketOpacities(n,c,_){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const x=n.layers[0].layout,T=!!n.layers[0].dynamicFilter(),I=new Ce(null,0,!1,!1,!0),k=x.get("text-allow-overlap"),W=x.get("icon-allow-overlap"),ne=x.get("text-variable-anchor"),le="map"===x.get("text-rotation-alignment"),pe="map"===x.get("text-pitch-alignment"),De="none"!==x.get("icon-text-fit"),Ze=new Ce(null,0,k&&(W||!n.hasIconData()||x.get("icon-optional")),W&&(k||!n.hasTextData()||x.get("text-optional")),!0);!n.collisionArrays&&_&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(_);const Be=(ct,ze,at)=>{for(let ht=0;ht<ze/4;ht++)ct.opacityVertexArray.emplaceBack(at)};let Ve=0;for(let ct=0;ct<n.symbolInstances.length;ct++){const ze=n.symbolInstances.get(ct),{numHorizontalGlyphVertices:at,numVerticalGlyphVertices:ht,crossTileID:rt}=ze;let st=this.opacities[rt];c[rt]?st=I:st||(st=Ze,this.opacities[rt]=st),c[rt]=!0;const gt=at>0||ht>0,Zt=ze.numIconVertices>0,on=this.placedOrientations[ze.crossTileID],zn=on===l.WritingMode.vertical,An=on===l.WritingMode.horizontal||on===l.WritingMode.horizontalOnly;if(!gt&&!Zt||st.isHidden()||Ve++,gt){const Dn=vo(st.text);Be(n.text,at,zn?_o:Dn),Be(n.text,ht,An?_o:Dn);const un=st.text.isHidden();[ze.rightJustifiedTextSymbolIndex,ze.centerJustifiedTextSymbolIndex,ze.leftJustifiedTextSymbolIndex].forEach(yn=>{yn>=0&&(n.text.placedSymbolArray.get(yn).hidden=un||zn?1:0)}),ze.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(ze.verticalPlacedTextSymbolIndex).hidden=un||An?1:0);const Jt=this.variableOffsets[ze.crossTileID];Jt&&this.markUsedJustification(n,Jt.anchor,ze,on);const bn=this.placedOrientations[ze.crossTileID];bn&&(this.markUsedJustification(n,"left",ze,bn),this.markUsedOrientation(n,bn,ze))}if(Zt){const Dn=vo(st.icon);ze.placedIconSymbolIndex>=0&&(Be(n.icon,ze.numIconVertices,zn?_o:Dn),n.icon.placedSymbolArray.get(ze.placedIconSymbolIndex).hidden=st.icon.isHidden()),ze.verticalPlacedIconSymbolIndex>=0&&(Be(n.icon,ze.numVerticalIconVertices,An?_o:Dn),n.icon.placedSymbolArray.get(ze.verticalPlacedIconSymbolIndex).hidden=st.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Dn=n.collisionArrays[ct];if(Dn){let un=new l.pointGeometry(0,0),Jt=!0;if(Dn.textBox||Dn.verticalTextBox){if(ne){const yn=this.variableOffsets[rt];yn?(un=dn(yn.anchor,yn.width,yn.height,yn.textOffset,yn.textScale),le&&un._rotate(pe?this.transform.angle:-this.transform.angle)):Jt=!1}T&&(Jt=!st.clipped),Dn.textBox&&$n(n.textCollisionBox.collisionVertexArray,st.text.placed,!Jt||zn,un.x,un.y),Dn.verticalTextBox&&$n(n.textCollisionBox.collisionVertexArray,st.text.placed,!Jt||An,un.x,un.y)}const bn=Jt&&Boolean(!An&&Dn.verticalIconBox);Dn.iconBox&&$n(n.iconCollisionBox.collisionVertexArray,st.icon.placed,bn,De?un.x:0,De?un.y:0),Dn.verticalIconBox&&$n(n.iconCollisionBox.collisionVertexArray,st.icon.placed,!bn,De?un.x:0,De?un.y:0)}}}if(n.fullyClipped=0===Ve,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const ct=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=ct.invProjMatrix,n.placementViewportMatrix=ct.viewportMatrix,n.collisionCircleArray=ct.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return 0===this.fadeDuration?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,c){const _=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*_>n}setStale(){this.stale=!0}}function $n(g,n,c,_,x){g.emplaceBack(n?1:0,c?1:0,_||0,x||0),g.emplaceBack(n?1:0,c?1:0,_||0,x||0),g.emplaceBack(n?1:0,c?1:0,_||0,x||0),g.emplaceBack(n?1:0,c?1:0,_||0,x||0)}const Ot=Math.pow(2,25),cn=Math.pow(2,24),ki=Math.pow(2,17),$r=Math.pow(2,16),Hi=Math.pow(2,9),Er=Math.pow(2,8),nr=Math.pow(2,1);function vo(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const n=g.placed?1:0,c=Math.floor(127*g.opacity);return c*Ot+n*cn+c*ki+n*$r+c*Hi+n*Er+c*nr+n}const _o=0;class Zn{constructor(n){this._sortAcrossTiles="viewport-y"!==n.layout.get("symbol-z-order")&&void 0!==n.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,c,_,x,T){const I=this._bucketParts;for(;this._currentTileIndex<n.length;)if(c.getBucketParts(I,x,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((k,W)=>k.sortKey-W.sortKey));this._currentPartIndex<I.length;){const k=I[this._currentPartIndex];if(c.placeLayerBucketPart(k,this._seenCrossTileIDs,_,0===k.symbolInstanceStart),this._currentPartIndex++,T())return!0}return!1}}class Wi{constructor(n,c,_,x,T,I,k,W){this.placement=new En(n,T,I,k,W),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(n,c,_){const x=l.exported.now(),T=()=>{const I=l.exported.now()-x;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=c[n[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=k)&&(!I.maxzoom||I.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new Zn(I)),this._inProgressLayer.continuePlacement(_[I.source],this.placement,this._showCollisionBoxes,I,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Ai=512/l.EXTENT/2;class Oo{constructor(n,c,_){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let x=0;x<c.length;x++){const T=c.get(x),I=T.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:T.crossTileID,coord:this.getScaledCoordinates(T,n)})}}getScaledCoordinates(n,c){const _=Ai/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*l.EXTENT+n.tileAnchorX)*_),y:Math.floor((c.canonical.y*l.EXTENT+n.tileAnchorY)*_)}}findMatches(n,c,_){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let T=0;T<n.length;T++){const I=n.get(T);if(I.crossTileID)continue;const k=this.indexedSymbolInstances[I.key];if(!k)continue;const W=this.getScaledCoordinates(I,c);for(const ne of k)if(Math.abs(ne.coord.x-W.x)<=x&&Math.abs(ne.coord.y-W.y)<=x&&!_[ne.crossTileID]){_[ne.crossTileID]=!0,I.crossTileID=ne.crossTileID;break}}}}class it{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ke{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const c=Math.round((n-this.lng)/360);if(0!==c)for(const _ in this.indexes){const x=this.indexes[_],T={};for(const I in x){const k=x[I];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+c),T[k.tileID.key]=k}this.indexes[_]=T}this.lng=n}addBucket(n,c,_){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let T=0;T<c.symbolInstances.length;T++)c.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const x=this.usedCrossTileIDs[n.overscaledZ];for(const T in this.indexes){const I=this.indexes[T];if(Number(T)>n.overscaledZ)for(const k in I){const W=I[k];W.tileID.isChildOf(n)&&W.findMatches(c.symbolInstances,n,x)}else{const k=I[n.scaledTo(Number(T)).key];k&&k.findMatches(c.symbolInstances,n,x)}}for(let T=0;T<c.symbolInstances.length;T++){const I=c.symbolInstances.get(T);I.crossTileID||(I.crossTileID=_.generate(),x[I.crossTileID]=!0)}return void 0===this.indexes[n.overscaledZ]&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Oo(n,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(n,c){for(const _ in c.indexedSymbolInstances)for(const x of c.indexedSymbolInstances[_])delete this.usedCrossTileIDs[n][x.crossTileID]}removeStaleBuckets(n){let c=!1;for(const _ in this.indexes){const x=this.indexes[_];for(const T in x)n[x[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[T]),delete x[T],c=!0)}return c}}class Se{constructor(){this.layerIndexes={},this.crossTileIDs=new it,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,c,_,x){let T=this.layerIndexes[n.id];void 0===T&&(T=this.layerIndexes[n.id]=new Ke);let I=!1;const k={};"globe"!==x.name&&T.handleWrapJump(_);for(const W of c){const ne=W.getBucket(n);ne&&n.id===ne.layerIds[0]&&(ne.bucketInstanceId||(ne.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(W.tileID,ne,this.crossTileIDs)&&(I=!0),k[ne.bucketInstanceId]=!0)}return T.removeStaleBuckets(k)&&(I=!0),I}pruneUnusedLayers(n){const c={};n.forEach(_=>{c[_]=!0});for(const _ in this.layerIndexes)c[_]||delete this.layerIndexes[_]}}const Ct=(g,n)=>l.emitValidationErrors(g,n&&n.filter(c=>"source.canvas"!==c.identifier)),sn=l.pick(rn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),si=l.pick(rn,["setCenter","setZoom","setBearing","setPitch"]),hi=function(){const g={},n=l.spec.$version;for(const c in l.spec.$root){const _=l.spec.$root[c];if(_.required){let x=null;x="version"===c?n:"array"===_.type?[]:{},null!=x&&(g[c]=x)}}return g}(),io={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ar extends l.Evented{constructor(n,c={}){super(),this.map=n,this.dispatcher=new xt(Xe(),this),this.imageManager=new je,this.imageManager.setEventedParent(this),this.glyphManager=new l.GlyphManager(n._requestManager,c.localFontFamily?l.LocalGlyphMode.all:c.localIdeographFontFamily?l.LocalGlyphMode.ideographs:l.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new l.LineAtlas(256,512),this.crossTileSymbolIndex=new Se,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const _=this;this._rtlTextPluginCallback=ar.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(T,I)=>{if(l.triggerPluginCompletionEvent(T),I&&I.every(k=>k))for(const k in _._sourceCaches){const W=_._sourceCaches[k],ne=W.getSource().type;"vector"!==ne&&"geojson"!==ne||W.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const T=this.getSource(x.sourceId);if(T&&T.vectorLayerIds)for(const I in this._layers){const k=this._layers[I];k.source===T.id&&this._validateLayer(k)}})}loadURL(n,c={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof c.validate?c.validate:!l.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,c.accessToken);const x=this.map._requestManager.transformRequest(n,l.ResourceType.Style);this._request=l.getJSON(x,(T,I)=>{this._request=null,T?this.fire(new l.ErrorEvent(T)):I&&this._load(I,_)})}loadJSON(n,c={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(n,!1!==c.validate)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(hi,!1)}_updateLayerCount(n,c){const _=c?1:-1;n.is3D()&&(this._num3DLayers+=_),"circle"===n.type&&(this._numCircleLayers+=_),"symbol"===n.type&&(this._numSymbolLayers+=_)}_load(n,c){if(c&&Ct(this,l.validateStyle(n)))return;this._loaded=!0,this.stylesheet=n,this.updateProjection();for(const x in n.sources)this.addSource(x,n.sources[x],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const _=tn(this.stylesheet.layers);this._order=_.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of _)x=l.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ke(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&0===this.terrain.drapeRenderMode}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const n=this.map.transform.projection,c=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),_=this.map.transform.projection;if(this._loaded&&(_.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),c){if(_.isReprojectedInTileSpace||n.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(n){this._spriteRequest=function(c,_,x){let T,I,k;const W=l.exported.devicePixelRatio>1?"@2x":"";let ne=l.getJSON(_.transformRequest(_.normalizeSpriteURL(c,W,".json"),l.ResourceType.SpriteJSON),(De,Ze)=>{ne=null,k||(k=De,T=Ze,pe())}),le=l.getImage(_.transformRequest(_.normalizeSpriteURL(c,W,".png"),l.ResourceType.SpriteImage),(De,Ze)=>{le=null,k||(k=De,I=Ze,pe())});function pe(){if(k)x(k);else if(T&&I){const De=l.exported.getImageData(I),Ze={};for(const Be in T){const{width:Ve,height:ct,x:ze,y:at,sdf:ht,pixelRatio:rt,stretchX:st,stretchY:gt,content:Zt}=T[Be],on=new l.RGBAImage({width:Ve,height:ct});l.RGBAImage.copy(De,on,{x:ze,y:at},{x:0,y:0},{width:Ve,height:ct}),Ze[Be]={data:on,pixelRatio:rt,sdf:ht,stretchX:st,stretchY:gt,content:Zt}}x(null,Ze)}}return{cancel(){ne&&(ne.cancel(),ne=null),le&&(le.cancel(),le=null)}}}(n,this.map._requestManager,(c,_)=>{if(this._spriteRequest=null,c)this.fire(new l.ErrorEvent(c));else if(_)for(const x in _)this.imageManager.addImage(x,_[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(n){const c=this.getSource(n.source);if(!c)return;const _=n.sourceLayer;_&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(_))&&this.fire(new l.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${c.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const c=[];for(const _ of n){const x=this._layers[_];"custom"!==x.type&&c.push(x.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&io[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const c=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(x.length||T.length)&&this._updateWorkerLayers(x,T);for(const I in this._updatedSources){const k=this._updatedSources[I];"reload"===k?this._reloadSource(I):"clear"===k&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const _={};for(const x in this._sourceCaches){const T=this._sourceCaches[x];_[x]=T.used,T.used=!1}for(const x of this._order){const T=this._layers[x];if(T.recalculate(n,this._availableImages),!T.isHidden(n.zoom)){const k=this._getLayerSourceCache(T);k&&(k.used=!0)}const I=this.map.painter;if(I){const k=T.getProgramIds();if(!k)continue;const W=T.getProgramConfiguration(n.zoom);for(const ne of k)I.useProgram(ne,W)}}for(const x in _){const T=this._sourceCaches[x];_[x]!==T.used&&T.getSource().fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Ct(this,l.validateStyle(n)))return!1;(n=l.clone$1(n)).layers=tn(n.layers);const c=function(x,T){if(!x)return[{command:rn.setStyle,args:[T]}];let I=[];try{if(!ue(x.version,T.version))return[{command:rn.setStyle,args:[T]}];ue(x.center,T.center)||I.push({command:rn.setCenter,args:[T.center]}),ue(x.zoom,T.zoom)||I.push({command:rn.setZoom,args:[T.zoom]}),ue(x.bearing,T.bearing)||I.push({command:rn.setBearing,args:[T.bearing]}),ue(x.pitch,T.pitch)||I.push({command:rn.setPitch,args:[T.pitch]}),ue(x.sprite,T.sprite)||I.push({command:rn.setSprite,args:[T.sprite]}),ue(x.glyphs,T.glyphs)||I.push({command:rn.setGlyphs,args:[T.glyphs]}),ue(x.transition,T.transition)||I.push({command:rn.setTransition,args:[T.transition]}),ue(x.light,T.light)||I.push({command:rn.setLight,args:[T.light]}),ue(x.fog,T.fog)||I.push({command:rn.setFog,args:[T.fog]}),ue(x.projection,T.projection)||I.push({command:rn.setProjection,args:[T.projection]});const k={},W=[];!function(pe,De,Ze,Be){let Ve;for(Ve in De=De||{},pe=pe||{})pe.hasOwnProperty(Ve)&&(De.hasOwnProperty(Ve)||Ln(Ve,Ze,Be));for(Ve in De)De.hasOwnProperty(Ve)&&(pe.hasOwnProperty(Ve)?ue(pe[Ve],De[Ve])||("geojson"===pe[Ve].type&&"geojson"===De[Ve].type&&ni(pe,De,Ve)?Ze.push({command:rn.setGeoJSONSourceData,args:[Ve,De[Ve].data]}):qn(Ve,De,Ze,Be)):pn(Ve,De,Ze))}(x.sources,T.sources,W,k);const ne=[];x.layers&&x.layers.forEach(pe=>{k[pe.source]?I.push({command:rn.removeLayer,args:[pe.id]}):ne.push(pe)});let le=x.terrain;le&&k[le.source]&&(I.push({command:rn.setTerrain,args:[void 0]}),le=void 0),I=I.concat(W),ue(le,T.terrain)||I.push({command:rn.setTerrain,args:[T.terrain]}),function(pe,De,Ze){De=De||[];const Be=(pe=pe||[]).map(ii),Ve=De.map(ii),ct=pe.reduce(Ui,{}),ze=De.reduce(Ui,{}),at=Be.slice(),ht=Object.create(null);let rt,st,gt,Zt,on,zn,An;for(rt=0,st=0;rt<Be.length;rt++)gt=Be[rt],ze.hasOwnProperty(gt)?st++:(Ze.push({command:rn.removeLayer,args:[gt]}),at.splice(at.indexOf(gt,st),1));for(rt=0,st=0;rt<Ve.length;rt++)gt=Ve[Ve.length-1-rt],at[at.length-1-rt]!==gt&&(ct.hasOwnProperty(gt)?(Ze.push({command:rn.removeLayer,args:[gt]}),at.splice(at.lastIndexOf(gt,at.length-st),1)):st++,zn=at[at.length-rt],Ze.push({command:rn.addLayer,args:[ze[gt],zn]}),at.splice(at.length-rt,0,gt),ht[gt]=!0);for(rt=0;rt<Ve.length;rt++)if(gt=Ve[rt],Zt=ct[gt],on=ze[gt],!ht[gt]&&!ue(Zt,on))if(ue(Zt.source,on.source)&&ue(Zt["source-layer"],on["source-layer"])&&ue(Zt.type,on.type)){for(An in Hn(Zt.layout,on.layout,Ze,gt,null,rn.setLayoutProperty),Hn(Zt.paint,on.paint,Ze,gt,null,rn.setPaintProperty),ue(Zt.filter,on.filter)||Ze.push({command:rn.setFilter,args:[gt,on.filter]}),ue(Zt.minzoom,on.minzoom)&&ue(Zt.maxzoom,on.maxzoom)||Ze.push({command:rn.setLayerZoomRange,args:[gt,on.minzoom,on.maxzoom]}),Zt)Zt.hasOwnProperty(An)&&"layout"!==An&&"paint"!==An&&"filter"!==An&&"metadata"!==An&&"minzoom"!==An&&"maxzoom"!==An&&(0===An.indexOf("paint.")?Hn(Zt[An],on[An],Ze,gt,An.slice(6),rn.setPaintProperty):ue(Zt[An],on[An])||Ze.push({command:rn.setLayerProperty,args:[gt,An,on[An]]}));for(An in on)on.hasOwnProperty(An)&&!Zt.hasOwnProperty(An)&&"layout"!==An&&"paint"!==An&&"filter"!==An&&"metadata"!==An&&"minzoom"!==An&&"maxzoom"!==An&&(0===An.indexOf("paint.")?Hn(Zt[An],on[An],Ze,gt,An.slice(6),rn.setPaintProperty):ue(Zt[An],on[An])||Ze.push({command:rn.setLayerProperty,args:[gt,An,on[An]]}))}else Ze.push({command:rn.removeLayer,args:[gt]}),zn=at[at.lastIndexOf(gt)+1],Ze.push({command:rn.addLayer,args:[on,zn]})}(ne,T.layers,I)}catch(k){console.warn("Unable to compute style diff:",k),I=[{command:rn.setStyle,args:[T]}]}return I}(this.serialize(),n).filter(x=>!(x.command in si));if(0===c.length)return!1;const _=c.filter(x=>!(x.command in sn));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);return c.forEach(x=>{"setTransition"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=n,this.updateProjection(),!0}addImage(n,c){if(this.getImage(n))return this.fire(new l.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(n,c),this._afterImageUpdated(n)}updateImage(n,c){this.imageManager.updateImage(n,c)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new l.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,c,_={}){if(this._checkLoaded(),void 0!==this.getSource(n))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(l.validateStyle.source,`sources.${n}`,c,null,_))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=tr(n,c,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:x.serialize(),sourceId:n}));const T=I=>{const k=(I?"symbol:":"other:")+n,W=this._sourceCaches[k]=new l.SourceCache(k,x,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[n]=W,W.style=this,W.onAdd(this.map)};T(!1),"vector"!==c.type&&"geojson"!==c.type||T(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const c=this.getSource(n);if(void 0===c)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===n)return this.fire(new l.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new l.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(n);for(const x of _)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,c){this._checkLoaded(),this.getSource(n).setData(c),this._changed=!0}getSource(n){const c=this._getSourceCache(n);return c&&c.getSource()}addLayer(n,c,_={}){this._checkLoaded();const x=n.id;if(this.getLayer(x))return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let T;if("custom"===n.type){if(Ct(this,l.validateCustomStyleLayer(n)))return;T=l.createStyleLayer(n)}else{if("object"==typeof n.source&&(this.addSource(x,n.source),n=l.clone$1(n),n=l.extend(n,{source:x})),this._validate(l.validateStyle.layer,`layers.${x}`,n,{arrayIndex:-1},_))return;T=l.createStyleLayer(n),this._validateLayer(T),T.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}const I=c?this._order.indexOf(c):this._order.length;if(c&&-1===I)return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(I,0,x),this._layerOrderChanged=!0,this._layers[x]=T;const k=this._getLayerSourceCache(T);if(this._removedLayers[x]&&T.source&&k&&"custom"!==T.type){const W=this._removedLayers[x];delete this._removedLayers[x],W.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",k.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,c){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new l.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===c)return;const _=this._order.indexOf(n);this._order.splice(_,1);const x=c?this._order.indexOf(c):this._order.length;c&&-1===x?this.fire(new l.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(x,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const c=this._layers[n];if(!c)return void this.fire(new l.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const _=this._order.indexOf(n);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=c,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const c in this._layers)if(this._layers[c].type===n)return!0;return!1}setLayerZoomRange(n,c,_){this._checkLoaded();const x=this.getLayer(n);x?x.minzoom===c&&x.maxzoom===_||(null!=c&&(x.minzoom=c),null!=_&&(x.maxzoom=_),this._updateLayer(x)):this.fire(new l.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,c,_={}){this._checkLoaded();const x=this.getLayer(n);if(x){if(!ue(x.filter,c))return null==c?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(l.validateStyle.filter,`layers.${x.id}.filter`,c,{layerType:x.type},_)||(x.filter=l.clone$1(c),this._updateLayer(x)))}else this.fire(new l.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){return l.clone$1(this.getLayer(n).filter)}setLayoutProperty(n,c,_,x={}){this._checkLoaded();const T=this.getLayer(n);T?ue(T.getLayoutProperty(c),_)||(T.setLayoutProperty(c,_,x),this._updateLayer(T)):this.fire(new l.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,c){const _=this.getLayer(n);if(_)return _.getLayoutProperty(c);this.fire(new l.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,c,_,x={}){this._checkLoaded();const T=this.getLayer(n);T?ue(T.getPaintProperty(c),_)||(T.setPaintProperty(c,_,x)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new l.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,c){return this.getLayer(n).getPaintProperty(c)}setFeatureState(n,c){this._checkLoaded();const _=n.source,x=n.sourceLayer,T=this.getSource(_);if(void 0===T)return void this.fire(new l.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const I=T.type;if("geojson"===I&&x)return void this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!x)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===n.id&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided.")));const k=this._getSourceCaches(_);for(const W of k)W.setFeatureState(x,n.id,c)}removeFeatureState(n,c){this._checkLoaded();const _=n.source,x=this.getSource(_);if(void 0===x)return void this.fire(new l.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const T=x.type,I="vector"===T?n.sourceLayer:void 0;if("vector"===T&&!I)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof n.id&&"number"!=typeof n.id)return void this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const k=this._getSourceCaches(_);for(const W of k)W.removeFeatureState(I,n.id,c)}getFeatureState(n){this._checkLoaded();const c=n.source,_=n.sourceLayer,x=this.getSource(c);if(void 0!==x){if("vector"!==x.type||_)return void 0===n.id&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(_,n.id);this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const c in this._sourceCaches){const _=this._sourceCaches[c].getSource();n[_.id]||(n[_.id]=_.serialize())}return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(n){this._updatedLayers[n.id]=!0;const c=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[n.source]="reload",c.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const c=I=>"fill-extrusion"===this._layers[I].type,_={},x=[];for(let I=this._order.length-1;I>=0;I--){const k=this._order[I];if(c(k)){_[k]=I;for(const W of n){const ne=W[k];if(ne)for(const le of ne)x.push(le)}}}x.sort((I,k)=>k.intersectionZ-I.intersectionZ);const T=[];for(let I=this._order.length-1;I>=0;I--){const k=this._order[I];if(c(k))for(let W=x.length-1;W>=0;W--){const ne=x[W].feature;if(_[ne.layer.id]<I)break;T.push(ne),x.pop()}else for(const W of n){const ne=W[k];if(ne)for(const le of ne)T.push(le.feature)}}return T}queryRenderedFeatures(n,c,_){c&&c.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const x={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const W of c.layers){const ne=this._layers[W];if(!ne)return this.fire(new l.ErrorEvent(new Error(`The layer '${W}' does not exist in the map's style and cannot be queried for features.`))),[];x[ne.source]=!0}}const T=[];c.availableImages=this._availableImages;const I=c&&c.layers?c.layers.some(W=>{const ne=this.getLayer(W);return ne&&ne.is3D()}):this.has3DLayers(),k=fi.createFromScreenPoints(n,_);for(const W in this._sourceCaches){const ne=this._sourceCaches[W].getSource().id;c.layers&&!x[ne]||T.push(X(this._sourceCaches[W],this._layers,this._serializedLayers,k,c,_,I,!!this.map._showQueryGeometry))}return this.placement&&T.push(function(W,ne,le,pe,De,Ze,Be){const Ve={},ct=Ze.queryRenderedSymbols(pe),ze=[];for(const at of Object.keys(ct).map(Number))ze.push(Be[at]);ze.sort(he);for(const at of ze){const ht=at.featureIndex.lookupSymbolFeatures(ct[at.bucketInstanceId],ne,at.bucketIndex,at.sourceLayerIndex,De.filter,De.layers,De.availableImages,W);for(const rt in ht){const st=Ve[rt]=Ve[rt]||[],gt=ht[rt];gt.sort((Zt,on)=>{const zn=at.featureSortOrder;if(zn){const An=zn.indexOf(Zt.featureIndex);return zn.indexOf(on.featureIndex)-An}return on.featureIndex-Zt.featureIndex});for(const Zt of gt)st.push(Zt)}}for(const at in Ve)Ve[at].forEach(ht=>{const rt=ht.feature,st=le(W[at]).getFeatureState(rt.layer["source-layer"],rt.id);rt.source=rt.layer.source,rt.layer["source-layer"]&&(rt.sourceLayer=rt.layer["source-layer"]),rt.state=st});return Ve}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),k.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(n,c){c&&c.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const _=this._getSourceCaches(n);let x=[];for(const T of _)x=x.concat(F(T,c));return x}addSourceType(n,c,_){return ar.getSourceType(n)?_(new Error(`A source type called "${n}" already exists.`)):(ar.setSourceType(n,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:c.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(n,c={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const I in n)if(!ue(n[I],_[I])){x=!0;break}if(!x)return;const T={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,c),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,c=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===c){if("object"==typeof n.source){const _="terrain-dem-src";this.addSource(_,n.source),n=l.clone$1(n),n=l.extend(n,{source:_})}if(this._validate(l.validateStyle.terrain,"terrain",n))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(n,c);else{const _=this.terrain,x=_.get();for(const T in n)if(!ue(n[T],x[T])){_.set(n),this.stylesheet.terrain=n;const I={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};_.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const c=this.fog=new wt(n,this.map.transform);this.stylesheet.fog=n;const _={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,_=c.get();for(const x in n)if(!ue(n[x],_[x])){c.set(n),this.stylesheet.fog=n;const T={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(T);break}}else this._createFog(n);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(_=>this.isLayerDraped(this._layers[_])),c=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...c)}_createTerrain(n,c){const _=this.terrain=new Re(n,c);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const x={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};_.updateTransitions(x)}_force3DLayerUpdate(){for(const n in this._layers){const c=this._layers[n];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const c=this._layers[n];"symbol"===c.type&&this._updateLayer(c)}}_validate(n,c,_,x,T={}){return(!T||!1!==T.validate)&&Ct(this,n.call(l.validateStyle,l.extend({key:c,style:this.serialize(),value:_,styleSpec:l.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const c=this._getSourceCaches(n);for(const _ of c)_.clearTiles()}_reloadSource(n){const c=this._getSourceCaches(n);for(const _ of c)_.resume(),_.reload()}_updateSources(n){for(const c in this._sourceCaches)this._sourceCaches[c].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const c=this._sourceCaches[n];c.resume(),c.reload()}}_updatePlacement(n,c,_,x,T=!1){let I=!1,k=!1;const W={};for(const ne of this._order){const le=this._layers[ne];if("symbol"!==le.type)continue;if(!W[le.source]){const De=this._getLayerSourceCache(le);if(!De)continue;W[le.source]=De.getRenderableIds(!0).map(Ze=>De.getTileByID(Ze)).sort((Ze,Be)=>Be.tileID.overscaledZ-Ze.tileID.overscaledZ||(Ze.tileID.isLessThan(Be.tileID)?-1:1))}const pe=this.crossTileSymbolIndex.addLayer(le,W[le.source],n.center.lng,n.projection);I=I||pe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),T=T||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new l.Event("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),n.zoom))&&(this.pauseablePlacement=new Wi(n,this._order,T,c,_,x,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,W),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),k=!0),I&&this.pauseablePlacement.placement.setStale()),k||I)for(const ne of this._order){const le=this._layers[ne];"symbol"===le.type&&this.placement.updateLayerOpacities(le,W[le.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,c,_){this.imageManager.getImages(c.icons,_),this._updateTilesForChangedImages();const x=T=>{T&&T.setDependencies(c.tileID.key,c.type,c.icons)};x(this._otherSourceCaches[c.source]),x(this._symbolSourceCaches[c.source])}getGlyphs(n,c,_){this.glyphManager.getGlyphs(c.stacks,_)}getResource(n,c,_){return l.makeRequest(c,_)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return"symbol"===n.type?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const c=[];return this._otherSourceCaches[n]&&c.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&c.push(this._symbolSourceCaches[n]),c}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ar.getSourceType=function(g){return _n[g]},ar.setSourceType=function(g,n){_n[g]=n},ar.registerForPluginStateChange=l.registerForPluginStateChange;var es="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",ts="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let cs={},Io={};cs=Ni("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Io=Ni("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Bi=Ni("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}\n#ifdef PROJECTION_GLOBE_VIEW\nmat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ks=es;var Fs={background:Ni("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Ni("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Ni("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Ni("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ni("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Ni("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ni("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ni("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ni("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Ni("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Ni("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Ni("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Ni("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Ni("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Ni("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Ni("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ni("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Ni("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Ni("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Ni("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Ni("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Ni("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Ni("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Ni("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Ni("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ni("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ts),skyboxGradient:Ni("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ts),skyboxCapture:Ni("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ni("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:Ni("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function Ni(g,n,c){const _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,T=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),I=g.match(x),k=n.match(x),W=es.match(x);let ne=k?k.concat(I):I;c||(cs.staticUniforms&&(ne=cs.staticUniforms.concat(ne)),Io.staticUniforms&&(ne=Io.staticUniforms.concat(ne))),ne&&(ne=ne.concat(W));const le={};return{fragmentSource:g=g.replace(_,(pe,De,Ze,Be,Ve)=>(le[Ve]=!0,"define"===De?`\n#ifndef HAS_UNIFORM_u_${Ve}\nvarying ${Ze} ${Be} ${Ve};\n#else\nuniform ${Ze} ${Be} u_${Ve};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Ve}\n    ${Ze} ${Be} ${Ve} = u_${Ve};\n#endif\n`)),vertexSource:n=n.replace(_,(pe,De,Ze,Be,Ve)=>{const ct="float"===Be?"vec2":"vec4",ze=Ve.match(/color/)?"color":ct;return le[Ve]?"define"===De?`\n#ifndef HAS_UNIFORM_u_${Ve}\nuniform lowp float u_${Ve}_t;\nattribute ${Ze} ${ct} a_${Ve};\nvarying ${Ze} ${Be} ${Ve};\n#else\nuniform ${Ze} ${Be} u_${Ve};\n#endif\n`:"vec4"===ze?`\n#ifndef HAS_UNIFORM_u_${Ve}\n    ${Ve} = a_${Ve};\n#else\n    ${Ze} ${Be} ${Ve} = u_${Ve};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Ve}\n    ${Ve} = unpack_mix_${ze}(a_${Ve}, u_${Ve}_t);\n#else\n    ${Ze} ${Be} ${Ve} = u_${Ve};\n#endif\n`:"define"===De?`\n#ifndef HAS_UNIFORM_u_${Ve}\nuniform lowp float u_${Ve}_t;\nattribute ${Ze} ${ct} a_${Ve};\n#else\nuniform ${Ze} ${Be} u_${Ve};\n#endif\n`:"vec4"===ze?`\n#ifndef HAS_UNIFORM_u_${Ve}\n    ${Ze} ${Be} ${Ve} = a_${Ve};\n#else\n    ${Ze} ${Be} ${Ve} = u_${Ve};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Ve}\n    ${Ze} ${Be} ${Ve} = unpack_mix_${ze}(a_${Ve}, u_${Ve}_t);\n#else\n    ${Ze} ${Be} ${Ve} = u_${Ve};\n#endif\n`}),staticAttributes:T,staticUniforms:ne}}class ro{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,c,_,x,T,I,k,W){this.context=n;let ne=this.boundPaintVertexBuffers.length!==x.length;for(let le=0;!ne&&le<x.length;le++)this.boundPaintVertexBuffers[le]!==x[le]&&(ne=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===_&&!ne&&this.boundIndexBuffer===T&&this.boundVertexOffset===I&&this.boundDynamicVertexBuffer===k&&this.boundDynamicVertexBuffer2===W?(n.bindVertexArrayOES.set(this.vao),k&&k.bind(),T&&T.dynamicDraw&&T.bind(),W&&W.bind()):this.freshBind(c,_,x,T,I,k,W)}freshBind(n,c,_,x,T,I,k){let W;const ne=n.numAttributes,le=this.context,pe=le.gl;if(le.extVertexArrayObject)this.vao&&this.destroy(),this.vao=le.extVertexArrayObject.createVertexArrayOES(),le.bindVertexArrayOES.set(this.vao),W=0,this.boundProgram=n,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=k;else{W=le.currentNumAttributes||0;for(let De=ne;De<W;De++)pe.disableVertexAttribArray(De)}c.enableAttributes(pe,n);for(const De of _)De.enableAttributes(pe,n);I&&I.enableAttributes(pe,n),k&&k.enableAttributes(pe,n),c.bind(),c.setVertexAttribPointers(pe,n,T);for(const De of _)De.bind(),De.setVertexAttribPointers(pe,n,T);I&&(I.bind(),I.setVertexAttribPointers(pe,n,T)),x&&x.bind(),k&&(k.bind(),k.setVertexAttribPointers(pe,n,T)),le.currentNumAttributes=ne}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Vo(g,n){const c=Math.pow(2,n.canonical.z),_=n.canonical.y;return[new l.MercatorCoordinate(0,_/c).toLngLat().lat,new l.MercatorCoordinate(0,(_+1)/c).toLngLat().lat]}function bs(g,n,c,_,x,T,I){const k=g.context,W=k.gl,ne=c.fbo;if(!ne)return;g.prepareDrawTile(n);const le=g.useProgram("hillshade");k.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,ne.colorAttachment.get());const pe=((Ve,ct,ze,at)=>{const ht=ze.paint.get("hillshade-shadow-color"),rt=ze.paint.get("hillshade-highlight-color"),st=ze.paint.get("hillshade-accent-color");let gt=ze.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ze.paint.get("hillshade-illumination-anchor")&&(gt-=Ve.transform.angle);const Zt=!Ve.options.moving;return{u_matrix:at||Ve.transform.calculateProjMatrix(ct.tileID.toUnwrapped(),Zt),u_image:0,u_latrange:Vo(0,ct.tileID),u_light:[ze.paint.get("hillshade-exaggeration"),gt],u_shadow:ht,u_highlight:rt,u_accent:st}})(g,c,_,g.terrain?n.projMatrix:null);g.prepareDrawProgram(k,le,n.toUnwrapped());const{tileBoundsBuffer:De,tileBoundsIndexBuffer:Ze,tileBoundsSegments:Be}=g.getTileBoundsBuffers(c);le.draw(k,W.TRIANGLES,x,T,I,l.CullFaceMode.disabled,pe,_.id,De,Ze,Be)}function Wr(g,n,c){if(!n.needsDEMTextureUpload)return;const _=g.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||g.getTileTexture(c.stride);const T=c.getPixels();n.demTexture?n.demTexture.update(T,{premultiply:!1}):n.demTexture=new l.Texture(_,T,x.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Bs(g,n,c,_,x,T){const I=g.context,k=I.gl;if(!n.dem)return;const W=n.dem;if(I.activeTexture.set(k.TEXTURE1),Wr(g,n,W),!n.demTexture)return;n.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);const ne=W.dim;I.activeTexture.set(k.TEXTURE0);let le=n.fbo;if(!le){const Be=new l.Texture(I,{width:ne,height:ne,data:null},k.RGBA);Be.bind(k.LINEAR,k.CLAMP_TO_EDGE),le=n.fbo=I.createFramebuffer(ne,ne,!0),le.colorAttachment.set(Be.texture)}I.bindFramebuffer.set(le.framebuffer),I.viewport.set([0,0,ne,ne]);const{tileBoundsBuffer:pe,tileBoundsIndexBuffer:De,tileBoundsSegments:Ze}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(I,k.TRIANGLES,_,x,T,l.CullFaceMode.disabled,((Be,Ve)=>{const ct=Ve.stride,ze=l.create();return l.ortho(ze,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(ze,ze,[0,-l.EXTENT,0]),{u_matrix:ze,u_image:1,u_dimension:[ct,ct],u_zoom:Be.overscaledZ,u_unpack:Ve.unpackVector}})(n.tileID,W),c.id,pe,De,Ze),n.needsHillshadePrepare=!1}const $o=(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_image0:new l.Uniform1i(g,n.u_image0),u_skirt_height:new l.Uniform1f(g,n.u_skirt_height)}),Qr=(g,n)=>({u_matrix:g,u_image0:0,u_skirt_height:n}),Ns=(g,n,c,_,x)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:n,u_merc_matrix:c,u_zoom_transition:_,u_merc_center:x,u_image0:0});function uo(g,n){return null!=g&&null!=n&&!(!g.hasData()||!n.hasData())&&null!=g.demTexture&&null!=n.demTexture&&g.tileID.key!==n.tileID.key}const Mo=new class{constructor(){this.operations={}}newMorphing(g,n,c,_,x){if(g in this.operations){const T=this.operations[g];T.to.tileID.key!==c.tileID.key&&(T.queued=c)}else this.operations[g]={startTime:_,phase:0,duration:x,from:n,to:c,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const n=this.operations[g];return{from:n.from,to:n.to,phase:n.phase}}update(g){for(const n in this.operations){const c=this.operations[n];for(c.phase=(g-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,g)){delete this.operations[n];break}}}_nextOp(g,n){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=n,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},ns={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function xo(g,n){const c=1<<g.z;return!n&&(0===g.x||g.x===c-1)||0===g.y||g.y===c-1}const Ro=g=>({u_matrix:g});function Qs(g,n,c,_,x){if(x>0){const T=l.exported.now(),I=(T-g.timeAdded)/x,k=n?(T-n.timeAdded)/x:-1,W=c.getSource(),ne=_.coveringZoomLevel({tileSize:W.tileSize,roundZoom:W.roundZoom}),le=!n||Math.abs(n.tileID.overscaledZ-ne)>Math.abs(g.tileID.overscaledZ-ne),pe=le&&g.refreshedUponExpiration?1:l.clamp(le?I:1-k,0,1);return g.refreshedUponExpiration&&I>=1&&(g.refreshedUponExpiration=!1),n?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}class oe extends l.SourceCache{constructor(n){const c={type:"raster-dem",maxzoom:n.transform.maxZoom},_=new xt(Xe(),null),x=tr("mock-dem",c,_,n.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,c){n.state="loaded",c(null)}}class we extends l.SourceCache{constructor(n){const c=tr("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new xt(Xe(),null),n.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,c,_){if(n.freezeTileCoverage)return;this.transform=n;const x=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,I)=>{if(T[I.key]="",!this._tiles[I.key]){const k=new l.Tile(I,this._source.tileSize*I.overscaleFactor(),n.tileZoom);k.state="loaded",this._tiles[I.key]=k}return T},{});for(const T in this._tiles)T in x||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(n){const c=this.proxyCachedFBO[n];if(void 0!==c){const _=Object.values(c);this.renderCachePool.push(..._),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class se extends l.OverscaledTileID{constructor(n,c,_){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=c,this.projMatrix=_}}class Le extends l.Elevation{constructor(n,c){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,x,T]=function(W){const ne=new l.StructArrayLayout4i8,le=new l.StructArrayLayout3ui6;ne.reserve(17161),le.reserve(33800);const De=l.EXTENT/128,Ze=l.EXTENT+De/2,Be=Ze+De;for(let ct=-De;ct<Be;ct+=De)for(let ze=-De;ze<Be;ze+=De){const at=ze<0||ze>Ze||ct<0||ct>Ze?24575:0,ht=l.clamp(Math.round(ze),0,l.EXTENT),rt=l.clamp(Math.round(ct),0,l.EXTENT);ne.emplaceBack(ht+at,rt,ht,rt)}const Ve=(ct,ze)=>{const at=131*ze+ct;le.emplaceBack(at+1,at,at+131),le.emplaceBack(at+131,at+131+1,at+1)};for(let ct=1;ct<129;ct++)for(let ze=1;ze<129;ze++)Ve(ze,ct);return[0,129].forEach(ct=>{for(let ze=0;ze<130;ze++)Ve(ze,ct),Ve(ct,ze)}),[ne,le,32768]}(),I=n.context;this.gridBuffer=I.createVertexBuffer(_,l.boundsAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(x),this.gridSegments=l.SegmentVector.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=l.SegmentVector.simpleSegment(0,0,_.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new we(c.map),this.orthoMatrix=l.create(),l.ortho(this.orthoMatrix,0,l.EXTENT,0,l.EXTENT,0,1);const k=I.gl;this._overlapStencilMode=new l.StencilMode({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new oe(c.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,c,_){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const x=n.terrain.properties;this.sourceCache=0===n.terrain.drapeRenderMode?this._mockSourceCache:n._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const T=()=>{this.sourceCache.used&&l.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(c,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,T(),this._initializing=!0),T(),c.updateElevation(!_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==n.efficiency&&l.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&"source"===n.dataType?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):"style"===n.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=c.getIds().map(W=>{const ne=c.getTileByID(W).tileID;return ne.projMatrix=_.calculateProjMatrix(ne.toUnwrapped()),ne});(function(W,ne){const le=ne.transform.pointCoordinate(ne.transform.getCameraPoint()),pe=new l.pointGeometry(le.x,le.y);W.sort((De,Ze)=>{if(Ze.overscaledZ-De.overscaledZ)return Ze.overscaledZ-De.overscaledZ;const Be=new l.pointGeometry(De.canonical.x+(1<<De.canonical.z)*De.wrap,De.canonical.y),Ve=new l.pointGeometry(Ze.canonical.x+(1<<Ze.canonical.z)*Ze.wrap,Ze.canonical.y),ct=pe.mult(1<<De.canonical.z);return ct.x-=.5,ct.y-=.5,ct.distSqr(Be)-ct.distSqr(Ve)})})(x,this.painter),this._previousZoom=_.zoom;const T=this.proxyToSource||{};this.proxyToSource={},x.forEach(W=>{this.proxyToSource[W.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const W in I){const ne=I[W];if(!ne.used||(ne!==this.sourceCache&&this.resetTileLookupCache(ne.id),this._setupProxiedCoordsForOrtho(ne,n[W],T),ne.usedForTerrain))continue;const le=n[W];ne.getSource().reparseOverscaled&&this._assignTerrainTiles(le)}this.proxiedCoords[c.id]=x.map(W=>new se(W,W.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1,this._updateTimestamp=l.exported.now();const k={};this._visibleDemTiles=[];for(const W of this.proxyCoords){const ne=this.terrainTileForTile[W.key];if(!ne)continue;const le=ne.tileID.key;le in k||(this._visibleDemTiles.push(ne),k[le]=le)}}_assignTerrainTiles(n){this._initializing||n.forEach(c=>{if(this.terrainTileForTile[c.key])return;const _=this._findTileCoveringTileID(c,this.sourceCache);_&&(this.terrainTileForTile[c.key]=_)})}_prepareDEMTextures(){const n=this.painter.context,c=n.gl;for(const _ in this.terrainTileForTile){const x=this.terrainTileForTile[_],T=x.dem;!T||x.demTexture&&!x.needsDEMTextureUpload||(n.activeTexture.set(c.TEXTURE1),Wr(this.painter,x,T))}}_prepareDemTileUniforms(n,c,_,x){if(!c||null==c.demTexture)return!1;const T=n.tileID.canonical,I=Math.pow(2,c.tileID.canonical.z-T.z),k=x||"";return _[`u_dem_tl${k}`]=[T.x*I%1,T.y*I%1],_[`u_dem_scale${k}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,c=n.gl;if(!this._emptyDepthBufferTexture){const _={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new l.Texture(n,_,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const c=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;const T=x.dem.tree.minimums[0];return T>0&&n++,_+T},0);return n?c/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,c=n.gl;n.activeTexture.set(c.TEXTURE2);const _=this._getLoadedAreaMinimum(),x={width:1,height:1,data:new Uint8Array(l.DEMData.pack(_,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(x,{premultiply:!1}):T=this._emptyDEMTexture=new l.Texture(n,x,c.RGBA,{premultiply:!1}),T}setupElevationDraw(n,c,_){const x=this.painter.context,T=x.gl,I=(k=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:l.DEMData.getUnpackVector(k),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var k;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();const W=this.painter.transform,ne=W.projection.createTileTransform(W,W.worldSize),le=n.tileID.canonical;I.u_tile_tl_up=ne.upVector(le,0,0),I.u_tile_tr_up=ne.upVector(le,l.EXTENT,0),I.u_tile_br_up=ne.upVector(le,l.EXTENT,l.EXTENT),I.u_tile_bl_up=ne.upVector(le,0,l.EXTENT),I.u_tile_up_scale=ne.upVectorScale(le);let pe=null,De=null,Ze=1;if(_&&_.morphing&&this._useVertexMorphing){const Be=_.morphing.srcDemTile,Ve=_.morphing.dstDemTile;Ze=_.morphing.phase,Be&&Ve&&(this._prepareDemTileUniforms(n,Be,I,"_prev")&&(De=Be),this._prepareDemTileUniforms(n,Ve,I)&&(pe=Ve))}if(De&&pe?(x.activeTexture.set(T.TEXTURE2),pe.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),x.activeTexture.set(T.TEXTURE4),De.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),I.u_dem_lerp=Ze):(pe=this.terrainTileForTile[n.tileID.key],x.activeTexture.set(T.TEXTURE2),(this._prepareDemTileUniforms(n,pe,I)?pe.demTexture:this.emptyDEMTexture).bind(T.NEAREST,T.CLAMP_TO_EDGE)),x.activeTexture.set(T.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&pe){const Be=(1<<pe.tileID.canonical.z)*l.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=Be}_&&_.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),c.setTerrainUniformValues(x,I)}renderToBackBuffer(n){const c=this.painter,_=this.painter.context;0!==n.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height]),this.renderingToTexture=!1,function(x,T,I,k,W){if("globe"===x.transform.projection.name)!function(ne,le,pe,De,Ze){const Be=ne.context,Ve=Be.gl;let ct,ze;const at=ne.options.showTerrainWireframe?2:0,ht=(Dn,un)=>{if(ze===Dn)return;const Jt=[];un&&Jt.push(ns[at]),Jt.push(ns[Dn]),Jt.push("PROJECTION_GLOBE_VIEW"),ct=ne.useProgram("globeRaster",null,Jt),ze=Dn},rt=ne.colorModeForRenderPass(),st=new l.DepthMode(Ve.LEQUAL,l.DepthMode.ReadWrite,ne.depthRangeFor3D);Mo.update(Ze);const gt=ne.transform,Zt=l.calculateGlobeMatrix(gt,gt.worldSize),on=l.calculateGlobeMercatorMatrix(gt),zn=[l.mercatorXfromLng(gt.center.lng),l.mercatorYfromLat(gt.center.lat)],An=ne.globeSharedBuffers;(at?[!1,!0]:[!1]).forEach(Dn=>{ze=-1;const un=Dn?Ve.LINES:Ve.TRIANGLES;for(const Jt of De){const bn=pe.getTile(Jt),yn=Math.pow(2,Jt.canonical.z),[di,Mi]=l.globeBuffersForTileMesh(ne,bn,Jt,yn),rr=l.StencilMode.disabled,Nn=le.prevTerrainTileForTile[Jt.key],vi=le.terrainTileForTile[Jt.key];uo(Nn,vi)&&Mo.newMorphing(Jt.key,Nn,vi,Ze,250),Be.activeTexture.set(Ve.TEXTURE0),bn.texture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE);const Yi=Mo.getMorphValuesForProxy(Jt.key),Ar=Yi?1:0,Xr={};Yi&&l.extend$1(Xr,{morphing:{srcDemTile:Yi.from,dstDemTile:Yi.to,phase:l.easeCubicInOut(Yi.phase)}});const Gi=l.globeMatrixForTile(Jt.canonical,Zt),Li=Ns(gt.projMatrix,Gi,on,l.globeToMercatorTransition(gt.zoom),zn);if(ht(Ar,Dn),le.setupElevationDraw(bn,ct,Xr),ne.prepareDrawProgram(Be,ct,Jt.toUnwrapped()),An){const[lo,jo]=Dn?An.getWirefameBuffer(ne.context):[An.gridIndexBuffer,An.gridSegments];ct.draw(Be,un,st,rr,rt,l.CullFaceMode.backCCW,Li,"globe_raster",di,lo,jo)}if(!Dn){const lo=[0===Jt.canonical.y?l.globePoleMatrixForTile(Jt.canonical,!1,gt):null,Jt.canonical.y===yn-1?l.globePoleMatrixForTile(Jt.canonical,!0,gt):null];for(const jo of lo){if(!jo)continue;const ds=Ns(gt.projMatrix,jo,jo,0,zn);An&&ct.draw(Be,un,st,rr,rt,l.CullFaceMode.disabled,ds,"globe_pole_raster",Mi,An.poleIndexBuffer,An.poleSegments)}}}})}(x,T,I,k,W);else{const ne=x.context,le=ne.gl;let pe,De;const Ze=x.options.showTerrainWireframe?2:0,Be=(ht,rt)=>{if(De===ht)return;const st=[ns[ht]];rt&&st.push(ns[Ze]),pe=x.useProgram("terrainRaster",null,st),De=ht},Ve=x.colorModeForRenderPass(),ct=new l.DepthMode(le.LEQUAL,l.DepthMode.ReadWrite,x.depthRangeFor3D);Mo.update(W);const ze=x.transform,at=6*Math.pow(1.5,22-ze.zoom)*T.exaggeration();(Ze?[!1,!0]:[!1]).forEach(ht=>{De=-1;const rt=ht?le.LINES:le.TRIANGLES,[st,gt]=ht?T.getWirefameBuffer():[T.gridIndexBuffer,T.gridSegments];for(const Zt of k){const on=I.getTile(Zt),zn=l.StencilMode.disabled,An=T.prevTerrainTileForTile[Zt.key],Dn=T.terrainTileForTile[Zt.key];uo(An,Dn)&&Mo.newMorphing(Zt.key,An,Dn,W,250),ne.activeTexture.set(le.TEXTURE0),on.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE,le.LINEAR_MIPMAP_NEAREST);const un=Mo.getMorphValuesForProxy(Zt.key),Jt=un?1:0;let bn;un&&(bn={morphing:{srcDemTile:un.from,dstDemTile:un.to,phase:l.easeCubicInOut(un.phase)}});const yn=Qr(Zt.projMatrix,xo(Zt.canonical,ze.renderWorldCopies)?at/10:at);Be(Jt,ht),T.setupElevationDraw(on,pe,bn),x.prepareDrawProgram(ne,pe,Zt.toUnwrapped()),pe.draw(ne,rt,ct,zn,Ve,l.CullFaceMode.backCCW,yn,"terrain_raster",T.gridBuffer,st,gt)}})}}(c,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,n.splice(0,n.length))}renderBatch(n){if(0===this._drapedRenderBatches.length)return n+1;this.renderingToTexture=!0;const c=this.painter,_=this.painter.context,x=this.proxySourceCache,T=this.proxiedCoords[x.id],I=this._drapedRenderBatches.shift(),k=[],W=c.style.order;let ne=0;for(const le of T){const pe=x.getTileByID(le.proxyTileKey),De=x.proxyCachedFBO[le.key]?x.proxyCachedFBO[le.key][n]:void 0,Ze=void 0!==De?x.renderCache[De]:this.pool[ne++],Be=void 0!==De;if(pe.texture=Ze.tex,Be&&!Ze.dirty){k.push(pe.tileID);continue}let Ve;_.bindFramebuffer.set(Ze.fb.framebuffer),this.renderedToTile=!1,Ze.dirty&&(_.clear({color:l.Color.transparent,stencil:0}),Ze.dirty=!1);for(let ct=I.start;ct<=I.end;++ct){const ze=c.style._layers[W[ct]];if(ze.isHidden(c.transform.zoom))continue;const at=c.style._getLayerSourceCache(ze),ht=at?this.proxyToSource[le.key][at.id]:[le];if(!ht)continue;const rt=ht;_.viewport.set([0,0,Ze.fb.width,Ze.fb.height]),Ve!==(at?at.id:null)&&(this._setupStencil(Ze,ht,ze,at),Ve=at?at.id:null),c.renderLayer(c,at,ze,rt)}this.renderedToTile?(Ze.dirty=!0,k.push(pe.tileID)):Be||--ne,5===ne&&(ne=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height]),I.end+1}postRender(){}renderCacheEfficiency(n){const c=n.order.length;if(0===c)return{efficiency:100};let _,x=0,T=0,I=!1;for(let k=0;k<c;++k){const W=n._layers[n.order[k]];this._style.isLayerDraped(W)?(I&&++x,++T):I||(I=!0,_=W.id)}return 0===T?{efficiency:100}:{efficiency:100*(1-x/T),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{n=Math.min(n,c.dem.tree.minimums[0])}),0===n?n:(n-30)*this._exaggeration}raycast(n,c,_){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const I=T.tileID,k=Math.pow(2,I.overscaledZ),{x:W,y:ne}=I.canonical,le=W/k,pe=(W+1)/k,De=ne/k,Ze=(ne+1)/k;return{minx:le,miny:De,maxx:pe,maxy:Ze,t:T.dem.tree.raycastRoot(le,De,pe,Ze,n,c,_),tile:T}});x.sort((T,I)=>(null!==T.t?T.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const T of x){if(null==T.t)return null;const I=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,n,c,_);if(null!=I)return I}return null}_createFBO(){const n=this.painter.context,c=n.gl,_=this.drapeBufferSize;n.activeTexture.set(c.TEXTURE0);const x=new l.Texture(n,{width:_[0],height:_[1],data:null},c.RGBA);x.bind(c.LINEAR,c.CLAMP_TO_EDGE);const T=n.createFramebuffer(_[0],_[1],!1);return T.colorAttachment.set(x.texture),T.depthAttachment=new Ki(n,T.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:T,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const c=this._style._layers[n],_=c.isHidden(this.painter.transform.zoom),x=c.getCrossfadeParameters(),T=!!x&&1!==x.t,I=c.hasTransition();return"custom"!==c.type&&!_&&(T||I)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof Pi){n=!0;break}if(n)for(let c=0;c<this._style.order.length;++c){const _=this._style._layers[this._style.order[c]],x=_.isHidden(this.painter.transform.zoom),T=this._style._getLayerSourceCache(_);if("raster"!==_.type||x||!T)continue;const I=_.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const W=this.proxyToSource[k.key][T.id];if(W)for(const ne of W){const le=Qs(T.getTile(ne),T.findLoadedParent(ne,0),T,this.painter.transform,I);(1!==le.opacity||0!==le.mix)&&this._clearRenderCacheForTile(T.id,ne)}}}}_setupDrapedRenderBatches(){const n=this._style.order,c=n.length;if(0===c)return;const _=[];let x,T=0,I=this._style._layers[n[T]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++T<c;)I=this._style._layers[n[T]];for(;T<c;++T){const k=this._style._layers[n[T]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?void 0===x&&(x=T):void 0!==x&&(_.push({start:x,end:T-1}),x=void 0))}void 0!==x&&_.push({start:x,end:T-1}),this._drapedRenderBatches=_}_setupRenderCache(n){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const I=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let k=0;k<I.length;++k){const W=Object.values(I[k]);c.renderCachePool.push(...W)}}return}this._clearRasterFadeFromRenderCache();const _=this.proxyCoords,x=this._tilesDirty;for(let I=_.length-1;I>=0;I--){const k=_[I];if(c.getTileByID(k.key),void 0!==c.proxyCachedFBO[k.key]){const W=n[k.key],ne=this.proxyToSource[k.key];let le=0;for(const pe in ne){const De=ne[pe],Ze=W[pe];if(!Ze||Ze.length!==De.length||De.some((Be,Ve)=>Be!==Ze[Ve]||x[pe]&&x[pe].hasOwnProperty(Be.key))){le=-1;break}++le}for(const pe in c.proxyCachedFBO[k.key])c.renderCache[c.proxyCachedFBO[k.key][pe]].dirty=le<0||le!==Object.values(W).length}}const T=[...this._drapedRenderBatches];T.sort((I,k)=>k.end-k.start-(I.end-I.start));for(const I of T)for(const k of _){if(c.proxyCachedFBO[k.key])continue;let W=c.renderCachePool.pop();void 0===W&&c.renderCache.length<50&&(W=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==W&&(c.proxyCachedFBO[k.key]={},c.proxyCachedFBO[k.key][I.start]=W,c.renderCache[W].dirty=!0)}this._tilesDirty={}}_setupStencil(n,c,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,I=T.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let k;if(_.isTileClipped())k=c.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):l.StencilMode.disabled}_renderTileClippingMasks(n,c){const _=this.painter,x=this.painter.context,T=x.gl;_._tileClippingMaskIDs={},x.setColorMode(l.ColorMode.disabled),x.setDepthMode(l.DepthMode.disabled);const I=_.useProgram("clippingMask");for(const k of n){const W=_._tileClippingMaskIDs[k.key]=--c;I.draw(x,T.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:T.ALWAYS,mask:0},W,255,T.KEEP,T.KEEP,T.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,Ro(k.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(n){const c=this.painter.transform;if(n.x<0||n.x>c.width||n.y<0||n.y>c.height)return null;const _=[n.x,n.y,1,1];l.transformMat4$1(_,_,c.pixelMatrixInverse),l.scale$1(_,_,1/_[3]),_[0]/=c.worldSize,_[1]/=c.worldSize;const x=c._camera.position,T=l.mercatorZfromAltitude(1,c.center.lat),I=[x[0],x[1],x[2]/T,0],k=l.subtract([],_.slice(0,3),I);l.normalize(k,k);const W=this.raycast(I,k,this._exaggeration);return null!==W&&W?(l.scaleAndAdd(I,I,k,W),I[3]=I[2],I[2]*=T,I):null}drawDepth(){const n=this.painter,c=n.context,_=this.proxySourceCache,x=Math.ceil(n.width),T=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===T||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const I=c.gl,k=c.createFramebuffer(x,T,!0);c.activeTexture.set(I.TEXTURE0);const W=new l.Texture(c,{width:x,height:T,data:null},I.RGBA);W.bind(I.NEAREST,I.CLAMP_TO_EDGE),k.colorAttachment.set(W.texture);const ne=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,x,T);k.depthAttachment.set(ne),this._depthFBO=k,this._depthTexture=W}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,x,T]),function(I,k,W,ne){if("globe"===I.transform.projection.name)return;const le=I.context,pe=le.gl;le.clear({depth:1});const De=I.useProgram("terrainDepth"),Ze=new l.DepthMode(pe.LESS,l.DepthMode.ReadWrite,I.depthRangeFor3D);for(const Be of ne){const Ve=W.getTile(Be),ct=Qr(Be.projMatrix,0);k.setupElevationDraw(Ve,De),De.draw(le,pe.TRIANGLES,Ze,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.backCCW,ct,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(n,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,c,_){if(n.getSource()instanceof Rr)return this._setupProxiedCoordsForImageSource(n,c,_);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const x=this.proxiedCoords[n.id]=[],T=this.proxyCoords;for(let k=0;k<T.length;k++){const W=T[k],ne=this._findTileCoveringTileID(W,n);if(ne){const le=this._createProxiedId(W,ne,_[W.key]&&_[W.key][n.id]);x.push(le),this.proxyToSource[W.key][n.id]=[le]}}let I=!1;for(let k=0;k<c.length;k++){const W=n.getTile(c[k]);if(!W||!W.hasData())continue;const ne=this._findTileCoveringTileID(W.tileID,this.proxySourceCache);if(ne&&ne.tileID.canonical.z!==W.tileID.canonical.z){const le=this.proxyToSource[ne.tileID.key][n.id],pe=this._createProxiedId(ne.tileID,W,_[ne.tileID.key]&&_[ne.tileID.key][n.id]);le?le.splice(le.length-1,0,pe):this.proxyToSource[ne.tileID.key][n.id]=[pe],x.push(pe),I=!0}}this._sourceTilesOverlap[n.id]=I}_setupProxiedCoordsForImageSource(n,c,_){if(!n.getSource().loaded())return;const x=this.proxiedCoords[n.id]=[],T=this.proxyCoords,I=n.getSource(),k=new l.pointGeometry(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),W=I.coordinates.map(l.MercatorCoordinate.fromLngLat).reduce((le,pe)=>(le.min.x=Math.min(le.min.x,pe.x-k.x),le.min.y=Math.min(le.min.y,pe.y-k.y),le.max.x=Math.max(le.max.x,pe.x-k.x),le.max.y=Math.max(le.max.y,pe.y-k.y),le),{min:new l.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new l.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),ne=(le,pe)=>{const De=le.wrap+le.canonical.x/(1<<le.canonical.z),Ze=le.canonical.y/(1<<le.canonical.z),Be=l.EXTENT/(1<<le.canonical.z),Ve=pe.wrap+pe.canonical.x/(1<<pe.canonical.z),ct=pe.canonical.y/(1<<pe.canonical.z);return De+Be<Ve+W.min.x||De>Ve+W.max.x||Ze+Be<ct+W.min.y||Ze>ct+W.max.y};for(let le=0;le<T.length;le++){const pe=T[le];for(let De=0;De<c.length;De++){const Ze=n.getTile(c[De]);if(!Ze||!Ze.hasData()||ne(pe,Ze.tileID))continue;const Be=this._createProxiedId(pe,Ze,_[pe.key]&&_[pe.key][n.id]),Ve=this.proxyToSource[pe.key][n.id];Ve?Ve.push(Be):this.proxyToSource[pe.key][n.id]=[Be],x.push(Be)}}}_createProxiedId(n,c,_){let x=this.orthoMatrix;if(_){const T=_.find(I=>I.key===c.tileID.key);if(T)return T}if(c.tileID.key!==n.key){const T=n.canonical.z-c.tileID.canonical.z;let I,k,W;x=l.create();const ne=c.tileID.wrap-n.wrap<<n.overscaledZ;T>0?(I=l.EXTENT>>T,k=I*((c.tileID.canonical.x<<T)-n.canonical.x+ne),W=I*((c.tileID.canonical.y<<T)-n.canonical.y)):(I=l.EXTENT<<-T,k=l.EXTENT*(c.tileID.canonical.x-(n.canonical.x+ne<<-T)),W=l.EXTENT*(c.tileID.canonical.y-(n.canonical.y<<-T))),l.ortho(x,0,I,0,I,0,1),l.translate(x,x,[k,W,0])}return new se(c.tileID,n.key,x)}_findTileCoveringTileID(n,c){let _=c.getTile(n);if(_&&_.hasData())return _;const x=this._findCoveringTileCache[c.id],T=x[n.key];if(_=T?c.getTileByID(T):null,_&&_.hasData()||null===T)return _;let I=_?_.tileID:n,k=I.overscaledZ;const W=c.getSource().minzoom,ne=[];if(!T){const pe=c.getSource().maxzoom;if(n.canonical.z>=pe){const De=n.canonical.z-pe;c.getSource().reparseOverscaled?(k=Math.max(n.canonical.z+2,c.transform.tileZoom),I=new l.OverscaledTileID(k,n.wrap,pe,n.canonical.x>>De,n.canonical.y>>De)):0!==De&&(k=pe,I=new l.OverscaledTileID(k,n.wrap,pe,n.canonical.x>>De,n.canonical.y>>De))}I.key!==n.key&&(ne.push(I.key),_=c.getTile(I))}const le=pe=>{ne.forEach(De=>{x[De]=pe}),ne.length=0};for(k-=1;k>=W&&(!_||!_.hasData());k--){_&&le(_.tileID.key);const pe=I.calculateScaledKey(k);if(_=c.getTileByID(pe),_&&_.hasData())break;const De=x[pe];if(null===De)break;void 0===De?ne.push(pe):_=c.getTileByID(De)}return le(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(n){this.renderedToTile=!0}_clearRenderCacheForTile(n,c){let _=this._tilesDirty[n];_||(_=this._tilesDirty[n]={}),_[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(c){let _,x,T;const I=new l.StructArrayLayout2ui4,k=131;for(x=1;x<129;x++){for(_=1;_<129;_++)T=x*k+_,I.emplaceBack(T,T+1),I.emplaceBack(T,T+k),I.emplaceBack(T+1,T+k),128===x&&I.emplaceBack(T+k,T+k+1);I.emplaceBack(T+1,T+1+k)}return I}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=l.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Mt(g){const n=[];for(let c=0;c<g.length;c++){if(null===g[c])continue;const _=g[c].split(" ");n.push(_.pop())}return n}class an{static cacheKey(n,c,_){let x=`${n}${_?_.cacheKey:""}`;for(const T of c)x+=`/${T}`;return x}constructor(n,c,_,x,T,I){const k=n.gl;this.program=k.createProgram();const W=Mt(_.staticAttributes),ne=x?x.getBinderAttributes():[],le=W.concat(ne),pe=_.staticUniforms?Mt(_.staticUniforms):[],De=x?x.getBinderUniforms():[],Ze=pe.concat(De),Be=[];for(const st of Ze)Be.indexOf(st)<0&&Be.push(st);let Ve=x?x.defines():[];Ve=Ve.concat(I.map(st=>`#define ${st}`));const ct=Ve.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ks,Bi.fragmentSource,Io.fragmentSource,_.fragmentSource).join("\n"),ze=Ve.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ks,Bi.vertexSource,Io.vertexSource,cs.vertexSource,_.vertexSource).join("\n"),at=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(at,ct),k.compileShader(at),k.attachShader(this.program,at);const ht=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(ht,ze),k.compileShader(ht),k.attachShader(this.program,ht),this.attributes={};const rt={};this.numAttributes=le.length;for(let st=0;st<this.numAttributes;st++)le[st]&&(k.bindAttribLocation(this.program,st,le[st]),this.attributes[le[st]]=st);k.linkProgram(this.program),k.deleteShader(ht),k.deleteShader(at);for(let st=0;st<Be.length;st++){const gt=Be[st];if(gt&&!rt[gt]){const Zt=k.getUniformLocation(this.program,gt);Zt&&(rt[gt]=Zt)}}var st,gt;this.fixedUniforms=T(n,rt),this.binderUniforms=x?x.getUniforms(n,rt):[],-1!==I.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new l.Uniform1i(st=n,(gt=rt).u_dem),u_dem_prev:new l.Uniform1i(st,gt.u_dem_prev),u_dem_unpack:new l.Uniform4f(st,gt.u_dem_unpack),u_dem_tl:new l.Uniform2f(st,gt.u_dem_tl),u_dem_scale:new l.Uniform1f(st,gt.u_dem_scale),u_dem_tl_prev:new l.Uniform2f(st,gt.u_dem_tl_prev),u_dem_scale_prev:new l.Uniform1f(st,gt.u_dem_scale_prev),u_dem_size:new l.Uniform1f(st,gt.u_dem_size),u_dem_lerp:new l.Uniform1f(st,gt.u_dem_lerp),u_exaggeration:new l.Uniform1f(st,gt.u_exaggeration),u_depth:new l.Uniform1i(st,gt.u_depth),u_depth_size_inv:new l.Uniform2f(st,gt.u_depth_size_inv),u_meter_to_dem:new l.Uniform1f(st,gt.u_meter_to_dem),u_label_plane_matrix_inv:new l.UniformMatrix4f(st,gt.u_label_plane_matrix_inv),u_tile_tl_up:new l.Uniform3f(st,gt.u_tile_tl_up),u_tile_tr_up:new l.Uniform3f(st,gt.u_tile_tr_up),u_tile_br_up:new l.Uniform3f(st,gt.u_tile_br_up),u_tile_bl_up:new l.Uniform3f(st,gt.u_tile_bl_up),u_tile_up_scale:new l.Uniform1f(st,gt.u_tile_up_scale)}),-1!==I.indexOf("FOG")&&(this.fogUniforms=((st,gt)=>({u_fog_matrix:new l.UniformMatrix4f(st,gt.u_fog_matrix),u_fog_range:new l.Uniform2f(st,gt.u_fog_range),u_fog_color:new l.Uniform4f(st,gt.u_fog_color),u_fog_horizon_blend:new l.Uniform1f(st,gt.u_fog_horizon_blend),u_fog_temporal_offset:new l.Uniform1f(st,gt.u_fog_temporal_offset)}))(n,rt))}setTerrainUniformValues(n,c){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)_[x].set(c[x])}}setFogUniformValues(n,c){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)_[x].location&&_[x].set(c[x])}}draw(n,c,_,x,T,I,k,W,ne,le,pe,De,Ze,Be,Ve,ct){const ze=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(_),n.setStencilMode(x),n.setColorMode(T),n.setCullFace(I);for(const ht of Object.keys(this.fixedUniforms))this.fixedUniforms[ht].set(k[ht]);Be&&Be.setUniforms(n,this.binderUniforms,De,{zoom:Ze});const at={[ze.LINES]:2,[ze.TRIANGLES]:3,[ze.LINE_STRIP]:1}[c];for(const ht of pe.get()){const rt=ht.vaos||(ht.vaos={});(rt[W]||(rt[W]=new ro)).bind(n,this,ne,Be?Be.getPaintVertexBuffers():[],le,ht.vertexOffset,Ve,ct),ze.drawElements(c,ht.primitiveLength*at,ze.UNSIGNED_SHORT,ht.primitiveOffset*at*2)}}}function Bn(g,n,c){const _=1/dt(c,1,n.transform.tileZoom),x=Math.pow(2,c.tileID.overscaledZ),T=c.tileSize*Math.pow(2,n.transform.tileZoom)/x,I=T*(c.tileID.canonical.x+c.tileID.wrap*x),k=T*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[_,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[I>>16,k>>16],u_pixel_coord_lower:[65535&I,65535&k]}}const Wn=(g,n,c,_)=>{const x=n.style.light,T=x.properties.get("position"),I=[T.x,T.y,T.z],k=l.create$1();"viewport"===x.properties.get("anchor")&&(l.fromRotation(k,-n.transform.angle),l.transformMat3(I,I,k));const W=x.properties.get("color");return{u_matrix:g,u_lightpos:I,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[W.r,W.g,W.b],u_vertical_gradient:+c,u_opacity:_}},yr=(g,n,c,_,x,T,I)=>l.extend(Wn(g,n,c,_),Bn(T,n,I),{u_height_factor:-Math.pow(2,x.overscaledZ)/I.tileSize/8}),Dr=g=>({u_matrix:g}),Oi=(g,n,c,_)=>l.extend(Dr(g),Bn(c,n,_)),dr=(g,n)=>({u_matrix:g,u_world:n}),jr=(g,n,c,_,x)=>l.extend(Oi(g,n,c,_),{u_world:x}),ae=(g,n,c,_)=>{const x=g.transform;let T;return T="map"===_.paint.get("circle-pitch-alignment")?x.calculatePixelsToTileUnitsMatrix(c):new Float32Array([x.pixelsToGLUnits[0],0,0,x.pixelsToGLUnits[1]]),{u_camera_to_center_distance:x.cameraToCenterDistance,u_matrix:g.translatePosMatrix(n.projMatrix,c,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:l.exported.devicePixelRatio,u_extrude_scale:T}},ee=g=>{const n=[];return"map"===g.paint.get("circle-pitch-alignment")&&n.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&n.push("SCALE_WITH_MAP"),n},Q=(g,n,c)=>{const _=l.EXTENT/c.tileSize;return{u_matrix:g,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/_,n.pixelsToGLUnits[1]/_]}},Oe=(g,n,c=1)=>({u_matrix:g,u_color:n,u_overlay:0,u_overlay_scale:c}),hn=(g,n,c,_)=>({u_matrix:g,u_extrude_scale:dt(n,1,c),u_intensity:_}),ti=(g,n,c,_,x,T)=>{const I=g.transform,k=I.calculatePixelsToTileUnitsMatrix(n),W={u_matrix:Wo(g,n,c,x),u_pixels_to_tile_units:k,u_device_pixel_ratio:l.exported.devicePixelRatio,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:T,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Ao(c)){const ne=xr(n,g.transform);W.u_texsize=n.lineAtlasTexture.size,W.u_scale=[ne,_.fromScale,_.toScale],W.u_mix=_.t}return W},Ir=(g,n,c,_,x)=>{const T=g.transform,I=xr(n,T);return{u_matrix:Wo(g,n,c,x),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:l.exported.devicePixelRatio,u_image:0,u_scale:[I,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function xr(g,n){return 1/dt(g,1,n.tileZoom)}function Wo(g,n,c,_){return g.translatePosMatrix(_||n.tileID.projMatrix,n,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function Ao(g){const n=g.paint.get("line-dasharray").value;return n.value||"constant"!==n.kind}const zs=(g,n,c,_,x,T)=>{return{u_matrix:g,u_tl_parent:n,u_scale_parent:c,u_fade_t:_.mix,u_opacity:_.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(k=x.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(I=x.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:As(x.paint.get("raster-hue-rotate")),u_perspective_transform:T};var I,k};function As(g){g*=Math.PI/180;const n=Math.sin(g),c=Math.cos(g);return[(2*c+1)/3,(-Math.sqrt(3)*n-c+1)/3,(Math.sqrt(3)*n-c+1)/3]}const Si=(g,n,c,_,x,T,I,k,W,ne,le,pe,De,Ze)=>{const Be=x.transform;return{u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Be.cameraToCenterDistance,u_pitch:Be.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:Be.width/Be.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:I,u_coord_matrix:k,u_is_text:+W,u_pitch_with_map:+_,u_texsize:ne,u_tile_id:le,u_zoom_transition:pe,u_inv_rot_matrix:De,u_merc_center:Ze,u_texture:0}},nl=(g,n,c,_,x,T,I,k,W,ne,le,pe,De,Ze,Be)=>{const{cameraToCenterDistance:Ve,_pitch:ct}=x.transform;return l.extend(Si(g,n,c,_,x,T,I,k,W,ne,pe,De,Ze,Be),{u_gamma_scale:_?Ve*Math.cos(x.terrain?0:ct):1,u_device_pixel_ratio:l.exported.devicePixelRatio,u_is_halo:+le})},Aa=(g,n,c,_,x,T,I,k,W,ne,le,pe,De,Ze)=>l.extend(nl(g,n,c,_,x,T,I,k,!0,W,!0,le,pe,De,Ze),{u_texsize_icon:ne,u_texture_icon:1}),br=(g,n,c)=>({u_matrix:g,u_opacity:n,u_color:c}),pa=(g,n,c,_,x,T)=>l.extend(function(I,k,W,ne){const le=W.imageManager.getPattern(I.from.toString()),pe=W.imageManager.getPattern(I.to.toString()),{width:De,height:Ze}=W.imageManager.getPixelSize(),Be=Math.pow(2,ne.tileID.overscaledZ),Ve=ne.tileSize*Math.pow(2,W.transform.tileZoom)/Be,ct=Ve*(ne.tileID.canonical.x+ne.tileID.wrap*Be),ze=Ve*ne.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:le.tl,u_pattern_br_a:le.br,u_pattern_tl_b:pe.tl,u_pattern_br_b:pe.br,u_texsize:[De,Ze],u_mix:k.t,u_pattern_size_a:le.displaySize,u_pattern_size_b:pe.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/dt(ne,1,W.transform.tileZoom),u_pixel_coord_upper:[ct>>16,ze>>16],u_pixel_coord_lower:[65535&ct,65535&ze]}}(_,T,c,x),{u_matrix:g,u_opacity:n}),Cl={fillExtrusion:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_lightpos:new l.Uniform3f(g,n.u_lightpos),u_lightintensity:new l.Uniform1f(g,n.u_lightintensity),u_lightcolor:new l.Uniform3f(g,n.u_lightcolor),u_vertical_gradient:new l.Uniform1f(g,n.u_vertical_gradient),u_opacity:new l.Uniform1f(g,n.u_opacity)}),fillExtrusionPattern:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_lightpos:new l.Uniform3f(g,n.u_lightpos),u_lightintensity:new l.Uniform1f(g,n.u_lightintensity),u_lightcolor:new l.Uniform3f(g,n.u_lightcolor),u_vertical_gradient:new l.Uniform1f(g,n.u_vertical_gradient),u_height_factor:new l.Uniform1f(g,n.u_height_factor),u_image:new l.Uniform1i(g,n.u_image),u_texsize:new l.Uniform2f(g,n.u_texsize),u_pixel_coord_upper:new l.Uniform2f(g,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(g,n.u_pixel_coord_lower),u_scale:new l.Uniform3f(g,n.u_scale),u_fade:new l.Uniform1f(g,n.u_fade),u_opacity:new l.Uniform1f(g,n.u_opacity)}),fill:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix)}),fillPattern:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_image:new l.Uniform1i(g,n.u_image),u_texsize:new l.Uniform2f(g,n.u_texsize),u_pixel_coord_upper:new l.Uniform2f(g,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(g,n.u_pixel_coord_lower),u_scale:new l.Uniform3f(g,n.u_scale),u_fade:new l.Uniform1f(g,n.u_fade)}),fillOutline:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_world:new l.Uniform2f(g,n.u_world)}),fillOutlinePattern:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_world:new l.Uniform2f(g,n.u_world),u_image:new l.Uniform1i(g,n.u_image),u_texsize:new l.Uniform2f(g,n.u_texsize),u_pixel_coord_upper:new l.Uniform2f(g,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(g,n.u_pixel_coord_lower),u_scale:new l.Uniform3f(g,n.u_scale),u_fade:new l.Uniform1f(g,n.u_fade)}),circle:(g,n)=>({u_camera_to_center_distance:new l.Uniform1f(g,n.u_camera_to_center_distance),u_extrude_scale:new l.UniformMatrix2f(g,n.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(g,n.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(g,n.u_matrix)}),collisionBox:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_camera_to_center_distance:new l.Uniform1f(g,n.u_camera_to_center_distance),u_extrude_scale:new l.Uniform2f(g,n.u_extrude_scale)}),collisionCircle:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_inv_matrix:new l.UniformMatrix4f(g,n.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(g,n.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(g,n.u_viewport_size)}),debug:(g,n)=>({u_color:new l.UniformColor(g,n.u_color),u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_overlay:new l.Uniform1i(g,n.u_overlay),u_overlay_scale:new l.Uniform1f(g,n.u_overlay_scale)}),clippingMask:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix)}),heatmap:(g,n)=>({u_extrude_scale:new l.Uniform1f(g,n.u_extrude_scale),u_intensity:new l.Uniform1f(g,n.u_intensity),u_matrix:new l.UniformMatrix4f(g,n.u_matrix)}),heatmapTexture:(g,n)=>({u_image:new l.Uniform1i(g,n.u_image),u_color_ramp:new l.Uniform1i(g,n.u_color_ramp),u_opacity:new l.Uniform1f(g,n.u_opacity)}),hillshade:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_image:new l.Uniform1i(g,n.u_image),u_latrange:new l.Uniform2f(g,n.u_latrange),u_light:new l.Uniform2f(g,n.u_light),u_shadow:new l.UniformColor(g,n.u_shadow),u_highlight:new l.UniformColor(g,n.u_highlight),u_accent:new l.UniformColor(g,n.u_accent)}),hillshadePrepare:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_image:new l.Uniform1i(g,n.u_image),u_dimension:new l.Uniform2f(g,n.u_dimension),u_zoom:new l.Uniform1f(g,n.u_zoom),u_unpack:new l.Uniform4f(g,n.u_unpack)}),line:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_pixels_to_tile_units:new l.UniformMatrix2f(g,n.u_pixels_to_tile_units),u_device_pixel_ratio:new l.Uniform1f(g,n.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(g,n.u_units_to_pixels),u_dash_image:new l.Uniform1i(g,n.u_dash_image),u_gradient_image:new l.Uniform1i(g,n.u_gradient_image),u_image_height:new l.Uniform1f(g,n.u_image_height),u_texsize:new l.Uniform2f(g,n.u_texsize),u_scale:new l.Uniform3f(g,n.u_scale),u_mix:new l.Uniform1f(g,n.u_mix),u_alpha_discard_threshold:new l.Uniform1f(g,n.u_alpha_discard_threshold)}),linePattern:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_texsize:new l.Uniform2f(g,n.u_texsize),u_pixels_to_tile_units:new l.UniformMatrix2f(g,n.u_pixels_to_tile_units),u_device_pixel_ratio:new l.Uniform1f(g,n.u_device_pixel_ratio),u_image:new l.Uniform1i(g,n.u_image),u_units_to_pixels:new l.Uniform2f(g,n.u_units_to_pixels),u_scale:new l.Uniform3f(g,n.u_scale),u_fade:new l.Uniform1f(g,n.u_fade),u_alpha_discard_threshold:new l.Uniform1f(g,n.u_alpha_discard_threshold)}),raster:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_tl_parent:new l.Uniform2f(g,n.u_tl_parent),u_scale_parent:new l.Uniform1f(g,n.u_scale_parent),u_fade_t:new l.Uniform1f(g,n.u_fade_t),u_opacity:new l.Uniform1f(g,n.u_opacity),u_image0:new l.Uniform1i(g,n.u_image0),u_image1:new l.Uniform1i(g,n.u_image1),u_brightness_low:new l.Uniform1f(g,n.u_brightness_low),u_brightness_high:new l.Uniform1f(g,n.u_brightness_high),u_saturation_factor:new l.Uniform1f(g,n.u_saturation_factor),u_contrast_factor:new l.Uniform1f(g,n.u_contrast_factor),u_spin_weights:new l.Uniform3f(g,n.u_spin_weights),u_perspective_transform:new l.Uniform2f(g,n.u_perspective_transform)}),symbolIcon:(g,n)=>({u_is_size_zoom_constant:new l.Uniform1i(g,n.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(g,n.u_is_size_feature_constant),u_size_t:new l.Uniform1f(g,n.u_size_t),u_size:new l.Uniform1f(g,n.u_size),u_camera_to_center_distance:new l.Uniform1f(g,n.u_camera_to_center_distance),u_pitch:new l.Uniform1f(g,n.u_pitch),u_rotate_symbol:new l.Uniform1i(g,n.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(g,n.u_aspect_ratio),u_fade_change:new l.Uniform1f(g,n.u_fade_change),u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(g,n.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(g,n.u_coord_matrix),u_is_text:new l.Uniform1i(g,n.u_is_text),u_pitch_with_map:new l.Uniform1i(g,n.u_pitch_with_map),u_texsize:new l.Uniform2f(g,n.u_texsize),u_tile_id:new l.Uniform3f(g,n.u_tile_id),u_zoom_transition:new l.Uniform1f(g,n.u_zoom_transition),u_inv_rot_matrix:new l.UniformMatrix4f(g,n.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(g,n.u_merc_center),u_texture:new l.Uniform1i(g,n.u_texture)}),symbolSDF:(g,n)=>({u_is_size_zoom_constant:new l.Uniform1i(g,n.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(g,n.u_is_size_feature_constant),u_size_t:new l.Uniform1f(g,n.u_size_t),u_size:new l.Uniform1f(g,n.u_size),u_camera_to_center_distance:new l.Uniform1f(g,n.u_camera_to_center_distance),u_pitch:new l.Uniform1f(g,n.u_pitch),u_rotate_symbol:new l.Uniform1i(g,n.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(g,n.u_aspect_ratio),u_fade_change:new l.Uniform1f(g,n.u_fade_change),u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(g,n.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(g,n.u_coord_matrix),u_is_text:new l.Uniform1i(g,n.u_is_text),u_pitch_with_map:new l.Uniform1i(g,n.u_pitch_with_map),u_texsize:new l.Uniform2f(g,n.u_texsize),u_texture:new l.Uniform1i(g,n.u_texture),u_gamma_scale:new l.Uniform1f(g,n.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(g,n.u_device_pixel_ratio),u_tile_id:new l.Uniform3f(g,n.u_tile_id),u_zoom_transition:new l.Uniform1f(g,n.u_zoom_transition),u_inv_rot_matrix:new l.UniformMatrix4f(g,n.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(g,n.u_merc_center),u_is_halo:new l.Uniform1i(g,n.u_is_halo)}),symbolTextAndIcon:(g,n)=>({u_is_size_zoom_constant:new l.Uniform1i(g,n.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(g,n.u_is_size_feature_constant),u_size_t:new l.Uniform1f(g,n.u_size_t),u_size:new l.Uniform1f(g,n.u_size),u_camera_to_center_distance:new l.Uniform1f(g,n.u_camera_to_center_distance),u_pitch:new l.Uniform1f(g,n.u_pitch),u_rotate_symbol:new l.Uniform1i(g,n.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(g,n.u_aspect_ratio),u_fade_change:new l.Uniform1f(g,n.u_fade_change),u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(g,n.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(g,n.u_coord_matrix),u_is_text:new l.Uniform1i(g,n.u_is_text),u_pitch_with_map:new l.Uniform1i(g,n.u_pitch_with_map),u_texsize:new l.Uniform2f(g,n.u_texsize),u_texsize_icon:new l.Uniform2f(g,n.u_texsize_icon),u_texture:new l.Uniform1i(g,n.u_texture),u_texture_icon:new l.Uniform1i(g,n.u_texture_icon),u_gamma_scale:new l.Uniform1f(g,n.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(g,n.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(g,n.u_is_halo)}),background:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_opacity:new l.Uniform1f(g,n.u_opacity),u_color:new l.UniformColor(g,n.u_color)}),backgroundPattern:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_opacity:new l.Uniform1f(g,n.u_opacity),u_image:new l.Uniform1i(g,n.u_image),u_pattern_tl_a:new l.Uniform2f(g,n.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(g,n.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(g,n.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(g,n.u_pattern_br_b),u_texsize:new l.Uniform2f(g,n.u_texsize),u_mix:new l.Uniform1f(g,n.u_mix),u_pattern_size_a:new l.Uniform2f(g,n.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(g,n.u_pattern_size_b),u_scale_a:new l.Uniform1f(g,n.u_scale_a),u_scale_b:new l.Uniform1f(g,n.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(g,n.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(g,n.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(g,n.u_tile_units_to_pixels)}),terrainRaster:$o,terrainDepth:$o,skybox:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_sun_direction:new l.Uniform3f(g,n.u_sun_direction),u_cubemap:new l.Uniform1i(g,n.u_cubemap),u_opacity:new l.Uniform1f(g,n.u_opacity),u_temporal_offset:new l.Uniform1f(g,n.u_temporal_offset)}),skyboxGradient:(g,n)=>({u_matrix:new l.UniformMatrix4f(g,n.u_matrix),u_color_ramp:new l.Uniform1i(g,n.u_color_ramp),u_center_direction:new l.Uniform3f(g,n.u_center_direction),u_radius:new l.Uniform1f(g,n.u_radius),u_opacity:new l.Uniform1f(g,n.u_opacity),u_temporal_offset:new l.Uniform1f(g,n.u_temporal_offset)}),skyboxCapture:(g,n)=>({u_matrix_3f:new l.UniformMatrix3f(g,n.u_matrix_3f),u_sun_direction:new l.Uniform3f(g,n.u_sun_direction),u_sun_intensity:new l.Uniform1f(g,n.u_sun_intensity),u_color_tint_r:new l.Uniform4f(g,n.u_color_tint_r),u_color_tint_m:new l.Uniform4f(g,n.u_color_tint_m),u_luminance:new l.Uniform1f(g,n.u_luminance)}),globeRaster:(g,n)=>({u_proj_matrix:new l.UniformMatrix4f(g,n.u_proj_matrix),u_globe_matrix:new l.UniformMatrix4f(g,n.u_globe_matrix),u_merc_matrix:new l.UniformMatrix4f(g,n.u_merc_matrix),u_zoom_transition:new l.Uniform1f(g,n.u_zoom_transition),u_merc_center:new l.Uniform2f(g,n.u_merc_center),u_image0:new l.Uniform1i(g,n.u_image0)}),globeAtmosphere:(g,n)=>({u_center:new l.Uniform2f(g,n.u_center),u_radius:new l.Uniform1f(g,n.u_radius),u_screen_size:new l.Uniform2f(g,n.u_screen_size),u_pixel_ratio:new l.Uniform1f(g,n.u_pixel_ratio),u_opacity:new l.Uniform1f(g,n.u_opacity),u_fadeout_range:new l.Uniform1f(g,n.u_fadeout_range),u_start_color:new l.Uniform3f(g,n.u_start_color),u_end_color:new l.Uniform3f(g,n.u_end_color)})};let ea;function ta(g,n,c,_,x,T,I){const k=g.context,W=k.gl,ne=g.useProgram("collisionBox"),le=[];let pe=0,De=0;for(let ht=0;ht<_.length;ht++){const rt=_[ht],st=n.getTile(rt),gt=st.getBucket(c);if(!gt)continue;let Zt=rt.projMatrix;0===x[0]&&0===x[1]||(Zt=g.translatePosMatrix(rt.projMatrix,st,x,T));const on=I?gt.textCollisionBox:gt.iconCollisionBox,zn=gt.collisionCircleArray;if(zn.length>0){const An=l.create(),Dn=Zt;l.mul(An,gt.placementInvProjMatrix,g.transform.glCoordMatrix),l.mul(An,An,gt.placementViewportMatrix),le.push({circleArray:zn,circleOffset:De,transform:Dn,invTransform:An}),pe+=zn.length/4,De=pe}on&&(g.terrain&&g.terrain.setupElevationDraw(st,ne),ne.draw(k,W.LINES,l.DepthMode.disabled,l.StencilMode.disabled,g.colorModeForRenderPass(),l.CullFaceMode.disabled,Q(Zt,g.transform,st),c.id,on.layoutVertexBuffer,on.indexBuffer,on.segments,null,g.transform.zoom,null,on.collisionVertexBuffer,on.collisionVertexBufferExt))}if(!I||!le.length)return;const Ze=g.useProgram("collisionCircle"),Be=new l.StructArrayLayout2f1f2i16;Be.resize(4*pe),Be._trim();let Ve=0;for(const ht of le)for(let rt=0;rt<ht.circleArray.length/4;rt++){const st=4*rt,gt=ht.circleArray[st+0],Zt=ht.circleArray[st+1],on=ht.circleArray[st+2],zn=ht.circleArray[st+3];Be.emplace(Ve++,gt,Zt,on,zn,0),Be.emplace(Ve++,gt,Zt,on,zn,1),Be.emplace(Ve++,gt,Zt,on,zn,2),Be.emplace(Ve++,gt,Zt,on,zn,3)}(!ea||ea.length<2*pe)&&(ea=function(ht){const rt=2*ht,st=new l.StructArrayLayout3ui6;st.resize(rt),st._trim();for(let gt=0;gt<rt;gt++){const Zt=6*gt;st.uint16[Zt+0]=4*gt+0,st.uint16[Zt+1]=4*gt+1,st.uint16[Zt+2]=4*gt+2,st.uint16[Zt+3]=4*gt+2,st.uint16[Zt+4]=4*gt+3,st.uint16[Zt+5]=4*gt+0}return st}(pe));const ct=k.createIndexBuffer(ea,!0),ze=k.createVertexBuffer(Be,l.collisionCircleLayout.members,!0);for(const ht of le){const rt={u_matrix:ht.transform,u_inv_matrix:ht.invTransform,u_camera_to_center_distance:(at=g.transform).cameraToCenterDistance,u_viewport_size:[at.width,at.height]};Ze.draw(k,W.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,g.colorModeForRenderPass(),l.CullFaceMode.disabled,rt,c.id,ze,ct,l.SegmentVector.simpleSegment(0,2*ht.circleOffset,ht.circleArray.length,ht.circleArray.length/2),null,g.transform.zoom,null,null,null)}var at;ze.destroy(),ct.destroy()}const Sn=l.identity(new Float32Array(16));function lr(g,n,c,_,x,T){const{horizontalAlign:I,verticalAlign:k}=l.getAnchorAlignment(g),W=-(I-.5)*n,ne=-(k-.5)*c,le=l.evaluateVariableOffset(g,_);return new l.pointGeometry((W/x+le[0])*T,(ne/x+le[1])*T)}function Jl(g,n,c,_,x,T,I,k,W,ne,le,pe){const De=g.text.placedSymbolArray,Ze=g.text.dynamicLayoutVertexArray,Be=g.icon.dynamicLayoutVertexArray,Ve={},ct=k.projMatrix,ze=T.elevation,at=ze?ze.getAtTileOffsetFunc(k,pe):ht=>[0,0,0];Ze.clear();for(let ht=0;ht<De.length;ht++){const rt=De.get(ht),st=g.allowVerticalPlacement&&!rt.placedOrientation,gt=rt.hidden||!rt.crossTileID||st?null:_[rt.crossTileID];if(gt){const Zt=new l.pointGeometry(rt.tileAnchorX,rt.tileAnchorY),on=at(Zt),zn=Zi(Zt,c?ct:I,on[2]),An=cr(T.cameraToCenterDistance,zn.signedDistanceFromCamera);let Dn=x.evaluateSizeForFeature(g.textSizeData,ne,rt)*An/l.ONE_EM;c&&(Dn*=g.tilePixelRatio/W);const{width:un,height:Jt,anchor:bn,textOffset:yn,textScale:di}=gt,Mi=lr(bn,un,Jt,yn,di,Dn),rr=c?Zi(Zt.add(Mi),I,on[2]).point:zn.point.add(n?Mi.rotate(-T.angle):Mi),Nn=g.allowVerticalPlacement&&rt.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let vi=0;vi<rt.numGlyphs;vi++)l.addDynamicAttributes(Ze,rr,Nn);le&&rt.associatedIconIndex>=0&&(Ve[rt.associatedIconIndex]={shiftedAnchor:rr,angle:Nn})}else Pr(rt.numGlyphs,Ze)}if(le){Be.clear();const ht=g.icon.placedSymbolArray;for(let rt=0;rt<ht.length;rt++){const st=ht.get(rt);if(st.hidden)Pr(st.numGlyphs,Be);else{const gt=Ve[rt];if(gt)for(let Zt=0;Zt<st.numGlyphs;Zt++)l.addDynamicAttributes(Be,gt.shiftedAnchor,gt.angle);else Pr(st.numGlyphs,Be)}}g.icon.dynamicLayoutVertexBuffer.updateData(Be)}g.text.dynamicLayoutVertexBuffer.updateData(Ze)}function Co(g,n,c){return c.iconsInText&&n?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function il(g,n,c,_,x,T,I,k,W,ne,le,pe){const De=g.context,Ze=De.gl,Be=g.transform,Ve=Be.projection.createTileTransform(Be,Be.worldSize),ct="map"===k,ze="map"===W,at=ct&&"point"!==c.layout.get("symbol-placement"),ht=ct&&!ze&&!at,rt=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let st=!1;const gt=g.depthModeForSublayer(0,l.DepthMode.ReadOnly),Zt=[l.mercatorXfromLng(Be.center.lng),l.mercatorYfromLat(Be.center.lat)],on=c.layout.get("text-variable-anchor"),zn="globe"===Be.projection.name,An=zn?l.globeToMercatorTransition(Be.zoom):0,Dn=[],un=[];g.terrain&&ze&&un.push("PITCH_WITH_MAP_TERRAIN"),zn&&un.push("PROJECTION_GLOBE_VIEW"),at&&un.push("PROJECTED_POS_ON_VIEWPORT");for(const Jt of _){const bn=n.getTile(Jt),yn=bn.getBucket(c);if(!yn||yn.projection!==Be.projection.name)continue;const di=x?yn.text:yn.icon;if(!di||yn.fullyClipped||!di.segments.get().length)continue;const Mi=di.programConfigurations.get(c.id),rr=x||yn.sdfIcons,Nn=x?yn.textSizeData:yn.iconSizeData,vi=ze||0!==Be.pitch,Yi=g.useProgram(Co(rr,x,yn),Mi,un),Ar=l.evaluateSizeForZoom(Nn,Be.zoom),Xr=[Jt.canonical.x,Jt.canonical.y,1<<Jt.canonical.z];let Gi,Li,lo,jo,ds=[0,0],hs=null;if(x){if(Li=bn.glyphAtlasTexture,lo=Ze.LINEAR,Gi=bn.glyphAtlasTexture.size,yn.iconsInText){ds=bn.imageAtlasTexture.size,hs=bn.imageAtlasTexture;const Xo="composite"===Nn.kind||"camera"===Nn.kind;jo=vi||g.options.rotating||g.options.zooming||Xo?Ze.LINEAR:Ze.NEAREST}}else{const Xo=1!==c.layout.get("icon-size").constantOr(0)||yn.iconsNeedLinear;Li=bn.imageAtlasTexture,lo=rr||g.options.rotating||g.options.zooming||Xo||vi?Ze.LINEAR:Ze.NEAREST,Gi=bn.imageAtlasTexture.size}const sa=g.transform.calculatePixelsToTileUnitsMatrix(bn),wr=mi(Jt.projMatrix,bn.tileID.canonical,ze,ct,g.transform,sa),Ji=g.terrain&&ze&&at?l.invert(new Float32Array(16),wr):Sn,or=Ii(Jt.projMatrix,bn.tileID.canonical,ze,ct,g.transform,sa),no=on&&yn.hasTextData(),Cs="none"!==c.layout.get("icon-text-fit")&&no&&yn.hasIconData();if(at){const Xo=Be.elevation,qs=Xo?Xo.getAtTileOffsetFunc(Jt,Ve):Hs=>[0,0,0];_r(yn,Jt.projMatrix,g,x,wr,or,ze,ne,qs,Jt)}const Gr=g.translatePosMatrix(Jt.projMatrix,bn,T,I),Ps=at||x&&on||Cs?Sn:wr,nc=g.translatePosMatrix(or,bn,T,I,!0),ps=rr&&0!==c.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let Ta;const ai=Ve.createInversionMatrix(Jt.toUnwrapped());Ta=rr?yn.iconsInText?Aa(Nn.kind,Ar,ht,ze,g,Gr,Ps,nc,Gi,ds,Xr,An,ai,Zt):nl(Nn.kind,Ar,ht,ze,g,Gr,Ps,nc,x,Gi,!0,Xr,An,ai,Zt):Si(Nn.kind,Ar,ht,ze,g,Gr,Ps,nc,x,Gi,Xr,An,ai,Zt);const Ti={program:Yi,buffers:di,uniformValues:Ta,atlasTexture:Li,atlasTextureIcon:hs,atlasInterpolation:lo,atlasInterpolationIcon:jo,isSDF:rr,hasHalo:ps,tile:bn,labelPlaneMatrixInv:Ji};if(rt&&yn.canOverlap){st=!0;const Xo=di.segments.get();for(const qs of Xo)Dn.push({segments:new l.SegmentVector([qs]),sortKey:qs.sortKey,state:Ti})}else Dn.push({segments:di.segments,sortKey:0,state:Ti})}st&&Dn.sort((Jt,bn)=>Jt.sortKey-bn.sortKey);for(const Jt of Dn){const bn=Jt.state;if(g.terrain&&g.terrain.setupElevationDraw(bn.tile,bn.program,{useDepthForOcclusion:!zn,labelPlaneMatrixInv:bn.labelPlaneMatrixInv}),De.activeTexture.set(Ze.TEXTURE0),bn.atlasTexture.bind(bn.atlasInterpolation,Ze.CLAMP_TO_EDGE),bn.atlasTextureIcon&&(De.activeTexture.set(Ze.TEXTURE1),bn.atlasTextureIcon&&bn.atlasTextureIcon.bind(bn.atlasInterpolationIcon,Ze.CLAMP_TO_EDGE)),bn.isSDF){const yn=bn.uniformValues;bn.hasHalo&&(yn.u_is_halo=1,Us(bn.buffers,Jt.segments,c,g,bn.program,gt,le,pe,yn)),yn.u_is_halo=0}Us(bn.buffers,Jt.segments,c,g,bn.program,gt,le,pe,bn.uniformValues)}}function Us(g,n,c,_,x,T,I,k,W){const ne=_.context;x.draw(ne,ne.gl.TRIANGLES,T,I,k,l.CullFaceMode.disabled,W,c.id,g.layoutVertexBuffer,g.indexBuffer,n,c.paint,_.transform.zoom,g.programConfigurations.get(c.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function is(g,n,c,_,x,T,I){const k=g.context.gl,W=c.paint.get("fill-pattern"),ne=W&&W.constantOr(1),le=c.getCrossfadeParameters();let pe,De,Ze,Be,Ve;I?(De=ne&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",pe=k.LINES):(De=ne?"fillPattern":"fill",pe=k.TRIANGLES);for(const ct of _){const ze=n.getTile(ct);if(ne&&!ze.patternsLoaded())continue;const at=ze.getBucket(c);if(!at)continue;g.prepareDrawTile(ct);const ht=at.programConfigurations.get(c.id),rt=g.useProgram(De,ht);ne&&(g.context.activeTexture.set(k.TEXTURE0),ze.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ht.updatePaintBuffers(le));const st=W.constantOr(null);if(st&&ze.imageAtlas){const Zt=ze.imageAtlas,on=Zt.patternPositions[st.to.toString()],zn=Zt.patternPositions[st.from.toString()];on&&zn&&ht.setConstantPatternPositions(on,zn)}const gt=g.translatePosMatrix(ct.projMatrix,ze,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(I){Be=at.indexBuffer2,Ve=at.segments2;const Zt=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];Ze="fillOutlinePattern"===De&&ne?jr(gt,g,le,ze,Zt):dr(gt,Zt)}else Be=at.indexBuffer,Ve=at.segments,Ze=ne?Oi(gt,g,le,ze):Dr(gt);g.prepareDrawProgram(g.context,rt,ct.toUnwrapped()),rt.draw(g.context,pe,x,g.stencilModeForClipping(ct),T,l.CullFaceMode.disabled,Ze,c.id,at.layoutVertexBuffer,Be,Ve,c.paint,g.transform.zoom,ht)}}function fa(g,n,c,_,x,T,I){const k=g.context,W=k.gl,ne=c.paint.get("fill-extrusion-pattern"),le=ne.constantOr(1),pe=c.getCrossfadeParameters(),De=c.paint.get("fill-extrusion-opacity");for(const Ze of _){const Be=n.getTile(Ze),Ve=Be.getBucket(c);if(!Ve)continue;const ct=Ve.programConfigurations.get(c.id),ze=g.useProgram(le?"fillExtrusionPattern":"fillExtrusion",ct);if(g.terrain){const gt=g.terrain;if(!Ve.enableTerrain)continue;if(gt.setupElevationDraw(Be,ze,{useMeterToDem:!0}),ma(k,n,Ze,Ve,c,gt),!Ve.centroidVertexBuffer){const Zt=ze.attributes.a_centroid_pos;void 0!==Zt&&W.vertexAttrib2f(Zt,0,0)}}le&&(g.context.activeTexture.set(W.TEXTURE0),Be.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),ct.updatePaintBuffers(pe));const at=ne.constantOr(null);if(at&&Be.imageAtlas){const gt=Be.imageAtlas,Zt=gt.patternPositions[at.to.toString()],on=gt.patternPositions[at.from.toString()];Zt&&on&&ct.setConstantPatternPositions(Zt,on)}const ht=g.translatePosMatrix(Ze.projMatrix,Be,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),rt=c.paint.get("fill-extrusion-vertical-gradient"),st=le?yr(ht,g,rt,De,Ze,pe,Be):Wn(ht,g,rt,De);g.prepareDrawProgram(k,ze,Ze.toUnwrapped()),ze.draw(k,k.gl.TRIANGLES,x,T,I,l.CullFaceMode.backCCW,st,c.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,c.paint,g.transform.zoom,ct,g.terrain?Ve.centroidVertexBuffer:null)}}function ma(g,n,c,_,x,T){const I=[ze=>{let at=ze.canonical.x-1,ht=ze.wrap;return at<0&&(at=(1<<ze.canonical.z)-1,ht--),new l.OverscaledTileID(ze.overscaledZ,ht,ze.canonical.z,at,ze.canonical.y)},ze=>{let at=ze.canonical.x+1,ht=ze.wrap;return at===1<<ze.canonical.z&&(at=0,ht++),new l.OverscaledTileID(ze.overscaledZ,ht,ze.canonical.z,at,ze.canonical.y)},ze=>new l.OverscaledTileID(ze.overscaledZ,ze.wrap,ze.canonical.z,ze.canonical.x,(0===ze.canonical.y?1<<ze.canonical.z:ze.canonical.y)-1),ze=>new l.OverscaledTileID(ze.overscaledZ,ze.wrap,ze.canonical.z,ze.canonical.x,ze.canonical.y===(1<<ze.canonical.z)-1?0:ze.canonical.y+1)],k=ze=>{const at=n.getSource().maxzoom,ht=Zt=>{const on=n.getTileByID(Zt);if(on&&on.hasData())return on.getBucket(x)};let rt,st,gt;return(ze.overscaledZ===ze.canonical.z||ze.overscaledZ>=at)&&(rt=ht(ze.key)),ze.overscaledZ>=at&&(st=ht(ze.calculateScaledKey(ze.overscaledZ+1))),ze.overscaledZ>at&&(gt=ht(ze.calculateScaledKey(ze.overscaledZ-1))),rt||st||gt},W=[0,0,0],ne=(ze,at)=>(W[0]=Math.min(ze.min.y,at.min.y),W[1]=Math.max(ze.max.y,at.max.y),W[2]=l.EXTENT-at.min.x>ze.max.x?at.min.x-l.EXTENT:ze.max.x,W),le=(ze,at)=>(W[0]=Math.min(ze.min.x,at.min.x),W[1]=Math.max(ze.max.x,at.max.x),W[2]=l.EXTENT-at.min.y>ze.max.y?at.min.y-l.EXTENT:ze.max.y,W),pe=[(ze,at)=>ne(ze,at),(ze,at)=>ne(at,ze),(ze,at)=>le(ze,at),(ze,at)=>le(at,ze)],De=new l.pointGeometry(0,0);let Ze,Be,Ve;const ct=(ze,at,ht,rt,st)=>{const gt=[[rt?ht:ze,rt?ze:ht,0],[rt?ht:at,rt?at:ht,0]],Zt=st<0?l.EXTENT+st:st,on=[rt?Zt:(ze+at)/2,rt?(ze+at)/2:Zt,0];return 0===ht&&st<0||0!==ht&&st>0?T.getForTilePoints(Ve,[on],!0,Be):gt.push(on),T.getForTilePoints(c,gt,!0,Ze),Math.max(gt[0][2],gt[1][2],on[2])/T.exaggeration()};for(let ze=0;ze<4;ze++){const at=_.borders[ze];if(0===at.length&&(_.borderDone[ze]=!0),_.borderDone[ze])continue;const ht=Ve=I[ze](c),rt=k(ht);if(!(rt&&rt.enableTerrain&&(Be=T.findDEMTileFor(ht),Be&&Be.dem)))continue;if(!Ze){const on=T.findDEMTileFor(c);if(!on||!on.dem)return;Ze=on}const st=(ze<2?1:5)-ze,gt=rt.borders[st];let Zt=0;for(let on=0;on<at.length;on++){const zn=_.featuresOnBorder[at[on]],An=zn.borders[ze];let Dn;for(;Zt<gt.length&&(Dn=rt.featuresOnBorder[gt[Zt]],!(Dn.borders[st][1]>An[0]+3));)rt.borderDone[st]||rt.encodeCentroid(void 0,Dn,!1),Zt++;if(Dn&&Zt<gt.length){const un=Zt;let Jt=0;for(;!(Dn.borders[st][0]>An[1]-3)&&(Jt++,++Zt!==gt.length);)Dn=rt.featuresOnBorder[gt[Zt]];if(Dn=rt.featuresOnBorder[gt[un]],zn.intersectsCount()>1||Dn.intersectsCount()>1||1!==Jt){1!==Jt&&(Zt=un),_.encodeCentroid(void 0,zn,!1),rt.borderDone[st]||rt.encodeCentroid(void 0,Dn,!1);continue}const bn=pe[ze](zn,Dn),yn=ze%2?l.EXTENT-1:0;De.x=ct(bn[0],Math.min(l.EXTENT-1,bn[1]),yn,ze<2,bn[2]),De.y=0,_.encodeCentroid(De,zn,!1),rt.borderDone[st]||rt.encodeCentroid(De,Dn,!1)}else _.encodeCentroid(void 0,zn,!1)}_.borderDone[ze]=_.needsCentroidUpdate=!0,rt.borderDone[st]||(rt.borderDone[st]=rt.needsCentroidUpdate=!0)}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(g)}const D=new l.Color(1,0,0,1),Y=new l.Color(0,1,0,1),E=new l.Color(0,0,1,1),H=new l.Color(1,0,1,1),ve=new l.Color(0,1,1,1);function vt(g,n,c,_){Vn(g,0,n+c/2,g.transform.width,c,_)}function In(g,n,c,_){Vn(g,n-c/2,0,c,g.transform.height,_)}function Vn(g,n,c,_,x,T){const I=g.context,k=I.gl;k.enable(k.SCISSOR_TEST),k.scissor(n*l.exported.devicePixelRatio,c*l.exported.devicePixelRatio,_*l.exported.devicePixelRatio,x*l.exported.devicePixelRatio),I.clear({color:T}),k.disable(k.SCISSOR_TEST)}function wi(g,n,c){const _=g.context,x=_.gl,T=c.projMatrix,I=g.useProgram("debug"),k=n.getTileByID(c.key);g.terrain&&g.terrain.setupElevationDraw(k,I);const W=l.DepthMode.disabled,ne=l.StencilMode.disabled,le=g.colorModeForRenderPass();_.activeTexture.set(x.TEXTURE0),g.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),k._makeDebugTileBoundsBuffers(g.context,g.transform.projection);const De=k._tileDebugBuffer||g.debugBuffer,Ze=k._tileDebugIndexBuffer||g.debugIndexBuffer,Be=k._tileDebugSegments||g.debugSegments;I.draw(_,x.LINE_STRIP,W,ne,le,l.CullFaceMode.disabled,Oe(T,l.Color.red),"$debug",De,Ze,Be);const Ve=k.latestRawTileData,ct=Math.floor((Ve&&Ve.byteLength||0)/1024),ze=n.getTile(c).tileSize,at=512/Math.min(ze,512)*(c.overscaledZ/g.transform.zoom)*.5;let ht=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(ht+=` => ${c.overscaledZ}`),function(rt,st){rt.initDebugOverlayCanvas();const gt=rt.debugOverlayCanvas,Zt=rt.context.gl,on=rt.debugOverlayCanvas.getContext("2d");on.clearRect(0,0,gt.width,gt.height),on.shadowColor="white",on.shadowBlur=2,on.lineWidth=1.5,on.strokeStyle="white",on.textBaseline="top",on.font="bold 36px Open Sans, sans-serif",on.fillText(st,5,5),on.strokeText(st,5,5),rt.debugOverlayTexture.update(gt),rt.debugOverlayTexture.bind(Zt.LINEAR,Zt.CLAMP_TO_EDGE)}(g,`${ht} ${ct}kb`),I.draw(_,x.TRIANGLES,W,ne,l.ColorMode.alphaBlended,l.CullFaceMode.disabled,Oe(T,l.Color.transparent,at),"$debug",g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments)}const ui=l.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:er}=ui;function hr(g,n,c,_){g.emplaceBack(n,c,_)}class Or{constructor(n){this.vertexArray=new l.StructArrayLayout3f12,this.indices=new l.StructArrayLayout3ui6,hr(this.vertexArray,-1,-1,1),hr(this.vertexArray,1,-1,1),hr(this.vertexArray,-1,1,1),hr(this.vertexArray,1,1,1),hr(this.vertexArray,-1,-1,-1),hr(this.vertexArray,1,-1,-1),hr(this.vertexArray,-1,1,-1),hr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,er),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=l.SegmentVector.simpleSegment(0,0,36,12)}}function eo(g,n,c,_,x,T){const I=g.gl,k=n.paint.get("sky-atmosphere-color"),W=n.paint.get("sky-atmosphere-halo-color"),ne=n.paint.get("sky-atmosphere-sun-intensity"),le={u_matrix_3f:l.fromMat4([],_),u_sun_direction:x,u_sun_intensity:ne,u_color_tint_r:[(Be=k).r,Be.g,Be.b,Be.a],u_color_tint_m:[(Ve=W).r,Ve.g,Ve.b,Ve.a],u_luminance:5e-5};var Be,Ve;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+T,n.skyboxTexture,0),c.draw(g,I.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.frontCW,le,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Lo={symbol:function(g,n,c,_,x){if("translucent"!==g.renderPass)return;const T=l.StencilMode.disabled,I=g.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(k,W,ne,le,pe,De,Ze){const Be=W.transform,Ve="map"===pe,ct="map"===De,ze=Be.projection.createTileTransform(Be,Be.worldSize);for(const at of k){const ht=le.getTile(at),rt=ht.getBucket(ne);if(!rt||rt.projection!==Be.projection.name||!rt.text||!rt.text.segments.get().length)continue;const st=l.evaluateSizeForZoom(rt.textSizeData,Be.zoom),gt=W.transform.calculatePixelsToTileUnitsMatrix(ht),Zt=mi(at.projMatrix,ht.tileID.canonical,ct,Ve,W.transform,gt),on="none"!==ne.layout.get("icon-text-fit")&&rt.hasIconData();if(st){const zn=Math.pow(2,Be.zoom-ht.tileID.overscaledZ);Jl(rt,Ve,ct,Ze,l.symbolSize,Be,Zt,at,zn,st,on,ze)}}}(_,g,c,n,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x),0!==c.paint.get("icon-opacity").constantOr(1)&&il(g,n,c,_,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),T,I),0!==c.paint.get("text-opacity").constantOr(1)&&il(g,n,c,_,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),T,I),n.map.showCollisionBoxes&&(ta(g,n,c,_,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),ta(g,n,c,_,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(g,n,c,_){if("translucent"!==g.renderPass)return;const x=c.paint.get("circle-opacity"),T=c.paint.get("circle-stroke-width"),I=c.paint.get("circle-stroke-opacity"),k=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===x.constantOr(1)&&(0===T.constantOr(1)||0===I.constantOr(1)))return;const W=g.context,ne=W.gl,le=g.depthModeForSublayer(0,l.DepthMode.ReadOnly),pe=l.StencilMode.disabled,De=g.colorModeForRenderPass(),Ze=[];for(let Ve=0;Ve<_.length;Ve++){const ct=_[Ve],ze=n.getTile(ct),at=ze.getBucket(c);if(!at)continue;const ht=at.programConfigurations.get(c.id),rt=ee(c),st={programConfiguration:ht,program:g.useProgram("circle",ht,rt),layoutVertexBuffer:at.layoutVertexBuffer,indexBuffer:at.indexBuffer,uniformValues:ae(g,ct,ze,c),tile:ze};if(k){const gt=at.segments.get();for(const Zt of gt)Ze.push({segments:new l.SegmentVector([Zt]),sortKey:Zt.sortKey,state:st})}else Ze.push({segments:at.segments,sortKey:0,state:st})}k&&Ze.sort((Ve,ct)=>Ve.sortKey-ct.sortKey);const Be={useDepthForOcclusion:"globe"!==g.transform.projection.name};for(const Ve of Ze){const{programConfiguration:ct,program:ze,layoutVertexBuffer:at,indexBuffer:ht,uniformValues:rt,tile:st}=Ve.state,gt=Ve.segments;g.terrain&&g.terrain.setupElevationDraw(st,ze,Be),g.prepareDrawProgram(W,ze,st.tileID.toUnwrapped()),ze.draw(W,ne.TRIANGLES,le,pe,De,l.CullFaceMode.disabled,rt,c.id,at,ht,gt,c.paint,g.transform.zoom,ct)}},heatmap:function(g,n,c,_){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const x=g.context,T=x.gl,I=l.StencilMode.disabled,k=new l.ColorMode([T.ONE,T.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(W,ne,le){const pe=W.gl;W.activeTexture.set(pe.TEXTURE1),W.viewport.set([0,0,ne.width/4,ne.height/4]);let De=le.heatmapFbo;if(De)pe.bindTexture(pe.TEXTURE_2D,De.colorAttachment.get()),W.bindFramebuffer.set(De.framebuffer);else{const Ze=pe.createTexture();pe.bindTexture(pe.TEXTURE_2D,Ze),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_WRAP_S,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_WRAP_T,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_MIN_FILTER,pe.LINEAR),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_MAG_FILTER,pe.LINEAR),De=le.heatmapFbo=W.createFramebuffer(ne.width/4,ne.height/4,!1),function(Be,Ve,ct,ze){const at=Be.gl;at.texImage2D(at.TEXTURE_2D,0,at.RGBA,Ve.width/4,Ve.height/4,0,at.RGBA,Be.extRenderToTextureHalfFloat?Be.extTextureHalfFloat.HALF_FLOAT_OES:at.UNSIGNED_BYTE,null),ze.colorAttachment.set(ct)}(W,ne,Ze,De)}})(x,g,c),x.clear({color:l.Color.transparent});for(let W=0;W<_.length;W++){const ne=_[W];if(n.hasRenderableParent(ne))continue;const le=n.getTile(ne),pe=le.getBucket(c);if(!pe)continue;const De=pe.programConfigurations.get(c.id),Ze=g.useProgram("heatmap",De),{zoom:Be}=g.transform;g.terrain&&g.terrain.setupElevationDraw(le,Ze),g.prepareDrawProgram(x,Ze,ne.toUnwrapped()),Ze.draw(x,T.TRIANGLES,l.DepthMode.disabled,I,k,l.CullFaceMode.disabled,hn(ne.projMatrix,le,Be,c.paint.get("heatmap-intensity")),c.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,c.paint,g.transform.zoom,De)}x.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(x,T){const I=x.context,k=I.gl,W=T.heatmapFbo;if(!W)return;I.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,W.colorAttachment.get()),I.activeTexture.set(k.TEXTURE1);let ne=T.colorRampTexture;ne||(ne=T.colorRampTexture=new l.Texture(I,T.colorRamp,k.RGBA)),ne.bind(k.LINEAR,k.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(I,k.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,x.colorModeForRenderPass(),l.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:T.paint.get("heatmap-opacity")},T.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,T.paint,x.transform.zoom)}(g,c))},line:function(g,n,c,_){if("translucent"!==g.renderPass)return;const x=c.paint.get("line-opacity"),T=c.paint.get("line-width");if(0===x.constantOr(1)||0===T.constantOr(1))return;const I=g.depthModeForSublayer(0,l.DepthMode.ReadOnly),k=g.colorModeForRenderPass(),W=c.paint.get("line-dasharray"),ne=W.constantOr(1),le=c.layout.get("line-cap"),pe=c.paint.get("line-pattern"),De=pe.constantOr(1),Ze=c.paint.get("line-gradient"),Be=c.getCrossfadeParameters(),Ve=De?"linePattern":"line",ct=g.context,ze=ct.gl,at=(rt=>{const st=[];Ao(rt)&&st.push("RENDER_LINE_DASH"),rt.paint.get("line-gradient")&&st.push("RENDER_LINE_GRADIENT");const gt=rt.paint.get("line-pattern").constantOr(1),Zt=1!==rt.paint.get("line-opacity").constantOr(1);return!gt&&Zt&&st.push("RENDER_LINE_ALPHA_DISCARD"),st})(c);let ht=at.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(ht=!1);for(const rt of _){const st=n.getTile(rt);if(De&&!st.patternsLoaded())continue;const gt=st.getBucket(c);if(!gt)continue;g.prepareDrawTile(rt);const Zt=gt.programConfigurations.get(c.id),on=g.useProgram(Ve,Zt,at),zn=pe.constantOr(null);if(zn&&st.imageAtlas){const yn=st.imageAtlas,di=yn.patternPositions[zn.to.toString()],Mi=yn.patternPositions[zn.from.toString()];di&&Mi&&Zt.setConstantPatternPositions(di,Mi)}const An=W.constantOr(null),Dn=le.constantOr(null);if(!De&&An&&Dn&&st.lineAtlas){const yn=st.lineAtlas,di=yn.getDash(An.to,Dn),Mi=yn.getDash(An.from,Dn);di&&Mi&&Zt.setConstantPatternPositions(di,Mi)}const un=g.terrain?rt.projMatrix:null,Jt=De?Ir(g,st,c,Be,un):ti(g,st,c,Be,un,gt.lineClipsArray.length);if(Ze){const yn=gt.gradients[c.id];let di=yn.texture;if(c.gradientVersion!==yn.version){let Mi=256;if(c.stepInterpolant){const rr=n.getSource().maxzoom,Nn=rt.canonical.z===rr?Math.ceil(1<<g.transform.maxZoom-rt.canonical.z):1;Mi=l.clamp(l.nextPowerOfTwo(gt.maxLineLength/l.EXTENT*1024*Nn),256,ct.maxTextureSize)}yn.gradient=l.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Mi,image:yn.gradient||void 0,clips:gt.lineClipsArray}),yn.texture?yn.texture.update(yn.gradient):yn.texture=new l.Texture(ct,yn.gradient,ze.RGBA),yn.version=c.gradientVersion,di=yn.texture}ct.activeTexture.set(ze.TEXTURE1),di.bind(c.stepInterpolant?ze.NEAREST:ze.LINEAR,ze.CLAMP_TO_EDGE)}ne&&(ct.activeTexture.set(ze.TEXTURE0),st.lineAtlasTexture.bind(ze.LINEAR,ze.REPEAT),Zt.updatePaintBuffers(Be)),De&&(ct.activeTexture.set(ze.TEXTURE0),st.imageAtlasTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Zt.updatePaintBuffers(Be)),g.prepareDrawProgram(ct,on,rt.toUnwrapped());const bn=yn=>{on.draw(ct,ze.TRIANGLES,I,yn,k,l.CullFaceMode.disabled,Jt,c.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,c.paint,g.transform.zoom,Zt,gt.layoutVertexBuffer2)};if(ht){const yn=g.stencilModeForClipping(rt).ref;0===yn&&g.terrain&&ct.clear({stencil:0});const di={func:ze.EQUAL,mask:255};Jt.u_alpha_discard_threshold=.8,bn(new l.StencilMode(di,yn,255,ze.KEEP,ze.KEEP,ze.INVERT)),Jt.u_alpha_discard_threshold=0,bn(new l.StencilMode(di,yn,255,ze.KEEP,ze.KEEP,ze.KEEP))}else bn(g.stencilModeForClipping(rt))}ht&&(g.resetStencilClippingMasks(),g.terrain&&ct.clear({stencil:0}))},fill:function(g,n,c,_){const x=c.paint.get("fill-color"),T=c.paint.get("fill-opacity");if(0===T.constantOr(1))return;const I=g.colorModeForRenderPass(),k=c.paint.get("fill-pattern"),W=g.opaquePassEnabledForLayer()&&!k.constantOr(1)&&1===x.constantOr(l.Color.transparent).a&&1===T.constantOr(0)?"opaque":"translucent";if(g.renderPass===W){const ne=g.depthModeForSublayer(1,"opaque"===g.renderPass?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly);is(g,n,c,_,ne,I,!1)}if("translucent"===g.renderPass&&c.paint.get("fill-antialias")){const ne=g.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,l.DepthMode.ReadOnly);is(g,n,c,_,ne,I,!0)}},"fill-extrusion":function(g,n,c,_){const x=c.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===g.renderPass){const T=new l.DepthMode(g.context.gl.LEQUAL,l.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==x||c.paint.get("fill-extrusion-pattern").constantOr(1))fa(g,n,c,_,T,l.StencilMode.disabled,l.ColorMode.disabled),fa(g,n,c,_,T,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const I=g.colorModeForRenderPass();fa(g,n,c,_,T,l.StencilMode.disabled,I)}}},hillshade:function(g,n,c,_){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const x=g.context,T=g.depthModeForSublayer(0,l.DepthMode.ReadOnly),I=g.colorModeForRenderPass(),k=g.terrain&&g.terrain.renderingToTexture,[W,ne]="translucent"!==g.renderPass||k?[{},_]:g.stencilConfigForOverlap(_);for(const le of ne){const pe=n.getTile(le);if(pe.needsHillshadePrepare&&"offscreen"===g.renderPass)Bs(g,pe,c,T,l.StencilMode.disabled,I);else if("translucent"===g.renderPass){const De=k&&g.terrain?g.terrain.stencilModeForRTTOverlap(le):W[le.overscaledZ];bs(g,le,pe,c,T,De,I)}}x.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,n,c,_,x,T){if("translucent"!==g.renderPass||0===c.paint.get("raster-opacity")||!_.length)return;const I=g.context,k=I.gl,W=n.getSource(),ne=g.useProgram("raster"),le=g.colorModeForRenderPass(),pe=g.terrain&&g.terrain.renderingToTexture,[De,Ze]=W instanceof Rr||pe?[{},_]:g.stencilConfigForOverlap(_),Be=Ze[Ze.length-1].overscaledZ,Ve=!g.options.moving;for(const ct of Ze){const ze=pe?l.DepthMode.disabled:g.depthModeForSublayer(ct.overscaledZ-Be,1===c.paint.get("raster-opacity")?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly,k.LESS),at=ct.toUnwrapped(),ht=n.getTile(ct);if(pe&&(!ht||!ht.hasData()))continue;const rt=pe?ct.projMatrix:g.transform.calculateProjMatrix(at,Ve),st=g.terrain&&pe?g.terrain.stencilModeForRTTOverlap(ct):De[ct.overscaledZ],gt=T?0:c.paint.get("raster-fade-duration");ht.registerFadeDuration(gt);const Zt=n.findLoadedParent(ct,0),on=Qs(ht,Zt,n,g.transform,gt);let zn,An;g.terrain&&g.terrain.prepareDrawTile(ct);const Dn="nearest"===c.paint.get("raster-resampling")?k.NEAREST:k.LINEAR;I.activeTexture.set(k.TEXTURE0),ht.texture.bind(Dn,k.CLAMP_TO_EDGE),I.activeTexture.set(k.TEXTURE1),Zt?(Zt.texture.bind(Dn,k.CLAMP_TO_EDGE),zn=Math.pow(2,Zt.tileID.overscaledZ-ht.tileID.overscaledZ),An=[ht.tileID.canonical.x*zn%1,ht.tileID.canonical.y*zn%1]):ht.texture.bind(Dn,k.CLAMP_TO_EDGE);const un=zs(rt,An||[0,0],zn||1,on,c,W instanceof Rr?W.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(I,ne,at),W instanceof Rr)ne.draw(I,k.TRIANGLES,ze,l.StencilMode.disabled,le,l.CullFaceMode.disabled,un,c.id,W.boundsBuffer,g.quadTriangleIndexBuffer,W.boundsSegments);else{const{tileBoundsBuffer:Jt,tileBoundsIndexBuffer:bn,tileBoundsSegments:yn}=g.getTileBoundsBuffers(ht);ne.draw(I,k.TRIANGLES,ze,st,le,l.CullFaceMode.disabled,un,c.id,Jt,bn,yn)}}g.resetStencilClippingMasks()},background:function(g,n,c,_){const x=c.paint.get("background-color"),T=c.paint.get("background-opacity");if(0===T)return;const I=g.context,k=I.gl,W=g.transform,ne=W.tileSize,le=c.paint.get("background-pattern");if(g.isPatternMissing(le))return;const pe=!le&&1===x.a&&1===T&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==pe)return;const De=l.StencilMode.disabled,Ze=g.depthModeForSublayer(0,"opaque"===pe?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly),Be=g.colorModeForRenderPass(),Ve=g.useProgram(le?"backgroundPattern":"background");let ct,ze=_;ze||(ct=g.getBackgroundTiles(),ze=Object.values(ct).map(ht=>ht.tileID)),le&&(I.activeTexture.set(k.TEXTURE0),g.imageManager.bind(g.context));const at=c.getCrossfadeParameters();for(const ht of ze){const rt=ht.toUnwrapped(),st=_?ht.projMatrix:g.transform.calculateProjMatrix(rt);g.prepareDrawTile(ht);const gt=n?n.getTile(ht):ct?ct[ht.key]:new l.Tile(ht,ne,W.zoom,g),Zt=le?pa(st,T,g,le,{tileID:ht,tileSize:ne},at):br(st,T,x);g.prepareDrawProgram(I,Ve,rt);const{tileBoundsBuffer:on,tileBoundsIndexBuffer:zn,tileBoundsSegments:An}=g.getTileBoundsBuffers(gt);Ve.draw(I,k.TRIANGLES,Ze,De,Be,l.CullFaceMode.disabled,Zt,c.id,on,zn,An)}},sky:function(g,n,c){const _=g.transform,x="mercator"===_.projection.name||"globe"===_.projection.name?1:l.smoothstep(7,8,_.zoom),T=c.paint.get("sky-opacity")*x;if(0===T)return;const I=g.context,k=c.paint.get("sky-type"),W=new l.DepthMode(I.gl.LEQUAL,l.DepthMode.ReadOnly,[0,1]),ne=g.frameCounter/1e3%1;"atmosphere"===k?"offscreen"===g.renderPass?c.needsSkyboxCapture(g)&&(function(le,pe,De,Ze){const Be=le.context,Ve=Be.gl;let ct=pe.skyboxFbo;if(!ct){ct=pe.skyboxFbo=Be.createFramebuffer(32,32,!1),pe.skyboxGeometry=new Or(Be),pe.skyboxTexture=Be.gl.createTexture(),Ve.bindTexture(Ve.TEXTURE_CUBE_MAP,pe.skyboxTexture),Ve.texParameteri(Ve.TEXTURE_CUBE_MAP,Ve.TEXTURE_WRAP_S,Ve.CLAMP_TO_EDGE),Ve.texParameteri(Ve.TEXTURE_CUBE_MAP,Ve.TEXTURE_WRAP_T,Ve.CLAMP_TO_EDGE),Ve.texParameteri(Ve.TEXTURE_CUBE_MAP,Ve.TEXTURE_MIN_FILTER,Ve.LINEAR),Ve.texParameteri(Ve.TEXTURE_CUBE_MAP,Ve.TEXTURE_MAG_FILTER,Ve.LINEAR);for(let rt=0;rt<6;++rt)Ve.texImage2D(Ve.TEXTURE_CUBE_MAP_POSITIVE_X+rt,0,Ve.RGBA,32,32,0,Ve.RGBA,Ve.UNSIGNED_BYTE,null)}Be.bindFramebuffer.set(ct.framebuffer),Be.viewport.set([0,0,32,32]);const ze=pe.getCenter(le,!0),at=le.useProgram("skyboxCapture"),ht=new Float64Array(16);l.identity(ht),l.rotateY(ht,ht,.5*-Math.PI),eo(Be,pe,at,ht,ze,0),l.identity(ht),l.rotateY(ht,ht,.5*Math.PI),eo(Be,pe,at,ht,ze,1),l.identity(ht),l.rotateX(ht,ht,.5*-Math.PI),eo(Be,pe,at,ht,ze,2),l.identity(ht),l.rotateX(ht,ht,.5*Math.PI),eo(Be,pe,at,ht,ze,3),l.identity(ht),eo(Be,pe,at,ht,ze,4),l.identity(ht),l.rotateY(ht,ht,Math.PI),eo(Be,pe,at,ht,ze,5),Be.viewport.set([0,0,le.width,le.height])}(g,c),c.markSkyboxValid(g)):"sky"===g.renderPass&&function(le,pe,De,Ze,Be){const Ve=le.context,ct=Ve.gl,ze=le.transform,at=le.useProgram("skybox");Ve.activeTexture.set(ct.TEXTURE0),ct.bindTexture(ct.TEXTURE_CUBE_MAP,pe.skyboxTexture);const ht={u_matrix:ze.skyboxMatrix,u_sun_direction:pe.getCenter(le,!1),u_cubemap:0,u_opacity:Ze,u_temporal_offset:Be};le.prepareDrawProgram(Ve,at),at.draw(Ve,ct.TRIANGLES,De,l.StencilMode.disabled,le.colorModeForRenderPass(),l.CullFaceMode.backCW,ht,"skybox",pe.skyboxGeometry.vertexBuffer,pe.skyboxGeometry.indexBuffer,pe.skyboxGeometry.segment)}(g,c,W,T,ne):"gradient"===k&&"sky"===g.renderPass&&function(le,pe,De,Ze,Be){const Ve=le.context,ct=Ve.gl,ze=le.transform,at=le.useProgram("skyboxGradient");pe.skyboxGeometry||(pe.skyboxGeometry=new Or(Ve)),Ve.activeTexture.set(ct.TEXTURE0);let ht=pe.colorRampTexture;ht||(ht=pe.colorRampTexture=new l.Texture(Ve,pe.colorRamp,ct.RGBA)),ht.bind(ct.LINEAR,ct.CLAMP_TO_EDGE);const rt=(st=ze.skyboxMatrix,gt=pe.getCenter(le,!1),Zt=pe.paint.get("sky-gradient-radius"),on=Ze,zn=Be,{u_matrix:st,u_color_ramp:0,u_center_direction:gt,u_radius:l.degToRad(Zt),u_opacity:on,u_temporal_offset:zn});var st,gt,Zt,on,zn;le.prepareDrawProgram(Ve,at),at.draw(Ve,ct.TRIANGLES,De,l.StencilMode.disabled,le.colorModeForRenderPass(),l.CullFaceMode.backCW,rt,"skyboxGradient",pe.skyboxGeometry.vertexBuffer,pe.skyboxGeometry.indexBuffer,pe.skyboxGeometry.segment)}(g,c,W,T,ne)},debug:function(g,n,c){for(let _=0;_<c.length;_++)wi(g,n,c[_])},custom:function(g,n,c){const _=g.context,x=c.implementation;if(g.transform.projection.unsupportedLayers&&g.transform.projection.unsupportedLayers.includes("custom"))l.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===g.renderPass){const T=x.prerender;T&&(g.setCustomLayerDefaults(),_.setColorMode(g.colorModeForRenderPass()),T.call(x,_.gl,g.transform.customLayerMatrix()),_.setDirty(),g.setBaseState())}else if("translucent"===g.renderPass){g.setCustomLayerDefaults(),_.setColorMode(g.colorModeForRenderPass()),_.setStencilMode(l.StencilMode.disabled);const T="3d"===x.renderingMode?new l.DepthMode(g.context.gl.LEQUAL,l.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,l.DepthMode.ReadOnly);_.setDepthMode(T),x.render(_.gl,g.transform.customLayerMatrix()),_.setDirty(),g.setBaseState(),_.bindFramebuffer.set(null)}}};class rs{constructor(n,c){this.context=new gi(n),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=l.SourceCache.maxUnderzooming+l.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Se,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,c){const _=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Le(this,n));const x=this._terrain;this.transform.elevation=_?x:null,x.update(n,this.transform,c)}_updateFog(n){const c=n.fog;if(!c||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,x]=c.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);const T=_+.78*(x-_);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,c){if(this.width=n*l.exported.devicePixelRatio,this.height=c*l.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const n=this.context,c=new l.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(l.EXTENT,0),c.emplaceBack(0,l.EXTENT),c.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(c,l.posAttributes.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const _=new l.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(l.EXTENT,0),_.emplaceBack(0,l.EXTENT),_.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=n.createVertexBuffer(_,l.posAttributes.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const x=new l.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(x,l.posAttributes.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const T=new l.StructArrayLayout4i8;T.emplaceBack(0,0,0,0),T.emplaceBack(l.EXTENT,0,l.EXTENT,0),T.emplaceBack(0,l.EXTENT,0,l.EXTENT),T.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(T,l.boundsAttributes.members),this.mercatorBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const I=new l.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(I);const k=new l.StructArrayLayout1ui2;for(const ne of[0,1,3,2,0])k.emplaceBack(ne);this.debugIndexBuffer=n.createIndexBuffer(k),this.emptyTexture=new l.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA),this.identityMat=l.create();const W=this.context.gl;this.stencilClearMode=new l.StencilMode({func:W.ALWAYS,mask:0},0,255,W.ZERO,W.ZERO,W.ZERO),this.loadTimeStamps.push(l.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,c=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,c.TRIANGLES,l.DepthMode.disabled,this.stencilClearMode,l.ColorMode.disabled,l.CullFaceMode.disabled,Ro(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,c,_){if(!c||this.currentStencilSource===c.id||!n.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const W of _)if(void 0===this._tileClippingMaskIDs[W.key]){k=!0;break}if(!k)return}this.currentStencilSource=c.id;const x=this.context,T=x.gl;this.nextStencilID+_.length>256&&this.clearStencil(),x.setColorMode(l.ColorMode.disabled),x.setDepthMode(l.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of _){const W=c.getTile(k),ne=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:le,tileBoundsIndexBuffer:pe,tileBoundsSegments:De}=this.getTileBoundsBuffers(W);I.draw(x,T.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:T.ALWAYS,mask:0},ne,255,T.KEEP,T.KEEP,T.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,Ro(k.projMatrix),"$clipping",le,pe,De)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,c=this.context.gl;return new l.StencilMode({func:c.NOTEQUAL,mask:255},n,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const c=this.context.gl;return new l.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(n){const c=this.context.gl,_=n.sort((I,k)=>k.overscaledZ-I.overscaledZ),x=_[_.length-1].overscaledZ,T=_[0].overscaledZ-x+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const I={};for(let k=0;k<T;k++)I[k+x]=new l.StencilMode({func:c.GEQUAL,mask:255},k+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=T,[I,_]}return[{[x]:l.StencilMode.disabled},_]}colorModeForRenderPass(){const n=this.context.gl;if(this._showOverdrawInspector){const c=1/8;return new l.ColorMode([n.CONSTANT_COLOR,n.ONE],new l.Color(c,c,c,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?l.ColorMode.unblended:l.ColorMode.alphaBlended}depthModeForSublayer(n,c,_){if(!this.opaquePassEnabledForLayer())return l.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new l.DepthMode(_||this.context.gl.LEQUAL,c,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,c){this.style=n,this.options=c,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const _=this.style.order,x=this.style._sourceCaches;for(const ne in x){const le=x[ne];le.used&&le.prepare(this.context)}const T={},I={},k={};for(const ne in x){const le=x[ne];T[ne]=le.getVisibleCoordinates(),I[ne]=T[ne].slice().reverse(),k[ne]=le.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ne=0;ne<_.length;ne++)if(this.style._layers[_[ne]].is3D()){this.opaquePassCutoff=ne;break}if(this.terrain&&(this.terrain.updateTileBinding(k),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new l.GlobeSharedBuffers(this.context)),!l.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const ne of _){const le=this.style._layers[ne],pe=n._getLayerSourceCache(le);if(!le.hasOffscreenPass()||le.isHidden(this.transform.zoom))continue;const De=pe?I[pe.id]:void 0;("custom"===le.type||le.isSky()||De&&De.length)&&this.renderLayer(this,pe,le,De)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let W=l.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(W=this.style.fog.properties.get("color")),this.context.clear({color:c.showOverdrawInspector?l.Color.black:W,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const ne=this.style._layers[_[this.currentLayer]],le=n._getLayerSourceCache(ne);if(ne.isSky())continue;const pe=le?I[le.id]:void 0;this._renderTileClippingMasks(ne,le,pe),this.renderLayer(this,le,ne,pe)}if(this.renderPass="sky",(l.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const ne=this.style._layers[_[this.currentLayer]],le=n._getLayerSourceCache(ne);ne.isSky()&&this.renderLayer(this,le,ne,le?I[le.id]:void 0)}for("globe"===this.transform.projection.name&&function(ne){const le=ne.context,pe=le.gl,De=ne.transform,Ze=new l.DepthMode(pe.LEQUAL,l.DepthMode.ReadOnly,[0,1]),Be=ne.useProgram("globeAtmosphere"),Ve=De._camera.getWorldToCamera(De.worldSize,1),ct=De._camera.getCameraToClipPerspective(De._fov,De.width/De.height,De._nearZ,De._farZ),ze=l.mul([],Ve,l.calculateGlobeMatrix(De,De.worldSize)),at=l.mul([],De.labelPlaneMatrix,ct),ht=l.transformMat4([],[0,0,0],ze),rt=l.add([],ht,[De.worldSize/Math.PI/2,0,0]),st=l.transformMat4([],ht,at),gt=l.transformMat4([],rt,at),Zt=l.length(l.sub([],gt,st)),on=1-l.globeToMercatorTransition(De.zoom),zn={u_center:st,u_radius:Zt,u_screen_size:[De.width,De.height],u_pixel_ratio:l.exported.devicePixelRatio,u_opacity:on,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};ne.prepareDrawProgram(le,Be);const An=ne.globeSharedBuffers;An&&Be.draw(le,pe.TRIANGLES,Ze,l.StencilMode.disabled,l.ColorMode.alphaBlended,l.CullFaceMode.backCW,zn,"skybox",An.atmosphereVertexBuffer,An.atmosphereIndexBuffer,An.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const ne=this.style._layers[_[this.currentLayer]],le=n._getLayerSourceCache(ne);if(ne.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(ne)){if(ne.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const pe=le?("symbol"===ne.type?k:I)[le.id]:void 0;this._renderTileClippingMasks(ne,le,le?T[le.id]:void 0),this.renderLayer(this,le,ne,pe),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let ne=null;l.values(this.style._layers).forEach(le=>{const pe=n._getLayerSourceCache(le);pe&&!le.isHidden(this.transform.zoom)&&(!ne||ne.getSource().maxzoom<pe.getSource().maxzoom)&&(ne=pe)}),ne&&this.options.showTileBoundaries&&Lo.debug(this,ne,ne.getVisibleCoordinates())}this.options.showPadding&&function(ne){const le=ne.transform.padding;vt(ne,ne.transform.height-(le.top||0),3,D),vt(ne,le.bottom||0,3,Y),In(ne,le.left||0,3,E),In(ne,ne.transform.width-(le.right||0),3,H);const pe=ne.transform.centerPoint;var De,Ze,Be,Ve;Vn(De=ne,(Ze=pe.x)-1,(Be=ne.transform.height-pe.y)-10,2,20,Ve=ve),Vn(De,Ze-10,Be-1,20,2,Ve)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(l.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,c,_,x){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(_.type)||Lo[_.type](n,c,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let _=this.gpuTimers[n.id];_||(_=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),_.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,_.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}queryGpuTimers(n){const c={};for(const _ in n){const x=n[_],T=this.context.extTimerQuery,I=T.getQueryObjectEXT(x.query,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(x.query),c[_]=I}return c}translatePosMatrix(n,c,_,x,T){if(!_[0]&&!_[1])return n;const I=T?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(I){const ne=Math.sin(I),le=Math.cos(I);_=[_[0]*le-_[1]*ne,_[0]*ne+_[1]*le]}const k=[T?_[0]:dt(c,_[0],this.transform.zoom),T?_[1]:dt(c,_[1],this.transform.zoom),0],W=new Float32Array(16);return l.translate(W,n,k),W}saveTileTexture(n){const c=this._tileTextures[n.size[0]];c?c.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const c=this._tileTextures[n];return c&&c.length>0?c.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const c=this.imageManager.getPattern(n.from.toString()),_=this.imageManager.getPattern(n.to.toString());return!c||!_}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,_=[];return this.terrain&&!this.terrain.renderingToTexture&&_.push("TERRAIN"),c&&!n&&0!==c.getOpacity(this.transform.pitch)&&_.push("FOG"),n&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(n,c,_){this.cache=this.cache||{};const x=_||[],T=this.currentGlobalDefines().concat(x),I=an.cacheKey(n,T,c);return this.cache[I]||(this.cache[I]=new an(this.context,n,Fs[n],c,Cl[n],T)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=l.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(n){this.terrain&&this.terrain.prepareDrawTile(n)}prepareDrawProgram(n,c,_){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const T=x.getOpacity(this.transform.pitch);0!==T&&c.setFogUniformValues(n,((I,k,W,ne)=>{const le=k.properties.get("color"),pe=I.frameCounter/1e3%1,De=[le.r/le.a,le.g/le.a,le.b/le.a,ne];return{u_fog_matrix:W?I.transform.calculateFogTileMatrix(W):I.identityMat,u_fog_range:k.getFovAdjustedRange(I.transform._fov),u_fog_color:De,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_temporal_offset:pe}})(this,x,_,T))}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,c=n.createTexture();return n.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&0!==n.getOpacity(this.transform.pitch)}getBackgroundTiles(){const n=this._backgroundTiles,c=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const x of _)c[x.key]=n[x.key]||new l.Tile(x,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class ga{constructor(n=0,c=0,_=0,x=0){if(isNaN(n)||n<0||isNaN(c)||c<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=c,this.left=_,this.right=x}interpolate(n,c,_){return null!=c.top&&null!=n.top&&(this.top=l.number(n.top,c.top,_)),null!=c.bottom&&null!=n.bottom&&(this.bottom=l.number(n.bottom,c.bottom,_)),null!=c.left&&null!=n.left&&(this.left=l.number(n.left,c.left,_)),null!=c.right&&null!=n.right&&(this.right=l.number(n.right,c.right,_)),this}getCenter(n,c){const _=l.clamp((this.left+n-this.right)/2,0,n),x=l.clamp((this.top+c-this.bottom)/2,0,c);return new l.pointGeometry(_,x)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new ga(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Zs(g,n){const c=l.getColumn(g,3);l.fromQuat(g,n),l.setColumn(g,3,c)}function xc(g,n){l.setColumn(g,3,[n[0],n[1],n[2],1])}function rl(g,n){const c=l.identity$1([]);return l.rotateZ$1(c,c,-n),l.rotateX$1(c,c,-g),c}function El(g,n){const c=[g[0],g[1],0],_=[n[0],n[1],0];if(l.length(c)>=1e-15){const I=l.normalize([],c);l.scale$2(_,I,l.dot(_,I)),n[0]=_[0],n[1]=_[1]}const x=l.cross([],n,g);if(l.len(x)<1e-15)return null;const T=Math.atan2(-x[1],x[0]);return rl(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),T)}class bc{constructor(n,c){this.position=n,this.orientation=c}get position(){return this._position}set position(n){this._position=this._renderWorldCopies?function(c){if(!c)return;const _=Array.isArray(c)?new l.MercatorCoordinate(c[0],c[1],c[2]):c;return _.x=l.wrap(_.x,0,1),_}(n):n}lookAtPoint(n,c){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(n)):0,x=this.position,T=l.MercatorCoordinate.fromLngLat(n,_),I=[T.x-x.x,T.y-x.y,T.z-x.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=El(I,c)}setPitchBearing(n,c){this.orientation=rl(l.degToRad(n),l.degToRad(-c))}}class Xl{constructor(n,c){this._transform=l.identity([]),this._orientation=l.identity$1([]),c&&(this._orientation=c,Zs(this._transform,this._orientation)),n&&xc(this._transform,n)}get mercatorPosition(){const n=this.position;return new l.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=l.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){xc(this._transform,n)}get orientation(){return this._orientation}set orientation(n){this._orientation=n,Zs(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,c){this._orientation=rl(n,c),Zs(this._transform,this._orientation)}forward(){const n=l.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=l.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=l.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,c){const _=new Float64Array(16);return l.invert(_,this.getWorldToCamera(n,c)),_}getWorldToCameraPosition(n,c,_){const x=this.position;l.scale$2(x,x,-n);const T=new Float64Array(16);return l.fromScaling(T,[_,_,_]),l.translate(T,T,x),T[10]*=c,T}getWorldToCamera(n,c){const _=new Float64Array(16),x=new Float64Array(4),T=this.position;return l.conjugate(x,this._orientation),l.scale$2(T,T,-n),l.fromQuat(_,x),l.translate(_,_,T),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=c,_[9]*=c,_[10]*=c,_[11]*=c,_}getCameraToClipPerspective(n,c,_,x){const T=new Float64Array(16);return l.perspective(T,n,c,_,x),T}getDistanceToElevation(n){const c=0===n?0:l.mercatorZfromAltitude(n,this.position[1]),_=this.forward();return(c-this.position[2])/_[2]}clone(){return new Xl([...this.position],[...this.orientation])}}function wc(g,n){const c=Kl(g),_=function(T,I,k,W,ne){const le=new l.LngLat(k.lng-180*ws,k.lat),pe=new l.LngLat(k.lng+180*ws,k.lat),De=T.project(le.lng,le.lat),Ze=T.project(pe.lng,pe.lat),Be=-Math.atan2(Ze.y-De.y,Ze.x-De.x),Ve=l.MercatorCoordinate.fromLngLat(k);Ve.y=l.clamp(Ve.y,-.999975,.999975);const ct=Ve.toLngLat(),ze=T.project(ct.lng,ct.lat),at=l.MercatorCoordinate.fromLngLat(ct);at.x+=ws;const ht=at.toLngLat(),rt=T.project(ht.lng,ht.lat),st=Ss(rt.x-ze.x,rt.y-ze.y,Be),gt=l.MercatorCoordinate.fromLngLat(ct);gt.y+=ws;const Zt=gt.toLngLat(),on=T.project(Zt.lng,Zt.lat),zn=Ss(on.x-ze.x,on.y-ze.y,Be),An=Math.abs(st.x)/Math.abs(zn.y),Dn=l.identity([]);l.rotateZ(Dn,Dn,-Be*(1-(ne?0:W)));const un=l.identity([]);return l.scale(un,un,[1,1-(1-An)*W,1]),un[4]=-zn.x/zn.y*W,l.rotateZ(un,un,Be),l.multiply$1(un,Dn,un),un}(g.projection,0,g.center,c,n),x=Sa(g);return l.scale(_,_,[x,x,1]),_}function Sa(g){const n=g.projection,c=Kl(g),_=Yo(n,g.center),x=Yo(n,l.LngLat.convert(n.center));return Math.pow(2,_*c+(1-c)*x)}function Kl(g){const n=g.projection.range;if(!n)return 0;const c=Math.max(g.width,g.height),_=Math.log(c/1024)/Math.LN2;return l.smoothstep(n[0]+_,n[1]+_,g.zoom)}const ws=1/4e4;function Yo(g,n){const c=l.clamp(n.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),_=new l.LngLat(n.lng-180*ws,c),x=new l.LngLat(n.lng+180*ws,c),T=g.project(_.lng,c),I=g.project(x.lng,c),k=l.MercatorCoordinate.fromLngLat(_),W=l.MercatorCoordinate.fromLngLat(x),ne=I.x-T.x,le=I.y-T.y,pe=W.x-k.x,De=W.y-k.y,Ze=Math.sqrt((pe*pe+De*De)/(ne*ne+le*le));return Math.log(Ze)/Math.LN2}function Ss(g,n,c){const _=Math.cos(c),x=Math.sin(c);return{x:g*_-n*x,y:g*x+n*_}}class to{constructor(n,c,_,x,T){this.tileSize=512,this._renderWorldCopies=void 0===T||T,this._minZoom=n||0,this._maxZoom=c||22,this._minPitch=_??0,this._maxPitch=x??60,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ga,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Xl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const n=new to(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.setProjection(this.getProjection()),n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n.tileSize=this.tileSize,n.setMaxBounds(this.getMaxBounds()),n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._cameraZoom=this._cameraZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,n?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(n){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),n&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return l.pick(this.projection,["name","center","parallels"])}setProjection(n){null==n&&(n={name:"mercator"}),this.projectionOptions=n;const c=this.projection?this.getProjection():void 0;return this.projection=l.getProjection(n),!ue(c,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(n){void 0===n?n=!0:null===n&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return l.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const c=-n*Math.PI/180;var _,x,T,I,k,W,ne,le,pe,De;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(_=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),x=this.rotationMatrix,I=this.angle,k=(T=this.rotationMatrix)[0],W=T[1],ne=T[2],le=T[3],pe=Math.sin(I),De=Math.cos(I),x[0]=k*De+ne*pe,x[1]=W*De+le*pe,x[2]=k*-pe+ne*De,x[3]=W*-pe+le*De)}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const c=l.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(n){const c=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===n?(this._cameraZoom=null,!1):(this._centerAltitude=n,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let x=0,T=0;for(let I=0;I<c.length;I++){const k=new l.pointGeometry(c[I][0]*this.width,_+c[I][1]*(this.height-_)),W=n.pointCoordinate(k);if(!W)continue;const ne=1/Math.hypot(W[0]-this._camera.position[0],W[1]-this._camera.position[1]);x+=W[3]*ne,T+=ne}return 0===T?NaN:x/T}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const n=this._cameraZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*c,x=this._mercatorZfromZoom(n),T=this._mercatorZfromZoom(this._maxZoom),I=Math.max(x-_,T);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let _;_=n.z<this._camera.position[2]?[c.x,c.y,c.z]:[n.x,n.y,n.z];const x=l.length(l.sub([],this._camera.position,_));return l.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let c=!1;if(n.orientation&&!l.exactEquals(n.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(n.orientation)),n.position){const _=[n.position.x,n.position.y,n.position.z];l.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,c=new bc;return c.position=new l.MercatorCoordinate(n[0],n[1],n[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(n){if(!l.length$1(n))return!1;l.normalize$1(n,n);const c=l.transformQuat([],[0,0,-1],n),_=l.transformQuat([],[0,-1,0],n);if(_[2]<0)return!1;const x=El(c,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(n){const c=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;n[2]=l.clamp(n[2],x/_,x/c),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,c,_){this._unmodified=!1,this._edgeInsets.interpolate(n,c,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const c=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(n){const c=[new l.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const _=this.pointCoordinate(new l.pointGeometry(0,0)),x=this.pointCoordinate(new l.pointGeometry(this.width,0)),T=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),I=this.pointCoordinate(new l.pointGeometry(0,this.height)),k=Math.floor(Math.min(_.x,x.x,T.x,I.x)),W=Math.floor(Math.max(_.x,x.x,T.x,I.x)),ne=1;for(let le=k-ne;le<=W+ne;le++)0!==le&&c.push(new l.UnwrappedTileID(le,n))}return c}coveringTiles(n){let c=this.coveringZoomLevel(n);const _=c,x=this.elevation&&!n.isTerrainDEM,T="mercator"===this.projection.name;if(void 0!==n.minzoom&&c<n.minzoom)return[];void 0!==n.maxzoom&&c>n.maxzoom&&(c=n.maxzoom);const I=this.locationCoordinate(this.center),k=1<<c,W=[k*I.x,k*I.y,0],ne=l.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,"globe"!==this.projection.name),le=this.pointCoordinate(this.getCameraPoint()),pe=k*l.mercatorZfromAltitude(1,this.center.lat),De=this._camera.position[2]/l.mercatorZfromAltitude(1,this.center.lat),Ze=[k*le.x,k*le.y,De],Be=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),Ve=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,ct=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ze=n.isTerrainDEM?-ct:this._elevation?this._elevation.getMinElevationBelowMSL():0,at=this.projection.isReprojectedInTileSpace?Sa(this):1,ht=Jt=>{const bn=1/4e4,yn=new l.MercatorCoordinate(Jt.x+bn,Jt.y,Jt.z),di=new l.MercatorCoordinate(Jt.x,Jt.y+bn,Jt.z),Mi=Jt.toLngLat(),rr=yn.toLngLat(),Nn=di.toLngLat(),vi=this.locationCoordinate(Mi),Yi=this.locationCoordinate(rr),Ar=this.locationCoordinate(Nn),Xr=Math.hypot(Yi.x-vi.x,Yi.y-vi.y),Gi=Math.hypot(Ar.x-vi.x,Ar.y-vi.y);return Math.sqrt(Xr*Gi)*at/bn},rt=Jt=>{const bn=ct,yn=ze;return{aabb:l.tileAABB(this,k,0,0,0,Jt,yn,bn,this.projection),zoom:0,x:0,y:0,minZ:yn,maxZ:bn,wrap:Jt,fullyVisible:!1}},st=[];let gt=[];const Zt=c,on=n.reparseOverscaled?_:c,zn=Jt=>Jt*Jt,An=zn((De-this._centerAltitude)*pe),Dn=Jt=>{if(!this._elevation||!Jt.tileID||!T)return;const bn=this._elevation.getMinMaxForTile(Jt.tileID),yn=Jt.aabb;bn?(yn.min[2]=bn.min,yn.max[2]=bn.max,yn.center[2]=(yn.min[2]+yn.max[2])/2):(Jt.shouldSplit=un(Jt),Jt.shouldSplit||(yn.min[2]=yn.max[2]=yn.center[2]=this._centerAltitude))},un=Jt=>{if(Jt.zoom<Ve)return!0;if(Jt.zoom===Zt)return!1;if(null!=Jt.shouldSplit)return Jt.shouldSplit;const bn=Jt.aabb.distanceX(Ze),yn=Jt.aabb.distanceY(Ze);let di=An;x&&(di=zn(Jt.aabb.distanceZ(Ze)*pe));let Mi=1;if(this.projection.isReprojectedInTileSpace&&_<=5){const Nn=Math.pow(2,Jt.zoom),vi=ht(new l.MercatorCoordinate((Jt.x+.5)/Nn,(Jt.y+.5)/Nn));Mi=vi>.85?1:vi}const rr=bn*bn+yn*yn+di;return rr<zn((1<<Zt-Jt.zoom)*Be*Mi*((Nn,vi)=>{if(vi*zn(.707)<Nn)return 1;const Yi=Math.sqrt(vi/Nn);return Yi/(1.4144271570014144+(Math.pow(1.1,Yi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(di,An),rr))};if(this.renderWorldCopies)for(let Jt=1;Jt<=3;Jt++)st.push(rt(-Jt)),st.push(rt(Jt));for(st.push(rt(0));st.length>0;){const Jt=st.pop(),bn=Jt.x,yn=Jt.y;let di=Jt.fullyVisible;if(!di){const Mi=Jt.aabb.intersects(ne);if(0===Mi)continue;di=2===Mi}if(Jt.zoom!==Zt&&un(Jt))for(let Mi=0;Mi<4;Mi++){const rr=(bn<<1)+Mi%2,Nn=(yn<<1)+(Mi>>1),vi={aabb:T?Jt.aabb.quadrant(Mi):l.tileAABB(this,k,Jt.zoom+1,rr,Nn,Jt.wrap,Jt.minZ,Jt.maxZ,this.projection),zoom:Jt.zoom+1,x:rr,y:Nn,wrap:Jt.wrap,fullyVisible:di,tileID:void 0,shouldSplit:void 0,minZ:Jt.minZ,maxZ:Jt.maxZ};x&&(vi.tileID=new l.OverscaledTileID(Jt.zoom+1===Zt?on:Jt.zoom+1,Jt.wrap,Jt.zoom+1,rr,Nn),Dn(vi)),st.push(vi)}else{const Mi=Jt.zoom===Zt?on:Jt.zoom;if(n.minzoom&&n.minzoom>Mi)continue;const rr=W[0]-(.5+bn+(Jt.wrap<<Jt.zoom))*(1<<c-Jt.zoom),Nn=W[1]-.5-yn,vi=Jt.tileID?Jt.tileID:new l.OverscaledTileID(Mi,Jt.wrap,Jt.zoom,bn,yn);gt.push({tileID:vi,distanceSq:rr*rr+Nn*Nn})}}if(this.fogCullDistSq){const Jt=this.fogCullDistSq,bn=this.horizonLineFromTop();gt=gt.filter(yn=>{const di=[0,0,0,1],Mi=[l.EXTENT,l.EXTENT,0,1],rr=this.calculateFogTileMatrix(yn.tileID.toUnwrapped());l.transformMat4$1(di,di,rr),l.transformMat4$1(Mi,Mi,rr);const Nn=l.getAABBPointSquareDist(di,Mi);if(0===Nn)return!0;let vi=!1;const Yi=this._elevation;if(Yi&&Nn>Jt&&0!==bn){const Ar=this.calculateProjMatrix(yn.tileID.toUnwrapped());let Xr;n.isTerrainDEM||(Xr=Yi.getMinMaxForTile(yn.tileID)),Xr||(Xr={min:ze,max:ct});const Gi=l.furthestTileCorner(this.rotation),Li=[Gi[0]*l.EXTENT,Gi[1]*l.EXTENT,Xr.max];l.transformMat4(Li,Li,Ar),vi=(1-Li[1])*this.height*.5<bn}return Nn<Jt||vi})}return gt.sort((Jt,bn)=>Jt.distanceSq-bn.distanceSq).map(Jt=>Jt.tileID)}resize(n,c){this.width=n,this.height=c,this.pixelsToGLUnits=[2/n,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const c=l.clamp(n.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),_=this.projection.project(n.lng,c);return new l.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,c){const _=this.pointCoordinate(c),x=this.pointCoordinate(this.centerPoint),T=this.locationCoordinate(n);this.setLocation(new l.MercatorCoordinate(T.x-(_.x-x.x),T.y-(_.y-x.y)))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this._coordinatePoint(this.locationCoordinate(n),!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,c){const _=c?l.mercatorZfromAltitude(c,n.lat):void 0,x=this.projection.project(n.lng,n.lat);return new l.MercatorCoordinate(x.x,x.y,_)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,c){const _=c??this._centerAltitude,x=[n.x,n.y,0,1],T=[n.x,n.y,1,1];l.transformMat4$1(x,x,this.pixelMatrixInverse),l.transformMat4$1(T,T,this.pixelMatrixInverse);const I=T[3];l.scale$1(x,x,1/x[3]),l.scale$1(T,T,1/I);const k=x[2],W=T[2];return{p0:x,p1:T,t:k===W?0:(_-k)/(W-k)}}screenPointToMercatorRay(n){const c=[n.x,n.y,0,1],_=[n.x,n.y,1,1];return l.transformMat4$1(c,c,this.pixelMatrixInverse),l.transformMat4$1(_,_,this.pixelMatrixInverse),l.scale$1(c,c,1/c[3]),l.scale$1(_,_,1/_[3]),c[2]=l.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,_[2]=l.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,l.scale$1(c,c,1/this.worldSize),l.scale$1(_,_,1/this.worldSize),new l.Ray([c[0],c[1],c[2]],l.normalize([],l.sub([],_,c)))}rayIntersectionCoordinate(n){const{p0:c,p1:_,t:x}=n,T=l.mercatorZfromAltitude(c[2],this._center.lat),I=l.mercatorZfromAltitude(_[2],this._center.lat);return new l.MercatorCoordinate(l.number(c[0],_[0],x)/this.worldSize,l.number(c[1],_[1],x)/this.worldSize,l.number(T,I,x))}pointCoordinate(n,c=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(n.x,n.y,c)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);const c=this.elevation;let _=this.elevation.pointCoordinate(n);if(_)return new l.MercatorCoordinate(_[0],_[1],_[2]);let x=0,T=this.horizonLineFromTop();if(n.y>T)return this.pointCoordinate(n);const I=.02*T,k=n.clone();for(let W=0;W<10&&T-x>I;W++){k.y=l.number(x,T,.66);const ne=c.pointCoordinate(k);ne?(T=k.y,_=ne):x=k.y}return _?new l.MercatorCoordinate(_[0],_[1],_[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){if(this.elevation)return!this.elevation.pointCoordinate(n);{const c=this.horizonLineFromTop();return n.y<c}}_coordinatePoint(n,c){const _=c&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,x=[n.x*this.worldSize,n.y*this.worldSize,_+n.toAltitude(),1];return l.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new l.pointGeometry(x[0]/x[3],x[1]/x[3]):new l.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(n,c){const _=new l.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),x=new l.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),T=new l.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),I=new l.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let k=this.pointCoordinate(_,n),W=this.pointCoordinate(x,n);const ne=this.pointCoordinate(T,c),le=this.pointCoordinate(I,c),pe=(De,Ze)=>(Ze.y-De.y)/(Ze.x-De.x);return k.y>1&&W.y>=0?k=new l.MercatorCoordinate((1-le.y)/pe(le,k)+le.x,1):k.y<0&&W.y<=1&&(k=new l.MercatorCoordinate(-le.y/pe(le,k)+le.x,0)),W.y>1&&k.y>=0?W=new l.MercatorCoordinate((1-ne.y)/pe(ne,W)+ne.x,1):W.y<0&&k.y<=1&&(W=new l.MercatorCoordinate(-ne.y/pe(ne,W)+ne.x,0)),(new l.LngLatBounds).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(ne))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length)return this._getBounds(0,0);const c=n.visibleDemTiles.reduce((_,x)=>{if(x.dem){const T=x.dem.tree;_.min=Math.min(_.min,T.minimums[0]),_.max=Math.max(_.max,T.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBounds(c.min*n.exaggeration(),c.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-c*(1-this._horizonShift);return n?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-l.MAX_MERCATOR_LATITUDE,this.maxLat=l.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=l.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=l.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=l.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=l.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,c){return this.projection.createTileTransform(this,c).createTileMatrix(n)}calculateDistanceTileData(n){const c=n.key,_=this._distanceTileDataCache;if(_[c])return _[c];const x=n.canonical,T=1/this.height,I=this.cameraWorldSize/this.zoomScale(x.z),k=(x.x+Math.pow(2,x.z)*n.wrap)*I,W=x.y*I,ne=this.point,le=this.angle,pe=Math.sin(-le),De=-Math.cos(-le);return _[c]={bearing:[pe,De],center:[(ne.x-k)*T,(ne.y-W)*T],scale:I/l.EXTENT*T},_[c]}calculateFogTileMatrix(n){const c=n.key,_=this._fogTileMatrixCache;if(_[c])return _[c];const x=this.calculatePosMatrix(n,this.cameraWorldSize);return l.multiply$1(x,this.worldToFogMatrix,x),_[c]=new Float32Array(x),_[c]}calculateProjMatrix(n,c=!1){const _=n.key,x=c?this._alignedProjMatrixCache:this._projMatrixCache;if(x[_])return x[_];const T=this.calculatePosMatrix(n,this.worldSize);return l.multiply$1(T,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,T),x[_]=new Float32Array(T),x[_]}calculatePixelsToTileUnitsMatrix(n){const c=n.tileID.key,_=this._pixelsToTileUnitsCache;if(_[c])return _[c];const x=function(T,I){const{scale:k}=T.tileTransform,W=k*l.EXTENT/(T.tileSize*Math.pow(2,I.zoom-T.tileID.overscaledZ+T.tileID.canonical.z));return ne=new Float32Array(4),De=(le=I.inverseAdjustmentMatrix)[1],Ze=le[2],Be=le[3],ct=(pe=[W,W])[1],ne[0]=le[0]*(Ve=pe[0]),ne[1]=De*Ve,ne[2]=Ze*ct,ne[3]=Be*ct,ne;var ne,le,pe,De,Ze,Be,Ve,ct}(n,this);return _[c]=x,_[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const c=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(c),x=this._camera.forward(),T=l.mercatorZfromAltitude(1,this._center.lat);_[2]/=T,x[2]/=T,l.normalize(x,x);const I=n.raycast(_,x,n.exaggeration());if(I){const k=l.scaleAndAdd([],_,x,I),W=new l.MercatorCoordinate(k[0],k[1],l.mercatorZfromAltitude(k[2],l.latFromMercatorY(k[1]))),ne=(W.z+l.length([W.x-_[0],W.y-_[1],W.z-_[2]*T]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(ne),this._centerAltitude=W.toAltitude(),this._center=this.coordinateLocation(W),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const c=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(c),x=n.getAtPointOrZero(new l.MercatorCoordinate(..._)),T=this._minimumHeightOverTerrain()*Math.cos(l.degToRad(this._maxPitch)),I=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*x;if(I<T){const k=this.locationCoordinate(this._center,this._centerAltitude),W=[k.x-_[0],k.y-_[1],k.z-_[2]],ne=l.length(W);W[2]-=(T-I)/this._projectionScaler;const le=l.length(W);if(0===le)return;l.scale$2(W,W,ne/le*this._projectionScaler),this._camera.position=[k.x-W[0],k.y-W[1],k.z*this._projectionScaler-W[2]],this._camera.orientation=El(W,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const pe=this.center;return pe.lat=l.clamp(pe.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(pe.lng=l.clamp(pe.lng,this.minLng,this.maxLng)),this.center=pe,void(this._constraining=!1)}const n=this._unmodified,{x:c,y:_}=this.point;let x=0,T=c,I=_;const k=this.width/2,W=this.height/2,ne=this.worldMinY*this.scale,le=this.worldMaxY*this.scale;if(_-W<ne&&(I=ne+W),_+W>le&&(I=le-W),le-ne<this.height&&(x=Math.max(x,this.height/(le-ne)),I=(le+ne)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const pe=this.worldMinX*this.scale,De=this.worldMaxX*this.scale,Ze=this.worldSize/2-(pe+De)/2;T=(c+Ze+this.worldSize)%this.worldSize-Ze,T-k<pe&&(T=pe+k),T+k>De&&(T=De-k),De-pe<this.width&&(x=Math.max(x,this.width/(De-pe)),T=(De+pe)/2)}T===c&&I===_||(this.center=this.unproject(new l.pointGeometry(T,I))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCameraAltitude(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this._fov/2,c=this.centerOffset,_=this.pixelsPerMeter;this._projectionScaler=_/(l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(n)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?_:1),T=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);T[8]=2*-c.x/this.width,T[9]=2*c.y/this.height;let I=l.mul([],T,x);if(this.projection.isReprojectedInTileSpace){const rt=this.locationCoordinate(this.center),st=l.identity([]);l.translate(st,st,[rt.x*this.worldSize,rt.y*this.worldSize,0]),l.multiply$1(st,st,wc(this)),l.translate(st,st,[-rt.x*this.worldSize,-rt.y*this.worldSize,0]),l.multiply$1(I,I,st),this.inverseAdjustmentMatrix=function(gt){const Zt=wc(gt,!0);return $([],[Zt[0],Zt[1],Zt[4],Zt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=l.scale([],I,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=I,this.invProjMatrix=l.invert(new Float64Array(16),this.projMatrix);const k=new Float32Array(16);l.identity(k),l.scale(k,k,[1,-1,1]),l.rotateX(k,k,this._pitch),l.rotateZ(k,k,this.angle);const W=l.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),ne=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;W[8]=2*-c.x/this.width,W[9]=2*(c.y+ne)/this.height,this.skyboxMatrix=l.multiply$1(k,W,k);const le=this.point,pe=le.x,De=le.y,Ze=this.width%2/2,Be=this.height%2/2,Ve=Math.cos(this.angle),ct=Math.sin(this.angle),ze=pe-Math.round(pe)+Ve*Ze+ct*Be,at=De-Math.round(De)+Ve*Be+ct*Ze,ht=new Float64Array(I);if(l.translate(ht,ht,[ze>.5?ze-1:ze,at>.5?at-1:at,0]),this.alignedProjMatrix=ht,I=l.create(),l.scale(I,I,[this.width/2,-this.height/2,1]),l.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=l.create(),l.scale(I,I,[1,-1,1]),l.translate(I,I,[-1,-1,0]),l.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=l.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=l.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");this.pixelMatrixInverse=I,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,c=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height,T=[n,n,c];l.scale$2(T,T,x),l.scale$2(_,_,-1),l.multiply$2(_,_,T);const I=l.create();l.translate(I,I,_),l.scale(I,I,T),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,c,x)}_computeCameraPosition(n){const c=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,T=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*c-n/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*T,x.y/this.worldSize-_[1]*T,n/this.worldSize*this._centerAltitude-_[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=n[2];let x=1;_>0&&(x=Math.min((c-this._camera.position[2])/_,1)),this._camera.position=l.scaleAndAdd([],this._camera.position,n,x),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,c=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),T=l.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(l.degToRad(this._maxPitch)),k=Math.max((n[2]-T)/Math.cos(_),I),W=this._zoomFromMercatorZ(k);l.scaleAndAdd(n,n,c,k),this._pitch=l.clamp(_,l.degToRad(this.minPitch),l.degToRad(this.maxPitch)),this.angle=l.wrap(x,-Math.PI,Math.PI),this._setZoom(l.clamp(W,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new l.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(l.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(n,c){const _=Math.min(n.x,c.x),x=Math.max(n.x,c.x),T=Math.min(n.y,c.y),I=Math.max(n.y,c.y);if(T<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const k=[new l.pointGeometry(_,T),new l.pointGeometry(x,I),new l.pointGeometry(_,I),new l.pointGeometry(x,T)],W=this.renderWorldCopies?-3:0,ne=this.renderWorldCopies?4:1;for(const le of k){const pe=this.pointRayIntersection(le);if(pe.t<0)return!0;const De=this.rayIntersectionCoordinate(pe);if(De.x<W||De.y<0||De.x>ne||De.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+l.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new l.pointGeometry(0,0),new l.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,c){const _=l.length(l.sub([],this._camera.position,n)),x=this._zoomFromMercatorZ(_)+c;return _-this._mercatorZfromZoom(x)}getCameraPoint(){const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,n))}}function na(g,n){let c=!1,_=null;const x=()=>{_=null,c&&(g(),_=setTimeout(x,n),c=!1)};return()=>(c=!0,_||x(),_)}class Tc{constructor(n){this._hashName=n&&encodeURIComponent(n),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=na(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,l.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return l.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(n){const c=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,x),I=Math.round(c.lng*T)/T,k=Math.round(c.lat*T)/T,W=this._map.getBearing(),ne=this._map.getPitch();let le="";if(le+=n?`/${I}/${k}/${_}`:`${_}/${k}/${I}`,(W||ne)&&(le+="/"+Math.round(10*W)/10),ne&&(le+=`/${Math.round(ne)}`),this._hashName){const pe=this._hashName;let De=!1;const Ze=l.window.location.hash.slice(1).split("&").map(Be=>{const Ve=Be.split("=")[0];return Ve===pe?(De=!0,`${Ve}=${le}`):Be}).filter(Be=>Be);return De||Ze.push(`${pe}=${le}`),`#${Ze.join("&")}`}return`#${le}`}_getCurrentHash(){const n=l.window.location.hash.replace("#","");if(this._hashName){let c;return n.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(c=_)}),(c&&c[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._getCurrentHash();if(n.length>=3&&!n.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:c,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=l.window.location.href.replace(/(#.+)?$/,this.getHashString());l.window.history.replaceState(l.window.history.state,null,n)}}const ia={linearity:.3,easing:l.bezier(0,0,.3,1)},ol=l.extend({deceleration:2500,maxSpeed:1400},ia),Yc=l.extend({deceleration:20,maxSpeed:1400},ia),Cc=l.extend({deceleration:1e3,maxSpeed:360},ia),pr=l.extend({deceleration:1e3,maxSpeed:90},ia);class Pa{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,c=l.exported.now();for(;n.length>0&&c-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)c.zoom+=T.zoomDelta||0,c.bearing+=T.bearingDelta||0,c.pitch+=T.pitchDelta||0,T.panDelta&&c.pan._add(T.panDelta),T.around&&(c.around=T.around),T.pinchAround&&(c.pinchAround=T.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const T=_a(c.pan.mag(),_,l.extend({},ol,n||{}));x.offset=c.pan.mult(T.amount/c.pan.mag()),x.center=this._map.transform.center,ra(x,T)}if(c.zoom){const T=_a(c.zoom,_,Yc);x.zoom=this._map.transform.zoom+T.amount,ra(x,T)}if(c.bearing){const T=_a(c.bearing,_,Cc);x.bearing=this._map.transform.bearing+l.clamp(T.amount,-179,179),ra(x,T)}if(c.pitch){const T=_a(c.pitch,_,pr);x.pitch=this._map.transform.pitch+T.amount,ra(x,T)}if(x.zoom||x.bearing){const T=void 0===c.pinchAround?c.around:c.pinchAround;x.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),l.extend(x,{noMoveStart:!0})}}function ra(g,n){(!g.duration||g.duration<n.duration)&&(g.duration=n.duration,g.easing=n.easing)}function _a(g,n,c){const{maxSpeed:_,linearity:x,deceleration:T}=c,I=l.clamp(g*x/(n/1e3),-_,_),k=Math.abs(I)/(T*x);return{easing:c.easing,duration:1e3*k,amount:I*(k/2)}}class ko extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,_,x={}){const T=V.mousePos(c.getCanvasContainer(),_),I=c.unproject(T);super(n,l.extend({point:T,lngLat:I,originalEvent:_},x)),this._defaultPrevented=!1,this.target=c}}class Ql extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,_){const x="touchend"===n?_.changedTouches:_.touches,T=V.touchPos(c.getCanvasContainer(),x),I=T.map(W=>c.unproject(W)),k=T.reduce((W,ne,le,pe)=>W.add(ne.div(pe.length)),new l.pointGeometry(0,0));super(n,{points:T,point:k,lngLats:I,lngLat:c.unproject(k),originalEvent:_}),this._defaultPrevented=!1}}class Vs extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,_){super(n,{originalEvent:_}),this._defaultPrevented=!1}}class Oa{constructor(n,c){this._map=n,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new Vs(n.type,this._map,n))}mousedown(n,c){return this._mousedownPos=c,this._firePreventable(new ko(n.type,this._map,n))}mouseup(n){this._map.fire(new ko(n.type,this._map,n))}preclick(n){const c=l.extend({},n);c.type="preclick",this._map.fire(new ko(c.type,this._map,c))}click(n,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(n),this._map.fire(new ko(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new ko(n.type,this._map,n))}mouseover(n){this._map.fire(new ko(n.type,this._map,n))}mouseout(n){this._map.fire(new ko(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Ql(n.type,this._map,n))}touchmove(n){this._map.fire(new Ql(n.type,this._map,n))}touchend(n){this._map.fire(new Ql(n.type,this._map,n))}touchcancel(n){this._map.fire(new Ql(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mu{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(n){this._map.fire(new ko(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ko("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new ko(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ec{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,c){this.isEnabled()&&n.shiftKey&&0===n.button&&(V.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(n,c){if(!this._active)return;const _=c;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=_,this._box||(this._box=V.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const T=Math.min(x.x,_.x),I=Math.max(x.x,_.x),k=Math.min(x.y,_.y),W=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${k}px)`,this._box.style.width=I-T+"px",this._box.style.height=W-k+"px")})}mouseupWindow(n,c){if(!this._active||0!==n.button)return;const _=this._startPos,x=c;if(this.reset(),V.suppressClick(),_.x!==x.x||_.y!==x.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:T=>T.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&27===n.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,c){return this._map.fire(new l.Event(n,{originalEvent:c}))}}function $s(g,n){const c={};for(let _=0;_<g.length;_++)c[g[_].identifier]=n[_];return c}class Ra{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,c,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=n.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){const T=new l.pointGeometry(0,0);for(const I of x)T._add(I);return T.div(x.length)}(c),this.touches=$s(_,c)))}touchmove(n,c,_){if(this.aborted||!this.centroid)return;const x=$s(_,c);for(const T in this.touches){const I=this.touches[T],k=x[T];(!k||k.dist(I)>30)&&(this.aborted=!0)}}touchend(n,c,_){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class sl{constructor(n){this.singleTap=new Ra(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,c,_){this.singleTap.touchstart(n,c,_)}touchmove(n,c,_){this.singleTap.touchmove(n,c,_)}touchend(n,c,_){const x=this.singleTap.touchend(n,c,_);if(x){const T=n.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(x)<30;if(T&&I||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Dc{constructor(){this._zoomIn=new sl({numTouches:1,numTaps:2}),this._zoomOut=new sl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,c,_){this._zoomIn.touchstart(n,c,_),this._zoomOut.touchstart(n,c,_)}touchmove(n,c,_){this._zoomIn.touchmove(n,c,_),this._zoomOut.touchmove(n,c,_)}touchend(n,c,_){const x=this._zoomIn.touchend(n,c,_),T=this._zoomOut.touchend(n,c,_);return x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(x)},{originalEvent:n})}):T?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(T)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Au={0:1,2:2};class Fo{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(n,c){return!1}_move(n,c){return{}}mousedown(n,c){if(this._lastPoint)return;const _=V.mouseButton(n);this._correctButton(n,_)&&(this._lastPoint=c,this._eventButton=_)}mousemoveWindow(n,c){const _=this._lastPoint;if(_)if(n.preventDefault(),function(x,T){const I=Au[T];return void 0===x.buttons||(x.buttons&I)!==I}(n,this._eventButton))this.reset();else if(this._moved||!(c.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(_,c)}mouseupWindow(n){this._lastPoint&&V.mouseButton(n)===this._eventButton&&(this._moved&&V.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class La extends Fo{mousedown(n,c){super.mousedown(n,c),this._lastPoint&&(this._active=!0)}_correctButton(n,c){return 0===c&&!n.ctrlKey}_move(n,c){return{around:c,panDelta:c.sub(n)}}}class Jo extends Fo{_correctButton(n,c){return 0===c&&n.ctrlKey||2===c}_move(n,c){const _=.8*(c.x-n.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(n){n.preventDefault()}}class ya extends Fo{_correctButton(n,c){return 0===c&&n.ctrlKey||2===c}_move(n,c){const _=-.5*(c.y-n.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(n){n.preventDefault()}}class ka{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),l.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0)}touchstart(n,c,_){return this._calculateTransform(n,c,_)}touchmove(n,c,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.preventDefault(),this._calculateTransform(n,c,_)}}touchend(n,c,_){this._calculateTransform(n,c,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,c,_){_.length>0&&(this._active=!0);const x=$s(_,c),T=new l.pointGeometry(0,0),I=new l.pointGeometry(0,0);let k=0;for(const ne in x){const le=x[ne],pe=this._touches[ne];pe&&(T._add(le),I._add(le.sub(pe)),k++,x[ne]=le)}if(this._touches=x,k<this._minTouches||!I.mag())return;const W=I.div(k);return this._sum._add(W),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(k),panDelta:W}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=V.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class js{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(n){}_move(n,c,_){return{}}touchstart(n,c,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([c[0],c[1]]))}touchmove(n,c,_){if(!this._firstTwoTouches)return;n.preventDefault();const[x,T]=this._firstTwoTouches,I=Gs(_,c,x),k=Gs(_,c,T);if(!I||!k)return;const W=this._aroundCenter?null:I.add(k).div(2);return this._move([I,k],W,n)}touchend(n,c,_){if(!this._firstTwoTouches)return;const[x,T]=this._firstTwoTouches,I=Gs(_,c,x),k=Gs(_,c,T);I&&k||(this._active&&V.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Gs(g,n,c){for(let _=0;_<g.length;_++)if(g[_].identifier===c)return n[_]}function va(g,n){return Math.log(g/n)/Math.LN2}class Dl extends js{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,c){const _=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(va(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:va(this._distance,_),pinchAround:c}}}function oa(g,n){return 180*g.angleWith(n)/Math.PI}class Fa extends js{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,c){const _=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:oa(this._vector,_),pinchAround:c}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const c=25/(Math.PI*this._minDiameter)*360,_=oa(n,this._startVector);return Math.abs(_)<c}}function xa(g){return Math.abs(g.y)>Math.abs(g.x)}class Ic extends js{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(n){this._lastPoints=n,xa(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,c,_){const x=n[0].sub(this._lastPoints[0]),T=n[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&_.touches.length<3)&&(this._valid=this.gestureBeginsVertically(x,T,_.timeStamp),this._valid))return this._lastPoints=n,this._active=!0,{pitchDelta:(x.y+T.y)/2*-.5}}gestureBeginsVertically(n,c,_){if(void 0!==this._valid)return this._valid;const x=n.mag()>=2,T=c.mag()>=2;if(!x&&!T)return;if(!x||!T)return void 0===this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=n.y>0==c.y>0;return xa(n)&&xa(c)&&I}}const al={panStep:100,bearingStep:15,pitchStep:10};class ba{constructor(){const n=al;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let c=0,_=0,x=0,T=0,I=0;switch(n.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:n.shiftKey?_=-1:(n.preventDefault(),T=-1);break;case 39:n.shiftKey?_=1:(n.preventDefault(),T=1);break;case 38:n.shiftKey?x=1:(n.preventDefault(),I=-1);break;case 40:n.shiftKey?x=-1:(n.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:k=>{const W=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:Jc,zoom:c?Math.round(W)+c*(n.shiftKey?2:1):W,bearing:k.getBearing()+_*this._bearingStep,pitch:k.getPitch()+x*this._pitchStep,offset:[-T*this._panStep,-I*this._panStep],center:k.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jc(g){return g*(2-g)}const Mc=4.000244140625;class wa{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=n.deltaMode===l.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const _=l.exported.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==c&&c%Mc==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),n.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=n,this._delta-=c,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=V.mousePos(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform,c=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(0!==this._delta){const W="wheel"===this._type&&Math.abs(this._delta)>Mc?this._wheelZoomRate:this._defaultZoomRate;let ne=2/(1+Math.exp(-Math.abs(this._delta*W)));this._delta<0&&0!==ne&&(ne=1/ne);const le=c(),pe=Math.pow(2,le),De="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):pe;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(De*ne))),"wheel"===this._type&&(this._startZoom=c(),this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:c(),x=this._startZoom,T=this._easing;let I,k=!1;if("wheel"===this._type&&x&&T){const W=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),ne=T(W);I=l.number(x,_,ne),W<1?this._frameId||(this._frameId=!0):k=!0}else I=_,k=!0;return this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!k,zoomDelta:I-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let c=l.ease;if(this._prevEase){const _=this._prevEase,x=(l.exported.now()-_.start)/_.duration,T=_.easing(x+.01)-_.easing(x),I=.27/Math.sqrt(T*T+1e-4)*.01,k=Math.sqrt(.0729-I*I);c=l.bezier(I,k,.25,1)}return this._prevEase={start:l.exported.now(),duration:n,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=V.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(l.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!l.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Il{constructor(n,c){this._clickZoom=n,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ec{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,c){return n.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(n.shiftKey?-1:1),around:_.unproject(c)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ml{constructor(){this._tap=new sl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(n,c,_){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=c[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(n,c,_))}touchmove(n,c,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const x=c[0],T=x.y-this._swipePoint.y;return this._swipePoint=x,n.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(n,c,_)}touchend(n,c,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(n,c,_)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ba{constructor(n,c,_){this._el=n,this._mousePan=c,this._touchPan=_}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class tc{constructor(n,c,_){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=c,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ac{constructor(n,c,_,x){this._el=n,this._touchZoom=c,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ll=g=>g.zoom||g.drag||g.pitch||g.rotate;class Sc extends l.Event{}class Al{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,c){const _=l.sub([],c,n);this.radius=l.length(_[2]<0?l.div([],_,this.constants):[_[0],_[1],0])}projectRay(n){l.div(n,n,this.constants),l.normalize(n,n),l.mul$1(n,n,this.constants);const c=l.scale$2([],n,this.radius);if(c[2]>0){const _=l.scale$2([],[0,0,1],l.dot(c,[0,0,1])),x=l.scale$2([],l.normalize([],[c[0],c[1],0]),this.radius),T=l.add([],c,l.scale$2([],l.sub([],l.add([],x,_),c),2));c[0]=T[0],c[1]=T[1]}return c}}function Sl(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class cl{constructor(n,c){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pa(n),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Al,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),l.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[l.window.document,"mousemove",{capture:!0}],[l.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[l.window,"blur",void 0]];for(const[x,T,I]of this._listeners)x.addEventListener(T,x===l.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[n,c,_]of this._listeners)n.removeEventListener(c,n===l.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(n){const c=this._map,_=c.getCanvasContainer();this._add("mapEvent",new Oa(c,n));const x=c.boxZoom=new Ec(c,n);this._add("boxZoom",x);const T=new Dc,I=new ec;c.doubleClickZoom=new Il(I,T),this._add("tapZoom",T),this._add("clickZoom",I);const k=new Ml;this._add("tapDragZoom",k);const W=c.touchPitch=new Ic(c);this._add("touchPitch",W);const ne=new Jo(n),le=new ya(n);c.dragRotate=new tc(n,ne,le),this._add("mouseRotate",ne,["mousePitch"]),this._add("mousePitch",le,["mouseRotate"]);const pe=new La(n),De=new ka(c,n);c.dragPan=new Ba(_,pe,De),this._add("mousePan",pe),this._add("touchPan",De,["touchZoom","touchRotate"]);const Ze=new Fa,Be=new Dl;c.touchZoomRotate=new Ac(_,Be,Ze,k),this._add("touchRotate",Ze,["touchPan","touchZoom"]),this._add("touchZoom",Be,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Mu(c));const Ve=c.scrollZoom=new wa(c,this);this._add("scrollZoom",Ve,["mousePan"]);const ct=c.keyboard=new ba;this._add("keyboard",ct);for(const ze of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[ze]&&c[ze].enable(n[ze])}_add(n,c,_){this._handlers.push({handlerName:n,handler:c,allowed:_}),this._handlersById[n]=c}stop(n){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(ll(this._eventsInProgress))||this.isZooming()}_blockedByActive(n,c,_){for(const x in n)if(x!==_&&(!c||c.indexOf(x)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const c=[];for(const _ of n)this._el.contains(_.target)&&c.push(_);return c}handleEvent(n,c){this._updatingCamera=!0;const _="renderFrame"===n.type,x=_?void 0:n,T={needsRenderFrame:!1},I={},k={},W=n.touches?this._getMapTouches(n.touches):void 0,ne=W?V.touchPos(this._el,W):_?void 0:V.mousePos(this._el,n);for(const{handlerName:De,handler:Ze,allowed:Be}of this._handlers){if(!Ze.isEnabled())continue;let Ve;this._blockedByActive(k,Be,De)?Ze.reset():Ze[c||n.type]&&(Ve=Ze[c||n.type](n,ne,W),this.mergeHandlerResult(T,I,Ve,De,x),Ve&&Ve.needsRenderFrame&&this._triggerRenderFrame()),(Ve||Ze.isActive())&&(k[De]=Ze)}const le={};for(const De in this._previousActiveHandlers)k[De]||(le[De]=x);this._previousActiveHandlers=k,(Object.keys(le).length||Sl(T))&&(this._changes.push([T,I,le]),this._triggerRenderFrame()),(Object.keys(k).length||Sl(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:pe}=T;pe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],pe(this._map))}mergeHandlerResult(n,c,_,x,T){if(!_)return;l.extend(n,_);const I={handlerName:x,originalEvent:_.originalEvent||T};void 0!==_.zoomDelta&&(c.zoom=I),void 0!==_.panDelta&&(c.drag=I),void 0!==_.pitchDelta&&(c.pitch=I),void 0!==_.bearingDelta&&(c.rotate=I)}_applyChanges(){const n={},c={},_={};for(const[x,T,I]of this._changes)x.panDelta&&(n.panDelta=(n.panDelta||new l.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(n.around=x.around),void 0!==x.aroundCoord&&(n.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(n.pinchAround=x.pinchAround),x.noInertia&&(n.noInertia=x.noInertia),l.extend(c,T),l.extend(_,I);this._updateMapTransform(n,c,_),this._changes=[]}_updateMapTransform(n,c,_){const x=this._map,T=x.transform,I=at=>[at.x,at.y,at.z];if((at=>{const ht=this._eventsInProgress.drag;return ht&&!this._handlersById[ht.handlerName].isActive()})()&&!Sl(n)){const at=T.zoom;T.cameraElevationReference="sea",T.recenterOnTerrain(),T.cameraElevationReference="ground",at!==T.zoom&&this._map._update(!0)}if(!Sl(n))return this._fireEvents(c,_,!0);let{panDelta:k,zoomDelta:W,bearingDelta:ne,pitchDelta:le,around:pe,aroundCoord:De,pinchAround:Ze}=n;void 0!==Ze&&(pe=Ze),(at=>c.drag&&!this._eventsInProgress.drag)()&&pe&&(this._dragOrigin=I(T.pointCoordinate3D(pe)),this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",x._stop(!0),pe=pe||x.transform.centerPoint,ne&&(T.bearing+=ne),le&&(T.pitch+=le),T._updateCameraState();const Be=[0,0,0];if(k){const at=T.pointCoordinate(pe),ht=T.pointCoordinate(pe.sub(k));at&&ht&&(Be[0]=ht.x-at.x,Be[1]=ht.y-at.y)}const Ve=T.zoom,ct=[0,0,0];if(W){const at=I(De||T.pointCoordinate3D(pe)),ht={dir:l.normalize([],l.sub([],at,T._camera.position))};if(ht.dir[2]<0){const rt=T.zoomDeltaToMovement(at,W);l.scale$2(ct,ht.dir,rt)}}const ze=l.add(Be,Be,ct);T._translateCameraConstrained(ze),W&&Math.abs(T.zoom-Ve)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(c,_,!0)}_fireEvents(n,c,_){const x=ll(this._eventsInProgress),T=ll(n),I={};for(const le in n){const{originalEvent:pe}=n[le];this._eventsInProgress[le]||(I[`${le}start`]=pe),this._eventsInProgress[le]=n[le]}!x&&T&&this._fireEvent("movestart",T.originalEvent);for(const le in I)this._fireEvent(le,I[le]);T&&this._fireEvent("move",T.originalEvent);for(const le in n){const{originalEvent:pe}=n[le];this._fireEvent(le,pe)}const k={};let W;for(const le in this._eventsInProgress){const{handlerName:pe,originalEvent:De}=this._eventsInProgress[le];this._handlersById[pe].isActive()||(delete this._eventsInProgress[le],W=c[pe]||De,k[`${le}end`]=W)}for(const le in k)this._fireEvent(le,k[le]);const ne=ll(this._eventsInProgress);if(_&&(x||T)&&!ne){this._updatingCamera=!0;const le=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),pe=De=>0!==De&&-this._bearingSnap<De&&De<this._bearingSnap;le?(pe(le.bearing||this._map.getBearing())&&(le.bearing=0),this._map.easeTo(le,{originalEvent:W})):(this._map.fire(new l.Event("moveend",{originalEvent:W})),pe(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,c){this._map.fire(new l.Event(n,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new Sc("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Na="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ul extends l.Evented{constructor(n,c){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=c.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,c){return this.jumpTo({center:n},c)}panBy(n,c,_){return n=l.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,l.extend({offset:n},c),_)}panTo(n,c,_){return this.easeTo(l.extend({center:n},c),_)}getZoom(){return this.transform.zoom}setZoom(n,c){return this.jumpTo({zoom:n},c),this}zoomTo(n,c,_){return this.easeTo(l.extend({zoom:n},c),_)}zoomIn(n,c){return this.zoomTo(this.getZoom()+1,n,c),this}zoomOut(n,c){return this.zoomTo(this.getZoom()-1,n,c),this}getBearing(){return this.transform.bearing}setBearing(n,c){return this.jumpTo({bearing:n},c),this}getPadding(){return this.transform.padding}setPadding(n,c){return this.jumpTo({padding:n},c),this}rotateTo(n,c,_){return this.easeTo(l.extend({bearing:n},c),_)}resetNorth(n,c){return this.rotateTo(0,l.extend({duration:1e3},n),c),this}resetNorthPitch(n,c){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},n),c),this}snapToNorth(n,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,c):this}getPitch(){return this.transform.pitch}setPitch(n,c){return this.jumpTo({pitch:n},c),this}cameraForBounds(n,c){n=l.LngLatBounds.convert(n);const _=c&&c.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),_,c)}_extendCameraOptions(n){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=l.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const _=n.padding;n.padding={top:_,bottom:_,right:_,left:_}}return n.padding=l.extend(c,n.padding),n}_cameraForBoxAndBearing(n,c,_,x){const T=this._extendCameraOptions(x),I=this.transform,k=I.padding,W=I.project(l.LngLat.convert(n)),ne=I.project(l.LngLat.convert(c)),le=W.rotate(-l.degToRad(_)),pe=ne.rotate(-l.degToRad(_)),De=new l.pointGeometry(Math.max(le.x,pe.x),Math.max(le.y,pe.y)),Ze=new l.pointGeometry(Math.min(le.x,pe.x),Math.min(le.y,pe.y)),Be=De.sub(Ze),Ve=(I.width-(k.left+k.right+T.padding.left+T.padding.right))/Be.x,ct=(I.height-(k.top+k.bottom+T.padding.top+T.padding.bottom))/Be.y;if(ct<0||Ve<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ze=Math.min(I.scaleZoom(I.scale*Math.min(Ve,ct)),T.maxZoom),at="number"==typeof T.offset.x?new l.pointGeometry(T.offset.x,T.offset.y):l.pointGeometry.convert(T.offset),ht=new l.pointGeometry((T.padding.left-T.padding.right)/2,(T.padding.top-T.padding.bottom)/2).rotate(_*Math.PI/180),rt=at.add(ht).mult(I.scale/I.zoomScale(ze));return{center:I.unproject(W.add(ne).div(2).sub(rt)),zoom:ze,bearing:_}}_cameraForBox(n,c,_,x,T){const I=this._extendCameraOptions(T);_=_||0,x=x||0,n=l.LngLat.convert(n),c=l.LngLat.convert(c);const k=this.transform.clone();k.padding=I.padding;const W=this.getFreeCameraOptions(),ne=new l.LngLat(.5*(n.lng+c.lng),.5*(n.lat+c.lat)),le=.5*(_+x);if(k._camera.position[2]<l.mercatorZfromAltitude(le,ne.lat))return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");W.lookAtPoint(ne),k.setFreeCameraOptions(W);const pe=l.MercatorCoordinate.fromLngLat(n),De=l.MercatorCoordinate.fromLngLat(c),Ze=k.pointRayIntersection(k.centerPoint,le),Be=[(Ve=k.rayIntersectionCoordinate(Ze)).x,Ve.y,Ve.z];var Ve;const ct=k.screenPointToMercatorRay(k.centerPoint),ze="globe"!==k.projection.name;let at,ht=0;do{const rt=Math.floor(k.zoom),st=1<<rt,gt=Math.min(st*pe.x,st*De.x),Zt=Math.min(st*pe.y,st*De.y),on=Math.max(st*pe.x,st*De.x),zn=Math.max(st*pe.y,st*De.y),An=new l.Aabb([gt,Zt,_],[on,zn,x]),Dn=l.Frustum.fromInvProjectionMatrix(k.invProjMatrix,k.worldSize,rt,ze);if(2!==An.intersects(Dn)){at&&(k._camera.position=l.scaleAndAdd([],k._camera.position,ct.dir,-at),k._updateStateFromCamera());break}const un=l.sub([],k._camera.position,Be);at=.5*l.length(un),k._camera.position=l.scaleAndAdd([],k._camera.position,ct.dir,at);try{k._updateStateFromCamera()}catch{return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ht<10);return{center:k.center,zoom:k.zoom,bearing:k.bearing,pitch:k.pitch}}fitBounds(n,c,_){return this._fitInternal(this.cameraForBounds(n,c),c,_)}_raycastElevationBox(n,c){const _=this.transform.elevation;if(!_)return;const x=new l.pointGeometry(n.x,c.y),T=new l.pointGeometry(c.x,n.y),I=_.pointCoordinate(n);if(!I)return;const k=_.pointCoordinate(c);if(!k)return;const W=_.pointCoordinate(x);if(!W)return;const ne=_.pointCoordinate(T);if(!ne)return;const le=new l.MercatorCoordinate(I[0],I[1]).toLngLat(),pe=new l.MercatorCoordinate(k[0],k[1]).toLngLat(),De=new l.MercatorCoordinate(W[0],W[1]).toLngLat(),Ze=new l.MercatorCoordinate(ne[0],ne[1]).toLngLat(),Be=Math.min(le.lng,Math.min(pe.lng,Math.min(De.lng,Ze.lng))),Ve=Math.min(le.lat,Math.min(pe.lat,Math.min(De.lat,Ze.lat))),ct=Math.max(le.lng,Math.max(pe.lng,Math.max(De.lng,Ze.lng))),ze=Math.max(le.lat,Math.max(pe.lat,Math.max(De.lat,Ze.lat))),at=Math.min(I[3],Math.min(k[3],Math.min(W[3],ne[3]))),ht=Math.max(I[3],Math.max(k[3],Math.max(W[3],ne[3])));return{minLngLat:new l.LngLat(Be,Ve),maxLngLat:new l.LngLat(ct,ze),minAltitude:at,maxAltitude:ht}}fitScreenCoordinates(n,c,_,x,T){let I,k,W,ne;const le=l.pointGeometry.convert(n),pe=l.pointGeometry.convert(c),De=this._raycastElevationBox(le,pe);if(De)I=De.minLngLat,k=De.maxLngLat,W=De.minAltitude,ne=De.maxAltitude;else{if(this.transform.anyCornerOffEdge(le,pe))return this;I=this.transform.pointLocation(le),k=this.transform.pointLocation(pe)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(n)),this.transform.pointLocation(l.pointGeometry.convert(c)),_,x):this._cameraForBox(I,k,W,ne,x),x,T)}_fitInternal(n,c,_){return n?(delete(c=l.extend(n,c)).padding,c.linear?this.easeTo(c,_):this.flyTo(c,_)):this}jumpTo(n,c){this.stop();const _=n.preloadOnly?this.transform.clone():this.transform;let x=!1,T=!1,I=!1;return"zoom"in n&&_.zoom!==+n.zoom&&(x=!0,_.zoom=+n.zoom),void 0!==n.center&&(_.center=l.LngLat.convert(n.center)),"bearing"in n&&_.bearing!==+n.bearing&&(T=!0,_.bearing=+n.bearing),"pitch"in n&&_.pitch!==+n.pitch&&(I=!0,_.pitch=+n.pitch),null==n.padding||_.isPaddingEqual(n.padding)||(_.padding=n.padding),n.preloadOnly?(this._preloadTiles(_),this):(this.fire(new l.Event("movestart",c)).fire(new l.Event("move",c)),x&&this.fire(new l.Event("zoomstart",c)).fire(new l.Event("zoom",c)).fire(new l.Event("zoomend",c)),T&&this.fire(new l.Event("rotatestart",c)).fire(new l.Event("rotate",c)).fire(new l.Event("rotateend",c)),I&&this.fire(new l.Event("pitchstart",c)).fire(new l.Event("pitch",c)).fire(new l.Event("pitchend",c)),this.fire(new l.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||l.warnOnce(Na),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,c){const _=this.transform;if(!_.projection.supportsFreeCamera)return void l.warnOnce(Na);this.stop();const x=_.zoom,T=_.pitch,I=_.bearing;_.setFreeCameraOptions(n);const k=x!==_.zoom,W=T!==_.pitch,ne=I!==_.bearing;return this.fire(new l.Event("movestart",c)).fire(new l.Event("move",c)),k&&this.fire(new l.Event("zoomstart",c)).fire(new l.Event("zoom",c)).fire(new l.Event("zoomend",c)),ne&&this.fire(new l.Event("rotatestart",c)).fire(new l.Event("rotate",c)).fire(new l.Event("rotateend",c)),W&&this.fire(new l.Event("pitchstart",c)).fire(new l.Event("pitch",c)).fire(new l.Event("pitchend",c)),this.fire(new l.Event("moveend",c)),this}easeTo(n,c){this._stop(!1,n.easeId),(!1===(n=l.extend({offset:[0,0],duration:500,easing:l.ease},n)).animate||!n.essential&&l.exported.prefersReducedMotion)&&(n.duration=0);const _=this.transform,x=this.getZoom(),T=this.getBearing(),I=this.getPitch(),k=this.getPadding(),W="zoom"in n?+n.zoom:x,ne="bearing"in n?this._normalizeBearing(n.bearing,T):T,le="pitch"in n?+n.pitch:I,pe="padding"in n?n.padding:_.padding,De=l.pointGeometry.convert(n.offset);let Ze=_.centerPoint.add(De);const Be="globe"===_.projection.name?_.pointCoordinate(Ze).toLngLat():_.pointLocation(Ze),Ve=l.LngLat.convert(n.center||Be);this._normalizeCenter(Ve);const ct=_.project(Be),ze=_.project(Ve).sub(ct),at=_.zoomScale(W-x);let ht,rt;n.around&&(ht=l.LngLat.convert(n.around),rt=_.locationPoint(ht));const st=this._zooming||W!==x,gt=this._rotating||T!==ne,Zt=this._pitching||le!==I,on=!_.isPaddingEqual(pe),zn=Dn=>un=>{if(st&&(Dn.zoom=l.number(x,W,un)),gt&&(Dn.bearing=l.number(T,ne,un)),Zt&&(Dn.pitch=l.number(I,le,un)),on&&(Dn.interpolatePadding(k,pe,un),Ze=Dn.centerPoint.add(De)),ht)Dn.setLocationAtPoint(ht,rt);else{const Jt=Dn.zoomScale(Dn.zoom-x),bn=W>x?Math.min(2,at):Math.max(.5,at),yn=Math.pow(bn,1-un),di=Dn.unproject(ct.add(ze.mult(un*yn)).mult(Jt));Dn.setLocationAtPoint(Dn.renderWorldCopies?di.wrap():di,Ze)}return n.preloadOnly||this._fireMoveEvents(c),Dn};if(n.preloadOnly){const Dn=this._emulate(zn,n.duration,_);return this._preloadTiles(Dn),this}const An={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=st,this._rotating=gt,this._pitching=Zt,this._padding=on,this._easeId=n.easeId,this._prepareEase(c,n.noMoveStart,An),this._ease(zn(_),Dn=>{_.recenterOnTerrain(),this._afterEase(c,Dn)},n),this}_prepareEase(n,c,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||_.moving||this.fire(new l.Event("movestart",n)),this._zooming&&!_.zooming&&this.fire(new l.Event("zoomstart",n)),this._rotating&&!_.rotating&&this.fire(new l.Event("rotatestart",n)),this._pitching&&!_.pitching&&this.fire(new l.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new l.Event("move",n)),this._zooming&&this.fire(new l.Event("zoom",n)),this._rotating&&this.fire(new l.Event("rotate",n)),this._pitching&&this.fire(new l.Event("pitch",n))}_afterEase(n,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId,this.transform.cameraElevationReference="ground";const _=this._zooming,x=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new l.Event("zoomend",n)),x&&this.fire(new l.Event("rotateend",n)),T&&this.fire(new l.Event("pitchend",n)),this.fire(new l.Event("moveend",n))}flyTo(n,c){if(!n.essential&&l.exported.prefersReducedMotion){const Nn=l.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Nn,c)}this.stop(),n=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},n);const _=this.transform,x=this.getZoom(),T=this.getBearing(),I=this.getPitch(),k=this.getPadding(),W="zoom"in n?l.clamp(+n.zoom,_.minZoom,_.maxZoom):x,ne="bearing"in n?this._normalizeBearing(n.bearing,T):T,le="pitch"in n?+n.pitch:I,pe="padding"in n?n.padding:_.padding,De=_.zoomScale(W-x),Ze=l.pointGeometry.convert(n.offset);let Be=_.centerPoint.add(Ze);const Ve=_.pointLocation(Be),ct=l.LngLat.convert(n.center||Ve);this._normalizeCenter(ct);const ze=_.project(Ve),at=_.project(ct).sub(ze);let ht=n.curve;const rt=Math.max(_.width,_.height),st=rt/De,gt=at.mag();if("minZoom"in n){const Nn=l.clamp(Math.min(n.minZoom,x,W),_.minZoom,_.maxZoom),vi=rt/_.zoomScale(Nn-x);ht=Math.sqrt(vi/gt*2)}const Zt=ht*ht;function on(Nn){const vi=(st*st-rt*rt+(Nn?-1:1)*Zt*Zt*gt*gt)/(2*(Nn?st:rt)*Zt*gt);return Math.log(Math.sqrt(vi*vi+1)-vi)}function zn(Nn){return(Math.exp(Nn)-Math.exp(-Nn))/2}function An(Nn){return(Math.exp(Nn)+Math.exp(-Nn))/2}const Dn=on(0);let un=function(Nn){return An(Dn)/An(Dn+ht*Nn)},Jt=function(Nn){return rt*((An(Dn)*(zn(vi=Dn+ht*Nn)/An(vi))-zn(Dn))/Zt)/gt;var vi},bn=(on(1)-Dn)/ht;if(Math.abs(gt)<1e-6||!isFinite(bn)){if(Math.abs(rt-st)<1e-6)return this.easeTo(n,c);const Nn=st<rt?-1:1;bn=Math.abs(Math.log(st/rt))/ht,Jt=function(){return 0},un=function(vi){return Math.exp(Nn*ht*vi)}}n.duration="duration"in n?+n.duration:1e3*bn/("screenSpeed"in n?+n.screenSpeed/ht:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const yn=T!==ne,di=le!==I,Mi=!_.isPaddingEqual(pe),rr=Nn=>vi=>{const Yi=vi*bn,Ar=1/un(Yi);Nn.zoom=1===vi?W:x+Nn.scaleZoom(Ar),yn&&(Nn.bearing=l.number(T,ne,vi)),di&&(Nn.pitch=l.number(I,le,vi)),Mi&&(Nn.interpolatePadding(k,pe,vi),Be=Nn.centerPoint.add(Ze));const Xr=1===vi?ct:Nn.unproject(ze.add(at.mult(Jt(Yi))).mult(Ar));return Nn.setLocationAtPoint(Nn.renderWorldCopies?Xr.wrap():Xr,Be),Nn._updateCenterElevation(),n.preloadOnly||this._fireMoveEvents(c),Nn};if(n.preloadOnly){const Nn=this._emulate(rr,n.duration,_);return this._preloadTiles(Nn),this}return this._zooming=!0,this._rotating=yn,this._pitching=di,this._padding=Mi,this._prepareEase(c,!1),this._ease(rr(_),()=>this._afterEase(c),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,c)}if(!n){const _=this.handlers;_&&_.stop(!1)}return this}_ease(n,c,_){!1===_.animate||0===_.duration?(n(1),c()):(this._easeStart=l.exported.now(),this._easeOptions=_,this._onEaseFrame=n,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,c){n=l.wrap(n,-180,180);const _=Math.abs(n-c);return Math.abs(n-360-c)<_&&(n-=360),Math.abs(n+360-c)<_&&(n+=360),n}_normalizeCenter(n){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const _=n.lng-c.center.lng;n.lng+=_>180?-360:_<-180?360:0}_emulate(n,c,_){const x=Math.ceil(15*c/1e3),T=[],I=n(_.clone());for(let k=0;k<=x;k++){const W=I(k/x);T.push(W.clone())}return T}}class Xc{constructor(n={}){this.options=n,l.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const c=this.options&&this.options.compact;return this._map=n,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=V.create("button","mapboxgl-ctrl-attrib-button",this._container),V.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,c){const _=this._map._getUIString(`AttributionControl.${c}`);n.setAttribute("aria-label",_),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||l.config.ACCESS_TOKEN}];if(n){const _=c.reduce((x,T,I)=>(T.value&&(x+=`${T.key}=${T.value}${I<c.length-1?"&":""}`),x),"?");n.href=`${l.config.FEEDBACK_URL}/${_}${this._map._hash?this._map._hash.getHashString(!0):""}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||"metadata"!==n.sourceDataType&&"visibility"!==n.sourceDataType&&"style"!==n.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style._sourceCaches;for(const x in c){const T=c[x];if(T.used){const I=T.getSource();I.attribution&&n.indexOf(I.attribution)<0&&n.push(I.attribution)}}n.sort((x,T)=>x.length-T.length),n=n.filter((x,T)=>{for(let I=T+1;I<n.length;I++)if(n[I].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const _=n.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,n.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class z{constructor(){l.bindAll(["_updateLogo"],this),l.bindAll(["_updateCompact"],this)}onAdd(n){this._map=n,this._container=V.create("div","mapboxgl-ctrl");const c=V.create("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&"metadata"!==n.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(0===Object.entries(n).length)return!0;for(const c in n){const _=n[c].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const c=n[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class O{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const c=++this._id;return this._queue.push({callback:n,id:c,cancelled:!1}),c}remove(n){const c=this._currentlyRunning,_=c?this._queue.concat(c):this._queue;for(const x of _)if(x.id===n)return void(x.cancelled=!0)}run(n=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const _ of c)if(!_.cancelled&&(_.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function S(g,n,c){if(g=new l.LngLat(g.lng,g.lat),n){const _=new l.LngLat(g.lng-360,g.lat),x=new l.LngLat(g.lng+360,g.lat),T=360*Math.ceil(Math.abs(g.lng-c.center.lng)/360),I=c.locationPoint(g).distSqr(n),k=n.x<0||n.y<0||n.x>c.width||n.y>c.height;c.locationPoint(_).distSqr(n)<I&&(k||Math.abs(_.lng-c.center.lng)<T)?g=_:c.locationPoint(x).distSqr(n)<I&&(k||Math.abs(x.lng-c.center.lng)<T)&&(g=x)}for(;Math.abs(g.lng-c.center.lng)>180;){const _=c.locationPoint(g);if(_.x>=0&&_.y>=0&&_.x<=c.width&&_.y<=c.height)break;g.lng>c.center.lng?g.lng-=360:g.lng+=360}return g}const J={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ce extends l.Evented{constructor(n,c){if(super(),(n instanceof l.window.HTMLElement||c)&&(n=l.extend({element:n},c)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&"auto"!==n.pitchAlignment?n.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),n&&n.element)this._element=n.element,this._offset=l.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div");const x=41,T=27,I=V.createSVG("svg",{display:"block",height:x*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${x}`},this._element),k=V.createSVG("radialGradient",{id:"shadowGradient"},V.createSVG("defs",{},I));V.createSVG("stop",{offset:"10%","stop-opacity":.4},k),V.createSVG("stop",{offset:"100%","stop-opacity":.05},k),V.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),V.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),V.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),V.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=l.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const _=this._element.classList;for(const x in J)_.remove(`mapboxgl-marker-anchor-${x}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=l.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const c=38.1,_=13.5,x=Math.sqrt(Math.pow(_,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-c],"bottom-left":[x,-1*(c-_+x)],"bottom-right":[-x,-1*(c-_+x)],left:[_,-1*(c-_)],right:[-_,-1*(c-_)]}:this._offset}this._popup=n,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const c=n.code,_=n.charCode||n.keyCode;"Space"!==c&&"Enter"!==c&&32!==_&&13!==_||this.togglePopup()}_onMapClick(n){const c=n.originalEvent.target,_=this._element;this._popup&&(c===_||_.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const n=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(n))return void this._clearFadeTimer();const c=this._map.unproject(n);let _=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const T=this._map.getFreeCameraOptions();if(T.position){const I=T.position.toLngLat();_=I.distanceTo(c)<.9*I.distanceTo(this._lngLat)}}const x=(1-this._map._queryFogOpacity(c))*(_?.2:1);this._element.style.opacity=`${x}`,this._popup&&this._popup._setOpacity(`${x}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(n){const c=this._map.transform;return!!n&&n.x>=0&&n.x<c.width&&n.y>=0&&n.y<c.height}_updateDOM(){const n=this._pos||new l.pointGeometry(0,0),c=this._calculatePitch(),_=this._calculateRotation();this._element.style.transform=`${J[this._anchor]} translate(${n.x}px, ${n.y}px) rotateX(${c}deg) rotateZ(${_}deg)`}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(n){l.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=S(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),!0===n?this._updateFrameId=l.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const n=this._map.transform,c=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&c._rotate(n.angle),"map"===this._pitchAlignment&&(c.y*=Math.cos(n._pitch)),c}getOffset(){return this._offset}setOffset(n){return this._offset=l.pointGeometry.convert(n),this._update(),this}_onMove(n){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(n){this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&"auto"!==n?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Me{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const c=l.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,c,_){this._start=this.getValue(c),this._end=n,this._startTime=c,this._endTime=c+_}}const lt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:bt,HTMLElement:xn,ImageBitmap:pi}=l.window,zr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Ri(g){g.parentNode&&g.parentNode.removeChild(g)}const oo={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ur{constructor(n,c,_=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Jo({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,_&&(this.mousePitch=new ya({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(n,c){this.mouseRotate.mousedown(n,c),this.mousePitch&&this.mousePitch.mousedown(n,c),V.disableDrag()}move(n,c){const _=this.map,x=this.mouseRotate.mousemoveWindow(n,c);if(x&&x.bearingDelta&&_.setBearing(_.getBearing()+x.bearingDelta),this.mousePitch){const T=this.mousePitch.mousemoveWindow(n,c);T&&T.pitchDelta&&_.setPitch(_.getPitch()+T.pitchDelta)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){V.enableDrag(),l.window.removeEventListener("mousemove",this.mousemove),l.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(l.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),V.mousePos(this.element,n)),l.window.addEventListener("mousemove",this.mousemove),l.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,V.mousePos(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){1!==n.targetTouches.length?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){1!==n.targetTouches.length?this.reset():(this._lastPos=V.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){0===n.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Mr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let bo,us=0,Ts=!1;const za={maxWidth:100,unit:"metric"};function Kn(g,n,c){const _=c&&c.maxWidth||100,x=g._containerHeight/2,T=g.unproject([0,x]),I=g.unproject([_,x]),k=T.distanceTo(I);if(c&&"imperial"===c.unit){const W=3.2808*k;W>5280?Pl(n,_,W/5280,g._getUIString("ScaleControl.Miles"),g):Pl(n,_,W,g._getUIString("ScaleControl.Feet"),g)}else c&&"nautical"===c.unit?Pl(n,_,k/1852,g._getUIString("ScaleControl.NauticalMiles"),g):k>=1e3?Pl(n,_,k/1e3,g._getUIString("ScaleControl.Kilometers"),g):Pl(n,_,k,g._getUIString("ScaleControl.Meters"),g)}function Pl(g,n,c,_,x){const T=function(k){const W=Math.pow(10,`${Math.floor(k)}`.length-1);let ne=k/W;return ne=ne>=10?10:ne>=5?5:ne>=3?3:ne>=2?2:ne>=1?1:function(le){const pe=Math.pow(10,Math.ceil(-Math.log(le)/Math.LN10));return Math.round(le*pe)/pe}(ne),W*ne}(c),I=T/c;x._requestDomTask(()=>{g.style.width=n*I+"px",g.innerHTML=`${T}&nbsp;${_}`})}const _h={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ua=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ol={version:l.version,supported:L,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends ul{constructor(g){if(null!=(g=l.extend({},zr,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new to(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._renderTaskQueue=new O,this._domRenderTaskQueue=new O,this._controls=[],this._markers=[],this._mapId=l.uniqueId(),this._locale=l.extend({},lt,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Me(0),this._requestManager=new l.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=l.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof xn))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&l.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==l.window&&(l.window.addEventListener("online",this._onWindowOnline,!1),l.window.addEventListener("resize",this._onWindowResize,!1),l.window.addEventListener("orientationchange",this._onWindowResize,!1),l.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new cl(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new Tc("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,l.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new Xc({customAttribution:g.customAttribution})),this._logoControl=new z,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update("style"===n.dataType),this.fire(new l.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new l.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(g,n){if(void 0===n&&(n=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=g.onAdd(this);this._controls.push(g);const _=this._controlPositions[n];return-1!==n.indexOf("bottom")?_.insertBefore(c,_.firstChild):_.appendChild(c),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(g);return n>-1&&this._controls.splice(n,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new l.Event("movestart",g)).fire(new l.Event("move",g)),this.fire(new l.Event("resize",g)),n&&this.fire(new l.Event("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(l.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}getProjection(){return this.transform.getProjection()}setProjection(g){return this._lazyInitEmptyStyle(),"string"==typeof g&&(g={name:g}),this._runtimeProjection=g,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(g){return this.transform.locationPoint3D(l.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(l.pointGeometry.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(g,n,c){if("mouseenter"===g||"mouseover"===g){let _=!1;const x=I=>{const k=n.filter(ne=>this.getLayer(ne)),W=k.length?this.queryRenderedFeatures(I.point,{layers:k}):[];W.length?_||(_=!0,c.call(this,new ko(g,this,I.originalEvent,{features:W}))):_=!1},T=()=>{_=!1};return{layers:new Set(n),listener:c,delegates:{mousemove:x,mouseout:T}}}if("mouseleave"===g||"mouseout"===g){let _=!1;const x=I=>{const k=n.filter(W=>this.getLayer(W));(k.length?this.queryRenderedFeatures(I.point,{layers:k}):[]).length?_=!0:_&&(_=!1,c.call(this,new ko(g,this,I.originalEvent)))},T=I=>{_&&(_=!1,c.call(this,new ko(g,this,I.originalEvent)))};return{layers:new Set(n),listener:c,delegates:{mousemove:x,mouseout:T}}}{const _=x=>{const T=n.filter(k=>this.getLayer(k)),I=T.length?this.queryRenderedFeatures(x.point,{layers:T}):[];I.length&&(x.features=I,c.call(this,x),delete x.features)};return{layers:new Set(n),listener:c,delegates:{[g]:_}}}}on(g,n,c){if(void 0===c)return super.on(g,n);Array.isArray(n)||(n=[n]);const _=this._createDelegatedListener(g,n,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(const x in _.delegates)this.on(x,_.delegates[x]);return this}once(g,n,c){if(void 0===c)return super.once(g,n);Array.isArray(n)||(n=[n]);const _=this._createDelegatedListener(g,n,c);for(const x in _.delegates)this.once(x,_.delegates[x]);return this}off(g,n,c){if(void 0===c)return super.off(g,n);n=new Set(Array.isArray(n)?n:[n]);const _=(T,I)=>{if(T.size!==I.size)return!1;for(const k of T)if(!I.has(k))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[g]:void 0;return x&&(T=>{for(let I=0;I<T.length;I++){const k=T[I];if(k.listener===c&&_(k.layers,n)){for(const W in k.delegates)this.off(W,k.delegates[W]);return T.splice(I,1),this}}})(x),this}queryRenderedFeatures(g,n){return this.style?(void 0!==n||void 0===g||g instanceof l.pointGeometry||Array.isArray(g)||(n=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(g,n){return this.style.querySourceFeatures(g,n)}queryTerrainElevation(g,n){const c=this.transform.elevation;return c?(n=l.extend({},{exaggerated:!0},n),c.getAtPoint(l.MercatorCoordinate.fromLngLat(g),null,n.exaggerated)):null}setStyle(g,n){return!1!==(n=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(g,n))}_getUIString(g){const n=this._locale[g];if(null==n)throw new Error(`Missing UI string '${g}'`);return n}_updateStyle(g,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),g&&(this.style=new ar(this,n||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ar(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,n){if("string"==typeof g){const c=this._requestManager.normalizeStyleURL(g),_=this._requestManager.transformRequest(c,l.ResourceType.Style);l.getJSON(_,(x,T)=>{x?this.fire(new l.ErrorEvent(x)):T&&this._updateDiff(T,n)})}else"object"==typeof g&&this._updateDiff(g,n)}_updateDiff(g,n){try{this.style.setState(g)&&this._update(!0)}catch(c){l.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(g,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(g,n){return this._lazyInitEmptyStyle(),this.style.addSource(g,n),this._update(!0)}isSourceLoaded(g){const n=this.style&&this.style._getSourceCaches(g);if(0!==n.length)return n.every(c=>c.loaded());this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${g}'`)))}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const n in g){const c=g[n]._tiles;for(const _ in c){const x=c[_];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(g,n,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,n,c)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,n,{pixelRatio:c=1,sdf:_=!1,stretchX:x,stretchY:T,content:I}={}){if(this._lazyInitEmptyStyle(),n instanceof bt||pi&&n instanceof pi){const{width:k,height:W,data:ne}=l.exported.getImageData(n);this.style.addImage(g,{data:new l.RGBAImage({width:k,height:W},ne),pixelRatio:c,stretchX:x,stretchY:T,content:I,sdf:_,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:k,height:W,data:ne}=n,le=n;this.style.addImage(g,{data:new l.RGBAImage({width:k,height:W},new Uint8Array(ne)),pixelRatio:c,stretchX:x,stretchY:T,content:I,sdf:_,version:0,userImage:le}),le.onAdd&&le.onAdd(this,g)}}}updateImage(g,n){const c=this.style.getImage(g);if(!c)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=n instanceof bt||pi&&n instanceof pi?l.exported.getImageData(n):n,{width:x,height:T,data:I}=_;return void 0===x||void 0===T?this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):x!==c.data.width||T!==c.data.height?this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(c.data.replace(I,!(n instanceof bt||pi&&n instanceof pi)),void this.style.updateImage(g,c))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,n){l.getImage(this._requestManager.transformRequest(g,l.ResourceType.Image),(c,_)=>{n(c,_ instanceof bt?l.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(g,n){return this._lazyInitEmptyStyle(),this.style.addLayer(g,n),this._update(!0)}moveLayer(g,n){return this.style.moveLayer(g,n),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,n,c){return this.style.setLayerZoomRange(g,n,c),this._update(!0)}setFilter(g,n,c={}){return this.style.setFilter(g,n,c),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,n,c,_={}){return this.style.setPaintProperty(g,n,c,_),this._update(!0)}getPaintProperty(g,n){return this.style.getPaintProperty(g,n)}setLayoutProperty(g,n,c,_={}){return this.style.setLayoutProperty(g,n,c,_),this._update(!0)}getLayoutProperty(g,n){return this.style.getLayoutProperty(g,n)}setLight(g,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){"globe"===this.transform.projection.name&&this.transform.zoom>=l.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(l.LngLat.convert(g),this.transform):0}setFeatureState(g,n){return this.style.setFeatureState(g,n),this._update()}removeFeatureState(g,n){return this.style.removeFeatureState(g,n),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let c,_=this._container;for(;_&&!c;){const x=l.window.getComputedStyle(_).transform;x&&"none"!==x&&(c=x.match(/matrix.*\((.+)\)/)[1].split(", ")),_=_.parentElement}c?(this._containerWidth=c[0]&&"0"!==c[0]?Math.abs(g/c[0]):g,this._containerHeight=c[3]&&"0"!==c[3]?Math.abs(n/c[3]):n):(this._containerWidth=g,this._containerHeight=n)}_detectMissingCSS(){"rgb(250, 128, 114)"!==l.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&l.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=V.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=V.create("div","mapboxgl-canvas-container",g);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=V.create("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=V.create("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=V.create("div",`mapboxgl-ctrl-${x}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,n){const c=l.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(g),this._canvas.height=c*Math.ceil(n),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${n}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const n=this._markers.indexOf(g);-1!==n&&this._markers.splice(n,1)}_setupPainter(){const g=l.extend({},L.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);n?(l.storeAuthState(n,!0),this.painter=new rs(n,this.transform),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),l.exported$1.testSupport(n)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let n;const c=this.painter.context.extTimerQuery,_=l.exported.now();this.listens("gpu-timing-frame")&&(n=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,n));let x=this._updateAverageElevation(_);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjection();let T=!1;const I=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const W=this.transform.zoom,ne=this.transform.pitch,le=l.exported.now();this.style.zoomHistory.update(W,le);const pe=new l.EvaluationParameters(W,{now:le,fadeDuration:I,pitch:ne,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),De=pe.crossFadingFactor();1===De&&De===this._crossFadingFactor||(T=!0,this._crossFadingFactor=De),this.style.update(pe)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,I,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:I,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||T)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const W=l.exported.now()-_;c.endQueryEXT(c.TIME_ELAPSED_EXT,n),setTimeout(()=>{const ne=c.getQueryObjectEXT(n,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(n),this.fire(new l.Event("gpu-timing-frame",{cpuTime:W,gpuTime:ne}))},50)}if(this.listens("gpu-timing-layer")){const W=this.painter.collectGpuTimers();setTimeout(()=>{const ne=this.painter.queryGpuTimers(W);this.fire(new l.Event("gpu-timing-layer",{layerTimes:ne}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(k||this._repaint)this.triggerRepaint();else{const W=!this.isMoving()&&this.loaded();if(W&&(x=this._updateAverageElevation(_,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),W&&(this.fire(new l.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const ne=this._calculateSpeedIndex();this.fire(new l.Event("speedindexcompleted",{speedIndex:ne})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const g of this._markers)g._update()}_updateAverageElevation(g,n=!1){const c=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((n||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();isNaN(x)?x=0:this._averageElevationLastSampledAt=g;const T=Math.abs(_-x);if(T>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(x),c(x);this._averageElevation.easeTo(x,g,300)}else if(T>1e-4)return this._averageElevation.jumpTo(x),c(x)}return!!this._averageElevation.isEasing(g)&&c(this._averageElevation.getValue(g))}_authenticate(){l.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===l.AUTH_ERR_MSG||401===g.status)){const n=this.painter.context.gl;l.storeAuthState(n,!1),this._logoControl instanceof z&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new l.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),l.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const c=this.painter.context.gl,_=c.createFramebuffer();function x(T){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,T,0);const I=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,I),I}return c.bindFramebuffer(c.FRAMEBUFFER,_),this._canvasPixelComparison(x(g),n.canvasCopies.map(x),n.timeStamps)}_canvasPixelComparison(g,n,c){let _=c[1]-c[0];const x=g.length/4;for(let T=0;T<n.length;T++){const I=n[T];let k=0;for(let W=0;W<I.length;W+=4)I[W]===g[W]&&I[W+1]===g[W+1]&&I[W+2]===g[W+2]&&I[W+3]===g[W+3]&&(k+=1);_+=(c[T+2]-c[T+1])*(1-k/x)}return _}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==l.window&&(l.window.removeEventListener("resize",this._onWindowResize,!1),l.window.removeEventListener("orientationchange",this._onWindowResize,!1),l.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.removeEventListener("online",this._onWindowOnline,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),Ri(this._canvasContainer),Ri(this._controlContainer),Ri(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),l.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=l.exported.frame(n=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(n)}))}_preloadTiles(g){const n=this.style&&Object.values(this.style._sourceCaches)||[];return l.asyncAll(n,(c,_)=>c._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}_setCacheLimits(g,n){l.setCacheLimits(g,n)}get version(){return l.version}},NavigationControl:class{constructor(g){this.options=l.extend({},oo,g),this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),V.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),V.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=V.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const g=this._map.getZoom(),n=g===this._map.getMaxZoom(),c=g===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const g=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=g)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ur(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,n){const c=V.create("button",g,this._container);return c.type="button",c.addEventListener("click",n),c}_setButtonTitle(g,n){const c=this._map._getUIString(`NavigationControl.${n}`);g.setAttribute("aria-label",c),g.firstElementChild&&g.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends l.Evented{constructor(g){super(),this.options=l.extend({},Mr,g),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=na(this._updateMarkerRotation,20)}onAdd(g){var n;return this._map=g,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==bo?n(bo):void 0!==l.window.navigator.permissions?l.window.navigator.permissions.query({name:"geolocation"}).then(c=>{bo="denied"!==c.state,n(bo)}):(bo=!!l.window.navigator.geolocation,n(bo)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(l.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,us=0,Ts=!1}_isOutOfMapMaxBounds(g){const n=this._map.getMaxBounds(),c=g.coords;return n&&(c.longitude<n.getWest()||c.longitude>n.getEast()||c.latitude<n.getSouth()||c.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",g)),this._finish()}}_updateCamera(g){const n=new l.LngLat(g.coords.longitude,g.coords.latitude),c=g.coords.accuracy,_=this._map.getBearing(),x=l.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(c),x,{geolocateSource:!0})}_updateMarker(g){if(g){const n=new l.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map._containerHeight/2,n=this._map.unproject([0,g]),c=this._map.unproject([100,g]),_=n.distanceTo(c)/100,x=Math.ceil(2*this._accuracy/_);this._circleElement.style.width=`${x}px`,this._circleElement.style.height=`${x}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&Ts)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=V.create("button","mapboxgl-ctrl-geolocate",this._container),V.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===g){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","mapboxgl-user-location"),this._dotElement.appendChild(V.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(V.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ce({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=V.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ce({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n.originalEvent&&"resize"===n.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":us--,Ts=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),us++,us>1?(g={maximumAge:6e5,timeout:0},Ts=!0):(g=this.options.positionOptions,Ts=!1),this._geolocationWatchID=l.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else l.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{l.window.addEventListener("ondeviceorientationabsolute"in l.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==l.window.DeviceMotionEvent&&"function"==typeof l.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(n=>{"granted"===n&&g()}).catch(console.error):g()}_clearWatch(){l.window.navigator.geolocation.clearWatch(this._geolocationWatchID),l.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),l.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Xc,ScaleControl:class{constructor(g){this.options=l.extend({},za,g),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Kn(this._map,this._container,this.options)}onAdd(g){return this._map=g,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(g){this.options.unit=g,Kn(this._map,this._container,this.options)}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof l.window.HTMLElement?this._container=g.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in l.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in l.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,l.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!l.window.document.fullscreenEnabled&&!l.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=V.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);V.create("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden",!0),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),l.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(l.window.document.fullscreenElement||l.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?l.window.document.exitFullscreen?l.window.document.exitFullscreen():l.window.document.webkitCancelFullScreen&&l.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends l.Evented{constructor(g){super(),this.options=l.extend(Object.create(_h),g),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=l.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(l.window.document.createTextNode(g))}setHTML(g){const n=l.window.document.createDocumentFragment(),c=l.window.document.createElement("body");let _;for(c.innerHTML=g;_=c.firstChild,_;)n.appendChild(_);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._container&&this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._container&&this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let n;return this._classList.delete(g)?n=!1:(this._classList.add(g),n=!0),this._container&&this._updateClassList(),n}_createCloseButton(){this.options.closeButton&&(this._closeButton=V.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(g){this._update(g.point)}_onMouseMove(g){this._update(g.point)}_onDrag(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const n=this._pos,c=this._container.offsetWidth,_=this._container.offsetHeight;let x;return x=n.y+g.bottom.y<_?["top"]:n.y>this._map.transform.height-_?["bottom"]:[],n.x<c/2?x.push("left"):n.x>this._map.transform.width-c/2&&x.push("right"),0===x.length?"bottom":x.join("-")}_updateClassList(){const g=[...this._classList];g.push("mapboxgl-popup"),this._anchor&&g.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&g.push("mapboxgl-popup-track-pointer"),this._container.className=g.join(" ")}_update(g){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=V.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=V.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=S(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||g){const n=this._pos=this._trackPointer&&g?g:this._map.project(this._lngLat),c=function(T){if(T||(T=new l.pointGeometry(0,0)),"number"==typeof T){const I=Math.round(Math.sqrt(.5*Math.pow(T,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,T),"top-left":new l.pointGeometry(I,I),"top-right":new l.pointGeometry(-I,I),bottom:new l.pointGeometry(0,-T),"bottom-left":new l.pointGeometry(I,-I),"bottom-right":new l.pointGeometry(-I,-I),left:new l.pointGeometry(T,0),right:new l.pointGeometry(-T,0)}}if(T instanceof l.pointGeometry||Array.isArray(T)){const I=l.pointGeometry.convert(T);return{center:I,top:I,"top-left":I,"top-right":I,bottom:I,"bottom-left":I,"bottom-right":I,left:I,right:I}}return{center:l.pointGeometry.convert(T.center||[0,0]),top:l.pointGeometry.convert(T.top||[0,0]),"top-left":l.pointGeometry.convert(T["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(T["top-right"]||[0,0]),bottom:l.pointGeometry.convert(T.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(T["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(T["bottom-right"]||[0,0]),left:l.pointGeometry.convert(T.left||[0,0]),right:l.pointGeometry.convert(T.right||[0,0])}}(this.options.offset),_=this._anchor=this._getAnchor(c),x=n.add(c[_]).round();this._map._requestDomTask(()=>{this._container&&_&&(this._container.style.transform=`${J[_]} translate(${x.x}px,${x.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Ua);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._content&&(this._content.style.opacity=g),this._tip&&(this._tip.style.opacity=g)}},Marker:ce,Style:ar,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,FreeCameraOptions:bc,Evented:l.Evented,config:l.config,prewarm:function(){Xe().acquire(We)},clearPrewarmedResources:function(){const g=Dt;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(We),Dt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return l.config.ACCESS_TOKEN},set accessToken(g){l.config.ACCESS_TOKEN=g},get baseApiUrl(){return l.config.API_URL},set baseApiUrl(g){l.config.API_URL=g},get workerCount(){return mt.workerCount},set workerCount(g){mt.workerCount=g},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){l.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){l.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:l.exported.setNow,restoreNow:l.exported.restoreNow};return Ol}),u}()},591:(Tn,Je,R)=>{"use strict";R.d(Je,{X:()=>j});var u=R(8929),d=R(5279);class j extends u.xQ{constructor(L){super(),this._value=L}get value(){return this.getValue()}_subscribe(L){const P=super._subscribe(L);return P&&!P.closed&&L.next(this._value),P}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new d.N;return this._value}next(L){super.next(this._value=L)}}},2916:(Tn,Je,R)=>{"use strict";R.d(Je,{y:()=>Z});var u=R(3489),j=R(7668),l=R(3292),P=R(3821),m=R(5379);var V=R(2830);let Z=(()=>{class re{constructor(ge){this._isScalar=!1,ge&&(this._subscribe=ge)}lift(ge){const xe=new re;return xe.source=this,xe.operator=ge,xe}subscribe(ge,xe,je){const{operator:nt}=this,Fe=function L(re,_e,ge){if(re){if(re instanceof u.L)return re;if(re[j.b])return re[j.b]()}return re||_e||ge?new u.L(re,_e,ge):new u.L(l.c)}(ge,xe,je);if(Fe.add(nt?nt.call(Fe,this.source):this.source||V.v.useDeprecatedSynchronousErrorHandling&&!Fe.syncErrorThrowable?this._subscribe(Fe):this._trySubscribe(Fe)),V.v.useDeprecatedSynchronousErrorHandling&&Fe.syncErrorThrowable&&(Fe.syncErrorThrowable=!1,Fe.syncErrorThrown))throw Fe.syncErrorValue;return Fe}_trySubscribe(ge){try{return this._subscribe(ge)}catch(xe){V.v.useDeprecatedSynchronousErrorHandling&&(ge.syncErrorThrown=!0,ge.syncErrorValue=xe),function d(re){for(;re;){const{closed:_e,destination:ge,isStopped:xe}=re;if(_e||xe)return!1;re=ge&&ge instanceof u.L?ge:null}return!0}(ge)?ge.error(xe):console.warn(xe)}}forEach(ge,xe){return new(xe=K(xe))((je,nt)=>{let Fe;Fe=this.subscribe(ke=>{try{ge(ke)}catch(Ne){nt(Ne),Fe&&Fe.unsubscribe()}},nt,je)})}_subscribe(ge){const{source:xe}=this;return xe&&xe.subscribe(ge)}[P.L](){return this}pipe(...ge){return 0===ge.length?this:function ue(re){return 0===re.length?m.y:1===re.length?re[0]:function(ge){return re.reduce((xe,je)=>je(xe),ge)}}(ge)(this)}toPromise(ge){return new(ge=K(ge))((xe,je)=>{let nt;this.subscribe(Fe=>nt=Fe,Fe=>je(Fe),()=>xe(nt))})}}return re.create=_e=>new re(_e),re})();function K(re){if(re||(re=V.v.Promise||Promise),!re)throw new Error("no Promise impl found");return re}},3292:(Tn,Je,R)=>{"use strict";R.d(Je,{c:()=>j});var u=R(2830),d=R(2782);const j={closed:!0,next(l){},error(l){if(u.v.useDeprecatedSynchronousErrorHandling)throw l;(0,d.z)(l)},complete(){}}},8929:(Tn,Je,R)=>{"use strict";R.d(Je,{Yc:()=>m,xQ:()=>$});var u=R(2916),d=R(3489),j=R(2654),l=R(5279),L=R(5283),P=R(7668);class m extends d.L{constructor(Z){super(Z),this.destination=Z}}let $=(()=>{class V extends u.y{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[P.b](){return new m(this)}lift(K){const re=new ue(this,this);return re.operator=K,re}next(K){if(this.closed)throw new l.N;if(!this.isStopped){const{observers:re}=this,_e=re.length,ge=re.slice();for(let xe=0;xe<_e;xe++)ge[xe].next(K)}}error(K){if(this.closed)throw new l.N;this.hasError=!0,this.thrownError=K,this.isStopped=!0;const{observers:re}=this,_e=re.length,ge=re.slice();for(let xe=0;xe<_e;xe++)ge[xe].error(K);this.observers.length=0}complete(){if(this.closed)throw new l.N;this.isStopped=!0;const{observers:K}=this,re=K.length,_e=K.slice();for(let ge=0;ge<re;ge++)_e[ge].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(K){if(this.closed)throw new l.N;return super._trySubscribe(K)}_subscribe(K){if(this.closed)throw new l.N;return this.hasError?(K.error(this.thrownError),j.w.EMPTY):this.isStopped?(K.complete(),j.w.EMPTY):(this.observers.push(K),new L.W(this,K))}asObservable(){const K=new u.y;return K.source=this,K}}return V.create=(Z,K)=>new ue(Z,K),V})();class ue extends ${constructor(Z,K){super(),this.destination=Z,this.source=K}next(Z){const{destination:K}=this;K&&K.next&&K.next(Z)}error(Z){const{destination:K}=this;K&&K.error&&this.destination.error(Z)}complete(){const{destination:Z}=this;Z&&Z.complete&&this.destination.complete()}_subscribe(Z){const{source:K}=this;return K?this.source.subscribe(Z):j.w.EMPTY}}},5283:(Tn,Je,R)=>{"use strict";R.d(Je,{W:()=>d});var u=R(2654);class d extends u.w{constructor(l,L){super(),this.subject=l,this.subscriber=L,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const l=this.subject,L=l.observers;if(this.subject=null,!L||0===L.length||l.isStopped||l.closed)return;const P=L.indexOf(this.subscriber);-1!==P&&L.splice(P,1)}}},3489:(Tn,Je,R)=>{"use strict";R.d(Je,{L:()=>m});var u=R(7043),d=R(3292),j=R(2654),l=R(7668),L=R(2830),P=R(2782);class m extends j.w{constructor(V,Z,K){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=d.c;break;case 1:if(!V){this.destination=d.c;break}if("object"==typeof V){V instanceof m?(this.syncErrorThrowable=V.syncErrorThrowable,this.destination=V,V.add(this)):(this.syncErrorThrowable=!0,this.destination=new $(this,V));break}default:this.syncErrorThrowable=!0,this.destination=new $(this,V,Z,K)}}[l.b](){return this}static create(V,Z,K){const re=new m(V,Z,K);return re.syncErrorThrowable=!1,re}next(V){this.isStopped||this._next(V)}error(V){this.isStopped||(this.isStopped=!0,this._error(V))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(V){this.destination.next(V)}_error(V){this.destination.error(V),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:V}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=V,this}}class $ extends m{constructor(V,Z,K,re){super(),this._parentSubscriber=V;let _e,ge=this;(0,u.m)(Z)?_e=Z:Z&&(_e=Z.next,K=Z.error,re=Z.complete,Z!==d.c&&(ge=Object.create(Z),(0,u.m)(ge.unsubscribe)&&this.add(ge.unsubscribe.bind(ge)),ge.unsubscribe=this.unsubscribe.bind(this))),this._context=ge,this._next=_e,this._error=K,this._complete=re}next(V){if(!this.isStopped&&this._next){const{_parentSubscriber:Z}=this;L.v.useDeprecatedSynchronousErrorHandling&&Z.syncErrorThrowable?this.__tryOrSetError(Z,this._next,V)&&this.unsubscribe():this.__tryOrUnsub(this._next,V)}}error(V){if(!this.isStopped){const{_parentSubscriber:Z}=this,{useDeprecatedSynchronousErrorHandling:K}=L.v;if(this._error)K&&Z.syncErrorThrowable?(this.__tryOrSetError(Z,this._error,V),this.unsubscribe()):(this.__tryOrUnsub(this._error,V),this.unsubscribe());else if(Z.syncErrorThrowable)K?(Z.syncErrorValue=V,Z.syncErrorThrown=!0):(0,P.z)(V),this.unsubscribe();else{if(this.unsubscribe(),K)throw V;(0,P.z)(V)}}}complete(){if(!this.isStopped){const{_parentSubscriber:V}=this;if(this._complete){const Z=()=>this._complete.call(this._context);L.v.useDeprecatedSynchronousErrorHandling&&V.syncErrorThrowable?(this.__tryOrSetError(V,Z),this.unsubscribe()):(this.__tryOrUnsub(Z),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(V,Z){try{V.call(this._context,Z)}catch(K){if(this.unsubscribe(),L.v.useDeprecatedSynchronousErrorHandling)throw K;(0,P.z)(K)}}__tryOrSetError(V,Z,K){if(!L.v.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{Z.call(this._context,K)}catch(re){return L.v.useDeprecatedSynchronousErrorHandling?(V.syncErrorValue=re,V.syncErrorThrown=!0,!0):((0,P.z)(re),!0)}return!1}_unsubscribe(){const{_parentSubscriber:V}=this;this._context=null,this._parentSubscriber=null,V.unsubscribe()}}},2654:(Tn,Je,R)=>{"use strict";R.d(Je,{w:()=>P});var u=R(6688),d=R(7830),j=R(7043);const L=(()=>{function $(ue){return Error.call(this),this.message=ue?`${ue.length} errors occurred during unsubscription:\n${ue.map((V,Z)=>`${Z+1}) ${V.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=ue,this}return $.prototype=Object.create(Error.prototype),$})();class P{constructor(ue){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,ue&&(this._ctorUnsubscribe=!0,this._unsubscribe=ue)}unsubscribe(){let ue;if(this.closed)return;let{_parentOrParents:V,_ctorUnsubscribe:Z,_unsubscribe:K,_subscriptions:re}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,V instanceof P)V.remove(this);else if(null!==V)for(let _e=0;_e<V.length;++_e)V[_e].remove(this);if((0,j.m)(K)){Z&&(this._unsubscribe=void 0);try{K.call(this)}catch(_e){ue=_e instanceof L?m(_e.errors):[_e]}}if((0,u.k)(re)){let _e=-1,ge=re.length;for(;++_e<ge;){const xe=re[_e];if((0,d.K)(xe))try{xe.unsubscribe()}catch(je){ue=ue||[],je instanceof L?ue=ue.concat(m(je.errors)):ue.push(je)}}}if(ue)throw new L(ue)}add(ue){let V=ue;if(!ue)return P.EMPTY;switch(typeof ue){case"function":V=new P(ue);case"object":if(V===this||V.closed||"function"!=typeof V.unsubscribe)return V;if(this.closed)return V.unsubscribe(),V;if(!(V instanceof P)){const re=V;V=new P,V._subscriptions=[re]}break;default:throw new Error("unrecognized teardown "+ue+" added to Subscription.")}let{_parentOrParents:Z}=V;if(null===Z)V._parentOrParents=this;else if(Z instanceof P){if(Z===this)return V;V._parentOrParents=[Z,this]}else{if(-1!==Z.indexOf(this))return V;Z.push(this)}const K=this._subscriptions;return null===K?this._subscriptions=[V]:K.push(V),V}remove(ue){const V=this._subscriptions;if(V){const Z=V.indexOf(ue);-1!==Z&&V.splice(Z,1)}}}var $;function m($){return $.reduce((ue,V)=>ue.concat(V instanceof L?V.errors:V),[])}P.EMPTY=(($=new P).closed=!0,$)},2830:(Tn,Je,R)=>{"use strict";R.d(Je,{v:()=>d});let u=!1;const d={Promise:void 0,set useDeprecatedSynchronousErrorHandling(j){if(j){const l=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+l.stack)}else u&&console.log("RxJS: Back to a better error behavior. Thank you. <3");u=j},get useDeprecatedSynchronousErrorHandling(){return u}}},1177:(Tn,Je,R)=>{"use strict";R.d(Je,{IY:()=>l,Ds:()=>P,ft:()=>$});var u=R(3489),d=R(2916),j=R(9249);class l extends u.L{constructor(V){super(),this.parent=V}_next(V){this.parent.notifyNext(V)}_error(V){this.parent.notifyError(V),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class P extends u.L{notifyNext(V){this.destination.next(V)}notifyError(V){this.destination.error(V)}notifyComplete(){this.destination.complete()}}function $(ue,V){if(!V.closed)return ue instanceof d.y?ue.subscribe(V):(0,j.s)(ue)(V)}},1762:(Tn,Je,R)=>{"use strict";R.d(Je,{c:()=>L,N:()=>P});var u=R(8929),d=R(2916),j=R(2654),l=R(4327);class L extends d.y{constructor(Z,K){super(),this.source=Z,this.subjectFactory=K,this._refCount=0,this._isComplete=!1}_subscribe(Z){return this.getSubject().subscribe(Z)}getSubject(){const Z=this._subject;return(!Z||Z.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let Z=this._connection;return Z||(this._isComplete=!1,Z=this._connection=new j.w,Z.add(this.source.subscribe(new m(this.getSubject(),this))),Z.closed&&(this._connection=null,Z=j.w.EMPTY)),Z}refCount(){return(0,l.x)()(this)}}const P=(()=>{const V=L.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:V._subscribe},_isComplete:{value:V._isComplete,writable:!0},getSubject:{value:V.getSubject},connect:{value:V.connect},refCount:{value:V.refCount}}})();class m extends u.Yc{constructor(Z,K){super(Z),this.connectable=K}_error(Z){this._unsubscribe(),super._error(Z)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const Z=this.connectable;if(Z){this.connectable=null;const K=Z._connection;Z._refCount=0,Z._subject=null,Z._connection=null,K&&K.unsubscribe()}}}},1221:(Tn,Je,R)=>{"use strict";R.d(Je,{z:()=>l});var u=R(1086),d=R(9146);function l(...L){return function j(){return(0,d.J)(1)}()((0,u.of)(...L))}},8514:(Tn,Je,R)=>{"use strict";R.d(Je,{P:()=>l});var u=R(2916),d=R(5254),j=R(8896);function l(L){return new u.y(P=>{let m;try{m=L()}catch(ue){return void P.error(ue)}return(m?(0,d.D)(m):(0,j.c)()).subscribe(P)})}},8896:(Tn,Je,R)=>{"use strict";R.d(Je,{E:()=>d,c:()=>j});var u=R(2916);const d=new u.y(L=>L.complete());function j(L){return L?function l(L){return new u.y(P=>L.schedule(()=>P.complete()))}(L):d}},567:(Tn,Je,R)=>{"use strict";R.d(Je,{D:()=>P});var u=R(2916),d=R(6688),j=R(4850),l=R(7830),L=R(5254);function P(...$){if(1===$.length){const ue=$[0];if((0,d.k)(ue))return m(ue,null);if((0,l.K)(ue)&&Object.getPrototypeOf(ue)===Object.prototype){const V=Object.keys(ue);return m(V.map(Z=>ue[Z]),V)}}if("function"==typeof $[$.length-1]){const ue=$.pop();return m($=1===$.length&&(0,d.k)($[0])?$[0]:$,null).pipe((0,j.U)(V=>ue(...V)))}return m($,null)}function m($,ue){return new u.y(V=>{const Z=$.length;if(0===Z)return void V.complete();const K=new Array(Z);let re=0,_e=0;for(let ge=0;ge<Z;ge++){const xe=(0,L.D)($[ge]);let je=!1;V.add(xe.subscribe({next:nt=>{je||(je=!0,_e++),K[ge]=nt},error:nt=>V.error(nt),complete:()=>{re++,(re===Z||!je)&&(_e===Z&&V.next(ue?ue.reduce((nt,Fe,ke)=>(nt[Fe]=K[ke],nt),{}):K),V.complete())}}))}})}},5254:(Tn,Je,R)=>{"use strict";R.d(Je,{D:()=>ge});var u=R(2916),d=R(9249),j=R(2654),l=R(3821),m=R(6454),$=R(5430),Z=R(8955),K=R(8515);function ge(xe,je){return je?function _e(xe,je){if(null!=xe){if(function V(xe){return xe&&"function"==typeof xe[l.L]}(xe))return function L(xe,je){return new u.y(nt=>{const Fe=new j.w;return Fe.add(je.schedule(()=>{const ke=xe[l.L]();Fe.add(ke.subscribe({next(Ne){Fe.add(je.schedule(()=>nt.next(Ne)))},error(Ne){Fe.add(je.schedule(()=>nt.error(Ne)))},complete(){Fe.add(je.schedule(()=>nt.complete()))}}))})),Fe})}(xe,je);if((0,Z.t)(xe))return function P(xe,je){return new u.y(nt=>{const Fe=new j.w;return Fe.add(je.schedule(()=>xe.then(ke=>{Fe.add(je.schedule(()=>{nt.next(ke),Fe.add(je.schedule(()=>nt.complete()))}))},ke=>{Fe.add(je.schedule(()=>nt.error(ke)))}))),Fe})}(xe,je);if((0,K.z)(xe))return(0,m.r)(xe,je);if(function re(xe){return xe&&"function"==typeof xe[$.hZ]}(xe)||"string"==typeof xe)return function ue(xe,je){if(!xe)throw new Error("Iterable cannot be null");return new u.y(nt=>{const Fe=new j.w;let ke;return Fe.add(()=>{ke&&"function"==typeof ke.return&&ke.return()}),Fe.add(je.schedule(()=>{ke=xe[$.hZ](),Fe.add(je.schedule(function(){if(nt.closed)return;let Ne,$e;try{const Re=ke.next();Ne=Re.value,$e=Re.done}catch(Re){return void nt.error(Re)}$e?nt.complete():(nt.next(Ne),this.schedule())}))})),Fe})}(xe,je)}throw new TypeError((null!==xe&&typeof xe||xe)+" is not observable")}(xe,je):xe instanceof u.y?xe:new u.y((0,d.s)(xe))}},3009:(Tn,Je,R)=>{"use strict";R.d(Je,{n:()=>l});var u=R(2916),d=R(3650),j=R(6454);function l(L,P){return P?(0,j.r)(L,P):new u.y((0,d.V)(L))}},3753:(Tn,Je,R)=>{"use strict";R.d(Je,{R:()=>P});var u=R(2916),d=R(6688),j=R(7043),l=R(4850);function P(Z,K,re,_e){return(0,j.m)(re)&&(_e=re,re=void 0),_e?P(Z,K,re).pipe((0,l.U)(ge=>(0,d.k)(ge)?_e(...ge):_e(ge))):new u.y(ge=>{m(Z,K,function xe(je){ge.next(arguments.length>1?Array.prototype.slice.call(arguments):je)},ge,re)})}function m(Z,K,re,_e,ge){let xe;if(function V(Z){return Z&&"function"==typeof Z.addEventListener&&"function"==typeof Z.removeEventListener}(Z)){const je=Z;Z.addEventListener(K,re,ge),xe=()=>je.removeEventListener(K,re,ge)}else if(function ue(Z){return Z&&"function"==typeof Z.on&&"function"==typeof Z.off}(Z)){const je=Z;Z.on(K,re),xe=()=>je.off(K,re)}else if(function $(Z){return Z&&"function"==typeof Z.addListener&&"function"==typeof Z.removeListener}(Z)){const je=Z;Z.addListener(K,re),xe=()=>je.removeListener(K,re)}else{if(!Z||!Z.length)throw new TypeError("Invalid event target");for(let je=0,nt=Z.length;je<nt;je++)m(Z[je],K,re,_e,ge)}_e.add(xe)}},1086:(Tn,Je,R)=>{"use strict";R.d(Je,{of:()=>l});var u=R(2866),d=R(3009),j=R(6454);function l(...L){let P=L[L.length-1];return(0,u.K)(P)?(L.pop(),(0,j.r)(L,P)):(0,d.n)(L)}},1406:(Tn,Je,R)=>{"use strict";R.d(Je,{b:()=>d});var u=R(1709);function d(j,l){return(0,u.zg)(j,l,1)}},2198:(Tn,Je,R)=>{"use strict";R.d(Je,{h:()=>d});var u=R(3489);function d(L,P){return function($){return $.lift(new j(L,P))}}class j{constructor(P,m){this.predicate=P,this.thisArg=m}call(P,m){return m.subscribe(new l(P,this.predicate,this.thisArg))}}class l extends u.L{constructor(P,m,$){super(P),this.predicate=m,this.thisArg=$,this.count=0}_next(P){let m;try{m=this.predicate.call(this.thisArg,P,this.count++)}catch($){return void this.destination.error($)}m&&this.destination.next(P)}}},4850:(Tn,Je,R)=>{"use strict";R.d(Je,{U:()=>d});var u=R(3489);function d(L,P){return function($){if("function"!=typeof L)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return $.lift(new j(L,P))}}class j{constructor(P,m){this.project=P,this.thisArg=m}call(P,m){return m.subscribe(new l(P,this.project,this.thisArg))}}class l extends u.L{constructor(P,m,$){super(P),this.project=m,this.count=0,this.thisArg=$||this}_next(P){let m;try{m=this.project.call(this.thisArg,P,this.count++)}catch($){return void this.destination.error($)}this.destination.next(m)}}},9146:(Tn,Je,R)=>{"use strict";R.d(Je,{J:()=>j});var u=R(1709),d=R(5379);function j(l=Number.POSITIVE_INFINITY){return(0,u.zg)(d.y,l)}},1709:(Tn,Je,R)=>{"use strict";R.d(Je,{zg:()=>l});var u=R(4850),d=R(5254),j=R(1177);function l($,ue,V=Number.POSITIVE_INFINITY){return"function"==typeof ue?Z=>Z.pipe(l((K,re)=>(0,d.D)($(K,re)).pipe((0,u.U)((_e,ge)=>ue(K,_e,re,ge))),V)):("number"==typeof ue&&(V=ue),Z=>Z.lift(new L($,V)))}class L{constructor(ue,V=Number.POSITIVE_INFINITY){this.project=ue,this.concurrent=V}call(ue,V){return V.subscribe(new P(ue,this.project,this.concurrent))}}class P extends j.Ds{constructor(ue,V,Z=Number.POSITIVE_INFINITY){super(ue),this.project=V,this.concurrent=Z,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(ue){this.active<this.concurrent?this._tryNext(ue):this.buffer.push(ue)}_tryNext(ue){let V;const Z=this.index++;try{V=this.project(ue,Z)}catch(K){return void this.destination.error(K)}this.active++,this._innerSub(V)}_innerSub(ue){const V=new j.IY(this),Z=this.destination;Z.add(V);const K=(0,j.ft)(ue,V);K!==V&&Z.add(K)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(ue){this.destination.next(ue)}notifyComplete(){const ue=this.buffer;this.active--,ue.length>0?this._next(ue.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}},4327:(Tn,Je,R)=>{"use strict";R.d(Je,{x:()=>d});var u=R(3489);function d(){return function(P){return P.lift(new j(P))}}class j{constructor(P){this.connectable=P}call(P,m){const{connectable:$}=this;$._refCount++;const ue=new l(P,$),V=m.subscribe(ue);return ue.closed||(ue.connection=$.connect()),V}}class l extends u.L{constructor(P,m){super(P),this.connectable=m}_unsubscribe(){const{connectable:P}=this;if(!P)return void(this.connection=null);this.connectable=null;const m=P._refCount;if(m<=0)return void(this.connection=null);if(P._refCount=m-1,m>1)return void(this.connection=null);const{connection:$}=this,ue=P._connection;this.connection=null,ue&&(!$||ue===$)&&ue.unsubscribe()}}},7545:(Tn,Je,R)=>{"use strict";R.d(Je,{w:()=>l});var u=R(4850),d=R(5254),j=R(1177);function l(m,$){return"function"==typeof $?ue=>ue.pipe(l((V,Z)=>(0,d.D)(m(V,Z)).pipe((0,u.U)((K,re)=>$(V,K,Z,re))))):ue=>ue.lift(new L(m))}class L{constructor($){this.project=$}call($,ue){return ue.subscribe(new P($,this.project))}}class P extends j.Ds{constructor($,ue){super($),this.project=ue,this.index=0}_next($){let ue;const V=this.index++;try{ue=this.project($,V)}catch(Z){return void this.destination.error(Z)}this._innerSub(ue)}_innerSub($){const ue=this.innerSubscription;ue&&ue.unsubscribe();const V=new j.IY(this),Z=this.destination;Z.add(V),this.innerSubscription=(0,j.ft)($,V),this.innerSubscription!==V&&Z.add(this.innerSubscription)}_complete(){const{innerSubscription:$}=this;(!$||$.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext($){this.destination.next($)}}},2986:(Tn,Je,R)=>{"use strict";R.d(Je,{q:()=>l});var u=R(3489),d=R(4231),j=R(8896);function l(m){return $=>0===m?(0,j.c)():$.lift(new L(m))}class L{constructor($){if(this.total=$,this.total<0)throw new d.W}call($,ue){return ue.subscribe(new P($,this.total))}}class P extends u.L{constructor($,ue){super($),this.total=ue,this.count=0}_next($){const ue=this.total,V=++this.count;V<=ue&&(this.destination.next($),V===ue&&(this.destination.complete(),this.unsubscribe()))}}},6454:(Tn,Je,R)=>{"use strict";R.d(Je,{r:()=>j});var u=R(2916),d=R(2654);function j(l,L){return new u.y(P=>{const m=new d.w;let $=0;return m.add(L.schedule(function(){$!==l.length?(P.next(l[$++]),P.closed||m.add(this.schedule())):P.complete()})),m})}},6686:(Tn,Je,R)=>{"use strict";R.d(Je,{o:()=>j});var u=R(2654);class d extends u.w{constructor(L,P){super()}schedule(L,P=0){return this}}class j extends d{constructor(L,P){super(L,P),this.scheduler=L,this.work=P,this.pending=!1}schedule(L,P=0){if(this.closed)return this;this.state=L;const m=this.id,$=this.scheduler;return null!=m&&(this.id=this.recycleAsyncId($,m,P)),this.pending=!0,this.delay=P,this.id=this.id||this.requestAsyncId($,this.id,P),this}requestAsyncId(L,P,m=0){return setInterval(L.flush.bind(L,this),m)}recycleAsyncId(L,P,m=0){if(null!==m&&this.delay===m&&!1===this.pending)return P;clearInterval(P)}execute(L,P){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const m=this._execute(L,P);if(m)return m;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(L,P){let $,m=!1;try{this.work(L)}catch(ue){m=!0,$=!!ue&&ue||new Error(ue)}if(m)return this.unsubscribe(),$}_unsubscribe(){const L=this.id,P=this.scheduler,m=P.actions,$=m.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==$&&m.splice($,1),null!=L&&(this.id=this.recycleAsyncId(P,L,null)),this.delay=null}}},2268:(Tn,Je,R)=>{"use strict";R.d(Je,{v:()=>d});let u=(()=>{class j{constructor(L,P=j.now){this.SchedulerAction=L,this.now=P}schedule(L,P=0,m){return new this.SchedulerAction(this,L).schedule(m,P)}}return j.now=()=>Date.now(),j})();class d extends u{constructor(l,L=u.now){super(l,()=>d.delegate&&d.delegate!==this?d.delegate.now():L()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(l,L=0,P){return d.delegate&&d.delegate!==this?d.delegate.schedule(l,L,P):super.schedule(l,L,P)}flush(l){const{actions:L}=this;if(this.active)return void L.push(l);let P;this.active=!0;do{if(P=l.execute(l.state,l.delay))break}while(l=L.shift());if(this.active=!1,P){for(;l=L.shift();)l.unsubscribe();throw P}}}},5430:(Tn,Je,R)=>{"use strict";R.d(Je,{hZ:()=>d});const d=function u(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},3821:(Tn,Je,R)=>{"use strict";R.d(Je,{L:()=>u});const u="function"==typeof Symbol&&Symbol.observable||"@@observable"},7668:(Tn,Je,R)=>{"use strict";R.d(Je,{b:()=>u});const u="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()},4231:(Tn,Je,R)=>{"use strict";R.d(Je,{W:()=>d});const d=(()=>{function j(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return j.prototype=Object.create(Error.prototype),j})()},5279:(Tn,Je,R)=>{"use strict";R.d(Je,{N:()=>d});const d=(()=>{function j(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return j.prototype=Object.create(Error.prototype),j})()},2782:(Tn,Je,R)=>{"use strict";function u(d){setTimeout(()=>{throw d},0)}R.d(Je,{z:()=>u})},5379:(Tn,Je,R)=>{"use strict";function u(d){return d}R.d(Je,{y:()=>u})},6688:(Tn,Je,R)=>{"use strict";R.d(Je,{k:()=>u});const u=Array.isArray||(d=>d&&"number"==typeof d.length)},8515:(Tn,Je,R)=>{"use strict";R.d(Je,{z:()=>u});const u=d=>d&&"number"==typeof d.length&&"function"!=typeof d},7043:(Tn,Je,R)=>{"use strict";function u(d){return"function"==typeof d}R.d(Je,{m:()=>u})},7830:(Tn,Je,R)=>{"use strict";function u(d){return null!==d&&"object"==typeof d}R.d(Je,{K:()=>u})},8955:(Tn,Je,R)=>{"use strict";function u(d){return!!d&&"function"!=typeof d.subscribe&&"function"==typeof d.then}R.d(Je,{t:()=>u})},2866:(Tn,Je,R)=>{"use strict";function u(d){return d&&"function"==typeof d.schedule}R.d(Je,{K:()=>u})},9249:(Tn,Je,R)=>{"use strict";R.d(Je,{s:()=>Z});var u=R(3650),d=R(2782),l=R(5430),P=R(3821),$=R(8515),ue=R(8955),V=R(7830);const Z=K=>{if(K&&"function"==typeof K[P.L])return(K=>re=>{const _e=K[P.L]();if("function"!=typeof _e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return _e.subscribe(re)})(K);if((0,$.z)(K))return(0,u.V)(K);if((0,ue.t)(K))return(K=>re=>(K.then(_e=>{re.closed||(re.next(_e),re.complete())},_e=>re.error(_e)).then(null,d.z),re))(K);if(K&&"function"==typeof K[l.hZ])return(K=>re=>{const _e=K[l.hZ]();for(;;){let ge;try{ge=_e.next()}catch(xe){return re.error(xe),re}if(ge.done){re.complete();break}if(re.next(ge.value),re.closed)break}return"function"==typeof _e.return&&re.add(()=>{_e.return&&_e.return()}),re})(K);{const _e=`You provided ${(0,V.K)(K)?"an invalid object":`'${K}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(_e)}}},3650:(Tn,Je,R)=>{"use strict";R.d(Je,{V:()=>u});const u=d=>j=>{for(let l=0,L=d.length;l<L&&!j.closed;l++)j.next(d[l]);j.complete()}},3760:function(Tn,Je,R){"use strict";var l,u=this&&this.__extends||(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,P){L.__proto__=P}||function(L,P){for(var m in P)P.hasOwnProperty(m)&&(L[m]=P[m])},function(L,P){function m(){this.constructor=L}l(L,P),L.prototype=null===P?Object.create(P):(m.prototype=P.prototype,new m)});Object.defineProperty(Je,"__esModule",{value:!0});var j=function(l){function L(){return null!==l&&l.apply(this,arguments)||this}return u(L,l),L}(R(1206).default);Je.default=j},1206:(Tn,Je,R)=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});var u=R(3762),d=R(643),j=function(){function l(L){this.root=null,this.compare=L||u.defaultCompare,this.nElements=0}return l.prototype.add=function(L){return!u.isUndefined(L)&&null!==this.insertNode(this.createNode(L))&&(this.nElements++,!0)},l.prototype.clear=function(){this.root=null,this.nElements=0},l.prototype.isEmpty=function(){return 0===this.nElements},l.prototype.size=function(){return this.nElements},l.prototype.contains=function(L){return!u.isUndefined(L)&&null!==this.searchNode(this.root,L)},l.prototype.search=function(L){var P=this.searchNode(this.root,L);if(null!==P)return P.element},l.prototype.remove=function(L){var P=this.searchNode(this.root,L);return null!==P&&(this.removeNode(P),this.nElements--,!0)},l.prototype.inorderTraversal=function(L){this.inorderTraversalAux(this.root,L,{stop:!1})},l.prototype.preorderTraversal=function(L){this.preorderTraversalAux(this.root,L,{stop:!1})},l.prototype.postorderTraversal=function(L){this.postorderTraversalAux(this.root,L,{stop:!1})},l.prototype.levelTraversal=function(L){this.levelTraversalAux(this.root,L)},l.prototype.minimum=function(){if(!this.isEmpty()&&null!==this.root)return this.minimumAux(this.root).element},l.prototype.maximum=function(){if(!this.isEmpty()&&null!==this.root)return this.maximumAux(this.root).element},l.prototype.forEach=function(L){this.inorderTraversal(L)},l.prototype.toArray=function(){var L=[];return this.inorderTraversal(function(P){return L.push(P),!0}),L},l.prototype.height=function(){return this.heightAux(this.root)},l.prototype.searchNode=function(L,P){for(var m=1;null!==L&&0!==m;)(m=this.compare(P,L.element))<0?L=L.leftCh:m>0&&(L=L.rightCh);return L},l.prototype.transplant=function(L,P){null===L.parent?this.root=P:L===L.parent.leftCh?L.parent.leftCh=P:L.parent.rightCh=P,null!==P&&(P.parent=L.parent)},l.prototype.removeNode=function(L){if(null===L.leftCh)this.transplant(L,L.rightCh);else if(null===L.rightCh)this.transplant(L,L.leftCh);else{var P=this.minimumAux(L.rightCh);P.parent!==L&&(this.transplant(P,P.rightCh),P.rightCh=L.rightCh,P.rightCh.parent=P),this.transplant(L,P),P.leftCh=L.leftCh,P.leftCh.parent=P}},l.prototype.inorderTraversalAux=function(L,P,m){null===L||m.stop||(this.inorderTraversalAux(L.leftCh,P,m),!m.stop&&(m.stop=!1===P(L.element),!m.stop&&this.inorderTraversalAux(L.rightCh,P,m)))},l.prototype.levelTraversalAux=function(L,P){var m=new d.default;for(null!==L&&m.enqueue(L),L=m.dequeue()||null;null!=L;){if(!1===P(L.element))return;null!==L.leftCh&&m.enqueue(L.leftCh),null!==L.rightCh&&m.enqueue(L.rightCh),L=m.dequeue()||null}},l.prototype.preorderTraversalAux=function(L,P,m){null===L||m.stop||(m.stop=!1===P(L.element),!m.stop&&(this.preorderTraversalAux(L.leftCh,P,m),!m.stop&&this.preorderTraversalAux(L.rightCh,P,m)))},l.prototype.postorderTraversalAux=function(L,P,m){null===L||m.stop||(this.postorderTraversalAux(L.leftCh,P,m),!m.stop&&(this.postorderTraversalAux(L.rightCh,P,m),!m.stop&&(m.stop=!1===P(L.element))))},l.prototype.minimumAux=function(L){for(;null!=L&&null!==L.leftCh;)L=L.leftCh;return L},l.prototype.maximumAux=function(L){for(;null!=L&&null!==L.rightCh;)L=L.rightCh;return L},l.prototype.heightAux=function(L){return null===L?-1:Math.max(this.heightAux(L.leftCh),this.heightAux(L.rightCh))+1},l.prototype.insertNode=function(L){for(var P=null,m=this.root;null!==m;){var $=this.compare(L.element,m.element);if(0===$)return null;$<0?(P=m,m=m.leftCh):(P=m,m=m.rightCh)}return L.parent=P,null===P?this.root=L:this.compare(L.element,P.element)<0?P.leftCh=L:P.rightCh=L,L},l.prototype.createNode=function(L){return{element:L,leftCh:null,rightCh:null,parent:null}},l}();Je.default=j},4577:(Tn,Je,R)=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});var u=R(3762),d=R(9166),j=R(7299),l=function(){function L(P){this.toStrF=P||u.defaultToString,this.dictionary=new d.default(this.toStrF),this.nElements=0}return L.prototype.add=function(P,m){return void 0===m&&(m=1),!(u.isUndefined(P)||m<=0)&&(this.contains(P)?this.dictionary.getValue(P).copies+=m:this.dictionary.setValue(P,{value:P,copies:m}),this.nElements+=m,!0)},L.prototype.count=function(P){return this.contains(P)?this.dictionary.getValue(P).copies:0},L.prototype.contains=function(P){return this.dictionary.containsKey(P)},L.prototype.remove=function(P,m){if(void 0===m&&(m=1),u.isUndefined(P)||m<=0)return!1;if(this.contains(P)){var $=this.dictionary.getValue(P);return this.nElements-=m>$.copies?$.copies:m,$.copies-=m,$.copies<=0&&this.dictionary.remove(P),!0}return!1},L.prototype.toArray=function(){for(var P=[],$=0,ue=this.dictionary.values();$<ue.length;$++)for(var V=ue[$],Z=V.value,K=V.copies,re=0;re<K;re++)P.push(Z);return P},L.prototype.toSet=function(){for(var P=new j.default(this.toStrF),$=0,ue=this.dictionary.values();$<ue.length;$++)P.add(ue[$].value);return P},L.prototype.forEach=function(P){this.dictionary.forEach(function(m,$){for(var ue=$.value,V=$.copies,Z=0;Z<V;Z++)if(!1===P(ue))return!1;return!0})},L.prototype.size=function(){return this.nElements},L.prototype.isEmpty=function(){return 0===this.nElements},L.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},L}();Je.default=l},9166:(Tn,Je,R)=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});var u=R(3762),d=function(){function j(l){this.table={},this.nElements=0,this.toStr=l||u.defaultToString}return j.prototype.getValue=function(l){var L=this.table["$"+this.toStr(l)];if(!u.isUndefined(L))return L.value},j.prototype.setValue=function(l,L){if(!u.isUndefined(l)&&!u.isUndefined(L)){var P,m="$"+this.toStr(l),$=this.table[m];return u.isUndefined($)?(this.nElements++,P=void 0):P=$.value,this.table[m]={key:l,value:L},P}},j.prototype.remove=function(l){var L="$"+this.toStr(l),P=this.table[L];if(!u.isUndefined(P))return delete this.table[L],this.nElements--,P.value},j.prototype.keys=function(){var l=[];for(var L in this.table)u.has(this.table,L)&&l.push(this.table[L].key);return l},j.prototype.values=function(){var l=[];for(var L in this.table)u.has(this.table,L)&&l.push(this.table[L].value);return l},j.prototype.forEach=function(l){for(var L in this.table)if(u.has(this.table,L)){var P=this.table[L];if(!1===l(P.key,P.value))return}},j.prototype.containsKey=function(l){return!u.isUndefined(this.getValue(l))},j.prototype.clear=function(){this.table={},this.nElements=0},j.prototype.size=function(){return this.nElements},j.prototype.isEmpty=function(){return this.nElements<=0},j.prototype.toString=function(){var l="{";return this.forEach(function(L,P){l+="\n\t"+L+" : "+P}),l+"\n}"},j}();Je.default=d},7008:function(Tn,Je,R){"use strict";var L,u=this&&this.__extends||(L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,m){P.__proto__=m}||function(P,m){for(var $ in m)m.hasOwnProperty($)&&(P[$]=m[$])},function(P,m){function $(){this.constructor=P}L(P,m),P.prototype=null===m?Object.create(m):($.prototype=m.prototype,new $)});Object.defineProperty(Je,"__esModule",{value:!0});var d=R(9166),j=R(3762),l=function(L){function P(m,$){var ue=L.call(this,$)||this;return ue.defaultFactoryFunction=m,ue}return u(P,L),P.prototype.setDefault=function(m,$){var ue=L.prototype.getValue.call(this,m);return j.isUndefined(ue)?(this.setValue(m,$),$):ue},P.prototype.getValue=function(m){return this.setDefault(m,this.defaultFactoryFunction())},P}(d.default);Je.default=l},4876:(Tn,Je,R)=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});var u=R(3762),d=R(9630),j=function(){function l(L){this.data=[],this.compare=L||u.defaultCompare}return l.prototype.leftChildIndex=function(L){return 2*L+1},l.prototype.rightChildIndex=function(L){return 2*L+2},l.prototype.parentIndex=function(L){return Math.floor((L-1)/2)},l.prototype.minIndex=function(L,P){return P>=this.data.length?L>=this.data.length?-1:L:this.compare(this.data[L],this.data[P])<=0?L:P},l.prototype.siftUp=function(L){for(var P=this.parentIndex(L);L>0&&this.compare(this.data[P],this.data[L])>0;)d.swap(this.data,P,L),P=this.parentIndex(L=P)},l.prototype.siftDown=function(L){for(var P=this.minIndex(this.leftChildIndex(L),this.rightChildIndex(L));P>=0&&this.compare(this.data[L],this.data[P])>0;)d.swap(this.data,P,L),P=this.minIndex(this.leftChildIndex(L=P),this.rightChildIndex(L))},l.prototype.peek=function(){if(this.data.length>0)return this.data[0]},l.prototype.add=function(L){return!u.isUndefined(L)&&(this.data.push(L),this.siftUp(this.data.length-1),!0)},l.prototype.removeRoot=function(){if(this.data.length>0){var L=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),L}},l.prototype.contains=function(L){var P=u.compareToEquals(this.compare);return d.contains(this.data,L,P)},l.prototype.size=function(){return this.data.length},l.prototype.isEmpty=function(){return this.data.length<=0},l.prototype.clear=function(){this.data.length=0},l.prototype.forEach=function(L){d.forEach(this.data,L)},l}();Je.default=j},3332:function(Tn,Je,R){"use strict";var $,u=this&&this.__extends||($=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ue,V){ue.__proto__=V}||function(ue,V){for(var Z in V)V.hasOwnProperty(Z)&&(ue[Z]=V[Z])},function(ue,V){function Z(){this.constructor=ue}$(ue,V),ue.prototype=null===V?Object.create(V):(Z.prototype=V.prototype,new Z)});Object.defineProperty(Je,"__esModule",{value:!0});var d=R(9166),j=R(3762),l=function(){function $(ue,V){this.key=ue,this.value=V}return $.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},$}(),L=function(){function $(){this.key=null,this.value=null}return $.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},$}();function P($){return!$.next}var m=function($){function ue(V){var Z=$.call(this,V)||this;return Z.head=new L,Z.tail=new L,Z.head.next=Z.tail,Z.tail.prev=Z.head,Z}return u(ue,$),ue.prototype.appendToTail=function(V){var Z=this.tail.prev;Z.next=V,V.prev=Z,V.next=this.tail,this.tail.prev=V},ue.prototype.getLinkedDictionaryPair=function(V){if(!j.isUndefined(V)){var Z="$"+this.toStr(V);return this.table[Z]}},ue.prototype.getValue=function(V){var Z=this.getLinkedDictionaryPair(V);if(!j.isUndefined(Z))return Z.value},ue.prototype.remove=function(V){var Z=this.getLinkedDictionaryPair(V);if(!j.isUndefined(Z))return $.prototype.remove.call(this,V),Z.unlink(),Z.value},ue.prototype.clear=function(){$.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},ue.prototype.replace=function(V,Z){var K="$"+this.toStr(Z.key);Z.next=V.next,Z.prev=V.prev,this.remove(V.key),Z.prev.next=Z,Z.next.prev=Z,this.table[K]=Z,++this.nElements},ue.prototype.setValue=function(V,Z){if(!j.isUndefined(V)&&!j.isUndefined(Z)){var K=this.getLinkedDictionaryPair(V),re=new l(V,Z),_e="$"+this.toStr(V);return j.isUndefined(K)?(this.appendToTail(re),this.table[_e]=re,void++this.nElements):(this.replace(K,re),K.value)}},ue.prototype.keys=function(){var V=[];return this.forEach(function(Z,K){V.push(Z)}),V},ue.prototype.values=function(){var V=[];return this.forEach(function(Z,K){V.push(K)}),V},ue.prototype.forEach=function(V){for(var Z=this.head.next;!P(Z);){if(!1===V(Z.key,Z.value))return;Z=Z.next}},ue}(d.default);Je.default=m},6319:(Tn,Je,R)=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});var u=R(3762),d=R(9630),j=function(){function l(){this.firstNode=null,this.lastNode=null,this.nElements=0}return l.prototype.add=function(L,P){if(u.isUndefined(P)&&(P=this.nElements),P<0||P>this.nElements||u.isUndefined(L))return!1;var m=this.createNode(L);if(0===this.nElements||null===this.lastNode)this.firstNode=m,this.lastNode=m;else if(P===this.nElements)this.lastNode.next=m,this.lastNode=m;else if(0===P)m.next=this.firstNode,this.firstNode=m;else{var $=this.nodeAtIndex(P-1);if(null===$)return!1;m.next=$.next,$.next=m}return this.nElements++,!0},l.prototype.first=function(){if(null!==this.firstNode)return this.firstNode.element},l.prototype.last=function(){if(null!==this.lastNode)return this.lastNode.element},l.prototype.elementAtIndex=function(L){var P=this.nodeAtIndex(L);if(null!==P)return P.element},l.prototype.indexOf=function(L,P){var m=P||u.defaultEquals;if(u.isUndefined(L))return-1;for(var $=this.firstNode,ue=0;null!==$;){if(m($.element,L))return ue;ue++,$=$.next}return-1},l.prototype.contains=function(L,P){return this.indexOf(L,P)>=0},l.prototype.remove=function(L,P){var m=P||u.defaultEquals;if(this.nElements<1||u.isUndefined(L))return!1;for(var $=null,ue=this.firstNode;null!==ue;){if(m(ue.element,L))return null===$?(this.firstNode=ue.next,ue===this.lastNode&&(this.lastNode=null)):ue===this.lastNode?(this.lastNode=$,$.next=ue.next,ue.next=null):($.next=ue.next,ue.next=null),this.nElements--,!0;$=ue,ue=ue.next}return!1},l.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},l.prototype.equals=function(L,P){var m=P||u.defaultEquals;return L instanceof l&&this.size()===L.size()&&this.equalsAux(this.firstNode,L.firstNode,m)},l.prototype.equalsAux=function(L,P,m){for(;null!==L&&null!==P;){if(!m(L.element,P.element))return!1;L=L.next,P=P.next}return!0},l.prototype.removeElementAtIndex=function(L){if(!(L<0||L>=this.nElements||null===this.firstNode||null===this.lastNode)){var P;if(1===this.nElements)P=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var m=this.nodeAtIndex(L-1);null===m?(P=this.firstNode.element,this.firstNode=this.firstNode.next):m.next===this.lastNode&&(P=this.lastNode.element,this.lastNode=m),null!==m&&null!==m.next&&(P=m.next.element,m.next=m.next.next)}return this.nElements--,P}},l.prototype.forEach=function(L){for(var P=this.firstNode;null!==P&&!1!==L(P.element);)P=P.next},l.prototype.reverse=function(){for(var L=null,P=this.firstNode,m=null;null!==P;)m=P.next,P.next=L,L=P,P=m;m=this.firstNode,this.firstNode=this.lastNode,this.lastNode=m},l.prototype.toArray=function(){for(var L=[],P=this.firstNode;null!==P;)L.push(P.element),P=P.next;return L},l.prototype.size=function(){return this.nElements},l.prototype.isEmpty=function(){return this.nElements<=0},l.prototype.toString=function(){return d.toString(this.toArray())},l.prototype.nodeAtIndex=function(L){if(L<0||L>=this.nElements)return null;if(L===this.nElements-1)return this.lastNode;for(var P=this.firstNode,m=0;m<L&&null!==P;m++)P=P.next;return P},l.prototype.createNode=function(L){return{element:L,next:null}},l}();Je.default=j},7730:(Tn,Je,R)=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});var u=R(3762),d=R(9166),j=R(9630),l=function(){function L(P,m,$){void 0===$&&($=!1),this.dict=new d.default(P),this.equalsF=m||u.defaultEquals,this.allowDuplicate=$}return L.prototype.getValue=function(P){var m=this.dict.getValue(P);return u.isUndefined(m)?[]:j.copy(m)},L.prototype.setValue=function(P,m){if(u.isUndefined(P)||u.isUndefined(m))return!1;var $=this.dict.getValue(P);return u.isUndefined($)?(this.dict.setValue(P,[m]),!0):!(!this.allowDuplicate&&j.contains($,m,this.equalsF)||($.push(m),0))},L.prototype.remove=function(P,m){if(u.isUndefined(m)){var $=this.dict.remove(P);return!u.isUndefined($)}var ue=this.dict.getValue(P);return!(u.isUndefined(ue)||!j.remove(ue,m,this.equalsF)||(0===ue.length&&this.dict.remove(P),0))},L.prototype.keys=function(){return this.dict.keys()},L.prototype.values=function(){for(var m=[],$=0,ue=this.dict.values();$<ue.length;$++)for(var Z=0,K=ue[$];Z<K.length;Z++)m.push(K[Z]);return m},L.prototype.containsKey=function(P){return this.dict.containsKey(P)},L.prototype.clear=function(){this.dict.clear()},L.prototype.size=function(){return this.dict.size()},L.prototype.isEmpty=function(){return this.dict.isEmpty()},L}();Je.default=l},3417:(Tn,Je)=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});var R=(()=>{return(d=R||(R={}))[d.BEFORE=0]="BEFORE",d[d.AFTER=1]="AFTER",d[d.INSIDE_AT_END=2]="INSIDE_AT_END",d[d.INSIDE_AT_START=3]="INSIDE_AT_START",R;var d})(),u=function(){function d(j,l){void 0===j&&(j=[]),void 0===l&&(l={}),this.rootIds=j,this.nodes=l,this.initRootIds(),this.initNodes()}return d.prototype.initRootIds=function(){for(var j=0,l=this.rootIds;j<l.length;j++)this.createEmptyNodeIfNotExist(l[j])},d.prototype.initNodes=function(){for(var j in this.nodes)if(this.nodes.hasOwnProperty(j))for(var l=0,L=this.nodes[j];l<L.length;l++)this.createEmptyNodeIfNotExist(L[l])},d.prototype.createEmptyNodeIfNotExist=function(j){this.nodes[j]||(this.nodes[j]=[])},d.prototype.getRootIds=function(){return this.rootIds.slice()},d.prototype.getNodes=function(){var j={};for(var l in this.nodes)this.nodes.hasOwnProperty(l)&&(j[l]=this.nodes[l].slice());return j},d.prototype.getObject=function(){return{rootIds:this.getRootIds(),nodes:this.getNodes()}},d.prototype.toObject=function(){return this.getObject()},d.prototype.flatten=function(){for(var j=this,l=[],L=0;L<this.rootIds.length;L++){var P=this.rootIds[L];l.push({id:P,level:0,hasParent:!1,childrenCount:0}),Z(P,this.nodes,l,0)}for(var m=0,$=l;m<$.length;m++){var ue=$[m];ue.childrenCount=j.nodes[K=ue.id]?j.nodes[K].length:0}var K;return l;function Z(K,re,_e,ge){if(void 0===ge&&(ge=0),K&&re&&_e&&re[K]){ge++;for(var xe=re[K],je=0;je<xe.length;je++){var nt=xe[je];_e.push({id:nt,level:ge,hasParent:!0}),Z(nt,re,_e,ge)}ge--}}},d.prototype.moveIdBeforeId=function(j,l){return this.moveId(j,l,R.BEFORE)},d.prototype.moveIdAfterId=function(j,l){return this.moveId(j,l,R.AFTER)},d.prototype.moveIdIntoId=function(j,l,L){return void 0===L&&(L=!0),this.moveId(j,l,L?R.INSIDE_AT_START:R.INSIDE_AT_END)},d.prototype.swapRootIdWithRootId=function(j,l){var L=this.findRootId(j),P=this.findRootId(l);this.swapRootPositionWithRootPosition(L,P)},d.prototype.swapRootPositionWithRootPosition=function(j,l){var L=this.rootIds[l];this.rootIds[l]=this.rootIds[j],this.rootIds[j]=L},d.prototype.deleteId=function(j){this.rootDeleteId(j),this.nodeAndSubNodesDelete(j),this.nodeRefrencesDelete(j)},d.prototype.insertIdBeforeId=function(j,l){var L=this.findRootId(j);for(var P in L>-1&&this.insertIdIntoRoot(l,L),this.nodes)if(this.nodes.hasOwnProperty(P)){var m=this.findNodeId(P,j);m>-1&&this.insertIdIntoNode(P,l,m)}},d.prototype.insertIdAfterId=function(j,l){var L=this.findRootId(j);for(var P in L>-1&&this.insertIdIntoRoot(l,L+1),this.nodes)if(this.nodes.hasOwnProperty(P)){var m=this.findNodeId(P,j);m>-1&&this.insertIdIntoNode(P,l,m+1)}},d.prototype.insertIdIntoId=function(j,l){this.nodeInsertAtEnd(j,l),this.nodes[l]=[]},d.prototype.insertIdIntoRoot=function(j,l){void 0===l?this.rootInsertAtEnd(j):this.rootIds.splice(l<0?l+this.rootIds.length+1:l,0,j),this.nodes[j]=this.nodes[j]||[]},d.prototype.insertIdIntoNode=function(j,l,L){this.nodes[j]=this.nodes[j]||[],this.nodes[l]=this.nodes[l]||[],void 0===L?this.nodeInsertAtEnd(j,l):this.nodes[j].splice(L<0?L+this.nodes[j].length+1:L,0,l)},d.prototype.moveId=function(j,l,L){var P=j,m=this.findRootId(P);for(var V in this.nodes)if(this.nodes.hasOwnProperty(V)){this.findNodeId(V,l);break}var Z=l,K=this.findRootId(Z);for(var V in this.nodes)if(this.nodes.hasOwnProperty(V)){this.findNodeId(V,l);break}if(m>-1){if(K>-1)switch(this.rootDelete(m),K>m&&K--,L){case R.BEFORE:this.insertIdIntoRoot(P,K);break;case R.AFTER:this.insertIdIntoRoot(P,K+1);break;case R.INSIDE_AT_START:this.nodeInsertAtStart(Z,P);break;case R.INSIDE_AT_END:this.nodeInsertAtEnd(Z,P)}else for(var V in this.rootDelete(m),this.nodes)if(this.nodes.hasOwnProperty(V)&&(ge=this.findNodeId(V,Z))>-1){switch(L){case R.BEFORE:this.insertIdIntoNode(V,P,ge);break;case R.AFTER:this.insertIdIntoNode(V,P,ge+1);break;case R.INSIDE_AT_START:this.nodeInsertAtStart(Z,P);break;case R.INSIDE_AT_END:this.nodeInsertAtEnd(Z,P)}break}}else if(K>-1){for(var V in this.nodes)if(this.nodes.hasOwnProperty(V)&&(ge=this.findNodeId(V,P))>-1){this.nodeDeleteAtIndex(V,ge);break}switch(L){case R.BEFORE:this.insertIdIntoRoot(P,K);break;case R.AFTER:this.insertIdIntoRoot(P,K+1);break;case R.INSIDE_AT_START:this.nodeInsertAtStart(Z,P);break;case R.INSIDE_AT_END:this.nodeInsertAtEnd(Z,P)}}else{for(var V in this.nodes)if(this.nodes.hasOwnProperty(V)&&(ge=this.findNodeId(V,P))>-1){this.nodeDeleteAtIndex(V,ge);break}for(var V in this.nodes)if(this.nodes.hasOwnProperty(V)){var ge;if((ge=this.findNodeId(V,Z))>-1){switch(L){case R.BEFORE:this.insertIdIntoNode(V,P,ge);break;case R.AFTER:this.insertIdIntoNode(V,P,ge+1);break;case R.INSIDE_AT_START:this.nodeInsertAtStart(Z,P);break;case R.INSIDE_AT_END:this.nodeInsertAtEnd(Z,P)}break}}}},d.prototype.swapArrayElements=function(j,l,L){var P=j[l];return j[l]=j[L],j[L]=P,j},d.prototype.rootDeleteId=function(j){var l=this.findRootId(j);l>-1&&this.rootDelete(l)},d.prototype.nodeAndSubNodesDelete=function(j){for(var l=[],L=0;L<this.nodes[j].length;L++)this.nodeAndSubNodesDelete(this.nodes[j][L]),l.push(j);for(this.nodeDelete(j),L=0;L<l.length;L++)this.nodeDelete(l[L])},d.prototype.nodeRefrencesDelete=function(j){for(var l in this.nodes)if(this.nodes.hasOwnProperty(l))for(var L=0;L<this.nodes[l].length;L++)this.nodes[l][L]===j&&this.nodeDeleteAtIndex(l,L)},d.prototype.nodeDelete=function(j){delete this.nodes[j]},d.prototype.findRootId=function(j){return this.rootIds.indexOf(j)},d.prototype.findNodeId=function(j,l){return this.nodes[j].indexOf(l)},d.prototype.findNode=function(j){return this.nodes[j]},d.prototype.nodeInsertAtStart=function(j,l){this.nodes[j].unshift(l)},d.prototype.nodeInsertAtEnd=function(j,l){this.nodes[j].push(l)},d.prototype.rootDelete=function(j){this.rootIds.splice(j,1)},d.prototype.nodeDeleteAtIndex=function(j,l){this.nodes[j].splice(l,1)},d.prototype.rootInsertAtStart=function(j){this.rootIds.unshift(j)},d.prototype.rootInsertAtEnd=function(j){this.rootIds.push(j)},d}();Je.default=u},8806:(Tn,Je,R)=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});var u=R(3762),d=R(4876),j=function(){function l(L){this.heap=new d.default(u.reverseCompareFunction(L))}return l.prototype.enqueue=function(L){return this.heap.add(L)},l.prototype.add=function(L){return this.heap.add(L)},l.prototype.dequeue=function(){if(0!==this.heap.size()){var L=this.heap.peek();return this.heap.removeRoot(),L}},l.prototype.peek=function(){return this.heap.peek()},l.prototype.contains=function(L){return this.heap.contains(L)},l.prototype.isEmpty=function(){return this.heap.isEmpty()},l.prototype.size=function(){return this.heap.size()},l.prototype.clear=function(){this.heap.clear()},l.prototype.forEach=function(L){this.heap.forEach(L)},l}();Je.default=j},643:(Tn,Je,R)=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});var u=R(6319),d=function(){function j(){this.list=new u.default}return j.prototype.enqueue=function(l){return this.list.add(l)},j.prototype.add=function(l){return this.list.add(l)},j.prototype.dequeue=function(){if(0!==this.list.size()){var l=this.list.first();return this.list.removeElementAtIndex(0),l}},j.prototype.peek=function(){if(0!==this.list.size())return this.list.first()},j.prototype.size=function(){return this.list.size()},j.prototype.contains=function(l,L){return this.list.contains(l,L)},j.prototype.isEmpty=function(){return this.list.size()<=0},j.prototype.clear=function(){this.list.clear()},j.prototype.forEach=function(l){this.list.forEach(l)},j}();Je.default=d},7299:(Tn,Je,R)=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});var u=R(3762),d=R(9630),j=R(9166),l=function(){function L(P){this.dictionary=new j.default(P)}return L.prototype.contains=function(P){return this.dictionary.containsKey(P)},L.prototype.add=function(P){return!this.contains(P)&&!u.isUndefined(P)&&(this.dictionary.setValue(P,P),!0)},L.prototype.intersection=function(P){var m=this;this.forEach(function($){return P.contains($)||m.remove($),!0})},L.prototype.union=function(P){var m=this;P.forEach(function($){return m.add($),!0})},L.prototype.difference=function(P){var m=this;P.forEach(function($){return m.remove($),!0})},L.prototype.isSubsetOf=function(P){if(this.size()>P.size())return!1;var m=!0;return this.forEach(function($){return!!P.contains($)||(m=!1,!1)}),m},L.prototype.remove=function(P){return!!this.contains(P)&&(this.dictionary.remove(P),!0)},L.prototype.forEach=function(P){this.dictionary.forEach(function(m,$){return P($)})},L.prototype.toArray=function(){return this.dictionary.values()},L.prototype.isEmpty=function(){return this.dictionary.isEmpty()},L.prototype.size=function(){return this.dictionary.size()},L.prototype.clear=function(){this.dictionary.clear()},L.prototype.toString=function(){return d.toString(this.toArray())},L}();Je.default=l},5095:(Tn,Je,R)=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});var u=R(6319),d=function(){function j(){this.list=new u.default}return j.prototype.push=function(l){return this.list.add(l,0)},j.prototype.add=function(l){return this.list.add(l,0)},j.prototype.pop=function(){return this.list.removeElementAtIndex(0)},j.prototype.peek=function(){return this.list.first()},j.prototype.size=function(){return this.list.size()},j.prototype.contains=function(l,L){return this.list.contains(l,L)},j.prototype.isEmpty=function(){return this.list.isEmpty()},j.prototype.clear=function(){this.list.clear()},j.prototype.forEach=function(l){this.list.forEach(l)},j}();Je.default=d},9630:(Tn,Je,R)=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});var u=R(3762);function d(K,re,_e){for(var ge=_e||u.defaultEquals,xe=K.length,je=0;je<xe;je++)if(ge(K[je],re))return je;return-1}Je.indexOf=d,Je.lastIndexOf=function j(K,re,_e){for(var ge=_e||u.defaultEquals,je=K.length-1;je>=0;je--)if(ge(K[je],re))return je;return-1},Je.contains=function l(K,re,_e){return d(K,re,_e)>=0},Je.remove=function L(K,re,_e){var ge=d(K,re,_e);return!(ge<0||(K.splice(ge,1),0))},Je.frequency=function P(K,re,_e){for(var ge=_e||u.defaultEquals,xe=K.length,je=0,nt=0;nt<xe;nt++)ge(K[nt],re)&&je++;return je},Je.equals=function m(K,re,_e){var ge=_e||u.defaultEquals;if(K.length!==re.length)return!1;for(var xe=K.length,je=0;je<xe;je++)if(!ge(K[je],re[je]))return!1;return!0},Je.copy=function $(K){return K.concat()},Je.swap=function ue(K,re,_e){if(re<0||re>=K.length||_e<0||_e>=K.length)return!1;var ge=K[re];return K[re]=K[_e],K[_e]=ge,!0},Je.toString=function V(K){return"["+K.toString()+"]"},Je.forEach=function Z(K,re){for(var _e=0,ge=K;_e<ge.length;_e++)if(!1===re(ge[_e]))return}},2210:(Tn,Je,R)=>{"use strict";R(9630),R(4577),R(3760),R(1206);var P=R(9166);Je.Xy=P.default,R(4876),R(3332),R(6319),R(7730),R(7008),R(7008),R(643),R(8806),R(7299),R(5095),R(3417),R(3762)},3762:(Tn,Je)=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});var R=Object.prototype.hasOwnProperty;function L(V){return"function"==typeof V}function P(V){return void 0===V}function m(V){return"[object String]"===Object.prototype.toString.call(V)}Je.has=function(V,Z){return R.call(V,Z)},Je.defaultCompare=function u(V,Z){return V<Z?-1:V===Z?0:1},Je.defaultEquals=function d(V,Z){return V===Z},Je.defaultToString=function j(V){return null===V?"COLLECTION_NULL":P(V)?"COLLECTION_UNDEFINED":m(V)?"$s"+V:"$o"+V.toString()},Je.makeString=function l(V,Z){if(void 0===Z&&(Z=","),null===V)return"COLLECTION_NULL";if(P(V))return"COLLECTION_UNDEFINED";if(m(V))return V.toString();var K="{",re=!0;for(var _e in V)Je.has(V,_e)&&(re?re=!1:K+=Z,K=K+_e+":"+V[_e]);return K+"}"},Je.isFunction=L,Je.isUndefined=P,Je.isString=m,Je.reverseCompareFunction=function $(V){return P(V)||!L(V)?function(Z,K){return Z<K?1:Z===K?0:-1}:function(Z,K){return-1*V(Z,K)}},Je.compareToEquals=function ue(V){return function(Z,K){return 0===V(Z,K)}}},863:(Tn,Je,R)=>{var u={"./ion-accordion_2.entry.js":[9654,8592,9654],"./ion-action-sheet.entry.js":[3648,8592,3648],"./ion-alert.entry.js":[1118,8592,1118],"./ion-app_8.entry.js":[53,8592,53],"./ion-avatar_3.entry.js":[4753,8592,4753],"./ion-back-button.entry.js":[2073,8592,2073],"./ion-backdrop.entry.js":[8939,8939],"./ion-breadcrumb_2.entry.js":[7544,8592,7544],"./ion-button_2.entry.js":[5652,8592,5652],"./ion-card_5.entry.js":[5929,8592,388],"./ion-checkbox.entry.js":[9922,8592,9922],"./ion-chip.entry.js":[657,8592,657],"./ion-col_3.entry.js":[9824,9824],"./ion-datetime_3.entry.js":[4959,8592,4959],"./ion-fab_3.entry.js":[5836,8592,5836],"./ion-img.entry.js":[1033,1033],"./ion-infinite-scroll_2.entry.js":[8034,8592,8034],"./ion-input.entry.js":[1217,8592,1217],"./ion-item-option_3.entry.js":[2933,8592,2933],"./ion-item_8.entry.js":[4711,8592,4711],"./ion-loading.entry.js":[9434,8592,9434],"./ion-menu_3.entry.js":[8136,8592,8136],"./ion-modal.entry.js":[2349,8592,2349],"./ion-nav_2.entry.js":[5349,8592,5349],"./ion-picker-column-internal.entry.js":[7602,8592,7602],"./ion-picker-internal.entry.js":[9016,9016],"./ion-popover.entry.js":[3804,8592,3804],"./ion-progress-bar.entry.js":[4174,8592,4174],"./ion-radio_2.entry.js":[4432,8592,4432],"./ion-range.entry.js":[3545,8592,1709],"./ion-refresher_2.entry.js":[3326,8592,3326],"./ion-reorder_2.entry.js":[3583,8592,3583],"./ion-ripple-effect.entry.js":[9958,9958],"./ion-route_4.entry.js":[4330,8592,4330],"./ion-searchbar.entry.js":[8628,8592,8628],"./ion-segment_2.entry.js":[9325,8592,9325],"./ion-select_3.entry.js":[2773,8592,2773],"./ion-slide_2.entry.js":[1650,1650],"./ion-spinner.entry.js":[4908,8592,4908],"./ion-split-pane.entry.js":[9536,9536],"./ion-tab-bar_2.entry.js":[438,8592,438],"./ion-tab_2.entry.js":[1536,8592,1536],"./ion-text.entry.js":[4376,8592,4376],"./ion-textarea.entry.js":[6560,8592,6560],"./ion-toast.entry.js":[6120,8592,6120],"./ion-toggle.entry.js":[5168,8592,5168],"./ion-virtual-scroll.entry.js":[2289,2289]};function d(j){if(!R.o(u,j))return Promise.resolve().then(()=>{var P=new Error("Cannot find module '"+j+"'");throw P.code="MODULE_NOT_FOUND",P});var l=u[j],L=l[0];return Promise.all(l.slice(1).map(R.e)).then(()=>R(L))}d.keys=()=>Object.keys(u),d.id=863,Tn.exports=d},6099:(Tn,Je,R)=>{"use strict";function u(j,l,L,P,m,$,ue){try{var V=j[$](ue),Z=V.value}catch(K){return void L(K)}V.done?l(Z):Promise.resolve(Z).then(P,m)}function d(j){return function(){var l=this,L=arguments;return new Promise(function(P,m){var $=j.apply(l,L);function ue(Z){u($,P,m,ue,V,"next",Z)}function V(Z){u($,P,m,ue,V,"throw",Z)}ue(void 0)})}}R.d(Je,{Z:()=>d})},6895:(Tn,Je,R)=>{"use strict";R.d(Je,{mr:()=>Fe,ez:()=>Fs,K0:()=>m,uU:()=>it,JJ:()=>ar,Do:()=>Ne,V_:()=>V,Ye:()=>$e,S$:()=>je,sg:()=>Pr,O5:()=>Ee,tP:()=>Ot,b0:()=>ke,lw:()=>$,EM:()=>uo,JF:()=>Qs,w_:()=>P,bD:()=>Ni,q:()=>j,Mx:()=>bi,HT:()=>L});var u=R(6738);let d=null;function j(){return d}function L(oe){d||(d=oe)}class P{}const m=new u.OlP("DocumentToken");let $=(()=>{class oe{historyGo(se){throw new Error("Not implemented")}}return oe.\u0275fac=function(se){return new(se||oe)},oe.\u0275prov=u.Yz7({token:oe,factory:function(){return function ue(){return(0,u.LFG)(Z)}()},providedIn:"platform"}),oe})();const V=new u.OlP("Location Initialized");let Z=(()=>{class oe extends ${constructor(se){super(),this._doc=se,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return j().getBaseHref(this._doc)}onPopState(se){const Le=j().getGlobalEventTarget(this._doc,"window");return Le.addEventListener("popstate",se,!1),()=>Le.removeEventListener("popstate",se)}onHashChange(se){const Le=j().getGlobalEventTarget(this._doc,"window");return Le.addEventListener("hashchange",se,!1),()=>Le.removeEventListener("hashchange",se)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(se){this.location.pathname=se}pushState(se,Le,Mt){K()?this._history.pushState(se,Le,Mt):this.location.hash=Mt}replaceState(se,Le,Mt){K()?this._history.replaceState(se,Le,Mt):this.location.hash=Mt}forward(){this._history.forward()}back(){this._history.back()}historyGo(se=0){this._history.go(se)}getState(){return this._history.state}}return oe.\u0275fac=function(se){return new(se||oe)(u.LFG(m))},oe.\u0275prov=u.Yz7({token:oe,factory:function(){return function re(){return new Z((0,u.LFG)(m))}()},providedIn:"platform"}),oe})();function K(){return!!window.history.pushState}function _e(oe,we){if(0==oe.length)return we;if(0==we.length)return oe;let se=0;return oe.endsWith("/")&&se++,we.startsWith("/")&&se++,2==se?oe+we.substring(1):1==se?oe+we:oe+"/"+we}function ge(oe){const we=oe.match(/#|\?|$/),se=we&&we.index||oe.length;return oe.slice(0,se-("/"===oe[se-1]?1:0))+oe.slice(se)}function xe(oe){return oe&&"?"!==oe[0]?"?"+oe:oe}let je=(()=>{class oe{historyGo(se){throw new Error("Not implemented")}}return oe.\u0275fac=function(se){return new(se||oe)},oe.\u0275prov=u.Yz7({token:oe,factory:function(){return function nt(oe){const we=(0,u.LFG)(m).location;return new ke((0,u.LFG)($),we&&we.origin||"")}()},providedIn:"root"}),oe})();const Fe=new u.OlP("appBaseHref");let ke=(()=>{class oe extends je{constructor(se,Le){if(super(),this._platformLocation=se,this._removeListenerFns=[],null==Le&&(Le=this._platformLocation.getBaseHrefFromDOM()),null==Le)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=Le}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(se){this._removeListenerFns.push(this._platformLocation.onPopState(se),this._platformLocation.onHashChange(se))}getBaseHref(){return this._baseHref}prepareExternalUrl(se){return _e(this._baseHref,se)}path(se=!1){const Le=this._platformLocation.pathname+xe(this._platformLocation.search),Mt=this._platformLocation.hash;return Mt&&se?`${Le}${Mt}`:Le}pushState(se,Le,Mt,an){const Bn=this.prepareExternalUrl(Mt+xe(an));this._platformLocation.pushState(se,Le,Bn)}replaceState(se,Le,Mt,an){const Bn=this.prepareExternalUrl(Mt+xe(an));this._platformLocation.replaceState(se,Le,Bn)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(se=0){this._platformLocation.historyGo?.(se)}}return oe.\u0275fac=function(se){return new(se||oe)(u.LFG($),u.LFG(Fe,8))},oe.\u0275prov=u.Yz7({token:oe,factory:oe.\u0275fac}),oe})(),Ne=(()=>{class oe extends je{constructor(se,Le){super(),this._platformLocation=se,this._baseHref="",this._removeListenerFns=[],null!=Le&&(this._baseHref=Le)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(se){this._removeListenerFns.push(this._platformLocation.onPopState(se),this._platformLocation.onHashChange(se))}getBaseHref(){return this._baseHref}path(se=!1){let Le=this._platformLocation.hash;return null==Le&&(Le="#"),Le.length>0?Le.substring(1):Le}prepareExternalUrl(se){const Le=_e(this._baseHref,se);return Le.length>0?"#"+Le:Le}pushState(se,Le,Mt,an){let Bn=this.prepareExternalUrl(Mt+xe(an));0==Bn.length&&(Bn=this._platformLocation.pathname),this._platformLocation.pushState(se,Le,Bn)}replaceState(se,Le,Mt,an){let Bn=this.prepareExternalUrl(Mt+xe(an));0==Bn.length&&(Bn=this._platformLocation.pathname),this._platformLocation.replaceState(se,Le,Bn)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(se=0){this._platformLocation.historyGo?.(se)}}return oe.\u0275fac=function(se){return new(se||oe)(u.LFG($),u.LFG(Fe,8))},oe.\u0275prov=u.Yz7({token:oe,factory:oe.\u0275fac}),oe})(),$e=(()=>{class oe{constructor(se,Le){this._subject=new u.vpe,this._urlChangeListeners=[],this._platformStrategy=se;const Mt=this._platformStrategy.getBaseHref();this._platformLocation=Le,this._baseHref=ge(Ge(Mt)),this._platformStrategy.onPopState(an=>{this._subject.emit({url:this.path(!0),pop:!0,state:an.state,type:an.type})})}path(se=!1){return this.normalize(this._platformStrategy.path(se))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(se,Le=""){return this.path()==this.normalize(se+xe(Le))}normalize(se){return oe.stripTrailingSlash(function _t(oe,we){return oe&&we.startsWith(oe)?we.substring(oe.length):we}(this._baseHref,Ge(se)))}prepareExternalUrl(se){return se&&"/"!==se[0]&&(se="/"+se),this._platformStrategy.prepareExternalUrl(se)}go(se,Le="",Mt=null){this._platformStrategy.pushState(Mt,"",se,Le),this._notifyUrlChangeListeners(this.prepareExternalUrl(se+xe(Le)),Mt)}replaceState(se,Le="",Mt=null){this._platformStrategy.replaceState(Mt,"",se,Le),this._notifyUrlChangeListeners(this.prepareExternalUrl(se+xe(Le)),Mt)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(se=0){this._platformStrategy.historyGo?.(se)}onUrlChange(se){this._urlChangeListeners.push(se),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(Le=>{this._notifyUrlChangeListeners(Le.url,Le.state)}))}_notifyUrlChangeListeners(se="",Le){this._urlChangeListeners.forEach(Mt=>Mt(se,Le))}subscribe(se,Le,Mt){return this._subject.subscribe({next:se,error:Le,complete:Mt})}}return oe.normalizeQueryParams=xe,oe.joinWithSlash=_e,oe.stripTrailingSlash=ge,oe.\u0275fac=function(se){return new(se||oe)(u.LFG(je),u.LFG($))},oe.\u0275prov=u.Yz7({token:oe,factory:function(){return function Re(){return new $e((0,u.LFG)(je),(0,u.LFG)($))}()},providedIn:"root"}),oe})();function Ge(oe){return oe.replace(/\/index.html$/,"")}var yt=(()=>((yt=yt||{})[yt.Decimal=0]="Decimal",yt[yt.Percent=1]="Percent",yt[yt.Currency=2]="Currency",yt[yt.Scientific=3]="Scientific",yt))(),wt=(()=>((wt=wt||{})[wt.Zero=0]="Zero",wt[wt.One=1]="One",wt[wt.Two=2]="Two",wt[wt.Few=3]="Few",wt[wt.Many=4]="Many",wt[wt.Other=5]="Other",wt))(),xt=(()=>((xt=xt||{})[xt.Format=0]="Format",xt[xt.Standalone=1]="Standalone",xt))(),dt=(()=>((dt=dt||{})[dt.Narrow=0]="Narrow",dt[dt.Abbreviated=1]="Abbreviated",dt[dt.Wide=2]="Wide",dt[dt.Short=3]="Short",dt))(),At=(()=>((At=At||{})[At.Short=0]="Short",At[At.Medium=1]="Medium",At[At.Long=2]="Long",At[At.Full=3]="Full",At))(),Vt=(()=>((Vt=Vt||{})[Vt.Decimal=0]="Decimal",Vt[Vt.Group=1]="Group",Vt[Vt.List=2]="List",Vt[Vt.PercentSign=3]="PercentSign",Vt[Vt.PlusSign=4]="PlusSign",Vt[Vt.MinusSign=5]="MinusSign",Vt[Vt.Exponential=6]="Exponential",Vt[Vt.SuperscriptingExponent=7]="SuperscriptingExponent",Vt[Vt.PerMille=8]="PerMille",Vt[Vt.Infinity=9]="Infinity",Vt[Vt.NaN=10]="NaN",Vt[Vt.TimeSeparator=11]="TimeSeparator",Vt[Vt.CurrencyDecimal=12]="CurrencyDecimal",Vt[Vt.CurrencyGroup=13]="CurrencyGroup",Vt))();function Yt(oe,we){return _i((0,u.cg1)(oe)[u.wAp.DateFormat],we)}function qt(oe,we){return _i((0,u.cg1)(oe)[u.wAp.TimeFormat],we)}function Gt(oe,we){return _i((0,u.cg1)(oe)[u.wAp.DateTimeFormat],we)}function ft(oe,we){const se=(0,u.cg1)(oe),Le=se[u.wAp.NumberSymbols][we];if(void 0===Le){if(we===Vt.CurrencyDecimal)return se[u.wAp.NumberSymbols][Vt.Decimal];if(we===Vt.CurrencyGroup)return se[u.wAp.NumberSymbols][Vt.Group]}return Le}const $i=u.kL8;function sr(oe){if(!oe[u.wAp.ExtraData])throw new Error(`Missing extra locale data for the locale "${oe[u.wAp.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function _i(oe,we){for(let se=we;se>-1;se--)if(void 0!==oe[se])return oe[se];throw new Error("Locale data API: locale data undefined")}function xi(oe){const[we,se]=oe.split(":");return{hours:+we,minutes:+se}}const Ae=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,ut={},Pe=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Nt=(()=>((Nt=Nt||{})[Nt.Short=0]="Short",Nt[Nt.ShortGMT=1]="ShortGMT",Nt[Nt.Long=2]="Long",Nt[Nt.Extended=3]="Extended",Nt))(),me=(()=>((me=me||{})[me.FullYear=0]="FullYear",me[me.Month=1]="Month",me[me.Date=2]="Date",me[me.Hours=3]="Hours",me[me.Minutes=4]="Minutes",me[me.Seconds=5]="Seconds",me[me.FractionalSeconds=6]="FractionalSeconds",me[me.Day=7]="Day",me))(),qe=(()=>((qe=qe||{})[qe.DayPeriods=0]="DayPeriods",qe[qe.Days=1]="Days",qe[qe.Months=2]="Months",qe[qe.Eras=3]="Eras",qe))();function Rt(oe,we,se,Le){let Mt=function mt(oe){if(Xe(oe))return oe;if("number"==typeof oe&&!isNaN(oe))return new Date(oe);if("string"==typeof oe){if(oe=oe.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(oe)){const[Mt,an=1,Bn=1]=oe.split("-").map(Wn=>+Wn);return Xt(Mt,an-1,Bn)}const se=parseFloat(oe);if(!isNaN(oe-se))return new Date(se);let Le;if(Le=oe.match(Ae))return function Dt(oe){const we=new Date(0);let se=0,Le=0;const Mt=oe[8]?we.setUTCFullYear:we.setFullYear,an=oe[8]?we.setUTCHours:we.setHours;oe[9]&&(se=Number(oe[9]+oe[10]),Le=Number(oe[9]+oe[11])),Mt.call(we,Number(oe[1]),Number(oe[2])-1,Number(oe[3]));const Bn=Number(oe[4]||0)-se,Wn=Number(oe[5]||0)-Le,yr=Number(oe[6]||0),Dr=Math.floor(1e3*parseFloat("0."+(oe[7]||0)));return an.call(we,Bn,Wn,yr,Dr),we}(Le)}const we=new Date(oe);if(!Xe(we))throw new Error(`Unable to convert "${oe}" into a date`);return we}(oe);we=Xn(se,we)||we;let Wn,Bn=[];for(;we;){if(Wn=Pe.exec(we),!Wn){Bn.push(we);break}{Bn=Bn.concat(Wn.slice(1));const Oi=Bn.pop();if(!Oi)break;we=Oi}}let yr=Mt.getTimezoneOffset();Le&&(yr=he(Le,yr),Mt=function We(oe,we,se){const Le=se?-1:1,Mt=oe.getTimezoneOffset();return function Te(oe,we){return(oe=new Date(oe.getTime())).setMinutes(oe.getMinutes()+we),oe}(oe,Le*(he(we,Mt)-Mt))}(Mt,Le,!0));let Dr="";return Bn.forEach(Oi=>{const dr=function F(oe){if(X[oe])return X[oe];let we;switch(oe){case"G":case"GG":case"GGG":we=Vi(qe.Eras,dt.Abbreviated);break;case"GGGG":we=Vi(qe.Eras,dt.Wide);break;case"GGGGG":we=Vi(qe.Eras,dt.Narrow);break;case"y":we=fi(me.FullYear,1,0,!1,!0);break;case"yy":we=fi(me.FullYear,2,0,!0,!0);break;case"yyy":we=fi(me.FullYear,3,0,!1,!0);break;case"yyyy":we=fi(me.FullYear,4,0,!1,!0);break;case"Y":we=ie(1);break;case"YY":we=ie(2,!0);break;case"YYY":we=ie(3);break;case"YYYY":we=ie(4);break;case"M":case"L":we=fi(me.Month,1,1);break;case"MM":case"LL":we=fi(me.Month,2,1);break;case"MMM":we=Vi(qe.Months,dt.Abbreviated);break;case"MMMM":we=Vi(qe.Months,dt.Wide);break;case"MMMMM":we=Vi(qe.Months,dt.Narrow);break;case"LLL":we=Vi(qe.Months,dt.Abbreviated,xt.Standalone);break;case"LLLL":we=Vi(qe.Months,dt.Wide,xt.Standalone);break;case"LLLLL":we=Vi(qe.Months,dt.Narrow,xt.Standalone);break;case"w":we=tr(1);break;case"ww":we=tr(2);break;case"W":we=tr(1,!0);break;case"d":we=fi(me.Date,1);break;case"dd":we=fi(me.Date,2);break;case"c":case"cc":we=fi(me.Day,1);break;case"ccc":we=Vi(qe.Days,dt.Abbreviated,xt.Standalone);break;case"cccc":we=Vi(qe.Days,dt.Wide,xt.Standalone);break;case"ccccc":we=Vi(qe.Days,dt.Narrow,xt.Standalone);break;case"cccccc":we=Vi(qe.Days,dt.Short,xt.Standalone);break;case"E":case"EE":case"EEE":we=Vi(qe.Days,dt.Abbreviated);break;case"EEEE":we=Vi(qe.Days,dt.Wide);break;case"EEEEE":we=Vi(qe.Days,dt.Narrow);break;case"EEEEEE":we=Vi(qe.Days,dt.Short);break;case"a":case"aa":case"aaa":we=Vi(qe.DayPeriods,dt.Abbreviated);break;case"aaaa":we=Vi(qe.DayPeriods,dt.Wide);break;case"aaaaa":we=Vi(qe.DayPeriods,dt.Narrow);break;case"b":case"bb":case"bbb":we=Vi(qe.DayPeriods,dt.Abbreviated,xt.Standalone,!0);break;case"bbbb":we=Vi(qe.DayPeriods,dt.Wide,xt.Standalone,!0);break;case"bbbbb":we=Vi(qe.DayPeriods,dt.Narrow,xt.Standalone,!0);break;case"B":case"BB":case"BBB":we=Vi(qe.DayPeriods,dt.Abbreviated,xt.Format,!0);break;case"BBBB":we=Vi(qe.DayPeriods,dt.Wide,xt.Format,!0);break;case"BBBBB":we=Vi(qe.DayPeriods,dt.Narrow,xt.Format,!0);break;case"h":we=fi(me.Hours,1,-12);break;case"hh":we=fi(me.Hours,2,-12);break;case"H":we=fi(me.Hours,1);break;case"HH":we=fi(me.Hours,2);break;case"m":we=fi(me.Minutes,1);break;case"mm":we=fi(me.Minutes,2);break;case"s":we=fi(me.Seconds,1);break;case"ss":we=fi(me.Seconds,2);break;case"S":we=fi(me.FractionalSeconds,1);break;case"SS":we=fi(me.FractionalSeconds,2);break;case"SSS":we=fi(me.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":we=Pi(Nt.Short);break;case"ZZZZZ":we=Pi(Nt.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":we=Pi(Nt.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":we=Pi(Nt.Long);break;default:return null}return X[oe]=we,we}(Oi);Dr+=dr?dr(Mt,se,yr):"''"===Oi?"'":Oi.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),Dr}function Xt(oe,we,se){const Le=new Date(0);return Le.setFullYear(oe,we,se),Le.setHours(0,0,0),Le}function Xn(oe,we){const se=function St(oe){return(0,u.cg1)(oe)[u.wAp.LocaleId]}(oe);if(ut[se]=ut[se]||{},ut[se][we])return ut[se][we];let Le="";switch(we){case"shortDate":Le=Yt(oe,At.Short);break;case"mediumDate":Le=Yt(oe,At.Medium);break;case"longDate":Le=Yt(oe,At.Long);break;case"fullDate":Le=Yt(oe,At.Full);break;case"shortTime":Le=qt(oe,At.Short);break;case"mediumTime":Le=qt(oe,At.Medium);break;case"longTime":Le=qt(oe,At.Long);break;case"fullTime":Le=qt(oe,At.Full);break;case"short":const Mt=Xn(oe,"shortTime"),an=Xn(oe,"shortDate");Le=Ki(Gt(oe,At.Short),[Mt,an]);break;case"medium":const Bn=Xn(oe,"mediumTime"),Wn=Xn(oe,"mediumDate");Le=Ki(Gt(oe,At.Medium),[Bn,Wn]);break;case"long":const yr=Xn(oe,"longTime"),Dr=Xn(oe,"longDate");Le=Ki(Gt(oe,At.Long),[yr,Dr]);break;case"full":const Oi=Xn(oe,"fullTime"),dr=Xn(oe,"fullDate");Le=Ki(Gt(oe,At.Full),[Oi,dr])}return Le&&(ut[se][we]=Le),Le}function Ki(oe,we){return we&&(oe=oe.replace(/\{([^}]+)}/g,function(se,Le){return null!=we&&Le in we?we[Le]:se})),oe}function Di(oe,we,se="-",Le,Mt){let an="";(oe<0||Mt&&oe<=0)&&(Mt?oe=1-oe:(oe=-oe,an=se));let Bn=String(oe);for(;Bn.length<we;)Bn="0"+Bn;return Le&&(Bn=Bn.substr(Bn.length-we)),an+Bn}function fi(oe,we,se=0,Le=!1,Mt=!1){return function(an,Bn){let Wn=function Cr(oe,we){switch(oe){case me.FullYear:return we.getFullYear();case me.Month:return we.getMonth();case me.Date:return we.getDate();case me.Hours:return we.getHours();case me.Minutes:return we.getMinutes();case me.Seconds:return we.getSeconds();case me.FractionalSeconds:return we.getMilliseconds();case me.Day:return we.getDay();default:throw new Error(`Unknown DateType value "${oe}".`)}}(oe,an);if((se>0||Wn>-se)&&(Wn+=se),oe===me.Hours)0===Wn&&-12===se&&(Wn=12);else if(oe===me.FractionalSeconds)return function gi(oe,we){return Di(oe,3).substr(0,we)}(Wn,we);const yr=ft(Bn,Vt.MinusSign);return Di(Wn,we,yr,Le,Mt)}}function Vi(oe,we,se=xt.Format,Le=!1){return function(Mt,an){return function gr(oe,we,se,Le,Mt,an){switch(se){case qe.Months:return function Ht(oe,we,se){const Le=(0,u.cg1)(oe),an=_i([Le[u.wAp.MonthsFormat],Le[u.wAp.MonthsStandalone]],we);return _i(an,se)}(we,Mt,Le)[oe.getMonth()];case qe.Days:return function zt(oe,we,se){const Le=(0,u.cg1)(oe),an=_i([Le[u.wAp.DaysFormat],Le[u.wAp.DaysStandalone]],we);return _i(an,se)}(we,Mt,Le)[oe.getDay()];case qe.DayPeriods:const Bn=oe.getHours(),Wn=oe.getMinutes();if(an){const Dr=function zi(oe){const we=(0,u.cg1)(oe);return sr(we),(we[u.wAp.ExtraData][2]||[]).map(Le=>"string"==typeof Le?xi(Le):[xi(Le[0]),xi(Le[1])])}(we),Oi=function yi(oe,we,se){const Le=(0,u.cg1)(oe);sr(Le);const an=_i([Le[u.wAp.ExtraData][0],Le[u.wAp.ExtraData][1]],we)||[];return _i(an,se)||[]}(we,Mt,Le),dr=Dr.findIndex(jr=>{if(Array.isArray(jr)){const[ae,ee]=jr,Q=Bn>=ae.hours&&Wn>=ae.minutes,Oe=Bn<ee.hours||Bn===ee.hours&&Wn<ee.minutes;if(ae.hours<ee.hours){if(Q&&Oe)return!0}else if(Q||Oe)return!0}else if(jr.hours===Bn&&jr.minutes===Wn)return!0;return!1});if(-1!==dr)return Oi[dr]}return function $t(oe,we,se){const Le=(0,u.cg1)(oe),an=_i([Le[u.wAp.DayPeriodsFormat],Le[u.wAp.DayPeriodsStandalone]],we);return _i(an,se)}(we,Mt,Le)[Bn<12?0:1];case qe.Eras:return function en(oe,we){return _i((0,u.cg1)(oe)[u.wAp.Eras],we)}(we,Le)[oe.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${se}`)}}(Mt,an,oe,we,se,Le)}}function Pi(oe){return function(we,se,Le){const Mt=-1*Le,an=ft(se,Vt.MinusSign),Bn=Mt>0?Math.floor(Mt/60):Math.ceil(Mt/60);switch(oe){case Nt.Short:return(Mt>=0?"+":"")+Di(Bn,2,an)+Di(Math.abs(Mt%60),2,an);case Nt.ShortGMT:return"GMT"+(Mt>=0?"+":"")+Di(Bn,1,an);case Nt.Long:return"GMT"+(Mt>=0?"+":"")+Di(Bn,2,an)+":"+Di(Math.abs(Mt%60),2,an);case Nt.Extended:return 0===Le?"Z":(Mt>=0?"+":"")+Di(Bn,2,an)+":"+Di(Math.abs(Mt%60),2,an);default:throw new Error(`Unknown zone width "${oe}"`)}}}function _n(oe){return Xt(oe.getFullYear(),oe.getMonth(),oe.getDate()+(4-oe.getDay()))}function tr(oe,we=!1){return function(se,Le){let Mt;if(we){const an=new Date(se.getFullYear(),se.getMonth(),1).getDay()-1,Bn=se.getDate();Mt=1+Math.floor((Bn+an)/7)}else{const an=_n(se),Bn=function Rr(oe){const we=Xt(oe,0,1).getDay();return Xt(oe,0,1+(we<=4?4:11)-we)}(an.getFullYear()),Wn=an.getTime()-Bn.getTime();Mt=1+Math.round(Wn/6048e5)}return Di(Mt,oe,ft(Le,Vt.MinusSign))}}function ie(oe,we=!1){return function(se,Le){return Di(_n(se).getFullYear(),oe,ft(Le,Vt.MinusSign),we)}}const X={};function he(oe,we){oe=oe.replace(/:/g,"");const se=Date.parse("Jan 01, 1970 00:00:00 "+oe)/6e4;return isNaN(se)?we:se}function Xe(oe){return oe instanceof Date&&!isNaN(oe.valueOf())}const kt=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function oi(oe){const we=parseInt(oe);if(isNaN(we))throw new Error("Invalid integer literal when parsing "+oe);return we}class _r{}let Nr=(()=>{class oe extends _r{constructor(se){super(),this.locale=se}getPluralCategory(se,Le){switch($i(Le||this.locale)(se)){case wt.Zero:return"zero";case wt.One:return"one";case wt.Two:return"two";case wt.Few:return"few";case wt.Many:return"many";default:return"other"}}}return oe.\u0275fac=function(se){return new(se||oe)(u.LFG(u.soG))},oe.\u0275prov=u.Yz7({token:oe,factory:oe.\u0275fac}),oe})();function bi(oe,we){we=encodeURIComponent(we);for(const se of oe.split(";")){const Le=se.indexOf("="),[Mt,an]=-1==Le?[se,""]:[se.slice(0,Le),se.slice(Le+1)];if(Mt.trim()===we)return decodeURIComponent(an)}return null}class Jr{constructor(we,se,Le,Mt){this.$implicit=we,this.ngForOf=se,this.index=Le,this.count=Mt}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Pr=(()=>{class oe{constructor(se,Le,Mt){this._viewContainer=se,this._template=Le,this._differs=Mt,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(se){this._ngForOf=se,this._ngForOfDirty=!0}set ngForTrackBy(se){this._trackByFn=se}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(se){se&&(this._template=se)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const se=this._ngForOf;!this._differ&&se&&(this._differ=this._differs.find(se).create(this.ngForTrackBy))}if(this._differ){const se=this._differ.diff(this._ngForOf);se&&this._applyChanges(se)}}_applyChanges(se){const Le=this._viewContainer;se.forEachOperation((Mt,an,Bn)=>{if(null==Mt.previousIndex)Le.createEmbeddedView(this._template,new Jr(Mt.item,this._ngForOf,-1,-1),null===Bn?void 0:Bn);else if(null==Bn)Le.remove(null===an?void 0:an);else if(null!==an){const Wn=Le.get(an);Le.move(Wn,Bn),Lr(Wn,Mt)}});for(let Mt=0,an=Le.length;Mt<an;Mt++){const Wn=Le.get(Mt).context;Wn.index=Mt,Wn.count=an,Wn.ngForOf=this._ngForOf}se.forEachIdentityChange(Mt=>{Lr(Le.get(Mt.currentIndex),Mt)})}static ngTemplateContextGuard(se,Le){return!0}}return oe.\u0275fac=function(se){return new(se||oe)(u.Y36(u.s_b),u.Y36(u.Rgc),u.Y36(u.ZZ4))},oe.\u0275dir=u.lG2({type:oe,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),oe})();function Lr(oe,we){oe.context.$implicit=we.item}let Ee=(()=>{class oe{constructor(se,Le){this._viewContainer=se,this._context=new He,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=Le}set ngIf(se){this._context.$implicit=this._context.ngIf=se,this._updateView()}set ngIfThen(se){Ce("ngIfThen",se),this._thenTemplateRef=se,this._thenViewRef=null,this._updateView()}set ngIfElse(se){Ce("ngIfElse",se),this._elseTemplateRef=se,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(se,Le){return!0}}return oe.\u0275fac=function(se){return new(se||oe)(u.Y36(u.s_b),u.Y36(u.Rgc))},oe.\u0275dir=u.lG2({type:oe,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),oe})();class He{constructor(){this.$implicit=null,this.ngIf=null}}function Ce(oe,we){if(we&&!we.createEmbeddedView)throw new Error(`${oe} must be a TemplateRef, but received '${(0,u.AaK)(we)}'.`)}let Ot=(()=>{class oe{constructor(se){this._viewContainerRef=se,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null}ngOnChanges(se){if(se.ngTemplateOutlet){const Le=this._viewContainerRef;this._viewRef&&Le.remove(Le.indexOf(this._viewRef)),this._viewRef=this.ngTemplateOutlet?Le.createEmbeddedView(this.ngTemplateOutlet,this.ngTemplateOutletContext):null}else this._viewRef&&se.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return oe.\u0275fac=function(se){return new(se||oe)(u.Y36(u.s_b))},oe.\u0275dir=u.lG2({type:oe,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet"},features:[u.TTD]}),oe})();function ki(oe,we){return new u.vHH(2100,"")}const Oo=new u.OlP("DATE_PIPE_DEFAULT_TIMEZONE");let it=(()=>{class oe{constructor(se,Le){this.locale=se,this.defaultTimezone=Le}transform(se,Le="mediumDate",Mt,an){if(null==se||""===se||se!=se)return null;try{return Rt(se,Le,an||this.locale,Mt??this.defaultTimezone??void 0)}catch(Bn){throw ki()}}}return oe.\u0275fac=function(se){return new(se||oe)(u.Y36(u.soG,16),u.Y36(Oo,24))},oe.\u0275pipe=u.Yjl({name:"date",type:oe,pure:!0}),oe})(),ar=(()=>{class oe{constructor(se){this._locale=se}transform(se,Le,Mt){if(!function cs(oe){return!(null==oe||""===oe||oe!=oe)}(se))return null;Mt=Mt||this._locale;try{return function Mn(oe,we,se){return function Ui(oe,we,se,Le,Mt,an,Bn=!1){let Wn="",yr=!1;if(isFinite(oe)){let Dr=function Zi(oe){let Le,Mt,an,Bn,Wn,we=Math.abs(oe)+"",se=0;for((Mt=we.indexOf("."))>-1&&(we=we.replace(".","")),(an=we.search(/e/i))>0?(Mt<0&&(Mt=an),Mt+=+we.slice(an+1),we=we.substring(0,an)):Mt<0&&(Mt=we.length),an=0;"0"===we.charAt(an);an++);if(an===(Wn=we.length))Le=[0],Mt=1;else{for(Wn--;"0"===we.charAt(Wn);)Wn--;for(Mt-=an,Le=[],Bn=0;an<=Wn;an++,Bn++)Le[Bn]=Number(we.charAt(an))}return Mt>22&&(Le=Le.splice(0,21),se=Mt-1,Mt=1),{digits:Le,exponent:se,integerLen:Mt}}(oe);Bn&&(Dr=function Ii(oe){if(0===oe.digits[0])return oe;const we=oe.digits.length-oe.integerLen;return oe.exponent?oe.exponent+=2:(0===we?oe.digits.push(0,0):1===we&&oe.digits.push(0),oe.integerLen+=2),oe}(Dr));let Oi=we.minInt,dr=we.minFrac,jr=we.maxFrac;if(an){const ti=an.match(kt);if(null===ti)throw new Error(`${an} is not a valid digit info`);const Ir=ti[1],xr=ti[3],Wo=ti[5];null!=Ir&&(Oi=oi(Ir)),null!=xr&&(dr=oi(xr)),null!=Wo?jr=oi(Wo):null!=xr&&dr>jr&&(jr=dr)}!function cr(oe,we,se){if(we>se)throw new Error(`The minimum number of digits after fraction (${we}) is higher than the maximum (${se}).`);let Le=oe.digits,Mt=Le.length-oe.integerLen;const an=Math.min(Math.max(we,Mt),se);let Bn=an+oe.integerLen,Wn=Le[Bn];if(Bn>0){Le.splice(Math.max(oe.integerLen,Bn));for(let dr=Bn;dr<Le.length;dr++)Le[dr]=0}else{Mt=Math.max(0,Mt),oe.integerLen=1,Le.length=Math.max(1,Bn=an+1),Le[0]=0;for(let dr=1;dr<Bn;dr++)Le[dr]=0}if(Wn>=5)if(Bn-1<0){for(let dr=0;dr>Bn;dr--)Le.unshift(0),oe.integerLen++;Le.unshift(1),oe.integerLen++}else Le[Bn-1]++;for(;Mt<Math.max(0,an);Mt++)Le.push(0);let yr=0!==an;const Dr=we+oe.integerLen,Oi=Le.reduceRight(function(dr,jr,ae,ee){return ee[ae]=(jr+=dr)<10?jr:jr-10,yr&&(0===ee[ae]&&ae>=Dr?ee.pop():yr=!1),jr>=10?1:0},0);Oi&&(Le.unshift(Oi),oe.integerLen++)}(Dr,dr,jr);let ae=Dr.digits,ee=Dr.integerLen;const Q=Dr.exponent;let Oe=[];for(yr=ae.every(ti=>!ti);ee<Oi;ee++)ae.unshift(0);for(;ee<0;ee++)ae.unshift(0);ee>0?Oe=ae.splice(ee,ae.length):(Oe=ae,ae=[0]);const hn=[];for(ae.length>=we.lgSize&&hn.unshift(ae.splice(-we.lgSize,ae.length).join(""));ae.length>we.gSize;)hn.unshift(ae.splice(-we.gSize,ae.length).join(""));ae.length&&hn.unshift(ae.join("")),Wn=hn.join(ft(se,Le)),Oe.length&&(Wn+=ft(se,Mt)+Oe.join("")),Q&&(Wn+=ft(se,Vt.Exponential)+"+"+Q)}else Wn=ft(se,Vt.Infinity);return Wn=oe<0&&!yr?we.negPre+Wn+we.negSuf:we.posPre+Wn+we.posSuf,Wn}(oe,function mi(oe,we="-"){const se={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},Le=oe.split(";"),Mt=Le[0],an=Le[1],Bn=-1!==Mt.indexOf(".")?Mt.split("."):[Mt.substring(0,Mt.lastIndexOf("0")+1),Mt.substring(Mt.lastIndexOf("0")+1)],Wn=Bn[0],yr=Bn[1]||"";se.posPre=Wn.substr(0,Wn.indexOf("#"));for(let Oi=0;Oi<yr.length;Oi++){const dr=yr.charAt(Oi);"0"===dr?se.minFrac=se.maxFrac=Oi+1:"#"===dr?se.maxFrac=Oi+1:se.posSuf+=dr}const Dr=Wn.split(",");if(se.gSize=Dr[1]?Dr[1].length:0,se.lgSize=Dr[2]||Dr[1]?(Dr[2]||Dr[1]).length:0,an){const Oi=Mt.length-se.posPre.length-se.posSuf.length,dr=an.indexOf("#");se.negPre=an.substr(0,dr).replace(/'/g,""),se.negSuf=an.substr(dr+Oi).replace(/'/g,"")}else se.negPre=we+se.posPre,se.negSuf=se.posSuf;return se}(function Ut(oe,we){return(0,u.cg1)(oe)[u.wAp.NumberFormats][we]}(we,yt.Decimal),ft(we,Vt.MinusSign)),we,Vt.Group,Vt.Decimal,se)}(function Io(oe){if("string"==typeof oe&&!isNaN(Number(oe)-parseFloat(oe)))return Number(oe);if("number"!=typeof oe)throw new Error(`${oe} is not a number`);return oe}(se),Mt,Le)}catch(an){throw ki()}}}return oe.\u0275fac=function(se){return new(se||oe)(u.Y36(u.soG,16))},oe.\u0275pipe=u.Yjl({name:"number",type:oe,pure:!0}),oe})();let Fs=(()=>{class oe{}return oe.\u0275fac=function(se){return new(se||oe)},oe.\u0275mod=u.oAB({type:oe}),oe.\u0275inj=u.cJS({providers:[{provide:_r,useClass:Nr}]}),oe})();const Ni="browser";let uo=(()=>{class oe{}return oe.\u0275prov=(0,u.Yz7)({token:oe,providedIn:"root",factory:()=>new Mo((0,u.LFG)(m),window)}),oe})();class Mo{constructor(we,se){this.document=we,this.window=se,this.offset=()=>[0,0]}setOffset(we){this.offset=Array.isArray(we)?()=>we:we}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(we){this.supportsScrolling()&&this.window.scrollTo(we[0],we[1])}scrollToAnchor(we){if(!this.supportsScrolling())return;const se=function xo(oe,we){const se=oe.getElementById(we)||oe.getElementsByName(we)[0];if(se)return se;if("function"==typeof oe.createTreeWalker&&oe.body&&(oe.body.createShadowRoot||oe.body.attachShadow)){const Le=oe.createTreeWalker(oe.body,NodeFilter.SHOW_ELEMENT);let Mt=Le.currentNode;for(;Mt;){const an=Mt.shadowRoot;if(an){const Bn=an.getElementById(we)||an.querySelector(`[name="${we}"]`);if(Bn)return Bn}Mt=Le.nextNode()}}return null}(this.document,we);se&&(this.scrollToElement(se),se.focus())}setHistoryScrollRestoration(we){if(this.supportScrollRestoration()){const se=this.window.history;se&&se.scrollRestoration&&(se.scrollRestoration=we)}}scrollToElement(we){const se=we.getBoundingClientRect(),Le=se.left+this.window.pageXOffset,Mt=se.top+this.window.pageYOffset,an=this.offset();this.window.scrollTo(Le-an[0],Mt-an[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const we=ns(this.window.history)||ns(Object.getPrototypeOf(this.window.history));return!(!we||!we.writable&&!we.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function ns(oe){return Object.getOwnPropertyDescriptor(oe,"scrollRestoration")}class Qs{}},529:(Tn,Je,R)=>{"use strict";R.d(Je,{TP:()=>St,eN:()=>Vt,JF:()=>_i,WM:()=>V});var u=R(6895),d=R(6738),j=R(1086),l=R(2916),L=R(1406),P=R(2198),m=R(4850);class ${}class ue{}class V{constructor(te){this.normalizedNames=new Map,this.lazyUpdate=null,te?this.lazyInit="string"==typeof te?()=>{this.headers=new Map,te.split("\n").forEach(Ae=>{const ut=Ae.indexOf(":");if(ut>0){const Pe=Ae.slice(0,ut),Nt=Pe.toLowerCase(),me=Ae.slice(ut+1).trim();this.maybeSetNormalizedName(Pe,Nt),this.headers.has(Nt)?this.headers.get(Nt).push(me):this.headers.set(Nt,[me])}})}:()=>{this.headers=new Map,Object.keys(te).forEach(Ae=>{let ut=te[Ae];const Pe=Ae.toLowerCase();"string"==typeof ut&&(ut=[ut]),ut.length>0&&(this.headers.set(Pe,ut),this.maybeSetNormalizedName(Ae,Pe))})}:this.headers=new Map}has(te){return this.init(),this.headers.has(te.toLowerCase())}get(te){this.init();const Ae=this.headers.get(te.toLowerCase());return Ae&&Ae.length>0?Ae[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(te){return this.init(),this.headers.get(te.toLowerCase())||null}append(te,Ae){return this.clone({name:te,value:Ae,op:"a"})}set(te,Ae){return this.clone({name:te,value:Ae,op:"s"})}delete(te,Ae){return this.clone({name:te,value:Ae,op:"d"})}maybeSetNormalizedName(te,Ae){this.normalizedNames.has(Ae)||this.normalizedNames.set(Ae,te)}init(){this.lazyInit&&(this.lazyInit instanceof V?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(te=>this.applyUpdate(te)),this.lazyUpdate=null))}copyFrom(te){te.init(),Array.from(te.headers.keys()).forEach(Ae=>{this.headers.set(Ae,te.headers.get(Ae)),this.normalizedNames.set(Ae,te.normalizedNames.get(Ae))})}clone(te){const Ae=new V;return Ae.lazyInit=this.lazyInit&&this.lazyInit instanceof V?this.lazyInit:this,Ae.lazyUpdate=(this.lazyUpdate||[]).concat([te]),Ae}applyUpdate(te){const Ae=te.name.toLowerCase();switch(te.op){case"a":case"s":let ut=te.value;if("string"==typeof ut&&(ut=[ut]),0===ut.length)return;this.maybeSetNormalizedName(te.name,Ae);const Pe=("a"===te.op?this.headers.get(Ae):void 0)||[];Pe.push(...ut),this.headers.set(Ae,Pe);break;case"d":const Nt=te.value;if(Nt){let me=this.headers.get(Ae);if(!me)return;me=me.filter(qe=>-1===Nt.indexOf(qe)),0===me.length?(this.headers.delete(Ae),this.normalizedNames.delete(Ae)):this.headers.set(Ae,me)}else this.headers.delete(Ae),this.normalizedNames.delete(Ae)}}forEach(te){this.init(),Array.from(this.normalizedNames.keys()).forEach(Ae=>te(this.normalizedNames.get(Ae),this.headers.get(Ae)))}}class Z{encodeKey(te){return ge(te)}encodeValue(te){return ge(te)}decodeKey(te){return decodeURIComponent(te)}decodeValue(te){return decodeURIComponent(te)}}const re=/%(\d[a-f0-9])/gi,_e={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function ge(Ye){return encodeURIComponent(Ye).replace(re,(te,Ae)=>_e[Ae]??te)}function xe(Ye){return`${Ye}`}class je{constructor(te={}){if(this.updates=null,this.cloneFrom=null,this.encoder=te.encoder||new Z,te.fromString){if(te.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function K(Ye,te){const Ae=new Map;return Ye.length>0&&Ye.replace(/^\?/,"").split("&").forEach(Pe=>{const Nt=Pe.indexOf("="),[me,qe]=-1==Nt?[te.decodeKey(Pe),""]:[te.decodeKey(Pe.slice(0,Nt)),te.decodeValue(Pe.slice(Nt+1))],Rt=Ae.get(me)||[];Rt.push(qe),Ae.set(me,Rt)}),Ae}(te.fromString,this.encoder)}else te.fromObject?(this.map=new Map,Object.keys(te.fromObject).forEach(Ae=>{const ut=te.fromObject[Ae];this.map.set(Ae,Array.isArray(ut)?ut:[ut])})):this.map=null}has(te){return this.init(),this.map.has(te)}get(te){this.init();const Ae=this.map.get(te);return Ae?Ae[0]:null}getAll(te){return this.init(),this.map.get(te)||null}keys(){return this.init(),Array.from(this.map.keys())}append(te,Ae){return this.clone({param:te,value:Ae,op:"a"})}appendAll(te){const Ae=[];return Object.keys(te).forEach(ut=>{const Pe=te[ut];Array.isArray(Pe)?Pe.forEach(Nt=>{Ae.push({param:ut,value:Nt,op:"a"})}):Ae.push({param:ut,value:Pe,op:"a"})}),this.clone(Ae)}set(te,Ae){return this.clone({param:te,value:Ae,op:"s"})}delete(te,Ae){return this.clone({param:te,value:Ae,op:"d"})}toString(){return this.init(),this.keys().map(te=>{const Ae=this.encoder.encodeKey(te);return this.map.get(te).map(ut=>Ae+"="+this.encoder.encodeValue(ut)).join("&")}).filter(te=>""!==te).join("&")}clone(te){const Ae=new je({encoder:this.encoder});return Ae.cloneFrom=this.cloneFrom||this,Ae.updates=(this.updates||[]).concat(te),Ae}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(te=>this.map.set(te,this.cloneFrom.map.get(te))),this.updates.forEach(te=>{switch(te.op){case"a":case"s":const Ae=("a"===te.op?this.map.get(te.param):void 0)||[];Ae.push(xe(te.value)),this.map.set(te.param,Ae);break;case"d":if(void 0===te.value){this.map.delete(te.param);break}{let ut=this.map.get(te.param)||[];const Pe=ut.indexOf(xe(te.value));-1!==Pe&&ut.splice(Pe,1),ut.length>0?this.map.set(te.param,ut):this.map.delete(te.param)}}}),this.cloneFrom=this.updates=null)}}class Fe{constructor(){this.map=new Map}set(te,Ae){return this.map.set(te,Ae),this}get(te){return this.map.has(te)||this.map.set(te,te.defaultValue()),this.map.get(te)}delete(te){return this.map.delete(te),this}has(te){return this.map.has(te)}keys(){return this.map.keys()}}function Ne(Ye){return"undefined"!=typeof ArrayBuffer&&Ye instanceof ArrayBuffer}function $e(Ye){return"undefined"!=typeof Blob&&Ye instanceof Blob}function Re(Ye){return"undefined"!=typeof FormData&&Ye instanceof FormData}class Ge{constructor(te,Ae,ut,Pe){let Nt;if(this.url=Ae,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=te.toUpperCase(),function ke(Ye){switch(Ye){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||Pe?(this.body=void 0!==ut?ut:null,Nt=Pe):Nt=ut,Nt&&(this.reportProgress=!!Nt.reportProgress,this.withCredentials=!!Nt.withCredentials,Nt.responseType&&(this.responseType=Nt.responseType),Nt.headers&&(this.headers=Nt.headers),Nt.context&&(this.context=Nt.context),Nt.params&&(this.params=Nt.params)),this.headers||(this.headers=new V),this.context||(this.context=new Fe),this.params){const me=this.params.toString();if(0===me.length)this.urlWithParams=Ae;else{const qe=Ae.indexOf("?");this.urlWithParams=Ae+(-1===qe?"?":qe<Ae.length-1?"&":"")+me}}else this.params=new je,this.urlWithParams=Ae}serializeBody(){return null===this.body?null:Ne(this.body)||$e(this.body)||Re(this.body)||function _t(Ye){return"undefined"!=typeof URLSearchParams&&Ye instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof je?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Re(this.body)?null:$e(this.body)?this.body.type||null:Ne(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof je?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(te={}){const Ae=te.method||this.method,ut=te.url||this.url,Pe=te.responseType||this.responseType,Nt=void 0!==te.body?te.body:this.body,me=void 0!==te.withCredentials?te.withCredentials:this.withCredentials,qe=void 0!==te.reportProgress?te.reportProgress:this.reportProgress;let Rt=te.headers||this.headers,Xt=te.params||this.params;const Xn=te.context??this.context;return void 0!==te.setHeaders&&(Rt=Object.keys(te.setHeaders).reduce((Ki,Di)=>Ki.set(Di,te.setHeaders[Di]),Rt)),te.setParams&&(Xt=Object.keys(te.setParams).reduce((Ki,Di)=>Ki.set(Di,te.setParams[Di]),Xt)),new Ge(Ae,ut,Nt,{params:Xt,headers:Rt,context:Xn,reportProgress:qe,responseType:Pe,withCredentials:me})}}var ot=(()=>((ot=ot||{})[ot.Sent=0]="Sent",ot[ot.UploadProgress=1]="UploadProgress",ot[ot.ResponseHeader=2]="ResponseHeader",ot[ot.DownloadProgress=3]="DownloadProgress",ot[ot.Response=4]="Response",ot[ot.User=5]="User",ot))();class yt{constructor(te,Ae=200,ut="OK"){this.headers=te.headers||new V,this.status=void 0!==te.status?te.status:Ae,this.statusText=te.statusText||ut,this.url=te.url||null,this.ok=this.status>=200&&this.status<300}}class wt extends yt{constructor(te={}){super(te),this.type=ot.ResponseHeader}clone(te={}){return new wt({headers:te.headers||this.headers,status:void 0!==te.status?te.status:this.status,statusText:te.statusText||this.statusText,url:te.url||this.url||void 0})}}class xt extends yt{constructor(te={}){super(te),this.type=ot.Response,this.body=void 0!==te.body?te.body:null}clone(te={}){return new xt({body:void 0!==te.body?te.body:this.body,headers:te.headers||this.headers,status:void 0!==te.status?te.status:this.status,statusText:te.statusText||this.statusText,url:te.url||this.url||void 0})}}class dt extends yt{constructor(te){super(te,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${te.url||"(unknown url)"}`:`Http failure response for ${te.url||"(unknown url)"}: ${te.status} ${te.statusText}`,this.error=te.error||null}}function At(Ye,te){return{body:te,headers:Ye.headers,context:Ye.context,observe:Ye.observe,params:Ye.params,reportProgress:Ye.reportProgress,responseType:Ye.responseType,withCredentials:Ye.withCredentials}}let Vt=(()=>{class Ye{constructor(Ae){this.handler=Ae}request(Ae,ut,Pe={}){let Nt;if(Ae instanceof Ge)Nt=Ae;else{let Rt,Xt;Rt=Pe.headers instanceof V?Pe.headers:new V(Pe.headers),Pe.params&&(Xt=Pe.params instanceof je?Pe.params:new je({fromObject:Pe.params})),Nt=new Ge(Ae,ut,void 0!==Pe.body?Pe.body:null,{headers:Rt,context:Pe.context,params:Xt,reportProgress:Pe.reportProgress,responseType:Pe.responseType||"json",withCredentials:Pe.withCredentials})}const me=(0,j.of)(Nt).pipe((0,L.b)(Rt=>this.handler.handle(Rt)));if(Ae instanceof Ge||"events"===Pe.observe)return me;const qe=me.pipe((0,P.h)(Rt=>Rt instanceof xt));switch(Pe.observe||"body"){case"body":switch(Nt.responseType){case"arraybuffer":return qe.pipe((0,m.U)(Rt=>{if(null!==Rt.body&&!(Rt.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return Rt.body}));case"blob":return qe.pipe((0,m.U)(Rt=>{if(null!==Rt.body&&!(Rt.body instanceof Blob))throw new Error("Response is not a Blob.");return Rt.body}));case"text":return qe.pipe((0,m.U)(Rt=>{if(null!==Rt.body&&"string"!=typeof Rt.body)throw new Error("Response is not a string.");return Rt.body}));default:return qe.pipe((0,m.U)(Rt=>Rt.body))}case"response":return qe;default:throw new Error(`Unreachable: unhandled observe type ${Pe.observe}}`)}}delete(Ae,ut={}){return this.request("DELETE",Ae,ut)}get(Ae,ut={}){return this.request("GET",Ae,ut)}head(Ae,ut={}){return this.request("HEAD",Ae,ut)}jsonp(Ae,ut){return this.request("JSONP",Ae,{params:(new je).append(ut,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Ae,ut={}){return this.request("OPTIONS",Ae,ut)}patch(Ae,ut,Pe={}){return this.request("PATCH",Ae,At(Pe,ut))}post(Ae,ut,Pe={}){return this.request("POST",Ae,At(Pe,ut))}put(Ae,ut,Pe={}){return this.request("PUT",Ae,At(Pe,ut))}}return Ye.\u0275fac=function(Ae){return new(Ae||Ye)(d.LFG($))},Ye.\u0275prov=d.Yz7({token:Ye,factory:Ye.\u0275fac}),Ye})();class Un{constructor(te,Ae){this.next=te,this.interceptor=Ae}handle(te){return this.interceptor.intercept(te,this.next)}}const St=new d.OlP("HTTP_INTERCEPTORS");let $t=(()=>{class Ye{intercept(Ae,ut){return ut.handle(Ae)}}return Ye.\u0275fac=function(Ae){return new(Ae||Ye)},Ye.\u0275prov=d.Yz7({token:Ye,factory:Ye.\u0275fac}),Ye})();const Gt=/^\)\]\}',?\n/;let Ut=(()=>{class Ye{constructor(Ae){this.xhrFactory=Ae}handle(Ae){if("JSONP"===Ae.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new l.y(ut=>{const Pe=this.xhrFactory.build();if(Pe.open(Ae.method,Ae.urlWithParams),Ae.withCredentials&&(Pe.withCredentials=!0),Ae.headers.forEach((gi,fi)=>Pe.setRequestHeader(gi,fi.join(","))),Ae.headers.has("Accept")||Pe.setRequestHeader("Accept","application/json, text/plain, */*"),!Ae.headers.has("Content-Type")){const gi=Ae.detectContentTypeHeader();null!==gi&&Pe.setRequestHeader("Content-Type",gi)}if(Ae.responseType){const gi=Ae.responseType.toLowerCase();Pe.responseType="json"!==gi?gi:"text"}const Nt=Ae.serializeBody();let me=null;const qe=()=>{if(null!==me)return me;const gi=Pe.statusText||"OK",fi=new V(Pe.getAllResponseHeaders()),Cr=function ft(Ye){return"responseURL"in Ye&&Ye.responseURL?Ye.responseURL:/^X-Request-URL:/m.test(Ye.getAllResponseHeaders())?Ye.getResponseHeader("X-Request-URL"):null}(Pe)||Ae.url;return me=new wt({headers:fi,status:Pe.status,statusText:gi,url:Cr}),me},Rt=()=>{let{headers:gi,status:fi,statusText:Cr,url:Vi}=qe(),gr=null;204!==fi&&(gr=void 0===Pe.response?Pe.responseText:Pe.response),0===fi&&(fi=gr?200:0);let Pi=fi>=200&&fi<300;if("json"===Ae.responseType&&"string"==typeof gr){const Br=gr;gr=gr.replace(Gt,"");try{gr=""!==gr?JSON.parse(gr):null}catch(Ei){gr=Br,Pi&&(Pi=!1,gr={error:Ei,text:gr})}}Pi?(ut.next(new xt({body:gr,headers:gi,status:fi,statusText:Cr,url:Vi||void 0})),ut.complete()):ut.error(new dt({error:gr,headers:gi,status:fi,statusText:Cr,url:Vi||void 0}))},Xt=gi=>{const{url:fi}=qe(),Cr=new dt({error:gi,status:Pe.status||0,statusText:Pe.statusText||"Unknown Error",url:fi||void 0});ut.error(Cr)};let Xn=!1;const Ki=gi=>{Xn||(ut.next(qe()),Xn=!0);let fi={type:ot.DownloadProgress,loaded:gi.loaded};gi.lengthComputable&&(fi.total=gi.total),"text"===Ae.responseType&&!!Pe.responseText&&(fi.partialText=Pe.responseText),ut.next(fi)},Di=gi=>{let fi={type:ot.UploadProgress,loaded:gi.loaded};gi.lengthComputable&&(fi.total=gi.total),ut.next(fi)};return Pe.addEventListener("load",Rt),Pe.addEventListener("error",Xt),Pe.addEventListener("timeout",Xt),Pe.addEventListener("abort",Xt),Ae.reportProgress&&(Pe.addEventListener("progress",Ki),null!==Nt&&Pe.upload&&Pe.upload.addEventListener("progress",Di)),Pe.send(Nt),ut.next({type:ot.Sent}),()=>{Pe.removeEventListener("error",Xt),Pe.removeEventListener("abort",Xt),Pe.removeEventListener("load",Rt),Pe.removeEventListener("timeout",Xt),Ae.reportProgress&&(Pe.removeEventListener("progress",Ki),null!==Nt&&Pe.upload&&Pe.upload.removeEventListener("progress",Di)),Pe.readyState!==Pe.DONE&&Pe.abort()}})}}return Ye.\u0275fac=function(Ae){return new(Ae||Ye)(d.LFG(u.JF))},Ye.\u0275prov=d.Yz7({token:Ye,factory:Ye.\u0275fac}),Ye})();const On=new d.OlP("XSRF_COOKIE_NAME"),fn=new d.OlP("XSRF_HEADER_NAME");class Gn{}let ei=(()=>{class Ye{constructor(Ae,ut,Pe){this.doc=Ae,this.platform=ut,this.cookieName=Pe,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Ae=this.doc.cookie||"";return Ae!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,u.Mx)(Ae,this.cookieName),this.lastCookieString=Ae),this.lastToken}}return Ye.\u0275fac=function(Ae){return new(Ae||Ye)(d.LFG(u.K0),d.LFG(d.Lbi),d.LFG(On))},Ye.\u0275prov=d.Yz7({token:Ye,factory:Ye.\u0275fac}),Ye})(),$i=(()=>{class Ye{constructor(Ae,ut){this.tokenService=Ae,this.headerName=ut}intercept(Ae,ut){const Pe=Ae.url.toLowerCase();if("GET"===Ae.method||"HEAD"===Ae.method||Pe.startsWith("http://")||Pe.startsWith("https://"))return ut.handle(Ae);const Nt=this.tokenService.getToken();return null!==Nt&&!Ae.headers.has(this.headerName)&&(Ae=Ae.clone({headers:Ae.headers.set(this.headerName,Nt)})),ut.handle(Ae)}}return Ye.\u0275fac=function(Ae){return new(Ae||Ye)(d.LFG(Gn),d.LFG(fn))},Ye.\u0275prov=d.Yz7({token:Ye,factory:Ye.\u0275fac}),Ye})(),sr=(()=>{class Ye{constructor(Ae,ut){this.backend=Ae,this.injector=ut,this.chain=null}handle(Ae){if(null===this.chain){const ut=this.injector.get(St,[]);this.chain=ut.reduceRight((Pe,Nt)=>new Un(Pe,Nt),this.backend)}return this.chain.handle(Ae)}}return Ye.\u0275fac=function(Ae){return new(Ae||Ye)(d.LFG(ue),d.LFG(d.zs3))},Ye.\u0275prov=d.Yz7({token:Ye,factory:Ye.\u0275fac}),Ye})(),ji=(()=>{class Ye{static disable(){return{ngModule:Ye,providers:[{provide:$i,useClass:$t}]}}static withOptions(Ae={}){return{ngModule:Ye,providers:[Ae.cookieName?{provide:On,useValue:Ae.cookieName}:[],Ae.headerName?{provide:fn,useValue:Ae.headerName}:[]]}}}return Ye.\u0275fac=function(Ae){return new(Ae||Ye)},Ye.\u0275mod=d.oAB({type:Ye}),Ye.\u0275inj=d.cJS({providers:[$i,{provide:St,useExisting:$i,multi:!0},{provide:Gn,useClass:ei},{provide:On,useValue:"XSRF-TOKEN"},{provide:fn,useValue:"X-XSRF-TOKEN"}]}),Ye})(),_i=(()=>{class Ye{}return Ye.\u0275fac=function(Ae){return new(Ae||Ye)},Ye.\u0275mod=d.oAB({type:Ye}),Ye.\u0275inj=d.cJS({providers:[Vt,{provide:$,useClass:sr},Ut,{provide:ue,useExisting:Ut}],imports:[[ji.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),Ye})()},6738:(Tn,Je,R)=>{"use strict";R.d(Je,{deG:()=>bo,tb:()=>e0,AFp:()=>Xv,ip1:()=>b_,CZH:()=>gh,hGG:()=>cw,z2F:()=>ef,sBO:()=>zb,Sil:()=>T_,_Vd:()=>Hp,EJc:()=>n0,SBq:()=>Wp,qLn:()=>iu,vpe:()=>vc,tBr:()=>or,XFs:()=>ut,OlP:()=>Mr,zs3:()=>ua,ZZ4:()=>Vm,aQg:()=>$m,soG:()=>zm,YKP:()=>uv,h0i:()=>ph,PXZ:()=>Ob,R0b:()=>el,FiY:()=>no,Lbi:()=>Qv,g9A:()=>Kv,Qsj:()=>f1,FYo:()=>sv,JOm:()=>ml,tp0:()=>Gr,Rgc:()=>Kp,dDg:()=>s0,GfV:()=>av,s_b:()=>km,ifc:()=>gi,eFA:()=>c0,G48:()=>Nb,Gpc:()=>Fe,_c5:()=>nw,VLi:()=>Ab,c2e:()=>t0,zSh:()=>wp,wAp:()=>Xi,vHH:()=>Re,cg1:()=>Kg,kL8:()=>Sy,dqk:()=>Pi,sIi:()=>bu,CqO:()=>Du,QGY:()=>da,F4k:()=>Hc,RDi:()=>Mt,AaK:()=>xe,qOj:()=>Ds,TTD:()=>bs,_Bn:()=>iv,xp6:()=>Jh,uIk:()=>Gc,ekj:()=>qg,Suo:()=>Sv,Xpm:()=>mt,lG2:()=>qn,Yz7:()=>ei,cJS:()=>sr,oAB:()=>rn,Yjl:()=>ni,Y36:()=>ss,_UZ:()=>fo,GkF:()=>vs,BQk:()=>gs,ynx:()=>ls,qZA:()=>Zo,TgZ:()=>qr,EpF:()=>Ho,n5z:()=>J,LFG:()=>Li,$8M:()=>Me,$Z:()=>co,NdJ:()=>Wc,CRH:()=>Pv,oxw:()=>oh,ALo:()=>xv,lcZ:()=>bv,xi3:()=>wv,Hsn:()=>sh,F$t:()=>Up,Q6J:()=>Uo,s9C:()=>sd,DdM:()=>fv,iGM:()=>Mv,MAs:()=>M,CHM:()=>Jl,LSH:()=>Ah,Udp:()=>Gg,YNc:()=>b,_uU:()=>py,Oqu:()=>Wg,hij:()=>Im,AsE:()=>Yg,lnq:()=>Jg,HOy:()=>Xg,Gf:()=>Av});var u=R(2916),d=R(2866),j=R(9146),l=R(3009),P=R(8929),m=R(2654),$=R(1762);class V{constructor(o,a){this.subjectFactory=o,this.selector=a}call(o,a){const{selector:p}=this,v=this.subjectFactory(),w=p(v).subscribe(o);return w.add(a.subscribe(v)),w}}var Z=R(4327);function K(){return new P.xQ}function _e(r){for(let o in r)if(r[o]===_e)return o;throw Error("Could not find renamed property on target object.")}function ge(r,o){for(const a in o)o.hasOwnProperty(a)&&!r.hasOwnProperty(a)&&(r[a]=o[a])}function xe(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(xe).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const o=r.toString();if(null==o)return""+o;const a=o.indexOf("\n");return-1===a?o:o.substring(0,a)}function je(r,o){return null==r||""===r?null===o?"":o:null==o||""===o?r:r+" "+o}const nt=_e({__forward_ref__:_e});function Fe(r){return r.__forward_ref__=Fe,r.toString=function(){return xe(this())},r}function ke(r){return Ne(r)?r():r}function Ne(r){return"function"==typeof r&&r.hasOwnProperty(nt)&&r.__forward_ref__===Fe}class Re extends Error{constructor(o,a){super(function _t(r,o){return`NG0${Math.abs(r)}${o?": "+o:""}`}(o,a)),this.code=o}}function Ge(r){return"string"==typeof r?r:null==r?"":String(r)}function ot(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():Ge(r)}function dt(r,o){const a=o?` in ${o}`:"";throw new Re(-201,`No provider for ${ot(r)} found${a}`)}function ft(r,o){null==r&&function Ut(r,o,a,p){throw new Error(`ASSERTION ERROR: ${r}`+(null==p?"":` [Expected=> ${a} ${p} ${o} <=Actual]`))}(o,r,null,"!=")}function ei(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function sr(r){return{providers:r.providers||[],imports:r.imports||[]}}function zi(r){return yi(r,Qt)||yi(r,te)}function yi(r,o){return r.hasOwnProperty(o)?r[o]:null}function xi(r){return r&&(r.hasOwnProperty(Ye)||r.hasOwnProperty(Ae))?r[Ye]:null}const Qt=_e({\u0275prov:_e}),Ye=_e({\u0275inj:_e}),te=_e({ngInjectableDef:_e}),Ae=_e({ngInjectorDef:_e});var ut=(()=>((ut=ut||{})[ut.Default=0]="Default",ut[ut.Host=1]="Host",ut[ut.Self=2]="Self",ut[ut.SkipSelf=4]="SkipSelf",ut[ut.Optional=8]="Optional",ut))();let Pe;function me(r){const o=Pe;return Pe=r,o}function qe(r,o,a){const p=zi(r);return p&&"root"==p.providedIn?void 0===p.value?p.value=p.factory():p.value:a&ut.Optional?null:void 0!==o?o:void dt(xe(r),"Injector")}function Xt(r){return{toString:r}.toString()}var Xn=(()=>((Xn=Xn||{})[Xn.OnPush=0]="OnPush",Xn[Xn.Default=1]="Default",Xn))(),gi=(()=>{return(r=gi||(gi={}))[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",gi;var r})();const fi="undefined"!=typeof globalThis&&globalThis,Cr="undefined"!=typeof window&&window,Vi="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Pi=fi||"undefined"!=typeof global&&global||Cr||Vi,Rr={},_n=[],tr=_e({\u0275cmp:_e}),ie=_e({\u0275dir:_e}),X=_e({\u0275pipe:_e}),F=_e({\u0275mod:_e}),he=_e({\u0275fac:_e}),Te=_e({__NG_ELEMENT_ID__:_e});let We=0;function mt(r){return Xt(()=>{const a={},p={type:r.type,providersResolver:null,decls:r.decls,vars:r.vars,factory:null,template:r.template||null,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:a,inputs:null,outputs:null,exportAs:r.exportAs||null,onPush:r.changeDetection===Xn.OnPush,directiveDefs:null,pipeDefs:null,selectors:r.selectors||_n,viewQuery:r.viewQuery||null,features:r.features||null,data:r.data||{},encapsulation:r.encapsulation||gi.Emulated,id:"c",styles:r.styles||_n,_:null,setInput:null,schemas:r.schemas||null,tView:null},v=r.directives,w=r.features,A=r.pipes;return p.id+=We++,p.inputs=Ln(r.inputs,a),p.outputs=Ln(r.outputs),w&&w.forEach(N=>N(p)),p.directiveDefs=v?()=>("function"==typeof v?v():v).map(Xe):null,p.pipeDefs=A?()=>("function"==typeof A?A():A).map(kt):null,p})}function Xe(r){return Hn(r)||function ii(r){return r[ie]||null}(r)}function kt(r){return function Ui(r){return r[X]||null}(r)}const tn={};function rn(r){return Xt(()=>{const o={type:r.type,bootstrap:r.bootstrap||_n,declarations:r.declarations||_n,imports:r.imports||_n,exports:r.exports||_n,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null};return null!=r.id&&(tn[r.id]=r.type),o})}function Ln(r,o){if(null==r)return Rr;const a={};for(const p in r)if(r.hasOwnProperty(p)){let v=r[p],w=v;Array.isArray(v)&&(w=v[1],v=v[0]),a[v]=p,o&&(o[v]=w)}return a}const qn=mt;function ni(r){return{type:r.type,name:r.name,factory:null,pure:!1!==r.pure,onDestroy:r.type.prototype.ngOnDestroy||null}}function Hn(r){return r[tr]||null}function Fi(r,o){const a=r[F]||null;if(!a&&!0===o)throw new Error(`Type ${xe(r)} does not have '\u0275mod' property.`);return a}function cn(r){return Array.isArray(r)&&"object"==typeof r[1]}function ki(r){return Array.isArray(r)&&!0===r[1]}function $r(r){return 0!=(8&r.flags)}function Hi(r){return 2==(2&r.flags)}function Er(r){return 1==(1&r.flags)}function nr(r){return null!==r.template}function vo(r){return 0!=(512&r[2])}function ro(r,o){return r.hasOwnProperty(he)?r[he]:null}class Vo{constructor(o,a,p){this.previousValue=o,this.currentValue=a,this.firstChange=p}isFirstChange(){return this.firstChange}}function bs(){return Wr}function Wr(r){return r.type.prototype.ngOnChanges&&(r.setInput=$o),Bs}function Bs(){const r=Ns(this),o=r?.current;if(o){const a=r.previous;if(a===Rr)r.previous=o;else for(let p in o)a[p]=o[p];r.current=null,this.ngOnChanges(o)}}function $o(r,o,a,p){const v=Ns(r)||function uo(r,o){return r[Qr]=o}(r,{previous:Rr,current:null}),w=v.current||(v.current={}),A=v.previous,N=this.declaredInputs[a],G=A[N];w[N]=new Vo(G&&G.currentValue,o,A===Rr),r[p]=o}bs.ngInherit=!0;const Qr="__ngSimpleChanges__";function Ns(r){return r[Qr]||null}let Le;function Mt(r){Le=r}function Wn(r){return!!r.listen}const yr={createRenderer:(r,o)=>function an(){return void 0!==Le?Le:"undefined"!=typeof document?document:void 0}()};function Oi(r){for(;Array.isArray(r);)r=r[0];return r}function ae(r,o){return Oi(o[r])}function ee(r,o){return Oi(o[r.index])}function Oe(r,o){return r.data[o]}function hn(r,o){return r[o]}function ti(r,o){const a=o[r];return cn(a)?a:a[0]}function Ir(r){return 4==(4&r[2])}function xr(r){return 128==(128&r[2])}function Ao(r,o){return null==o?null:r[o]}function zs(r){r[18]=0}function As(r,o){r[5]+=o;let a=r,p=r[3];for(;null!==p&&(1===o&&1===a[5]||-1===o&&0===a[5]);)p[5]+=o,a=p,p=p[3]}const Si={lFrame:bc(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Cl(){return Si.bindingsEnabled}function Sn(){return Si.lFrame.lView}function lr(){return Si.lFrame.tView}function Jl(r){return Si.lFrame.contextLView=r,r[8]}function Co(){let r=il();for(;null!==r&&64===r.type;)r=r.parent;return r}function il(){return Si.lFrame.currentTNode}function is(r,o){const a=Si.lFrame;a.currentTNode=r,a.isParent=o}function fa(){return Si.lFrame.isParent}function ma(){Si.lFrame.isParent=!1}function E(){return Si.isInCheckNoChangesMode}function H(r){Si.isInCheckNoChangesMode=r}function ve(){const r=Si.lFrame;let o=r.bindingRootIndex;return-1===o&&(o=r.bindingRootIndex=r.tView.bindingStartIndex),o}function vt(){return Si.lFrame.bindingIndex}function Vn(){return Si.lFrame.bindingIndex++}function wi(r){const o=Si.lFrame,a=o.bindingIndex;return o.bindingIndex=o.bindingIndex+r,a}function hr(r,o){const a=Si.lFrame;a.bindingIndex=a.bindingRootIndex=r,eo(o)}function eo(r){Si.lFrame.currentDirectiveIndex=r}function rs(){return Si.lFrame.currentQueryIndex}function ga(r){Si.lFrame.currentQueryIndex=r}function Zs(r){const o=r[1];return 2===o.type?o.declTNode:1===o.type?r[6]:null}function xc(r,o,a){if(a&ut.SkipSelf){let v=o,w=r;for(;!(v=v.parent,null!==v||a&ut.Host||(v=Zs(w),null===v||(w=w[15],10&v.type))););if(null===v)return!1;o=v,r=w}const p=Si.lFrame=El();return p.currentTNode=o,p.lView=r,!0}function rl(r){const o=El(),a=r[1];Si.lFrame=o,o.currentTNode=a.firstChild,o.lView=r,o.tView=a,o.contextLView=r,o.bindingIndex=a.bindingStartIndex,o.inI18n=!1}function El(){const r=Si.lFrame,o=null===r?null:r.child;return null===o?bc(r):o}function bc(r){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=o),o}function Xl(){const r=Si.lFrame;return Si.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const wc=Xl;function Sa(){const r=Xl();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function Yo(){return Si.lFrame.selectedIndex}function Ss(r){Si.lFrame.selectedIndex=r}function to(){const r=Si.lFrame;return Oe(r.tView,r.selectedIndex)}function pr(r,o){for(let a=o.directiveStart,p=o.directiveEnd;a<p;a++){const w=r.data[a].type.prototype,{ngAfterContentInit:A,ngAfterContentChecked:N,ngAfterViewInit:G,ngAfterViewChecked:fe,ngOnDestroy:be}=w;A&&(r.contentHooks||(r.contentHooks=[])).push(-a,A),N&&((r.contentHooks||(r.contentHooks=[])).push(a,N),(r.contentCheckHooks||(r.contentCheckHooks=[])).push(a,N)),G&&(r.viewHooks||(r.viewHooks=[])).push(-a,G),fe&&((r.viewHooks||(r.viewHooks=[])).push(a,fe),(r.viewCheckHooks||(r.viewCheckHooks=[])).push(a,fe)),null!=be&&(r.destroyHooks||(r.destroyHooks=[])).push(a,be)}}function Pa(r,o,a){ko(r,o,3,a)}function ra(r,o,a,p){(3&r[2])===a&&ko(r,o,a,p)}function _a(r,o){let a=r[2];(3&a)===o&&(a&=2047,a+=1,r[2]=a)}function ko(r,o,a,p){const w=p??-1,A=o.length-1;let N=0;for(let G=void 0!==p?65535&r[18]:0;G<A;G++)if("number"==typeof o[G+1]){if(N=o[G],null!=p&&N>=p)break}else o[G]<0&&(r[18]+=65536),(N<w||-1==w)&&(Ql(r,a,o,G),r[18]=(4294901760&r[18])+G+2),G++}function Ql(r,o,a,p){const v=a[p]<0,w=a[p+1],N=r[v?-a[p]:a[p]];if(v){if(r[2]>>11<r[18]>>16&&(3&r[2])===o){r[2]+=2048;try{w.call(N)}finally{}}}else try{w.call(N)}finally{}}class Oa{constructor(o,a,p){this.factory=o,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=p}}function La(r,o,a){const p=Wn(r);let v=0;for(;v<a.length;){const w=a[v];if("number"==typeof w){if(0!==w)break;v++;const A=a[v++],N=a[v++],G=a[v++];p?r.setAttribute(o,N,G,A):o.setAttributeNS(A,N,G)}else{const A=w,N=a[++v];ya(A)?p&&r.setProperty(o,A,N):p?r.setAttribute(o,A,N):o.setAttribute(A,N),v++}}return v}function Jo(r){return 3===r||4===r||6===r}function ya(r){return 64===r.charCodeAt(0)}function ka(r,o){if(null!==o&&0!==o.length)if(null===r||0===r.length)r=o.slice();else{let a=-1;for(let p=0;p<o.length;p++){const v=o[p];"number"==typeof v?a=v:0===a||js(r,a,v,null,-1===a||2===a?o[++p]:null)}}return r}function js(r,o,a,p,v){let w=0,A=r.length;if(-1===o)A=-1;else for(;w<r.length;){const N=r[w++];if("number"==typeof N){if(N===o){A=-1;break}if(N>o){A=w-1;break}}}for(;w<r.length;){const N=r[w];if("number"==typeof N)break;if(N===a){if(null===p)return void(null!==v&&(r[w+1]=v));if(p===r[w+1])return void(r[w+2]=v)}w++,null!==p&&w++,null!==v&&w++}-1!==A&&(r.splice(A,0,o),w=A+1),r.splice(w++,0,a),null!==p&&r.splice(w++,0,p),null!==v&&r.splice(w++,0,v)}function Gs(r){return-1!==r}function va(r){return 32767&r}function oa(r,o){let a=function Dl(r){return r>>16}(r),p=o;for(;a>0;)p=p[15],a--;return p}let Fa=!0;function xa(r){const o=Fa;return Fa=r,o}let Jc=0;function wa(r,o){const a=ec(r,o);if(-1!==a)return a;const p=o[1];p.firstCreatePass&&(r.injectorIndex=o.length,Il(p.data,r),Il(o,null),Il(p.blueprint,null));const v=Ml(r,o),w=r.injectorIndex;if(Gs(v)){const A=va(v),N=oa(v,o),G=N[1].data;for(let fe=0;fe<8;fe++)o[w+fe]=N[A+fe]|G[A+fe]}return o[w+8]=v,w}function Il(r,o){r.push(0,0,0,0,0,0,0,0,o)}function ec(r,o){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===o[r.injectorIndex+8]?-1:r.injectorIndex}function Ml(r,o){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let a=0,p=null,v=o;for(;null!==v;){const w=v[1],A=w.type;if(p=2===A?w.declTNode:1===A?v[6]:null,null===p)return-1;if(a++,v=v[15],-1!==p.injectorIndex)return p.injectorIndex|a<<16}return-1}function Ba(r,o,a){!function Mc(r,o,a){let p;"string"==typeof a?p=a.charCodeAt(0)||0:a.hasOwnProperty(Te)&&(p=a[Te]),null==p&&(p=a[Te]=Jc++);const v=255&p;o.data[r+(v>>5)]|=1<<v}(r,o,a)}function Ac(r,o,a){if(a&ut.Optional)return r;dt(o,"NodeInjector")}function ll(r,o,a,p){if(a&ut.Optional&&void 0===p&&(p=null),0==(a&(ut.Self|ut.Host))){const v=r[9],w=me(void 0);try{return v?v.get(o,p,a&ut.Optional):qe(o,p,a&ut.Optional)}finally{me(w)}}return Ac(p,o,a)}function Sc(r,o,a,p=ut.Default,v){if(null!==r){const w=function Xc(r){if("string"==typeof r)return r.charCodeAt(0)||0;const o=r.hasOwnProperty(Te)?r[Te]:void 0;return"number"==typeof o?o>=0?255&o:Sl:o}(a);if("function"==typeof w){if(!xc(o,r,p))return p&ut.Host?Ac(v,a,p):ll(o,a,p,v);try{const A=w(p);if(null!=A||p&ut.Optional)return A;dt(a)}finally{wc()}}else if("number"==typeof w){let A=null,N=ec(r,o),G=-1,fe=p&ut.Host?o[16][6]:null;for((-1===N||p&ut.SkipSelf)&&(G=-1===N?Ml(r,o):o[N+8],-1!==G&&O(p,!1)?(A=o[1],N=va(G),o=oa(G,o)):N=-1);-1!==N;){const be=o[1];if(z(w,N,be.data)){const et=cl(N,o,a,A,p,fe);if(et!==Al)return et}G=o[N+8],-1!==G&&O(p,o[1].data[N+8]===fe)&&z(w,N,o)?(A=be,N=va(G),o=oa(G,o)):N=-1}}}return ll(o,a,p,v)}const Al={};function Sl(){return new S(Co(),Sn())}function cl(r,o,a,p,v,w){const A=o[1],N=A.data[r+8],be=Na(N,A,a,null==p?Hi(N)&&Fa:p!=A&&0!=(3&N.type),v&ut.Host&&w===N);return null!==be?ul(o,A,be,N):Al}function Na(r,o,a,p,v){const w=r.providerIndexes,A=o.data,N=1048575&w,G=r.directiveStart,be=w>>20,Et=v?N+be:r.directiveEnd;for(let jt=p?N:N+be;jt<Et;jt++){const Cn=A[jt];if(jt<G&&a===Cn||jt>=G&&Cn.type===a)return jt}if(v){const jt=A[G];if(jt&&nr(jt)&&jt.type===a)return G}return null}function ul(r,o,a,p){let v=r[a];const w=o.data;if(function Mu(r){return r instanceof Oa}(v)){const A=v;A.resolving&&function yt(r,o){const a=o?`. Dependency path: ${o.join(" > ")} > ${r}`:"";throw new Re(-200,`Circular dependency in DI detected for ${r}${a}`)}(ot(w[a]));const N=xa(A.canSeeViewProviders);A.resolving=!0;const G=A.injectImpl?me(A.injectImpl):null;xc(r,p,ut.Default);try{v=r[a]=A.factory(void 0,w,r,p),o.firstCreatePass&&a>=p.directiveStart&&function Cc(r,o,a){const{ngOnChanges:p,ngOnInit:v,ngDoCheck:w}=o.type.prototype;if(p){const A=Wr(o);(a.preOrderHooks||(a.preOrderHooks=[])).push(r,A),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(r,A)}v&&(a.preOrderHooks||(a.preOrderHooks=[])).push(0-r,v),w&&((a.preOrderHooks||(a.preOrderHooks=[])).push(r,w),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(r,w))}(a,w[a],o)}finally{null!==G&&me(G),xa(N),A.resolving=!1,wc()}}return v}function z(r,o,a){return!!(a[o+(r>>5)]&1<<r)}function O(r,o){return!(r&ut.Self||r&ut.Host&&o)}class S{constructor(o,a){this._tNode=o,this._lView=a}get(o,a,p){return Sc(this._tNode,this._lView,o,p,a)}}function J(r){return Xt(()=>{const o=r.prototype.constructor,a=o[he]||ce(o),p=Object.prototype;let v=Object.getPrototypeOf(r.prototype).constructor;for(;v&&v!==p;){const w=v[he]||ce(v);if(w&&w!==a)return w;v=Object.getPrototypeOf(v)}return w=>new w})}function ce(r){return Ne(r)?()=>{const o=ce(ke(r));return o&&o()}:ro(r)}function Me(r){return function tc(r,o){if("class"===o)return r.classes;if("style"===o)return r.styles;const a=r.attrs;if(a){const p=a.length;let v=0;for(;v<p;){const w=a[v];if(Jo(w))break;if(0===w)v+=2;else if("number"==typeof w)for(v++;v<p&&"string"==typeof a[v];)v++;else{if(w===o)return a[v+1];v+=2}}}return null}(Co(),r)}const bt="__parameters__";function Ri(r,o,a){return Xt(()=>{const p=function zr(r){return function(...a){if(r){const p=r(...a);for(const v in p)this[v]=p[v]}}}(o);function v(...w){if(this instanceof v)return p.apply(this,w),this;const A=new v(...w);return N.annotation=A,N;function N(G,fe,be){const et=G.hasOwnProperty(bt)?G[bt]:Object.defineProperty(G,bt,{value:[]})[bt];for(;et.length<=be;)et.push(null);return(et[be]=et[be]||[]).push(A),G}}return a&&(v.prototype=Object.create(a.prototype)),v.prototype.ngMetadataName=r,v.annotationCls=v,v})}class Mr{constructor(o,a){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof a?this.__NG_ELEMENT_ID__=a:void 0!==a&&(this.\u0275prov=ei({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}toString(){return`InjectionToken ${this._desc}`}}const bo=new Mr("AnalyzeForEntryComponents");function T(r,o){void 0===o&&(o=r);for(let a=0;a<r.length;a++){let p=r[a];Array.isArray(p)?(o===r&&(o=r.slice(0,a)),T(p,o)):o!==r&&o.push(p)}return o}function I(r,o){r.forEach(a=>Array.isArray(a)?I(a,o):o(a))}function k(r,o,a){o>=r.length?r.push(a):r.splice(o,0,a)}function W(r,o){return o>=r.length-1?r.pop():r.splice(o,1)[0]}function ne(r,o){const a=[];for(let p=0;p<r;p++)a.push(o);return a}function ct(r,o,a){let p=at(r,o);return p>=0?r[1|p]=a:(p=~p,function De(r,o,a,p){let v=r.length;if(v==o)r.push(a,p);else if(1===v)r.push(p,r[0]),r[0]=a;else{for(v--,r.push(r[v-1],r[v]);v>o;)r[v]=r[v-2],v--;r[o]=a,r[o+1]=p}}(r,p,o,a)),p}function ze(r,o){const a=at(r,o);if(a>=0)return r[1|a]}function at(r,o){return function rt(r,o,a){let p=0,v=r.length>>a;for(;v!==p;){const w=p+(v-p>>1),A=r[w<<a];if(o===A)return w<<a;A>o?v=w:p=w+1}return~(v<<a)}(r,o,1)}const bn={},yn="__NG_DI_FLAG__",di="ngTempTokenPath",rr=/\n/gm,vi="__source",Yi=_e({provide:String,useValue:_e});let Ar;function Xr(r){const o=Ar;return Ar=r,o}function Gi(r,o=ut.Default){if(void 0===Ar)throw new Re(203,"");return null===Ar?qe(r,void 0,o):Ar.get(r,o&ut.Optional?null:void 0,o)}function Li(r,o=ut.Default){return(function Nt(){return Pe}()||Gi)(ke(r),o)}function ds(r){const o=[];for(let a=0;a<r.length;a++){const p=ke(r[a]);if(Array.isArray(p)){if(0===p.length)throw new Re(900,"");let v,w=ut.Default;for(let A=0;A<p.length;A++){const N=p[A],G=sa(N);"number"==typeof G?-1===G?v=N.token:w|=G:v=N}o.push(Li(v,w))}else o.push(Li(p))}return o}function hs(r,o){return r[yn]=o,r.prototype[yn]=o,r}function sa(r){return r[yn]}const or=hs(Ri("Inject",r=>({token:r})),-1),no=hs(Ri("Optional"),8),Gr=hs(Ri("SkipSelf"),4);class Ws{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function dl(r){return r instanceof Ws?r.changingThisBreaksApplicationSecurity:r}const uf=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,df=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var ho=(()=>((ho=ho||{})[ho.NONE=0]="NONE",ho[ho.HTML=1]="HTML",ho[ho.STYLE=2]="STYLE",ho[ho.SCRIPT=3]="SCRIPT",ho[ho.URL=4]="URL",ho[ho.RESOURCE_URL=5]="RESOURCE_URL",ho))();function Ah(r){const o=function ir(){const r=Sn();return r&&r[12]}();return o?o.sanitize(ho.URL,r)||"":function Ca(r,o){const a=function fd(r){return r instanceof Ws&&r.getTypeName()||null}(r);if(null!=a&&a!==o){if("ResourceURL"===a&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${a} (see https://g.co/ng/security#xss)`)}return a===o}(r,"URL")?dl(r):function ku(r){return(r=String(r)).match(uf)||r.match(df)?r:"unsafe:"+r}(Ge(r))}const Sh="__ngContext__";function _s(r,o){r[Sh]=o}function oc(r){const o=function pl(r){return r[Sh]||null}(r);return o?Array.isArray(o)?o:o.lView:null}function Nl(r){return r.ngOriginalError}function Oh(r,...o){r.error(...o)}class iu{constructor(){this._console=console}handleError(o){const a=this._findOriginalError(o),p=function xd(r){return r&&r.ngErrorLogger||Oh}(o);p(this._console,"ERROR",o),a&&p(this._console,"ORIGINAL ERROR",a)}_findOriginalError(o){let a=o&&Nl(o);for(;a&&Nl(a);)a=Nl(a);return a||null}}const xf=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Pi))();function fl(r){return r instanceof Function?r():r}var ml=(()=>((ml=ml||{})[ml.Important=1]="Important",ml[ml.DashCase=2]="DashCase",ml))();function Lh(r,o){return undefined(r,o)}function Rc(r){const o=r[3];return ki(o)?o[3]:o}function gl(r){return Tf(r[13])}function Os(r){return Tf(r[4])}function Tf(r){for(;null!==r&&!ki(r);)r=r[4];return r}function su(r,o,a,p,v){if(null!=p){let w,A=!1;ki(p)?w=p:cn(p)&&(A=!0,p=p[0]);const N=Oi(p);0===r&&null!==a?null==v?Eo(o,a,N):kc(o,a,N,v||null,!0):1===r&&null!==a?kc(o,a,N,v||null,!0):2===r?function Pf(r,o,a){const p=Fc(r,o);p&&function Sf(r,o,a,p){Wn(r)?r.removeChild(o,a,p):o.removeChild(a)}(r,p,o,a)}(o,N,A):3===r&&o.destroyNode(N),null!=w&&function Pd(r,o,a,p,v){const w=a[7];w!==Oi(a)&&su(o,r,p,w,v);for(let N=10;N<a.length;N++){const G=a[N];Zu(G[1],G,r,o,p,w)}}(o,r,w,a,v)}}function Nh(r,o,a){if(Wn(r))return r.createElement(o,a);{const p=null!==a?function se(r){const o=r.toLowerCase();return"svg"===o?"http://www.w3.org/2000/svg":"math"===o?"http://www.w3.org/1998/MathML/":null}(a):null;return null===p?r.createElement(o):r.createElementNS(p,o)}}function If(r,o){const a=r[9],p=a.indexOf(o),v=o[3];1024&o[2]&&(o[2]&=-1025,As(v,-1)),a.splice(p,1)}function zh(r,o){if(r.length<=10)return;const a=10+o,p=r[a];if(p){const v=p[17];null!==v&&v!==r&&If(v,p),o>0&&(r[a-1][4]=p[4]);const w=W(r,10+o);!function Dd(r,o){Zu(r,o,o[11],2,null,null),o[0]=null,o[6]=null}(p[1],p);const A=w[19];null!==A&&A.detachView(w[1]),p[3]=null,p[4]=null,p[2]&=-129}return p}function Mf(r,o){if(!(256&o[2])){const a=o[11];Wn(a)&&a.destroyNode&&Zu(r,o,a,3,null,null),function Nu(r){let o=r[13];if(!o)return Uh(r[1],r);for(;o;){let a=null;if(cn(o))a=o[13];else{const p=o[10];p&&(a=p)}if(!a){for(;o&&!o[4]&&o!==r;)cn(o)&&Uh(o[1],o),o=o[3];null===o&&(o=r),cn(o)&&Uh(o[1],o),a=o&&o[4]}o=a}}(o)}}function Uh(r,o){if(!(256&o[2])){o[2]&=-129,o[2]|=256,function Zh(r,o){let a;if(null!=r&&null!=(a=r.destroyHooks))for(let p=0;p<a.length;p+=2){const v=o[a[p]];if(!(v instanceof Oa)){const w=a[p+1];if(Array.isArray(w))for(let A=0;A<w.length;A+=2){const N=v[w[A]],G=w[A+1];try{G.call(N)}finally{}}else try{w.call(v)}finally{}}}}(r,o),function dg(r,o){const a=r.cleanup,p=o[7];let v=-1;if(null!==a)for(let w=0;w<a.length-1;w+=2)if("string"==typeof a[w]){const A=a[w+1],N="function"==typeof A?A(o):Oi(o[A]),G=p[v=a[w+2]],fe=a[w+3];"boolean"==typeof fe?N.removeEventListener(a[w],G,fe):fe>=0?p[v=fe]():p[v=-fe].unsubscribe(),w+=2}else{const A=p[v=a[w+1]];a[w].call(A)}if(null!==p){for(let w=v+1;w<p.length;w++)p[w]();o[7]=null}}(r,o),1===o[1].type&&Wn(o[11])&&o[11].destroy();const a=o[17];if(null!==a&&ki(o[3])){a!==o[3]&&If(a,o);const p=o[19];null!==p&&p.detachView(r)}}}function Af(r,o,a){return function Lc(r,o,a){let p=o;for(;null!==p&&40&p.type;)p=(o=p).parent;if(null===p)return a[0];if(2&p.flags){const v=r.data[p.directiveStart].encapsulation;if(v===gi.None||v===gi.Emulated)return null}return ee(p,a)}(r,o.parent,a)}function kc(r,o,a,p,v){Wn(r)?r.insertBefore(o,a,p,v):o.insertBefore(a,p,v)}function Eo(r,o,a){Wn(r)?r.appendChild(o,a):o.appendChild(a)}function zu(r,o,a,p,v){null!==p?kc(r,o,a,p,v):Eo(r,o,a)}function Fc(r,o){return Wn(r)?r.parentNode(o):o.parentNode}function au(r,o,a){return $h(r,o,a)}let $h=function Vh(r,o,a){return 40&r.type?ee(r,a):null};function lu(r,o,a,p){const v=Af(r,p,o),w=o[11],N=au(p.parent||o[6],p,o);if(null!=v)if(Array.isArray(a))for(let G=0;G<a.length;G++)zu(w,v,a[G],N,!1);else zu(w,v,a,N,!1)}function Ad(r,o){if(null!==o){const a=o.type;if(3&a)return ee(o,r);if(4&a)return Nc(-1,r[o.index]);if(8&a){const p=o.child;if(null!==p)return Ad(r,p);{const v=r[o.index];return ki(v)?Nc(-1,v):Oi(v)}}if(32&a)return Lh(o,r)()||Oi(r[o.index]);{const p=jh(r,o);return null!==p?Array.isArray(p)?p[0]:Ad(Rc(r[16]),p):Ad(r,o.next)}}return null}function jh(r,o){return null!==o?r[16][6].projection[o.projection]:null}function Nc(r,o){const a=10+r+1;if(a<o.length){const p=o[a],v=p[1].firstChild;if(null!==v)return Ad(p,v)}return o[7]}function Uu(r,o,a,p,v,w,A){for(;null!=a;){const N=p[a.index],G=a.type;if(A&&0===o&&(N&&_s(Oi(N),p),a.flags|=4),64!=(64&a.flags))if(8&G)Uu(r,o,a.child,p,v,w,!1),su(o,r,v,N,w);else if(32&G){const fe=Lh(a,p);let be;for(;be=fe();)su(o,r,v,be,w);su(o,r,v,N,w)}else 16&G?Sd(r,o,p,a,v,w):su(o,r,v,N,w);a=A?a.projectionNext:a.next}}function Zu(r,o,a,p,v,w){Uu(a,p,r.firstChild,o,v,w,!1)}function Sd(r,o,a,p,v,w){const A=a[16],G=A[6].projection[p.projection];if(Array.isArray(G))for(let fe=0;fe<G.length;fe++)su(o,r,v,G[fe],w);else Uu(r,o,G,A[3],v,w,!0)}function Of(r,o,a){Wn(r)?r.setAttribute(o,"style",a):o.style.cssText=a}function qh(r,o,a){Wn(r)?""===a?r.removeAttribute(o,"class"):r.setAttribute(o,"class",a):o.className=a}function Rf(r,o,a){let p=r.length;for(;;){const v=r.indexOf(o,a);if(-1===v)return v;if(0===v||r.charCodeAt(v-1)<=32){const w=o.length;if(v+w===p||r.charCodeAt(v+w)<=32)return v}a=v+1}}const Hh="ng-template";function cu(r,o,a){let p=0;for(;p<r.length;){let v=r[p++];if(a&&"class"===v){if(v=r[p],-1!==Rf(v.toLowerCase(),o,0))return!0}else if(1===v){for(;p<r.length&&"string"==typeof(v=r[p++]);)if(v.toLowerCase()===o)return!0;return!1}}return!1}function Lf(r){return 4===r.type&&r.value!==Hh}function pg(r,o,a){return o===(4!==r.type||a?r.value:Hh)}function kf(r,o,a){let p=4;const v=r.attrs||[],w=function mg(r){for(let o=0;o<r.length;o++)if(Jo(r[o]))return o;return r.length}(v);let A=!1;for(let N=0;N<o.length;N++){const G=o[N];if("number"!=typeof G){if(!A)if(4&p){if(p=2|1&p,""!==G&&!pg(r,G,a)||""===G&&1===o.length){if(Da(p))return!1;A=!0}}else{const fe=8&p?G:o[++N];if(8&p&&null!==r.attrs){if(!cu(r.attrs,fe,a)){if(Da(p))return!1;A=!0}continue}const et=fg(8&p?"class":G,v,Lf(r),a);if(-1===et){if(Da(p))return!1;A=!0;continue}if(""!==fe){let Et;Et=et>w?"":v[et+1].toLowerCase();const jt=8&p?Et:null;if(jt&&-1!==Rf(jt,fe,0)||2&p&&fe!==Et){if(Da(p))return!1;A=!0}}}}else{if(!A&&!Da(p)&&!Da(G))return!1;if(A&&Da(G))continue;A=!1,p=G|1&p}}return Da(p)||A}function Da(r){return 0==(1&r)}function fg(r,o,a,p){if(null===o)return-1;let v=0;if(p||!a){let w=!1;for(;v<o.length;){const A=o[v];if(A===r)return v;if(3===A||6===A)w=!0;else{if(1===A||2===A){let N=o[++v];for(;"string"==typeof N;)N=o[++v];continue}if(4===A)break;if(0===A){v+=4;continue}}v+=w?1:2}return-1}return function gg(r,o){let a=r.indexOf(4);if(a>-1)for(a++;a<r.length;){const p=r[a];if("number"==typeof p)return-1;if(p===o)return a;a++}return-1}(o,r)}function Ff(r,o,a=!1){for(let p=0;p<o.length;p++)if(kf(r,o[p],a))return!0;return!1}function Vu(r,o){e:for(let a=0;a<o.length;a++){const p=o[a];if(r.length===p.length){for(let v=0;v<r.length;v++)if(r[v]!==p[v])continue e;return!0}}return!1}function Wh(r,o){return r?":not("+o.trim()+")":o}function Yh(r){let o=r[0],a=1,p=2,v="",w=!1;for(;a<r.length;){let A=r[a];if("string"==typeof A)if(2&p){const N=r[++a];v+="["+A+(N.length>0?'="'+N+'"':"")+"]"}else 8&p?v+="."+A:4&p&&(v+=" "+A);else""!==v&&!Da(A)&&(o+=Wh(w,v),v=""),p=A,w=w||!Da(p);a++}return""!==v&&(o+=Wh(w,v)),o}const Qi={};function Jh(r){Xh(lr(),Sn(),Yo()+r,E())}function Xh(r,o,a,p){if(!p)if(3==(3&o[2])){const w=r.preOrderCheckHooks;null!==w&&Pa(o,w,a)}else{const w=r.preOrderHooks;null!==w&&ra(o,w,0,a)}Ss(a)}function Od(r,o){return r<<17|o<<2}function qa(r){return r>>17&32767}function Kh(r){return 2|r}function zl(r){return(131068&r)>>2}function uu(r,o){return-131069&r|o<<2}function Rd(r){return 1|r}function Nd(r,o){const a=r.contentQueries;if(null!==a)for(let p=0;p<a.length;p+=2){const v=a[p],w=a[p+1];if(-1!==w){const A=r.data[w];ga(v),A.contentQueries(2,o[w],w)}}}function Zl(r,o,a,p,v,w,A,N,G,fe){const be=o.blueprint.slice();return be[0]=v,be[2]=140|p,zs(be),be[3]=be[15]=r,be[8]=a,be[10]=A||r&&r[10],be[11]=N||r&&r[11],be[12]=G||r&&r[12]||null,be[9]=fe||r&&r[9]||null,be[6]=w,be[16]=2==o.type?r[16]:be,be}function Ha(r,o,a,p,v){let w=r.data[o];if(null===w)w=function Gu(r,o,a,p,v){const w=il(),A=fa(),G=r.data[o]=function Jf(r,o,a,p,v,w){return{type:a,index:p,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:v,attrs:w,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,A?w:w&&w.parent,a,o,p,v);return null===r.firstChild&&(r.firstChild=G),null!==w&&(A?null==w.child&&null!==G.parent&&(w.child=G):null===w.next&&(w.next=G)),G}(r,o,a,p,v),function ui(){return Si.lFrame.inI18n}()&&(w.flags|=64);else if(64&w.type){w.type=a,w.value=p,w.attrs=v;const A=function Us(){const r=Si.lFrame,o=r.currentTNode;return r.isParent?o:o.parent}();w.injectorIndex=null===A?-1:A.injectorIndex}return is(w,!0),w}function Vl(r,o,a,p){if(0===a)return-1;const v=o.length;for(let w=0;w<a;w++)o.push(p),r.blueprint.push(p),r.data.push(null);return v}function qu(r,o,a){rl(o);try{const p=r.viewQuery;null!==p&&_u(1,p,a);const v=r.template;null!==v&&Yf(r,o,v,1,a),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&Nd(r,o),r.staticViewQueries&&_u(2,r.viewQuery,a);const w=r.components;null!==w&&function ca(r,o){for(let a=0;a<o.length;a++)Bg(r,o[a])}(o,w)}catch(p){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),p}finally{o[2]&=-5,Sa()}}function Zc(r,o,a,p){const v=o[2];if(256==(256&v))return;rl(o);const w=E();try{zs(o),function In(r){return Si.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==a&&Yf(r,o,a,2,p);const A=3==(3&v);if(!w)if(A){const fe=r.preOrderCheckHooks;null!==fe&&Pa(o,fe,null)}else{const fe=r.preOrderHooks;null!==fe&&ra(o,fe,0,null),_a(o,0)}if(function mp(r){for(let o=gl(r);null!==o;o=Os(o)){if(!o[2])continue;const a=o[9];for(let p=0;p<a.length;p++){const v=a[p],w=v[3];0==(1024&v[2])&&As(w,1),v[2]|=1024}}}(o),function Gd(r){for(let o=gl(r);null!==o;o=Os(o))for(let a=10;a<o.length;a++){const p=o[a],v=p[1];xr(p)&&Zc(v,p,v.template,p[8])}}(o),null!==r.contentQueries&&Nd(r,o),!w)if(A){const fe=r.contentCheckHooks;null!==fe&&Pa(o,fe)}else{const fe=r.contentHooks;null!==fe&&ra(o,fe,1),_a(o,1)}!function ap(r,o){const a=r.hostBindingOpCodes;if(null!==a)try{for(let p=0;p<a.length;p++){const v=a[p];if(v<0)Ss(~v);else{const w=v,A=a[++p],N=a[++p];hr(A,w),N(2,o[w])}}}finally{Ss(-1)}}(r,o);const N=r.components;null!==N&&function Hf(r,o){for(let a=0;a<o.length;a++)Fg(r,o[a])}(o,N);const G=r.viewQuery;if(null!==G&&_u(2,G,p),!w)if(A){const fe=r.viewCheckHooks;null!==fe&&Pa(o,fe)}else{const fe=r.viewHooks;null!==fe&&ra(o,fe,2),_a(o,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),w||(o[2]&=-73),1024&o[2]&&(o[2]&=-1025,As(o[3],-1))}finally{Sa()}}function Wf(r,o,a,p){const v=o[10],w=!E(),A=Ir(o);try{w&&!A&&v.begin&&v.begin(),A&&qu(r,o,p),Zc(r,o,a,p)}finally{w&&!A&&v.end&&v.end()}}function Yf(r,o,a,p,v){const w=Yo(),A=2&p;try{Ss(-1),A&&o.length>20&&Xh(r,o,20,E()),a(p,v)}finally{Ss(w)}}function lp(r,o,a){if($r(o)){const v=o.directiveEnd;for(let w=o.directiveStart;w<v;w++){const A=r.data[w];A.contentQueries&&A.contentQueries(1,a[w],w)}}}function zd(r,o,a){!Cl()||(function $d(r,o,a,p){const v=a.directiveStart,w=a.directiveEnd;r.firstCreatePass||wa(a,o),_s(p,o);const A=a.initialInputs;for(let N=v;N<w;N++){const G=r.data[N],fe=nr(G);fe&&nm(o,a,G);const be=ul(o,r,N,a);_s(be,o),null!==A&&Lg(0,N-v,be,G,0,A),fe&&(ti(a.index,o)[8]=be)}}(r,o,a,ee(a,o)),128==(128&a.flags)&&function Pg(r,o,a){const p=a.directiveStart,v=a.directiveEnd,A=a.index,N=function Or(){return Si.lFrame.currentDirectiveIndex}();try{Ss(A);for(let G=p;G<v;G++){const fe=r.data[G],be=o[G];eo(G),(null!==fe.hostBindings||0!==fe.hostVars||null!==fe.hostAttrs)&&Qf(fe,be)}}finally{Ss(-1),eo(N)}}(r,o,a))}function Hu(r,o,a=ee){const p=o.localNames;if(null!==p){let v=o.index+1;for(let w=0;w<p.length;w+=2){const A=p[w+1],N=-1===A?a(o,r):r[A];r[v++]=N}}}function Ud(r){const o=r.tView;return null===o||o.incompleteFirstPass?r.tView=Wu(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts):o}function Wu(r,o,a,p,v,w,A,N,G,fe){const be=20+p,et=be+v,Et=function Dg(r,o){const a=[];for(let p=0;p<o;p++)a.push(p<r?null:Qi);return a}(be,et),jt="function"==typeof fe?fe():fe;return Et[1]={type:r,blueprint:Et,template:a,queries:null,viewQuery:N,declTNode:o,data:Et.slice().fill(null,be),bindingStartIndex:be,expandoStartIndex:et,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof w?w():w,pipeRegistry:"function"==typeof A?A():A,firstChild:null,schemas:G,consts:jt,incompleteFirstPass:!1}}function dp(r,o,a,p){const v=om(o);null===a?v.push(p):(v.push(a),r.firstCreatePass&&sm(r).push(p,v.length-1))}function hp(r,o,a){for(let p in r)if(r.hasOwnProperty(p)){const v=r[p];(a=null===a?{}:a).hasOwnProperty(p)?a[p].push(o,v):a[p]=[o,v]}return a}function Ys(r,o,a,p,v,w,A,N){const G=ee(o,a);let be,fe=o.inputs;!N&&null!=fe&&(be=fe[p])?(xp(r,a,be,p,v),Hi(o)&&function Xf(r,o){const a=ti(o,r);16&a[2]||(a[2]|=64)}(a,o.index)):3&o.type&&(p=function Mg(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(p),v=null!=A?A(v,o.value||"",p):v,Wn(w)?w.setProperty(G,p,v):ya(p)||(G.setProperty?G.setProperty(p,v):G[p]=v))}function fu(r,o,a,p){let v=!1;if(Cl()){const w=function Og(r,o,a){const p=r.directiveRegistry;let v=null;if(p)for(let w=0;w<p.length;w++){const A=p[w];Ff(a,A.selectors,!1)&&(v||(v=[]),Ba(wa(a,o),r,A.type),nr(A)?(em(r,a),v.unshift(A)):v.push(A))}return v}(r,o,a),A=null===p?null:{"":-1};if(null!==w){v=!0,jd(a,r.data.length,w.length);for(let be=0;be<w.length;be++){const et=w[be];et.providersResolver&&et.providersResolver(et)}let N=!1,G=!1,fe=Vl(r,o,w.length,null);for(let be=0;be<w.length;be++){const et=w[be];a.mergedAttrs=ka(a.mergedAttrs,et.hostAttrs),tm(r,a,o,fe,et),mu(fe,et,A),null!==et.contentQueries&&(a.flags|=8),(null!==et.hostBindings||null!==et.hostAttrs||0!==et.hostVars)&&(a.flags|=128);const Et=et.type.prototype;!N&&(Et.ngOnChanges||Et.ngOnInit||Et.ngDoCheck)&&((r.preOrderHooks||(r.preOrderHooks=[])).push(a.index),N=!0),!G&&(Et.ngOnChanges||Et.ngDoCheck)&&((r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(a.index),G=!0),fe++}!function Ig(r,o){const p=o.directiveEnd,v=r.data,w=o.attrs,A=[];let N=null,G=null;for(let fe=o.directiveStart;fe<p;fe++){const be=v[fe],et=be.inputs,Et=null===w||Lf(o)?null:uc(et,w);A.push(Et),N=hp(et,fe,N),G=hp(be.outputs,fe,G)}null!==N&&(N.hasOwnProperty("class")&&(o.flags|=16),N.hasOwnProperty("style")&&(o.flags|=32)),o.initialInputs=A,o.inputs=N,o.outputs=G}(r,a)}A&&function Rg(r,o,a){if(o){const p=r.localNames=[];for(let v=0;v<o.length;v+=2){const w=a[o[v+1]];if(null==w)throw new Re(-301,!1);p.push(o[v],w)}}}(a,p,A)}return a.mergedAttrs=ka(a.mergedAttrs,a.attrs),v}function pp(r,o,a,p,v,w){const A=w.hostBindings;if(A){let N=r.hostBindingOpCodes;null===N&&(N=r.hostBindingOpCodes=[]);const G=~o.index;(function Vd(r){let o=r.length;for(;o>0;){const a=r[--o];if("number"==typeof a&&a<0)return a}return 0})(N)!=G&&N.push(G),N.push(p,v,A)}}function Qf(r,o){null!==r.hostBindings&&r.hostBindings(1,o)}function em(r,o){o.flags|=2,(r.components||(r.components=[])).push(o.index)}function mu(r,o,a){if(a){if(o.exportAs)for(let p=0;p<o.exportAs.length;p++)a[o.exportAs[p]]=r;nr(o)&&(a[""]=r)}}function jd(r,o,a){r.flags|=1,r.directiveStart=o,r.directiveEnd=o+a,r.providerIndexes=o}function tm(r,o,a,p,v){r.data[p]=v;const w=v.factory||(v.factory=ro(v.type)),A=new Oa(w,nr(v),null);r.blueprint[p]=A,a[p]=A,pp(r,o,0,p,Vl(r,a,v.hostVars,Qi),v)}function nm(r,o,a){const p=ee(o,r),v=Ud(a),w=r[10],A=gu(r,Zl(r,v,null,a.onPush?64:16,p,o,w,w.createRenderer(p,a),null,null));r[o.index]=A}function yl(r,o,a,p,v,w){const A=ee(r,o);!function Xu(r,o,a,p,v,w,A){if(null==w)Wn(r)?r.removeAttribute(o,v,a):o.removeAttribute(v);else{const N=null==A?Ge(w):A(w,p||"",v);Wn(r)?r.setAttribute(o,v,N,a):a?o.setAttributeNS(a,v,N):o.setAttribute(v,N)}}(o[11],A,w,r.value,a,p,v)}function Lg(r,o,a,p,v,w){const A=w[o];if(null!==A){const N=p.setInput;for(let G=0;G<A.length;){const fe=A[G++],be=A[G++],et=A[G++];null!==N?p.setInput(a,et,fe,be):a[be]=et}}}function uc(r,o){let a=null,p=0;for(;p<o.length;){const v=o[p];if(0!==v)if(5!==v){if("number"==typeof v)break;r.hasOwnProperty(v)&&(null===a&&(a=[]),a.push(v,r[v],o[p+1])),p+=2}else p+=2;else p+=4}return a}function fp(r,o,a,p){return new Array(r,!0,!1,o,null,0,p,a,null,null)}function Fg(r,o){const a=ti(o,r);if(xr(a)){const p=a[1];80&a[2]?Zc(p,a,p.template,a[8]):a[5]>0&&gp(a)}}function gp(r){for(let p=gl(r);null!==p;p=Os(p))for(let v=10;v<p.length;v++){const w=p[v];if(1024&w[2]){const A=w[1];Zc(A,w,A.template,w[8])}else w[5]>0&&gp(w)}const a=r[1].components;if(null!==a)for(let p=0;p<a.length;p++){const v=ti(a[p],r);xr(v)&&v[5]>0&&gp(v)}}function Bg(r,o){const a=ti(o,r),p=a[1];(function qd(r,o){for(let a=o.length;a<r.blueprint.length;a++)o.push(r.blueprint[a])})(p,a),qu(p,a,a[8])}function gu(r,o){return r[13]?r[14][4]=o:r[13]=o,r[14]=o,o}function _p(r){for(;r;){r[2]|=64;const o=Rc(r);if(vo(r)&&!o)return r;r=o}return null}function vl(r,o,a){const p=o[10];p.begin&&p.begin();try{Zc(r,o,r.template,a)}catch(v){throw am(o,v),v}finally{p.end&&p.end()}}function im(r){!function Ku(r){for(let o=0;o<r.components.length;o++){const a=r.components[o],p=oc(a),v=p[1];Wf(v,p,v.template,a)}}(r[8])}function _u(r,o,a){ga(0),o(r,a)}const Ng=(()=>Promise.resolve(null))();function om(r){return r[7]||(r[7]=[])}function sm(r){return r.cleanup||(r.cleanup=[])}function am(r,o){const a=r[9],p=a?a.get(iu,null):null;p&&p.handleError(o)}function xp(r,o,a,p,v){for(let w=0;w<a.length;){const A=a[w++],N=a[w++],G=o[A],fe=r.data[A];null!==fe.setInput?fe.setInput(G,v,p,N):G[N]=v}}function xl(r,o,a){const p=ae(o,r);!function Ef(r,o,a){Wn(r)?r.setValue(o,a):o.textContent=a}(r[11],p,a)}function Qu(r,o,a){let p=a?r.styles:null,v=a?r.classes:null,w=0;if(null!==o)for(let A=0;A<o.length;A++){const N=o[A];"number"==typeof N?w=N:1==w?v=je(v,N):2==w&&(p=je(p,N+": "+o[++A]+";"))}a?r.styles=p:r.stylesWithoutHost=p,a?r.classes=v:r.classesWithoutHost=v}const ed=new Mr("INJECTOR",-1);class cm{get(o,a=bn){if(a===bn){const p=new Error(`NullInjectorError: No provider for ${xe(o)}!`);throw p.name="NullInjectorError",p}return a}}const wp=new Mr("Set Injector scope."),yu={},zg={};let Yd;function td(){return void 0===Yd&&(Yd=new cm),Yd}function Jd(r,o=null,a=null,p){const v=Es(r,o,a,p);return v._resolveInjectorDefTypes(),v}function Es(r,o=null,a=null,p){return new nd(r,a,o||td(),p)}class nd{constructor(o,a,p,v=null){this.parent=p,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const w=[];a&&I(a,N=>this.processProvider(N,o,a)),I([o],N=>this.processInjectorType(N,[],w)),this.records.set(ed,hc(void 0,this));const A=this.records.get(wp);this.scope=null!=A?A.value:null,this.source=v||("object"==typeof o?null:xe(o))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(o=>o.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(o,a=bn,p=ut.Default){this.assertNotDestroyed();const v=Xr(this),w=me(void 0);try{if(!(p&ut.SkipSelf)){let N=this.records.get(o);if(void 0===N){const G=function pm(r){return"function"==typeof r||"object"==typeof r&&r instanceof Mr}(o)&&zi(o);N=G&&this.injectableDefInScope(G)?hc(dc(o),yu):null,this.records.set(o,N)}if(null!=N)return this.hydrate(o,N)}return(p&ut.Self?td():this.parent).get(o,a=p&ut.Optional&&a===bn?null:a)}catch(A){if("NullInjectorError"===A.name){if((A[di]=A[di]||[]).unshift(xe(o)),v)throw A;return function wr(r,o,a,p){const v=r[di];throw o[vi]&&v.unshift(o[vi]),r.message=function Ji(r,o,a,p=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.substr(2):r;let v=xe(o);if(Array.isArray(o))v=o.map(xe).join(" -> ");else if("object"==typeof o){let w=[];for(let A in o)if(o.hasOwnProperty(A)){let N=o[A];w.push(A+":"+("string"==typeof N?JSON.stringify(N):xe(N)))}v=`{${w.join(", ")}}`}return`${a}${p?"("+p+")":""}[${v}]: ${r.replace(rr,"\n  ")}`}("\n"+r.message,v,a,p),r.ngTokenPath=v,r[di]=null,r}(A,o,"R3InjectorError",this.source)}throw A}finally{me(w),Xr(v)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(o=>this.get(o))}toString(){const o=[];return this.records.forEach((p,v)=>o.push(xe(v))),`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Re(205,!1)}processInjectorType(o,a,p){if(!(o=ke(o)))return!1;let v=xi(o);const w=null==v&&o.ngModule||void 0,A=void 0===w?o:w,N=-1!==p.indexOf(A);if(void 0!==w&&(v=xi(w)),null==v)return!1;if(null!=v.imports&&!N){let be;p.push(A);try{I(v.imports,et=>{this.processInjectorType(et,a,p)&&(void 0===be&&(be=[]),be.push(et))})}finally{}if(void 0!==be)for(let et=0;et<be.length;et++){const{ngModule:Et,providers:jt}=be[et];I(jt,Cn=>this.processProvider(Cn,Et,jt||_n))}}this.injectorDefTypes.add(A);const G=ro(A)||(()=>new A);this.records.set(A,hc(G,yu));const fe=v.providers;if(null!=fe&&!N){const be=o;I(fe,et=>this.processProvider(et,be,fe))}return void 0!==w&&void 0!==o.providers}processProvider(o,a,p){let v=Vc(o=ke(o))?o:ke(o&&o.provide);const w=function Cp(r,o,a){return Xd(r)?hc(void 0,r.useValue):hc(Wa(r),yu)}(o);if(Vc(o)||!0!==o.multi)this.records.get(v);else{let A=this.records.get(v);A||(A=hc(void 0,yu,!0),A.factory=()=>ds(A.multi),this.records.set(v,A)),v=o,A.multi.push(o)}this.records.set(v,w)}hydrate(o,a){return a.value===yu&&(a.value=zg,a.value=a.factory()),"object"==typeof a.value&&a.value&&function hm(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(a.value)&&this.onDestroy.add(a.value),a.value}injectableDefInScope(o){if(!o.providedIn)return!1;const a=ke(o.providedIn);return"string"==typeof a?"any"===a||a===this.scope:this.injectorDefTypes.has(a)}}function dc(r){const o=zi(r),a=null!==o?o.factory:ro(r);if(null!==a)return a;if(r instanceof Mr)throw new Re(204,!1);if(r instanceof Function)return function Tp(r){const o=r.length;if(o>0)throw ne(o,"?"),new Re(204,!1);const a=function ji(r){const o=r&&(r[Qt]||r[te]);if(o){const a=function _i(r){if(r.hasOwnProperty("name"))return r.name;const o=(""+r).match(/^function\s*([^\s(]+)/);return null===o?"":o[1]}(r);return console.warn(`DEPRECATED: DI is instantiating a token "${a}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${a}" class.`),o}return null}(r);return null!==a?()=>a.factory(r):()=>new r}(r);throw new Re(204,!1)}function Wa(r,o,a){let p;if(Vc(r)){const v=ke(r);return ro(v)||dc(v)}if(Xd(r))p=()=>ke(r.useValue);else if(function um(r){return!(!r||!r.useFactory)}(r))p=()=>r.useFactory(...ds(r.deps||[]));else if(function Ya(r){return!(!r||!r.useExisting)}(r))p=()=>Li(ke(r.useExisting));else{const v=ke(r&&(r.useClass||r.provide));if(!function dm(r){return!!r.deps}(r))return ro(v)||dc(v);p=()=>new v(...ds(r.deps))}return p}function hc(r,o,a=!1){return{factory:r,value:o,multi:a?[]:void 0}}function Xd(r){return null!==r&&"object"==typeof r&&Yi in r}function Vc(r){return"function"==typeof r}let ua=(()=>{class r{static create(a,p){if(Array.isArray(a))return Jd({name:""},p,a,"");{const v=a.name??"";return Jd({name:v},a.parent,a.providers,v)}}}return r.THROW_IF_NOT_FOUND=bn,r.NULL=new cm,r.\u0275prov=ei({token:r,providedIn:"any",factory:()=>Li(ed)}),r.__NG_ELEMENT_ID__=-1,r})();function vm(r,o){pr(oc(r)[1],Co())}function Ds(r){let o=function th(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),a=!0;const p=[r];for(;o;){let v;if(nr(r))v=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new Re(903,"");v=o.\u0275dir}if(v){if(a){p.push(v);const A=r;A.inputs=Op(r.inputs),A.declaredInputs=Op(r.declaredInputs),A.outputs=Op(r.outputs);const N=v.hostBindings;N&&Rp(r,N);const G=v.viewQuery,fe=v.contentQueries;if(G&&nh(r,G),fe&&xm(r,fe),ge(r.inputs,v.inputs),ge(r.declaredInputs,v.declaredInputs),ge(r.outputs,v.outputs),nr(v)&&v.data.animation){const be=r.data;be.animation=(be.animation||[]).concat(v.data.animation)}}const w=v.features;if(w)for(let A=0;A<w.length;A++){const N=w[A];N&&N.ngInherit&&N(r),N===Ds&&(a=!1)}}o=Object.getPrototypeOf(o)}!function Js(r){let o=0,a=null;for(let p=r.length-1;p>=0;p--){const v=r[p];v.hostVars=o+=v.hostVars,v.hostAttrs=ka(v.hostAttrs,a=ka(a,v.hostAttrs))}}(p)}function Op(r){return r===Rr?{}:r===_n?[]:r}function nh(r,o){const a=r.viewQuery;r.viewQuery=a?(p,v)=>{o(p,v),a(p,v)}:o}function xm(r,o){const a=r.contentQueries;r.contentQueries=a?(p,v,w)=>{o(p,v,w),a(p,v,w)}:o}function Rp(r,o){const a=r.hostBindings;r.hostBindings=a?(p,v)=>{o(p,v),a(p,v)}:o}let id=null;function fc(){if(!id){const r=Pi.Symbol;if(r&&r.iterator)id=r.iterator;else{const o=Object.getOwnPropertyNames(Map.prototype);for(let a=0;a<o.length;++a){const p=o[a];"entries"!==p&&"size"!==p&&Map.prototype[p]===Map.prototype.entries&&(id=p)}}}return id}function bu(r){return!!rh(r)&&(Array.isArray(r)||!(r instanceof Map)&&fc()in r)}function rh(r){return null!==r&&("function"==typeof r||"object"==typeof r)}function Ka(r,o,a){return r[o]=a}function zo(r,o,a){return!Object.is(r[o],a)&&(r[o]=a,!0)}function jc(r,o,a,p){const v=zo(r,o,a);return zo(r,o+1,p)||v}function Gc(r,o,a,p){const v=Sn();return zo(v,Vn(),o)&&(lr(),yl(to(),v,r,o,a,p)),Gc}function Gl(r,o,a,p){return zo(r,Vn(),a)?o+Ge(a)+p:Qi}function Tu(r,o,a,p,v,w,A,N){const fe=function mc(r,o,a,p,v){const w=jc(r,o,a,p);return zo(r,o+2,v)||w}(r,vt(),a,v,A);return wi(3),fe?o+Ge(a)+p+Ge(v)+w+Ge(A)+N:Qi}function Qa(r,o,a,p,v,w,A,N,G,fe){const et=function Is(r,o,a,p,v,w){const A=jc(r,o,a,p);return jc(r,o+2,v,w)||A}(r,vt(),a,v,A,G);return wi(4),et?o+Ge(a)+p+Ge(v)+w+Ge(A)+N+Ge(G)+fe:Qi}function b(r,o,a,p,v,w,A,N){const G=Sn(),fe=lr(),be=r+20,et=fe.firstCreatePass?function y(r,o,a,p,v,w,A,N,G){const fe=o.consts,be=Ha(o,r,4,A||null,Ao(fe,N));fu(o,a,be,Ao(fe,G)),pr(o,be);const et=be.tViews=Wu(2,be,p,v,w,o.directiveRegistry,o.pipeRegistry,null,o.schemas,fe);return null!==o.queries&&(o.queries.template(o,be),et.queries=o.queries.embeddedTView(be)),be}(be,fe,G,o,a,p,v,w,A):fe.data[be];is(et,!1);const Et=G[11].createComment("");lu(fe,G,Et,et),_s(Et,G),gu(G,G[be]=fp(Et,G,Et,et)),Er(et)&&zd(fe,G,et),null!=A&&Hu(G,et,N)}function M(r){return hn(function Y(){return Si.lFrame.contextLView}(),20+r)}function ss(r,o=ut.Default){const a=Sn();return null===a?Li(r,o):Sc(Co(),a,ke(r),o)}function co(){throw new Error("invalid")}function Uo(r,o,a){const p=Sn();return zo(p,Vn(),o)&&Ys(lr(),to(),p,r,o,p[11],a,!1),Uo}function Ks(r,o,a,p,v){const A=v?"class":"style";xp(r,a,o.inputs[A],A,p)}function qr(r,o,a,p){const v=Sn(),w=lr(),A=20+r,N=v[11],G=v[A]=Nh(N,o,function Yc(){return Si.lFrame.currentNamespace}()),fe=w.firstCreatePass?function as(r,o,a,p,v,w,A){const N=o.consts,fe=Ha(o,r,2,v,Ao(N,w));return fu(o,a,fe,Ao(N,A)),null!==fe.attrs&&Qu(fe,fe.attrs,!1),null!==fe.mergedAttrs&&Qu(fe,fe.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,fe),fe}(A,w,v,0,o,a,p):w.data[A];is(fe,!0);const be=fe.mergedAttrs;null!==be&&La(N,G,be);const et=fe.classes;null!==et&&qh(N,G,et);const Et=fe.styles;null!==Et&&Of(N,G,Et),64!=(64&fe.flags)&&lu(w,v,G,fe),0===function Aa(){return Si.lFrame.elementDepthCount}()&&_s(G,v),function br(){Si.lFrame.elementDepthCount++}(),Er(fe)&&(zd(w,v,fe),lp(w,fe,v)),null!==p&&Hu(v,fe)}function Zo(){let r=Co();fa()?ma():(r=r.parent,is(r,!1));const o=r;!function pa(){Si.lFrame.elementDepthCount--}();const a=lr();a.firstCreatePass&&(pr(a,r),$r(r)&&a.queries.elementEnd(r)),null!=o.classesWithoutHost&&function sl(r){return 0!=(16&r.flags)}(o)&&Ks(a,o,Sn(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function Dc(r){return 0!=(32&r.flags)}(o)&&Ks(a,o,Sn(),o.stylesWithoutHost,!1)}function fo(r,o,a,p){qr(r,o,a,p),Zo()}function ls(r,o,a){const p=Sn(),v=lr(),w=r+20,A=v.firstCreatePass?function qo(r,o,a,p,v){const w=o.consts,A=Ao(w,p),N=Ha(o,r,8,"ng-container",A);return null!==A&&Qu(N,A,!0),fu(o,a,N,Ao(w,v)),null!==o.queries&&o.queries.elementStart(o,N),N}(w,v,p,o,a):v.data[w];is(A,!0);const N=p[w]=p[11].createComment("");lu(v,p,N,A),_s(N,p),Er(A)&&(zd(v,p,A),lp(v,A,p)),null!=a&&Hu(p,A)}function gs(){let r=Co();const o=lr();fa()?ma():(r=r.parent,is(r,!1)),o.firstCreatePass&&(pr(o,r),$r(r)&&o.queries.elementEnd(r))}function vs(r,o,a){ls(r,o,a),gs()}function Ho(){return Sn()}function da(r){return!!r&&"function"==typeof r.then}function Hc(r){return!!r&&"function"==typeof r.subscribe}const Du=Hc;function Wc(r,o,a,p){const v=Sn(),w=lr(),A=Co();return function Np(r,o,a,p,v,w,A,N){const G=Er(p),be=r.firstCreatePass&&sm(r),et=o[8],Et=om(o);let jt=!0;if(3&p.type||N){const ri=ee(p,o),Ci=N?N(ri):ri,Rn=Et.length,qi=N?Zr=>N(Oi(Zr[p.index])):p.index;if(Wn(a)){let Zr=null;if(!N&&G&&(Zr=function Cm(r,o,a,p){const v=r.cleanup;if(null!=v)for(let w=0;w<v.length-1;w+=2){const A=v[w];if(A===a&&v[w+1]===p){const N=o[7],G=v[w+2];return N.length>G?N[G]:null}"string"==typeof A&&(w+=2)}return null}(r,o,v,p.index)),null!==Zr)(Zr.__ngLastListenerFn__||Zr).__ngNextListenerFn__=w,Zr.__ngLastListenerFn__=w,jt=!1;else{w=od(p,o,et,w,!1);const mo=a.listen(Ci,v,w);Et.push(w,mo),be&&be.push(v,qi,Rn,Rn+1)}}else w=od(p,o,et,w,!0),Ci.addEventListener(v,w,A),Et.push(w),be&&be.push(v,qi,Rn,A)}else w=od(p,o,et,w,!1);const Cn=p.outputs;let Jn;if(jt&&null!==Cn&&(Jn=Cn[v])){const ri=Jn.length;if(ri)for(let Ci=0;Ci<ri;Ci+=2){const tl=o[Jn[Ci]][Jn[Ci+1]].subscribe(w),cd=Et.length;Et.push(w,tl),be&&be.push(v,p.index,cd,-(cd+1))}}}(w,v,v[11],A,r,o,!!a,p),Wc}function zp(r,o,a,p){try{return!1!==a(p)}catch(v){return am(r,v),!1}}function od(r,o,a,p,v){return function w(A){if(A===Function)return p;const N=2&r.flags?ti(r.index,o):o;0==(32&o[2])&&_p(N);let G=zp(o,0,p,A),fe=w.__ngNextListenerFn__;for(;fe;)G=zp(o,0,fe,A)&&G,fe=fe.__ngNextListenerFn__;return v&&!1===G&&(A.preventDefault(),A.returnValue=!1),G}}function oh(r=1){return function Kl(r){return(Si.lFrame.contextLView=function ws(r,o){for(;r>0;)o=o[15],r--;return o}(r,Si.lFrame.contextLView))[8]}(r)}function wl(r,o){let a=null;const p=function zc(r){const o=r.attrs;if(null!=o){const a=o.indexOf(5);if(0==(1&a))return o[a+1]}return null}(r);for(let v=0;v<o.length;v++){const w=o[v];if("*"!==w){if(null===p?Ff(r,w,!0):Vu(p,w))return v}else a=v}return a}function Up(r){const o=Sn()[16][6];if(!o.projection){const p=o.projection=ne(r?r.length:1,null),v=p.slice();let w=o.child;for(;null!==w;){const A=r?wl(w,r):0;null!==A&&(v[A]?v[A].projectionNext=w:p[A]=w,v[A]=w),w=w.next}}}function sh(r,o=0,a){const p=Sn(),v=lr(),w=Ha(v,20+r,16,null,a||null);null===w.projection&&(w.projection=o),ma(),64!=(64&w.flags)&&function Gh(r,o,a){Sd(o[11],0,o,a,Af(r,a,o),au(a.parent||o[6],a,o))}(v,p,w)}function sd(r,o,a){return Tl(r,"",o,"",a),sd}function Tl(r,o,a,p,v){const w=Sn(),A=Gl(w,o,a,p);return A!==Qi&&Ys(lr(),to(),w,r,A,w[11],v,!1),Tl}function ey(r,o,a,p,v){const w=r[a+1],A=null===o;let N=p?qa(w):zl(w),G=!1;for(;0!==N&&(!1===G||A);){const be=r[N+1];M0(r[N],o)&&(G=!0,r[N+1]=p?Rd(be):Kh(be)),N=p?qa(be):zl(be)}G&&(r[a+1]=p?Kh(w):Rd(w))}function M0(r,o){return null===r||null==o||(Array.isArray(r)?r[1]:r)===o||!(!Array.isArray(r)||"string"!=typeof o)&&at(r,o)>=0}function Gg(r,o,a){return Hl(r,o,a,!1),Gg}function qg(r,o){return Hl(r,o,null,!0),qg}function Hl(r,o,a,p){const v=Sn(),w=lr(),A=wi(2);w.firstUpdatePass&&function ly(r,o,a,p){const v=r.data;if(null===v[a+1]){const w=v[Yo()],A=function ay(r,o){return o>=r.expandoStartIndex}(r,a);(function hy(r,o){return 0!=(r.flags&(o?16:32))})(w,p)&&null===o&&!A&&(o=!1),o=function B0(r,o,a,p){const v=function Lo(r){const o=Si.lFrame.currentDirectiveIndex;return-1===o?null:r[o]}(r);let w=p?o.residualClasses:o.residualStyles;if(null===v)0===(p?o.classBindings:o.styleBindings)&&(a=Vp(a=Hg(null,r,o,a,p),o.attrs,p),w=null);else{const A=o.directiveStylingLast;if(-1===A||r[A]!==v)if(a=Hg(v,r,o,a,p),null===w){let G=function N0(r,o,a){const p=a?o.classBindings:o.styleBindings;if(0!==zl(p))return r[qa(p)]}(r,o,p);void 0!==G&&Array.isArray(G)&&(G=Hg(null,r,o,G[1],p),G=Vp(G,o.attrs,p),function z0(r,o,a,p){r[qa(a?o.classBindings:o.styleBindings)]=p}(r,o,p,G))}else w=function U0(r,o,a){let p;const v=o.directiveEnd;for(let w=1+o.directiveStylingLast;w<v;w++)p=Vp(p,r[w].hostAttrs,a);return Vp(p,o.attrs,a)}(r,o,p)}return void 0!==w&&(p?o.residualClasses=w:o.residualStyles=w),a}(v,w,o,p),function D0(r,o,a,p,v,w){let A=w?o.classBindings:o.styleBindings,N=qa(A),G=zl(A);r[p]=a;let be,fe=!1;if(Array.isArray(a)){const et=a;be=et[1],(null===be||at(et,be)>0)&&(fe=!0)}else be=a;if(v)if(0!==G){const Et=qa(r[N+1]);r[p+1]=Od(Et,N),0!==Et&&(r[Et+1]=uu(r[Et+1],p)),r[N+1]=function vg(r,o){return 131071&r|o<<17}(r[N+1],p)}else r[p+1]=Od(N,0),0!==N&&(r[N+1]=uu(r[N+1],p)),N=p;else r[p+1]=Od(G,0),0===N?N=p:r[G+1]=uu(r[G+1],p),G=p;fe&&(r[p+1]=Kh(r[p+1])),ey(r,be,p,!0),ey(r,be,p,!1),function I0(r,o,a,p,v){const w=v?r.residualClasses:r.residualStyles;null!=w&&"string"==typeof o&&at(w,o)>=0&&(a[p+1]=Rd(a[p+1]))}(o,be,r,p,w),A=Od(N,G),w?o.classBindings=A:o.styleBindings=A}(v,w,o,a,A,p)}}(w,r,A,p),o!==Qi&&zo(v,A,o)&&function uy(r,o,a,p,v,w,A,N){if(!(3&o.type))return;const G=r.data,fe=G[N+1];Dm(function zf(r){return 1==(1&r)}(fe)?dy(G,o,a,v,zl(fe),A):void 0)||(Dm(w)||function Nf(r){return 2==(2&r)}(fe)&&(w=dy(G,null,a,v,N,A)),function hg(r,o,a,p,v){const w=Wn(r);if(o)v?w?r.addClass(a,p):a.classList.add(p):w?r.removeClass(a,p):a.classList.remove(p);else{let A=-1===p.indexOf("-")?void 0:ml.DashCase;if(null==v)w?r.removeStyle(a,p,A):a.style.removeProperty(p);else{const N="string"==typeof v&&v.endsWith("!important");N&&(v=v.slice(0,-10),A|=ml.Important),w?r.setStyle(a,p,v,A):a.style.setProperty(p,v,N?"important":"")}}}(p,A,ae(Yo(),a),v,w))}(w,w.data[Yo()],v,v[11],r,v[A+1]=function $0(r,o){return null==r||("string"==typeof o?r+=o:"object"==typeof r&&(r=xe(dl(r)))),r}(o,a),p,A)}function Hg(r,o,a,p,v){let w=null;const A=a.directiveEnd;let N=a.directiveStylingLast;for(-1===N?N=a.directiveStart:N++;N<A&&(w=o[N],p=Vp(p,w.hostAttrs,v),w!==r);)N++;return null!==r&&(a.directiveStylingLast=N),p}function Vp(r,o,a){const p=a?1:2;let v=-1;if(null!==o)for(let w=0;w<o.length;w++){const A=o[w];"number"==typeof A?v=A:v===p&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),ct(r,A,!!a||o[++w]))}return void 0===r?null:r}function dy(r,o,a,p,v,w){const A=null===o;let N;for(;v>0;){const G=r[v],fe=Array.isArray(G),be=fe?G[1]:G,et=null===be;let Et=a[v+1];Et===Qi&&(Et=et?_n:void 0);let jt=et?ze(Et,p):be===p?Et:void 0;if(fe&&!Dm(jt)&&(jt=ze(G,p)),Dm(jt)&&(N=jt,A))return N;const Cn=r[v+1];v=A?qa(Cn):zl(Cn)}if(null!==o){let G=w?o.residualClasses:o.residualStyles;null!=G&&(N=ze(G,p))}return N}function Dm(r){return void 0!==r}function py(r,o=""){const a=Sn(),p=lr(),v=r+20,w=p.firstCreatePass?Ha(p,v,1,o,null):p.data[v],A=a[v]=function Bh(r,o){return Wn(r)?r.createText(o):r.createTextNode(o)}(a[11],o);lu(p,a,A,w),is(w,!1)}function Wg(r){return Im("",r,""),Wg}function Im(r,o,a){const p=Sn(),v=Gl(p,r,o,a);return v!==Qi&&xl(p,Yo(),v),Im}function Yg(r,o,a,p,v){const w=Sn(),A=function wu(r,o,a,p,v,w){const N=jc(r,vt(),a,v);return wi(2),N?o+Ge(a)+p+Ge(v)+w:Qi}(w,r,o,a,p,v);return A!==Qi&&xl(w,Yo(),A),Yg}function Jg(r,o,a,p,v,w,A){const N=Sn(),G=Tu(N,r,o,a,p,v,w,A);return G!==Qi&&xl(N,Yo(),G),Jg}function Xg(r,o,a,p,v,w,A,N,G){const fe=Sn(),be=Qa(fe,r,o,a,p,v,w,A,N,G);return be!==Qi&&xl(fe,Yo(),be),Xg}const ad=void 0;var cx=["en",[["a","p"],["AM","PM"],ad],[["AM","PM"],ad,ad],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],ad,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],ad,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",ad,"{1} 'at' {0}",ad],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function lx(r){const a=Math.floor(Math.abs(r)),p=r.toString().replace(/^[^.]*\.?/,"").length;return 1===a&&0===p?1:5}];let uh={};function Kg(r){const o=function ux(r){return r.toLowerCase().replace(/_/g,"-")}(r);let a=Py(o);if(a)return a;const p=o.split("-")[0];if(a=Py(p),a)return a;if("en"===p)return cx;throw new Error(`Missing locale data for the locale "${r}".`)}function Sy(r){return Kg(r)[Xi.PluralCase]}function Py(r){return r in uh||(uh[r]=Pi.ng&&Pi.ng.common&&Pi.ng.common.locales&&Pi.ng.common.locales[r]),uh[r]}var Xi=(()=>((Xi=Xi||{})[Xi.LocaleId=0]="LocaleId",Xi[Xi.DayPeriodsFormat=1]="DayPeriodsFormat",Xi[Xi.DayPeriodsStandalone=2]="DayPeriodsStandalone",Xi[Xi.DaysFormat=3]="DaysFormat",Xi[Xi.DaysStandalone=4]="DaysStandalone",Xi[Xi.MonthsFormat=5]="MonthsFormat",Xi[Xi.MonthsStandalone=6]="MonthsStandalone",Xi[Xi.Eras=7]="Eras",Xi[Xi.FirstDayOfWeek=8]="FirstDayOfWeek",Xi[Xi.WeekendRange=9]="WeekendRange",Xi[Xi.DateFormat=10]="DateFormat",Xi[Xi.TimeFormat=11]="TimeFormat",Xi[Xi.DateTimeFormat=12]="DateTimeFormat",Xi[Xi.NumberSymbols=13]="NumberSymbols",Xi[Xi.NumberFormats=14]="NumberFormats",Xi[Xi.CurrencyCode=15]="CurrencyCode",Xi[Xi.CurrencySymbol=16]="CurrencySymbol",Xi[Xi.CurrencyName=17]="CurrencyName",Xi[Xi.Currencies=18]="Currencies",Xi[Xi.Directionality=19]="Directionality",Xi[Xi.PluralCase=20]="PluralCase",Xi[Xi.ExtraData=21]="ExtraData",Xi))();const Mm="en-US";let Oy=Mm;function t_(r,o,a,p,v){if(r=ke(r),Array.isArray(r))for(let w=0;w<r.length;w++)t_(r[w],o,a,p,v);else{const w=lr(),A=Sn();let N=Vc(r)?r:ke(r.provide),G=Wa(r);const fe=Co(),be=1048575&fe.providerIndexes,et=fe.directiveStart,Et=fe.providerIndexes>>20;if(Vc(r)||!r.multi){const jt=new Oa(G,v,ss),Cn=i_(N,o,v?be:be+Et,et);-1===Cn?(Ba(wa(fe,A),w,N),n_(w,r,o.length),o.push(N),fe.directiveStart++,fe.directiveEnd++,v&&(fe.providerIndexes+=1048576),a.push(jt),A.push(jt)):(a[Cn]=jt,A[Cn]=jt)}else{const jt=i_(N,o,be+Et,et),Cn=i_(N,o,be,be+Et),Jn=jt>=0&&a[jt],ri=Cn>=0&&a[Cn];if(v&&!ri||!v&&!Jn){Ba(wa(fe,A),w,N);const Ci=function l1(r,o,a,p,v){const w=new Oa(r,a,ss);return w.multi=[],w.index=o,w.componentProviders=0,nv(w,v,p&&!a),w}(v?a1:s1,a.length,v,p,G);!v&&ri&&(a[Cn].providerFactory=Ci),n_(w,r,o.length,0),o.push(N),fe.directiveStart++,fe.directiveEnd++,v&&(fe.providerIndexes+=1048576),a.push(Ci),A.push(Ci)}else n_(w,r,jt>-1?jt:Cn,nv(a[v?Cn:jt],G,!v&&p));!v&&p&&ri&&a[Cn].componentProviders++}}}function n_(r,o,a,p){const v=Vc(o),w=function Ug(r){return!!r.useClass}(o);if(v||w){const G=(w?ke(o.useClass):o).prototype.ngOnDestroy;if(G){const fe=r.destroyHooks||(r.destroyHooks=[]);if(!v&&o.multi){const be=fe.indexOf(a);-1===be?fe.push(a,[p,G]):fe[be+1].push(p,G)}else fe.push(a,G)}}}function nv(r,o,a){return a&&r.componentProviders++,r.multi.push(o)-1}function i_(r,o,a,p){for(let v=a;v<p;v++)if(o[v]===r)return v;return-1}function s1(r,o,a,p){return r_(this.multi,[])}function a1(r,o,a,p){const v=this.multi;let w;if(this.providerFactory){const A=this.providerFactory.componentProviders,N=ul(a,a[1],this.providerFactory.index,p);w=N.slice(0,A),r_(v,w);for(let G=A;G<N.length;G++)w.push(N[G])}else w=[],r_(v,w);return w}function r_(r,o){for(let a=0;a<r.length;a++)o.push((0,r[a])());return o}function iv(r,o=[]){return a=>{a.providersResolver=(p,v)=>function o1(r,o,a){const p=lr();if(p.firstCreatePass){const v=nr(r);t_(a,p.data,p.blueprint,v,!0),t_(o,p.data,p.blueprint,v,!1)}}(p,v?v(r):r,o)}}class rv{}class d1{resolveComponentFactory(o){throw function u1(r){const o=Error(`No component factory found for ${xe(r)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=r,o}(o)}}let Hp=(()=>{class r{}return r.NULL=new d1,r})();function h1(){return hh(Co(),Sn())}function hh(r,o){return new Wp(ee(r,o))}let Wp=(()=>{class r{constructor(a){this.nativeElement=a}}return r.__NG_ELEMENT_ID__=h1,r})();function p1(r){return r instanceof Wp?r.nativeElement:r}class sv{}let f1=(()=>{class r{}return r.__NG_ELEMENT_ID__=()=>function g1(){const r=Sn(),a=ti(Co().index,r);return function m1(r){return r[11]}(cn(a)?a:r)}(),r})(),_1=(()=>{class r{}return r.\u0275prov=ei({token:r,providedIn:"root",factory:()=>null}),r})();class av{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const y1=new av("13.2.2"),o_={};function Rm(r,o,a,p,v=!1){for(;null!==a;){const w=o[a.index];if(null!==w&&p.push(Oi(w)),ki(w))for(let N=10;N<w.length;N++){const G=w[N],fe=G[1].firstChild;null!==fe&&Rm(G[1],G,fe,p)}const A=a.type;if(8&A)Rm(r,o,a.child,p);else if(32&A){const N=Lh(a,o);let G;for(;G=N();)p.push(G)}else if(16&A){const N=jh(o,a);if(Array.isArray(N))p.push(...N);else{const G=Rc(o[16]);Rm(G[1],G,N,p,!0)}}a=v?a.projectionNext:a.next}return p}class Yp{constructor(o,a){this._lView=o,this._cdRefInjectingView=a,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const o=this._lView,a=o[1];return Rm(a,o,a.firstChild,[])}get context(){return this._lView[8]}set context(o){this._lView[8]=o}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[3];if(ki(o)){const a=o[8],p=a?a.indexOf(this):-1;p>-1&&(zh(o,p),W(a,p))}this._attachedToViewContainer=!1}Mf(this._lView[1],this._lView)}onDestroy(o){dp(this._lView[1],this._lView,null,o)}markForCheck(){_p(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){vl(this._lView[1],this._lView,this.context)}checkNoChanges(){!function vp(r,o,a){H(!0);try{vl(r,o,a)}finally{H(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Re(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function sc(r,o){Zu(r,o,o[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new Re(902,"");this._appRef=o}}class v1 extends Yp{constructor(o){super(o),this._view=o}detectChanges(){im(this._view)}checkNoChanges(){!function rm(r){H(!0);try{im(r)}finally{H(!1)}}(this._view)}get context(){return null}}class lv extends Hp{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const a=Hn(o);return new s_(a,this.ngModule)}}function cv(r){const o=[];for(let a in r)r.hasOwnProperty(a)&&o.push({propName:r[a],templateName:a});return o}const b1=new Mr("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>xf});class s_ extends rv{constructor(o,a){super(),this.componentDef=o,this.ngModule=a,this.componentType=o.type,this.selector=function _g(r){return r.map(Yh).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!a}get inputs(){return cv(this.componentDef.inputs)}get outputs(){return cv(this.componentDef.outputs)}create(o,a,p,v){const w=(v=v||this.ngModule)?function w1(r,o){return{get:(a,p,v)=>{const w=r.get(a,o_,v);return w!==o_||p===o_?w:o.get(a,p,v)}}}(o,v.injector):o,A=w.get(sv,yr),N=w.get(_1,null),G=A.createRenderer(null,this.componentDef),fe=this.componentDef.selectors[0][0]||"div",be=p?function up(r,o,a){if(Wn(r))return r.selectRootElement(o,a===gi.ShadowDom);let p="string"==typeof o?r.querySelector(o):o;return p.textContent="",p}(G,p,this.componentDef.encapsulation):Nh(A.createRenderer(null,this.componentDef),fe,function x1(r){const o=r.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(fe)),et=this.componentDef.onPush?576:528,Et=function ym(r,o){return{components:[],scheduler:r||xf,clean:Ng,playerHandler:o||null,flags:0}}(),jt=Wu(0,null,null,1,0,null,null,null,null,null),Cn=Zl(null,jt,Et,et,null,null,A,G,N,w);let Jn,ri;rl(Cn);try{const Ci=function eh(r,o,a,p,v,w){const A=a[1];a[20]=r;const G=Ha(A,20,2,"#host",null),fe=G.mergedAttrs=o.hostAttrs;null!==fe&&(Qu(G,fe,!0),null!==r&&(La(v,r,fe),null!==G.classes&&qh(v,r,G.classes),null!==G.styles&&Of(v,r,G.styles)));const be=p.createRenderer(r,o),et=Zl(a,Ud(o),null,o.onPush?64:16,a[20],G,p,be,w||null,null);return A.firstCreatePass&&(Ba(wa(G,a),A,o.type),em(A,G),jd(G,a.length,1)),gu(a,et),a[20]=et}(be,this.componentDef,Cn,A,G);if(be)if(p)La(G,be,["ng-version",y1.full]);else{const{attrs:Rn,classes:qi}=function yg(r){const o=[],a=[];let p=1,v=2;for(;p<r.length;){let w=r[p];if("string"==typeof w)2===v?""!==w&&o.push(w,r[++p]):8===v&&a.push(w);else{if(!Da(v))break;v=w}p++}return{attrs:o,classes:a}}(this.componentDef.selectors[0]);Rn&&La(G,be,Rn),qi&&qi.length>0&&qh(G,be,qi.join(" "))}if(ri=Oe(jt,20),void 0!==a){const Rn=ri.projection=[];for(let qi=0;qi<this.ngContentSelectors.length;qi++){const Zr=a[qi];Rn.push(null!=Zr?Array.from(Zr):null)}}Jn=function _m(r,o,a,p,v){const w=a[1],A=function Kf(r,o,a){const p=Co();r.firstCreatePass&&(a.providersResolver&&a.providersResolver(a),tm(r,p,o,Vl(r,o,1,null),a));const v=ul(o,r,p.directiveStart,p);_s(v,o);const w=ee(p,o);return w&&_s(w,o),v}(w,a,o);if(p.components.push(A),r[8]=A,v&&v.forEach(G=>G(A,o)),o.contentQueries){const G=Co();o.contentQueries(1,A,G.directiveStart)}const N=Co();return!w.firstCreatePass||null===o.hostBindings&&null===o.hostAttrs||(Ss(N.index),pp(a[1],N,0,N.directiveStart,N.directiveEnd,o),Qf(o,A)),A}(Ci,this.componentDef,Cn,Et,[vm]),qu(jt,Cn,null)}finally{Sa()}return new C1(this.componentType,Jn,hh(ri,Cn),Cn,ri)}}class C1 extends class c1{}{constructor(o,a,p,v,w){super(),this.location=p,this._rootLView=v,this._tNode=w,this.instance=a,this.hostView=this.changeDetectorRef=new v1(v),this.componentType=o}get injector(){return new S(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}class ph{}class uv{}const fh=new Map;class pv extends ph{constructor(o,a){super(),this._parent=a,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new lv(this);const p=Fi(o);this._bootstrapComponents=fl(p.bootstrap),this._r3Injector=Es(o,a,[{provide:ph,useValue:this},{provide:Hp,useValue:this.componentFactoryResolver}],xe(o)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(o)}get(o,a=ua.THROW_IF_NOT_FOUND,p=ut.Default){return o===ua||o===ph||o===ed?this:this._r3Injector.get(o,a,p)}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class a_ extends uv{constructor(o){super(),this.moduleType=o,null!==Fi(o)&&function D1(r){const o=new Set;!function a(p){const v=Fi(p,!0),w=v.id;null!==w&&(function dv(r,o,a){if(o&&o!==a)throw new Error(`Duplicate module registered for ${r} - ${xe(o)} vs ${xe(o.name)}`)}(w,fh.get(w),p),fh.set(w,p));const A=fl(v.imports);for(const N of A)o.has(N)||(o.add(N),a(N))}(r)}(o)}create(o){return new pv(this.moduleType,o)}}function fv(r,o,a){const p=ve()+r,v=Sn();return v[p]===Qi?Ka(v,p,a?o.call(a):o()):function rd(r,o){return r[o]}(v,p)}function Jp(r,o){const a=r[o];return a===Qi?void 0:a}function xv(r,o){const a=lr();let p;const v=r+20;a.firstCreatePass?(p=function F1(r,o){if(o)for(let a=o.length-1;a>=0;a--){const p=o[a];if(r===p.name)return p}}(o,a.pipeRegistry),a.data[v]=p,p.onDestroy&&(a.destroyHooks||(a.destroyHooks=[])).push(v,p.onDestroy)):p=a.data[v];const w=p.factory||(p.factory=ro(p.type)),A=me(ss);try{const N=xa(!1),G=w();return xa(N),function C(r,o,a,p){a>=r.data.length&&(r.data[a]=null,r.blueprint[a]=null),o[a]=p}(a,Sn(),v,G),G}finally{me(A)}}function bv(r,o,a){const p=r+20,v=Sn(),w=hn(v,p);return Xp(v,p)?function mv(r,o,a,p,v,w){const A=o+a;return zo(r,A,v)?Ka(r,A+1,w?p.call(w,v):p(v)):Jp(r,A+1)}(v,ve(),o,w.transform,a,w):w.transform(a)}function wv(r,o,a,p){const v=r+20,w=Sn(),A=hn(w,v);return Xp(w,v)?function gv(r,o,a,p,v,w,A){const N=o+a;return jc(r,N,v,w)?Ka(r,N+2,A?p.call(A,v,w):p(v,w)):Jp(r,N+2)}(w,ve(),o,A.transform,a,p,A):A.transform(a,p)}function Xp(r,o){return r[1].data[o].pure}function l_(r){return o=>{setTimeout(r,void 0,o)}}const vc=class U1 extends P.xQ{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,a,p){let v=o,w=a||(()=>null),A=p;if(o&&"object"==typeof o){const G=o;v=G.next?.bind(G),w=G.error?.bind(G),A=G.complete?.bind(G)}this.__isAsync&&(w=l_(w),v&&(v=l_(v)),A&&(A=l_(A)));const N=super.subscribe({next:v,error:w,complete:A});return o instanceof m.w&&o.add(N),N}};function Z1(){return this._results[fc()]()}class c_{constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const a=fc(),p=c_.prototype;p[a]||(p[a]=Z1)}get changes(){return this._changes||(this._changes=new vc)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,a){return this._results.reduce(o,a)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,a){const p=this;p.dirty=!1;const v=T(o);(this._changesDetected=!function x(r,o,a){if(r.length!==o.length)return!1;for(let p=0;p<r.length;p++){let v=r[p],w=o[p];if(a&&(v=a(v),w=a(w)),w!==v)return!1}return!0}(p._results,v,a))&&(p._results=v,p.length=v.length,p.last=v[this.length-1],p.first=v[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Kp=(()=>{class r{}return r.__NG_ELEMENT_ID__=j1,r})();const V1=Kp,$1=class extends V1{constructor(o,a,p){super(),this._declarationLView=o,this._declarationTContainer=a,this.elementRef=p}createEmbeddedView(o){const a=this._declarationTContainer.tViews,p=Zl(this._declarationLView,a,o,16,null,a.declTNode,null,null,null,null);p[17]=this._declarationLView[this._declarationTContainer.index];const w=this._declarationLView[19];return null!==w&&(p[19]=w.createEmbeddedView(a)),qu(a,p,o),new Yp(p)}};function j1(){return Lm(Co(),Sn())}function Lm(r,o){return 4&r.type?new $1(o,r,hh(r,o)):null}let km=(()=>{class r{}return r.__NG_ELEMENT_ID__=G1,r})();function G1(){return Ev(Co(),Sn())}const q1=km,Tv=class extends q1{constructor(o,a,p){super(),this._lContainer=o,this._hostTNode=a,this._hostLView=p}get element(){return hh(this._hostTNode,this._hostLView)}get injector(){return new S(this._hostTNode,this._hostLView)}get parentInjector(){const o=Ml(this._hostTNode,this._hostLView);if(Gs(o)){const a=oa(o,this._hostLView),p=va(o);return new S(a[1].data[p+8],a)}return new S(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const a=Cv(this._lContainer);return null!==a&&a[o]||null}get length(){return this._lContainer.length-10}createEmbeddedView(o,a,p){const v=o.createEmbeddedView(a||{});return this.insert(v,p),v}createComponent(o,a,p,v,w){const A=o&&!function c(r){return"function"==typeof r}(o);let N;if(A)N=a;else{const et=a||{};N=et.index,p=et.injector,v=et.projectableNodes,w=et.ngModuleRef}const G=A?o:new s_(Hn(o)),fe=p||this.parentInjector;if(!w&&null==G.ngModule&&fe){const et=fe.get(ph,null);et&&(w=et)}const be=G.create(fe,v,void 0,w);return this.insert(be.hostView,N),be}insert(o,a){const p=o._lView,v=p[1];if(function Wo(r){return ki(r[3])}(p)){const be=this.indexOf(o);if(-1!==be)this.detach(be);else{const et=p[3],Et=new Tv(et,et[6],et[3]);Et.detach(Et.indexOf(o))}}const w=this._adjustIndex(a),A=this._lContainer;!function cg(r,o,a,p){const v=10+p,w=a.length;p>0&&(a[v-1][4]=o),p<w-10?(o[4]=a[v],k(a,10+p,o)):(a.push(o),o[4]=null),o[3]=a;const A=o[17];null!==A&&a!==A&&function ug(r,o){const a=r[9];o[16]!==o[3][3][16]&&(r[2]=!0),null===a?r[9]=[o]:a.push(o)}(A,o);const N=o[19];null!==N&&N.insertView(r),o[2]|=128}(v,p,A,w);const N=Nc(w,A),G=p[11],fe=Fc(G,A[7]);return null!==fe&&function Df(r,o,a,p,v,w){p[0]=v,p[6]=o,Zu(r,p,a,1,v,w)}(v,A[6],G,p,fe,N),o.attachToViewContainerRef(),k(u_(A),w,o),o}move(o,a){return this.insert(o,a)}indexOf(o){const a=Cv(this._lContainer);return null!==a?a.indexOf(o):-1}remove(o){const a=this._adjustIndex(o,-1),p=zh(this._lContainer,a);p&&(W(u_(this._lContainer),a),Mf(p[1],p))}detach(o){const a=this._adjustIndex(o,-1),p=zh(this._lContainer,a);return p&&null!=W(u_(this._lContainer),a)?new Yp(p):null}_adjustIndex(o,a=0){return o??this.length+a}};function Cv(r){return r[8]}function u_(r){return r[8]||(r[8]=[])}function Ev(r,o){let a;const p=o[r.index];if(ki(p))a=p;else{let v;if(8&r.type)v=Oi(p);else{const w=o[11];v=w.createComment("");const A=ee(r,o);kc(w,Fc(w,A),v,function Id(r,o){return Wn(r)?r.nextSibling(o):o.nextSibling}(w,A),!1)}o[r.index]=a=fp(p,o,v,r),gu(o,a)}return new Tv(a,r,o)}class d_{constructor(o){this.queryList=o,this.matches=null}clone(){return new d_(this.queryList)}setDirty(){this.queryList.setDirty()}}class h_{constructor(o=[]){this.queries=o}createEmbeddedView(o){const a=o.queries;if(null!==a){const p=null!==o.contentQueries?o.contentQueries[0]:a.length,v=[];for(let w=0;w<p;w++){const A=a.getByIndex(w);v.push(this.queries[A.indexInDeclarationView].clone())}return new h_(v)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let a=0;a<this.queries.length;a++)null!==Lv(o,a).matches&&this.queries[a].setDirty()}}class Dv{constructor(o,a,p=null){this.predicate=o,this.flags=a,this.read=p}}class p_{constructor(o=[]){this.queries=o}elementStart(o,a){for(let p=0;p<this.queries.length;p++)this.queries[p].elementStart(o,a)}elementEnd(o){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(o)}embeddedTView(o){let a=null;for(let p=0;p<this.length;p++){const v=null!==a?a.length:0,w=this.getByIndex(p).embeddedTView(o,v);w&&(w.indexInDeclarationView=p,null!==a?a.push(w):a=[w])}return null!==a?new p_(a):null}template(o,a){for(let p=0;p<this.queries.length;p++)this.queries[p].template(o,a)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class f_{constructor(o,a=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(o,a){this.isApplyingToNode(a)&&this.matchTNode(o,a)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,a){this.elementStart(o,a)}embeddedTView(o,a){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,a),new f_(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const a=this._declarationNodeIndex;let p=o.parent;for(;null!==p&&8&p.type&&p.index!==a;)p=p.parent;return a===(null!==p?p.index:-1)}return this._appliesToNextNode}matchTNode(o,a){const p=this.metadata.predicate;if(Array.isArray(p))for(let v=0;v<p.length;v++){const w=p[v];this.matchTNodeWithReadOption(o,a,Y1(a,w)),this.matchTNodeWithReadOption(o,a,Na(a,o,w,!1,!1))}else p===Kp?4&a.type&&this.matchTNodeWithReadOption(o,a,-1):this.matchTNodeWithReadOption(o,a,Na(a,o,p,!1,!1))}matchTNodeWithReadOption(o,a,p){if(null!==p){const v=this.metadata.read;if(null!==v)if(v===Wp||v===km||v===Kp&&4&a.type)this.addMatch(a.index,-2);else{const w=Na(a,o,v,!1,!1);null!==w&&this.addMatch(a.index,w)}else this.addMatch(a.index,p)}}addMatch(o,a){null===this.matches?this.matches=[o,a]:this.matches.push(o,a)}}function Y1(r,o){const a=r.localNames;if(null!==a)for(let p=0;p<a.length;p+=2)if(a[p]===o)return a[p+1];return null}function X1(r,o,a,p){return-1===a?function J1(r,o){return 11&r.type?hh(r,o):4&r.type?Lm(r,o):null}(o,r):-2===a?function K1(r,o,a){return a===Wp?hh(o,r):a===Kp?Lm(o,r):a===km?Ev(o,r):void 0}(r,o,p):ul(r,r[1],a,o)}function Iv(r,o,a,p){const v=o[19].queries[p];if(null===v.matches){const w=r.data,A=a.matches,N=[];for(let G=0;G<A.length;G+=2){const fe=A[G];N.push(fe<0?null:X1(o,w[fe],A[G+1],a.metadata.read))}v.matches=N}return v.matches}function m_(r,o,a,p){const v=r.queries.getByIndex(a),w=v.matches;if(null!==w){const A=Iv(r,o,v,a);for(let N=0;N<w.length;N+=2){const G=w[N];if(G>0)p.push(A[N/2]);else{const fe=w[N+1],be=o[-G];for(let et=10;et<be.length;et++){const Et=be[et];Et[17]===Et[3]&&m_(Et[1],Et,fe,p)}if(null!==be[9]){const et=be[9];for(let Et=0;Et<et.length;Et++){const jt=et[Et];m_(jt[1],jt,fe,p)}}}}}return p}function Mv(r){const o=Sn(),a=lr(),p=rs();ga(p+1);const v=Lv(a,p);if(r.dirty&&Ir(o)===(2==(2&v.metadata.flags))){if(null===v.matches)r.reset([]);else{const w=v.crossesNgTemplate?m_(a,o,p,[]):Iv(a,o,v,p);r.reset(w,p1),r.notifyOnChanges()}return!0}return!1}function Av(r,o,a){const p=lr();p.firstCreatePass&&(Rv(p,new Dv(r,o,a),-1),2==(2&o)&&(p.staticViewQueries=!0)),Ov(p,Sn(),o)}function Sv(r,o,a,p){const v=lr();if(v.firstCreatePass){const w=Co();Rv(v,new Dv(o,a,p),w.index),function eb(r,o){const a=r.contentQueries||(r.contentQueries=[]);o!==(a.length?a[a.length-1]:-1)&&a.push(r.queries.length-1,o)}(v,r),2==(2&a)&&(v.staticContentQueries=!0)}Ov(v,Sn(),a)}function Pv(){return function Q1(r,o){return r[19].queries[o].queryList}(Sn(),rs())}function Ov(r,o,a){const p=new c_(4==(4&a));dp(r,o,p,p.destroy),null===o[19]&&(o[19]=new h_),o[19].queries.push(new d_(p))}function Rv(r,o,a){null===r.queries&&(r.queries=new p_),r.queries.track(new f_(o,a))}function Lv(r,o){return r.queries.getByIndex(o)}function Nm(...r){}const b_=new Mr("Application Initializer");let gh=(()=>{class r{constructor(a){this.appInits=a,this.resolve=Nm,this.reject=Nm,this.initialized=!1,this.done=!1,this.donePromise=new Promise((p,v)=>{this.resolve=p,this.reject=v})}runInitializers(){if(this.initialized)return;const a=[],p=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let v=0;v<this.appInits.length;v++){const w=this.appInits[v]();if(da(w))a.push(w);else if(Du(w)){const A=new Promise((N,G)=>{w.subscribe({complete:N,error:G})});a.push(A)}}Promise.all(a).then(()=>{p()}).catch(v=>{this.reject(v)}),0===a.length&&p(),this.initialized=!0}}return r.\u0275fac=function(a){return new(a||r)(Li(b_,8))},r.\u0275prov=ei({token:r,factory:r.\u0275fac}),r})();const Xv=new Mr("AppId"),vb={provide:Xv,useFactory:function yb(){return`${w_()}${w_()}${w_()}`},deps:[]};function w_(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Kv=new Mr("Platform Initializer"),Qv=new Mr("Platform ID"),e0=new Mr("appBootstrapListener");let t0=(()=>{class r{log(a){console.log(a)}warn(a){console.warn(a)}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=ei({token:r,factory:r.\u0275fac}),r})();const zm=new Mr("LocaleId"),n0=new Mr("DefaultCurrencyCode");class xb{constructor(o,a){this.ngModuleFactory=o,this.componentFactories=a}}let T_=(()=>{class r{compileModuleSync(a){return new a_(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){const p=this.compileModuleSync(a),w=fl(Fi(a).declarations).reduce((A,N)=>{const G=Hn(N);return G&&A.push(new s_(G)),A},[]);return new xb(p,w)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=ei({token:r,factory:r.\u0275fac}),r})();const wb=(()=>Promise.resolve(0))();function C_(r){"undefined"==typeof Zone?wb.then(()=>{r&&r.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",r)}class el{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:p=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new vc(!1),this.onMicrotaskEmpty=new vc(!1),this.onStable=new vc(!1),this.onError=new vc(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const v=this;v._nesting=0,v._outer=v._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(v._inner=v._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(v._inner=v._inner.fork(Zone.longStackTraceZoneSpec)),v.shouldCoalesceEventChangeDetection=!p&&a,v.shouldCoalesceRunChangeDetection=p,v.lastRequestAnimationFrameId=-1,v.nativeRequestAnimationFrame=function Tb(){let r=Pi.requestAnimationFrame,o=Pi.cancelAnimationFrame;if("undefined"!=typeof Zone&&r&&o){const a=r[Zone.__symbol__("OriginalDelegate")];a&&(r=a);const p=o[Zone.__symbol__("OriginalDelegate")];p&&(o=p)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function Db(r){const o=()=>{!function Eb(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(Pi,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,D_(r),r.isCheckStableRunning=!0,E_(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),D_(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(a,p,v,w,A,N)=>{try{return r0(r),a.invokeTask(v,w,A,N)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===w.type||r.shouldCoalesceRunChangeDetection)&&o(),o0(r)}},onInvoke:(a,p,v,w,A,N,G)=>{try{return r0(r),a.invoke(v,w,A,N,G)}finally{r.shouldCoalesceRunChangeDetection&&o(),o0(r)}},onHasTask:(a,p,v,w)=>{a.hasTask(v,w),p===v&&("microTask"==w.change?(r._hasPendingMicrotasks=w.microTask,D_(r),E_(r)):"macroTask"==w.change&&(r.hasPendingMacrotasks=w.macroTask))},onHandleError:(a,p,v,w)=>(a.handleError(v,w),r.runOutsideAngular(()=>r.onError.emit(w)),!1)})}(v)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!el.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(el.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(o,a,p){return this._inner.run(o,a,p)}runTask(o,a,p,v){const w=this._inner,A=w.scheduleEventTask("NgZoneEvent: "+v,o,Cb,Nm,Nm);try{return w.runTask(A,a,p)}finally{w.cancelTask(A)}}runGuarded(o,a,p){return this._inner.runGuarded(o,a,p)}runOutsideAngular(o){return this._outer.run(o)}}const Cb={};function E_(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function D_(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function r0(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function o0(r){r._nesting--,E_(r)}class Ib{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new vc,this.onMicrotaskEmpty=new vc,this.onStable=new vc,this.onError=new vc}run(o,a,p){return o.apply(a,p)}runGuarded(o,a,p){return o.apply(a,p)}runOutsideAngular(o){return o()}runTask(o,a,p,v){return o.apply(a,p)}}let s0=(()=>{class r{constructor(a){this._ngZone=a,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),a.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{el.assertNotInAngularZone(),C_(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())C_(()=>{for(;0!==this._callbacks.length;){let a=this._callbacks.pop();clearTimeout(a.timeoutId),a.doneCb(this._didWork)}this._didWork=!1});else{let a=this.getPendingTasks();this._callbacks=this._callbacks.filter(p=>!p.updateCb||!p.updateCb(a)||(clearTimeout(p.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(a=>({source:a.source,creationLocation:a.creationLocation,data:a.data})):[]}addCallback(a,p,v){let w=-1;p&&p>0&&(w=setTimeout(()=>{this._callbacks=this._callbacks.filter(A=>A.timeoutId!==w),a(this._didWork,this.getPendingTasks())},p)),this._callbacks.push({doneCb:a,timeoutId:w,updateCb:v})}whenStable(a,p,v){if(v&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(a,p,v),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(a,p,v){return[]}}return r.\u0275fac=function(a){return new(a||r)(Li(el))},r.\u0275prov=ei({token:r,factory:r.\u0275fac}),r})(),a0=(()=>{class r{constructor(){this._applications=new Map,I_.addToWindow(this)}registerApplication(a,p){this._applications.set(a,p)}unregisterApplication(a){this._applications.delete(a)}unregisterAllApplications(){this._applications.clear()}getTestability(a){return this._applications.get(a)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(a,p=!0){return I_.findTestabilityInTree(this,a,p)}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=ei({token:r,factory:r.\u0275fac}),r})();class Mb{addToWindow(o){}findTestabilityInTree(o,a,p){return null}}function Ab(r){I_=r}let Yl,I_=new Mb;const l0=new Mr("AllowMultipleToken");class Ob{constructor(o,a){this.name=o,this.token=a}}function c0(r,o,a=[]){const p=`Platform: ${o}`,v=new Mr(p);return(w=[])=>{let A=u0();if(!A||A.injector.get(l0,!1))if(r)r(a.concat(w).concat({provide:v,useValue:!0}));else{const N=a.concat(w).concat({provide:v,useValue:!0},{provide:wp,useValue:"platform"});!function Rb(r){if(Yl&&!Yl.destroyed&&!Yl.injector.get(l0,!1))throw new Re(400,"");Yl=r.get(d0);const o=r.get(Kv,null);o&&o.forEach(a=>a())}(ua.create({providers:N,name:p}))}return function Lb(r){const o=u0();if(!o)throw new Re(401,"");return o}()}}function u0(){return Yl&&!Yl.destroyed?Yl:null}let d0=(()=>{class r{constructor(a){this._injector=a,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(a,p){const N=function kb(r,o){let a;return a="noop"===r?new Ib:("zone.js"===r?void 0:r)||new el({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!o?.ngZoneEventCoalescing,shouldCoalesceRunChangeDetection:!!o?.ngZoneRunCoalescing}),a}(p?p.ngZone:void 0,{ngZoneEventCoalescing:p&&p.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:p&&p.ngZoneRunCoalescing||!1}),G=[{provide:el,useValue:N}];return N.run(()=>{const fe=ua.create({providers:G,parent:this.injector,name:a.moduleType.name}),be=a.create(fe),et=be.injector.get(iu,null);if(!et)throw new Re(402,"");return N.runOutsideAngular(()=>{const Et=N.onError.subscribe({next:jt=>{et.handleError(jt)}});be.onDestroy(()=>{M_(this._modules,be),Et.unsubscribe()})}),function Fb(r,o,a){try{const p=a();return da(p)?p.catch(v=>{throw o.runOutsideAngular(()=>r.handleError(v)),v}):p}catch(p){throw o.runOutsideAngular(()=>r.handleError(p)),p}}(et,N,()=>{const Et=be.injector.get(gh);return Et.runInitializers(),Et.donePromise.then(()=>(function fx(r){ft(r,"Expected localeId to be defined"),"string"==typeof r&&(Oy=r.toLowerCase().replace(/_/g,"-"))}(be.injector.get(zm,Mm)||Mm),this._moduleDoBootstrap(be),be))})})}bootstrapModule(a,p=[]){const v=h0({},p);return function Sb(r,o,a){const p=new a_(a);return Promise.resolve(p)}(0,0,a).then(w=>this.bootstrapModuleFactory(w,v))}_moduleDoBootstrap(a){const p=a.injector.get(ef);if(a._bootstrapComponents.length>0)a._bootstrapComponents.forEach(v=>p.bootstrap(v));else{if(!a.instance.ngDoBootstrap)throw new Re(403,"");a.instance.ngDoBootstrap(p)}this._modules.push(a)}onDestroy(a){this._destroyListeners.push(a)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Re(404,"");this._modules.slice().forEach(a=>a.destroy()),this._destroyListeners.forEach(a=>a()),this._destroyed=!0}get destroyed(){return this._destroyed}}return r.\u0275fac=function(a){return new(a||r)(Li(ua))},r.\u0275prov=ei({token:r,factory:r.\u0275fac}),r})();function h0(r,o){return Array.isArray(o)?o.reduce(h0,r):{...r,...o}}let ef=(()=>{class r{constructor(a,p,v,w,A){this._zone=a,this._injector=p,this._exceptionHandler=v,this._componentFactoryResolver=w,this._initStatus=A,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const N=new u.y(fe=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{fe.next(this._stable),fe.complete()})}),G=new u.y(fe=>{let be;this._zone.runOutsideAngular(()=>{be=this._zone.onStable.subscribe(()=>{el.assertNotInAngularZone(),C_(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,fe.next(!0))})})});const et=this._zone.onUnstable.subscribe(()=>{el.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{fe.next(!1)}))});return()=>{be.unsubscribe(),et.unsubscribe()}});this.isStable=function L(...r){let o=Number.POSITIVE_INFINITY,a=null,p=r[r.length-1];return(0,d.K)(p)?(a=r.pop(),r.length>1&&"number"==typeof r[r.length-1]&&(o=r.pop())):"number"==typeof p&&(o=r.pop()),null===a&&1===r.length&&r[0]instanceof u.y?r[0]:(0,j.J)(o)((0,l.n)(r,a))}(N,G.pipe(function re(){return r=>(0,Z.x)()(function ue(r,o){return function(p){let v;if(v="function"==typeof r?r:function(){return r},"function"==typeof o)return p.lift(new V(v,o));const w=Object.create(p,$.N);return w.source=p,w.subjectFactory=v,w}}(K)(r))}()))}bootstrap(a,p){if(!this._initStatus.done)throw new Re(405,"");let v;v=a instanceof rv?a:this._componentFactoryResolver.resolveComponentFactory(a),this.componentTypes.push(v.componentType);const w=function Pb(r){return r.isBoundToModule}(v)?void 0:this._injector.get(ph),N=v.create(ua.NULL,[],p||v.selector,w),G=N.location.nativeElement,fe=N.injector.get(s0,null),be=fe&&N.injector.get(a0);return fe&&be&&be.registerApplication(G,fe),N.onDestroy(()=>{this.detachView(N.hostView),M_(this.components,N),be&&be.unregisterApplication(G)}),this._loadComponent(N),N}tick(){if(this._runningTick)throw new Re(101,"");try{this._runningTick=!0;for(let a of this._views)a.detectChanges()}catch(a){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(a))}finally{this._runningTick=!1}}attachView(a){const p=a;this._views.push(p),p.attachToAppRef(this)}detachView(a){const p=a;M_(this._views,p),p.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView),this.tick(),this.components.push(a),this._injector.get(e0,[]).concat(this._bootstrapListeners).forEach(v=>v(a))}ngOnDestroy(){this._views.slice().forEach(a=>a.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return r.\u0275fac=function(a){return new(a||r)(Li(el),Li(ua),Li(iu),Li(Hp),Li(gh))},r.\u0275prov=ei({token:r,factory:r.\u0275fac}),r})();function M_(r,o){const a=r.indexOf(o);a>-1&&r.splice(a,1)}let f0=!0;function Nb(){f0=!1}let zb=(()=>{class r{}return r.__NG_ELEMENT_ID__=Ub,r})();function Ub(r){return function Zb(r,o,a){if(Hi(r)&&!a){const p=ti(r.index,o);return new Yp(p,p)}return 47&r.type?new Yp(o[16],o):null}(Co(),Sn(),16==(16&r))}class v0{constructor(){}supports(o){return bu(o)}create(o){return new Hb(o)}}const qb=(r,o)=>o;class Hb{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||qb}forEachItem(o){let a;for(a=this._itHead;null!==a;a=a._next)o(a)}forEachOperation(o){let a=this._itHead,p=this._removalsHead,v=0,w=null;for(;a||p;){const A=!p||a&&a.currentIndex<b0(p,v,w)?a:p,N=b0(A,v,w),G=A.currentIndex;if(A===p)v--,p=p._nextRemoved;else if(a=a._next,null==A.previousIndex)v++;else{w||(w=[]);const fe=N-v,be=G-v;if(fe!=be){for(let Et=0;Et<fe;Et++){const jt=Et<w.length?w[Et]:w[Et]=0,Cn=jt+Et;be<=Cn&&Cn<fe&&(w[Et]=jt+1)}w[A.previousIndex]=be-fe}}N!==G&&o(A,N,G)}}forEachPreviousItem(o){let a;for(a=this._previousItHead;null!==a;a=a._nextPrevious)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachMovedItem(o){let a;for(a=this._movesHead;null!==a;a=a._nextMoved)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}forEachIdentityChange(o){let a;for(a=this._identityChangesHead;null!==a;a=a._nextIdentityChange)o(a)}diff(o){if(null==o&&(o=[]),!bu(o))throw new Re(900,"");return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let v,w,A,a=this._itHead,p=!1;if(Array.isArray(o)){this.length=o.length;for(let N=0;N<this.length;N++)w=o[N],A=this._trackByFn(N,w),null!==a&&Object.is(a.trackById,A)?(p&&(a=this._verifyReinsertion(a,w,A,N)),Object.is(a.item,w)||this._addIdentityChange(a,w)):(a=this._mismatch(a,w,A,N),p=!0),a=a._next}else v=0,function Lp(r,o){if(Array.isArray(r))for(let a=0;a<r.length;a++)o(r[a]);else{const a=r[fc()]();let p;for(;!(p=a.next()).done;)o(p.value)}}(o,N=>{A=this._trackByFn(v,N),null!==a&&Object.is(a.trackById,A)?(p&&(a=this._verifyReinsertion(a,N,A,v)),Object.is(a.item,N)||this._addIdentityChange(a,N)):(a=this._mismatch(a,N,A,v),p=!0),a=a._next,v++}),this.length=v;return this._truncate(a),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,a,p,v){let w;return null===o?w=this._itTail:(w=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(p,null))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._reinsertAfter(o,w,v)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(p,v))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._moveAfter(o,w,v)):o=this._addAfter(new Wb(a,p),w,v),o}_verifyReinsertion(o,a,p,v){let w=null===this._unlinkedRecords?null:this._unlinkedRecords.get(p,null);return null!==w?o=this._reinsertAfter(w,o._prev,v):o.currentIndex!=v&&(o.currentIndex=v,this._addToMoves(o,v)),o}_truncate(o){for(;null!==o;){const a=o._next;this._addToRemovals(this._unlink(o)),o=a}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,a,p){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const v=o._prevRemoved,w=o._nextRemoved;return null===v?this._removalsHead=w:v._nextRemoved=w,null===w?this._removalsTail=v:w._prevRemoved=v,this._insertAfter(o,a,p),this._addToMoves(o,p),o}_moveAfter(o,a,p){return this._unlink(o),this._insertAfter(o,a,p),this._addToMoves(o,p),o}_addAfter(o,a,p){return this._insertAfter(o,a,p),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,a,p){const v=null===a?this._itHead:a._next;return o._next=v,o._prev=a,null===v?this._itTail=o:v._prev=o,null===a?this._itHead=o:a._next=o,null===this._linkedRecords&&(this._linkedRecords=new x0),this._linkedRecords.put(o),o.currentIndex=p,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const a=o._prev,p=o._next;return null===a?this._itHead=p:a._next=p,null===p?this._itTail=a:p._prev=a,o}_addToMoves(o,a){return o.previousIndex===a||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new x0),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,a){return o.item=a,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class Wb{constructor(o,a){this.item=o,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Yb{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,a){let p;for(p=this._head;null!==p;p=p._nextDup)if((null===a||a<=p.currentIndex)&&Object.is(p.trackById,o))return p;return null}remove(o){const a=o._prevDup,p=o._nextDup;return null===a?this._head=p:a._nextDup=p,null===p?this._tail=a:p._prevDup=a,null===this._head}}class x0{constructor(){this.map=new Map}put(o){const a=o.trackById;let p=this.map.get(a);p||(p=new Yb,this.map.set(a,p)),p.add(o)}get(o,a){const v=this.map.get(o);return v?v.get(o,a):null}remove(o){const a=o.trackById;return this.map.get(a).remove(o)&&this.map.delete(a),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function b0(r,o,a){const p=r.previousIndex;if(null===p)return p;let v=0;return a&&p<a.length&&(v=a[p]),p+o+v}class w0{constructor(){}supports(o){return o instanceof Map||rh(o)}create(){return new Jb}}class Jb{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let a;for(a=this._mapHead;null!==a;a=a._next)o(a)}forEachPreviousItem(o){let a;for(a=this._previousMapHead;null!==a;a=a._nextPrevious)o(a)}forEachChangedItem(o){let a;for(a=this._changesHead;null!==a;a=a._nextChanged)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}diff(o){if(o){if(!(o instanceof Map||rh(o)))throw new Re(900,"")}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let a=this._mapHead;if(this._appendAfter=null,this._forEach(o,(p,v)=>{if(a&&a.key===v)this._maybeAddToChanges(a,p),this._appendAfter=a,a=a._next;else{const w=this._getOrCreateRecordForKey(v,p);a=this._insertBeforeOrAppend(a,w)}}),a){a._prev&&(a._prev._next=null),this._removalsHead=a;for(let p=a;null!==p;p=p._nextRemoved)p===this._mapHead&&(this._mapHead=null),this._records.delete(p.key),p._nextRemoved=p._next,p.previousValue=p.currentValue,p.currentValue=null,p._prev=null,p._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,a){if(o){const p=o._prev;return a._next=o,a._prev=p,o._prev=a,p&&(p._next=a),o===this._mapHead&&(this._mapHead=a),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=a,a._prev=this._appendAfter):this._mapHead=a,this._appendAfter=a,null}_getOrCreateRecordForKey(o,a){if(this._records.has(o)){const v=this._records.get(o);this._maybeAddToChanges(v,a);const w=v._prev,A=v._next;return w&&(w._next=A),A&&(A._prev=w),v._next=null,v._prev=null,v}const p=new Xb(o);return this._records.set(o,p),p.currentValue=a,this._addToAdditions(p),p}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,a){Object.is(a,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=a,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,a){o instanceof Map?o.forEach(a):Object.keys(o).forEach(p=>a(o[p],p))}}class Xb{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function T0(){return new Vm([new v0])}let Vm=(()=>{class r{constructor(a){this.factories=a}static create(a,p){if(null!=p){const v=p.factories.slice();a=a.concat(v)}return new r(a)}static extend(a){return{provide:r,useFactory:p=>r.create(a,p||T0()),deps:[[r,new Gr,new no]]}}find(a){const p=this.factories.find(v=>v.supports(a));if(null!=p)return p;throw new Re(901,"")}}return r.\u0275prov=ei({token:r,providedIn:"root",factory:T0}),r})();function C0(){return new $m([new w0])}let $m=(()=>{class r{constructor(a){this.factories=a}static create(a,p){if(p){const v=p.factories.slice();a=a.concat(v)}return new r(a)}static extend(a){return{provide:r,useFactory:p=>r.create(a,p||C0()),deps:[[r,new Gr,new no]]}}find(a){const p=this.factories.find(w=>w.supports(a));if(p)return p;throw new Re(901,"")}}return r.\u0275prov=ei({token:r,providedIn:"root",factory:C0}),r})();const Kb=[new w0],ew=new Vm([new v0]),tw=new $m(Kb),nw=c0(null,"core",[{provide:Qv,useValue:"unknown"},{provide:d0,deps:[ua]},{provide:a0,deps:[]},{provide:t0,deps:[]}]),aw=[{provide:ef,useClass:ef,deps:[el,ua,iu,Hp,gh]},{provide:b1,deps:[el],useFactory:function lw(r){let o=[];return r.onStable.subscribe(()=>{for(;o.length;)o.pop()()}),function(a){o.push(a)}}},{provide:gh,useClass:gh,deps:[[new no,b_]]},{provide:T_,useClass:T_,deps:[]},vb,{provide:Vm,useFactory:function iw(){return ew},deps:[]},{provide:$m,useFactory:function rw(){return tw},deps:[]},{provide:zm,useFactory:function ow(r){return r||function sw(){return"undefined"!=typeof $localize&&$localize.locale||Mm}()},deps:[[new or(zm),new no,new Gr]]},{provide:n0,useValue:"USD"}];let cw=(()=>{class r{constructor(a){}}return r.\u0275fac=function(a){return new(a||r)(Li(ef))},r.\u0275mod=rn({type:r}),r.\u0275inj=sr({providers:aw}),r})()},4006:(Tn,Je,R)=>{"use strict";R.d(Je,{Fj:()=>_e,u5:()=>yr,Fd:()=>Wr,qQ:()=>$o,JU:()=>$,a5:()=>ei,JJ:()=>yi,On:()=>Lt,wV:()=>ln});var u=R(6738),d=R(6895),j=R(5254),l=R(567),L=R(4850);let P=(()=>{class ae{constructor(Q,Oe){this._renderer=Q,this._elementRef=Oe,this.onChange=hn=>{},this.onTouched=()=>{}}setProperty(Q,Oe){this._renderer.setProperty(this._elementRef.nativeElement,Q,Oe)}registerOnTouched(Q){this.onTouched=Q}registerOnChange(Q){this.onChange=Q}setDisabledState(Q){this.setProperty("disabled",Q)}}return ae.\u0275fac=function(Q){return new(Q||ae)(u.Y36(u.Qsj),u.Y36(u.SBq))},ae.\u0275dir=u.lG2({type:ae}),ae})(),m=(()=>{class ae extends P{}return ae.\u0275fac=function(){let ee;return function(Oe){return(ee||(ee=u.n5z(ae)))(Oe||ae)}}(),ae.\u0275dir=u.lG2({type:ae,features:[u.qOj]}),ae})();const $=new u.OlP("NgValueAccessor"),Z={provide:$,useExisting:(0,u.Gpc)(()=>_e),multi:!0},re=new u.OlP("CompositionEventMode");let _e=(()=>{class ae extends P{constructor(Q,Oe,hn){super(Q,Oe),this._compositionMode=hn,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function K(){const ae=(0,d.q)()?(0,d.q)().getUserAgent():"";return/android (\d+)/.test(ae.toLowerCase())}())}writeValue(Q){this.setProperty("value",Q??"")}_handleInput(Q){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(Q)}_compositionStart(){this._composing=!0}_compositionEnd(Q){this._composing=!1,this._compositionMode&&this.onChange(Q)}}return ae.\u0275fac=function(Q){return new(Q||ae)(u.Y36(u.Qsj),u.Y36(u.SBq),u.Y36(re,8))},ae.\u0275dir=u.lG2({type:ae,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(Q,Oe){1&Q&&u.NdJ("input",function(ti){return Oe._handleInput(ti.target.value)})("blur",function(){return Oe.onTouched()})("compositionstart",function(){return Oe._compositionStart()})("compositionend",function(ti){return Oe._compositionEnd(ti.target.value)})},features:[u._Bn([Z]),u.qOj]}),ae})();function ge(ae){return null==ae||0===ae.length}const je=new u.OlP("NgValidators"),nt=new u.OlP("NgAsyncValidators");function xt(ae){return null}function dt(ae){return null!=ae}function At(ae){const ee=(0,u.QGY)(ae)?(0,j.D)(ae):ae;return(0,u.CqO)(ee),ee}function Vt(ae){let ee={};return ae.forEach(Q=>{ee=null!=Q?{...ee,...Q}:ee}),0===Object.keys(ee).length?null:ee}function Un(ae,ee){return ee.map(Q=>Q(ae))}function $t(ae){return ae.map(ee=>function St(ae){return!ae.validate}(ee)?ee:Q=>ee.validate(Q))}function Ht(ae){return null!=ae?function zt(ae){if(!ae)return null;const ee=ae.filter(dt);return 0==ee.length?null:function(Q){return Vt(Un(Q,ee))}}($t(ae)):null}function Kt(ae){return null!=ae?function en(ae){if(!ae)return null;const ee=ae.filter(dt);return 0==ee.length?null:function(Q){const Oe=Un(Q,ee).map(At);return(0,l.D)(Oe).pipe((0,L.U)(Vt))}}($t(ae)):null}function Wt(ae,ee){return null===ae?[ee]:Array.isArray(ae)?[...ae,ee]:[ae,ee]}function Gt(ae){return ae?Array.isArray(ae)?ae:[ae]:[]}function ft(ae,ee){return Array.isArray(ae)?ae.includes(ee):ae===ee}function Ut(ae,ee){const Q=Gt(ee);return Gt(ae).forEach(hn=>{ft(Q,hn)||Q.push(hn)}),Q}function On(ae,ee){return Gt(ee).filter(Q=>!ft(ae,Q))}class fn{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(ee){this._rawValidators=ee||[],this._composedValidatorFn=Ht(this._rawValidators)}_setAsyncValidators(ee){this._rawAsyncValidators=ee||[],this._composedAsyncValidatorFn=Kt(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(ee){this._onDestroyCallbacks.push(ee)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(ee=>ee()),this._onDestroyCallbacks=[]}reset(ee){this.control&&this.control.reset(ee)}hasError(ee,Q){return!!this.control&&this.control.hasError(ee,Q)}getError(ee,Q){return this.control?this.control.getError(ee,Q):null}}class Gn extends fn{get formDirective(){return null}get path(){return null}}class ei extends fn{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}let yi=(()=>{class ae extends class $i{constructor(ee){this._cd=ee}is(ee){return"submitted"===ee?!!this._cd?.submitted:!!this._cd?.control?.[ee]}}{constructor(Q){super(Q)}}return ae.\u0275fac=function(Q){return new(Q||ae)(u.Y36(ei,2))},ae.\u0275dir=u.lG2({type:ae,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(Q,Oe){2&Q&&u.ekj("ng-untouched",Oe.is("untouched"))("ng-touched",Oe.is("touched"))("ng-pristine",Oe.is("pristine"))("ng-dirty",Oe.is("dirty"))("ng-valid",Oe.is("valid"))("ng-invalid",Oe.is("invalid"))("ng-pending",Oe.is("pending"))},features:[u.qOj]}),ae})();function fi(ae,ee){(function Pi(ae,ee){const Q=function Yt(ae){return ae._rawValidators}(ae);null!==ee.validator?ae.setValidators(Wt(Q,ee.validator)):"function"==typeof Q&&ae.setValidators([Q]);const Oe=function qt(ae){return ae._rawAsyncValidators}(ae);null!==ee.asyncValidator?ae.setAsyncValidators(Wt(Oe,ee.asyncValidator)):"function"==typeof Oe&&ae.setAsyncValidators([Oe]);const hn=()=>ae.updateValueAndValidity();Vi(ee._rawValidators,hn),Vi(ee._rawAsyncValidators,hn)})(ae,ee),ee.valueAccessor.writeValue(ae.value),function Ei(ae,ee){ee.valueAccessor.registerOnChange(Q=>{ae._pendingValue=Q,ae._pendingChange=!0,ae._pendingDirty=!0,"change"===ae.updateOn&&_n(ae,ee)})}(ae,ee),function tr(ae,ee){const Q=(Oe,hn)=>{ee.valueAccessor.writeValue(Oe),hn&&ee.viewToModelUpdate(Oe)};ae.registerOnChange(Q),ee._registerOnDestroy(()=>{ae._unregisterOnChange(Q)})}(ae,ee),function Rr(ae,ee){ee.valueAccessor.registerOnTouched(()=>{ae._pendingTouched=!0,"blur"===ae.updateOn&&ae._pendingChange&&_n(ae,ee),"submit"!==ae.updateOn&&ae.markAsTouched()})}(ae,ee),function gr(ae,ee){if(ee.valueAccessor.setDisabledState){const Q=Oe=>{ee.valueAccessor.setDisabledState(Oe)};ae.registerOnDisabledChange(Q),ee._registerOnDestroy(()=>{ae._unregisterOnDisabledChange(Q)})}}(ae,ee)}function Vi(ae,ee){ae.forEach(Q=>{Q.registerOnValidatorChange&&Q.registerOnValidatorChange(ee)})}function _n(ae,ee){ae._pendingDirty&&ae.markAsDirty(),ae.setValue(ae._pendingValue,{emitModelToViewChange:!1}),ee.viewToModelUpdate(ae._pendingValue),ae._pendingChange=!1}function Xe(ae,ee){const Q=ae.indexOf(ee);Q>-1&&ae.splice(Q,1)}const rn="VALID",pn="INVALID",Ln="PENDING",qn="DISABLED";function Hn(ae){return(ci(ae)?ae.validators:ae)||null}function ii(ae){return Array.isArray(ae)?Ht(ae):ae||null}function Ui(ae,ee){return(ci(ee)?ee.asyncValidators:ae)||null}function Fi(ae){return Array.isArray(ae)?Kt(ae):ae||null}function ci(ae){return null!=ae&&!Array.isArray(ae)&&"object"==typeof ae}const mi=ae=>ae instanceof Nr;function Zi(ae){return(ae=>ae instanceof ur)(ae)?ae.value:ae.getRawValue()}function cr(ae,ee){const Q=mi(ae),Oe=ae.controls;if(!(Q?Object.keys(Oe):Oe).length)throw new u.vHH(1e3,"");if(!Oe[ee])throw new u.vHH(1001,"")}function oi(ae,ee){mi(ae),ae._forEachChild((Oe,hn)=>{if(void 0===ee[hn])throw new u.vHH(1002,"")})}class _r{constructor(ee,Q){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=ee,this._rawAsyncValidators=Q,this._composedValidatorFn=ii(this._rawValidators),this._composedAsyncValidatorFn=Fi(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(ee){this._rawValidators=this._composedValidatorFn=ee}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(ee){this._rawAsyncValidators=this._composedAsyncValidatorFn=ee}get parent(){return this._parent}get valid(){return this.status===rn}get invalid(){return this.status===pn}get pending(){return this.status==Ln}get disabled(){return this.status===qn}get enabled(){return this.status!==qn}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(ee){this._rawValidators=ee,this._composedValidatorFn=ii(ee)}setAsyncValidators(ee){this._rawAsyncValidators=ee,this._composedAsyncValidatorFn=Fi(ee)}addValidators(ee){this.setValidators(Ut(ee,this._rawValidators))}addAsyncValidators(ee){this.setAsyncValidators(Ut(ee,this._rawAsyncValidators))}removeValidators(ee){this.setValidators(On(ee,this._rawValidators))}removeAsyncValidators(ee){this.setAsyncValidators(On(ee,this._rawAsyncValidators))}hasValidator(ee){return ft(this._rawValidators,ee)}hasAsyncValidator(ee){return ft(this._rawAsyncValidators,ee)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(ee={}){this.touched=!0,this._parent&&!ee.onlySelf&&this._parent.markAsTouched(ee)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(ee=>ee.markAllAsTouched())}markAsUntouched(ee={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(Q=>{Q.markAsUntouched({onlySelf:!0})}),this._parent&&!ee.onlySelf&&this._parent._updateTouched(ee)}markAsDirty(ee={}){this.pristine=!1,this._parent&&!ee.onlySelf&&this._parent.markAsDirty(ee)}markAsPristine(ee={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(Q=>{Q.markAsPristine({onlySelf:!0})}),this._parent&&!ee.onlySelf&&this._parent._updatePristine(ee)}markAsPending(ee={}){this.status=Ln,!1!==ee.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!ee.onlySelf&&this._parent.markAsPending(ee)}disable(ee={}){const Q=this._parentMarkedDirty(ee.onlySelf);this.status=qn,this.errors=null,this._forEachChild(Oe=>{Oe.disable({...ee,onlySelf:!0})}),this._updateValue(),!1!==ee.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...ee,skipPristineCheck:Q}),this._onDisabledChange.forEach(Oe=>Oe(!0))}enable(ee={}){const Q=this._parentMarkedDirty(ee.onlySelf);this.status=rn,this._forEachChild(Oe=>{Oe.enable({...ee,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:ee.emitEvent}),this._updateAncestors({...ee,skipPristineCheck:Q}),this._onDisabledChange.forEach(Oe=>Oe(!1))}_updateAncestors(ee){this._parent&&!ee.onlySelf&&(this._parent.updateValueAndValidity(ee),ee.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(ee){this._parent=ee}updateValueAndValidity(ee={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===rn||this.status===Ln)&&this._runAsyncValidator(ee.emitEvent)),!1!==ee.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!ee.onlySelf&&this._parent.updateValueAndValidity(ee)}_updateTreeValidity(ee={emitEvent:!0}){this._forEachChild(Q=>Q._updateTreeValidity(ee)),this.updateValueAndValidity({onlySelf:!0,emitEvent:ee.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?qn:rn}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(ee){if(this.asyncValidator){this.status=Ln,this._hasOwnPendingAsyncValidator=!0;const Q=At(this.asyncValidator(this));this._asyncValidationSubscription=Q.subscribe(Oe=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(Oe,{emitEvent:ee})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(ee,Q={}){this.errors=ee,this._updateControlsErrors(!1!==Q.emitEvent)}get(ee){return function ni(ae,ee,Q){if(null==ee||(Array.isArray(ee)||(ee=ee.split(Q)),Array.isArray(ee)&&0===ee.length))return null;let Oe=ae;return ee.forEach(hn=>{Oe=mi(Oe)?Oe.controls.hasOwnProperty(hn)?Oe.controls[hn]:null:(ae=>ae instanceof go)(Oe)&&Oe.at(hn)||null}),Oe}(this,ee,".")}getError(ee,Q){const Oe=Q?this.get(Q):this;return Oe&&Oe.errors?Oe.errors[ee]:null}hasError(ee,Q){return!!this.getError(ee,Q)}get root(){let ee=this;for(;ee._parent;)ee=ee._parent;return ee}_updateControlsErrors(ee){this.status=this._calculateStatus(),ee&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(ee)}_initObservables(){this.valueChanges=new u.vpe,this.statusChanges=new u.vpe}_calculateStatus(){return this._allControlsDisabled()?qn:this.errors?pn:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Ln)?Ln:this._anyControlsHaveStatus(pn)?pn:rn}_anyControlsHaveStatus(ee){return this._anyControls(Q=>Q.status===ee)}_anyControlsDirty(){return this._anyControls(ee=>ee.dirty)}_anyControlsTouched(){return this._anyControls(ee=>ee.touched)}_updatePristine(ee={}){this.pristine=!this._anyControlsDirty(),this._parent&&!ee.onlySelf&&this._parent._updatePristine(ee)}_updateTouched(ee={}){this.touched=this._anyControlsTouched(),this._parent&&!ee.onlySelf&&this._parent._updateTouched(ee)}_isBoxedValue(ee){return"object"==typeof ee&&null!==ee&&2===Object.keys(ee).length&&"value"in ee&&"disabled"in ee}_registerOnCollectionChange(ee){this._onCollectionChange=ee}_setUpdateStrategy(ee){ci(ee)&&null!=ee.updateOn&&(this._updateOn=ee.updateOn)}_parentMarkedDirty(ee){return!ee&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class ur extends _r{constructor(ee=null,Q,Oe){super(Hn(Q),Ui(Oe,Q)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(ee),this._setUpdateStrategy(Q),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ci(Q)&&Q.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(ee)?ee.value:ee)}setValue(ee,Q={}){this.value=this._pendingValue=ee,this._onChange.length&&!1!==Q.emitModelToViewChange&&this._onChange.forEach(Oe=>Oe(this.value,!1!==Q.emitViewToModelChange)),this.updateValueAndValidity(Q)}patchValue(ee,Q={}){this.setValue(ee,Q)}reset(ee=this.defaultValue,Q={}){this._applyFormState(ee),this.markAsPristine(Q),this.markAsUntouched(Q),this.setValue(this.value,Q),this._pendingChange=!1}_updateValue(){}_anyControls(ee){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(ee){this._onChange.push(ee)}_unregisterOnChange(ee){Xe(this._onChange,ee)}registerOnDisabledChange(ee){this._onDisabledChange.push(ee)}_unregisterOnDisabledChange(ee){Xe(this._onDisabledChange,ee)}_forEachChild(ee){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(ee){this._isBoxedValue(ee)?(this.value=this._pendingValue=ee.value,ee.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=ee}}class Nr extends _r{constructor(ee,Q,Oe){super(Hn(Q),Ui(Oe,Q)),this.controls=ee,this._initObservables(),this._setUpdateStrategy(Q),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(ee,Q){return this.controls[ee]?this.controls[ee]:(this.controls[ee]=Q,Q.setParent(this),Q._registerOnCollectionChange(this._onCollectionChange),Q)}addControl(ee,Q,Oe={}){this.registerControl(ee,Q),this.updateValueAndValidity({emitEvent:Oe.emitEvent}),this._onCollectionChange()}removeControl(ee,Q={}){this.controls[ee]&&this.controls[ee]._registerOnCollectionChange(()=>{}),delete this.controls[ee],this.updateValueAndValidity({emitEvent:Q.emitEvent}),this._onCollectionChange()}setControl(ee,Q,Oe={}){this.controls[ee]&&this.controls[ee]._registerOnCollectionChange(()=>{}),delete this.controls[ee],Q&&this.registerControl(ee,Q),this.updateValueAndValidity({emitEvent:Oe.emitEvent}),this._onCollectionChange()}contains(ee){return this.controls.hasOwnProperty(ee)&&this.controls[ee].enabled}setValue(ee,Q={}){oi(this,ee),Object.keys(ee).forEach(Oe=>{cr(this,Oe),this.controls[Oe].setValue(ee[Oe],{onlySelf:!0,emitEvent:Q.emitEvent})}),this.updateValueAndValidity(Q)}patchValue(ee,Q={}){null!=ee&&(Object.keys(ee).forEach(Oe=>{this.controls[Oe]&&this.controls[Oe].patchValue(ee[Oe],{onlySelf:!0,emitEvent:Q.emitEvent})}),this.updateValueAndValidity(Q))}reset(ee={},Q={}){this._forEachChild((Oe,hn)=>{Oe.reset(ee[hn],{onlySelf:!0,emitEvent:Q.emitEvent})}),this._updatePristine(Q),this._updateTouched(Q),this.updateValueAndValidity(Q)}getRawValue(){return this._reduceChildren({},(ee,Q,Oe)=>(ee[Oe]=Zi(Q),ee))}_syncPendingControls(){let ee=this._reduceChildren(!1,(Q,Oe)=>!!Oe._syncPendingControls()||Q);return ee&&this.updateValueAndValidity({onlySelf:!0}),ee}_forEachChild(ee){Object.keys(this.controls).forEach(Q=>{const Oe=this.controls[Q];Oe&&ee(Oe,Q)})}_setUpControls(){this._forEachChild(ee=>{ee.setParent(this),ee._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(ee){for(const Q of Object.keys(this.controls)){const Oe=this.controls[Q];if(this.contains(Q)&&ee(Oe))return!0}return!1}_reduceValue(){return this._reduceChildren({},(ee,Q,Oe)=>((Q.enabled||this.disabled)&&(ee[Oe]=Q.value),ee))}_reduceChildren(ee,Q){let Oe=ee;return this._forEachChild((hn,ti)=>{Oe=Q(Oe,hn,ti)}),Oe}_allControlsDisabled(){for(const ee of Object.keys(this.controls))if(this.controls[ee].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class go extends _r{constructor(ee,Q,Oe){super(Hn(Q),Ui(Oe,Q)),this.controls=ee,this._initObservables(),this._setUpdateStrategy(Q),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(ee){return this.controls[ee]}push(ee,Q={}){this.controls.push(ee),this._registerControl(ee),this.updateValueAndValidity({emitEvent:Q.emitEvent}),this._onCollectionChange()}insert(ee,Q,Oe={}){this.controls.splice(ee,0,Q),this._registerControl(Q),this.updateValueAndValidity({emitEvent:Oe.emitEvent})}removeAt(ee,Q={}){this.controls[ee]&&this.controls[ee]._registerOnCollectionChange(()=>{}),this.controls.splice(ee,1),this.updateValueAndValidity({emitEvent:Q.emitEvent})}setControl(ee,Q,Oe={}){this.controls[ee]&&this.controls[ee]._registerOnCollectionChange(()=>{}),this.controls.splice(ee,1),Q&&(this.controls.splice(ee,0,Q),this._registerControl(Q)),this.updateValueAndValidity({emitEvent:Oe.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(ee,Q={}){oi(this,ee),ee.forEach((Oe,hn)=>{cr(this,hn),this.at(hn).setValue(Oe,{onlySelf:!0,emitEvent:Q.emitEvent})}),this.updateValueAndValidity(Q)}patchValue(ee,Q={}){null!=ee&&(ee.forEach((Oe,hn)=>{this.at(hn)&&this.at(hn).patchValue(Oe,{onlySelf:!0,emitEvent:Q.emitEvent})}),this.updateValueAndValidity(Q))}reset(ee=[],Q={}){this._forEachChild((Oe,hn)=>{Oe.reset(ee[hn],{onlySelf:!0,emitEvent:Q.emitEvent})}),this._updatePristine(Q),this._updateTouched(Q),this.updateValueAndValidity(Q)}getRawValue(){return this.controls.map(ee=>Zi(ee))}clear(ee={}){this.controls.length<1||(this._forEachChild(Q=>Q._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:ee.emitEvent}))}_syncPendingControls(){let ee=this.controls.reduce((Q,Oe)=>!!Oe._syncPendingControls()||Q,!1);return ee&&this.updateValueAndValidity({onlySelf:!0}),ee}_forEachChild(ee){this.controls.forEach((Q,Oe)=>{ee(Q,Oe)})}_updateValue(){this.value=this.controls.filter(ee=>ee.enabled||this.disabled).map(ee=>ee.value)}_anyControls(ee){return this.controls.some(Q=>Q.enabled&&ee(Q))}_setUpControls(){this._forEachChild(ee=>this._registerControl(ee))}_allControlsDisabled(){for(const ee of this.controls)if(ee.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(ee){ee.setParent(this),ee._registerOnCollectionChange(this._onCollectionChange)}}const tt={provide:ei,useExisting:(0,u.Gpc)(()=>Lt)},It=(()=>Promise.resolve(null))();let Lt=(()=>{class ae extends ei{constructor(Q,Oe,hn,ti,Ir){super(),this._changeDetectorRef=Ir,this.control=new ur,this._registered=!1,this.update=new u.vpe,this._parent=Q,this._setValidators(Oe),this._setAsyncValidators(hn),this.valueAccessor=function Dt(ae,ee){if(!ee)return null;let Q,Oe,hn;return Array.isArray(ee),ee.forEach(ti=>{ti.constructor===_e?Q=ti:function We(ae){return Object.getPrototypeOf(ae.constructor)===m}(ti)?Oe=ti:hn=ti}),hn||Oe||Q||null}(0,ti)}ngOnChanges(Q){if(this._checkForErrors(),!this._registered||"name"in Q){if(this._registered&&(this._checkName(),this.formDirective)){const Oe=Q.name.previousValue;this.formDirective.removeControl({name:Oe,path:this._getPath(Oe)})}this._setUpControl()}"isDisabled"in Q&&this._updateDisabled(Q),function Te(ae,ee){if(!ae.hasOwnProperty("model"))return!1;const Q=ae.model;return!!Q.isFirstChange()||!Object.is(ee,Q.currentValue)}(Q,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(Q){this.viewModel=Q,this.update.emit(Q)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){fi(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(Q){It.then(()=>{this.control.setValue(Q,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(Q){const Oe=Q.isDisabled.currentValue,hn=""===Oe||Oe&&"false"!==Oe;It.then(()=>{hn&&!this.control.disabled?this.control.disable():!hn&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(Q){return this._parent?function gi(ae,ee){return[...ee.path,ae]}(Q,this._parent):[Q]}}return ae.\u0275fac=function(Q){return new(Q||ae)(u.Y36(Gn,9),u.Y36(je,10),u.Y36(nt,10),u.Y36($,10),u.Y36(u.sBO,8))},ae.\u0275dir=u.lG2({type:ae,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[u._Bn([tt]),u.qOj,u.TTD]}),ae})();const dn={provide:$,useExisting:(0,u.Gpc)(()=>ln),multi:!0};let ln=(()=>{class ae extends m{writeValue(Q){this.setProperty("value",Q??"")}registerOnChange(Q){this.onChange=Oe=>{Q(""==Oe?null:parseFloat(Oe))}}}return ae.\u0275fac=function(){let ee;return function(Oe){return(ee||(ee=u.n5z(ae)))(Oe||ae)}}(),ae.\u0275dir=u.lG2({type:ae,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(Q,Oe){1&Q&&u.NdJ("input",function(ti){return Oe.onChange(ti.target.value)})("blur",function(){return Oe.onTouched()})},features:[u._Bn([dn]),u.qOj]}),ae})(),Ot=(()=>{class ae{}return ae.\u0275fac=function(Q){return new(Q||ae)},ae.\u0275mod=u.oAB({type:ae}),ae.\u0275inj=u.cJS({}),ae})();function ro(ae){return"number"==typeof ae?ae:parseFloat(ae)}let Vo=(()=>{class ae{constructor(){this._validator=xt}ngOnChanges(Q){if(this.inputName in Q){const Oe=this.normalizeInput(Q[this.inputName].currentValue);this._enabled=this.enabled(Oe),this._validator=this._enabled?this.createValidator(Oe):xt,this._onChange&&this._onChange()}}validate(Q){return this._validator(Q)}registerOnValidatorChange(Q){this._onChange=Q}enabled(Q){return null!=Q}}return ae.\u0275fac=function(Q){return new(Q||ae)},ae.\u0275dir=u.lG2({type:ae,features:[u.TTD]}),ae})();const bs={provide:je,useExisting:(0,u.Gpc)(()=>Wr),multi:!0};let Wr=(()=>{class ae extends Vo{constructor(){super(...arguments),this.inputName="max",this.normalizeInput=Q=>ro(Q),this.createValidator=Q=>function $e(ae){return ee=>{if(ge(ee.value)||ge(ae))return null;const Q=parseFloat(ee.value);return!isNaN(Q)&&Q>ae?{max:{max:ae,actual:ee.value}}:null}}(Q)}}return ae.\u0275fac=function(){let ee;return function(Oe){return(ee||(ee=u.n5z(ae)))(Oe||ae)}}(),ae.\u0275dir=u.lG2({type:ae,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(Q,Oe){2&Q&&u.uIk("max",Oe._enabled?Oe.max:null)},inputs:{max:"max"},features:[u._Bn([bs]),u.qOj]}),ae})();const Bs={provide:je,useExisting:(0,u.Gpc)(()=>$o),multi:!0};let $o=(()=>{class ae extends Vo{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=Q=>ro(Q),this.createValidator=Q=>function Ne(ae){return ee=>{if(ge(ee.value)||ge(ae))return null;const Q=parseFloat(ee.value);return!isNaN(Q)&&Q<ae?{min:{min:ae,actual:ee.value}}:null}}(Q)}}return ae.\u0275fac=function(){let ee;return function(Oe){return(ee||(ee=u.n5z(ae)))(Oe||ae)}}(),ae.\u0275dir=u.lG2({type:ae,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(Q,Oe){2&Q&&u.uIk("min",Oe._enabled?Oe.min:null)},inputs:{min:"min"},features:[u._Bn([Bs]),u.qOj]}),ae})(),Wn=(()=>{class ae{}return ae.\u0275fac=function(Q){return new(Q||ae)},ae.\u0275mod=u.oAB({type:ae}),ae.\u0275inj=u.cJS({imports:[[Ot]]}),ae})(),yr=(()=>{class ae{}return ae.\u0275fac=function(Q){return new(Q||ae)},ae.\u0275mod=u.oAB({type:ae}),ae.\u0275inj=u.cJS({imports:[Wn]}),ae})()},3334:(Tn,Je,R)=>{"use strict";R.d(Je,{gz:()=>Ai,y6:()=>jr,OD:()=>Rt,eC:()=>ie,wN:()=>_a,F0:()=>Fo,rH:()=>ya,Bz:()=>Il,Hx:()=>bi});var u=R(6895),d=R(6738),j=R(2866),l=R(6688),L=R(3489);class P extends L.L{notifyNext(O,S,J,ce,Me){this.destination.next(S)}notifyError(O,S){this.destination.error(O)}notifyComplete(O){this.destination.complete()}}class m extends L.L{constructor(O,S,J){super(),this.parent=O,this.outerValue=S,this.outerIndex=J,this.index=0}_next(O){this.parent.notifyNext(this.outerValue,O,this.outerIndex,this.index++,this)}_error(O){this.parent.notifyError(O,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}var $=R(9249),ue=R(2916);function V(z,O,S,J,ce=new m(z,S,J)){if(!ce.closed)return O instanceof ue.y?O.subscribe(ce):(0,$.s)(O)(ce)}var Z=R(3009);const K={};class _e{constructor(O){this.resultSelector=O}call(O,S){return S.subscribe(new ge(O,this.resultSelector))}}class ge extends P{constructor(O,S){super(O),this.resultSelector=S,this.active=0,this.values=[],this.observables=[]}_next(O){this.values.push(K),this.observables.push(O)}_complete(){const O=this.observables,S=O.length;if(0===S)this.destination.complete();else{this.active=S,this.toRespond=S;for(let J=0;J<S;J++)this.add(V(this,O[J],void 0,J))}}notifyComplete(O){0==(this.active-=1)&&this.destination.complete()}notifyNext(O,S,J){const ce=this.values,lt=this.toRespond?ce[J]===K?--this.toRespond:this.toRespond:0;ce[J]=S,0===lt&&(this.resultSelector?this._tryResultSelector(ce):this.destination.next(ce.slice()))}_tryResultSelector(O){let S;try{S=this.resultSelector.apply(this,O)}catch(J){return void this.destination.error(J)}this.destination.next(S)}}const je=(()=>{function z(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return z.prototype=Object.create(Error.prototype),z})();var nt=R(5254),Fe=R(1086),ke=R(591),Ne=R(1221),$e=R(8514),Re=R(8896),_t=R(1762),Ge=R(8929);function yt(z,O){let S=!1;return arguments.length>=2&&(S=!0),function(ce){return ce.lift(new wt(z,O,S))}}class wt{constructor(O,S,J=!1){this.accumulator=O,this.seed=S,this.hasSeed=J}call(O,S){return S.subscribe(new xt(O,this.accumulator,this.seed,this.hasSeed))}}class xt extends L.L{constructor(O,S,J,ce){super(O),this.accumulator=S,this._seed=J,this.hasSeed=ce,this.index=0}get seed(){return this._seed}set seed(O){this.hasSeed=!0,this._seed=O}_next(O){if(this.hasSeed)return this._tryNext(O);this.seed=O,this.destination.next(O)}_tryNext(O){const S=this.index++;let J;try{J=this.accumulator(this.seed,O,S)}catch(ce){this.destination.error(ce)}this.seed=J,this.destination.next(J)}}var dt=R(1177);function At(z){return function(S){const J=new Vt(z),ce=S.lift(J);return J.caught=ce}}class Vt{constructor(O){this.selector=O}call(O,S){return S.subscribe(new Un(O,this.selector,this.caught))}}class Un extends dt.Ds{constructor(O,S,J){super(O),this.selector=S,this.caught=J}error(O){if(!this.isStopped){let S;try{S=this.selector(O,this.caught)}catch(Me){return void super.error(Me)}this._unsubscribeAndRecycle();const J=new dt.IY(this);this.add(J);const ce=(0,dt.ft)(S,J);ce!==J&&this.add(ce)}}}var St=R(2198),$t=R(4231);function zt(z){return function(S){return 0===z?(0,Re.c)():S.lift(new Ht(z))}}class Ht{constructor(O){if(this.total=O,this.total<0)throw new $t.W}call(O,S){return S.subscribe(new en(O,this.total))}}class en extends L.L{constructor(O,S){super(O),this.total=S,this.ring=new Array,this.count=0}_next(O){const S=this.ring,J=this.total,ce=this.count++;S.length<J?S.push(O):S[ce%J]=O}_complete(){const O=this.destination;let S=this.count;if(S>0){const J=this.count>=this.total?this.total:this.count,ce=this.ring;for(let Me=0;Me<J;Me++){const lt=S++%J;O.next(ce[lt])}}O.complete()}}function Kt(z=qt){return O=>O.lift(new Wt(z))}class Wt{constructor(O){this.errorFactory=O}call(O,S){return S.subscribe(new Yt(O,this.errorFactory))}}class Yt extends L.L{constructor(O,S){super(O),this.errorFactory=S,this.hasValue=!1}_next(O){this.hasValue=!0,this.destination.next(O)}_complete(){if(this.hasValue)return this.destination.complete();{let O;try{O=this.errorFactory()}catch(S){O=S}this.destination.error(O)}}}function qt(){return new je}function Gt(z=null){return O=>O.lift(new ft(z))}class ft{constructor(O){this.defaultValue=O}call(O,S){return S.subscribe(new Ut(O,this.defaultValue))}}class Ut extends L.L{constructor(O,S){super(O),this.defaultValue=S,this.isEmpty=!0}_next(O){this.isEmpty=!1,this.destination.next(O)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}var On=R(5379),Gn=R(2986);function ei(z,O){const S=arguments.length>=2;return J=>J.pipe(z?(0,St.h)((ce,Me)=>z(ce,Me,J)):On.y,(0,Gn.q)(1),S?Gt(O):Kt(()=>new je))}function $i(){}var sr=R(7043);function zi(z,O,S){return function(ce){return ce.lift(new yi(z,O,S))}}class yi{constructor(O,S,J){this.nextOrObserver=O,this.error=S,this.complete=J}call(O,S){return S.subscribe(new ji(O,this.nextOrObserver,this.error,this.complete))}}class ji extends L.L{constructor(O,S,J,ce){super(O),this._tapNext=$i,this._tapError=$i,this._tapComplete=$i,this._tapError=J||$i,this._tapComplete=ce||$i,(0,sr.m)(S)?(this._context=this,this._tapNext=S):S&&(this._context=S,this._tapNext=S.next||$i,this._tapError=S.error||$i,this._tapComplete=S.complete||$i)}_next(O){try{this._tapNext.call(this._context,O)}catch(S){return void this.destination.error(S)}this.destination.next(O)}_error(O){try{this._tapError.call(this._context,O)}catch(S){return void this.destination.error(S)}this.destination.error(O)}_complete(){try{this._tapComplete.call(this._context)}catch(O){return void this.destination.error(O)}return this.destination.complete()}}var _i=R(2654);class Qt{constructor(O){this.callback=O}call(O,S){return S.subscribe(new Ye(O,this.callback))}}class Ye extends L.L{constructor(O,S){super(O),this.add(new _i.w(S))}}var te=R(4850),Ae=R(7545),ut=R(1406),Pe=R(1709),Nt=R(4327),me=R(9146);class qe{constructor(O,S){this.id=O,this.url=S}}class Rt extends qe{constructor(O,S,J="imperative",ce=null){super(O,S),this.navigationTrigger=J,this.restoredState=ce}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Xt extends qe{constructor(O,S,J){super(O,S),this.urlAfterRedirects=J}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Xn extends qe{constructor(O,S,J){super(O,S),this.reason=J}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Ki extends qe{constructor(O,S,J){super(O,S),this.error=J}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Di extends qe{constructor(O,S,J,ce){super(O,S),this.urlAfterRedirects=J,this.state=ce}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gi extends qe{constructor(O,S,J,ce){super(O,S),this.urlAfterRedirects=J,this.state=ce}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class fi extends qe{constructor(O,S,J,ce,Me){super(O,S),this.urlAfterRedirects=J,this.state=ce,this.shouldActivate=Me}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Cr extends qe{constructor(O,S,J,ce){super(O,S),this.urlAfterRedirects=J,this.state=ce}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Vi extends qe{constructor(O,S,J,ce){super(O,S),this.urlAfterRedirects=J,this.state=ce}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gr{constructor(O){this.route=O}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Pi{constructor(O){this.route=O}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Br{constructor(O){this.snapshot=O}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ei{constructor(O){this.snapshot=O}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Rr{constructor(O){this.snapshot=O}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class _n{constructor(O){this.snapshot=O}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class tr{constructor(O,S,J){this.routerEvent=O,this.position=S,this.anchor=J}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const ie="primary";class X{constructor(O){this.params=O||{}}has(O){return Object.prototype.hasOwnProperty.call(this.params,O)}get(O){if(this.has(O)){const S=this.params[O];return Array.isArray(S)?S[0]:S}return null}getAll(O){if(this.has(O)){const S=this.params[O];return Array.isArray(S)?S:[S]}return[]}get keys(){return Object.keys(this.params)}}function F(z){return new X(z)}const he="ngNavigationCancelingError";function Te(z){const O=Error("NavigationCancelingError: "+z);return O[he]=!0,O}function mt(z,O,S){const J=S.path.split("/");if(J.length>z.length||"full"===S.pathMatch&&(O.hasChildren()||J.length<z.length))return null;const ce={};for(let Me=0;Me<J.length;Me++){const lt=J[Me],bt=z[Me];if(lt.startsWith(":"))ce[lt.substring(1)]=bt;else if(lt!==bt.path)return null}return{consumed:z.slice(0,J.length),posParams:ce}}function Xe(z,O){const S=z?Object.keys(z):void 0,J=O?Object.keys(O):void 0;if(!S||!J||S.length!=J.length)return!1;let ce;for(let Me=0;Me<S.length;Me++)if(ce=S[Me],!kt(z[ce],O[ce]))return!1;return!0}function kt(z,O){if(Array.isArray(z)&&Array.isArray(O)){if(z.length!==O.length)return!1;const S=[...z].sort(),J=[...O].sort();return S.every((ce,Me)=>J[Me]===ce)}return z===O}function tn(z){return Array.prototype.concat.apply([],z)}function rn(z){return z.length>0?z[z.length-1]:null}function Ln(z,O){for(const S in z)z.hasOwnProperty(S)&&O(z[S],S)}function qn(z){return(0,d.CqO)(z)?z:(0,d.QGY)(z)?(0,nt.D)(Promise.resolve(z)):(0,Fe.of)(z)}const Hn={exact:function ci(z,O,S){if(!Nr(z.segments,O.segments)||!Zi(z.segments,O.segments,S)||z.numberOfChildren!==O.numberOfChildren)return!1;for(const J in O.children)if(!z.children[J]||!ci(z.children[J],O.children[J],S))return!1;return!0},subset:mi},ii={exact:function Fi(z,O){return Xe(z,O)},subset:function Mn(z,O){return Object.keys(O).length<=Object.keys(z).length&&Object.keys(O).every(S=>kt(z[S],O[S]))},ignored:()=>!0};function Ui(z,O,S){return Hn[S.paths](z.root,O.root,S.matrixParams)&&ii[S.queryParams](z.queryParams,O.queryParams)&&!("exact"===S.fragment&&z.fragment!==O.fragment)}function mi(z,O,S){return Ii(z,O,O.segments,S)}function Ii(z,O,S,J){if(z.segments.length>S.length){const ce=z.segments.slice(0,S.length);return!(!Nr(ce,S)||O.hasChildren()||!Zi(ce,S,J))}if(z.segments.length===S.length){if(!Nr(z.segments,S)||!Zi(z.segments,S,J))return!1;for(const ce in O.children)if(!z.children[ce]||!mi(z.children[ce],O.children[ce],J))return!1;return!0}{const ce=S.slice(0,z.segments.length),Me=S.slice(z.segments.length);return!!(Nr(z.segments,ce)&&Zi(z.segments,ce,J)&&z.children[ie])&&Ii(z.children[ie],O,Me,J)}}function Zi(z,O,S){return O.every((J,ce)=>ii[S](z[ce].parameters,J.parameters))}class cr{constructor(O,S,J){this.root=O,this.queryParams=S,this.fragment=J}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=F(this.queryParams)),this._queryParamMap}toString(){return Hr.serialize(this)}}class oi{constructor(O,S){this.segments=O,this.children=S,this.parent=null,Ln(S,(J,ce)=>J.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Jr(this)}}class _r{constructor(O,S){this.path=O,this.parameters=S}get parameterMap(){return this._parameterMap||(this._parameterMap=F(this.parameters)),this._parameterMap}toString(){return It(this)}}function Nr(z,O){return z.length===O.length&&z.every((S,J)=>S.path===O[J].path)}class bi{}class ao{parse(O){const S=new ki(O);return new cr(S.parseRootSegment(),S.parseQueryParams(),S.parseFragment())}serialize(O){const S=`/${Pr(O.root,!0)}`,J=function nn(z){const O=Object.keys(z).map(S=>{const J=z[S];return Array.isArray(J)?J.map(ce=>`${Vr(S)}=${Vr(ce)}`).join("&"):`${Vr(S)}=${Vr(J)}`}).filter(S=>!!S);return O.length?`?${O.join("&")}`:""}(O.queryParams);return`${S}${J}${"string"==typeof O.fragment?`#${function Ee(z){return encodeURI(z)}(O.fragment)}`:""}`}}const Hr=new ao;function Jr(z){return z.segments.map(O=>It(O)).join("/")}function Pr(z,O){if(!z.hasChildren())return Jr(z);if(O){const S=z.children[ie]?Pr(z.children[ie],!1):"",J=[];return Ln(z.children,(ce,Me)=>{Me!==ie&&J.push(`${Me}:${Pr(ce,!1)}`)}),J.length>0?`${S}(${J.join("//")})`:S}{const S=function go(z,O){let S=[];return Ln(z.children,(J,ce)=>{ce===ie&&(S=S.concat(O(J,ce)))}),Ln(z.children,(J,ce)=>{ce!==ie&&(S=S.concat(O(J,ce)))}),S}(z,(J,ce)=>ce===ie?[Pr(z.children[ie],!1)]:[`${ce}:${Pr(J,!1)}`]);return 1===Object.keys(z.children).length&&null!=z.children[ie]?`${Jr(z)}/${S[0]}`:`${Jr(z)}/(${S.join("//")})`}}function Lr(z){return encodeURIComponent(z).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Vr(z){return Lr(z).replace(/%3B/gi,";")}function He(z){return Lr(z).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ce(z){return decodeURIComponent(z)}function tt(z){return Ce(z.replace(/\+/g,"%20"))}function It(z){return`${He(z.path)}${function Lt(z){return Object.keys(z).map(O=>`;${He(O)}=${He(z[O])}`).join("")}(z.parameters)}`}const dn=/^[^\/()?;=#]+/;function ln(z){const O=z.match(dn);return O?O[0]:""}const En=/^[^=?&#]+/,Ot=/^[^&#]+/;class ki{constructor(O){this.url=O,this.remaining=O}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new oi([],{}):new oi([],this.parseChildren())}parseQueryParams(){const O={};if(this.consumeOptional("?"))do{this.parseQueryParam(O)}while(this.consumeOptional("&"));return O}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const O=[];for(this.peekStartsWith("(")||O.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),O.push(this.parseSegment());let S={};this.peekStartsWith("/(")&&(this.capture("/"),S=this.parseParens(!0));let J={};return this.peekStartsWith("(")&&(J=this.parseParens(!1)),(O.length>0||Object.keys(S).length>0)&&(J[ie]=new oi(O,S)),J}parseSegment(){const O=ln(this.remaining);if(""===O&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(O),new _r(Ce(O),this.parseMatrixParams())}parseMatrixParams(){const O={};for(;this.consumeOptional(";");)this.parseParam(O);return O}parseParam(O){const S=ln(this.remaining);if(!S)return;this.capture(S);let J="";if(this.consumeOptional("=")){const ce=ln(this.remaining);ce&&(J=ce,this.capture(J))}O[Ce(S)]=Ce(J)}parseQueryParam(O){const S=function $n(z){const O=z.match(En);return O?O[0]:""}(this.remaining);if(!S)return;this.capture(S);let J="";if(this.consumeOptional("=")){const lt=function cn(z){const O=z.match(Ot);return O?O[0]:""}(this.remaining);lt&&(J=lt,this.capture(J))}const ce=tt(S),Me=tt(J);if(O.hasOwnProperty(ce)){let lt=O[ce];Array.isArray(lt)||(lt=[lt],O[ce]=lt),lt.push(Me)}else O[ce]=Me}parseParens(O){const S={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const J=ln(this.remaining),ce=this.remaining[J.length];if("/"!==ce&&")"!==ce&&";"!==ce)throw new Error(`Cannot parse url '${this.url}'`);let Me;J.indexOf(":")>-1?(Me=J.substr(0,J.indexOf(":")),this.capture(Me),this.capture(":")):O&&(Me=ie);const lt=this.parseChildren();S[Me]=1===Object.keys(lt).length?lt[ie]:new oi([],lt),this.consumeOptional("//")}return S}peekStartsWith(O){return this.remaining.startsWith(O)}consumeOptional(O){return!!this.peekStartsWith(O)&&(this.remaining=this.remaining.substring(O.length),!0)}capture(O){if(!this.consumeOptional(O))throw new Error(`Expected "${O}".`)}}class $r{constructor(O){this._root=O}get root(){return this._root.value}parent(O){const S=this.pathFromRoot(O);return S.length>1?S[S.length-2]:null}children(O){const S=Hi(O,this._root);return S?S.children.map(J=>J.value):[]}firstChild(O){const S=Hi(O,this._root);return S&&S.children.length>0?S.children[0].value:null}siblings(O){const S=Er(O,this._root);return S.length<2?[]:S[S.length-2].children.map(ce=>ce.value).filter(ce=>ce!==O)}pathFromRoot(O){return Er(O,this._root).map(S=>S.value)}}function Hi(z,O){if(z===O.value)return O;for(const S of O.children){const J=Hi(z,S);if(J)return J}return null}function Er(z,O){if(z===O.value)return[O];for(const S of O.children){const J=Er(z,S);if(J.length)return J.unshift(O),J}return[]}class nr{constructor(O,S){this.value=O,this.children=S}toString(){return`TreeNode(${this.value})`}}function vo(z){const O={};return z&&z.children.forEach(S=>O[S.value.outlet]=S),O}class _o extends $r{constructor(O,S){super(O),this.snapshot=S,Ct(this,O)}toString(){return this.snapshot.toString()}}function Zn(z,O){const S=function Wi(z,O){const lt=new Ke([],{},{},"",{},ie,O,null,z.root,-1,{});return new Se("",new nr(lt,[]))}(z,O),J=new ke.X([new _r("",{})]),ce=new ke.X({}),Me=new ke.X({}),lt=new ke.X({}),bt=new ke.X(""),xn=new Ai(J,ce,lt,bt,Me,ie,O,S.root);return xn.snapshot=S.root,new _o(new nr(xn,[]),S)}class Ai{constructor(O,S,J,ce,Me,lt,bt,xn){this.url=O,this.params=S,this.queryParams=J,this.fragment=ce,this.data=Me,this.outlet=lt,this.component=bt,this._futureSnapshot=xn}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,te.U)(O=>F(O)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,te.U)(O=>F(O)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Oo(z,O="emptyOnly"){const S=z.pathFromRoot;let J=0;if("always"!==O)for(J=S.length-1;J>=1;){const ce=S[J],Me=S[J-1];if(ce.routeConfig&&""===ce.routeConfig.path)J--;else{if(Me.component)break;J--}}return function it(z){return z.reduce((O,S)=>({params:{...O.params,...S.params},data:{...O.data,...S.data},resolve:{...O.resolve,...S._resolvedData}}),{params:{},data:{},resolve:{}})}(S.slice(J))}class Ke{constructor(O,S,J,ce,Me,lt,bt,xn,pi,zr,Ri){this.url=O,this.params=S,this.queryParams=J,this.fragment=ce,this.data=Me,this.outlet=lt,this.component=bt,this.routeConfig=xn,this._urlSegment=pi,this._lastPathIndex=zr,this._resolve=Ri}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=F(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=F(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(J=>J.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Se extends $r{constructor(O,S){super(S),this.url=O,Ct(this,S)}toString(){return sn(this._root)}}function Ct(z,O){O.value._routerState=z,O.children.forEach(S=>Ct(z,S))}function sn(z){const O=z.children.length>0?` { ${z.children.map(sn).join(", ")} } `:"";return`${z.value}${O}`}function si(z){if(z.snapshot){const O=z.snapshot,S=z._futureSnapshot;z.snapshot=S,Xe(O.queryParams,S.queryParams)||z.queryParams.next(S.queryParams),O.fragment!==S.fragment&&z.fragment.next(S.fragment),Xe(O.params,S.params)||z.params.next(S.params),function Dt(z,O){if(z.length!==O.length)return!1;for(let S=0;S<z.length;++S)if(!Xe(z[S],O[S]))return!1;return!0}(O.url,S.url)||z.url.next(S.url),Xe(O.data,S.data)||z.data.next(S.data)}else z.snapshot=z._futureSnapshot,z.data.next(z._futureSnapshot.data)}function hi(z,O){const S=Xe(z.params,O.params)&&function ur(z,O){return Nr(z,O)&&z.every((S,J)=>Xe(S.parameters,O[J].parameters))}(z.url,O.url);return S&&!(!z.parent!=!O.parent)&&(!z.parent||hi(z.parent,O.parent))}function ar(z,O,S){if(S&&z.shouldReuseRoute(O.value,S.value.snapshot)){const J=S.value;J._futureSnapshot=O.value;const ce=function es(z,O,S){return O.children.map(J=>{for(const ce of S.children)if(z.shouldReuseRoute(J.value,ce.value.snapshot))return ar(z,J,ce);return ar(z,J)})}(z,O,S);return new nr(J,ce)}{if(z.shouldAttach(O.value)){const Me=z.retrieve(O.value);if(null!==Me){const lt=Me.route;return lt.value._futureSnapshot=O.value,lt.children=O.children.map(bt=>ar(z,bt)),lt}}const J=function ts(z){return new Ai(new ke.X(z.url),new ke.X(z.params),new ke.X(z.queryParams),new ke.X(z.fragment),new ke.X(z.data),z.outlet,z.component,z)}(O.value),ce=O.children.map(Me=>ar(z,Me));return new nr(J,ce)}}function Io(z){return"object"==typeof z&&null!=z&&!z.outlets&&!z.segmentPath}function Bi(z){return"object"==typeof z&&null!=z&&z.outlets}function ks(z,O,S,J,ce){let Me={};return J&&Ln(J,(lt,bt)=>{Me[bt]=Array.isArray(lt)?lt.map(xn=>`${xn}`):`${lt}`}),new cr(S.root===z?O:Fs(S.root,z,O),Me,ce)}function Fs(z,O,S){const J={};return Ln(z.children,(ce,Me)=>{J[Me]=ce===O?S:Fs(ce,O,S)}),new oi(z.segments,J)}class Ni{constructor(O,S,J){if(this.isAbsolute=O,this.numberOfDoubleDots=S,this.commands=J,O&&J.length>0&&Io(J[0]))throw new Error("Root segment cannot have matrix parameters");const ce=J.find(Bi);if(ce&&ce!==rn(J))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Vo{constructor(O,S,J){this.segmentGroup=O,this.processChildren=S,this.index=J}}function $o(z,O,S){if(z||(z=new oi([],{})),0===z.segments.length&&z.hasChildren())return Qr(z,O,S);const J=function Ns(z,O,S){let J=0,ce=O;const Me={match:!1,pathIndex:0,commandIndex:0};for(;ce<z.segments.length;){if(J>=S.length)return Me;const lt=z.segments[ce],bt=S[J];if(Bi(bt))break;const xn=`${bt}`,pi=J<S.length-1?S[J+1]:null;if(ce>0&&void 0===xn)break;if(xn&&pi&&"object"==typeof pi&&void 0===pi.outlets){if(!xo(xn,pi,lt))return Me;J+=2}else{if(!xo(xn,{},lt))return Me;J++}ce++}return{match:!0,pathIndex:ce,commandIndex:J}}(z,O,S),ce=S.slice(J.commandIndex);if(J.match&&J.pathIndex<z.segments.length){const Me=new oi(z.segments.slice(0,J.pathIndex),{});return Me.children[ie]=new oi(z.segments.slice(J.pathIndex),z.children),Qr(Me,0,ce)}return J.match&&0===ce.length?new oi(z.segments,{}):J.match&&!z.hasChildren()?uo(z,O,S):J.match?Qr(z,0,ce):uo(z,O,S)}function Qr(z,O,S){if(0===S.length)return new oi(z.segments,{});{const J=function Bs(z){return Bi(z[0])?z[0].outlets:{[ie]:z}}(S),ce={};return Ln(J,(Me,lt)=>{"string"==typeof Me&&(Me=[Me]),null!==Me&&(ce[lt]=$o(z.children[lt],O,Me))}),Ln(z.children,(Me,lt)=>{void 0===J[lt]&&(ce[lt]=Me)}),new oi(z.segments,ce)}}function uo(z,O,S){const J=z.segments.slice(0,O);let ce=0;for(;ce<S.length;){const Me=S[ce];if(Bi(Me)){const xn=Mo(Me.outlets);return new oi(J,xn)}if(0===ce&&Io(S[0])){J.push(new _r(z.segments[O].path,ns(S[0]))),ce++;continue}const lt=Bi(Me)?Me.outlets[ie]:`${Me}`,bt=ce<S.length-1?S[ce+1]:null;lt&&bt&&Io(bt)?(J.push(new _r(lt,ns(bt))),ce+=2):(J.push(new _r(lt,{})),ce++)}return new oi(J,{})}function Mo(z){const O={};return Ln(z,(S,J)=>{"string"==typeof S&&(S=[S]),null!==S&&(O[J]=uo(new oi([],{}),0,S))}),O}function ns(z){const O={};return Ln(z,(S,J)=>O[J]=`${S}`),O}function xo(z,O,S){return z==S.path&&Xe(O,S.parameters)}class Qs{constructor(O,S,J,ce){this.routeReuseStrategy=O,this.futureState=S,this.currState=J,this.forwardEvent=ce}activate(O){const S=this.futureState._root,J=this.currState?this.currState._root:null;this.deactivateChildRoutes(S,J,O),si(this.futureState.root),this.activateChildRoutes(S,J,O)}deactivateChildRoutes(O,S,J){const ce=vo(S);O.children.forEach(Me=>{const lt=Me.value.outlet;this.deactivateRoutes(Me,ce[lt],J),delete ce[lt]}),Ln(ce,(Me,lt)=>{this.deactivateRouteAndItsChildren(Me,J)})}deactivateRoutes(O,S,J){const ce=O.value,Me=S?S.value:null;if(ce===Me)if(ce.component){const lt=J.getContext(ce.outlet);lt&&this.deactivateChildRoutes(O,S,lt.children)}else this.deactivateChildRoutes(O,S,J);else Me&&this.deactivateRouteAndItsChildren(S,J)}deactivateRouteAndItsChildren(O,S){O.value.component&&this.routeReuseStrategy.shouldDetach(O.value.snapshot)?this.detachAndStoreRouteSubtree(O,S):this.deactivateRouteAndOutlet(O,S)}detachAndStoreRouteSubtree(O,S){const J=S.getContext(O.value.outlet),ce=J&&O.value.component?J.children:S,Me=vo(O);for(const lt of Object.keys(Me))this.deactivateRouteAndItsChildren(Me[lt],ce);if(J&&J.outlet){const lt=J.outlet.detach(),bt=J.children.onOutletDeactivated();this.routeReuseStrategy.store(O.value.snapshot,{componentRef:lt,route:O,contexts:bt})}}deactivateRouteAndOutlet(O,S){const J=S.getContext(O.value.outlet),ce=J&&O.value.component?J.children:S,Me=vo(O);for(const lt of Object.keys(Me))this.deactivateRouteAndItsChildren(Me[lt],ce);J&&J.outlet&&(J.outlet.deactivate(),J.children.onOutletDeactivated(),J.attachRef=null,J.resolver=null,J.route=null)}activateChildRoutes(O,S,J){const ce=vo(S);O.children.forEach(Me=>{this.activateRoutes(Me,ce[Me.value.outlet],J),this.forwardEvent(new _n(Me.value.snapshot))}),O.children.length&&this.forwardEvent(new Ei(O.value.snapshot))}activateRoutes(O,S,J){const ce=O.value,Me=S?S.value:null;if(si(ce),ce===Me)if(ce.component){const lt=J.getOrCreateContext(ce.outlet);this.activateChildRoutes(O,S,lt.children)}else this.activateChildRoutes(O,S,J);else if(ce.component){const lt=J.getOrCreateContext(ce.outlet);if(this.routeReuseStrategy.shouldAttach(ce.snapshot)){const bt=this.routeReuseStrategy.retrieve(ce.snapshot);this.routeReuseStrategy.store(ce.snapshot,null),lt.children.onOutletReAttached(bt.contexts),lt.attachRef=bt.componentRef,lt.route=bt.route.value,lt.outlet&&lt.outlet.attach(bt.componentRef,bt.route.value),si(bt.route.value),this.activateChildRoutes(O,null,lt.children)}else{const bt=function oe(z){for(let O=z.parent;O;O=O.parent){const S=O.routeConfig;if(S&&S._loadedConfig)return S._loadedConfig;if(S&&S.component)return null}return null}(ce.snapshot),xn=bt?bt.module.componentFactoryResolver:null;lt.attachRef=null,lt.route=ce,lt.resolver=xn,lt.outlet&&lt.outlet.activateWith(ce,xn),this.activateChildRoutes(O,null,lt.children)}}else this.activateChildRoutes(O,null,J)}}class we{constructor(O,S){this.routes=O,this.module=S}}function se(z){return"function"==typeof z}function Mt(z){return z instanceof cr}const Dr=Symbol("INITIAL_VALUE");function Oi(){return(0,Ae.w)(z=>function re(...z){let O,S;return(0,j.K)(z[z.length-1])&&(S=z.pop()),"function"==typeof z[z.length-1]&&(O=z.pop()),1===z.length&&(0,l.k)(z[0])&&(z=z[0]),(0,Z.n)(z,S).lift(new _e(O))}(z.map(O=>O.pipe((0,Gn.q)(1),function ot(...z){const O=z[z.length-1];return(0,j.K)(O)?(z.pop(),S=>(0,Ne.z)(z,S,O)):S=>(0,Ne.z)(z,S)}(Dr)))).pipe(yt((O,S)=>{let J=!1;return S.reduce((ce,Me,lt)=>ce!==Dr?ce:(Me===Dr&&(J=!0),J||!1!==Me&&lt!==S.length-1&&!Mt(Me)?ce:Me),O)},Dr),(0,St.h)(O=>O!==Dr),(0,te.U)(O=>Mt(O)?O:!0===O),(0,Gn.q)(1)))}class dr{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new jr,this.attachRef=null}}class jr{constructor(){this.contexts=new Map}onChildOutletCreated(O,S){const J=this.getOrCreateContext(O);J.outlet=S,this.contexts.set(O,J)}onChildOutletDestroyed(O){const S=this.getContext(O);S&&(S.outlet=null,S.attachRef=null)}onOutletDeactivated(){const O=this.contexts;return this.contexts=new Map,O}onOutletReAttached(O){this.contexts=O}getOrCreateContext(O){let S=this.getContext(O);return S||(S=new dr,this.contexts.set(O,S)),S}getContext(O){return this.contexts.get(O)||null}}let ae=(()=>{class z{constructor(S,J,ce,Me,lt){this.parentContexts=S,this.location=J,this.resolver=ce,this.changeDetector=lt,this.activated=null,this._activatedRoute=null,this.activateEvents=new d.vpe,this.deactivateEvents=new d.vpe,this.attachEvents=new d.vpe,this.detachEvents=new d.vpe,this.name=Me||ie,S.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const S=this.parentContexts.getContext(this.name);S&&S.route&&(S.attachRef?this.attach(S.attachRef,S.route):this.activateWith(S.route,S.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const S=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(S.instance),S}attach(S,J){this.activated=S,this._activatedRoute=J,this.location.insert(S.hostView),this.attachEvents.emit(S.instance)}deactivate(){if(this.activated){const S=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(S)}}activateWith(S,J){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=S;const lt=(J=J||this.resolver).resolveComponentFactory(S._futureSnapshot.routeConfig.component),bt=this.parentContexts.getOrCreateContext(this.name).children,xn=new ee(S,bt,this.location.injector);this.activated=this.location.createComponent(lt,this.location.length,xn),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return z.\u0275fac=function(S){return new(S||z)(d.Y36(jr),d.Y36(d.s_b),d.Y36(d._Vd),d.$8M("name"),d.Y36(d.sBO))},z.\u0275dir=d.lG2({type:z,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),z})();class ee{constructor(O,S,J){this.route=O,this.childContexts=S,this.parent=J}get(O,S){return O===Ai?this.route:O===jr?this.childContexts:this.parent.get(O,S)}}let Q=(()=>{class z{}return z.\u0275fac=function(S){return new(S||z)},z.\u0275cmp=d.Xpm({type:z,selectors:[["ng-component"]],decls:1,vars:0,template:function(S,J){1&S&&d._UZ(0,"router-outlet")},directives:[ae],encapsulation:2}),z})();function Oe(z,O=""){for(let S=0;S<z.length;S++){const J=z[S];hn(J,ti(O,J))}}function hn(z,O){z.children&&Oe(z.children,O)}function ti(z,O){return O?z||O.path?z&&!O.path?`${z}/`:!z&&O.path?O.path:`${z}/${O.path}`:"":z}function Ir(z){const O=z.children&&z.children.map(Ir),S=O?{...z,children:O}:{...z};return!S.component&&(O||S.loadChildren)&&S.outlet&&S.outlet!==ie&&(S.component=Q),S}function xr(z){return z.outlet||ie}function Wo(z,O){const S=z.filter(J=>xr(J)===O);return S.push(...z.filter(J=>xr(J)!==O)),S}const Ao={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function zs(z,O,S){if(""===O.path)return"full"===O.pathMatch&&(z.hasChildren()||S.length>0)?{...Ao}:{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const ce=(O.matcher||mt)(S,z,O);if(!ce)return{...Ao};const Me={};Ln(ce.posParams,(bt,xn)=>{Me[xn]=bt.path});const lt=ce.consumed.length>0?{...Me,...ce.consumed[ce.consumed.length-1].parameters}:Me;return{matched:!0,consumedSegments:ce.consumed,lastChild:ce.consumed.length,parameters:lt,positionalParamSegments:ce.posParams??{}}}function As(z,O,S,J,ce="corrected"){if(S.length>0&&function Aa(z,O,S){return S.some(J=>pa(z,O,J)&&xr(J)!==ie)}(z,S,J)){const lt=new oi(O,function nl(z,O,S,J){const ce={};ce[ie]=J,J._sourceSegment=z,J._segmentIndexShift=O.length;for(const Me of S)if(""===Me.path&&xr(Me)!==ie){const lt=new oi([],{});lt._sourceSegment=z,lt._segmentIndexShift=O.length,ce[xr(Me)]=lt}return ce}(z,O,J,new oi(S,z.children)));return lt._sourceSegment=z,lt._segmentIndexShift=O.length,{segmentGroup:lt,slicedSegments:[]}}if(0===S.length&&function br(z,O,S){return S.some(J=>pa(z,O,J))}(z,S,J)){const lt=new oi(z.segments,function Si(z,O,S,J,ce,Me){const lt={};for(const bt of J)if(pa(z,S,bt)&&!ce[xr(bt)]){const xn=new oi([],{});xn._sourceSegment=z,xn._segmentIndexShift="legacy"===Me?z.segments.length:O.length,lt[xr(bt)]=xn}return{...ce,...lt}}(z,O,S,J,z.children,ce));return lt._sourceSegment=z,lt._segmentIndexShift=O.length,{segmentGroup:lt,slicedSegments:S}}const Me=new oi(z.segments,z.children);return Me._sourceSegment=z,Me._segmentIndexShift=O.length,{segmentGroup:Me,slicedSegments:S}}function pa(z,O,S){return(!(z.hasChildren()||O.length>0)||"full"!==S.pathMatch)&&""===S.path}function Cl(z,O,S,J){return!!(xr(z)===J||J!==ie&&pa(O,S,z))&&("**"===z.path||zs(O,z,S).matched)}function ea(z,O,S){return 0===O.length&&!z.children[S]}class ta{constructor(O){this.segmentGroup=O||null}}class Sn{constructor(O){this.urlTree=O}}function lr(z){return new ue.y(O=>O.error(new ta(z)))}function Jl(z){return new ue.y(O=>O.error(new Sn(z)))}function Co(z){return new ue.y(O=>O.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${z}'`)))}class is{constructor(O,S,J,ce,Me){this.configLoader=S,this.urlSerializer=J,this.urlTree=ce,this.config=Me,this.allowRedirects=!0,this.ngModule=O.get(d.h0i)}apply(){const O=As(this.urlTree.root,[],[],this.config).segmentGroup,S=new oi(O.segments,O.children);return this.expandSegmentGroup(this.ngModule,this.config,S,ie).pipe((0,te.U)(Me=>this.createUrlTree(ma(Me),this.urlTree.queryParams,this.urlTree.fragment))).pipe(At(Me=>{if(Me instanceof Sn)return this.allowRedirects=!1,this.match(Me.urlTree);throw Me instanceof ta?this.noMatchError(Me):Me}))}match(O){return this.expandSegmentGroup(this.ngModule,this.config,O.root,ie).pipe((0,te.U)(ce=>this.createUrlTree(ma(ce),O.queryParams,O.fragment))).pipe(At(ce=>{throw ce instanceof ta?this.noMatchError(ce):ce}))}noMatchError(O){return new Error(`Cannot match any routes. URL Segment: '${O.segmentGroup}'`)}createUrlTree(O,S,J){const ce=O.segments.length>0?new oi([],{[ie]:O}):O;return new cr(ce,S,J)}expandSegmentGroup(O,S,J,ce){return 0===J.segments.length&&J.hasChildren()?this.expandChildren(O,S,J).pipe((0,te.U)(Me=>new oi([],Me))):this.expandSegment(O,J,S,J.segments,ce,!0)}expandChildren(O,S,J){const ce=[];for(const Me of Object.keys(J.children))"primary"===Me?ce.unshift(Me):ce.push(Me);return(0,nt.D)(ce).pipe((0,ut.b)(Me=>{const lt=J.children[Me],bt=Wo(S,Me);return this.expandSegmentGroup(O,bt,lt,Me).pipe((0,te.U)(xn=>({segment:xn,outlet:Me})))}),yt((Me,lt)=>(Me[lt.outlet]=lt.segment,Me),{}),function fn(z,O){const S=arguments.length>=2;return J=>J.pipe(z?(0,St.h)((ce,Me)=>z(ce,Me,J)):On.y,zt(1),S?Gt(O):Kt(()=>new je))}())}expandSegment(O,S,J,ce,Me,lt){return(0,nt.D)(J).pipe((0,ut.b)(bt=>this.expandSegmentAgainstRoute(O,S,J,bt,ce,Me,lt).pipe(At(pi=>{if(pi instanceof ta)return(0,Fe.of)(null);throw pi}))),ei(bt=>!!bt),At((bt,xn)=>{if(bt instanceof je||"EmptyError"===bt.name){if(ea(S,ce,Me))return(0,Fe.of)(new oi([],{}));throw new ta(S)}throw bt}))}expandSegmentAgainstRoute(O,S,J,ce,Me,lt,bt){return Cl(ce,S,Me,lt)?void 0===ce.redirectTo?this.matchSegmentAgainstRoute(O,S,ce,Me,lt):bt&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(O,S,J,ce,Me,lt):lr(S):lr(S)}expandSegmentAgainstRouteUsingRedirect(O,S,J,ce,Me,lt){return"**"===ce.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(O,J,ce,lt):this.expandRegularSegmentAgainstRouteUsingRedirect(O,S,J,ce,Me,lt)}expandWildCardWithParamsAgainstRouteUsingRedirect(O,S,J,ce){const Me=this.applyRedirectCommands([],J.redirectTo,{});return J.redirectTo.startsWith("/")?Jl(Me):this.lineralizeSegments(J,Me).pipe((0,Pe.zg)(lt=>{const bt=new oi(lt,{});return this.expandSegment(O,bt,S,lt,ce,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(O,S,J,ce,Me,lt){const{matched:bt,consumedSegments:xn,lastChild:pi,positionalParamSegments:zr}=zs(S,ce,Me);if(!bt)return lr(S);const Ri=this.applyRedirectCommands(xn,ce.redirectTo,zr);return ce.redirectTo.startsWith("/")?Jl(Ri):this.lineralizeSegments(ce,Ri).pipe((0,Pe.zg)(oo=>this.expandSegment(O,S,J,oo.concat(Me.slice(pi)),lt,!1)))}matchSegmentAgainstRoute(O,S,J,ce,Me){if("**"===J.path)return J.loadChildren?(J._loadedConfig?(0,Fe.of)(J._loadedConfig):this.configLoader.load(O.injector,J)).pipe((0,te.U)(oo=>(J._loadedConfig=oo,new oi(ce,{})))):(0,Fe.of)(new oi(ce,{}));const{matched:lt,consumedSegments:bt,lastChild:xn}=zs(S,J,ce);if(!lt)return lr(S);const pi=ce.slice(xn);return this.getChildConfig(O,J,ce).pipe((0,Pe.zg)(Ri=>{const oo=Ri.module,Ur=Ri.routes,{segmentGroup:Mr,slicedSegments:bo}=As(S,bt,pi,Ur),us=new oi(Mr.segments,Mr.children);if(0===bo.length&&us.hasChildren())return this.expandChildren(oo,Ur,us).pipe((0,te.U)(Pl=>new oi(bt,Pl)));if(0===Ur.length&&0===bo.length)return(0,Fe.of)(new oi(bt,{}));const Ts=xr(J)===Me;return this.expandSegment(oo,us,Ur,bo,Ts?ie:Me,!0).pipe((0,te.U)(Kn=>new oi(bt.concat(Kn.segments),Kn.children)))}))}getChildConfig(O,S,J){return S.children?(0,Fe.of)(new we(S.children,O)):S.loadChildren?void 0!==S._loadedConfig?(0,Fe.of)(S._loadedConfig):this.runCanLoadGuards(O.injector,S,J).pipe((0,Pe.zg)(ce=>ce?this.configLoader.load(O.injector,S).pipe((0,te.U)(Me=>(S._loadedConfig=Me,Me))):function il(z){return new ue.y(O=>O.error(Te(`Cannot load children because the guard of the route "path: '${z.path}'" returned false`)))}(S))):(0,Fe.of)(new we([],O))}runCanLoadGuards(O,S,J){const ce=S.canLoad;if(!ce||0===ce.length)return(0,Fe.of)(!0);const Me=ce.map(lt=>{const bt=O.get(lt);let xn;if(function an(z){return z&&se(z.canLoad)}(bt))xn=bt.canLoad(S,J);else{if(!se(bt))throw new Error("Invalid CanLoad guard");xn=bt(S,J)}return qn(xn)});return(0,Fe.of)(Me).pipe(Oi(),zi(lt=>{if(!Mt(lt))return;const bt=Te(`Redirecting to "${this.urlSerializer.serialize(lt)}"`);throw bt.url=lt,bt}),(0,te.U)(lt=>!0===lt))}lineralizeSegments(O,S){let J=[],ce=S.root;for(;;){if(J=J.concat(ce.segments),0===ce.numberOfChildren)return(0,Fe.of)(J);if(ce.numberOfChildren>1||!ce.children[ie])return Co(O.redirectTo);ce=ce.children[ie]}}applyRedirectCommands(O,S,J){return this.applyRedirectCreatreUrlTree(S,this.urlSerializer.parse(S),O,J)}applyRedirectCreatreUrlTree(O,S,J,ce){const Me=this.createSegmentGroup(O,S.root,J,ce);return new cr(Me,this.createQueryParams(S.queryParams,this.urlTree.queryParams),S.fragment)}createQueryParams(O,S){const J={};return Ln(O,(ce,Me)=>{if("string"==typeof ce&&ce.startsWith(":")){const bt=ce.substring(1);J[Me]=S[bt]}else J[Me]=ce}),J}createSegmentGroup(O,S,J,ce){const Me=this.createSegments(O,S.segments,J,ce);let lt={};return Ln(S.children,(bt,xn)=>{lt[xn]=this.createSegmentGroup(O,bt,J,ce)}),new oi(Me,lt)}createSegments(O,S,J,ce){return S.map(Me=>Me.path.startsWith(":")?this.findPosParam(O,Me,ce):this.findOrReturn(Me,J))}findPosParam(O,S,J){const ce=J[S.path.substring(1)];if(!ce)throw new Error(`Cannot redirect to '${O}'. Cannot find '${S.path}'.`);return ce}findOrReturn(O,S){let J=0;for(const ce of S){if(ce.path===O.path)return S.splice(J),ce;J++}return O}}function ma(z){const O={};for(const J of Object.keys(z.children)){const Me=ma(z.children[J]);(Me.segments.length>0||Me.hasChildren())&&(O[J]=Me)}return function fa(z){if(1===z.numberOfChildren&&z.children[ie]){const O=z.children[ie];return new oi(z.segments.concat(O.segments),O.children)}return z}(new oi(z.segments,O))}class Y{constructor(O){this.path=O,this.route=this.path[this.path.length-1]}}class E{constructor(O,S){this.component=O,this.route=S}}function H(z,O,S){const J=z._root;return Vn(J,O?O._root:null,S,[J.value])}function vt(z,O,S){const J=function In(z){if(!z)return null;for(let O=z.parent;O;O=O.parent){const S=O.routeConfig;if(S&&S._loadedConfig)return S._loadedConfig}return null}(O);return(J?J.module.injector:S).get(z)}function Vn(z,O,S,J,ce={canDeactivateChecks:[],canActivateChecks:[]}){const Me=vo(O);return z.children.forEach(lt=>{(function wi(z,O,S,J,ce={canDeactivateChecks:[],canActivateChecks:[]}){const Me=z.value,lt=O?O.value:null,bt=S?S.getContext(z.value.outlet):null;if(lt&&Me.routeConfig===lt.routeConfig){const xn=function ui(z,O,S){if("function"==typeof S)return S(z,O);switch(S){case"pathParamsChange":return!Nr(z.url,O.url);case"pathParamsOrQueryParamsChange":return!Nr(z.url,O.url)||!Xe(z.queryParams,O.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!hi(z,O)||!Xe(z.queryParams,O.queryParams);default:return!hi(z,O)}}(lt,Me,Me.routeConfig.runGuardsAndResolvers);xn?ce.canActivateChecks.push(new Y(J)):(Me.data=lt.data,Me._resolvedData=lt._resolvedData),Vn(z,O,Me.component?bt?bt.children:null:S,J,ce),xn&&bt&&bt.outlet&&bt.outlet.isActivated&&ce.canDeactivateChecks.push(new E(bt.outlet.component,lt))}else lt&&er(O,bt,ce),ce.canActivateChecks.push(new Y(J)),Vn(z,null,Me.component?bt?bt.children:null:S,J,ce)})(lt,Me[lt.value.outlet],S,J.concat([lt.value]),ce),delete Me[lt.value.outlet]}),Ln(Me,(lt,bt)=>er(lt,S.getContext(bt),ce)),ce}function er(z,O,S){const J=vo(z),ce=z.value;Ln(J,(Me,lt)=>{er(Me,ce.component?O?O.children.getContext(lt):null:O,S)}),S.canDeactivateChecks.push(new E(ce.component&&O&&O.outlet&&O.outlet.isActivated?O.outlet.component:null,ce))}class rl{}function El(z){return new ue.y(O=>O.error(z))}class Xl{constructor(O,S,J,ce,Me,lt){this.rootComponentType=O,this.config=S,this.urlTree=J,this.url=ce,this.paramsInheritanceStrategy=Me,this.relativeLinkResolution=lt}recognize(){const O=As(this.urlTree.root,[],[],this.config.filter(lt=>void 0===lt.redirectTo),this.relativeLinkResolution).segmentGroup,S=this.processSegmentGroup(this.config,O,ie);if(null===S)return null;const J=new Ke([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},ie,this.rootComponentType,null,this.urlTree.root,-1,{}),ce=new nr(J,S),Me=new Se(this.url,ce);return this.inheritParamsAndData(Me._root),Me}inheritParamsAndData(O){const S=O.value,J=Oo(S,this.paramsInheritanceStrategy);S.params=Object.freeze(J.params),S.data=Object.freeze(J.data),O.children.forEach(ce=>this.inheritParamsAndData(ce))}processSegmentGroup(O,S,J){return 0===S.segments.length&&S.hasChildren()?this.processChildren(O,S):this.processSegment(O,S,S.segments,J)}processChildren(O,S){const J=[];for(const Me of Object.keys(S.children)){const lt=S.children[Me],bt=Wo(O,Me),xn=this.processSegmentGroup(bt,lt,Me);if(null===xn)return null;J.push(...xn)}const ce=ws(J);return function wc(z){z.sort((O,S)=>O.value.outlet===ie?-1:S.value.outlet===ie?1:O.value.outlet.localeCompare(S.value.outlet))}(ce),ce}processSegment(O,S,J,ce){for(const Me of O){const lt=this.processSegmentAgainstRoute(Me,S,J,ce);if(null!==lt)return lt}return ea(S,J,ce)?[]:null}processSegmentAgainstRoute(O,S,J,ce){if(O.redirectTo||!Cl(O,S,J,ce))return null;let Me,lt=[],bt=[];if("**"===O.path){const Ur=J.length>0?rn(J).parameters:{};Me=new Ke(J,Ur,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,na(O),xr(O),O.component,O,Ss(S),to(S)+J.length,Tc(O))}else{const Ur=zs(S,O,J);if(!Ur.matched)return null;lt=Ur.consumedSegments,bt=J.slice(Ur.lastChild),Me=new Ke(lt,Ur.parameters,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,na(O),xr(O),O.component,O,Ss(S),to(S)+lt.length,Tc(O))}const xn=function Sa(z){return z.children?z.children:z.loadChildren?z._loadedConfig.routes:[]}(O),{segmentGroup:pi,slicedSegments:zr}=As(S,lt,bt,xn.filter(Ur=>void 0===Ur.redirectTo),this.relativeLinkResolution);if(0===zr.length&&pi.hasChildren()){const Ur=this.processChildren(xn,pi);return null===Ur?null:[new nr(Me,Ur)]}if(0===xn.length&&0===zr.length)return[new nr(Me,[])];const Ri=xr(O)===ce,oo=this.processSegment(xn,pi,zr,Ri?ie:ce);return null===oo?null:[new nr(Me,oo)]}}function Kl(z){const O=z.value.routeConfig;return O&&""===O.path&&void 0===O.redirectTo}function ws(z){const O=[],S=new Set;for(const J of z){if(!Kl(J)){O.push(J);continue}const ce=O.find(Me=>J.value.routeConfig===Me.value.routeConfig);void 0!==ce?(ce.children.push(...J.children),S.add(ce)):O.push(J)}for(const J of S){const ce=ws(J.children);O.push(new nr(J.value,ce))}return O.filter(J=>!S.has(J))}function Ss(z){let O=z;for(;O._sourceSegment;)O=O._sourceSegment;return O}function to(z){let O=z,S=O._segmentIndexShift?O._segmentIndexShift:0;for(;O._sourceSegment;)O=O._sourceSegment,S+=O._segmentIndexShift?O._segmentIndexShift:0;return S-1}function na(z){return z.data||{}}function Tc(z){return z.resolve||{}}function pr(z){return[...Object.keys(z),...Object.getOwnPropertySymbols(z)]}function ra(z){return(0,Ae.w)(O=>{const S=z(O);return S?(0,nt.D)(S).pipe((0,te.U)(()=>O)):(0,Fe.of)(O)})}class _a{}class Ql extends class ko{shouldDetach(O){return!1}store(O,S){}shouldAttach(O){return!1}retrieve(O){return null}shouldReuseRoute(O,S){return O.routeConfig===S.routeConfig}}{}const Vs=new d.OlP("ROUTES");class Oa{constructor(O,S,J,ce){this.injector=O,this.compiler=S,this.onLoadStartListener=J,this.onLoadEndListener=ce}load(O,S){if(S._loader$)return S._loader$;this.onLoadStartListener&&this.onLoadStartListener(S);const ce=this.loadModuleFactory(S.loadChildren).pipe((0,te.U)(Me=>{this.onLoadEndListener&&this.onLoadEndListener(S);const lt=Me.create(O);return new we(tn(lt.injector.get(Vs,void 0,d.XFs.Self|d.XFs.Optional)).map(Ir),lt)}),At(Me=>{throw S._loader$=void 0,Me}));return S._loader$=new _t.c(ce,()=>new Ge.xQ).pipe((0,Nt.x)()),S._loader$}loadModuleFactory(O){return qn(O()).pipe((0,Pe.zg)(S=>S instanceof d.YKP?(0,Fe.of)(S):(0,nt.D)(this.compiler.compileModuleAsync(S))))}}class Ec{shouldProcessUrl(O){return!0}extract(O){return O}merge(O,S){return O}}function $s(z){throw z}function Ra(z,O,S){return O.parse("/")}function sl(z,O){return(0,Fe.of)(null)}const Dc={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Au={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Fo=(()=>{class z{constructor(S,J,ce,Me,lt,bt,xn){this.rootComponentType=S,this.urlSerializer=J,this.rootContexts=ce,this.location=Me,this.config=xn,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Ge.xQ,this.errorHandler=$s,this.malformedUriErrorHandler=Ra,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:sl,afterPreactivation:sl},this.urlHandlingStrategy=new Ec,this.routeReuseStrategy=new Ql,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=lt.get(d.h0i),this.console=lt.get(d.c2e);const Ri=lt.get(d.R0b);this.isNgZoneEnabled=Ri instanceof d.R0b&&d.R0b.isInAngularZone(),this.resetConfig(xn),this.currentUrlTree=function ni(){return new cr(new oi([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Oa(lt,bt,oo=>this.triggerEvent(new gr(oo)),oo=>this.triggerEvent(new Pi(oo))),this.routerState=Zn(this.currentUrlTree,this.rootComponentType),this.transitions=new ke.X({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(S){const J=this.events;return S.pipe((0,St.h)(ce=>0!==ce.id),(0,te.U)(ce=>({...ce,extractedUrl:this.urlHandlingStrategy.extract(ce.rawUrl)})),(0,Ae.w)(ce=>{let Me=!1,lt=!1;return(0,Fe.of)(ce).pipe(zi(bt=>{this.currentNavigation={id:bt.id,initialUrl:bt.currentRawUrl,extractedUrl:bt.extractedUrl,trigger:bt.source,extras:bt.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,Ae.w)(bt=>{const xn=this.browserUrlTree.toString(),pi=!this.navigated||bt.extractedUrl.toString()!==xn||xn!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||pi)&&this.urlHandlingStrategy.shouldProcessUrl(bt.rawUrl))return Jo(bt.source)&&(this.browserUrlTree=bt.extractedUrl),(0,Fe.of)(bt).pipe((0,Ae.w)(Ri=>{const oo=this.transitions.getValue();return J.next(new Rt(Ri.id,this.serializeUrl(Ri.extractedUrl),Ri.source,Ri.restoredState)),oo!==this.transitions.getValue()?Re.E:Promise.resolve(Ri)}),function D(z,O,S,J){return(0,Ae.w)(ce=>function Us(z,O,S,J,ce){return new is(z,O,S,J,ce).apply()}(z,O,S,ce.extractedUrl,J).pipe((0,te.U)(Me=>({...ce,urlAfterRedirects:Me}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),zi(Ri=>{this.currentNavigation={...this.currentNavigation,finalUrl:Ri.urlAfterRedirects}}),function ia(z,O,S,J,ce){return(0,Pe.zg)(Me=>function bc(z,O,S,J,ce="emptyOnly",Me="legacy"){try{const lt=new Xl(z,O,S,J,ce,Me).recognize();return null===lt?El(new rl):(0,Fe.of)(lt)}catch(lt){return El(lt)}}(z,O,Me.urlAfterRedirects,S(Me.urlAfterRedirects),J,ce).pipe((0,te.U)(lt=>({...Me,targetSnapshot:lt}))))}(this.rootComponentType,this.config,Ri=>this.serializeUrl(Ri),this.paramsInheritanceStrategy,this.relativeLinkResolution),zi(Ri=>{if("eager"===this.urlUpdateStrategy){if(!Ri.extras.skipLocationChange){const Ur=this.urlHandlingStrategy.merge(Ri.urlAfterRedirects,Ri.rawUrl);this.setBrowserUrl(Ur,Ri)}this.browserUrlTree=Ri.urlAfterRedirects}const oo=new Di(Ri.id,this.serializeUrl(Ri.extractedUrl),this.serializeUrl(Ri.urlAfterRedirects),Ri.targetSnapshot);J.next(oo)}));if(pi&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:oo,extractedUrl:Ur,source:Mr,restoredState:bo,extras:us}=bt,Ts=new Rt(oo,this.serializeUrl(Ur),Mr,bo);J.next(Ts);const za=Zn(Ur,this.rootComponentType).snapshot;return(0,Fe.of)({...bt,targetSnapshot:za,urlAfterRedirects:Ur,extras:{...us,skipLocationChange:!1,replaceUrl:!1}})}return this.rawUrlTree=bt.rawUrl,bt.resolve(null),Re.E}),ra(bt=>{const{targetSnapshot:xn,id:pi,extractedUrl:zr,rawUrl:Ri,extras:{skipLocationChange:oo,replaceUrl:Ur}}=bt;return this.hooks.beforePreactivation(xn,{navigationId:pi,appliedUrlTree:zr,rawUrlTree:Ri,skipLocationChange:!!oo,replaceUrl:!!Ur})}),zi(bt=>{const xn=new gi(bt.id,this.serializeUrl(bt.extractedUrl),this.serializeUrl(bt.urlAfterRedirects),bt.targetSnapshot);this.triggerEvent(xn)}),(0,te.U)(bt=>({...bt,guards:H(bt.targetSnapshot,bt.currentSnapshot,this.rootContexts)})),function hr(z,O){return(0,Pe.zg)(S=>{const{targetSnapshot:J,currentSnapshot:ce,guards:{canActivateChecks:Me,canDeactivateChecks:lt}}=S;return 0===lt.length&&0===Me.length?(0,Fe.of)({...S,guardsResult:!0}):function Or(z,O,S,J){return(0,nt.D)(z).pipe((0,Pe.zg)(ce=>function xc(z,O,S,J,ce){const Me=O&&O.routeConfig?O.routeConfig.canDeactivate:null;if(!Me||0===Me.length)return(0,Fe.of)(!0);const lt=Me.map(bt=>{const xn=vt(bt,O,ce);let pi;if(function yr(z){return z&&se(z.canDeactivate)}(xn))pi=qn(xn.canDeactivate(z,O,S,J));else{if(!se(xn))throw new Error("Invalid CanDeactivate guard");pi=qn(xn(z,O,S,J))}return pi.pipe(ei())});return(0,Fe.of)(lt).pipe(Oi())}(ce.component,ce.route,S,O,J)),ei(ce=>!0!==ce,!0))}(lt,J,ce,z).pipe((0,Pe.zg)(bt=>bt&&function Le(z){return"boolean"==typeof z}(bt)?function eo(z,O,S,J){return(0,nt.D)(O).pipe((0,ut.b)(ce=>(0,Ne.z)(function rs(z,O){return null!==z&&O&&O(new Br(z)),(0,Fe.of)(!0)}(ce.route.parent,J),function Lo(z,O){return null!==z&&O&&O(new Rr(z)),(0,Fe.of)(!0)}(ce.route,J),function Zs(z,O,S){const J=O[O.length-1],Me=O.slice(0,O.length-1).reverse().map(lt=>function ve(z){const O=z.routeConfig?z.routeConfig.canActivateChild:null;return O&&0!==O.length?{node:z,guards:O}:null}(lt)).filter(lt=>null!==lt).map(lt=>(0,$e.P)(()=>{const bt=lt.guards.map(xn=>{const pi=vt(xn,lt.node,S);let zr;if(function Wn(z){return z&&se(z.canActivateChild)}(pi))zr=qn(pi.canActivateChild(J,z));else{if(!se(pi))throw new Error("Invalid CanActivateChild guard");zr=qn(pi(J,z))}return zr.pipe(ei())});return(0,Fe.of)(bt).pipe(Oi())}));return(0,Fe.of)(Me).pipe(Oi())}(z,ce.path,S),function ga(z,O,S){const J=O.routeConfig?O.routeConfig.canActivate:null;if(!J||0===J.length)return(0,Fe.of)(!0);const ce=J.map(Me=>(0,$e.P)(()=>{const lt=vt(Me,O,S);let bt;if(function Bn(z){return z&&se(z.canActivate)}(lt))bt=qn(lt.canActivate(O,z));else{if(!se(lt))throw new Error("Invalid CanActivate guard");bt=qn(lt(O,z))}return bt.pipe(ei())}));return(0,Fe.of)(ce).pipe(Oi())}(z,ce.route,S))),ei(ce=>!0!==ce,!0))}(J,Me,z,O):(0,Fe.of)(bt)),(0,te.U)(bt=>({...S,guardsResult:bt})))})}(this.ngModule.injector,bt=>this.triggerEvent(bt)),zi(bt=>{if(Mt(bt.guardsResult)){const pi=Te(`Redirecting to "${this.serializeUrl(bt.guardsResult)}"`);throw pi.url=bt.guardsResult,pi}const xn=new fi(bt.id,this.serializeUrl(bt.extractedUrl),this.serializeUrl(bt.urlAfterRedirects),bt.targetSnapshot,!!bt.guardsResult);this.triggerEvent(xn)}),(0,St.h)(bt=>!!bt.guardsResult||(this.restoreHistory(bt),this.cancelNavigationTransition(bt,""),!1)),ra(bt=>{if(bt.guards.canActivateChecks.length)return(0,Fe.of)(bt).pipe(zi(xn=>{const pi=new Cr(xn.id,this.serializeUrl(xn.extractedUrl),this.serializeUrl(xn.urlAfterRedirects),xn.targetSnapshot);this.triggerEvent(pi)}),(0,Ae.w)(xn=>{let pi=!1;return(0,Fe.of)(xn).pipe(function ol(z,O){return(0,Pe.zg)(S=>{const{targetSnapshot:J,guards:{canActivateChecks:ce}}=S;if(!ce.length)return(0,Fe.of)(S);let Me=0;return(0,nt.D)(ce).pipe((0,ut.b)(lt=>function Yc(z,O,S,J){return function Cc(z,O,S,J){const ce=pr(z);if(0===ce.length)return(0,Fe.of)({});const Me={};return(0,nt.D)(ce).pipe((0,Pe.zg)(lt=>function Pa(z,O,S,J){const ce=vt(z,O,J);return qn(ce.resolve?ce.resolve(O,S):ce(O,S))}(z[lt],O,S,J).pipe(zi(bt=>{Me[lt]=bt}))),zt(1),(0,Pe.zg)(()=>pr(Me).length===ce.length?(0,Fe.of)(Me):Re.E))}(z._resolve,z,O,J).pipe((0,te.U)(Me=>(z._resolvedData=Me,z.data={...z.data,...Oo(z,S).resolve},null)))}(lt.route,J,z,O)),zi(()=>Me++),zt(1),(0,Pe.zg)(lt=>Me===ce.length?(0,Fe.of)(S):Re.E))})}(this.paramsInheritanceStrategy,this.ngModule.injector),zi({next:()=>pi=!0,complete:()=>{pi||(this.restoreHistory(xn),this.cancelNavigationTransition(xn,"At least one route resolver didn't emit any value."))}}))}),zi(xn=>{const pi=new Vi(xn.id,this.serializeUrl(xn.extractedUrl),this.serializeUrl(xn.urlAfterRedirects),xn.targetSnapshot);this.triggerEvent(pi)}))}),ra(bt=>{const{targetSnapshot:xn,id:pi,extractedUrl:zr,rawUrl:Ri,extras:{skipLocationChange:oo,replaceUrl:Ur}}=bt;return this.hooks.afterPreactivation(xn,{navigationId:pi,appliedUrlTree:zr,rawUrlTree:Ri,skipLocationChange:!!oo,replaceUrl:!!Ur})}),(0,te.U)(bt=>{const xn=function io(z,O,S){const J=ar(z,O._root,S?S._root:void 0);return new _o(J,O)}(this.routeReuseStrategy,bt.targetSnapshot,bt.currentRouterState);return{...bt,targetRouterState:xn}}),zi(bt=>{this.currentUrlTree=bt.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(bt.urlAfterRedirects,bt.rawUrl),this.routerState=bt.targetRouterState,"deferred"===this.urlUpdateStrategy&&(bt.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,bt),this.browserUrlTree=bt.urlAfterRedirects)}),((z,O,S)=>(0,te.U)(J=>(new Qs(O,J.targetRouterState,J.currentRouterState,S).activate(z),J)))(this.rootContexts,this.routeReuseStrategy,bt=>this.triggerEvent(bt)),zi({next(){Me=!0},complete(){Me=!0}}),function xi(z){return O=>O.lift(new Qt(z))}(()=>{Me||lt||this.cancelNavigationTransition(ce,`Navigation ID ${ce.id} is not equal to the current navigation id ${this.navigationId}`),this.currentNavigation?.id===ce.id&&(this.currentNavigation=null)}),At(bt=>{if(lt=!0,function We(z){return z&&z[he]}(bt)){const xn=Mt(bt.url);xn||(this.navigated=!0,this.restoreHistory(ce,!0));const pi=new Xn(ce.id,this.serializeUrl(ce.extractedUrl),bt.message);J.next(pi),xn?setTimeout(()=>{const zr=this.urlHandlingStrategy.merge(bt.url,this.rawUrlTree),Ri={skipLocationChange:ce.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Jo(ce.source)};this.scheduleNavigation(zr,"imperative",null,Ri,{resolve:ce.resolve,reject:ce.reject,promise:ce.promise})},0):ce.resolve(!1)}else{this.restoreHistory(ce,!0);const xn=new Ki(ce.id,this.serializeUrl(ce.extractedUrl),bt);J.next(xn);try{ce.resolve(this.errorHandler(bt))}catch(pi){ce.reject(pi)}}return Re.E}))}))}resetRootComponentType(S){this.rootComponentType=S,this.routerState.root.component=this.rootComponentType}setTransition(S){this.transitions.next({...this.transitions.value,...S})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(S=>{const J="popstate"===S.type?"popstate":"hashchange";"popstate"===J&&setTimeout(()=>{const ce={replaceUrl:!0},Me=S.state?.navigationId?S.state:null;if(Me){const bt={...Me};delete bt.navigationId,delete bt.\u0275routerPageId,0!==Object.keys(bt).length&&(ce.state=bt)}const lt=this.parseUrl(S.url);this.scheduleNavigation(lt,J,Me,ce)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(S){this.events.next(S)}resetConfig(S){Oe(S),this.config=S.map(Ir),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(S,J={}){const{relativeTo:ce,queryParams:Me,fragment:lt,queryParamsHandling:bt,preserveFragment:xn}=J,pi=ce||this.routerState.root,zr=xn?this.currentUrlTree.fragment:lt;let Ri=null;switch(bt){case"merge":Ri={...this.currentUrlTree.queryParams,...Me};break;case"preserve":Ri=this.currentUrlTree.queryParams;break;default:Ri=Me||null}return null!==Ri&&(Ri=this.removeEmptyProps(Ri)),function cs(z,O,S,J,ce){if(0===S.length)return ks(O.root,O.root,O,J,ce);const Me=function ro(z){if("string"==typeof z[0]&&1===z.length&&"/"===z[0])return new Ni(!0,0,z);let O=0,S=!1;const J=z.reduce((ce,Me,lt)=>{if("object"==typeof Me&&null!=Me){if(Me.outlets){const bt={};return Ln(Me.outlets,(xn,pi)=>{bt[pi]="string"==typeof xn?xn.split("/"):xn}),[...ce,{outlets:bt}]}if(Me.segmentPath)return[...ce,Me.segmentPath]}return"string"!=typeof Me?[...ce,Me]:0===lt?(Me.split("/").forEach((bt,xn)=>{0==xn&&"."===bt||(0==xn&&""===bt?S=!0:".."===bt?O++:""!=bt&&ce.push(bt))}),ce):[...ce,Me]},[]);return new Ni(S,O,J)}(S);if(Me.toRoot())return ks(O.root,new oi([],{}),O,J,ce);const lt=function bs(z,O,S){if(z.isAbsolute)return new Vo(O.root,!0,0);if(-1===S.snapshot._lastPathIndex){const Me=S.snapshot._urlSegment;return new Vo(Me,Me===O.root,0)}const J=Io(z.commands[0])?0:1;return function Wr(z,O,S){let J=z,ce=O,Me=S;for(;Me>ce;){if(Me-=ce,J=J.parent,!J)throw new Error("Invalid number of '../'");ce=J.segments.length}return new Vo(J,!1,ce-Me)}(S.snapshot._urlSegment,S.snapshot._lastPathIndex+J,z.numberOfDoubleDots)}(Me,O,z),bt=lt.processChildren?Qr(lt.segmentGroup,lt.index,Me.commands):$o(lt.segmentGroup,lt.index,Me.commands);return ks(lt.segmentGroup,bt,O,J,ce)}(pi,this.currentUrlTree,S,Ri,zr??null)}navigateByUrl(S,J={skipLocationChange:!1}){const ce=Mt(S)?S:this.parseUrl(S),Me=this.urlHandlingStrategy.merge(ce,this.rawUrlTree);return this.scheduleNavigation(Me,"imperative",null,J)}navigate(S,J={skipLocationChange:!1}){return function La(z){for(let O=0;O<z.length;O++){const S=z[O];if(null==S)throw new Error(`The requested path contains ${S} segment at index ${O}`)}}(S),this.navigateByUrl(this.createUrlTree(S,J),J)}serializeUrl(S){return this.urlSerializer.serialize(S)}parseUrl(S){let J;try{J=this.urlSerializer.parse(S)}catch(ce){J=this.malformedUriErrorHandler(ce,this.urlSerializer,S)}return J}isActive(S,J){let ce;if(ce=!0===J?{...Dc}:!1===J?{...Au}:J,Mt(S))return Ui(this.currentUrlTree,S,ce);const Me=this.parseUrl(S);return Ui(this.currentUrlTree,Me,ce)}removeEmptyProps(S){return Object.keys(S).reduce((J,ce)=>{const Me=S[ce];return null!=Me&&(J[ce]=Me),J},{})}processNavigations(){this.navigations.subscribe(S=>{this.navigated=!0,this.lastSuccessfulId=S.id,this.currentPageId=S.targetPageId,this.events.next(new Xt(S.id,this.serializeUrl(S.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,S.resolve(!0)},S=>{this.console.warn(`Unhandled Navigation Error: ${S}`)})}scheduleNavigation(S,J,ce,Me,lt){if(this.disposed)return Promise.resolve(!1);const bt=this.transitions.value,xn=Jo(J)&&bt&&!Jo(bt.source),pi=bt.rawUrl.toString()===S.toString();if(xn&&pi&&bt.id===this.currentNavigation?.id)return Promise.resolve(!0);let oo,Ur,Mr;lt?(oo=lt.resolve,Ur=lt.reject,Mr=lt.promise):Mr=new Promise((Ts,za)=>{oo=Ts,Ur=za});const bo=++this.navigationId;let us;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(ce=this.location.getState()),us=ce&&ce.\u0275routerPageId?ce.\u0275routerPageId:Me.replaceUrl||Me.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):us=0,this.setTransition({id:bo,targetPageId:us,source:J,restoredState:ce,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:S,extras:Me,resolve:oo,reject:Ur,promise:Mr,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Mr.catch(Ts=>Promise.reject(Ts))}setBrowserUrl(S,J){const ce=this.urlSerializer.serialize(S),Me={...J.extras.state,...this.generateNgRouterState(J.id,J.targetPageId)};this.location.isCurrentPathEqualTo(ce)||J.extras.replaceUrl?this.location.replaceState(ce,"",Me):this.location.go(ce,"",Me)}restoreHistory(S,J=!1){if("computed"===this.canceledNavigationResolution){const ce=this.currentPageId-S.targetPageId;"popstate"!==S.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===ce?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===ce&&(this.resetState(S),this.browserUrlTree=S.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(ce)}else"replace"===this.canceledNavigationResolution&&(J&&this.resetState(S),this.resetUrlToCurrentUrlTree())}resetState(S){this.routerState=S.currentRouterState,this.currentUrlTree=S.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,S.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(S,J){const ce=new Xn(S.id,this.serializeUrl(S.extractedUrl),J);this.triggerEvent(ce),S.resolve(!1)}generateNgRouterState(S,J){return"computed"===this.canceledNavigationResolution?{navigationId:S,\u0275routerPageId:J}:{navigationId:S}}}return z.\u0275fac=function(S){d.$Z()},z.\u0275prov=d.Yz7({token:z,factory:z.\u0275fac}),z})();function Jo(z){return"imperative"!==z}let ya=(()=>{class z{constructor(S,J,ce,Me,lt){this.router=S,this.route=J,this.tabIndexAttribute=ce,this.renderer=Me,this.el=lt,this.commands=null,this.onChanges=new Ge.xQ,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(S){if(null!=this.tabIndexAttribute)return;const J=this.renderer,ce=this.el.nativeElement;null!==S?J.setAttribute(ce,"tabindex",S):J.removeAttribute(ce,"tabindex")}ngOnChanges(S){this.onChanges.next(this)}set routerLink(S){null!=S?(this.commands=Array.isArray(S)?S:[S],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const S={skipLocationChange:js(this.skipLocationChange),replaceUrl:js(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,S),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:js(this.preserveFragment)})}}return z.\u0275fac=function(S){return new(S||z)(d.Y36(Fo),d.Y36(Ai),d.$8M("tabindex"),d.Y36(d.Qsj),d.Y36(d.SBq))},z.\u0275dir=d.lG2({type:z,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(S,J){1&S&&d.NdJ("click",function(){return J.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[d.TTD]}),z})();function js(z){return""===z||!!z}class Dl{}class Fa{preload(O,S){return(0,Fe.of)(null)}}let xa=(()=>{class z{constructor(S,J,ce,Me){this.router=S,this.injector=ce,this.preloadingStrategy=Me,this.loader=new Oa(ce,J,xn=>S.triggerEvent(new gr(xn)),xn=>S.triggerEvent(new Pi(xn)))}setUpPreloading(){this.subscription=this.router.events.pipe((0,St.h)(S=>S instanceof Xt),(0,ut.b)(()=>this.preload())).subscribe(()=>{})}preload(){const S=this.injector.get(d.h0i);return this.processRoutes(S,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(S,J){const ce=[];for(const Me of J)if(Me.loadChildren&&!Me.canLoad&&Me._loadedConfig){const lt=Me._loadedConfig;ce.push(this.processRoutes(lt.module,lt.routes))}else Me.loadChildren&&!Me.canLoad?ce.push(this.preloadConfig(S,Me)):Me.children&&ce.push(this.processRoutes(S,Me.children));return(0,nt.D)(ce).pipe((0,me.J)(),(0,te.U)(Me=>{}))}preloadConfig(S,J){return this.preloadingStrategy.preload(J,()=>(J._loadedConfig?(0,Fe.of)(J._loadedConfig):this.loader.load(S.injector,J)).pipe((0,Pe.zg)(Me=>(J._loadedConfig=Me,this.processRoutes(Me.module,Me.routes)))))}}return z.\u0275fac=function(S){return new(S||z)(d.LFG(Fo),d.LFG(d.Sil),d.LFG(d.zs3),d.LFG(Dl))},z.\u0275prov=d.Yz7({token:z,factory:z.\u0275fac}),z})(),Ic=(()=>{class z{constructor(S,J,ce={}){this.router=S,this.viewportScroller=J,this.options=ce,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},ce.scrollPositionRestoration=ce.scrollPositionRestoration||"disabled",ce.anchorScrolling=ce.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(S=>{S instanceof Rt?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=S.navigationTrigger,this.restoredId=S.restoredState?S.restoredState.navigationId:0):S instanceof Xt&&(this.lastId=S.id,this.scheduleScrollEvent(S,this.router.parseUrl(S.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(S=>{S instanceof tr&&(S.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(S.position):S.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(S.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(S,J){this.router.triggerEvent(new tr(S,"popstate"===this.lastSource?this.store[this.restoredId]:null,J))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return z.\u0275fac=function(S){d.$Z()},z.\u0275prov=d.Yz7({token:z,factory:z.\u0275fac}),z})();const ba=new d.OlP("ROUTER_CONFIGURATION"),Jc=new d.OlP("ROUTER_FORROOT_GUARD"),Mc=[u.Ye,{provide:bi,useClass:ao},{provide:Fo,useFactory:function Ac(z,O,S,J,ce,Me,lt={},bt,xn){const pi=new Fo(null,z,O,S,J,ce,tn(Me));return bt&&(pi.urlHandlingStrategy=bt),xn&&(pi.routeReuseStrategy=xn),function ll(z,O){z.errorHandler&&(O.errorHandler=z.errorHandler),z.malformedUriErrorHandler&&(O.malformedUriErrorHandler=z.malformedUriErrorHandler),z.onSameUrlNavigation&&(O.onSameUrlNavigation=z.onSameUrlNavigation),z.paramsInheritanceStrategy&&(O.paramsInheritanceStrategy=z.paramsInheritanceStrategy),z.relativeLinkResolution&&(O.relativeLinkResolution=z.relativeLinkResolution),z.urlUpdateStrategy&&(O.urlUpdateStrategy=z.urlUpdateStrategy),z.canceledNavigationResolution&&(O.canceledNavigationResolution=z.canceledNavigationResolution)}(lt,pi),lt.enableTracing&&pi.events.subscribe(zr=>{console.group?.(`Router Event: ${zr.constructor.name}`),console.log(zr.toString()),console.log(zr),console.groupEnd?.()}),pi},deps:[bi,jr,u.Ye,d.zs3,d.Sil,Vs,ba,[class Mu{},new d.FiY],[_a,new d.FiY]]},jr,{provide:Ai,useFactory:function Sc(z){return z.routerState.root},deps:[Fo]},xa,Fa,class oa{preload(O,S){return S().pipe(At(()=>(0,Fe.of)(null)))}},{provide:ba,useValue:{enableTracing:!1}}];function wa(){return new d.PXZ("Router",Fo)}let Il=(()=>{class z{constructor(S,J){}static forRoot(S,J){return{ngModule:z,providers:[Mc,tc(S),{provide:Jc,useFactory:Ba,deps:[[Fo,new d.FiY,new d.tp0]]},{provide:ba,useValue:J||{}},{provide:u.S$,useFactory:Ml,deps:[u.lw,[new d.tBr(u.mr),new d.FiY],ba]},{provide:Ic,useFactory:ec,deps:[Fo,u.EM,ba]},{provide:Dl,useExisting:J&&J.preloadingStrategy?J.preloadingStrategy:Fa},{provide:d.PXZ,multi:!0,useFactory:wa},[Al,{provide:d.ip1,multi:!0,useFactory:Sl,deps:[Al]},{provide:Na,useFactory:cl,deps:[Al]},{provide:d.tb,multi:!0,useExisting:Na}]]}}static forChild(S){return{ngModule:z,providers:[tc(S)]}}}return z.\u0275fac=function(S){return new(S||z)(d.LFG(Jc,8),d.LFG(Fo,8))},z.\u0275mod=d.oAB({type:z}),z.\u0275inj=d.cJS({}),z})();function ec(z,O,S){return S.scrollOffset&&O.setOffset(S.scrollOffset),new Ic(z,O,S)}function Ml(z,O,S={}){return S.useHash?new u.Do(z,O):new u.b0(z,O)}function Ba(z){return"guarded"}function tc(z){return[{provide:d.deG,multi:!0,useValue:z},{provide:Vs,multi:!0,useValue:z}]}let Al=(()=>{class z{constructor(S){this.injector=S,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Ge.xQ}appInitializer(){return this.injector.get(u.V_,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let J=null;const ce=new Promise(bt=>J=bt),Me=this.injector.get(Fo),lt=this.injector.get(ba);return"disabled"===lt.initialNavigation?(Me.setUpLocationChangeListener(),J(!0)):"enabled"===lt.initialNavigation||"enabledBlocking"===lt.initialNavigation?(Me.hooks.afterPreactivation=()=>this.initNavigation?(0,Fe.of)(null):(this.initNavigation=!0,J(!0),this.resultOfPreactivationDone),Me.initialNavigation()):J(!0),ce})}bootstrapListener(S){const J=this.injector.get(ba),ce=this.injector.get(xa),Me=this.injector.get(Ic),lt=this.injector.get(Fo),bt=this.injector.get(d.z2F);S===bt.components[0]&&(("enabledNonBlocking"===J.initialNavigation||void 0===J.initialNavigation)&&lt.initialNavigation(),ce.setUpPreloading(),Me.init(),lt.resetRootComponentType(bt.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return z.\u0275fac=function(S){return new(S||z)(d.LFG(d.zs3))},z.\u0275prov=d.Yz7({token:z,factory:z.\u0275fac}),z})();function Sl(z){return z.appInitializer.bind(z)}function cl(z){return z.bootstrapListener.bind(z)}const Na=new d.OlP("Router Initializer")},9397:(Tn,Je,R)=>{"use strict";R.d(Je,{Zw:()=>zt,aw:()=>xi,X$:()=>_i,sK:()=>yi});var u=R(6738),d=R(2916);function j(Qt){return!!Qt&&(Qt instanceof d.y||"function"==typeof Qt.lift&&"function"==typeof Qt.subscribe)}var l=R(1086),L=R(567),P=R(1221),m=R(8514),$=R(8929),ue=R(6686),Z=R(2268);const _e=new class K extends Z.v{}(class V extends ue.o{constructor(Ye,te){super(Ye,te),this.scheduler=Ye,this.work=te}schedule(Ye,te=0){return te>0?super.schedule(Ye,te):(this.delay=te,this.state=Ye,this.scheduler.flush(this),this)}execute(Ye,te){return te>0||this.closed?super.execute(Ye,te):this._execute(Ye,te)}requestAsyncId(Ye,te,Ae=0){return null!==Ae&&Ae>0||null===Ae&&this.delay>0?super.requestAsyncId(Ye,te,Ae):Ye.flush(this)}});var ge=R(2654),xe=R(3489),je=R(8896);function Fe({error:Qt,subscriber:Ye}){Ye.error(Qt)}class Ne{constructor(Ye,te,Ae){this.kind=Ye,this.value=te,this.error=Ae,this.hasValue="N"===Ye}observe(Ye){switch(this.kind){case"N":return Ye.next&&Ye.next(this.value);case"E":return Ye.error&&Ye.error(this.error);case"C":return Ye.complete&&Ye.complete()}}do(Ye,te,Ae){switch(this.kind){case"N":return Ye&&Ye(this.value);case"E":return te&&te(this.error);case"C":return Ae&&Ae()}}accept(Ye,te,Ae){return Ye&&"function"==typeof Ye.next?this.observe(Ye):this.do(Ye,te,Ae)}toObservable(){switch(this.kind){case"N":return(0,l.of)(this.value);case"E":return function nt(Qt,Ye){return new d.y(Ye?te=>Ye.schedule(Fe,0,{error:Qt,subscriber:te}):te=>te.error(Qt))}(this.error);case"C":return(0,je.c)()}throw new Error("unexpected notification kind value")}static createNext(Ye){return void 0!==Ye?new Ne("N",Ye):Ne.undefinedValueNotification}static createError(Ye){return new Ne("E",void 0,Ye)}static createComplete(){return Ne.completeNotification}}Ne.completeNotification=new Ne("C"),Ne.undefinedValueNotification=new Ne("N",void 0);class _t extends xe.L{constructor(Ye,te,Ae=0){super(Ye),this.scheduler=te,this.delay=Ae}static dispatch(Ye){const{notification:te,destination:Ae}=Ye;te.observe(Ae),this.unsubscribe()}scheduleMessage(Ye){this.destination.add(this.scheduler.schedule(_t.dispatch,this.delay,new Ge(Ye,this.destination)))}_next(Ye){this.scheduleMessage(Ne.createNext(Ye))}_error(Ye){this.scheduleMessage(Ne.createError(Ye)),this.unsubscribe()}_complete(){this.scheduleMessage(Ne.createComplete()),this.unsubscribe()}}class Ge{constructor(Ye,te){this.notification=Ye,this.destination=te}}var ot=R(5279),yt=R(5283);class wt extends $.xQ{constructor(Ye=Number.POSITIVE_INFINITY,te=Number.POSITIVE_INFINITY,Ae){super(),this.scheduler=Ae,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=Ye<1?1:Ye,this._windowTime=te<1?1:te,te===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(Ye){if(!this.isStopped){const te=this._events;te.push(Ye),te.length>this._bufferSize&&te.shift()}super.next(Ye)}nextTimeWindow(Ye){this.isStopped||(this._events.push(new xt(this._getNow(),Ye)),this._trimBufferThenGetEvents()),super.next(Ye)}_subscribe(Ye){const te=this._infiniteTimeWindow,Ae=te?this._events:this._trimBufferThenGetEvents(),ut=this.scheduler,Pe=Ae.length;let Nt;if(this.closed)throw new ot.N;if(this.isStopped||this.hasError?Nt=ge.w.EMPTY:(this.observers.push(Ye),Nt=new yt.W(this,Ye)),ut&&Ye.add(Ye=new _t(Ye,ut)),te)for(let me=0;me<Pe&&!Ye.closed;me++)Ye.next(Ae[me]);else for(let me=0;me<Pe&&!Ye.closed;me++)Ye.next(Ae[me].value);return this.hasError?Ye.error(this.thrownError):this.isStopped&&Ye.complete(),Nt}_getNow(){return(this.scheduler||_e).now()}_trimBufferThenGetEvents(){const Ye=this._getNow(),te=this._bufferSize,Ae=this._windowTime,ut=this._events,Pe=ut.length;let Nt=0;for(;Nt<Pe&&!(Ye-ut[Nt].time<Ae);)Nt++;return Pe>te&&(Nt=Math.max(Nt,Pe-te)),Nt>0&&ut.splice(0,Nt),ut}}class xt{constructor(Ye,te){this.time=Ye,this.value=te}}function dt(Qt,Ye,te){let Ae;return Ae=Qt&&"object"==typeof Qt?Qt:{bufferSize:Qt,windowTime:Ye,refCount:!1,scheduler:te},ut=>ut.lift(function At({bufferSize:Qt=Number.POSITIVE_INFINITY,windowTime:Ye=Number.POSITIVE_INFINITY,refCount:te,scheduler:Ae}){let ut,Nt,Pe=0,me=!1,qe=!1;return function(Xt){let Xn;Pe++,!ut||me?(me=!1,ut=new wt(Qt,Ye,Ae),Xn=ut.subscribe(this),Nt=Xt.subscribe({next(Ki){ut.next(Ki)},error(Ki){me=!0,ut.error(Ki)},complete(){qe=!0,Nt=void 0,ut.complete()}})):Xn=ut.subscribe(this),this.add(()=>{Pe--,Xn.unsubscribe(),Nt&&!qe&&te&&0===Pe&&(Nt.unsubscribe(),Nt=void 0,ut=void 0)})}}(Ae))}var Vt=R(2986),Un=R(4850),St=R(1406),$t=R(7545);class zt{}let Ht=(()=>{class Qt extends zt{getTranslation(te){return(0,l.of)({})}}return Qt.\u0275fac=function(){let Ye;return function(Ae){return(Ye||(Ye=u.n5z(Qt)))(Ae||Qt)}}(),Qt.\u0275prov=u.Yz7({token:Qt,factory:Qt.\u0275fac}),Qt})();class en{}let Kt=(()=>{class Qt{handle(te){return te.key}}return Qt.\u0275fac=function(te){return new(te||Qt)},Qt.\u0275prov=u.Yz7({token:Qt,factory:Qt.\u0275fac}),Qt})();function Wt(Qt,Ye){if(Qt===Ye)return!0;if(null===Qt||null===Ye)return!1;if(Qt!=Qt&&Ye!=Ye)return!0;let ut,Pe,Nt,te=typeof Qt;if(te==typeof Ye&&"object"==te){if(!Array.isArray(Qt)){if(Array.isArray(Ye))return!1;for(Pe in Nt=Object.create(null),Qt){if(!Wt(Qt[Pe],Ye[Pe]))return!1;Nt[Pe]=!0}for(Pe in Ye)if(!(Pe in Nt)&&void 0!==Ye[Pe])return!1;return!0}if(!Array.isArray(Ye))return!1;if((ut=Qt.length)==Ye.length){for(Pe=0;Pe<ut;Pe++)if(!Wt(Qt[Pe],Ye[Pe]))return!1;return!0}}return!1}function Yt(Qt){return null!=Qt}function qt(Qt){return Qt&&"object"==typeof Qt&&!Array.isArray(Qt)}function Gt(Qt,Ye){let te=Object.assign({},Qt);return qt(Qt)&&qt(Ye)&&Object.keys(Ye).forEach(Ae=>{qt(Ye[Ae])?Ae in Qt?te[Ae]=Gt(Qt[Ae],Ye[Ae]):Object.assign(te,{[Ae]:Ye[Ae]}):Object.assign(te,{[Ae]:Ye[Ae]})}),te}class ft{}let Ut=(()=>{class Qt extends ft{constructor(){super(...arguments),this.templateMatcher=/{{\s?([^{}\s]*)\s?}}/g}interpolate(te,Ae){let ut;return ut="string"==typeof te?this.interpolateString(te,Ae):"function"==typeof te?this.interpolateFunction(te,Ae):te,ut}getValue(te,Ae){let ut="string"==typeof Ae?Ae.split("."):[Ae];Ae="";do{Ae+=ut.shift(),!Yt(te)||!Yt(te[Ae])||"object"!=typeof te[Ae]&&ut.length?ut.length?Ae+=".":te=void 0:(te=te[Ae],Ae="")}while(ut.length);return te}interpolateFunction(te,Ae){return te(Ae)}interpolateString(te,Ae){return Ae?te.replace(this.templateMatcher,(ut,Pe)=>{let Nt=this.getValue(Ae,Pe);return Yt(Nt)?Nt:ut}):te}}return Qt.\u0275fac=function(){let Ye;return function(Ae){return(Ye||(Ye=u.n5z(Qt)))(Ae||Qt)}}(),Qt.\u0275prov=u.Yz7({token:Qt,factory:Qt.\u0275fac}),Qt})();class On{}let fn=(()=>{class Qt extends On{compile(te,Ae){return te}compileTranslations(te,Ae){return te}}return Qt.\u0275fac=function(){let Ye;return function(Ae){return(Ye||(Ye=u.n5z(Qt)))(Ae||Qt)}}(),Qt.\u0275prov=u.Yz7({token:Qt,factory:Qt.\u0275fac}),Qt})();class Gn{constructor(){this.currentLang=this.defaultLang,this.translations={},this.langs=[],this.onTranslationChange=new u.vpe,this.onLangChange=new u.vpe,this.onDefaultLangChange=new u.vpe}}const ei=new u.OlP("USE_STORE"),$i=new u.OlP("USE_DEFAULT_LANG"),sr=new u.OlP("DEFAULT_LANGUAGE"),zi=new u.OlP("USE_EXTEND");let yi=(()=>{class Qt{constructor(te,Ae,ut,Pe,Nt,me=!0,qe=!1,Rt=!1,Xt){this.store=te,this.currentLoader=Ae,this.compiler=ut,this.parser=Pe,this.missingTranslationHandler=Nt,this.useDefaultLang=me,this.isolate=qe,this.extend=Rt,this.pending=!1,this._onTranslationChange=new u.vpe,this._onLangChange=new u.vpe,this._onDefaultLangChange=new u.vpe,this._langs=[],this._translations={},this._translationRequests={},Xt&&this.setDefaultLang(Xt)}get onTranslationChange(){return this.isolate?this._onTranslationChange:this.store.onTranslationChange}get onLangChange(){return this.isolate?this._onLangChange:this.store.onLangChange}get onDefaultLangChange(){return this.isolate?this._onDefaultLangChange:this.store.onDefaultLangChange}get defaultLang(){return this.isolate?this._defaultLang:this.store.defaultLang}set defaultLang(te){this.isolate?this._defaultLang=te:this.store.defaultLang=te}get currentLang(){return this.isolate?this._currentLang:this.store.currentLang}set currentLang(te){this.isolate?this._currentLang=te:this.store.currentLang=te}get langs(){return this.isolate?this._langs:this.store.langs}set langs(te){this.isolate?this._langs=te:this.store.langs=te}get translations(){return this.isolate?this._translations:this.store.translations}set translations(te){this.isolate?this._translations=te:this.store.translations=te}setDefaultLang(te){if(te===this.defaultLang)return;let Ae=this.retrieveTranslations(te);void 0!==Ae?(null==this.defaultLang&&(this.defaultLang=te),Ae.pipe((0,Vt.q)(1)).subscribe(ut=>{this.changeDefaultLang(te)})):this.changeDefaultLang(te)}getDefaultLang(){return this.defaultLang}use(te){if(te===this.currentLang)return(0,l.of)(this.translations[te]);let Ae=this.retrieveTranslations(te);return void 0!==Ae?(this.currentLang||(this.currentLang=te),Ae.pipe((0,Vt.q)(1)).subscribe(ut=>{this.changeLang(te)}),Ae):(this.changeLang(te),(0,l.of)(this.translations[te]))}retrieveTranslations(te){let Ae;return(void 0===this.translations[te]||this.extend)&&(this._translationRequests[te]=this._translationRequests[te]||this.getTranslation(te),Ae=this._translationRequests[te]),Ae}getTranslation(te){this.pending=!0;const Ae=this.currentLoader.getTranslation(te).pipe(dt(1),(0,Vt.q)(1));return this.loadingTranslations=Ae.pipe((0,Un.U)(ut=>this.compiler.compileTranslations(ut,te)),dt(1),(0,Vt.q)(1)),this.loadingTranslations.subscribe({next:ut=>{this.translations[te]=this.extend&&this.translations[te]?{...ut,...this.translations[te]}:ut,this.updateLangs(),this.pending=!1},error:ut=>{this.pending=!1}}),Ae}setTranslation(te,Ae,ut=!1){Ae=this.compiler.compileTranslations(Ae,te),this.translations[te]=(ut||this.extend)&&this.translations[te]?Gt(this.translations[te],Ae):Ae,this.updateLangs(),this.onTranslationChange.emit({lang:te,translations:this.translations[te]})}getLangs(){return this.langs}addLangs(te){te.forEach(Ae=>{-1===this.langs.indexOf(Ae)&&this.langs.push(Ae)})}updateLangs(){this.addLangs(Object.keys(this.translations))}getParsedResult(te,Ae,ut){let Pe;if(Ae instanceof Array){let Nt={},me=!1;for(let qe of Ae)Nt[qe]=this.getParsedResult(te,qe,ut),j(Nt[qe])&&(me=!0);if(me){const qe=Ae.map(Rt=>j(Nt[Rt])?Nt[Rt]:(0,l.of)(Nt[Rt]));return(0,L.D)(qe).pipe((0,Un.U)(Rt=>{let Xt={};return Rt.forEach((Xn,Ki)=>{Xt[Ae[Ki]]=Xn}),Xt}))}return Nt}if(te&&(Pe=this.parser.interpolate(this.parser.getValue(te,Ae),ut)),void 0===Pe&&null!=this.defaultLang&&this.defaultLang!==this.currentLang&&this.useDefaultLang&&(Pe=this.parser.interpolate(this.parser.getValue(this.translations[this.defaultLang],Ae),ut)),void 0===Pe){let Nt={key:Ae,translateService:this};void 0!==ut&&(Nt.interpolateParams=ut),Pe=this.missingTranslationHandler.handle(Nt)}return void 0!==Pe?Pe:Ae}get(te,Ae){if(!Yt(te)||!te.length)throw new Error('Parameter "key" required');if(this.pending)return this.loadingTranslations.pipe((0,St.b)(ut=>j(ut=this.getParsedResult(ut,te,Ae))?ut:(0,l.of)(ut)));{let ut=this.getParsedResult(this.translations[this.currentLang],te,Ae);return j(ut)?ut:(0,l.of)(ut)}}getStreamOnTranslationChange(te,Ae){if(!Yt(te)||!te.length)throw new Error('Parameter "key" required');return(0,P.z)((0,m.P)(()=>this.get(te,Ae)),this.onTranslationChange.pipe((0,$t.w)(ut=>{const Pe=this.getParsedResult(ut.translations,te,Ae);return"function"==typeof Pe.subscribe?Pe:(0,l.of)(Pe)})))}stream(te,Ae){if(!Yt(te)||!te.length)throw new Error('Parameter "key" required');return(0,P.z)((0,m.P)(()=>this.get(te,Ae)),this.onLangChange.pipe((0,$t.w)(ut=>{const Pe=this.getParsedResult(ut.translations,te,Ae);return j(Pe)?Pe:(0,l.of)(Pe)})))}instant(te,Ae){if(!Yt(te)||!te.length)throw new Error('Parameter "key" required');let ut=this.getParsedResult(this.translations[this.currentLang],te,Ae);if(j(ut)){if(te instanceof Array){let Pe={};return te.forEach((Nt,me)=>{Pe[te[me]]=te[me]}),Pe}return te}return ut}set(te,Ae,ut=this.currentLang){this.translations[ut][te]=this.compiler.compile(Ae,ut),this.updateLangs(),this.onTranslationChange.emit({lang:ut,translations:this.translations[ut]})}changeLang(te){this.currentLang=te,this.onLangChange.emit({lang:te,translations:this.translations[te]}),null==this.defaultLang&&this.changeDefaultLang(te)}changeDefaultLang(te){this.defaultLang=te,this.onDefaultLangChange.emit({lang:te,translations:this.translations[te]})}reloadLang(te){return this.resetLang(te),this.getTranslation(te)}resetLang(te){this._translationRequests[te]=void 0,this.translations[te]=void 0}getBrowserLang(){if("undefined"==typeof window||void 0===window.navigator)return;let te=window.navigator.languages?window.navigator.languages[0]:null;return te=te||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,void 0!==te?(-1!==te.indexOf("-")&&(te=te.split("-")[0]),-1!==te.indexOf("_")&&(te=te.split("_")[0]),te):void 0}getBrowserCultureLang(){if("undefined"==typeof window||void 0===window.navigator)return;let te=window.navigator.languages?window.navigator.languages[0]:null;return te=te||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,te}}return Qt.\u0275fac=function(te){return new(te||Qt)(u.LFG(Gn),u.LFG(zt),u.LFG(On),u.LFG(ft),u.LFG(en),u.LFG($i),u.LFG(ei),u.LFG(zi),u.LFG(sr))},Qt.\u0275prov=u.Yz7({token:Qt,factory:Qt.\u0275fac}),Qt})(),_i=(()=>{class Qt{constructor(te,Ae){this.translate=te,this._ref=Ae,this.value="",this.lastKey=null,this.lastParams=[]}updateValue(te,Ae,ut){let Pe=Nt=>{this.value=void 0!==Nt?Nt:te,this.lastKey=te,this._ref.markForCheck()};if(ut){let Nt=this.translate.getParsedResult(ut,te,Ae);j(Nt.subscribe)?Nt.subscribe(Pe):Pe(Nt)}this.translate.get(te,Ae).subscribe(Pe)}transform(te,...Ae){if(!te||!te.length)return te;if(Wt(te,this.lastKey)&&Wt(Ae,this.lastParams))return this.value;let ut;if(Yt(Ae[0])&&Ae.length)if("string"==typeof Ae[0]&&Ae[0].length){let Pe=Ae[0].replace(/(\')?([a-zA-Z0-9_]+)(\')?(\s)?:/g,'"$2":').replace(/:(\s)?(\')(.*?)(\')/g,':"$3"');try{ut=JSON.parse(Pe)}catch{throw new SyntaxError(`Wrong parameter in TranslatePipe. Expected a valid Object, received: ${Ae[0]}`)}}else"object"==typeof Ae[0]&&!Array.isArray(Ae[0])&&(ut=Ae[0]);return this.lastKey=te,this.lastParams=Ae,this.updateValue(te,ut),this._dispose(),this.onTranslationChange||(this.onTranslationChange=this.translate.onTranslationChange.subscribe(Pe=>{this.lastKey&&Pe.lang===this.translate.currentLang&&(this.lastKey=null,this.updateValue(te,ut,Pe.translations))})),this.onLangChange||(this.onLangChange=this.translate.onLangChange.subscribe(Pe=>{this.lastKey&&(this.lastKey=null,this.updateValue(te,ut,Pe.translations))})),this.onDefaultLangChange||(this.onDefaultLangChange=this.translate.onDefaultLangChange.subscribe(()=>{this.lastKey&&(this.lastKey=null,this.updateValue(te,ut))})),this.value}_dispose(){void 0!==this.onTranslationChange&&(this.onTranslationChange.unsubscribe(),this.onTranslationChange=void 0),void 0!==this.onLangChange&&(this.onLangChange.unsubscribe(),this.onLangChange=void 0),void 0!==this.onDefaultLangChange&&(this.onDefaultLangChange.unsubscribe(),this.onDefaultLangChange=void 0)}ngOnDestroy(){this._dispose()}}return Qt.\u0275fac=function(te){return new(te||Qt)(u.Y36(yi,16),u.Y36(u.sBO,16))},Qt.\u0275pipe=u.Yjl({name:"translate",type:Qt,pure:!1}),Qt.\u0275prov=u.Yz7({token:Qt,factory:Qt.\u0275fac}),Qt})(),xi=(()=>{class Qt{static forRoot(te={}){return{ngModule:Qt,providers:[te.loader||{provide:zt,useClass:Ht},te.compiler||{provide:On,useClass:fn},te.parser||{provide:ft,useClass:Ut},te.missingTranslationHandler||{provide:en,useClass:Kt},Gn,{provide:ei,useValue:te.isolate},{provide:$i,useValue:te.useDefaultLang},{provide:zi,useValue:te.extend},{provide:sr,useValue:te.defaultLanguage},yi]}}static forChild(te={}){return{ngModule:Qt,providers:[te.loader||{provide:zt,useClass:Ht},te.compiler||{provide:On,useClass:fn},te.parser||{provide:ft,useClass:Ut},te.missingTranslationHandler||{provide:en,useClass:Kt},{provide:ei,useValue:te.isolate},{provide:$i,useValue:te.useDefaultLang},{provide:zi,useValue:te.extend},{provide:sr,useValue:te.defaultLanguage},yi]}}}return Qt.\u0275fac=function(te){return new(te||Qt)},Qt.\u0275mod=u.oAB({type:Qt}),Qt.\u0275inj=u.cJS({}),Qt})()}},Tn=>{Tn(Tn.s=3592)}]);